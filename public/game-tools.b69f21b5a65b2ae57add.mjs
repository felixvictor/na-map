/*! For license information please see game-tools.b69f21b5a65b2ae57add.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[639],{2350:(t,e,a)=>{a.r(e),a.d(e,{init:()=>$i});var s=a(9492),i=a(2855),n=a(2157),r=a(9022),o=a(7015),l=a(5923),h=a(9843),d=a(29);function c(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,p(t,e,"get"))}function u(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,p(t,e,"set"),a),a}function p(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var m=new WeakMap,w=new WeakMap,v=new WeakMap,b=new WeakMap,f=new WeakMap,g=new WeakMap,_=new WeakMap;class y{constructor(){m.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:"List of buildings"}),v.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:{}}),f.set(this,{writable:!0,value:{}}),g.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:{}}),u(this,m,(0,r.MF)(c(this,w))),u(this,v,`menu-${c(this,m)}`),this._setupListener()}async _loadAndSetupData(){u(this,b,(await a.e(337).then(a.t.bind(a,5732,19))).default)}async _menuClicked(){(0,i.KS)("Tools",c(this,w)),c(this,g)?c(this,g).show():(await this._loadAndSetupData(),u(this,g,new h.Z(c(this,w),"lg")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${c(this,v)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${c(this,b).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupSelect(){u(this,_,new d.Z(c(this,m),c(this,g).baseIdSelects,{noneSelectedText:"Select building"},this._getOptions(),!1)),u(this,f,c(this,g).selectsSel.select("label")),c(this,f).attr("class","ps-2")}_setupSelectListener(){c(this,_).select$.on("change",(()=>{this._buildingSelected()}))}_getBuildingData(t){return c(this,b).find((e=>e.name===t))}_getProductText(t){let e="";return t.result&&(t.result.length>1?(c(this,f).text(""),e+='<table class="table table-sm table-hover text-table"><tbody>',e+=`${t.result.map((t=>`<tr><td>${t.name}</td></tr>`)).join("")}`,e+="</tbody></table>"):(c(this,f).text(`produces ${t.result[0].name}`),t.result[0].price&&(e+='<table class="table table-sm table-hover text-table"><tbody>',e+=`<tr><td>${(0,l.PK)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm table-hover"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>`,e+=a.materials.map((t=>`${(0,o.yI)(t.amount)} ${t.item}`)).join("<br>"),e+="</td>",e+=`<td>${(0,o.yI)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour<br>cost (%)</th><th>Storage</th><th>Build price<br>(reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${(0,o.yI)(a.production)}</td><td>${(0,o.yI)(-100*a.labourDiscount)}</td><td>${(0,o.yI)(a.maxStorage)}</td><td>${(0,o.yI)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-4">',a+='<div class="card-body">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-8">',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(){const t=String(c(this,_).getValues()),e=c(this,g).outputSel;e.select("div").remove(),e.append("div").classed("mt-4",!0).html(this._getText(t))}}var S=a(8471),k=a.n(S);function $(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,x(t,e,"get"))}function M(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,x(t,e,"set"),a),a}function x(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var W=new WeakMap,T=new WeakMap,D=new WeakMap,L=new WeakMap,I=new WeakMap,A=new WeakMap,P=new WeakMap,j=new WeakMap,C=new WeakMap,O=new WeakMap,E=new WeakMap,R=new WeakMap,N=new WeakMap,Z=new WeakMap;class q{constructor(){W.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:"List of cannons"}),D.set(this,{writable:!0,value:void 0}),L.set(this,{writable:!0,value:["name","damage","penetration","generic","family"]}),I.set(this,{writable:!0,value:{group:new Map,element:new Set}}),A.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:{}}),j.set(this,{writable:!0,value:{}}),C.set(this,{writable:!0,value:{}}),O.set(this,{writable:!0,value:{}}),E.set(this,{writable:!0,value:{}}),R.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:{}}),Z.set(this,{writable:!0,value:{}}),M(this,W,(0,r.MF)($(this,T))),M(this,A,`menu-${$(this,W)}`),M(this,D,`checkbox-${$(this,W)}`),this._setupListener()}async _loadAndSetupData(){const t=(await a.e(945).then(a.t.bind(a,4037,19))).default;this._setupData(t)}_getFormattedName(t){let e=t;const a=t.split(" "),s=`c${a[0].padStart(3,"0")}`,i=a[1]?a[1][1]:"0";return a.length>1&&(e=`${a[0]} <em>${a[1]}</em>`),{value:`${s}${i}`,formattedValue:e}}_setupData(t){const e=Object.entries(t.long[0]).sort(((t,e)=>$(this,L).indexOf(t[0])-$(this,L).indexOf(e[0])));for(const[t,a]of e)if("name"===t)$(this,I).group.set("",1),$(this,I).element.add("Lb");else if("family"!==t){$(this,I).group.set((0,n.fm)(t),Object.entries(a).length);for(const t of Object.keys(a))$(this,I).element.add((0,n.fm)(t))}for(const e of n.qg)$(this,E)[e]=t[e].map((t=>{const e=[],a=Object.entries(t).sort(((t,e)=>$(this,L).indexOf(t[0])-$(this,L).indexOf(e[0])));for(const[t,s]of a)if("name"===t)e.push(this._getFormattedName(s));else if("family"!==t)for(const[,t]of Object.entries(s))t&&e.push({value:t.value,formattedValue:0===t.value?"":(0,o.QM)(t.value,(null==t?void 0:t.digits)??0)});return{family:t.family,data:e}}))}async _menuClicked(){(0,i.KS)("Tools",$(this,T)),$(this,R)?$(this,R).show():(await this._loadAndSetupData(),M(this,R,new h.Z($(this,T),"xl")),this._injectTab())}_setupListener(){var t;null===(t=document.querySelector(`#${$(this,A)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e,a=!0){a&&$(this,Z)[t]===e&&($(this,N)[t]=!$(this,N)[t]),$(this,Z)[t]=e;const s=$(this,N)[t]?1:-1;$(this,P)[t].sort(((t,a)=>0===e?t[e].value.localeCompare(a[e].value)*s:(t[e].value-a[e].value)*s))}_getTabId(){return`${$(this,W)}-tab`}_getTabItemId(t){return`${this._getTabId()}-${t}-item`}_getTabContentId(t){return`${this._getTabId()}-${t}-content`}_getListId(t){return`${this._getTabId()}-${t}-list`}_addNavPills(t){const e=t.append("ul").attr("id",this._getTabId()).attr("class","nav nav-tabs").attr("role","tablist");for(const[t,a]of n.qg.entries()){const s=e.append("li").attr("class","nav-item").attr("role","presentation").append("button").attr("class","nav-link").attr("id",this._getTabItemId(a)).attr("data-bs-target",`#${this._getTabContentId(a)}`).attr("data-bs-toggle","tab").attr("role","tab").text((0,n.fm)(a));0===t&&s.attr("class","nav-link active").attr("aria-current","page")}}_injectSwitches(t,e){const a=t.append("div").attr("class","mb-3");for(const t of n.kK[e]){const s=a.append("div").attr("class","form-check form-check-inline form-switch");s.append("input").attr("id",`${$(this,D)}-${e}-${t}`).attr("name",`${$(this,D)}-${e}`).attr("class","form-check-input").attr("type","checkbox").property("checked",!0),s.append("label").attr("for",`${$(this,D)}-${e}-${t}`).attr("class","form-check-label").text((0,n.fm)(t))}$(this,j)[e]=[...document.querySelectorAll(`input[name=${$(this,D)}-${e}]`)];for(const t of $(this,j)[e])t.addEventListener("change",(t=>{t.preventDefault(),this._cannonFamilySelected(e)}))}_injectTableStructure(t,e){$(this,N)[e]=!0,$(this,C)[e]=t.append("table").attr("class","table table-sm table-sort table-striped table-hover");const a=$(this,C)[e].append("thead");a.append("tr").attr("class","thead-group").selectAll("th").data([...$(this,I).group]).join("th").classed("border-bottom-0",((t,e)=>0===e)).classed("text-center",((t,e)=>0!==e)).attr("colspan",(t=>`${t[1]}`)).attr("scope","col").text((t=>t[0])),a.append("tr").selectAll("th").data([...$(this,I).element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",((t,e)=>0===e)).classed("text-end",((t,e)=>0!==e)).text((t=>t.data)).on("click",((t,a)=>{this._sortRows(e,a.index)})),$(this,C)[e].append("tbody")}_insertTabContent(t,e,a){$(this,N)[e]=!0;const s=t.append("div").attr("class","tab-pane fade"+(0===a?" show active":"")).attr("id",this._getTabContentId(e)).attr("role","tabpanel").attr("aria-labelledby",this._getTabItemId(e)).append("div").attr("id",this._getListId(e));this._injectSwitches(s,e),this._injectTableStructure(s,e)}_injectTab(){const t=$(this,R).outputSel;this._addNavPills(t);const e=t.append("div").attr("class","tab-content pt-2");for(const[t,a]of n.qg.entries())$(this,Z)[a]=0,this._insertTabContent(e,a,t),this._cannonFamilySelected(a);const a=document.querySelector(`#${this._getTabId()} li:first-child button`);new(k())(a).show()}_updateTable(t){$(this,P)[t]=$(this,C)[t].select("tbody").selectAll("tr").data($(this,O)[t],(t=>t[0].formattedValue)).join((t=>t.append("tr"))),$(this,P)[t].selectAll("td").data((t=>t)).join((t=>t.append("td").html((t=>t.formattedValue))))}_cannonFamilySelected(t){const e=new Set;for(const a of $(this,j)[t])if(a.checked){const s=a.id.replace(`${$(this,D)}-${t}-`,"");e.add(s)}$(this,O)[t]=$(this,E)[t].filter((t=>e.has(t.family))).map((t=>t.data)),this._updateTable(t),this._sortRows(t,$(this,Z)[t],!1)}}var B=a(7484),F=a.n(B),K=(a(9517),a(4110)),V=a.n(K),H=a(178),z=a.n(H),U=a(4194),Q=a(3389);function J(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Y(t,e,"get"))}function G(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Y(t,e,"set"),a),a}function Y(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}F().extend(V()),F().extend(z()),F().locale("en-gb");var X=new WeakMap,tt=new WeakMap,et=new WeakMap,at=new WeakMap,st=new WeakMap,it=new WeakMap,nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,lt=new WeakMap,ht=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,mt=new WeakMap;class wt{constructor(t){X.set(this,{writable:!0,value:void 0}),tt.set(this,{writable:!0,value:"List of conquest flags"}),et.set(this,{writable:!0,value:void 0}),at.set(this,{writable:!0,value:void 0}),st.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:[]}),nt.set(this,{writable:!0,value:{}}),rt.set(this,{writable:!0,value:[]}),ot.set(this,{writable:!0,value:[]}),lt.set(this,{writable:!0,value:[]}),ht.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:{}}),ct.set(this,{writable:!0,value:!0}),ut.set(this,{writable:!0,value:0}),pt.set(this,{writable:!0,value:{}}),mt.set(this,{writable:!0,value:{}}),G(this,st,t),G(this,X,(0,r.MF)(J(this,tt))),G(this,at,`menu-${J(this,X)}`),G(this,et,`${J(this,X)}-input`),"eu1"===t?this._setupListener():this._removeMenu()}_removeMenu(){document.querySelector(`#${J(this,at)}`).remove()}async _loadData(){G(this,lt,await(0,r.qP)(`${J(this,st)}-flags.json`))}_setupData(){for(const t of J(this,lt))for(const e of t.flags)J(this,ot).push([e.expire,t.nation,this._fromNow(e.expire),this._getDate(e.expire),this._getTime(e.expire),e.number])}async _loadAndSetupData(){await this._loadData(),this._setupData()}async _menuClicked(){(0,i.KS)("Tools",J(this,tt)),J(this,ht)?J(this,ht).show():(await this._loadAndSetupData(),G(this,ht,new h.Z(J(this,tt),"lg")),this._listSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${J(this,at)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){let a=0;3===t&&(a=5),e&&J(this,ut)===a&&G(this,ct,!J(this,ct)),G(this,ut,a);const s=J(this,ct)?1:-1;J(this,dt).sort(((e,i)=>3===t?(e[a]-i[a])*s:e[a].localeCompare(i[a])*s))}_initTable(){G(this,ct,!0),J(this,pt).append("thead").append("tr").selectAll("th").data(["Expires in","Date","Time","Flags"]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>e<=1)).attr("scope","col").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),J(this,pt).append("tbody")}_fromNow(t){return`${F().utc(t).fromNow().replace("in ","").replace("a ","1 ")}`}_getDate(t){return`${F().utc(t).format("dddd, D MMM")}`}_getTime(t){const e=F().utc(t).local(),a=F().utc(t),s=a===e?"":` (${e.format("H.mm")} local)`;return`${a.format("H.mm")} ${s}`}_updateTable(){G(this,dt,J(this,pt).select("tbody").selectAll("tr").data(J(this,rt),(t=>t[0])).join((t=>t.append("tr")))),J(this,dt).selectAll("td").data((t=>t.slice(2))).join((t=>t.append("td").classed("text-start",((t,e)=>e<=1)).text((t=>t))))}_getActiveNation(){return Number(J(this,mt).get())}_injectToggleButtons(){const t=n.nU.filter((t=>!("NT"===t.short||"FT"===t.short))).sort(((t,e)=>t.sortName.localeCompare(e.sortName)));G(this,it,t.map((t=>String(t.id))));const e=J(this,ht).selectsSel.append("div").attr("id",J(this,et)).attr("class","d-flex flex-wrap justify-content-between mb-3");for(const a of t)e.append("input").attr("type","radio").attr("class","btn-check").attr("name",J(this,et)).attr("id",`${J(this,et)}-${a.id}`).attr("value",a.id).attr("autocomplete","off"),e.append("label").attr("for",`${J(this,et)}-${a.id}`).attr("class","btn btn-toggle").attr("title",a.name).append("i").attr("class",`flag-icon-${a.short} flag-icon-button`).attr("role","img")}_showSelected(){const t=this._getActiveNation();G(this,rt,J(this,ot).filter((e=>e[1]===t))),J(this,nt).set(String(t)),this._updateTable(),this._sortRows(0,!1)}_setupButtonListener(){var t;null===(t=document.querySelector(`#${J(this,et)}`))||void 0===t||t.addEventListener("change",(async()=>{this._showSelected()}))}_listSelected(){G(this,pt,J(this,ht).outputSel.append("table").attr("class","table table-sm table-striped table-hover table-sort text-table mt-3")),this._initTable(),this._injectToggleButtons(),G(this,mt,new U.Z(J(this,et),J(this,it))),G(this,nt,new Q.Z({id:J(this,et),values:J(this,it)})),J(this,mt).set(J(this,nt).get()),this._setupButtonListener(),this._showSelected()}}var vt=a(3824),bt=a.n(vt),ft=a(1198);function gt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,yt(t,e,"get"))}function _t(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,yt(t,e,"set"),a),a}function yt(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var St=new WeakMap,kt=new WeakMap,$t=new WeakMap,Mt=new WeakMap,xt=new WeakMap,Wt=new WeakMap;class Tt{constructor(){St.set(this,{writable:!0,value:[]}),kt.set(this,{writable:!0,value:void 0}),$t.set(this,{writable:!0,value:[]}),Mt.set(this,{writable:!0,value:void 0}),xt.set(this,{writable:!0,value:"List of recipe ingredients"}),Wt.set(this,{writable:!0,value:void 0}),_t(this,Mt,(0,r.MF)(gt(this,xt))),_t(this,Wt,`menu-${gt(this,Mt)}`),this._setupListener()}async _loadAndSetupData(){_t(this,$t,(await a.e(303).then(a.t.bind(a,5472,19))).default),_t(this,St,(await a.e(757).then(a.t.bind(a,3727,19))).default.ingredient)}async _menuClicked(){(0,i.KS)("Tools",gt(this,xt)),gt(this,kt)?gt(this,kt).show():(await this._loadAndSetupData(),_t(this,kt,new h.Z(gt(this,xt),"xl")),this._ingredientListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${gt(this,Wt)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getProperties(t){let e,a="",s="";for(const e of gt(this,$t)){const i=e[1].sort((0,n.MR)(["name"])).filter((e=>e.name===t));for(const t of i)a=e[0],s=`${t.properties.map((t=>{const e=t.isPercentage?(0,o.QO)(t.amount/100).replace(/"/g,"'"):(0,o.IH)(t.amount);return`<tr><td class='text-start pe-3'>${t.modifier}</td><td>${e}</td></tr>`})).join("")}`}return e=`<h6 class='text-muted'>${a}</h6>`,e+=`<table class='table table-striped w-auto'><tbody>${s}</tbody></table>`,s?e:""}_getRows(){return gt(this,St).map((t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map((t=>{const e=this._getProperties(t);return e?`<a data-bs-toggle="tooltip" title="${e}">${t}</a>`:t})).join("<br>")}</td></tr>`))}_getText(){const t=this._getRows(),e=(0,ft.xp)(t,2);let a="";for(const t of Array.from({length:e.length}).keys())a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm table-striped table-hover text-table text-start"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_ingredientListSelected(){const t=gt(this,kt).outputSel;t.select("div").remove(),t.append("div").attr("class","row").html(this._getText());Array.prototype.slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(t){return new(bt())(t,{html:!0,placement:"auto",sanitize:!1})}))}}var Dt=a(6400),Lt=a(5619),It=a(4332);function At(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,jt(t,e,"get"))}function Pt(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,jt(t,e,"set"),a),a}function jt(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const Ct=Lt.Z.bind(Dt.h);var Ot=new WeakMap,Et=new WeakMap,Rt=new WeakMap,Nt=new WeakMap,Zt=new WeakMap,qt=new WeakMap,Bt=new WeakMap,Ft=new WeakMap,Kt=new WeakMap,Vt=new WeakMap,Ht=new WeakMap,zt=new WeakMap;class Ut{constructor(){Ot.set(this,{writable:!0,value:{}}),Et.set(this,{writable:!0,value:new Map}),Rt.set(this,{writable:!0,value:void 0}),Nt.set(this,{writable:!0,value:new Map}),Zt.set(this,{writable:!0,value:{}}),qt.set(this,{writable:!0,value:0}),Bt.set(this,{writable:!0,value:""}),Ft.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:"List of loot and chests"}),Vt.set(this,{writable:!0,value:void 0}),Ht.set(this,{writable:!0,value:new Set(["chest","fish","loot"])}),zt.set(this,{writable:!0,value:It.tJ}),Pt(this,Ft,(0,r.MF)(At(this,Kt))),Pt(this,Vt,`menu-${At(this,Ft)}`),this._setupListener()}static _printAmount(t){return t.min===t.max?(0,o.yI)(t.min):`${(0,o.yI)(t.min)} – ${(0,o.yI)(t.max)}`}static _printChance(t){return(0,o.yI)(100*(1-t))}async _loadAndSetupData(){const t=(await a.e(393).then(a.t.bind(a,3742,19))).default;for(const e of At(this,zt))At(this,Ot)[e]=t[e]}async _menuClicked(){(0,i.KS)("Tools",At(this,Kt)),At(this,Rt)?At(this,Rt).show():(await this._loadAndSetupData(),Pt(this,Rt,new h.Z(At(this,Kt),"md")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${At(this,Vt)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getTypeOptions(t){return At(this,Ot)[t].sort((0,n.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name}</option>`)).join("")}_setOptionItems(t,e,a){const s=new Map([[t.id,{id:t.id,name:t.name,chance:a,amount:e.amount}]]);At(this,Nt).set(e.id,{name:e.name,sources:At(this,Nt).has(e.id)?new Map([...At(this,Nt).get(e.id).sources,...s]):s})}_getItemsOptions(){for(const t of[...At(this,Ot).loot,...At(this,Ot).fish]){const{items:e}=t;for(const a of e)this._setOptionItems(t,a,a.chance)}for(const t of At(this,Ot).chest)for(const e of t.itemGroup){const{chance:a,items:s}=e;for(const e of s)this._setOptionItems(t,e,a)}return Pt(this,Et,new Map([...At(this,Nt).entries()].sort(((t,e)=>t[1].name.localeCompare(e[1].name))))),[...At(this,Et)].map((t=>`<option value="${t[0]}">${t[1].name}</option>`)).join("")}_getOptions(t){let e="";return At(this,Ht).has(t)?e=this._getTypeOptions(t):"item"===t&&(e=this._getItemsOptions()),e}_setupSelect(){At(this,Rt).selectsSel.attr("class","d-flex flex-wrap mb-3");for(const t of At(this,zt)){const e={dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:`Select ${"loot"===t?"ship loot":"fish"===t?"fishing region":t}`,virtualScroll:!0};"item"===t&&(e.width="440px"),At(this,Zt)[t]=new d.Z(`${At(this,Ft)}-${t}`,At(this,Rt).baseIdSelects,e,this._getOptions(t))}}_setupSelectListener(){for(const t of At(this,zt))At(this,Zt)[t].select$.on("change",(()=>{Pt(this,Bt,t),this._itemSelected()}))}_getLootItemsText(t,e,a=!0){return Ct`
            <table class="table table-sm table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col" class="text-start">${e}</th>
                        ${a?Ct`<th scope="col">Chance<br />(0 − 100)</th>`:""}
                        <th scope="col">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map((t=>Ct`
                                <tr>
                                    <td class="text-start">${t.name}</td>
                                    ${a?Ct` <td>${Ut._printChance(t.chance)}</td>`:""}
                                    <td>${Ut._printAmount(t.amount)}</td>
                                </tr>
                            `))}
                </tbody>
            </table>
        `}_getSourceText(){const t=At(this,Et).get(At(this,qt));if(t){const e=[...t.sources].map((t=>t[1])).sort((0,n.MR)(["chance","name"]));return Ct`${this._getLootItemsText(e,"Source")}`}return Ct``}_getChestsText(){const t=At(this,Ot).chest.find((t=>t.id===At(this,qt)));return t?Ct`
                <p>
                    Weight ${(0,o.yI)(t.weight)} tons<br />Lifetime ${(0,o.yI)(t.lifetime)}
                    hours
                </p>
                ${t.itemGroup.map((t=>Ct` <h5>Group chance: ${Ut._printChance(t.chance)}</h5>
                        ${this._getLootItemsText(t.items.sort((0,n.MR)(["name"])),"Item",!1)}`))}
            `:Ct``}_getLootText(){const t=At(this,Ot)[At(this,Bt)].find((t=>t.id===At(this,qt)));if(t){const e=t.items.sort((0,n.MR)(["chance","name"]));return Ct`${this._getLootItemsText(e,"Item")}`}return Ct``}_getText(){return"item"===At(this,Bt)?this._getSourceText():"chest"===At(this,Bt)?this._getChestsText():this._getLootText()}_getTable(){return Ct`<div class="mt-4">${this._getText()}</div>`}_resetOtherSelects(){const t=At(this,zt).filter((t=>t!==At(this,Bt)));for(const e of t)At(this,Zt)[e].reset()}_itemSelected(){Pt(this,qt,Number(At(this,Zt)[At(this,Bt)].getValues()));const t=At(this,Rt).outputSel;this._resetOtherSelects(),(0,Dt.sY)(this._getTable(),t.node())}}var Qt=a(393);function Jt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Yt(t,e,"get"))}function Gt(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Yt(t,e,"set"),a),a}function Yt(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Xt=new WeakMap,te=new WeakMap,ee=new WeakMap,ae=new WeakMap,se=new WeakMap,ie=new WeakMap;class ne{constructor(){Xt.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:"List of modules"}),ee.set(this,{writable:!0,value:void 0}),ae.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:{}}),ie.set(this,{writable:!0,value:{}}),Gt(this,Xt,(0,r.MF)(Jt(this,te))),Gt(this,ee,`menu-${Jt(this,Xt)}`),this._setupListener()}async _loadAndSetupData(){Gt(this,ie,(await a.e(303).then(a.t.bind(a,5472,19))).default)}async _menuClicked(){(0,i.KS)("Tools",Jt(this,te)),Jt(this,ae)?Jt(this,ae).show():(await this._loadAndSetupData(),Gt(this,ae,new h.Z(Jt(this,te),"xl")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${Jt(this,ee)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${Jt(this,ie).map((t=>`<option value="${t[0]}">${t[0]}</option>`)).join("")}`}_setupSelect(){Gt(this,se,new d.Z(Jt(this,Xt),Jt(this,ae).baseIdSelects,{noneSelectedText:"Select module category",width:"fit"},this._getOptions()))}_setupSelectListener(){Jt(this,se).select$.on("change",(()=>{this._moduleSelected()}))}_getRows(t){const e=new Map([["L",`${(0,Qt.hi)(1)} – ${(0,Qt.hi)(3)}`],["M",`${(0,Qt.hi)(4)} – ${(0,Qt.hi)(5)}`],["S",`${(0,Qt.hi)(6)} – ${(0,Qt.hi)(7)}`]]),a=t=>"U"===t?"":`${e.get(t)??""}`,s=(t,e)=>void 0!==e&&t.name===e.name&&JSON.stringify(t.properties)===JSON.stringify(e.properties);let i="";const r=[];for(const e of Jt(this,ie))if(e[0]===t)for(const[t,l]of e[1].sort((0,n.MR)(["name"])).entries())i=a(l.moduleLevel),s(l,e[1][t+1])&&(e[1][t+1].hasSamePropertiesAsPrevious=!0,i+=`<br>${a(e[1][t+1].moduleLevel)}`),s(l,e[1][t+2])&&(e[1][t+2].hasSamePropertiesAsPrevious=!0,i=""),void 0!==l.hasSamePropertiesAsPrevious&&l.hasSamePropertiesAsPrevious||r.push(`<tr><td class="pe-2">${l.name}<br>${i}</td><td><table class="table table-sm table-hover text-table text-start mb-0"><tbody>${l.properties.map((t=>{let e;return e=t.isPercentage?(0,o.QO)(t.amount/100):t.amount<1&&t.amount>0?(0,o.nM)(t.amount,1):(0,o.IH)(t.amount),`<tr><td>${t.modifier}</td><td>${e}</td></tr>`})).join("")}</tbody></table></td></tr>`);return r}_getText(t){const e=this._getRows(t),a=(0,ft.xp)(e,3);let s="";for(const t of Array.from({length:a.length}).keys())s+=`<div class="col-md-${Math.floor(12/a.length)}">`,s+='<table class="table table-sm table-striped table-hover text-table text-start"><thead>',s+='<tr><th class="pe-2">Module</th><th>Modifier</th></tr></thead><tbody>',s+=a[t].join(""),s+="</tbody></table></div>";return s}_moduleSelected(){const t=String(Jt(this,se).getValues()),e=Jt(this,ae).outputSel;e.select("div").remove(),e.append("div").classed("row mt-4",!0).html(this._getText(t))}}var re=a(285),oe=a.n(re);function le(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function he(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ce(t,e,"get"))}function de(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ce(t,e,"set"),a),a}function ce(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}F().extend(oe()),F().extend(V()),F().extend(z()),F().locale("en-gb");var ue=new WeakMap,pe=new WeakMap,me=new WeakMap,we=new WeakMap,ve=new WeakMap,be=new WeakMap,fe=new WeakMap,ge=new WeakMap,_e=new WeakMap,ye=new WeakMap,Se=new WeakMap;class ke{constructor(t){ue.set(this,{writable:!0,value:[]}),pe.set(this,{writable:!0,value:void 0}),me.set(this,{writable:!0,value:{}}),we.set(this,{writable:!0,value:!0}),ve.set(this,{writable:!0,value:0}),be.set(this,{writable:!0,value:{}}),fe.set(this,{writable:!0,value:void 0}),ge.set(this,{writable:!0,value:void 0}),_e.set(this,{writable:!0,value:"List of port battles"}),ye.set(this,{writable:!0,value:void 0}),Se.set(this,{writable:!0,value:void 0}),le(this,"_compareTime",((t,e,a)=>t[4].localeCompare(e[4])*a)),le(this,"_getNationSortName",(t=>{var e,a;const s=(null===(e=/flag-icon-(\w{2})/.exec(t))||void 0===e?void 0:e[1])??"";return(null===(a=(0,n.$i)(s))||void 0===a?void 0:a.sortName)??""})),de(this,Se,t),de(this,ge,(0,r.MF)(he(this,_e))),de(this,ye,`menu-${he(this,ge)}`),de(this,fe,`${he(this,ge)}-table`),this._setupListener()}async _loadAndSetupData(){const t=await(0,r.qP)(`${he(this,Se)}-pb.json`);de(this,ue,t.filter((t=>1===t.attackHostility)).map((t=>{var e,a;const s=F().utc(t.portBattle).local(),i=F().utc(t.portBattle),r=i===s?"":` (${s.format("H.mm")} local)`,o=`<span class="flag-icon-${t.nation} flag-icon-small me-1" role="img" title="${(null===(e=(0,n.$i)(t.nation))||void 0===e?void 0:e.sortName)??""}"></span>`,l=t.capturer&&"RAIDER"!==t.capturer?`${(0,ft.Mo)(t.capturer)}`:"",h=`<span class="flag-icon-${t.attackerNation} flag-icon-small me-1" role="img" title="${(null===(a=(0,n.$i)(t.attackerNation))||void 0===a?void 0:a.sortName)??""}"></span>`,d=`${(0,ft.Mo)((null==t?void 0:t.attackerClan)??"")}`;return{sort:t.portBattle??"",data:[`${(0,n.fm)(i.fromNow())} at ${i.format("H.mm")} ${r}`,t.name,h+d,o+l,i.toISOString()]}})))}async _menuClicked(){(0,i.KS)("Tools",he(this,_e)),he(this,pe)?he(this,pe).show():(await this._loadAndSetupData(),de(this,pe,new h.Z(he(this,_e),"lg")),this._pbListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${he(this,ye)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){e&&he(this,ve)===t&&de(this,we,!he(this,we)),de(this,ve,t);const a=he(this,we)?1:-1;he(this,me).sort(((e,s)=>{if(0===t)return this._compareTime(e.data,s.data,a);const i=this._getNationSortName(e.data[t]),n=this._getNationSortName(s.data[t]);let r=i.localeCompare(n)*a;return 1===t||0===r&&(r=this._compareTime(e.data,s.data,1)),r}))}_initTable(){he(this,be).append("thead").append("tr").selectAll("th").data(["Time","Port","Attacker","Defender"]).join("th").datum(((t,e)=>({data:t,index:e}))).attr("scope","col").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),he(this,be).append("tbody")}_updateTable(){de(this,me,he(this,be).select("tbody").selectAll("tr").data(he(this,ue),(t=>t.sort)).join((t=>t.append("tr")))),he(this,me).selectAll("td").data((t=>t.data.slice(0,-1))).join((t=>t.append("td").html((t=>t))))}_pbListSelected(){de(this,be,he(this,pe).outputSel.append("table").attr("class","table table-sm table-striped table-hover text-table table-sort")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}}var $e=a(155);function Me(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,We(t,e,"get"))}function xe(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,We(t,e,"set"),a),a}function We(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Te=new WeakMap,De=new WeakMap,Le=new WeakMap,Ie=new WeakMap,Ae=new WeakMap,Pe=new WeakMap,je=new WeakMap,Ce=new WeakMap,Oe=new WeakMap,Ee=new WeakMap,Re=new WeakMap,Ne=new WeakMap,Ze=new WeakMap;class qe{constructor(t){Te.set(this,{writable:!0,value:void 0}),De.set(this,{writable:!0,value:"List of port bonuses"}),Le.set(this,{writable:!0,value:void 0}),Ie.set(this,{writable:!0,value:void 0}),Ae.set(this,{writable:!0,value:void 0}),Pe.set(this,{writable:!0,value:[]}),je.set(this,{writable:!0,value:[]}),Ce.set(this,{writable:!0,value:[]}),Oe.set(this,{writable:!0,value:[]}),Ee.set(this,{writable:!0,value:{}}),Re.set(this,{writable:!0,value:!0}),Ne.set(this,{writable:!0,value:0}),Ze.set(this,{writable:!0,value:{}}),xe(this,Ae,t),xe(this,Te,(0,r.MF)(Me(this,De))),xe(this,Le,`menu-${Me(this,Te)}`),"eu1"===t?this._setupListener():this._removeMenu()}_removeMenu(){document.querySelector(`#${Me(this,Le)}`).remove()}async _loadData(){xe(this,Pe,await(0,r.qP)(`${Me(this,Ae)}-ports.json`)),xe(this,Ce,await(0,r.qP)(`${Me(this,Ae)}-pb.json`)),xe(this,je,(await a.e(462).then(a.t.bind(a,6841,19))).default)}_setupData(){const t=[0,1,3,7,15],e={};for(const t of It.y7)e[t]=0;const a=new Map(Me(this,je).map((t=>[t.id,{name:t.name,points:t.portPoints}]))),s=new Map(Me(this,Ce).map((t=>[t.id,t.nation])));xe(this,Oe,Me(this,Pe).filter((t=>t.portBonus)).map((i=>{var n,r;return{id:i.id,name:(null===(n=a.get(i.id))||void 0===n?void 0:n.name)??"",nation:s.get(i.id)??"",portBonusLevel:Object.values({...e,...i.portBonus}),points:(null===(r=a.get(i.id))||void 0===r?void 0:r.points)??0,pointsInvested:(0,$e.Z)(Object.values(i.portBonus).map((e=>t[e])))}})))}async _loadAndSetupData(){await this._loadData(),this._setupData()}async _menuClicked(){(0,i.KS)("Tools",Me(this,De)),Me(this,Ie)?Me(this,Ie).show():(await this._loadAndSetupData(),xe(this,Ie,new h.Z(Me(this,De),"lg")),this._listSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${Me(this,Le)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){e&&Me(this,Ne)===t&&xe(this,Re,!Me(this,Re)),xe(this,Ne,t);const a=Me(this,Re)?1:-1;Me(this,Ee).sort(((e,s)=>{if(0===t)return e.name.localeCompare(s.name)*a;if(1===t){var i,r;const t=(null===(i=(0,n.$i)(e.nation))||void 0===i?void 0:i.sortName)??"",o=(null===(r=(0,n.$i)(s.nation))||void 0===r?void 0:r.sortName)??"";return t.localeCompare(o)*a}return 7===t?(e.points-s.points)*a:8===t?(e.pointsInvested-s.pointsInvested)*a:(e.portBonusLevel[t-2]-s.portBonusLevel[t-2])*a}))}_initTable(){xe(this,Re,!0),Me(this,Ze).append("thead").append("tr").selectAll("th").data(["Port","Nation",...It.y7,"Port points","Points invested"]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>e<=1)).attr("scope","col").style("width",((t,e)=>e>=2?"4rem":"")).text((t=>(0,n.fm)(t.data))).on("click",((t,e)=>{this._sortRows(e.index)})),Me(this,Ze).append("tbody")}_updateTable(){xe(this,Ee,Me(this,Ze).select("tbody").selectAll("tr").data(Me(this,Oe),(t=>t.id)).join((t=>t.append("tr")))),Me(this,Ee).selectAll("td").data((t=>[t.name,t.nation,...t.portBonusLevel,t.points,t.pointsInvested])).join((t=>t.append("td").classed("text-start",((t,e)=>e<=1)).html(((t,e)=>{var a;return 0===t?"":1===e?`<span class="flag-icon-${String(t)} flag-icon-small" role="img" title="${(null===(a=(0,n.$i)(String(t)))||void 0===a?void 0:a.sortName)??""}"></span>`:String(t)}))))}_listSelected(){xe(this,Ze,Me(this,Ie).outputSel.append("table").attr("class","table table-sm small table-striped table-hover table-sort")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}}var Be=a(4017),Fe=a(1460);function Ke(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,He(t,e,"get"))}function Ve(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,He(t,e,"set"),a),a}function He(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const ze=(t,e,a)=>`${(0,Qt.hi)(e)} – ${(0,Qt.hi)(a)}`;var Ue=new WeakMap,Qe=new WeakMap,Je=new WeakMap,Ge=new WeakMap,Ye=new WeakMap,Xe=new WeakMap,ta=new WeakMap,ea=new WeakMap,aa=new WeakMap;class sa{constructor(t){Ue.set(this,{writable:!0,value:void 0}),Qe.set(this,{writable:!0,value:"List of admiralty items and recipes"}),Je.set(this,{writable:!0,value:void 0}),Ge.set(this,{writable:!0,value:void 0}),Ye.set(this,{writable:!0,value:void 0}),Xe.set(this,{writable:!0,value:{}}),ta.set(this,{writable:!0,value:[]}),ea.set(this,{writable:!0,value:[]}),aa.set(this,{writable:!0,value:void 0}),Ve(this,Ge,(0,Fe.Oy)(t)),Ve(this,Ue,(0,r.MF)(Ke(this,Qe))),Ve(this,Je,`menu-${Ke(this,Ue)}`),this._setupListener()}async _loadAndSetupData(){Ve(this,ta,(await a.e(303).then(a.t.bind(a,5472,19))).default),Ve(this,ea,(await a.e(757).then(a.t.bind(a,3727,19))).default.recipe),Ve(this,aa,new Map(Ke(this,ea).flatMap((t=>t.recipes.map((t=>[t.id,t]))))))}async _menuClicked(){(0,i.KS)("Tools",Ke(this,Qe)),Ke(this,Ye)?Ke(this,Ye).show():(await this._loadAndSetupData(),Ve(this,Ye,new h.Z(Ke(this,Qe),"lg")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${Ke(this,Je)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return Ke(this,ea).map((t=>`<optgroup label="${t.group}">${t.recipes.filter((t=>"Any"===t.serverType||t.serverType===Ke(this,Ge))).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,ze)}</option>`)).join("")}</optgroup>`)).join("")}_setupSelect(){Ve(this,Xe,new d.Z(Ke(this,Ue),Ke(this,Ye).baseIdSelects,{dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0,width:"fit"},this._getOptions())),(0,Be.Z)(`#${Ke(this,Ye).baseIdSelects} label`).attr("class","text-muted ps-2").text("Items listed here may not be available in the game (yet).")}_setupSelectListener(){Ke(this,Xe).select$.on("change",(()=>{this._recipeSelected()}))}_getRecipeData(t){return Ke(this,aa).get(t)}_getRequirementText(t){let e='<table class="table table-sm table-hover text-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${(0,l.PK)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`${t.itemRequirements.map((t=>`<tr><td>${t.amount} ${t.name}</td></tr>`)).join("")}`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",s="";for(const e of Ke(this,ta)){const i=e[1].filter((e=>e.id===t.result.id));for(const t of i)[a]=e,s=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?(0,o.QO)(t.amount/100):t.amount;return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return s?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm table-hover text-table"><tbody>${s}</tbody></table>`):e+=`<p>${(0,o.yI)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="card-group">';return a+='<div class="card"><div class="card-body">',a+='<h5 class="card-title">Item</h5>',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card"><div class="card-body">',a+='<h5 class="card-title">Result</h5>',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(){const t=Number(Ke(this,Xe).getValues()),e=Ke(this,Ye).outputSel;e.select("div").remove(),e.append("div").classed("mt-4",!0).html(this._getText(t))}}function ia(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ra(t,e,"get"))}function na(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ra(t,e,"set"),a),a}function ra(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var oa=new WeakMap,la=new WeakMap,ha=new WeakMap,da=new WeakMap,ca=new WeakMap,ua=new WeakMap,pa=new WeakMap,ma=new WeakMap,wa=new WeakMap;class va{constructor(){oa.set(this,{writable:!0,value:void 0}),la.set(this,{writable:!0,value:{}}),ha.set(this,{writable:!0,value:[]}),da.set(this,{writable:!0,value:!0}),ca.set(this,{writable:!0,value:0}),ua.set(this,{writable:!0,value:{}}),pa.set(this,{writable:!0,value:void 0}),ma.set(this,{writable:!0,value:"List of ships"}),wa.set(this,{writable:!0,value:void 0}),na(this,pa,(0,r.MF)(ia(this,ma))),na(this,wa,`menu-${ia(this,pa)}`),this._setupListener()}async _loadAndSetupData(){const t=(await a.e(228).then(a.t.bind(a,845,19))).default.sort((0,n.MR)(["class","-battleRating","name"]));na(this,ha,t.map((t=>[[t.class,String(t.class)],[t.name,(0,l.Y8)(t.name)],[t.guns.total,String(t.guns.total)],[t.guns.damage.cannons,(0,o.yI)(t.guns.damage.cannons)],[t.battleRating,(0,o.yI)(t.battleRating)],[t.crew.max,(0,o.yI)(t.crew.max)],[t.ship.maxSpeed,(0,o.QM)(t.ship.maxSpeed,1)],[t.ship.turnSpeed,(0,o.QM)(t.ship.turnSpeed,1)],[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4].amount?String(t.guns.gunsPerDeck[4].amount):""],[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5].amount?String(t.guns.gunsPerDeck[5].amount):""],[t.sides.armour,`${(0,o.yI)(t.sides.armour)} <span class="badge badge-highlight">${t.sides.thickness}</span>`]])))}async _menuClicked(){(0,i.KS)("Tools",ia(this,ma)),ia(this,oa)?ia(this,oa).show():(await this._loadAndSetupData(),na(this,oa,new h.Z(ia(this,ma),"lg")),this._shipListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${ia(this,wa)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){e&&ia(this,ca)===t&&na(this,da,!ia(this,da)),na(this,ca,t);const a=ia(this,da)?1:-1;ia(this,la).sort(((e,s)=>1===t?e[t][0].localeCompare(s[t][0])*a:(e[t][0]-s[t][0])*a))}_initTable(){const t={group:new Map([["dummy1",2],["Guns",2],["dummy2",1],["Speed",2],["dummy3",1],["Chasers",2],["dummy4",1]]),element:new Set(["","Name","No.","Damage","<span class='caps'>br</span>","Crew","Max","Turn","Bow","Stern","Sides"])},e=ia(this,ua).append("thead");e.append("tr").attr("class","thead-group").selectAll("th").data([...t.group]).join("th").classed("border-bottom-0",(t=>t[0].startsWith("dummy"))).classed("text-center",!0).attr("colspan",(t=>t[1])).attr("scope","col").text((t=>t[0].startsWith("dummy")?"":t[0])),e.append("tr").selectAll("th").data([...t.element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>1===e)).classed("pe-1",((t,e)=>1!==e)).html((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),ia(this,ua).append("tbody")}_updateTable(){na(this,la,ia(this,ua).select("tbody").selectAll("tr").data(ia(this,ha),(t=>t[1][0])).join((t=>t.append("tr")))),ia(this,la).selectAll("td").data((t=>t)).join((t=>t.append("td").classed("pe-1",((t,e)=>1!==e)).classed("text-start",((t,e)=>1===e)).html((t=>t[1]))))}_shipListSelected(){na(this,ua,ia(this,oa).outputSel.append("table").attr("class","table table-sm table-striped table-hover table-sort")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}}var ba=a(4695);function fa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_a(t,e,"get"))}function ga(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,_a(t,e,"set"),a),a}function _a(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const ya=["Resources","Extra","Materials"];var Sa=new WeakMap,ka=new WeakMap,$a=new WeakMap,Ma=new WeakMap,xa=new WeakMap,Wa=new WeakMap,Ta=new WeakMap,Da=new WeakMap,La=new WeakMap,Ia=new WeakMap,Aa=new WeakMap,Pa=new WeakMap,ja=new WeakMap;class Ca{constructor(){var t,e,a;Sa.set(this,{writable:!0,value:void 0}),ka.set(this,{writable:!0,value:[]}),$a.set(this,{writable:!0,value:{}}),Ma.set(this,{writable:!0,value:{}}),xa.set(this,{writable:!0,value:{}}),Wa.set(this,{writable:!0,value:void 0}),Ta.set(this,{writable:!0,value:{}}),Da.set(this,{writable:!0,value:{}}),La.set(this,{writable:!0,value:{}}),Ia.set(this,{writable:!0,value:{}}),Aa.set(this,{writable:!0,value:void 0}),Pa.set(this,{writable:!0,value:"List of ship blueprints"}),ja.set(this,{writable:!0,value:void 0}),a=t=>{var e;return(null===(e=fa(this,Ma).wood.find((e=>e.name===t)))||void 0===e?void 0:e.amount)??0},(e="_getResourceAmount")in(t=this)?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,ga(this,Aa,(0,r.MF)(fa(this,Pa))),ga(this,ja,`menu-${fa(this,Aa)}`),this._setupListener()}async _setupWoodData(){ga(this,Ia,new ba.J(fa(this,Aa))),await fa(this,Ia).init()}async _loadAndSetupData(){ga(this,ka,(await a.e(263).then(a.t.bind(a,9395,19))).default);const t=(await a.e(263).then(a.t.bind(a,1579,19))).default;ga(this,xa,new Map(t.standard.map((t=>[t.name,{reales:t.reales,labour:(null==t?void 0:t.labour)??0}])))),ga(this,$a,new Map(t.seasoned.map((t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}])))),await this._setupWoodData()}async _menuClicked(){(0,i.KS)("Tools",fa(this,Pa)),fa(this,Wa)?fa(this,Wa).show():(await this._loadAndSetupData(),ga(this,Wa,new h.Z(fa(this,Pa),"lg")),this._setupSelects(),this._setupShipSelectListener(),this._setupWoodSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${fa(this,ja)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${fa(this,ka).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupShipSelect(){ga(this,Ta,new d.Z(fa(this,Aa),fa(this,Wa).baseIdSelects,{noneSelectedText:"Select blueprint"},this._getOptions()))}_setupWoodSelects(){for(const t of It.Kf){const e={noneSelectedText:`Select ${t}`};fa(this,Da)[t]=new d.Z(`${fa(this,Aa)}-wood-${t}`,fa(this,Wa).baseIdSelects,e,fa(this,Ia).getOptions(t)),fa(this,Da)[t].disable()}}_setupSelects(){fa(this,Wa).selectsSel.attr("class","d-flex justify-content-between"),this._setupShipSelect(),this._setupWoodSelects()}_enableWoodSelects(){for(const t of It.Kf)fa(this,Da)[t].enable()}_setDefaultWoods(){const t={frame:fa(this,Ia).findWoodId("frame","Fir"),trim:fa(this,Ia).findWoodId("trim","Crew Space")};for(const e of It.Kf)fa(this,Da)[e].reset(t[e])}_setupShipSelectListener(){fa(this,Ta).select$.one("change",(()=>{this._enableWoodSelects(),this._setDefaultWoods(),this._initOutput()})).on("change",(()=>{ga(this,Sa,String(fa(this,Ta).getValues())),ga(this,Ma,this._getBlueprintData(fa(this,Sa))),this._updateText()}))}_setupWoodSelectListener(){for(const t of It.Kf)fa(this,Da)[t].select$.on("change",(()=>{this._updateText()}))}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join((t=>t.append("tr"))).selectAll("td").data((t=>t)).join((t=>t.append("td"))).classed("text-start",((t,e)=>0===e)).html((t=>t))}_updateText(){let t=fa(this,Ma).resources.map((t=>[t.name,t.amount]));const e=e=>t.findIndex((t=>t[0]===e))??0,a=fa(this,Ia).getWoodName(Number(fa(this,Da).trim.getValues())),s=fa(this,Ia).getWoodName(Number(fa(this,Da).frame.getValues()));let i=!1,n=!1,r=0,l=0;if("Crew Space"===a){const a=this._getResourceAmount("Crew Space"),s=e("Hemp");t[s][1]=t[s][1]+a}else if(l=this._getResourceAmount("Planking"),a===s)r+=l;else{const s=e(a);s>=0?t[s][1]=t[s][1]+l:(n=!0,t.push([a,l]))}r+=this._getResourceAmount("Frame");const h=e(s);if(h>=0?t[h][1]=t[h][1]+r:(i=!0,t.push([s,r])),i&&n){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let d=[];fa(this,Ma).price&&d.push(["Reales",fa(this,Ma).price]),d.push(["Provisions",fa(this,Ma).provisions]),fa(this,Ma).permit&&d.push(["Permit",fa(this,Ma).permit]),d.push(["Craft level",fa(this,Ma).craftLevel],["Shipyard level",fa(this,Ma).shipyardLevel],["Labour hours",fa(this,Ma).labourHours],["Craft experience",fa(this,Ma).craftXP]);const c=[];let u=0,p=0;const m=t=>{var e;return((null===(e=fa(this,xa).get(t[0]))||void 0===e?void 0:e.reales)??0)*t[1]},w=t=>{var e;return((null===(e=fa(this,xa).get(t[0]))||void 0===e?void 0:e.labour)??0)*t[1]},v=t=>{for(const e of t.filter((t=>fa(this,xa).has(t[0]))))u+=m(e),p+=w(e)};v(t),v(d),u&&c.push(["Reales",(0,o.yI)(u)],["Labour hours",(0,o.yI)(p)]);let b=0,f=0,g=0,_=0;for(const t of It.Kf){const e=fa(this,$a).get(String(fa(this,Da)[t].getValues()));e&&(b+=(e.reales??0)*r,f+=(e.labour??0)*r,g+=(e.doubloon??0)*r,_+=(e.tool??0)*r)}b&&c.push(["(S) reales",(0,o.yI)(b)]),f&&c.push(["(S) labour hours",(0,o.yI)(f)]),g&&c.push(["(S) doubloons",(0,o.yI)(g)]),_&&c.push(["(S) tools",(0,o.yI)(_)]),t=t.map((t=>[t[0],(0,o.yI)(t[1])])),d=d.map((t=>[t[0],(0,o.yI)(t[1])])),this._updateTable(fa(this,La).Resources,t),this._updateTable(fa(this,La).Extra,d),this._updateTable(fa(this,La).Materials,c)}_getBlueprintData(t){return fa(this,ka).find((e=>e.name===t))??{}}_initOutput(){const t=fa(this,Wa).outputSel.append("div").attr("class","card-group mt-3"),e=e=>{const a=t.append("div").attr("class","card").append("div").attr("class","card-body");a.append("h5").attr("class","card-title").text(e),fa(this,La)[e]=a.append("table").attr("class","table table-sm table-striped table-hover"),fa(this,La)[e].append("thead"),fa(this,La)[e].append("tbody")};for(const t of ya)e(t)}}function Oa(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ea(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Na(t,e,"get"))}function Ra(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Na(t,e,"set"),a),a}function Na(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Za=new WeakMap,qa=new WeakMap,Ba=new WeakMap,Fa=new WeakMap,Ka=new WeakMap;class Va{constructor(){Za.set(this,{writable:!0,value:void 0}),qa.set(this,{writable:!0,value:void 0}),Ba.set(this,{writable:!0,value:"List of woods"}),Fa.set(this,{writable:!0,value:void 0}),Ka.set(this,{writable:!0,value:void 0}),Oa(this,"_modifiers",{}),Oa(this,"_rows",{}),Oa(this,"_sortAscending",{}),Oa(this,"_sortIndex",{}),Oa(this,"_switchesSel",void 0),Oa(this,"_tables",{}),Oa(this,"_woodData",{}),Oa(this,"_woodDataDefault",{}),Oa(this,"_modifiersNotUsed",new Set(["Ship material","Boarding morale"])),Ra(this,qa,(0,r.MF)(Ea(this,Ba))),Ra(this,Ka,`menu-${Ea(this,qa)}`),Ra(this,Fa,`checkbox-${Ea(this,qa)}`),this._setupListener()}async _menuClicked(){(0,i.KS)("Tools",Ea(this,Ba)),Ea(this,Za)?Ea(this,Za).show():(await this._loadAndSetupData(),Ra(this,Za,new h.Z(Ea(this,Ba),"xl")),this._injectBody(),this._woodFamilySelected())}_setupListener(){var t;null===(t=document.querySelector(`#${Ea(this,Ka)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getModifiers(t){const e=new Set;for(const a of this._woodDataDefault[t])for(const t of a.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))))e.add(t.modifier);return[...e].sort(n.I4)}async _loadData(){this._woodDataDefault=(await a.e(799).then(a.t.bind(a,4770,19))).default}_setupData(){for(const t of It.Kf){this._modifiers[t]=new Set(this._getModifiers(t));for(const e of this._woodDataDefault[t]){const a=new Set(e.properties.map((t=>t.modifier)));for(const s of this._modifiers[t])a.has(s)||e.properties.push({modifier:s,amount:0,isPercentage:!1});e.properties.sort(((t,e)=>t.modifier.localeCompare(e.modifier)))}}this._woodData={...this._woodDataDefault}}async _loadAndSetupData(){await this._loadData(),this._setupData()}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const s=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t.name.localeCompare(a.name)*s:(t.properties[e-1].amount-a.properties[e-1].amount)*s))}_initTable(t){this._sortAscending[t]=!0,this._tables[t].append("thead").append("tr").selectAll("th").data(["Wood",...this._modifiers[t]]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>0===e)).attr("role","columnheader").html((t=>t.data.replace(" ","<br>"))).on("click",((e,a)=>{this._sortRows(t,a.index)})),this._tables[t].append("tbody")}_injectBody(){const t=Ea(this,Za).outputSel,e=t.append("div").attr("class","mb-3");for(const t of It.pe){const a=e.append("div").attr("class","form-check form-check-inline form-switch");a.append("input").attr("id",`${Ea(this,Fa)}-${t}`).attr("name",`${Ea(this,Fa)}`).attr("class","form-check-input").attr("type","checkbox").property("checked",!0),a.append("label").attr("for",`${Ea(this,Fa)}-${t}`).attr("class","form-check-label").text((0,n.fm)(t))}this._switchesSel=[...document.querySelectorAll(`input[name=${Ea(this,Fa)}]`)];for(const t of this._switchesSel)t.addEventListener("change",(t=>{t.preventDefault(),this._woodFamilySelected()}));for(const e of It.Kf)t.append("h5").text((0,n.fm)(`${e}s`)),this._tables[e]=t.append("table").attr("class","table table-sm table-striped table-hover table-sort"),this._initTable(e),this._updateTable(e),this._sortRows(e,0,!1)}_getFormattedAmount(t){let e;return e="Repair amount"===t.modifier&&t.amount?(0,o.nM)(t.amount,1):t.amount?(0,o.QM)(t.amount):"",e}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._woodData[t],(t=>t.id)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>[t.name,...t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).map((t=>this._getFormattedAmount(t)))])).join((t=>t.append("td").classed("text-start",((t,e)=>0===e)).html((t=>t))))}_woodFamilySelected(){const t=new Set;for(const e of this._switchesSel)if(e.checked){const a=e.id.replace(`${Ea(this,Fa)}-`,"");t.add(a)}for(const e of It.Kf)this._woodData[e]=this._woodDataDefault[e].filter((e=>t.has(e.family))),this._updateTable(e),this._sortRows(e,this._sortIndex[e],!1)}}var Ha=a(7622),za=a(8823),Ua=a(3657),Qa=a(7290),Ja=a(7603),Ga=a(762),Ya=a(9714),Xa=a(6377),ts=a.n(Xa);function es(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ss(t,e,"get"))}function as(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ss(t,e,"set"),a),a}function ss(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var is=new WeakMap,ns=new WeakMap,rs=new WeakMap,os=new WeakMap,ls=new WeakMap,hs=new WeakMap,ds=new WeakMap,cs=new WeakMap,us=new WeakMap,ps=new WeakMap,ms=new WeakMap,ws=new WeakMap,vs=new WeakMap,bs=new WeakMap,fs=new WeakMap;class gs{constructor(t){is.set(this,{writable:!0,value:{}}),ns.set(this,{writable:!0,value:0}),rs.set(this,{writable:!0,value:{}}),os.set(this,{writable:!0,value:{}}),ls.set(this,{writable:!0,value:void 0}),hs.set(this,{writable:!0,value:{}}),ds.set(this,{writable:!0,value:void 0}),cs.set(this,{writable:!0,value:{}}),us.set(this,{writable:!0,value:void 0}),ps.set(this,{writable:!0,value:{}}),ms.set(this,{writable:!0,value:0}),ws.set(this,{writable:!0,value:void 0}),vs.set(this,{writable:!0,value:"Net income"}),bs.set(this,{writable:!0,value:void 0}),fs.set(this,{writable:!0,value:void 0}),as(this,ds,t),as(this,ws,`show-${(0,r.MF)(es(this,vs))}`),as(this,fs,`menu-${es(this,ws)}`),as(this,bs,(0,Ja.Z)().domain(n.nU.map((t=>t.short))).range(n.nU.map((t=>t.colours[0])))),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){return Math.floor(es(this,rs).node().offsetWidth)??0}_setupData(t){const e=t.ports.map((e=>{const a=t.server.find((t=>t.id===e.id))??{},s=t.pb.find((t=>t.id===e.id))??{};return{...e,...a,...s}})),a=(0,Ha.Z)(e,(t=>t.netIncome))??0,s=(0,za.Z)(e,(t=>t.netIncome))??0;as(this,is,(0,Ga.Z)().domain([a,s]).range([8,32]).clamp(!0));const i=new Set(["NT","FT"]),r=new Set,o=[...e.filter((t=>t.netIncome>0&&!i.has(t.nation))).map((t=>(r.add(t.nation),{id:t.name,value:t.netIncome,parentId:t.nation}))),...n.nU.filter((t=>r.has(t.short))).map((t=>({id:t.short,value:0,parentId:"World"}))),{id:"World",value:0,parentId:void 0}];as(this,hs,(0,Ua.Z)()(o)),as(this,ps,(0,Qa.ZP)(es(this,hs)).sum((t=>t.data.value)))}async _loadData(){const t=[{fileName:`${es(this,ds)}-ports.json`,name:"server"},{fileName:`${es(this,ds)}-pb.json`,name:"pb"}],e={};return e.ports=(await a.e(462).then(a.t.bind(a,6841,19))).default,await(0,r.EZ)(t,e),e}async _loadAndSetupData(){(0,r.dM)();const t=await this._loadData();this._setupData(t),(0,r.V4)()}async _menuClicked(){(0,i.KS)("Tools",es(this,vs)),es(this,ls)?es(this,ls).show():(await this._loadAndSetupData(),as(this,ls,new h.Z(es(this,vs),"xl")),as(this,rs,es(this,ls).outputSel),this._initTreemap(),this._drawTreemap())}_setupListener(){var t;null===(t=document.querySelector(`#${es(this,fs)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_drawLegend(){const t=Math.floor(20*Qt.L9),e=.8*t,a=Math.floor(2*Qt.L9),s=Math.floor(5*Qt.L9),i=(es(this,ps).children??[]).sort(((t,e)=>e.value-t.value)),n=160+2*s,r=i.length*n-2*s,h=Math.ceil(r/es(this,ms)),d=Math.ceil(i.length/h),c=Math.ceil(es(this,ms)/d-2*s);es(this,rs).append("div").attr("class","d-flex flex-wrap justify-content-between mt-3").selectAll(".legend").data(i).join((i=>{const n=i.append("div").attr("class","legend mt-3"),r=n.append("svg").attr("width",c).attr("height",2*t+a);return r.append("rect").attr("width",c).attr("height",t).style("fill",(t=>es(this,bs).call(this,t.data.id))),r.append("rect").attr("x",s).attr("y","5%").attr("width",4*e/3).attr("height",e).attr("fill",(t=>`url(#${t.data.id})`)),r.append("text").attr("x",c-s).attr("y","25%").text((t=>t.data.id)).attr("class","text-end").style("fill",(t=>(0,l.IF)(es(this,bs).call(this,t.data.id)))),r.append("rect").attr("class","opacity-low").attr("y",t+a).attr("width",c).attr("height",t).style("fill",(t=>es(this,bs).call(this,t.data.id))),r.append("rect").attr("y",t+a).attr("width",(t=>{var e;return c*(t.value/((null===(e=t.parent)||void 0===e?void 0:e.value)??1))})).attr("height",t).style("fill",(t=>es(this,bs).call(this,t.data.id))),r.append("text").attr("x",c-s).attr("y","75%").html((t=>(0,o.Dw)(t.value,!0))).style("text-anchor","end"),n}))}_getTooltipText(t){var e,a,s,i,n;return`\n            <div class="d-flex justify-content-between align-items-center">\n            <div class="d-flex flex-column text-start mt-1 me-3 p-0">\n                <div><i class="flag-icon-${null===(e=t.parent)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.id} flag-icon-small me-2" role="img"></i><span class="x-large">${t.data.id??""}</span></div>\n            </div>\n            <div class="d-flex flex-column text-start mt-1 p-0">\n                <div class="me-3">\n                    ${(0,o.Dw)(t.data.data.value)}<br />\n                    <span class="des">Port</span>\n                </div>\n                <div class="me-3">\n                    ${(0,o.me)(t.data.data.value/((null===(s=t.parent)||void 0===s?void 0:s.value)??1))}<br />\n                    <span class="des">Nation</span>\n                </div>\n                <div class="me-3">\n                    ${(0,o.me)(t.data.data.value/((null===(i=t.parent)||void 0===i||null===(n=i.parent)||void 0===n?void 0:n.value)??1))}<br />\n                    <span class="des">World</span>\n                </div>\n            </div>\n            </div>`}_hideDetails(){void 0!==es(this,us)&&(es(this,us).dispose(),as(this,us,void 0))}_showDetails(t,e){const a=t.currentTarget;this._hideDetails(),as(this,us,new(bt())(a,{html:!0,template:'<div class="tooltip  bs-tooltip-top" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-smaller"></div></div>',title:this._getTooltipText(e),trigger:"manual",sanitize:!1})),es(this,us).show()}_drawCells(t){es(this,os).append("g").attr("class","cells").selectAll(".cell").data(t).join((t=>t.append("path").attr("class","cell").attr("d",(t=>`M${t.polygon.join(",")}z`)).style("fill",(t=>{var e;return es(this,bs).call(this,(null===(e=t.parent)||void 0===e?void 0:e.data.id)??"")}))))}_drawLabels(t){const e=es(this,os).append("g").attr("class","labels").selectAll(".label").data(t).join((t=>t.append("g").attr("class","label").attr("transform",(t=>`translate(${t.polygon.site.x},${t.polygon.site.y})`)).style("font-size",(t=>`${es(this,is).call(this,t.data.data.value)}px`)).style("fill",(t=>{var e;return(0,l.IF)(es(this,bs).call(this,(null===(e=t.parent)||void 0===e?void 0:e.data.id)??""))}))));e.append("text").attr("class","name").text((t=>t.data.data.id)),e.append("text").attr("class","value").html((t=>(0,o.Pj)(t.data.data.value,!0)))}_drawHover(t){es(this,os).append("g").selectAll(".hoverer").data(t).join((t=>t.append("path").attr("class","hoverer").attr("d",(t=>`M${t.polygon.join(",")}z`)).on("mouseover",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",(()=>{this._hideDetails()}))))}_drawTreemap(){const t=es(this,ps).leaves();this._drawCells(t),this._drawLabels(t),this._drawHover(t),this._drawLegend()}_initTreemap(){as(this,ns,gs.getHeight()),as(this,ms,this._getWidth()),as(this,cs,es(this,rs).append("svg").attr("class","voronoi").attr("width",es(this,ms)).attr("height",es(this,ns))),as(this,os,es(this,cs).append("g").attr("class","drawingArea")),(0,Ya.voronoiTreemap)().clip([[0,0],[0,es(this,ns)],[es(this,ms),es(this,ns)],[es(this,ms),0]]).minWeightRatio(1e-10).prng(ts()(es(this,ws)))(es(this,ps))}}var _s=a(1316),ys=a(3865),Ss=a(9374),ks=a(84),$s=a(7658),Ms=a(9766),xs=a(7633),Ws=a(7829),Ts=a(7454);function Ds(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Ls(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,As(t,e,"get"))}function Is(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,As(t,e,"set"),a),a}function As(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ps=new WeakMap,js=new WeakMap,Cs=new WeakMap,Os=new WeakMap,Es=new WeakMap,Rs=new WeakMap,Ns=new WeakMap,Zs=new WeakMap,qs=new WeakMap,Bs=new WeakMap;class Fs{constructor(t){Ps.set(this,{writable:!0,value:void 0}),js.set(this,{writable:!0,value:{}}),Cs.set(this,{writable:!0,value:void 0}),Os.set(this,{writable:!0,value:{}}),Es.set(this,{writable:!0,value:{}}),Rs.set(this,{writable:!0,value:{}}),Ns.set(this,{writable:!0,value:{}}),Zs.set(this,{writable:!0,value:void 0}),qs.set(this,{writable:!0,value:"Ownership overview"}),Bs.set(this,{writable:!0,value:void 0}),Ds(this,"_ownershipData",{}),Ds(this,"_nationData",{}),Ds(this,"_colourScale",void 0),Is(this,Cs,t),Is(this,Zs,`show-${(0,r.MF)(Ls(this,qs))}`),Is(this,Bs,`menu-${Ls(this,Zs)}`),this._colourScale=(0,Ja.Z)().range(r.q4),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){return Math.floor(Ls(this,Os).node().offsetWidth)??0}async _loadAndSetupData(){(0,r.dM)(),this._nationData=await(0,r.qP)(`${Ls(this,Cs)}-nation.json`),this._ownershipData=await(0,r.qP)(`${Ls(this,Cs)}-ownership.json`),(0,r.V4)()}async _menuClicked(){(0,i.KS)("Tools",Ls(this,qs)),Ls(this,Ps)?Ls(this,Ps).show():(await this._loadAndSetupData(),Is(this,Ps,new h.Z(Ls(this,qs),"xl")),this._setupOutput(),this._setupTextures(),this._setupSelect(),this._setupSelectListener(),this._injectArea())}_setupListener(){var t;null===(t=document.querySelector(`#${Ls(this,Bs)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_setupOutput(){Is(this,Os,Ls(this,Ps).outputSel),Is(this,Es,Ls(this,Os).append("div")),Is(this,Rs,Ls(this,Os).append("svg").attr("class","area"))}_setupTextures(){const t=["2/8","4/8","6/8"];let e=0;for(const{short:a,colours:s}of n.nU)1===s.length?Ls(this,Ns)[a]=Ts.Z.lines().stroke(s[0]).background(s[0]).id(`texture-${a}`):2===s.length?(Ls(this,Ns)[a]=Ts.Z.lines().orientation(t[e]).size(40).strokeWidth(20).stroke(s[0]).background(s[1]).id(`texture-${a}`),e=(e+1)%t.length):Ls(this,Ns)[a]=Ts.Z.circles().radius(5).strokeWidth(3).stroke(s[1]).fill(s[2]).background(s[0]).id(`texture-${a}`),Ls(this,Rs).call(Ls(this,Ns)[a])}_getOptions(){return`${this._ownershipData.map((t=>`<option value="${t.region}">${t.region}</option>;`)).join("")}`}_setupSelect(){Is(this,js,new d.Z(Ls(this,Zs),Ls(this,Ps).baseIdSelects,{noneSelectedText:"Select region"},this._getOptions()))}_setupSelectListener(){Ls(this,js).select$.on("change",(()=>{this._regionSelected()}))}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,Fs.getHeight()),a=0,s=32,i=0,o=n.nU.filter((t=>9!==t.id)).map((t=>t.short)),h=this._nationData;h.keys=o;const d=(0,$s.Z)().offset(Ms.Z).keys(o)(h);Ls(this,Rs).attr("width",t).attr("height",e),(()=>{const c=(()=>{const n=(0,Ga.Z)().domain((0,ys.Z)(h,(t=>new Date(t.date)))).range([i,t-a]),r=(0,Ga.Z)().domain([(0,Ha.Z)(d[0],(t=>t[0])),(0,za.Z)(d[d.length-1],(t=>t[1]))]).range([e-s,0]);return(0,xs.Z)().x((t=>n(new Date(t.data.date))??0)).y0((t=>r(t[0])??0)).y1((t=>r(t[1])??0)).curve(Ws.ZP)})(),u=new Map(n.nU.map((t=>[t.short,t.name])));this._colourScale.domain(o),Ls(this,Rs).selectAll("path.nation").data(d).join((t=>t.append("path").attr("class","nation").attr("fill",(t=>Ls(this,Ns)[t.key].url())).attr("stroke",r.Om).attr("stroke-width","3px").attr("d",c))),Ls(this,Rs).selectAll(".area-label").data(d).join((t=>t.append("text").attr("class","area-label text-shadow").text((t=>u.get(t.key))).attr("fill",(t=>{var e;return(0,l.IF)((null===(e=(0,n.$i)(t.key))||void 0===e?void 0:e.colours[0])??"")})).attr("transform",(0,_s.areaLabel)(c))))})(),Ls(this,Rs).append("g").call((n=>{const r=(0,ks.Z)().domain((0,ys.Z)(h,(t=>new Date(t.date)))).range([i,t-a]);n.attr("transform",`translate(0,${e-s})`).call((0,Ss.LL)(r).ticks(t/80).tickSizeOuter(0)),n.attr("font-size",".8rem").attr("font-family","")}))}async _injectChart(t){(await a.e(782).then(a.bind(a,4715))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(Ls(this,Es).node())}_regionSelected(){const t=String(Ls(this,js).getValues());Ls(this,Es).selectAll("*").remove();const e=this._ownershipData.filter((e=>e.region===t)).map((t=>t.data))[0];this._injectChart(e)}}function Ks(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Vs(t,e,"set"),a),a}function Vs(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Hs=new WeakMap;class zs extends h.Z{constructor(t,e){super(t,"xl"),Hs.set(this,{writable:!0,value:void 0}),Ks(this,Hs,e),this._init()}getBaseIdSelects(t){return`${super.baseIdSelects}-${t}`}getBaseIdOutput(t){return`${super.baseIdOutput}-${t}`}_init(){this._injectModal()}_injectModal(){const t=super.bodySel.append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const a of function(t,e){return e.get?e.get.call(t):e.value}(e=this,Vs(e,Hs,"get"))){const e=t.append("div").attr("class","col-md-3 ms-auto pt-2 "+("base"===a?"column-base":"column-comp bg-paper"));e.append("div").attr("id",`${this.getBaseIdSelects(a)}`),e.append("div").attr("id",`${this.getBaseIdOutput(a)}`)}var e}}function Us(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Js(t,e,"get"))}function Qs(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Js(t,e,"set"),a),a}function Js(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Gs=new WeakMap,Ys=new WeakMap;class Xs{constructor(t,e){Gs.set(this,{writable:!0,value:void 0}),Ys.set(this,{writable:!0,value:void 0}),Qs(this,Gs,(0,Be.Z)(`#${t}`)),Qs(this,Ys,e),this._setupMainDiv()}get div(){return Us(this,Gs)}get woodData(){return Us(this,Ys)}_setupMainDiv(){Us(this,Gs).select("div").remove(),Us(this,Gs).append("div")}getProperty(t,e){const a=(null==t?void 0:t.properties.find((t=>t.modifier===e)))??{};return{amount:(null==a?void 0:a.amount)??0,isPercentage:(null==a?void 0:a.isPercentage)??!1}}}function ti(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ai(t,e,"get"))}function ei(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ai(t,e,"set"),a),a}function ai(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var si=new WeakMap;class ii extends Xs{constructor(t,e,a){super(t,e),si.set(this,{writable:!0,value:void 0}),ei(this,si,a),this._printText()}_getPropertySum(t){const e=super.getProperty(ti(this,si).frame,t),a=super.getProperty(ti(this,si).trim,t);return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getText(t){let e='<table class="table table-striped table-hover text-table mt-4"><thead>';e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[a,s]of t){if(e+=`<tr><td>${a}</td><td>${s.isPercentage?(0,o.ub)(s.amount/100):(0,o.$1)(s.amount)}`,e+='<span class="rate">',s.amount>0){e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${s.amount/s.max*50}%;"></span>`}else if(s.amount<0){const t=s.amount/s.min*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const t=new Map;for(const e of super.woodData.modifierNames){const a=this._getPropertySum(e);t.set(e,{amount:a.amount,isPercentage:a.isPercentage,min:super.woodData.getMinProperty(e),max:super.woodData.getMaxProperty(e)})}super.div.html(this._getText(t))}}function ni(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,oi(t,e,"get"))}function ri(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,oi(t,e,"set"),a),a}function oi(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var li=new WeakMap,hi=new WeakMap;class di extends Xs{constructor(t,e,a,s){super(t,e),li.set(this,{writable:!0,value:void 0}),hi.set(this,{writable:!0,value:void 0}),ri(this,li,a),ri(this,hi,s),this._printTextComparison()}static _getDiff(t,e,a,s=1){const i=Number.parseFloat((t-e).toFixed(s));return`${a?(0,o.ub)(t/100,s):(0,o.$1)(t)} <span class="badge bg-white text-dark">${(0,o.LQ)(i)}</span>`}_getBasePropertySum(t){const e=super.getProperty(ni(this,li).frame,t),a=super.getProperty(ni(this,li).trim,t);return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getComparePropertySum(t){const e=super.getProperty(ni(this,hi).frame,t),a=super.getProperty(ni(this,hi).trim,t);return{amount:e.amount+a.amount,isPercentage:e.isPercentage&&a.isPercentage}}_getText(t){const e=50;let a=0,s=0,i=0,n="",r='<table class="table table-striped table-hover text-table mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,l]of t)r+=`<tr><td>${o}</td><td>${di._getDiff(l.compare,l.base,l.isPercentage)}`,r+='<span class="rate">',l.compare>=0?(l.base>=0?l.compare>l.base?(a=l.base,s=l.compare-l.base,n="pos"):(a=l.compare,s=l.base-l.compare,n="neg"):(a=0,s=l.compare,n="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+=`<span class="bar pos diff" style="width:${a/l.max*e}%;"></span>`,r+=`<span class="bar ${n}" style="width:${s/l.max*e}%;"></span>`):l.compare<0?(l.base<0?l.compare>=l.base?(a=l.compare,s=l.base-l.compare,i=-l.base,n="pos"):(a=l.base,s=l.compare-l.base,i=-l.compare,n="neg"):(a=0,s=l.compare,i=-l.compare,n="neg"),r+=`<span class="bar neutral" style="width:${e+i/l.min*e}%;"></span>`,r+=`<span class="bar ${n}" style="width:${s/l.min*e}%;"></span>`,r+=`<span class="bar neg diff" style="width:${a/l.min*e}%;"></span>`):r+='<span class="bar neutral"></span>',r+="</span></td></tr>";return r+="</tbody></table>",r}_printTextComparison(){const t=new Map;for(const e of super.woodData.modifierNames){const a=this._getBasePropertySum(e),s=this._getComparePropertySum(e);t.set(e,{base:a.amount,compare:s.amount,isPercentage:a.isPercentage,min:super.woodData.getMinProperty(e),max:super.woodData.getMaxProperty(e)})}super.div.html(this._getText(t))}}function ci(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,pi(t,e,"get"))}function ui(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,pi(t,e,"set"),a),a}function pi(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var mi=new WeakMap,wi=new WeakMap,vi=new WeakMap,bi=new WeakMap,fi=new WeakMap,gi=new WeakMap,_i=new WeakMap,yi=new WeakMap,Si=new WeakMap;class ki{constructor(t="compare-wood"){mi.set(this,{writable:!0,value:{}}),wi.set(this,{writable:!0,value:{}}),vi.set(this,{writable:!0,value:{}}),bi.set(this,{writable:!0,value:void 0}),fi.set(this,{writable:!0,value:{}}),gi.set(this,{writable:!0,value:{}}),_i.set(this,{writable:!0,value:void 0}),yi.set(this,{writable:!0,value:void 0}),Si.set(this,{writable:!0,value:void 0}),ui(this,yi,t),ui(this,_i,"compare-wood"===ci(this,yi)?"Compare woods":ci(this,yi)),ui(this,Si,`menu-${ci(this,yi)}`),"compare-wood"===ci(this,yi)&&this._setupMenuListener(),this._setupData()}_enableSelects(t){for(const e of It.Kf)ci(this,fi)[t][e].enable()}_disableSelects(t){for(const e of It.Kf)ci(this,fi)[t][e].disable()}initSelects(t,e){ci(this,fi)[t]={};for(const a of It.Kf)ci(this,fi)[t][a]=new d.Z(`${ci(this,yi)}-${t}-${a}`,e,{title:`Select ${a}`},ci(this,gi).getOptions(a))}async init(){ui(this,gi,new ba.J(ci(this,yi))),await ci(this,gi).init();for(const t of ci(this,mi))ci(this,vi)[t]=!1,"compare-wood"===ci(this,yi)&&(this.initSelects(t,ci(this,bi).getBaseIdSelects(t)),this._setupSelectListener(t),"base"!==t&&this._disableSelects(t))}_setupData(){"compare-wood"===ci(this,yi)?ui(this,wi,["c1","c2","c3"]):"ship-journey"===ci(this,yi)?ui(this,wi,[]):"compare-ship"===ci(this,yi)&&ui(this,wi,["c1","c2"]),ui(this,mi,[...ci(this,wi)]),ci(this,mi).unshift("base")}_setupMenuListener(){document.querySelector(`#${ci(this,Si)}`).addEventListener("click",(()=>{this._menuClicked()}))}async _menuClicked(){(0,i.KS)("Menu",ci(this,_i)),ci(this,bi)?ci(this,bi).show():(ui(this,bi,new zs(ci(this,_i),ci(this,mi))),await this.init())}_setColumns(t){if("base"===t){ci(this,vi)[t]=!0,new ii(ci(this,bi).getBaseIdOutput(t),ci(this,gi),this._getWoodData("base"));for(const t of ci(this,wi))"compare-wood"===ci(this,yi)&&this._enableSelects(t),ci(this,vi)[t]&&(ci(this,vi)[t]=!0,new di(ci(this,bi).getBaseIdOutput(t),ci(this,gi),this._getWoodData("base"),this._getWoodData(t)))}else ci(this,vi)[t]=!0,new di(ci(this,bi).getBaseIdOutput(t),ci(this,gi),this._getWoodData("base"),this._getWoodData(t))}_setOtherSelect(t,e){const a="frame"===e?"trim":"frame";0===Number(ci(this,fi)[t][a].getValues())&&ci(this,fi)[t][a].reset(ci(this,gi).defaultWoodId[a])}woodSelected(t,e){this._setOtherSelect(t,e),"compare-wood"===ci(this,yi)&&this._setColumns(t)}_setupSelectListener(t){for(const e of It.Kf){const{select$:a}=ci(this,fi)[t][e];a.on("change",(()=>{this.woodSelected(t,e)}))}}_getWoodData(t){const e=Number(ci(this,fi)[t].frame.getValues()),a=Number(ci(this,fi)[t].trim.getValues());return{frame:ci(this,gi).getWoodTypeData(e),trim:ci(this,gi).getWoodTypeData(a)}}}const $i=(t,e)=>{(0,s.V4)(e),new ki,new Va,new y,new q,new wt(t),new Tt,new Ut,new ne,new ke(t),new qe(t),new sa(t),new va,new Ca,new gs(t),new Fs(t)}},5042:()=>{}}]);