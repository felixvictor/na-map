/*! For license information please see game-tools~map.b27b856638475e2c5500.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{146:function(t,e,a){a.d(e,"b",(function(){return m})),a.d(e,"k",(function(){return u})),a.d(e,"c",(function(){return _})),a.d(e,"d",(function(){return f})),a.d(e,"a",(function(){return b})),a.d(e,"e",(function(){return g})),a.d(e,"f",(function(){return D})),a.d(e,"l",(function(){return v})),a.d(e,"g",(function(){return S})),a.d(e,"j",(function(){return C})),a.d(e,"i",(function(){return w})),a.d(e,"h",(function(){return y})),a.d(e,"m",(function(){return j}));a(50),a(23);var s=a(369),i=a(53);function o(){const t=d(["","",""]);return o=function(){return t},t}function r(){const t=d([".",""]);return r=function(){return t},t}function n(){const t=d([".",'<span class="hidden">0</span>']);return n=function(){return t},t}function c(){const t=d(['<span class="hidden">.',"</span>"]);return c=function(){return t},t}function p(){const t=d(["",""]);return p=function(){return t},t}function d(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}const h=Object(s.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reals"],percent:" %",minus:"− "}),l=h.formatPrefix(",.0",1e3),m=(t,e=2)=>h.format(",.".concat(e,"~r"))(t),u=(t,e=2)=>h.format("+,.".concat(e,"~r"))(t).replace("+","＋ "),_=(t,e=2)=>h.format(".".concat(e,"f"))(t).replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),f=(t,e=2)=>{const[a,s]=h.format(".".concat(e,"f"))(t).split(".");let d=Object(i.d)(p(),s);return s&&(d="0"===s||"00"===s?Object(i.d)(c(),s):s.endsWith("0")?Object(i.d)(n(),s.replace("0","")):Object(i.d)(r(),s)),Object(i.d)(o(),a,d)},b=t=>l(-1*t).replace("k"," k"),g=t=>h.format(",d")(t),D=t=>h.format(",d")(t-.5),v=t=>h.format("+,d")(t).replace("+","＋ "),S=t=>h.format(",.0%")(t).replace("%","pp"),C=t=>h.format(",.2s")(t).replace(".0","").replace("M"," ᴍ").replace("k"," k").replace("m"," m"),w=t=>h.format("$,.2s")(t).replace(".0","").replace("M"," ᴍ").replace("k"," k"),y=(t,e=1)=>h.format(".".concat(e,"%"))(t).replace(".0",""),j=t=>h.format("+.1%")(t).replace(".0","").replace("+","＋ ")},151:function(t,e,a){a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));a(50);const s=(t,e)=>t&&e?t.localeCompare(e):0,i=t=>(e,a)=>{let s=0;return t.some(t=>{let i=1;return String(t).startsWith("-")&&(i=-1,t=String(t).slice(1)),s=Number.isNaN(Number(e[t]))&&Number.isNaN(Number(a[t]))?String(e[t]).localeCompare(String(a[t]))*i:Number(e[t])-Number(a[t])*i,0!==s}),s}},153:function(t,e,a){(function(t){a.d(e,"e",(function(){return r})),a.d(e,"f",(function(){return n})),a.d(e,"j",(function(){return c})),a.d(e,"m",(function(){return p})),a.d(e,"a",(function(){return d})),a.d(e,"k",(function(){return h})),a.d(e,"l",(function(){return l})),a.d(e,"d",(function(){return m})),a.d(e,"c",(function(){return u})),a.d(e,"b",(function(){return _})),a.d(e,"g",(function(){return f})),a.d(e,"i",(function(){return b})),a.d(e,"h",(function(){return g}));a(23),a(102);var s=a(210),i=a(19),o=a(49);const r=(t,e=!1)=>{let a;return a=Number.isNaN(Number(t))?t:Object(o.l)(Number(t)),"<".concat(e?"tspan":"span",' class="caps">').concat(a,"</").concat(e?"tspan":"span",">")},n=(t,e=!1)=>{let a,s;return Number.isNaN(Number(t))?(a=t,s=Object(o.c)(a)%o.j):(s=Number(t),a=Object(o.l)(s)),"<".concat(e?"tspan":"span",' class="caps">').concat(a,"</").concat(e?"tspan":"span","> (").concat(s,"°)")},c=e=>{const a=Object(o.l)(t("#".concat(e)).roundSlider("getValue"));let s;return s=Number.isNaN(Number(a))?Object(o.c)(a):Number(a),s},p=(t,e)=>{let a=Math.atan2(e.y-t.y,e.x-t.x);a-=Math.PI/2;let s=Object(o.r)(a);return s<0&&(s+=o.j),s},d=(t,e,a=!0)=>{if(e<2)return[t];const s=t.length,i=[];let o,r=0;if(s%e==0)for(o=Math.floor(s/e);r<s;)i.push(t.slice(r,r+=o));else if(a)for(;r<s;)o=Math.ceil((s-r)/e--),i.push(t.slice(r,r+=o));else{for(e-=1,o=Math.floor(s/e),s%o==0&&(o-=1);r<o*e;)i.push(t.slice(r,r+=o));i.push(t.slice(o*e))}return i},h=({element:t,radius:e})=>{const a=i.v,r=o.j/a,n=Math.round(.8*e),c=new Array(a).fill(null).map((t,e)=>Object(o.l)(e*r)),p=Object(s.a)().range([0-r/2,o.j-r/2]).domain(c).align(0);t.append("circle").attr("r",n).style("stroke-width","".concat(3,"px"));const d=t.append("text"),h=t.selectAll("g").data(c).join(t=>t.append("g").attr("transform",t=>{var e;return"rotate(".concat(Math.round((null!==(e=p(t))&&void 0!==e?e:0)+p.bandwidth()/2-o.k),")translate(").concat(n,",0)")}));h.filter((t,e)=>e%3!=0).append("line").attr("x2",9),h.filter((t,e)=>e%3==0).append("text").attr("transform",t=>{var e,a,s,i,o;let r=Math.round((null!==(e=p(t))&&void 0!==e?e:0)+p.bandwidth()/2),n="";d.text(t);const c=null!==(a=null===(s=d.node())||void 0===s?void 0:s.getBBox().height)&&void 0!==a?a:0,h=null!==(i=null===(o=d.node())||void 0===o?void 0:o.getBBox().width)&&void 0!==i?i:0;return r>=0&&r<=45||315===r?(r=90,n="0,-".concat(c/2)):90===r?(r=0,n="".concat(h/2+3,",0")):270===r?(r=180,n="-".concat(h/2+3,",0")):(r=-90,n="0,".concat(c/2+3+2)),"rotate(".concat(r,")translate(").concat(n,")")}).text(t=>t),d.remove()},l=({element:t,radius:e})=>{const a=i.v,r=o.j/a,n=Math.round(.8*e),c=new Array(a).fill(null).map((t,e)=>Object(o.l)(e*r)),p=Object(s.a)().range([0-r/2,o.j-r/2]).domain(c).align(0);t.append("circle").attr("r",n).style("stroke-width","".concat(1.5,"px"));t.selectAll("line").data(c).join(t=>t.append("line").attr("x2",(t,e)=>e%3==0?e%6==0?6:4:2).attr("transform",t=>{var e;return"rotate(".concat(Math.round((null!==(e=p(t))&&void 0!==e?e:0)+p.bandwidth()/2),")translate(").concat(n,",0)")}))},m=t=>'<span class="caps">'.concat(t,"</span>"),u=(t,e)=>{navigator.clipboard||((t,e)=>{if(!document.queryCommandSupported||!document.queryCommandSupported("copy"))return console.error("Insufficient rights to copy ".concat(t," to clipboard")),!1;{const a=document.createElement("input");a.type="text",a.value=t,a.style.position="absolute",a.style.left="-1000px",a.style.top="-1000px",e.append(a),a.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{a.remove()}}})(t,e),(t=>{navigator.clipboard.writeText(t).then(()=>!0).catch(e=>(console.error("Cannot copy ".concat(t," to clipboard"),e),!1))})(t)},_=(t,e,a)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const s=new URL(window.location.href);s.searchParams.set("x",String(t)),s.searchParams.set("z",String(e)),u(s.href,a)}},f=(t,e,a)=>"M".concat(t,",").concat(e," m").concat(-a,",0 a").concat(a,",").concat(a," 0,1,0 ").concat(2*a,",0 a").concat(a,",").concat(a," 0,1,0 ").concat(2*-a,",0"),b=(t,e,a)=>"M".concat(t-a/2,",").concat(e-a/2,"h").concat(a,"v").concat(a,"h").concat(-a,"z"),g=(t,e,a)=>"M".concat(t,",").concat(e,"v").concat(a)}).call(this,a(48))},199:function(t,e,a){a.d(e,"a",(function(){return c}));a(23);var s=a(138),i=a(393),o=a(379),r=a(19);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class c{constructor(t,e){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=t,this._shipCompare=e,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(t=>"".concat(t," knots")),this.select="#ship-compare-".concat(this._id),this._setupSvg(),this._setCompass()}static pd(t){let e='<span class="badge badge-white">'.concat(t[0]," / ");return t[1]?e+="".concat(t[1]):e+="–",e+=" lb</span>",e}static getCannonsPerDeck(t,e){let a="".concat(e[0]," ").concat(c.pd(t[0])),s="";for(let i=1;i<4;i+=1)e[i]?a="".concat(e[i]," ").concat(c.pd(t[i])," <br>").concat(a):s="".concat(s,"<br>");return[a,s]}static displaySecondBlock(){return'<div class="col-9"><div class="row no-gutters">'}static getText(t){let e=0;function a(t){return e+=1,'<div class="row row-small '.concat(e%2?"row-light":"",'"><div class="col-3">').concat(t,"</div>")}function s(e,a,s=6){let i="",o="";return"cannonsPerDeck"===e?([i,o]=t[e],o="<br>".concat(o)):i=""===e?"":String(t[e]),'<div class="col-'.concat(s,'">').concat(i,'<br><span class="des">').concat(a,"</span>").concat(o,"</div>")}let i="";return i+=a(t.shipRating),i+=c.displaySecondBlock(),i+=s("battleRating","Battle rating"),i+=s("guns","Cannons"),i+=s("upgradeXP","Knowledge XP"),i+=s("waterlineHeight","Water line"),i+="</div></div></div>",i+=a(t.decks),i+=c.displaySecondBlock(),i+=s("cannonsPerDeck","Gun decks"),i+=s("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=a("Broadside (lb)"),i+=c.displaySecondBlock(),i+=s("cannonBroadside","Cannons"),i+=s("carroBroadside","Carronades"),i+="</div></div></div>",i+=a("Chasers"),i+=c.displaySecondBlock(),i+=s("gunsFront","Bow"),i+=s("gunsBack","Stern"),i+="</div></div></div>",i+=a("Speed"),i+=c.displaySecondBlock(),i+=s("maxSpeed","Maximum"),i+=s("",""),i+=s("acceleration","Acceleration"),i+=s("deceleration","Deceleration"),i+=s("maxTurningSpeed","Turn speed"),i+=s("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=a('Hit points <span class="badge badge-white">Thickness</span>'),i+=c.displaySecondBlock(),i+=s("sideArmor","Sides"),i+=s("structure","Hull"),i+=s("frontArmor","Bow"),i+=s("backArmor","Stern"),i+=s("pump","Pump"),i+=s("rudder","Rudder"),i+="</div></div></div>",i+=a('Masts <span class="badge badge-white">Thickness</span>'),i+=c.displaySecondBlock(),i+=s("sails","Sails"),i+=s("mastBottomArmor","Bottom"),i+=s("mastMiddleArmor","Middle"),i+=s("mastTopArmor","Top"),i+="</div></div></div>",i+=a("Crew"),i+=c.displaySecondBlock(),i+=s("minCrew","Minimum",4),i+=s("sailingCrew","Sailing",4),i+=s("maxCrew","Maximum",4),i+="</div></div></div>",i+=a("Resistance"),i+=c.displaySecondBlock(),i+=s("fireResistance","Fire",4),i+=s("leakResistance","Leak",4),i+=s("splinterResistance","Splinter",4),i+="</div></div></div>",i+=a('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=c.displaySecondBlock(),i+=s("hullRepairsNeeded","Hull",4),i+=s("rigRepairsNeeded","Rig",4),i+=s("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=a("Repair"),i+=c.displaySecondBlock(),i+=s("hullRepairAmount","Hull %",4),i+=s("rigRepairAmount","Rig %",4),i+=s("repairTime","Time (sec)",4),i+="</div></div></div>",i+=a("Hold"),i+=c.displaySecondBlock(),i+=s("maxWeight","Tons"),i+=s("holdSize","Cargo slots"),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const t=Object(s.a)(this.select);Object(s.a)("".concat(this.select," svg")).remove(),this._svg=t.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform","translate(".concat(this._shipCompare.svgWidth/2,",").concat(this._shipCompare.svgHeight/2,")")),Object(s.a)("".concat(this.select," div")).remove(),t.append("div")}_setCompass(){const t=new Array(r.v/2);t.fill(1,0);const e=Object(i.a)().sort(null).value(1)(t),a=Object(o.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(e).join(t=>t.append("path").attr("d",a)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(t=>t.append("circle").attr("r",t=>this._shipCompare.radiusSpeedScale(t)))}}},222:function(t,e,a){(function(t){a.d(e,"a",(function(){return S}));a(23);var s=a(379),i=a(393),o=a(391),r=a(396),n=a(146),c=a(49),p=a(158),d=a(83),h=a(153),l=a(394),m=a(37),u=a(19),_=a(255),f=a.n(_),b=a(199);function g(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return D(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function v(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class S extends b.a{constructor(t,e,a){super(t,a),v(this,"shipData",void 0),v(this,"_speedScale",void 0),v(this,"_shipRotate",void 0),v(this,"_speedText",void 0),v(this,"_drag",void 0),this.shipData=e,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const t=Object(s.a)().outerRadius(t=>this._shipCompare.radiusSpeedScale(t)+2).innerRadius(t=>this._shipCompare.radiusSpeedScale(t)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(e=>e.append("path").attr("d",t).attr("id",(t,e)=>"tick".concat(e))),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(t=>t.append("text").append("textPath").attr("href",(t,e)=>"#tick".concat(e)).text((t,e)=>this.ticksSpeedLabels[e]).attr("startOffset","10%"))}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){return Object(n.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(c.l)(t)}_updateCompareWindProfiles(){for(const t of this._shipCompare.columnsCompare)Object(m.c)(this._shipCompare.selectedShips[t])||this._shipCompare.selectedShips[t].updateWindProfileRotation()}_setupDrag(){const t=this.shipData.speedDegrees.length,e=360/t,a=new Array(t+1).fill(null).map((t,a)=>a*e);this._speedScale=Object(p.a)().domain(a).range([].concat(g(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=l.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:a}=d.c;t.rotate=this._getHeadingInDegrees(Object(h.m)({x:t.initX,y:t.initY},{x:e,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>"rotate(".concat(t.rotate,")")),t.compassText.attr("transform",t=>"rotate(".concat(-t.rotate,",").concat(t.compassTextX,",").concat(t.compassTextY,")")).text(t=>this._getHeadingInCompass(t.rotate)),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform","rotate(".concat(-this._shipRotate,")")).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipData,e=this._shipCompare.shipMassScale(t),a=e,s=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(i).attr("class","ship-outline");o.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),o.append("image").attr("height",e).attr("width",a).attr("x",-e/2).attr("y",-a/2).attr("xlink:href",f.a),o.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const r=o.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>"rotate(".concat(-t.initRotate,",").concat(t.compassTextX,",").concat(t.compassTextY,")")).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=o.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>"rotate(".concat(-t.initRotate,")")).text(t=>this._getSpeed(t.initRotate)),i.this=o,i.compassText=r,o.datum(i).attr("transform",t=>"rotate(".concat(t.initRotate,")"))}_drawWindProfile(){const t=Object(i.a)().sort(null).value(1)(this.shipData.speedDegrees),e=o.a,a=Object(r.a)().angle((t,e)=>e*u.B).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(e);this._shipCompare.windProfileRotate=0;const s=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-s,type:"windProfile"},c=this._mainG.append("g").datum(n).attr("class","wind-profile");c.append("path").attr("d",t=>String(Object(h.g)(t.compassTextX,t.compassTextY,20))+Object(h.h)(t.compassTextX,t.compassTextY,-t.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),c.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20);const p=c.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>"rotate(".concat(-t.initRotate,",").concat(t.compassTextX,",").concat(t.compassTextY,")")).text(t=>this._getHeadingInCompass(t.initRotate));c.append("path").attr("class","base-profile").attr("d",a(t)),c.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(t).join(t=>t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*u.B)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*u.B)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).append("title").text(t=>"".concat(Math.round(10*t.data)/10," knots"))),n.this=c,n.compassText=p,c.datum(n).attr("transform",t=>"rotate(".concat(t.initRotate,")"))}_printText(){var e;const a=b.a.getCannonsPerDeck(this.shipData.deckClassLimit,this.shipData.gunsPerDeck),s=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/u.p),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/u.z),o=Math.round(this.shipData.crew.max*u.A),r={acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:"".concat(this.shipData.decks<4?"<br> ":""),backArmor:"".concat(Object(n.f)(this.shipData.stern.armour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.stern.thickness),"</span>"),battleRating:String(this.shipData.battleRating),bowRepair:"".concat(Object(n.f)(this.shipData.repairTime.bow)),cannonBroadside:Object(n.f)(this.shipData.broadside.cannons),cannonsPerDeck:a,carroBroadside:Object(n.f)(this.shipData.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:"".concat(this.shipData.decks," deck").concat(this.shipData.decks>1?"s":""),fireResistance:Object(n.h)(this.shipData.resistance.fire,0),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:"".concat(Object(n.f)(this.shipData.bow.armour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.bow.thickness),"</span>"),guns:String(this.shipData.guns),gunsBack:this.shipData.gunsPerDeck[5],gunsFront:this.shipData.gunsPerDeck[4],halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.f)(this.shipData.holdSize),hullRepairAmount:"".concat(Object(n.f)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk))),hullRepairsNeeded:"".concat(Object(n.f)(s),' <span class="badge badge-white">').concat(Object(n.f)(s*u.x),"</span>"),leakResistance:Object(n.h)(this.shipData.resistance.leaks,0),limitBack:this.shipData.deckClassLimit[5],limitFront:this.shipData.deckClassLimit[4],mastBottomArmor:"".concat(Object(n.f)(this.shipData.mast.bottomArmour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.mast.bottomThickness),"</span>"),mastMiddleArmor:"".concat(Object(n.f)(this.shipData.mast.middleArmour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.mast.middleThickness),"</span>"),mastTopArmor:"".concat(Object(n.f)(this.shipData.mast.topArmour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.mast.topThickness),"</span>"),maxCrew:Object(n.f)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.f)(this.shipData.maxWeight),minCrew:Object(n.f)(this.shipData.crew.min),pump:Object(n.f)(this.shipData.pump.armour),repairTime:"".concat(Object(n.f)(this.shipData.repairTime.sides)),rigRepairAmount:"".concat(Object(n.f)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk))),rigRepairsNeeded:"".concat(Object(n.f)(i),' <span class="badge badge-white">').concat(Object(n.f)(i*u.x),"</span>"),rudder:"".concat(Object(n.f)(this.shipData.rudder.armour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.rudder.thickness),"</span>"),rumRepairsNeeded:"".concat(Object(n.f)(o),' <span class="badge badge-white">').concat(Object(n.f)(o*u.x),"</span>"),sailingCrew:Object(n.f)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:Object(n.f)(this.shipData.sails.armour),shipRating:"".concat(Object(c.p)(this.shipData.class)," rate"),sideArmor:"".concat(Object(n.f)(this.shipData.sides.armour),' <span class="badge badge-white">').concat(Object(n.f)(this.shipData.sides.thickness),"</span>"),splinterResistance:Object(n.h)(this.shipData.resistance.splinter,0),sternRepair:"".concat(Object(n.f)(this.shipData.repairTime.stern)),structure:Object(n.f)(this.shipData.structure.armour),upgradeXP:Object(n.f)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight)};r.gunsFront?r.gunsFront+=" ".concat(b.a.pd(r.limitFront)):r.gunsFront="–",r.gunsBack?r.gunsBack+=" ".concat(b.a.pd(r.limitBack)):r.gunsBack="–",t("".concat(this.select)).find("div").append(b.a.getText(r))}}}).call(this,a(48))},223:function(t,e,a){(function(t){a.d(e,"a",(function(){return S}));a(23);var s=a(196),i=a(215),o=a(394),r=a(158),n=a(83),c=a(393),p=a(391),d=a(396),h=a(146),l=a(49),m=a(19),u=a(153),_=a(255),f=a.n(_),b=a(199);function g(t){return function(t){if(Array.isArray(t))return D(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return D(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return D(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function v(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class S extends b.a{constructor(t,e,a,s){super(t,s),v(this,"shipCompareData",void 0),v(this,"_shipBaseData",void 0),v(this,"_speedScale",void 0),v(this,"_speedDiff",void 0),v(this,"_minSpeedDiff",void 0),v(this,"_maxSpeedDiff",void 0),v(this,"_shipRotate",void 0),v(this,"_speedText",void 0),v(this,"_drag",void 0),v(this,"_windProfile",void 0),v(this,"_gWindProfile",void 0),v(this,"_arcsComp",void 0),this._shipBaseData=e,this.shipCompareData=a,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(t,e){const a=Math.min(t,this._shipCompare.colourScaleSpeedDiff.domain()[0]),s=Math.max(e,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([a,0,s])}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){return Object(h.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(l.l)(t)}_updateSpeedText(){this._speedText.attr("transform","rotate(".concat(-this._shipRotate,")")).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const t=this.shipCompareData.speedDegrees.length,e=360/t,a=new Array(t+1).fill(0).map((t,a)=>a*e);this._speedScale=Object(r.a)().domain(a).range([].concat(g(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=o.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:a}=n.c;t.rotate=this._getHeadingInDegrees(Object(u.m)({x:t.initX,y:t.initY},{x:e,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>"rotate(".concat(t.rotate,")")),t.compassText.attr("transform",t=>"rotate(".concat(-t.rotate,",").concat(t.compassTextX,",").concat(t.compassTextY,")")).text(t=>this._getHeadingInCompass(t.rotate)),this._shipRotate=t.rotate,this._updateSpeedText()})()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipCompareData,e=this._shipCompare.shipMassScale(t),a=e,s=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(i).attr("class","ship-outline");o.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),o.append("image").attr("height",e).attr("width",a).attr("x",-e/2).attr("y",-a/2).attr("xlink:href",f.a),o.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const r=o.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>"rotate(".concat(-t.initRotate,",").concat(t.compassTextX,",").concat(t.compassTextY,")")).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=o.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>"rotate(".concat(-t.initRotate,")")).text(t=>this._getSpeed(this._shipCompare.windProfileRotate-t.initRotate)),i.this=o,i.compassText=r,o.datum(i).attr("transform",t=>"rotate(".concat(t.initRotate,")"))}_drawDifferenceProfile(){var t,e;const a=Object(c.a)().sort(null).value(1),o=a(this._shipBaseData.speedDegrees);this._arcsComp=a(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((t,e)=>Object(l.s)(t-this._shipBaseData.speedDegrees[e])),this._minSpeedDiff=null!==(t=Object(s.a)(this._speedDiff))&&void 0!==t?t:0,this._maxSpeedDiff=null!==(e=Object(i.a)(this._speedDiff))&&void 0!==e?e:0;const r=p.a,n=Object(d.a)().angle((t,e)=>e*m.B).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(r),h=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-h,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform","rotate(".concat(this._windProfile.initRotate,")")),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(o)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform","rotate(".concat(this._shipCompare.windProfileRotate,")")),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(t=>{t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*m.B)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*m.B)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e])).append("title").text((t,e)=>"".concat(Math.round(10*t.data)/10," (").concat(Object(h.k)(this._speedDiff[e],1),") knots"))}).select("circle").attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))}_injectTextComparison(){function e(t,e,a=0,s=!1){let i=Number.parseFloat((t-e).toFixed(a));return s&&(i*=100),i<0?'<span class="badge badge-danger">'.concat(Object(h.b)(Math.abs(i)),"</span>"):i>0?'<span class="badge badge-success">'.concat(Object(h.b)(i),"</span>"):""}const a=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/m.p),s=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/m.z),i=Math.round(this._shipBaseData.crew.max*m.A),o=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/m.p),r=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/m.z),n=Math.round(this.shipCompareData.crew.max*m.A),c={acceleration:"".concat(Object(h.b)(this.shipCompareData.ship.acceleration)," ").concat(e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)),additionalRow:"".concat(this.shipCompareData.decks<4?"<br> ":""),backArmor:"".concat(Object(h.f)(this.shipCompareData.stern.armour)," ").concat(e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.stern.thickness),"</span>").concat(e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)),battleRating:"".concat(this.shipCompareData.battleRating," ").concat(e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)),cannonBroadside:"".concat(this.shipCompareData.broadside.cannons," ").concat(e(this.shipCompareData.broadside.cannons,this._shipBaseData.broadside.cannons)),cannonsPerDeck:b.a.getCannonsPerDeck(this.shipCompareData.deckClassLimit,this.shipCompareData.gunsPerDeck),carroBroadside:"".concat(this.shipCompareData.broadside.carronades," ").concat(e(this.shipCompareData.broadside.carronades,this._shipBaseData.broadside.carronades)),deceleration:"".concat(Object(h.b)(this.shipCompareData.ship.deceleration)," ").concat(e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)),decks:"".concat(this.shipCompareData.decks," ").concat(e(this.shipCompareData.decks,this._shipBaseData.decks)," deck").concat(this.shipCompareData.decks>1?"s":""),fireResistance:"".concat(Object(h.h)(this.shipCompareData.resistance.fire,0)," ").concat(e(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0)),firezoneHorizontalWidth:"".concat(this.shipCompareData.ship.firezoneHorizontalWidth," ").concat(e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)),frontArmor:"".concat(Object(h.f)(this.shipCompareData.bow.armour)," ").concat(e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.bow.thickness),"</span>").concat(e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)),guns:"".concat(this.shipCompareData.guns," ").concat(e(this.shipCompareData.guns,this._shipBaseData.guns)),gunsBack:this.shipCompareData.gunsPerDeck[5],gunsFront:this.shipCompareData.gunsPerDeck[4],halfturnTime:"".concat(Object(h.b)(this.shipCompareData.rudder.halfturnTime,4)," ").concat(e(this.shipCompareData.rudder.halfturnTime,this._shipBaseData.rudder.halfturnTime,2)),holdSize:"".concat(Object(h.f)(this.shipCompareData.holdSize)," ").concat(e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)),hullRepairAmount:"".concat(Object(h.f)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))," ").concat(e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)),hullRepairsNeeded:"".concat(Object(h.f)(o)," ").concat(e(o,a),' <span class="badge badge-white">').concat(Object(h.f)(o*m.x),"</span>"),leakResistance:"".concat(Object(h.h)(this.shipCompareData.resistance.leaks,0)," ").concat(e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)),limitBack:this.shipCompareData.deckClassLimit[5],limitFront:this.shipCompareData.deckClassLimit[4],mastBottomArmor:"".concat(Object(h.f)(this.shipCompareData.mast.bottomArmour)," ").concat(e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.mast.bottomThickness),"</span>").concat(e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)),mastMiddleArmor:"".concat(Object(h.f)(this.shipCompareData.mast.middleArmour)," ").concat(e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.mast.middleThickness),"</span>").concat(e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)),mastTopArmor:"".concat(Object(h.f)(this.shipCompareData.mast.topArmour)," ").concat(e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.mast.topThickness),"</span>").concat(e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)),maxCrew:"".concat(Object(h.f)(this.shipCompareData.crew.max)," ").concat(e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)),maxSpeed:"".concat(Object(h.b)(this.shipCompareData.speed.max,4)," ").concat(e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)),maxTurningSpeed:"".concat(Object(h.b)(this.shipCompareData.rudder.turnSpeed,4)," ").concat(e(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2)),maxWeight:"".concat(Object(h.f)(this.shipCompareData.maxWeight)," ").concat(e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)),minCrew:"".concat(Object(h.f)(this.shipCompareData.crew.min)," ").concat(e(this.shipCompareData.crew.min,this._shipBaseData.crew.min)),minSpeed:"".concat(Object(h.b)(this.shipCompareData.speed.min)," ").concat(e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)),pump:"".concat(Object(h.f)(this.shipCompareData.pump.armour)," ").concat(e(this.shipCompareData.pump.armour,this._shipBaseData.pump.armour)),repairTime:"".concat(Object(h.f)(this.shipCompareData.repairTime.sides)," ").concat(e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)),rigRepairAmount:"".concat(Object(h.f)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))," ").concat(e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)),rigRepairsNeeded:"".concat(Object(h.f)(r)," ").concat(e(r,s),' <span class="badge badge-white">').concat(Object(h.f)(r*m.x),"</span>"),rudder:"".concat(Object(h.f)(this.shipCompareData.rudder.armour)," ").concat(e(this.shipCompareData.rudder.armour,this._shipBaseData.rudder.armour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.rudder.thickness),"</span>").concat(e(this.shipCompareData.rudder.thickness,this._shipBaseData.rudder.thickness)),rumRepairsNeeded:"".concat(Object(h.f)(n)," ").concat(e(n,i),' <span class="badge badge-white">').concat(Object(h.f)(n*m.x),"</span>"),sailingCrew:"".concat(Object(h.f)(this.shipCompareData.crew.sailing)," ").concat(e(this.shipCompareData.crew.sailing,this._shipBaseData.crew.sailing)),sails:"".concat(Object(h.f)(this.shipCompareData.sails.armour)," ").concat(e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)),shipRating:"".concat(Object(l.p)(this.shipCompareData.class)," rate"),sideArmor:"".concat(Object(h.f)(this.shipCompareData.sides.armour)," ").concat(e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour),' <span class="badge badge-white">').concat(Object(h.f)(this.shipCompareData.sides.thickness),"</span>").concat(e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)),splinterResistance:"".concat(Object(h.h)(this.shipCompareData.resistance.splinter,0)," ").concat(e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)),structure:"".concat(Object(h.f)(this.shipCompareData.structure.armour)," ").concat(e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)),upgradeXP:"".concat(Object(h.f)(this.shipCompareData.upgradeXP)," ").concat(e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)),waterlineHeight:"".concat(Object(h.b)(this.shipCompareData.ship.waterlineHeight)," ").concat(e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2))};c.gunsFront?c.gunsFront+=" ".concat(b.a.pd(c.limitFront)):c.gunsFront="–",c.gunsBack?c.gunsBack+=" ".concat(b.a.pd(c.limitBack)):c.gunsBack="–",t("".concat(this.select)).find("div").append(b.a.getText(c))}}}).call(this,a(48))},254:function(t,e,a){a(199),a(222),a(223);var s=a(256);a.d(e,"a",(function(){return s.a}))},255:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},256:function(t,e,a){(function(t){a.d(e,"a",(function(){return T}));a(216),a(50),a(89),a(90),a(91),a(92),a(93),a(94),a(95),a(96),a(97),a(98),a(99),a(100),a(101),a(172),a(173),a(174),a(175),a(176),a(177),a(178),a(179),a(180),a(181),a(182),a(183),a(184),a(185),a(186),a(187),a(23),a(102),a(144),a(147);var s=a(196),i=a(215),o=a(159),r=a(233),n=a(392),c=a(158),p=a(138),d=a(165),h=a.n(d),l=a(170),m=a.n(l),u=a(171),_=a.n(u),f=a(316),b=a.n(f),g=a(36),D=a(19),v=a(37),S=a(146),C=a(49),w=a(151),y=a(153),j=a(257),x=a(222),O=a(223);function A(t){return function(t){if(Array.isArray(t))return k(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return k(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return k(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function P(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}h.a.extend(m.a),h.a.extend(_.a);class T{constructor(t="ship-compare"){P(this,"colorScale",void 0),P(this,"colourScaleSpeedDiff",void 0),P(this,"columnsCompare",void 0),P(this,"innerRadius",void 0),P(this,"outerRadius",void 0),P(this,"radiusSpeedScale",void 0),P(this,"selectedShips",void 0),P(this,"singleShipData",void 0),P(this,"shipMassScale",void 0),P(this,"svgHeight",void 0),P(this,"svgWidth",void 0),P(this,"windProfileRotate",0),P(this,"woodCompare",void 0),P(this,"_maxSpeed",void 0),P(this,"_minSpeed",void 0),P(this,"_modal$",{}),P(this,"_modifierAmount",void 0),P(this,"_moduleAndWoodCaps",void 0),P(this,"_moduleAndWoodChanges",void 0),P(this,"_moduleDataDefault",void 0),P(this,"_moduleProperties",void 0),P(this,"_moduleTypes",void 0),P(this,"_selectedUpgradeIdsList",{}),P(this,"_selectedUpgradeIdsPerType",{}),P(this,"_selectModule$",{}),P(this,"_selectShip$",{}),P(this,"_selectWood$",{}),P(this,"_shipData",void 0),P(this,"_shipIds",{}),P(this,"_shipSelectData",void 0),P(this,"_baseId",void 0),P(this,"_baseName",void 0),P(this,"_buttonId",void 0),P(this,"_columns",void 0),P(this,"_copyButtonId",void 0),P(this,"_imageButtonId",void 0),P(this,"_modalId",void 0),P(this,"_moduleId",void 0),P(this,"_woodId",void 0),this._baseId=t,this._baseName="Compare ships",this._buttonId="button-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),this._moduleId="".concat(this._baseId,"-module"),this._copyButtonId="button-copy-".concat(this._baseId),this._imageButtonId="button-image-".concat(this._baseId),this.colourScaleSpeedDiff=Object(c.a)().range([D.i,D.j,D.f]).interpolate(n.a),this._modifierAmount=new Map,"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(t){return t<=3?"L":t<=5?"M":"S"}static _adjustAbsolute(t,e){return t?t+e:e}static _adjustPercentage(t,e,a){return a?t?t*(1+e):e:t?t+e:e}static _getModifierFromModule(t){return'<p class="mb-0">'.concat(t.map(t=>{let e;return e=t.isPercentage?Object(S.m)(t.amount/100):t.amount<1&&t.amount>0?Object(S.g)(t.amount):Object(S.l)(t.amount),"".concat(t.modifier," ").concat(e)}).join("<br>"),"</p>")}static _setSelect(t,e){let a;a=Array.isArray(e)?e.map(t=>String(t)):String(e),a&&t.val(a),t.selectpicker("render")}static _saveCanvasAsImage(t){const e=h.a.utc().format("YYYY-MM-DD HH-mm-ss"),a="na-map ship compare ".concat(e,".png"),s=document.createElement("a");s.href=t,s.download=a,document.body.append(s),s.click(),s.remove()}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(t){var e;await this._loadAndSetupData();const a=D.n.decode(null!==(e=t.get("cmp"))&&void 0!==e?e:"");a.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(a),this._setModuleSelects(t))}_setupArrow(){const t=document.querySelector("#journey-arrow").cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(t)}_setupData(){var t,e,a;this._moduleAndWoodChanges=new Map([["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Armour repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder repair time",{properties:["repairTime.rudder"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sail repair amount",{properties:["repairAmount.sails"],isBaseValueAbsolute:!0}],["Sail repair time",{properties:["repairTime.sails"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Side armour repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Speed decrease",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}],["Water repair time",{properties:["repairTime.pump"],isBaseValueAbsolute:!0}]]),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],cap:{amount:.4,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:.4,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:.4,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:.3,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:.3,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:16,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const o=1.2*(null!==(t=Object(s.a)(this._shipData,t=>t.speed.min))&&void 0!==t?t:0),r=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=o,this._maxSpeed=r,this.colorScale=Object(c.a)().domain([this._minSpeed,0,this._maxSpeed]).range([D.i,D.j,D.f]).interpolate(n.a);const p=null!==(e=Object(s.a)(this._shipData,t=>t.shipMass))&&void 0!==e?e:0,d=null!==(a=Object(i.a)(this._shipData,t=>t.shipMass))&&void 0!==a?a:0;this.shipMassScale=Object(c.a)().domain([p,d]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await a.e(6).then(a.t.bind(null,207,3))).default,this._shipData=(await a.e(13).then(a.t.bind(null,263,3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new j.a(this._woodId),await this.woodCompare.woodInit())}catch(t){Object(v.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("click",async t=>{e&&(e=!1,await this._loadAndSetupData()),Object(g.b)("Tools",this._baseName),t.stopPropagation(),this._shipCompareSelected()})}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=t("#".concat(this._modalId," .column-base")).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(c.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(t){var e,a;return null!==(e=null===(a=this._shipData.find(e=>e.id===t))||void 0===a?void 0:a.name)&&void 0!==e?e:""}_getSelectedData(t){const e={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[t]){e.ship=this._getShipName(this._shipIds[t]);for(const a of v.h)e.wood.push(this.woodCompare.getWoodName(a,Number(this._selectWood$[t][a].val())));if(this._selectedUpgradeIdsPerType[t])for(const i of A(this._moduleTypes)){const o=[];for(const e of this._selectedUpgradeIdsPerType[t][i]){var a,s;o.push(null!==(a=null===(s=this._moduleProperties.get(e))||void 0===s?void 0:s.name.replace(" Bonus",""))&&void 0!==a?a:"")}e.moduleData.set(i,o.join(", "))}}return e}_printSelectedData(t,e,a){const s=t.querySelectorAll("#".concat(this._baseId,"-").concat(a.toLowerCase()," label")),i=s[0].parentNode,o=s[0].offsetHeight;for(const t of s)t.remove();const r=Object(p.a)(i).insert("div",":first-child").style("height","".concat(5*o,"px"));e.ship&&r.append("div").style("margin-bottom","5px").style("line-height","1.1").text(e.ship),""!==e.wood[0]&&r.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(e.wood.join(" | "));for(const[t,a]of e.moduleData)""!==a&&r.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html("<em>".concat(t,"</em>: ").concat(a))}_replaceSelectsWithText(t){for(const e of this._columns){const a=this._getSelectedData(e);this._printSelectedData(t,a,e)}}async _makeImage(t){Object(g.b)("Menu","Ship compare image"),t.preventDefault();const e=document.querySelector("#".concat(this._modalId," .modal-dialog .modal-content .modal-body"));if(e){const t=await b()(e,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:t=>t.classList.contains("central")||t.classList.contains("overlay")||t.classList.contains("navbar"),logging:!0,onclone:t=>{this._replaceSelectsWithText(t)},x:0,y:0});T._saveCanvasAsImage(t.toDataURL())}}_shipCompareSelected(){var e,a,s;Object(v.c)(this._modal$)&&(this._initModal(),this._modal$=t("#".concat(this._modalId)),null===(e=document.querySelector("#".concat(this._modalId)))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyDataClicked(t)}),null===(a=document.querySelector("#".concat(this._copyButtonId)))||void 0===a||a.addEventListener("click",t=>{this._copyDataClicked(t)}),null===(s=document.querySelector("#".concat(this._imageButtonId)))||void 0===s||s.addEventListener("click",async t=>{await this._makeImage(t)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const t=[];for(const e of this._columns)if(this._shipIds[e]){t.push(this._shipIds[e]);for(const a of v.h)t.push(Number(this._selectWood$[e][a].val()))}return t}_copyDataClicked(t){Object(g.b)("Menu","Copy ship compare"),t.preventDefault();const e=this._getShipAndWoodIds();if(e.length>0){const t=new URL(window.location.href);t.searchParams.set("v",encodeURIComponent(D.d)),t.searchParams.set("cmp",D.n.encode(e));for(const e of this._columns){const a=this._columns.indexOf(e);if(this._selectedUpgradeIdsPerType[e])for(const s of A(this._moduleTypes)){const i=A(this._moduleTypes).indexOf(s),o=this._selectedUpgradeIdsPerType[e][s];if(null==o?void 0:o.length){const e="".concat(a).concat(i);t.searchParams.set(e,D.n.encode(o))}}}Object(y.c)(t.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(r.b)().key(t=>String(t.class)).sortKeys(o.a).entries(this._shipData.map(t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns})).sort(Object(w.b)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(t=>t[1].filter(t=>t.properties.some(t=>this._moduleAndWoodChanges.has(t.modifier))).map(t=>[t.id,t]))),this._moduleTypes=new Set(A(this._moduleProperties).map(t=>t[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(D.t)({id:this._modalId,title:this._baseName});const t=Object(p.a)("#".concat(this._modalId," .modal-body")).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const e of this._columns){const a=t.append("div").attr("id","".concat(this._baseId,"-").concat(e.toLowerCase())).attr("class","col-md-4 ml-auto pt-2 ".concat("Base"===e?"column-base":"column-comp")),s=this._getShipSelectId(e);a.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker");for(const t of v.h){const s=this._getWoodSelectId(t,e);a.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}for(const t of this._moduleTypes){const s=this._getModuleSelectId(t,e);a.append("label").append("select").attr("name",s).attr("id",s).property("multiple",!0).attr("class","selectpicker")}a.append("div").attr("id","".concat(this._baseId,"-").concat(e)).attr("class","".concat("Base"===e?"ship-base":"ship-compare"))}const e=Object(p.a)("#".concat(this._modalId," .modal-footer"));e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._imageButtonId).attr("title","Make image").attr("type","button").append("i").classed("icon icon-image",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const a of v.h)this._selectWood$[e][a]=t("#".concat(this._getWoodSelectId(a,e))),this.woodCompare._setupWoodSelects(e,a,this._selectWood$[e][a])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(t=>'<optgroup label="'.concat(Object(C.p)(Number(t.key),!1),' rate">').concat(t.values.map(t=>'<option data-subtext="'.concat(t.battleRating,'" value="').concat(t.id,'">').concat(t.name," (").concat(t.guns,")")).join("</option>"))).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=t("#".concat(this._getShipSelectId(e)));const a=this._getShipOptions();this._selectShip$[e].append(a),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(t,e){const a=Object(r.b)().key(t=>t[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(o.a).sortValues((t,e)=>t[1].name.localeCompare(e[1].name)).entries(A(this._moduleProperties).filter(a=>a[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===t&&("U"===a[1].moduleLevel||a[1].moduleLevel===T._getModuleLevel(e))));let s;const i=new Set(["Permanent","Ship trim"]);return s=a.length>1?a.map(e=>'<optgroup label="'.concat(e.key,'" data-max-options="').concat(i.has(t.replace(/[\sA-Za-z]+\s–\s/,""))?1:5,'">').concat(e.values.map(t=>'<option value="'.concat(t[0],'">').concat(t[1].name)).join("</option>"))).join("</optgroup>"):a.map(t=>"".concat(t.values.map(t=>'<option value="'.concat(t[0],'">').concat(t[1].name)).join("</option>"))).join(""),s}_fillModuleSelect(t,e){const a=this._getUpgradesOptions(e,(()=>this._shipData.find(e=>e.id===this._shipIds[t]).class)());this._selectModule$[t][e].find("option").remove(),this._selectModule$[t][e].append(a)}_resetModuleSelects(t){for(const e of this._moduleTypes)this._fillModuleSelect(t,e),this._selectModule$[t][e].selectpicker("refresh")}_getModuleFromName(t){let e={};return this._moduleDataDefault.some(a=>(e=a[1].find(e=>e.name===t),Boolean(e))),e}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const a of this._moduleTypes)this._selectModule$[e][a]=t("#".concat(this._getModuleSelectId(a,e))),this._selectModule$[e][a].on("changed.bs.select",()=>{this._modulesSelected(e),this._refreshShips(e)}).on("show.bs.select",e=>{t(e.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",e=>{const a=t(e.currentTarget);for(const e of a.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const a=this._getModuleFromName(e.textContent);t(e).attr("data-original-title",T._getModifierFromModule(a.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:t=>"".concat(t," ").concat(a.toLowerCase(),"s selected"),deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:a.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:"".concat(a),width:"150px"})}this._resetModuleSelects(e)}_getShipData(t){const e=this._shipData.find(e=>e.id===this._shipIds[t]);let a=e;return a.repairAmount={armour:D.o,armourPerk:0,sails:D.y,sailsPerk:0},a.repairTime={sides:D.w,default:D.w},a.resistance={fire:0,leaks:0,splinter:0},a=this._addModulesAndWoodData(e,a,t),a}_adjustValue(t,e,a){var s,i;let o=t;if(null===(s=this._modifierAmount.get(e))||void 0===s?void 0:s.absolute){const{absolute:t}=this._modifierAmount.get(e);o=T._adjustAbsolute(o,t)}if(null===(i=this._modifierAmount.get(e))||void 0===i?void 0:i.percentage){const t=this._modifierAmount.get(e).percentage/100;o=T._adjustPercentage(o,t,a)}return Math.trunc(100*o)/100}_setModifier(t){let e=t.isPercentage?0:t.amount,a=t.isPercentage?t.amount:0;var s,i,o,r;this._modifierAmount.has(t.modifier)&&(e+=null!==(s=null===(i=this._modifierAmount.get(t.modifier))||void 0===i?void 0:i.absolute)&&void 0!==s?s:0,a+=null!==(o=null===(r=this._modifierAmount.get(t.modifier))||void 0===r?void 0:r.percentage)&&void 0!==o?o:0);this._modifierAmount.set(t.modifier,{absolute:e,percentage:a})}_showCappingAdvice(t,e){const a="".concat(this._baseId,"-").concat(t,"-capping");let s=document.querySelector("#".concat(a));if(!s){var i;s=document.createElement("p"),s.id=a,s.className="alert alert-warning";const e=document.querySelector("#".concat(this._baseId,"-").concat(t));null==e||null===(i=e.firstChild)||void 0===i||i.after(s)}s.innerHTML="".concat(A(e).join(", ")," capped")}_removeCappingAdvice(t){const e="".concat(this._baseId,"-").concat(t,"-capping"),a=document.querySelector("#".concat(e));a&&a.remove()}_addModulesAndWoodData(t,e,a){const s=JSON.parse(JSON.stringify(e)),i=()=>{s.speedDegrees=s.speedDegrees.map(t=>{const e=1+this._modifierAmount.get("Max speed").percentage/100,a=t>0?t*e:t/e;return Math.max(Math.min(a,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const t of this._selectedUpgradeIdsList[a]){const e=this._moduleProperties.get(t);for(const t of e.properties)this._moduleAndWoodChanges.has(t.modifier)&&this._setModifier(t)}if(this.woodCompare.instances[a]){let t="_woodData";"Base"!==a&&(t="_compareData");for(const e of v.h)for(const s of this.woodCompare.instances[a][t][e].properties)this._moduleAndWoodChanges.has(s.modifier)&&this._setModifier(s)}})(),(()=>{for(const[e]of this._modifierAmount.entries()){var t;if(null===(t=this._moduleAndWoodChanges.get(e))||void 0===t?void 0:t.properties){const{properties:t,isBaseValueAbsolute:a}=this._moduleAndWoodChanges.get(e);for(const i of t){const t=i.split(".");t.length>1?s[t[0]][t[1]]=this._adjustValue(s[t[0]][t[1]],e,a):s[t[0]]=this._adjustValue(s[t[0]],e,a)}}}})(),(()=>{const e={isCapped:!1,modifiers:new Set},i=(t,a,s,{amount:i,isPercentage:o})=>{const r=Math.min(a,o?s*(1+i):i);return a!==r&&(e.isCapped=!0,e.modifiers.add(t)),r};for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(e)){const{cap:a}=this._moduleAndWoodCaps.get(e);for(const o of this._moduleAndWoodCaps.get(e).properties){const r=o.split(".");r.length>1?s[r[0]][r[1]]&&(s[r[0]][r[1]]=i(e,s[r[0]][r[1]],t[r[0]][r[1]],a)):s[r[0]]&&(s[r[0]]=i(e,s[r[0]],t[r[0]],a))}}e.isCapped?this._showCappingAdvice(a,e.modifiers):this._removeCappingAdvice(a)})(),this._modifierAmount.has("Max speed")&&i(),s}_updateDifferenceProfileNeeded(t){"Base"===t||Object(v.c)(this.selectedShips[t])||this.selectedShips[t].updateDifferenceProfile()}_updateSailingProfile(t){this._updateDifferenceProfileNeeded(t);for(const e of this.columnsCompare)e!==t&&this._updateDifferenceProfileNeeded(e)}_refreshShips(t){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(e=>e.id===this._shipIds[t]);else{this._modulesSelected(t);const e=this._getShipData(t);if("Base"===t){this._setSelectedShip(t,new x.a(t,e,this));for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh"),Object(v.c)(this.selectedShips[t])||this._setSelectedShip(t,new O.a(t,e,this.selectedShips[t].shipCompareData,this))}else this._setSelectedShip(t,new O.a(t,this.selectedShips.Base.shipData,e,this));this._updateSailingProfile(t)}}_enableCompareSelects(){for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(t){this._selectedUpgradeIdsList[t]=[],this._selectedUpgradeIdsPerType[t]={};for(const e of this._moduleTypes)this._selectedUpgradeIdsPerType[t][e]=this._selectModule$[t][e].val(),Array.isArray(this._selectedUpgradeIdsPerType[t][e])?this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e].map(t=>Number(t)):this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e]?[Number(this._selectedUpgradeIdsPerType[t][e])]:[],this._selectedUpgradeIdsPerType[t][e].length>0&&(this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][e]))}_setupSelectListener(t){if(this._selectShip$[t].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[t]=Number(this._selectShip$[t].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(t),this._refreshShips(t),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(t)}),"ship-journey"!==this._baseId)for(const e of v.h)this._selectWood$[t][e].on("changed.bs.select",()=>{this.woodCompare._woodSelected(t,e,this._selectWood$[t][e]),this._refreshShips(t)}).selectpicker({title:"Wood ".concat(e),width:"150px"})}_setShipAndWoodsSelects(t){let e=0;this._columns.some(a=>{if(!this._shipData.find(a=>a.id===t[e]))return!1;if(this._shipIds[a]=t[e],e+=1,T._setSelect(this._selectShip$[a],this._shipIds[a]),"Base"===a&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(a),this._setupModulesSelect(a),t[e])for(const s of v.h)T._setSelect(this._selectWood$[a][s],t[e]),e+=1,this.woodCompare._woodSelected(a,s,this._selectWood$[a][s]);else e+=2;return this._refreshShips(a),e>=t.length})}_setModuleSelects(t){for(const a of this._columns){const s=this._columns.indexOf(a);let i=!1;for(const o of A(this._moduleTypes)){const r=A(this._moduleTypes).indexOf(o);if(t.has("".concat(s).concat(r))){var e;const n=D.n.decode(t.get("".concat(s).concat(r)));this._selectedUpgradeIdsPerType[a]||(this._selectedUpgradeIdsPerType[a]={}),this._selectedUpgradeIdsList[a]||(this._selectedUpgradeIdsList[a]=[]),this._selectedUpgradeIdsPerType[a][o]=n.map(t=>Number(t)),T._setSelect(this._selectModule$[a][o],this._selectedUpgradeIdsPerType[a][o]),(e=this._selectedUpgradeIdsList[a]).push.apply(e,A(this._selectedUpgradeIdsPerType[a][o])),i=!0}}i&&this._refreshShips(a)}}_getShipSelectId(t){return"".concat(this._baseId,"-").concat(t,"-select")}_getWoodSelectId(t,e){return"".concat(this._woodId,"-").concat(t,"-").concat(e,"-select")}_getModuleSelectId(t,e){return"".concat(this._moduleId,"-").concat(t.replace(/\s/,""),"-").concat(e,"-select")}_setSelectedShip(t,e){this.selectedShips[t]=e}}}).call(this,a(48))},257:function(t,e,a){(function(t){a.d(e,"a",(function(){return b}));a(216),a(89),a(90),a(91),a(92),a(93),a(94),a(95),a(96),a(97),a(98),a(99),a(100),a(101),a(172),a(173),a(174),a(175),a(176),a(177),a(178),a(179),a(180),a(181),a(182),a(183),a(184),a(185),a(186),a(187),a(23),a(144),a(147),a(154);var s=a(196),i=a(215),o=a(138),r=a(36),n=a(146),c=a(19),p=a(37),d=a(151);function h(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class u{constructor(t,e){m(this,"select",void 0),m(this,"_woodCompare",void 0),m(this,"_id",void 0),m(this,"_g",void 0),this._id=t,this._woodCompare=e,this.select="#".concat(this._woodCompare.baseFunction,"-").concat(this._id),this._setupMainDiv(),this._g=Object(o.a)(this.select).select("g")}_setupMainDiv(){Object(o.a)("".concat(this.select," div")).remove(),Object(o.a)(this.select).append("div")}}class _ extends u{constructor(t,e,a){super(t,a),m(this,"_woodData",void 0),this._woodData=e,this._printText()}_getProperty(t,e){const a=this._woodData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getPropertySum(t){const e=this._getProperty(t,"frame"),a=this._getProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';e+="<tr>",e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[r,c]of t.properties){if(e+="<tr><td>".concat(r,"</td><td>").concat(c.isPercentage?Object(n.h)(c.amount/100):Object(n.b)(c.amount)),e+='<span class="rate">',c.amount>0){var a,s;const t=c.amount/(null!==(a=null===(s=this._woodCompare.minMaxProperty.get(r))||void 0===s?void 0:s.max)&&void 0!==a?a:1)*50;e+='<span class="bar neutral" style="width:'.concat(50,'%;"></span>'),e+='<span class="bar pos diff" style="width:'.concat(t,'%;"></span>')}else if(c.amount<0){var i,o;const t=c.amount/(null!==(i=null===(o=this._woodCompare.minMaxProperty.get(r))||void 0===o?void 0:o.min)&&void 0!==i?i:1)*50;e+='<span class="bar neutral" style="width:'.concat(50-t,'%;"></span>'),e+='<span class="bar neg diff" style="width:'.concat(t,'%;"></span>')}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getPropertySum(t);e.properties.set(t,{amount:a.amount,isPercentage:a.isPercentage})}t("".concat(this.select)).find("div").append(this._getText(e))}}class f extends u{constructor(t,e,a,s){super(t,s),m(this,"_baseData",void 0),m(this,"_compareData",void 0),this._baseData=e,this._compareData=a,this._printTextComparison()}static _getDiff(t,e,a,s=1){const i=Number.parseFloat((t-e).toFixed(s)),o=a?Object(n.h)(t/100,s):Object(n.b)(t);return"".concat(o,' <span class="badge badge-white">').concat(Object(n.k)(i),"</span>")}_getBaseProperty(t,e){const a=this._baseData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getBasePropertySum(t){const e=this._getBaseProperty(t,"frame"),a=this._getBaseProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getCompareProperty(t,e){const a=this._compareData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&(s=a.amount,i=a.isPercentage),{amount:s,isPercentage:i}}_getComparePropertySum(t){const e=this._getCompareProperty(t,"frame"),a=this._getCompareProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:e.isPercentage&&a.isPercentage}}_getText(t){let e=0,a=0,s=0,i="",o='<table class="table table-sm table-striped small wood mt-4"><thead>';o+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[b,g]of t.properties){var r,n,c,p;if(o+="<tr><td>".concat(b,"</td><td>").concat(f._getDiff(g.compare,g.base,g.isPercentage)),o+='<span class="rate">',g.compare>=0)g.base>=0?g.compare>g.base?(e=g.base,a=g.compare-g.base,i="pos"):(e=g.compare,a=g.base-g.compare,i="neg"):(e=0,a=g.compare,i="pos"),o+='<span class="bar neutral" style="width:'.concat(50,'%;"></span>'),o+='<span class="bar pos diff" style="width:'.concat(e/(null!==(r=null===(n=this._woodCompare.minMaxProperty.get(b))||void 0===n?void 0:n.max)&&void 0!==r?r:1)*50,'%;"></span>'),o+='<span class="bar '.concat(i,'" style="width:').concat(a/(null!==(c=null===(p=this._woodCompare.minMaxProperty.get(b))||void 0===p?void 0:p.max)&&void 0!==c?c:1)*50,'%;"></span>');else if(g.compare<0){var d,h,l,m,u,_;g.base<0?g.compare>=g.base?(e=g.compare,a=g.base-g.compare,s=-g.base,i="pos"):(e=g.base,a=g.compare-g.base,s=-g.compare,i="neg"):(e=0,a=g.compare,s=-g.compare,i="neg"),o+='<span class="bar neutral" style="width:'.concat(50+s/(null!==(d=null===(h=this._woodCompare.minMaxProperty.get(b))||void 0===h?void 0:h.min)&&void 0!==d?d:1)*50,'%;"></span>'),o+='<span class="bar '.concat(i,'" style="width:').concat(a/(null!==(l=null===(m=this._woodCompare.minMaxProperty.get(b))||void 0===m?void 0:m.min)&&void 0!==l?l:1)*50,'%;"></span>'),o+='<span class="bar neg diff" style="width:'.concat(e/(null!==(u=null===(_=this._woodCompare.minMaxProperty.get(b))||void 0===_?void 0:_.min)&&void 0!==u?u:1)*50,'%;"></span>')}else o+='<span class="bar neutral"></span>';o+="</span></td></tr>"}return o+="</tbody></table>",o}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getBasePropertySum(t),s=this._getComparePropertySum(t);e.properties.set(t,{base:a.amount,compare:s.amount,isPercentage:a.isPercentage})}t("".concat(this.select)).find("div").append(this._getText(e))}}class b{constructor(t){m(this,"baseFunction",void 0),m(this,"instances",{}),m(this,"minMaxProperty",new Map),m(this,"propertyNames",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_woodData",void 0),m(this,"_columnsCompare",void 0),m(this,"_defaultWoodId",{}),m(this,"_columns",void 0),m(this,"_frameSelectData",void 0),m(this,"_trimSelectData",void 0),m(this,"_options",{}),m(this,"_woodIdsSelected",{}),this.baseFunction=t,this._baseName="Compare woods",this._baseId="".concat(this.baseFunction,"-compare"),this._buttonId="button-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find(t=>t.id===e))||void 0===s?void 0:s.name)&&void 0!==a?a:""}_findWoodId(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find(t=>t.name===e))||void 0===s?void 0:s.id)&&void 0!==a?a:0}_setupData(){this.propertyNames=new Set([].concat(h(this._woodData.frame.flatMap(t=>t.properties.map(t=>t.modifier))),h(this._woodData.trim.flatMap(t=>t.properties.map(t=>t.modifier)))).sort(d.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await a.e(14).then(a.t.bind(null,232,3))).default,this._setupData()}catch(t){Object(p.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("click",async t=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",this._baseName),t.stopPropagation(),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#".concat(this._modalId))||this._initModal(),t("#".concat(this._modalId)).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(d.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(d.b)(["name"])),this._setOption(this._frameSelectData.map(t=>'<option value="'.concat(t.id,'">').concat(t.name,"</option>")).toString(),this._trimSelectData.map(t=>'<option value="'.concat(t.id,'">').concat(t.name,"</option>")).toString());for(const r of this.propertyNames){var t,e,a,o;const n=h(this._woodData.frame.map(t=>{var e,a;return null!==(e=null===(a=t.properties.find(t=>t.modifier===r))||void 0===a?void 0:a.amount)&&void 0!==e?e:0})),c=h(this._woodData.trim.map(t=>{var e,a;return null!==(e=null===(a=t.properties.find(t=>t.modifier===r))||void 0===a?void 0:a.amount)&&void 0!==e?e:0})),p=null!==(t=Object(s.a)(n))&&void 0!==t?t:0,d=null!==(e=Object(i.a)(n))&&void 0!==e?e:0,l=null!==(a=Object(s.a)(c))&&void 0!==a?a:0,m=null!==(o=Object(i.a)(c))&&void 0!==o?o:0;this._addMinMaxProperty(r,{min:p+l>=0?0:p+l,max:d+m})}}_injectModal(){Object(c.t)({id:this._modalId,title:this._baseName});const t=Object(o.a)("#".concat(this._modalId," .modal-body")).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const e of this._columns){const a=t.append("div").attr("class","col-md-3 ml-auto pt-2 ".concat("Base"===e?"column-base":"column-comp"));for(const t of p.h){const s="".concat(this.baseFunction,"-").concat(t,"-").concat(e,"-select");a.append("label").attr("for",s),a.append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}a.append("div").attr("id","".concat(this.baseFunction,"-").concat(e))}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const a of p.h){const s=t("#".concat(this.baseFunction,"-").concat(a,"-").concat(e,"-select"));this._setupWoodSelects(e,a,s),this._setupSelectListener(e,a,s)}}_setWoodsSelected(t,e,a){this._woodIdsSelected[t]||(this._woodIdsSelected[t]={}),this._woodIdsSelected[t][e]=a}_setupWoodSelects(t,e,a){this._setWoodsSelected(t,e,this._defaultWoodId[e]),a.append(this._options[e]),("wood"!==this.baseFunction||"Base"!==t&&"wood"===this.baseFunction)&&a.attr("disabled","disabled")}_setOtherSelect(e,a){const s="frame"===a?"trim":"frame";this._woodIdsSelected[e][s]===this._defaultWoodId[s]&&t("#".concat(this.baseFunction,"-").concat(s,"-").concat(e,"-select")).val(this._defaultWoodId[s]).selectpicker("refresh")}enableSelects(e){for(const a of p.h)t("#".concat(this.baseFunction,"-").concat(a,"-").concat(e,"-select")).removeAttr("disabled").selectpicker("refresh")}_woodSelected(t,e,a){const s=Number(a.val());if(this._setWoodsSelected(t,e,s),this._setOtherSelect(t,e),"Base"===t){this._addInstance(t,new _("Base",this._getWoodData("Base"),this));for(const t of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(t),this.instances[t]&&this._addInstance(t,new f(t,this._getWoodData("Base"),this._getWoodData(t),this))}else this._addInstance(t,new f(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,a){a.on("change",()=>this._woodSelected(t,e,a)).selectpicker({title:"Select ".concat(e)})}_getWoodData(t){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[t].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[t].trim)}}_addMinMaxProperty(t,e){this.minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this.instances[t]=e}getWoodTypeData(t,e){var a;return null!==(a=this._woodData[t].find(t=>t.id===e))&&void 0!==a?a:{}}}}).call(this,a(48))}}]);