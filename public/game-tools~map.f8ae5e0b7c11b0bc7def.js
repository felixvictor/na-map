/*! For license information please see game-tools~map.f8ae5e0b7c11b0bc7def.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(e,t,s){s.d(t,"e",(function(){return i})),s.d(t,"b",(function(){return o})),s.d(t,"j",(function(){return n})),s.d(t,"a",(function(){return d})),s.d(t,"c",(function(){return p})),s.d(t,"d",(function(){return h})),s.d(t,"k",(function(){return c})),s.d(t,"f",(function(){return l})),s.d(t,"i",(function(){return m})),s.d(t,"h",(function(){return u})),s.d(t,"g",(function(){return _})),s.d(t,"l",(function(){return g}));s(63);var a=s(255);const i=Object(a.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reals"],percent:" %",minus:"− "}),r=i.formatPrefix(",.0",1e3),o=(e,t=2)=>i.format(`,.${t}~r`)(e),n=(e,t=2)=>i.format(`+,.${t}~r`)(e).replace("+","＋ "),d=e=>r(-1*e).replace("k"," k"),p=e=>i.format(",d")(e),h=e=>i.format(",d")(e-.5),c=e=>i.format("+,d")(e).replace("+","＋ "),l=e=>i.format(",.0%")(e).replace("%","pp"),m=e=>i.format(",.2s")(e).replace(".0","").replace("M"," ᴍ").replace("k"," k").replace("m"," m"),u=e=>i.format("$,.2s")(e).replace(".0","").replace("M"," ᴍ").replace("k"," k"),_=(e,t=1)=>i.format(`.${t}%`)(e).replace(".0",""),g=e=>i.format("+.1%")(e).replace(".0","").replace("+","＋ ")},112:function(e,t,s){s.d(t,"a",(function(){return a})),s.d(t,"b",(function(){return i}));s(63);const a=(e,t)=>e&&t?e.localeCompare(t):0,i=e=>(t,s)=>{let a=0;return e.some(e=>{let i=1;return String(e).startsWith("-")&&(i=-1,e=String(e).slice(1)),a=Number.isNaN(Number(t[e]))&&Number.isNaN(Number(s[e]))?String(t[e]).localeCompare(String(s[e]))*i:(Number(t[e])-Number(s[e]))*i,0!==a}),a}},115:function(e,t,s){s.d(t,"g",(function(){return m})),s.d(t,"h",(function(){return u})),s.d(t,"k",(function(){return _})),s.d(t,"m",(function(){return g})),s.d(t,"n",(function(){return b})),s.d(t,"o",(function(){return v})),s.d(t,"l",(function(){return S})),s.d(t,"f",(function(){return C})),s.d(t,"j",(function(){return $})),s.d(t,"p",(function(){return w})),s.d(t,"a",(function(){return y})),s.d(t,"b",(function(){return j})),s.d(t,"c",(function(){return x})),s.d(t,"i",(function(){return k})),s.d(t,"e",(function(){return A})),s.d(t,"d",(function(){return P}));s(63);var a=s(178),i=s(225),r=s.n(i),o=s(122),n=s(121),d=s(132),p=s.n(d),h=s(1),c=s(110);const l=o.a.bind(n.a),m=Number(.2),u=Number(300),_=Number(90),g=Number(.25),b=Number(300),f=Number(.25),D=Number(1),v=Number(f)/Number(D),S=5,C=new r.a("My salt: Yet another Naval Action map"),$=e=>e.includes(" (i)"),w=e=>e.replace(" (i)",""),y=e=>l`${w(e)} ${$(e)?l`<span class="caps small">imported</span>`:l``}`,j=(e,t=2)=>{const[s,a]=c.e.format(`.${t}f`)(e).split(".");let i=l`${a}`;return a&&(i="0"===a||"00"===a?l`<span class="hidden">.${a}</span>`:a.endsWith("0")?l`.${a.replace("0","")}<span class="hidden">0</span>`:l`.${a}`),l`${s}${i}`},x=({id:e,title:t,size:s="modal-xl",body:a,footer:i})=>l`
        <div id="${e}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${e}" aria-hidden="true">
            <div class="modal-dialog ${s}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${e}" class="modal-title">
                            ${t}
                        </h5>
                    </div>
                    <div class="modal-body">${a()}</div>
                    <div class="modal-footer">
                        ${i()}
                    </div>
                </div>
            </div>
        </div>
    `,O=e=>e.replace(/[^\d-.?]/g,""),k=()=>{p.a.extend("number",e=>{var t,s;return null!==(t=null!==(s=/^[+-]?[$¢£´Û€]?\d+\s*([,.]\d{0,2})/.exec(e))&&void 0!==s?s:/^[+-]?\d+\s*([,.]\d{0,2})?[$¢£´Û€]/.exec(e))&&void 0!==t?t:/^[+-]?(\d)*-?([,.])?-?(\d)+([,Ee][+-]\d+)?%?$/.exec(e)},(e,t)=>{const s=O(e);return((e,t)=>{let s=Number.parseFloat(e),a=Number.parseFloat(t);return s=Number.isNaN(s)?0:s,a=Number.isNaN(a)?0:a,s-a})(O(t),s)})},A=e=>`${e} real${Number(e)>1?"s":""}`,P=e=>{var t,s;const{r:i,g:r,b:o}=Object(a.d)(e);return(299*i+587*r+114*o)/1e3>=128?null!==(t=null===(s=Object(a.c)(h.j))||void 0===s?void 0:s.darker(5).toString())&&void 0!==t?t:"#111":h.j}},131:function(e,t,s){s.d(t,"a",(function(){return d}));var a=s(10),i=s(277),r=s(264),o=s(1);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class d{constructor(e,t){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=e,this._shipCompare=t,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(e=>e+" knots"),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(e){let t=`<span class="badge badge-white">${e.maxCannonLb} / `;return e.maxCarroLb?t+=""+e.maxCarroLb:t+="–",t+=" lb</span>",t}static getCannonsPerDeck(e){let t=`${e.gunsPerDeck[0].amount} ${d.pd(e.gunsPerDeck[0])}`,s="";for(let a=1;a<4;a+=1)e.gunsPerDeck[a].amount?t=`${e.gunsPerDeck[a].amount} ${d.pd(e.gunsPerDeck[a])} <br>${t}`:s+="<br>";return[t,s]}static displaySecondBlock(){return'<div class="col-9"><div class="row no-gutters">'}static getText(e){let t=0;function s(e){return t+=1,`<div class="row row-small ${t%2?"row-light":""}"><div class="col-3">${e}</div>`}function a(t,s,a=6){let i,r="";return"cannonsPerDeck"===t?([i,r]=e[t],r="<br>"+r):i=""===t?"":String(e[t]),`<div class="col-${a}">${i}<br><span class="des">${s}</span>${r}</div>`}let i="";return i+=s(e.shipRating),i+=d.displaySecondBlock(),i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("waterlineHeight","Water line"),i+="</div></div></div>",i+=s(e.decks),i+=d.displaySecondBlock(),i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (lb)"),i+=d.displaySecondBlock(),i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+=d.displaySecondBlock(),i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+=d.displaySecondBlock(),i+=a("maxSpeed","Maximum"),i+=a("",""),i+=a("acceleration","Acceleration"),i+=a("deceleration","Deceleration"),i+=a("maxTurningSpeed","Turn speed"),i+=a("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=s('Hit points <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+=a("pump","Pump"),i+=a("rudder","Rudder"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+=d.displaySecondBlock(),i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+=a("cannonCrew","Cannon",4),i+=a("carroCrew","Carronades",4),i+="</div></div></div>",i+=s("Resistance"),i+=d.displaySecondBlock(),i+=a("fireResistance","Fire",4),i+=a("leakResistance","Leak",4),i+=a("splinterResistance","Splinter",4),i+="</div></div></div>",i+=s('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=d.displaySecondBlock(),i+=a("hullRepairsNeeded","Hull",4),i+=a("rigRepairsNeeded","Rig",4),i+=a("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=s("Repair"),i+=d.displaySecondBlock(),i+=a("hullRepairAmount","Hull %",4),i+=a("rigRepairAmount","Rig %",4),i+=a("repairTime","Time (sec)",4),i+="</div></div></div>",i+=s("Hold"),i+=d.displaySecondBlock(),i+=a("holdSize","Cargo slots"),i+=a("maxWeight","Tons"),i+="</div></div></div>",i+=s("Weight"),i+=d.displaySecondBlock(),i+=a("cannonWeight","Cannons",4),i+=a("carroWeight","Carronades",4),i+=a("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const e=Object(a.a)(this.select);Object(a.a)(this.select+" svg").remove(),this._svg=e.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),Object(a.a)(this.select+" div").remove(),e.append("div")}_setCompass(){const e=new Array(o.o/2);e.fill(1,0);const t=Object(i.a)().sort(null).value(1)(e),s=Object(r.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(t).join(e=>e.append("path").attr("d",s)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(e=>e.append("circle").attr("r",e=>this._shipCompare.radiusSpeedScale(e)))}}},146:function(e,t,s){(function(e){s.d(t,"a",(function(){return C}));var a=s(264),i=s(277),r=s(275),o=s(281),n=s(110),d=s(0),p=s(116),h=s(41),c=s(3),l=s(280),m=s(15),u=s(1),_=s(166),g=s.n(_),b=s(131),f=s(115);function D(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return v(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function S(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class C extends b.a{constructor(e,t,s){super(e,s),S(this,"shipData",void 0),S(this,"_speedScale",void 0),S(this,"_shipRotate",void 0),S(this,"_speedText",void 0),S(this,"_drag",void 0),this.shipData=t,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const e=Object(a.a)().outerRadius(e=>this._shipCompare.radiusSpeedScale(e)+2).innerRadius(e=>this._shipCompare.radiusSpeedScale(e)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(t=>t.append("path").attr("d",e).attr("id",(e,t)=>"tick"+t)),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(e=>e.append("text").append("textPath").attr("href",(e,t)=>"#tick"+t).text((e,t)=>this.ticksSpeedLabels[t]).attr("startOffset","10%"))}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(n.b)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(d.m)(e)}_updateCompareWindProfiles(){for(const e of this._shipCompare.columnsCompare)Object(m.c)(this._shipCompare.selectedShips[e])||this._shipCompare.selectedShips[e].updateWindProfileRotation()}_setupDrag(){const e=this.shipData.speedDegrees.length,t=360/e,s=new Array(e+1).fill(null).map((e,s)=>s*t);this._speedScale=Object(p.a)().domain(s).range([].concat(D(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=l.a().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=h.c;e.rotate=this._getHeadingInDegrees(Object(c.m)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>`rotate(${e.rotate})`),e.compassText.attr("transform",e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`).text(e=>this._getHeadingInCompass(e.rotate)),"ship"===e.type?this._shipRotate=e.rotate:"windProfile"===e.type&&(this._shipCompare.windProfileRotate=e.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===e.type&&this._updateCompareWindProfiles()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",g.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`).text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>`rotate(${-e.initRotate})`).text(e=>this._getSpeed(e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>`rotate(${e.initRotate})`)}_drawWindProfile(){const e=Object(i.a)().sort(null).value(1)(this.shipData.speedDegrees),t=r.a,s=Object(o.a)().angle((e,t)=>t*u.q).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(t);this._shipCompare.windProfileRotate=0;const a=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-a,type:"windProfile"},d=this._mainG.append("g").datum(n).attr("class","wind-profile");d.append("path").attr("d",e=>String(Object(c.g)(e.compassTextX,e.compassTextY,20))+Object(c.h)(e.compassTextX,e.compassTextY,-e.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),d.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20);const p=d.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`).text(e=>this._getHeadingInCompass(e.initRotate));d.append("path").attr("class","base-profile").attr("d",s(e)),d.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(e).join(e=>e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*u.q)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*u.q)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).append("title").text(e=>Math.round(10*e.data)/10+" knots")),n.this=d,n.compassText=p,d.datum(n).attr("transform",e=>`rotate(${e.initRotate})`)}_printText(){var t;const s=b.a.getCannonsPerDeck(this.shipData.guns),a=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/f.h),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/f.n),r=Math.round(this.shipData.crew.max*f.o),o={acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${Object(n.d)(this.shipData.stern.armour)} <span class="badge badge-white">${Object(n.d)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:""+Object(n.d)(this.shipData.repairTime.bow),cannonBroadside:Object(n.d)(this.shipData.guns.broadside.cannons),cannonsPerDeck:s,carroBroadside:Object(n.d)(this.shipData.guns.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:Object(u.p)(this.shipData.guns.decks,"deck"),fireResistance:Object(n.g)(this.shipData.resistance.fire,0),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${Object(n.d)(this.shipData.bow.armour)} <span class="badge badge-white">${Object(n.d)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.d)(this.shipData.holdSize),hullRepairAmount:""+Object(n.d)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:`${Object(n.d)(a)} <span class="badge badge-white">${Object(n.d)(a*f.l)}</span>`,leakResistance:Object(n.g)(this.shipData.resistance.leaks,0),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(n.d)(this.shipData.mast.bottomArmour)} <span class="badge badge-white">${Object(n.d)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(n.d)(this.shipData.mast.middleArmour)} <span class="badge badge-white">${Object(n.d)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(n.d)(this.shipData.mast.topArmour)} <span class="badge badge-white">${Object(n.d)(this.shipData.mast.topThickness)}</span>`,maxCrew:Object(n.d)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.d)(this.shipData.maxWeight),minCrew:Object(n.d)(this.shipData.crew.min),cannonCrew:Object(n.d)(this.shipData.crew.cannons),carroCrew:Object(n.d)(this.shipData.crew.carronades),pump:Object(n.d)(this.shipData.pump.armour),repairTime:""+Object(n.d)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(n.d)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:`${Object(n.d)(i)} <span class="badge badge-white">${Object(n.d)(i*f.l)}</span>`,rudder:`${Object(n.d)(this.shipData.rudder.armour)} <span class="badge badge-white">${Object(n.d)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${Object(n.d)(r)} <span class="badge badge-white">${Object(n.d)(r*f.l)}</span>`,sailingCrew:Object(n.d)(null!==(t=this.shipData.crew.sailing)&&void 0!==t?t:0),sails:Object(n.d)(this.shipData.sails.armour),shipRating:Object(d.q)(this.shipData.class)+" rate",sideArmor:`${Object(n.d)(this.shipData.sides.armour)} <span class="badge badge-white">${Object(n.d)(this.shipData.sides.thickness)}</span>`,splinterResistance:Object(n.g)(this.shipData.resistance.splinter,0),sternRepair:""+Object(n.d)(this.shipData.repairTime.stern),structure:Object(n.d)(this.shipData.structure.armour),upgradeXP:Object(n.d)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight),cannonWeight:Object(n.d)(this.shipData.guns.weight.cannons),carroWeight:Object(n.d)(this.shipData.guns.weight.carronades)};o.repairWeight=Object(n.d)((a+i+.1*r)*f.l),o.gunsFront?o.gunsFront+=" "+b.a.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+b.a.pd(o.limitBack):o.gunsBack="–",e(""+this.select).find("div").append(b.a.getText(o))}}}).call(this,s(5))},147:function(e,t,s){(function(e){s.d(t,"a",(function(){return C}));var a=s(130),i=s(141),r=s(280),o=s(116),n=s(41),d=s(277),p=s(275),h=s(281),c=s(110),l=s(0),m=s(3),u=s(166),_=s.n(u),g=s(131),b=s(1),f=s(115);function D(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return v(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return v(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function S(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class C extends g.a{constructor(e,t,s,a){super(e,a),S(this,"shipCompareData",void 0),S(this,"_shipBaseData",void 0),S(this,"_speedScale",void 0),S(this,"_speedDiff",void 0),S(this,"_minSpeedDiff",void 0),S(this,"_maxSpeedDiff",void 0),S(this,"_shipRotate",void 0),S(this,"_speedText",void 0),S(this,"_drag",void 0),S(this,"_windProfile",void 0),S(this,"_gWindProfile",void 0),S(this,"_arcsComp",void 0),this._shipBaseData=t,this.shipCompareData=s,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(e,t){const s=Math.min(e,this._shipCompare.colourScaleSpeedDiff.domain()[0]),a=Math.max(t,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([s,0,a])}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(c.b)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(l.m)(e)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const e=this.shipCompareData.speedDegrees.length,t=360/e,s=new Array(e+1).fill(0).map((e,s)=>s*t);this._speedScale=Object(o.a)().domain(s).range([].concat(D(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=r.a().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=n.c;e.rotate=this._getHeadingInDegrees(Object(m.m)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>`rotate(${e.rotate})`),e.compassText.attr("transform",e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`).text(e=>this._getHeadingInCompass(e.rotate)),this._shipRotate=e.rotate,this._updateSpeedText()})()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipCompareData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",_.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`).text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>`rotate(${-e.initRotate})`).text(e=>this._getSpeed(this._shipCompare.windProfileRotate-e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>`rotate(${e.initRotate})`)}_drawDifferenceProfile(){var e,t;const s=Object(d.a)().sort(null).value(1),r=s(this._shipBaseData.speedDegrees);this._arcsComp=s(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((e,t)=>Object(l.t)(e-this._shipBaseData.speedDegrees[t])),this._minSpeedDiff=null!==(e=Object(a.a)(this._speedDiff))&&void 0!==e?e:0,this._maxSpeedDiff=null!==(t=Object(i.a)(this._speedDiff))&&void 0!==t?t:0;const o=p.a,n=Object(h.a)().angle((e,t)=>t*b.q).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(o),c=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-c,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(r)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(e=>{e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*b.q)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*b.q)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t])).append("title").text((e,t)=>`${Math.round(10*e.data)/10} (${Object(c.j)(this._speedDiff[t],1)}) knots`)}).select("circle").attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t]))}_injectTextComparison(){function t(e,t,s=0,a=!1){let i=Number.parseFloat((e-t).toFixed(s));return a&&(i*=100),i<0?`<span class="badge badge-danger">${Object(c.b)(Math.abs(i))}</span>`:i>0?`<span class="badge badge-success">${Object(c.b)(i)}</span>`:""}const s=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.h),a=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.n),i=Math.round(this._shipBaseData.crew.max*f.o),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.h),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.n),n=Math.round(this.shipCompareData.crew.max*f.o),d={acceleration:`${Object(c.b)(this.shipCompareData.ship.acceleration)} ${t(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${Object(c.d)(this.shipCompareData.stern.armour)} ${t(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.stern.thickness)}</span>${t(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${t(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${t(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:g.a.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${t(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${Object(c.b)(this.shipCompareData.ship.deceleration)} ${t(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,decks:`${this.shipCompareData.guns.decks} ${t(this.shipCompareData.guns.decks,this._shipBaseData.guns.decks)} deck${this.shipCompareData.guns.decks>1?"s":""}`,fireResistance:`${Object(c.g)(this.shipCompareData.resistance.fire,0)} ${t(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0)}`,firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${t(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${Object(c.d)(this.shipCompareData.bow.armour)} ${t(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.bow.thickness)}</span>${t(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${t(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${Object(c.b)(this.shipCompareData.rudder.halfturnTime,4)} ${t(this.shipCompareData.rudder.halfturnTime,this._shipBaseData.rudder.halfturnTime,2)}`,holdSize:`${Object(c.d)(this.shipCompareData.holdSize)} ${t(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${Object(c.d)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${t(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${Object(c.d)(r)} ${t(r,s)} <span class="badge badge-white">${Object(c.d)(r*f.l)}</span>`,leakResistance:`${Object(c.g)(this.shipCompareData.resistance.leaks,0)} ${t(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(c.d)(this.shipCompareData.mast.bottomArmour)} ${t(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.bottomThickness)}</span>${t(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(c.d)(this.shipCompareData.mast.middleArmour)} ${t(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.middleThickness)}</span>${t(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(c.d)(this.shipCompareData.mast.topArmour)} ${t(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.topThickness)}</span>${t(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${Object(c.d)(this.shipCompareData.crew.max)} ${t(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${Object(c.b)(this.shipCompareData.speed.max,4)} ${t(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxTurningSpeed:`${Object(c.b)(this.shipCompareData.rudder.turnSpeed,4)} ${t(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2)}`,maxWeight:`${Object(c.d)(this.shipCompareData.maxWeight)} ${t(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:`${Object(c.d)(this.shipCompareData.crew.min)} ${t(this.shipCompareData.crew.min,this._shipBaseData.crew.min)}`,cannonCrew:`${Object(c.d)(this.shipCompareData.crew.cannons)} ${t(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${Object(c.d)(this.shipCompareData.crew.carronades)} ${t(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${Object(c.b)(this.shipCompareData.speed.min)} ${t(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,pump:`${Object(c.d)(this.shipCompareData.pump.armour)} ${t(this.shipCompareData.pump.armour,this._shipBaseData.pump.armour)}`,repairTime:`${Object(c.d)(this.shipCompareData.repairTime.sides)} ${t(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${Object(c.d)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${t(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${Object(c.d)(o)} ${t(o,a)} <span class="badge badge-white">${Object(c.d)(o*f.l)}</span>`,rudder:`${Object(c.d)(this.shipCompareData.rudder.armour)} ${t(this.shipCompareData.rudder.armour,this._shipBaseData.rudder.armour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.rudder.thickness)}</span>${t(this.shipCompareData.rudder.thickness,this._shipBaseData.rudder.thickness)}`,rumRepairsNeeded:`${Object(c.d)(n)} ${t(n,i)} <span class="badge badge-white">${Object(c.d)(n*f.l)}</span>`,sailingCrew:`${Object(c.d)(this.shipCompareData.crew.sailing)} ${t(this.shipCompareData.crew.sailing,this._shipBaseData.crew.sailing)}`,sails:`${Object(c.d)(this.shipCompareData.sails.armour)} ${t(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:Object(l.q)(this.shipCompareData.class)+" rate",sideArmor:`${Object(c.d)(this.shipCompareData.sides.armour)} ${t(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)} <span class="badge badge-white">${Object(c.d)(this.shipCompareData.sides.thickness)}</span>${t(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${Object(c.g)(this.shipCompareData.resistance.splinter,0)} ${t(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${Object(c.d)(this.shipCompareData.structure.armour)} ${t(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${Object(c.d)(this.shipCompareData.upgradeXP)} ${t(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${Object(c.b)(this.shipCompareData.ship.waterlineHeight)} ${t(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${Object(c.d)(this.shipCompareData.guns.weight.cannons)} ${t(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${Object(c.d)(this.shipCompareData.guns.weight.carronades)} ${t(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${Object(c.d)((r+o+.1*n)*f.l)} ${t((s+a+.1*i)*f.l,(r+o+.1*n)*f.l)}`,d.gunsFront?d.gunsFront+=" "+g.a.pd(d.limitFront):d.gunsFront="–",d.gunsBack?d.gunsBack+=" "+g.a.pd(d.limitBack):d.gunsBack="–",e(""+this.select).find("div").append(g.a.getText(d))}}}).call(this,s(5))},165:function(e,t,s){s(131),s(146),s(147);var a=s(167);s.d(t,"a",(function(){return a.a}))},166:function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},167:function(e,t,s){(function(e){s.d(t,"a",(function(){return I}));s(63),s(14),s(34);var a=s(130),i=s(141),r=s(117),o=s(175),n=s(279),d=s(116),p=s(10),h=s(2),c=s.n(h),l=s(17),m=s.n(l),u=s(18),_=s.n(u),g=s(226),b=s.n(g),f=s(6),D=s(1),v=s(15),S=s(110),C=s(115),$=s(0),w=s(112),y=s(3),j=s(168),x=s(146),O=s(147);function k(e){return function(e){if(Array.isArray(e))return A(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return A(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function P(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}c.a.extend(m.a),c.a.extend(_.a);class I{constructor(e="ship-compare"){P(this,"colorScale",void 0),P(this,"colourScaleSpeedDiff",void 0),P(this,"columnsCompare",void 0),P(this,"innerRadius",void 0),P(this,"outerRadius",void 0),P(this,"radiusSpeedScale",void 0),P(this,"selectedShips",void 0),P(this,"singleShipData",void 0),P(this,"shipMassScale",void 0),P(this,"svgHeight",void 0),P(this,"svgWidth",void 0),P(this,"windProfileRotate",0),P(this,"woodCompare",void 0),P(this,"_maxSpeed",void 0),P(this,"_minSpeed",void 0),P(this,"_modal$",{}),P(this,"_modifierAmount",void 0),P(this,"_moduleAndWoodCaps",void 0),P(this,"_moduleAndWoodChanges",void 0),P(this,"_moduleDataDefault",void 0),P(this,"_moduleProperties",void 0),P(this,"_moduleTypes",void 0),P(this,"_selectedUpgradeIdsList",{}),P(this,"_selectedUpgradeIdsPerType",{}),P(this,"_selectModule$",{}),P(this,"_selectShip$",{}),P(this,"_selectWood$",{}),P(this,"_shipData",void 0),P(this,"_shipIds",{}),P(this,"_shipSelectData",void 0),P(this,"_baseId",void 0),P(this,"_baseName",void 0),P(this,"_buttonId",void 0),P(this,"_columns",void 0),P(this,"_copyButtonId",void 0),P(this,"_imageButtonId",void 0),P(this,"_modalId",void 0),P(this,"_moduleId",void 0),P(this,"_woodId",void 0),this._baseId=e,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._imageButtonId="button-image-"+this._baseId,this.colourScaleSpeedDiff=Object(d.a)().range([D.i,D.j,D.f]).interpolate(n.a),this._modifierAmount=new Map,"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(e){return e<=3?"L":e<=5?"M":"S"}static _adjustAbsolute(e,t){return e?e+t:t}static _adjustPercentage(e,t,s){return s?e?e*(1+t):t:e?e+t:t}static _getModifierFromModule(e){return`<p class="mb-0">${e.map(e=>{let t;return t=e.isPercentage?Object(S.l)(e.amount/100):e.amount<1&&e.amount>0?Object(S.f)(e.amount):Object(S.k)(e.amount),`${e.modifier} ${t}`}).join("<br>")}</p>`}static _setSelect(e,t){let s;s=Array.isArray(t)?t.map(e=>String(e)):String(t),s&&e.val(s),e.selectpicker("render")}static _saveCanvasAsImage(e){const t=`na-map ship compare ${c.a.utc().format("YYYY-MM-DD HH-mm-ss")}.png`,s=document.createElement("a");s.href=e,s.download=t,document.body.append(s),s.click(),s.remove()}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(e){var t;await this._loadAndSetupData();const s=C.f.decode(null!==(t=e.get("cmp"))&&void 0!==t?t:"");s.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(s),this._setModuleSelects(e))}_setupArrow(){const e=document.querySelector("#journey-arrow").cloneNode(!0);if(e.id="wind-profile-arrow-head",e.hasChildNodes())for(const t of e.childNodes)t.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(e)}_setupData(){var e,t,s;this._moduleAndWoodChanges=new Map([["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Speed decrease",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],cap:{amount:.4,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:.4,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:.4,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:.3,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:.3,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:16,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const r=1.2*(null!==(e=Object(a.a)(this._shipData,e=>e.speed.min))&&void 0!==e?e:0),o=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=r,this._maxSpeed=o,this.colorScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([D.i,D.j,D.f]).interpolate(n.a);const p=null!==(t=Object(a.a)(this._shipData,e=>e.shipMass))&&void 0!==t?t:0,h=null!==(s=Object(i.a)(this._shipData,e=>e.shipMass))&&void 0!==s?s:0;this.shipMassScale=Object(d.a)().domain([p,h]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await s.e(6).then(s.t.bind(null,135,3))).default,this._shipData=(await s.e(13).then(s.t.bind(null,171,3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new j.a(this._woodId),await this.woodCompare.woodInit())}catch(e){Object(v.e)(e)}}_setupListener(){var e;let t=!0;null===(e=document.querySelector("#"+this._buttonId))||void 0===e||e.addEventListener("click",async()=>{t&&(t=!1,await this._loadAndSetupData()),Object(f.b)("Tools",this._baseName),this._shipCompareSelected()})}_setGraphicsParameters(){var t;this.svgWidth=null!==(t=e(`#${this._modalId} .column-base`).width())&&void 0!==t?t:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(e){var t,s;return null!==(t=null===(s=this._shipData.find(t=>t.id===e))||void 0===s?void 0:s.name)&&void 0!==t?t:""}_getSelectedData(e){const t={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[e]){t.ship=this._getShipName(this._shipIds[e]);for(const s of v.g)t.wood.push(this.woodCompare.getWoodName(s,Number(this._selectWood$[e][s].val())));if(this._selectedUpgradeIdsPerType[e])for(const i of k(this._moduleTypes)){const r=[];for(const t of this._selectedUpgradeIdsPerType[e][i]){var s,a;r.push(null!==(s=null===(a=this._moduleProperties.get(t))||void 0===a?void 0:a.name.replace(" Bonus",""))&&void 0!==s?s:"")}t.moduleData.set(i,r.join(", "))}}return t}_printSelectedData(e,t,s){const a=e.querySelectorAll(`#${this._baseId}-${s.toLowerCase()} label`),i=a[0].parentNode,r=a[0].offsetHeight;for(const e of a)e.remove();const o=Object(p.a)(i).insert("div",":first-child").style("height",5*r+"px");t.ship&&o.append("div").style("margin-bottom","5px").style("line-height","1.1").text(t.ship),""!==t.wood[0]&&o.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(t.wood.join(" | "));for(const[e,s]of t.moduleData)""!==s&&o.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${e}</em>: ${s}`)}_replaceSelectsWithText(e){for(const t of this._columns){const s=this._getSelectedData(t);this._printSelectedData(e,s,t)}}async _makeImage(e){Object(f.b)("Menu","Ship compare image"),e.preventDefault();const t=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(t){const e=await b()(t,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:e=>e.classList.contains("central")||e.classList.contains("overlay")||e.classList.contains("navbar"),logging:!0,onclone:e=>{this._replaceSelectsWithText(e)},x:0,y:0});I._saveCanvasAsImage(e.toDataURL())}}_shipCompareSelected(){var t,s,a;Object(v.c)(this._modal$)&&(this._initModal(),this._modal$=e("#"+this._modalId),null===(t=document.querySelector("#"+this._modalId))||void 0===t||t.addEventListener("keydown",e=>{"KeyC"===e.key&&e.ctrlKey&&this._copyDataClicked(e)}),null===(s=document.querySelector("#"+this._copyButtonId))||void 0===s||s.addEventListener("click",e=>{this._copyDataClicked(e)}),null===(a=document.querySelector("#"+this._imageButtonId))||void 0===a||a.addEventListener("click",async e=>{await this._makeImage(e)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];for(const t of this._columns)if(this._shipIds[t]){e.push(this._shipIds[t]);for(const s of v.g)e.push(Number(this._selectWood$[t][s].val()))}return e}_copyDataClicked(e){Object(f.b)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length>0){const e=new URL(window.location.href);e.searchParams.set("v",encodeURIComponent(D.d)),e.searchParams.set("cmp",C.f.encode(t));for(const t of this._columns){const s=this._columns.indexOf(t);if(this._selectedUpgradeIdsPerType[t])for(const a of k(this._moduleTypes)){const i=k(this._moduleTypes).indexOf(a),r=this._selectedUpgradeIdsPerType[t][a];if(null==r?void 0:r.length){const t=`${s}${i}`;e.searchParams.set(t,C.f.encode(r))}}}Object(y.c)(e.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(o.b)().key(e=>String(e.class)).sortKeys(r.a).entries(this._shipData.map(e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns.total})).sort(Object(w.b)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(e=>e[1].filter(e=>e.properties.some(e=>this._moduleAndWoodChanges.has(e.modifier))).map(e=>[e.id,e]))),this._moduleTypes=new Set(k(this._moduleProperties).map(e=>e[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(D.n)({id:this._modalId,title:this._baseName});const e=Object(p.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const t of this._columns){const s=e.append("div").attr("id",`${this._baseId}-${t.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),a=this._getShipSelectId(t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker");for(const e of v.g){const a=this._getWoodSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}for(const e of this._moduleTypes){const a=this._getModuleSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}s.append("div").attr("id",`${this._baseId}-${t}`).attr("class",""+("Base"===t?"ship-base":"ship-compare"))}const t=Object(p.a)(`#${this._modalId} .modal-footer`);t.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),t.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._imageButtonId).attr("title","Make image").attr("type","button").append("i").classed("icon icon-image",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const t of this._columns){if(this._setupShipSelect(t),"ship-journey"!==this._baseId){this._selectWood$[t]={};for(const s of v.g)this._selectWood$[t][s]=e("#"+this._getWoodSelectId(s,t)),this.woodCompare._setupWoodSelects(t,s,this._selectWood$[t][s])}this._setupSelectListener(t)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(e=>`<optgroup label="${Object($.q)(Number(e.key),!1)} rate">${e.values.map(e=>`<option data-subtext="${e.battleRating} ${Object(C.j)(e.name)?"Imported":""}" value="${e.id}">${Object(C.p)(e.name)} (${e.guns})`).join("</option>")}`).join("</optgroup>")}_setupShipSelect(t){this._selectShip$[t]=e("#"+this._getShipSelectId(t));const s=this._getShipOptions();this._selectShip$[t].append(s),"Base"!==t&&this._selectShip$[t].attr("disabled","disabled")}_getUpgradesOptions(e,t){const s=Object(o.b)().key(e=>e[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(r.a).sortValues((e,t)=>e[1].name.localeCompare(t[1].name)).entries(k(this._moduleProperties).filter(s=>s[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===e&&("U"===s[1].moduleLevel||s[1].moduleLevel===I._getModuleLevel(t))));let a;const i=new Set(["Permanent","Ship trim"]);return a=s.length>1?s.map(t=>`<optgroup label="${t.key}" data-max-options="${i.has(e.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${t.values.map(e=>`<option value="${e[0]}">${e[1].name}`).join("</option>")}`).join("</optgroup>"):s.map(e=>""+e.values.map(e=>`<option value="${e[0]}">${e[1].name}`).join("</option>")).join(""),a}_fillModuleSelect(e,t){const s=this._getUpgradesOptions(t,(()=>this._shipData.find(t=>t.id===this._shipIds[e]).class)());this._selectModule$[e][t].find("option").remove(),this._selectModule$[e][t].append(s)}_resetModuleSelects(e){for(const t of this._moduleTypes)this._fillModuleSelect(e,t),this._selectModule$[e][t].selectpicker("refresh")}_getModuleFromName(e){let t={};return this._moduleDataDefault.some(s=>(t=s[1].find(t=>t.name===e),Boolean(t))),t}_setupModulesSelect(t){if(!this._selectModule$[t]){this._selectModule$[t]={};for(const s of this._moduleTypes)this._selectModule$[t][s]=e("#"+this._getModuleSelectId(s,t)),this._selectModule$[t][s].on("changed.bs.select",()=>{this._modulesSelected(t),this._refreshShips(t)}).on("show.bs.select",t=>{e(t.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",t=>{const s=e(t.currentTarget);for(const t of s.data("selectpicker").selectpicker.current.elements)if(!t.classList.contains("dropdown-divider")&&!t.classList.contains("dropdown-header")){const s=this._getModuleFromName(t.textContent);e(t).attr("data-original-title",I._getModifierFromModule(s.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:e=>`${e} ${s.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:s.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+s,width:"150px"})}this._resetModuleSelects(t)}_getShipData(e){const t=this._shipData.find(t=>t.id===this._shipIds[e]);let s=t;return s.repairAmount={armour:C.g,armourPerk:0,sails:C.m,sailsPerk:0},s.repairTime={sides:C.k,default:C.k},s.resistance={fire:0,leaks:0,splinter:0},s=this._addModulesAndWoodData(t,s,e),s}_adjustValue(e,t,s){var a,i;let r=e;if(null===(a=this._modifierAmount.get(t))||void 0===a?void 0:a.absolute){const{absolute:e}=this._modifierAmount.get(t);r=I._adjustAbsolute(r,e)}if(null===(i=this._modifierAmount.get(t))||void 0===i?void 0:i.percentage){const e=this._modifierAmount.get(t).percentage/100;r=I._adjustPercentage(r,e,s)}return Math.trunc(100*r)/100}_setModifier(e){let t=e.isPercentage?0:e.amount,s=e.isPercentage?e.amount:0;var a,i,r,o;this._modifierAmount.has(e.modifier)&&(t+=null!==(a=null===(i=this._modifierAmount.get(e.modifier))||void 0===i?void 0:i.absolute)&&void 0!==a?a:0,s+=null!==(r=null===(o=this._modifierAmount.get(e.modifier))||void 0===o?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(e.modifier,{absolute:t,percentage:s})}_showCappingAdvice(e,t){const s=`${this._baseId}-${e}-capping`;let a=document.querySelector("#"+s);if(!a){var i;a=document.createElement("p"),a.id=s,a.className="alert alert-warning";const t=document.querySelector(`#${this._baseId}-${e}`);null==t||null===(i=t.firstChild)||void 0===i||i.after(a)}a.innerHTML=k(t).join(", ")+" capped"}_removeCappingAdvice(e){const t=`${this._baseId}-${e}-capping`,s=document.querySelector("#"+t);s&&s.remove()}_addModulesAndWoodData(e,t,s){const a=JSON.parse(JSON.stringify(t)),i=()=>{a.speedDegrees=a.speedDegrees.map(e=>{const t=1+this._modifierAmount.get("Max speed").percentage/100,s=e>0?e*t:e/t;return Math.max(Math.min(s,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const e of this._selectedUpgradeIdsList[s]){const t=this._moduleProperties.get(e);for(const e of t.properties)this._moduleAndWoodChanges.has(e.modifier)&&this._setModifier(e)}if(this.woodCompare.instances[s]){let e="_woodData";"Base"!==s&&(e="_compareData");for(const t of v.g)for(const a of this.woodCompare.instances[s][e][t].properties)this._moduleAndWoodChanges.has(a.modifier)&&this._setModifier(a)}})(),(()=>{for(const[t]of this._modifierAmount.entries()){var e;if(null===(e=this._moduleAndWoodChanges.get(t))||void 0===e?void 0:e.properties){const{properties:e,isBaseValueAbsolute:s}=this._moduleAndWoodChanges.get(t);for(const i of e){const e=i.split(".");e.length>1?a[e[0]][e[1]]=this._adjustValue(a[e[0]][e[1]],t,s):a[e[0]]=this._adjustValue(a[e[0]],t,s)}}}})(),(()=>{const t={isCapped:!1,modifiers:new Set},i=(e,s,a,{amount:i,isPercentage:r})=>{const o=Math.min(s,r?a*(1+i):i);return s!==o&&(t.isCapped=!0,t.modifiers.add(e)),o};for(const[t]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(t)){const{cap:s}=this._moduleAndWoodCaps.get(t);for(const r of this._moduleAndWoodCaps.get(t).properties){const o=r.split(".");o.length>1?a[o[0]][o[1]]&&(a[o[0]][o[1]]=i(t,a[o[0]][o[1]],e[o[0]][o[1]],s)):a[o[0]]&&(a[o[0]]=i(t,a[o[0]],e[o[0]],s))}}t.isCapped?this._showCappingAdvice(s,t.modifiers):this._removeCappingAdvice(s)})(),this._modifierAmount.has("Max speed")&&i(),a}_updateDifferenceProfileNeeded(e){"Base"===e||Object(v.c)(this.selectedShips[e])||this.selectedShips[e].updateDifferenceProfile()}_updateSailingProfile(e){this._updateDifferenceProfileNeeded(e);for(const t of this.columnsCompare)t!==e&&this._updateDifferenceProfileNeeded(t)}_refreshShips(e){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(t=>t.id===this._shipIds[e]);else{this._modulesSelected(e);const t=this._getShipData(e);if("Base"===e){this._setSelectedShip(e,new x.a(e,t,this));for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),Object(v.c)(this.selectedShips[e])||this._setSelectedShip(e,new O.a(e,t,this.selectedShips[e].shipCompareData,this))}else this._setSelectedShip(e,new O.a(e,this.selectedShips.Base.shipData,t,this));this._updateSailingProfile(e)}}_enableCompareSelects(){for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={};for(const t of this._moduleTypes)this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map(e=>Number(e)):this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t]?[Number(this._selectedUpgradeIdsPerType[e][t])]:[],this._selectedUpgradeIdsPerType[e][t].length>0&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))}_setupSelectListener(e){if(this._selectShip$[e].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(e),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(e)}),"ship-journey"!==this._baseId)for(const t of v.g)this._selectWood$[e][t].on("changed.bs.select",()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)}).selectpicker({title:"Wood "+t,width:"150px"})}_setShipAndWoodsSelects(e){let t=0;this._columns.some(s=>{if(!this._shipData.find(s=>s.id===e[t]))return!1;if(this._shipIds[s]=e[t],t+=1,I._setSelect(this._selectShip$[s],this._shipIds[s]),"Base"===s&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(s),this._setupModulesSelect(s),e[t])for(const a of v.g)I._setSelect(this._selectWood$[s][a],e[t]),t+=1,this.woodCompare._woodSelected(s,a,this._selectWood$[s][a]);else t+=2;return this._refreshShips(s),t>=e.length})}_setModuleSelects(e){for(const s of this._columns){const a=this._columns.indexOf(s);let i=!1;for(const r of k(this._moduleTypes)){const o=k(this._moduleTypes).indexOf(r);if(e.has(`${a}${o}`)){var t;const n=C.f.decode(e.get(`${a}${o}`));this._selectedUpgradeIdsPerType[s]||(this._selectedUpgradeIdsPerType[s]={}),this._selectedUpgradeIdsList[s]||(this._selectedUpgradeIdsList[s]=[]),this._selectedUpgradeIdsPerType[s][r]=n.map(e=>Number(e)),I._setSelect(this._selectModule$[s][r],this._selectedUpgradeIdsPerType[s][r]),(t=this._selectedUpgradeIdsList[s]).push.apply(t,k(this._selectedUpgradeIdsPerType[s][r])),i=!0}}i&&this._refreshShips(s)}}_getShipSelectId(e){return`${this._baseId}-${e}-select`}_getWoodSelectId(e,t){return`${this._woodId}-${e}-${t}-select`}_getModuleSelectId(e,t){return`${this._moduleId}-${e.replace(/\s/,"")}-${t}-select`}_setSelectedShip(e,t){this.selectedShips[e]=t}}}).call(this,s(5))},168:function(e,t,s){(function(e){s.d(t,"a",(function(){return b}));s(14),s(34),s(113);var a=s(130),i=s(141),r=s(10),o=s(6),n=s(1),d=s(110),p=s(15),h=s(112);function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function m(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class u{constructor(e,t){m(this,"select",void 0),m(this,"_woodCompare",void 0),m(this,"_id",void 0),m(this,"_g",void 0),this._id=e,this._woodCompare=t,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(r.a)(this.select).select("g")}_setupMainDiv(){Object(r.a)(this.select+" div").remove(),Object(r.a)(this.select).append("div")}}class _ extends u{constructor(e,t,s){super(e,s),m(this,"_woodData",void 0),this._woodData=t,this._printText()}_getProperty(e,t){const s=this._woodData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),s=this._getProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';t+="<tr>",t+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,n]of e.properties){if(t+=`<tr><td>${o}</td><td>${n.isPercentage?Object(d.g)(n.amount/100):Object(d.b)(n.amount)}`,t+='<span class="rate">',n.amount>0){var s,a;t+='<span class="bar neutral" style="width:50%;"></span>',t+=`<span class="bar pos diff" style="width:${n.amount/(null!==(s=null===(a=this._woodCompare.minMaxProperty.get(o))||void 0===a?void 0:a.max)&&void 0!==s?s:1)*50}%;"></span>`}else if(n.amount<0){var i,r;const e=n.amount/(null!==(i=null===(r=this._woodCompare.minMaxProperty.get(o))||void 0===r?void 0:r.min)&&void 0!==i?i:1)*50;t+=`<span class="bar neutral" style="width:${50-e}%;"></span>`,t+=`<span class="bar neg diff" style="width:${e}%;"></span>`}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}return t+="</tbody></table>",t}_printText(){const t={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const e of this._woodCompare.propertyNames){const s=this._getPropertySum(e);t.properties.set(e,{amount:s.amount,isPercentage:s.isPercentage})}e(""+this.select).find("div").append(this._getText(t))}}class g extends u{constructor(e,t,s,a){super(e,a),m(this,"_baseData",void 0),m(this,"_compareData",void 0),this._baseData=t,this._compareData=s,this._printTextComparison()}static _getDiff(e,t,s,a=1){const i=Number.parseFloat((e-t).toFixed(a));return`${s?Object(d.g)(e/100,a):Object(d.b)(e)} <span class="badge badge-white">${Object(d.j)(i)}</span>`}_getBaseProperty(e,t){const s=this._baseData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),s=this._getBaseProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(e,t){const s=this._compareData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),s=this._getCompareProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:t.isPercentage&&s.isPercentage}}_getText(e){let t=0,s=0,a=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[b,f]of e.properties){var o,n,d,p;if(r+=`<tr><td>${b}</td><td>${g._getDiff(f.compare,f.base,f.isPercentage)}`,r+='<span class="rate">',f.compare>=0)f.base>=0?f.compare>f.base?(t=f.base,s=f.compare-f.base,i="pos"):(t=f.compare,s=f.base-f.compare,i="neg"):(t=0,s=f.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+=`<span class="bar pos diff" style="width:${t/(null!==(o=null===(n=this._woodCompare.minMaxProperty.get(b))||void 0===n?void 0:n.max)&&void 0!==o?o:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${s/(null!==(d=null===(p=this._woodCompare.minMaxProperty.get(b))||void 0===p?void 0:p.max)&&void 0!==d?d:1)*50}%;"></span>`;else if(f.compare<0){var h,c,l,m,u,_;f.base<0?f.compare>=f.base?(t=f.compare,s=f.base-f.compare,a=-f.base,i="pos"):(t=f.base,s=f.compare-f.base,a=-f.compare,i="neg"):(t=0,s=f.compare,a=-f.compare,i="neg"),r+=`<span class="bar neutral" style="width:${50+a/(null!==(h=null===(c=this._woodCompare.minMaxProperty.get(b))||void 0===c?void 0:c.min)&&void 0!==h?h:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${s/(null!==(l=null===(m=this._woodCompare.minMaxProperty.get(b))||void 0===m?void 0:m.min)&&void 0!==l?l:1)*50}%;"></span>`,r+=`<span class="bar neg diff" style="width:${t/(null!==(u=null===(_=this._woodCompare.minMaxProperty.get(b))||void 0===_?void 0:_.min)&&void 0!==u?u:1)*50}%;"></span>`}else r+='<span class="bar neutral"></span>';r+="</span></td></tr>"}return r+="</tbody></table>",r}_printTextComparison(){const t={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const e of this._woodCompare.propertyNames){const s=this._getBasePropertySum(e),a=this._getComparePropertySum(e);t.properties.set(e,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}e(""+this.select).find("div").append(this._getText(t))}}class b{constructor(e){m(this,"baseFunction",void 0),m(this,"instances",{}),m(this,"minMaxProperty",new Map),m(this,"propertyNames",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_woodData",void 0),m(this,"_columnsCompare",void 0),m(this,"_defaultWoodId",{}),m(this,"_columns",void 0),m(this,"_frameSelectData",void 0),m(this,"_trimSelectData",void 0),m(this,"_options",{}),m(this,"_woodIdsSelected",{}),this.baseFunction=e,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(e,t){var s,a;return null!==(s=null===(a=this._woodData[e].find(e=>e.id===t))||void 0===a?void 0:a.name)&&void 0!==s?s:""}_findWoodId(e,t){var s,a;return null!==(s=null===(a=this._woodData[e].find(e=>e.name===t))||void 0===a?void 0:a.id)&&void 0!==s?s:0}_setupData(){this.propertyNames=new Set([].concat(c(this._woodData.frame.flatMap(e=>e.properties.map(e=>e.modifier))),c(this._woodData.trim.flatMap(e=>e.properties.map(e=>e.modifier)))).sort(h.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await s.e(14).then(s.t.bind(null,149,3))).default,this._setupData()}catch(e){Object(p.e)(e)}}_setupListener(){var e;let t=!0;null===(e=document.querySelector("#"+this._buttonId))||void 0===e||e.addEventListener("click",async()=>{t&&(t=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),e("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(h.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(h.b)(["name"])),this._setOption(this._frameSelectData.map(e=>`<option value="${e.id}">${e.name}</option>`).toString(),this._trimSelectData.map(e=>`<option value="${e.id}">${e.name}</option>`).toString());for(const o of this.propertyNames){var e,t,s,r;const n=c(this._woodData.frame.map(e=>{var t,s;return null!==(t=null===(s=e.properties.find(e=>e.modifier===o))||void 0===s?void 0:s.amount)&&void 0!==t?t:0})),d=c(this._woodData.trim.map(e=>{var t,s;return null!==(t=null===(s=e.properties.find(e=>e.modifier===o))||void 0===s?void 0:s.amount)&&void 0!==t?t:0})),p=null!==(e=Object(a.a)(n))&&void 0!==e?e:0,h=null!==(t=Object(i.a)(n))&&void 0!==t?t:0,l=null!==(s=Object(a.a)(d))&&void 0!==s?s:0,m=null!==(r=Object(i.a)(d))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:p+l>=0?0:p+l,max:h+m})}}_injectModal(){Object(n.n)({id:this._modalId,title:this._baseName});const e=Object(r.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const t of this._columns){const s=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));for(const e of p.g){const a=`${this.baseFunction}-${e}-${t}-select`;s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}s.append("div").attr("id",`${this.baseFunction}-${t}`)}}_initModal(){this._initData(),this._injectModal();for(const t of this._columns)for(const s of p.g){const a=e(`#${this.baseFunction}-${s}-${t}-select`);this._setupWoodSelects(t,s,a),this._setupSelectListener(t,s,a)}}_setWoodsSelected(e,t,s){this._woodIdsSelected[e]||(this._woodIdsSelected[e]={}),this._woodIdsSelected[e][t]=s}_setupWoodSelects(e,t,s){this._setWoodsSelected(e,t,this._defaultWoodId[t]),s.append(this._options[t]),("wood"!==this.baseFunction||"Base"!==e&&"wood"===this.baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(t,s){const a="frame"===s?"trim":"frame";this._woodIdsSelected[t][a]===this._defaultWoodId[a]&&e(`#${this.baseFunction}-${a}-${t}-select`).val(this._defaultWoodId[a]).selectpicker("refresh")}enableSelects(t){for(const s of p.g)e(`#${this.baseFunction}-${s}-${t}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(e,t,s){const a=Number(s.val());if(this._setWoodsSelected(e,t,a),this._setOtherSelect(e,t),"Base"===e){this._addInstance(e,new _("Base",this._getWoodData("Base"),this));for(const e of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(e),this.instances[e]&&this._addInstance(e,new g(e,this._getWoodData("Base"),this._getWoodData(e),this))}else this._addInstance(e,new g(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,s){s.on("change",()=>this._woodSelected(e,t,s)).selectpicker({title:"Select "+t})}_getWoodData(e){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[e].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[e].trim)}}_addMinMaxProperty(e,t){this.minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this.instances[e]=t}getWoodTypeData(e,t){var s;return null!==(s=this._woodData[e].find(e=>e.id===t))&&void 0!==s?s:{}}}}).call(this,s(5))}}]);