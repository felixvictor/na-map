/*! For license information please see map.a456527581e1e36b8973.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{"1Dm9":function(t,e,i){(function(t){i.d(e,"a",(function(){return _}));i("UxlC"),i("WUlJ"),i("gQ/v"),i("ry7D"),i("dbdZ");var s=i("wz8V"),a=i("sCaM"),o=i("VIqg"),r=i("AKWm"),n=i("pxNS"),l=i("Qs7V"),d=i("otg8"),h=i("m+OL"),c=i("1RyA");function p(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _{constructor(t,e,i,s,a){m(this,"show",void 0),m(this,"_serverName",void 0),m(this,"_portSelect",void 0),m(this,"_isDataLoaded",void 0),m(this,"_minScale",void 0),m(this,"_scale",void 0),m(this,"_fontSize",void 0),m(this,"_numTrades",void 0),m(this,"_arrowX",void 0),m(this,"_arrowY",void 0),m(this,"_baseId",void 0),m(this,"_nationSelectId",void 0),m(this,"_listType",void 0),m(this,"_showId",void 0),m(this,"_showRadioValues",void 0),m(this,"_showCookie",void 0),m(this,"_showRadios",void 0),m(this,"_profitId",void 0),m(this,"_profitRadioValues",void 0),m(this,"_profitCookie",void 0),m(this,"_profitRadios",void 0),m(this,"_profitValue",void 0),m(this,"_lowerBound",void 0),m(this,"_upperBound",void 0),m(this,"_profitText",void 0),m(this,"_g",void 0),m(this,"_labelG",void 0),m(this,"_tradeDetailsDiv",void 0),m(this,"_tradeDetailsHead",void 0),m(this,"_nationSelector",void 0),m(this,"_list",void 0),m(this,"_linkDataDefault",void 0),m(this,"_linkData",void 0),m(this,"_portData",void 0),m(this,"_nodeData",void 0),m(this,"_linkDataFiltered",void 0),m(this,"_portDataFiltered",void 0),m(this,"_tradeItem",void 0),this._serverName=t,this._portSelect=e,this._minScale=i,this._scale=this._minScale,this._fontSize=d.i,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=this._baseId+"-nation-select",this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new h.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new c.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new h.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new c.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(s,a),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _hideDetails(e,i,s){t(Object(r.a)(s[i]).node()).tooltip("dispose")}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=Object(r.a)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(r.a)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=Object(r.a)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const e=""+n.e.map(t=>`<option value="${t.short}" selected>${t.name}</option>`).join(""),i=this._baseId+"-card";this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const s=this._tradeDetailsHead.append("label"),a=s.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText(t){let e="";return e=t===n.e.length?"All":String(t),e+" nations selected"},title:"Select nations"}),s.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#"+i).text("Info"),this._tradeDetailsHead.append("div").attr("id",i).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,s=t.append("div").attr("class","custom-control custom-radio custom-control-inline");s.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),s.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector("#"+this._showId))||void 0===t||t.addEventListener("change",async()=>this._showSelected()),null===(e=document.querySelector("#"+this._profitId))||void 0===e||e.addEventListener("change",()=>this._profitValueSelected()),this._nationSelector.addEventListener("change",t=>{this._nationChanged(),t.preventDefault()})}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map(t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}])),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map(t=>{let e=0;switch(this._profitValue){case"weight":e=_._getProfitPerWeight(t);break;case"distance":e=_._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error("Wrong profit value "+this._profitValue)}return t.profit=e,t}).sort((t,e)=>{var i,s;return null!==(i=e.profit)&&void 0!==i?i:0-(null!==(s=t.profit)&&void 0!==s?s:0)})}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){try{const t=(await i.e(12).then(i.t.bind(null,"0dXp",3))).default,e=await(await fetch(`data/${this._serverName}-pb.json`)).json();this._linkDataDefault=await(await fetch(`data/${this._serverName}-trades.json`)).json(),this._portData=t.map(t=>{const i=e.find(e=>e.id===t.id);return{...t,...i}});const s=await(await fetch(`data/${this._serverName}-items.json`)).json();this._tradeItem=new Map(s.map(t=>[t.id,t.name]))}catch(t){Object(n.f)(t)}}async _loadAndSetupData(){try{await this._loadData(),this._setupData()}catch(t){Object(n.f)(t)}}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then(()=>{this._isDataLoaded=!0}),_._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(_._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e,i;return null===(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.isShallow)||void 0===e||e}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){var e;const i=t.weightPerItem*t.quantity;let s="";return s+=_._addInfo(`${Object(l.c)(t.quantity)} ${this._tradeItem.get(t.good)}`)+_._addDes("trade"),s+=_._addInfo(""+Object(l.g)(null!==(e=t.profit)&&void 0!==e?e:0))+_._addDes(this._profitText),s+=_._addInfo(`${Object(l.h)(i)} ${1===i?"ton":"tons"}`)+_._addDes("weight"),s+=_._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+_._addDes("from "+this._getDepth(t.source.id)),s+=_._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+_._addDes("to "+this._getDepth(t.target.id)),s+=_._addInfo(Object(l.h)(t.distance)+" k")+_._addDes("distance"),s}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,s=_._getProfitPerDistance(t),a=_._getProfitPerWeight(t);let o="";return o+=_._startBlock("Trade"),o+=_._addInfo(`${Object(l.c)(t.quantity)} ${this._tradeItem.get(t.good)}`)+_._addDes("good"),o+=_._addInfo(""+Object(l.g)(t.source.grossPrice))+_._addDes("gross buy price"),o+=_._addInfo(""+Object(l.g)(t.target.grossPrice))+_._addDes("gross sell price"),o+=_._addInfo(`${Object(l.h)(e)} ${1===e?"ton":"tons"}`)+_._addDes("weight"),o+=_._endBlock(),o+=_._startBlock("Profit"),o+=_._addInfo(""+Object(l.g)(t.profitTotal))+_._addDes("total"),o+=_._addInfo(""+Object(l.g)(i))+_._addDes("profit/item"),o+=_._addInfo(""+Object(l.g)(s))+_._addDes("profit/distance"),o+=_._addInfo(""+Object(l.g)(a))+_._addDes("profit/weight"),o+=_._endBlock(),o+=_._startBlock("Route"),o+=_._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+_._addDes("from "+this._getDepth(t.source.id)),o+=_._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+_._addDes("to "+this._getDepth(t.source.id)),o+=_._addInfo(Object(l.h)(t.distance)+" k")+_._addDes("distance"),o+=_._endBlock(),o}_showDetails(e,i,s){const a=Object(r.a)(s[i]),o=this._getTradeFullData(e);t(a.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:o,trigger:"manual",sanitize:!1}).tooltip("show")}_getSiblingLinks(t,e){return this._linkDataFiltered.filter(i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t).map(t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0})}_getXCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.x)&&void 0!==e?e:0}_getYCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.y)&&void 0!==e?e:0}_updateGraph(){const t=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},s={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},o=t?i.x:s.x,r=t?i.y:s.y,n=t?s.x:i.x,l=t?s.y:i.y;let d=Math.sqrt((n-o)**2+(l-r)**2);const h=t?0:1,c=this._getSiblingLinks(e.source.id,e.target.id);if(c.length>1){var p,u;const t=Object(a.b)().domain(c).range([1,c.length]);d/=1+1/c.length*(null!==(p=t(null!==(u=e.profit)&&void 0!==u?u:0))&&void 0!==p?p:-1)}return d=Math.round(d),`M${o},${r}A${d},${d} 0,0,${h} ${n},${l}`},e=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,i=Object(s.a)(this._linkDataFiltered,t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0}),r=Object(o.a)().range([5/this._scale,15/this._scale]).domain(i),n=2**Math.log2(Math.abs(this._minScale)+this._scale),h=Object(d.t)(this._fontSize/n);this._g.selectAll(".trade-link").data(e,t=>_._getId(t)).join(t=>t.append("path").attr("class","trade-link").attr("marker-start",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)").attr("marker-end",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"").attr("id",t=>_._getId(t)).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",_._hideDetails)).attr("d",e=>t(this._getXCoord(e.source.id)<this._getXCoord(e.target.id),e)).attr("stroke-width",t=>{var e;return r(null!==(e=t.profit)&&void 0!==e?e:0)+"px"}),this._labelG.attr("font-size",h+"px"),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,t=>_._getId(t)).join(t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",t=>"#"+_._getId(t)).text(t=>`${Object(l.c)(t.quantity)} ${t.good}`)).attr("dy",t=>{var e;return`-${r(null!==(e=t.profit)&&void 0!==e?e:0)/1.5}px`})}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],_._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,_._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(null!=t?t:"")}_updatePortList(t){this._list.html(null!=t?t:"")}_updateTradeList(){let t;const e=e=>{t=Object(r.a)("path#"+_._getId(e)).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,t=>_._getId(t)).join(t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i)).html(t=>this._getTradeLimitedData(t))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]).map(t=>t.id));this._linkDataFiltered=this._linkData.filter(e=>t.has(e.source.id)||t.has(e.target.id)).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter(t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id)).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set(p(this._nationSelector.selectedOptions).map(t=>t.value));this._portDataFiltered=new Set(this._portData.filter(e=>t.has(e.nation)).map(t=>t.id))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t,e){this._lowerBound=t,this._upperBound=e}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}}).call(this,i("xeH2"))},"1Gn1":function(t,e,i){i.d(e,"a",(function(){return I}));var s=i("RhHs"),a=i("AKWm"),o=i("AWXE"),r=i("VIqg"),n=i("otg8"),l=i("Qs7V");function d(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function h(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var c=new WeakMap,p=new WeakMap,u=new WeakMap,m=new WeakMap,_=new WeakMap,g=new WeakMap,f=new WeakMap,b=new WeakMap,v=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,D=new WeakMap,x=new WeakMap,j=new WeakMap,C=new WeakMap,k=new WeakMap,O=new WeakMap,P=new WeakMap;class I{constructor(t){c.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:!1}),u.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),h(this,u,t),h(this,c,"on"===d(this,u).showGrid),h(this,m,d(this,u).coord.min),h(this,_,d(this,u).coord.max),h(this,g,d(this,u).height),h(this,f,d(this,u).width),h(this,b,d(this,u).rem),h(this,v,d(this,u).xGridBackgroundHeight),h(this,y,d(this,u).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){h(this,w,Object(r.a)().clamp(!0).domain([Object(n.f)(d(this,m),d(this,m)),Object(n.f)(d(this,_),d(this,_))]).range([d(this,m),d(this,_)])),h(this,S,Object(r.a)().clamp(!0).domain([Object(n.g)(d(this,m),d(this,m)),Object(n.g)(d(this,_),d(this,_))]).range([d(this,m),d(this,_)]))}_setupAxis(){const t=this._getTicks(65);h(this,D,Object(s.a)(d(this,w)).tickFormat(t=>Object(l.a)(t)).tickValues(t).tickSize(d(this,_))),h(this,x,Object(s.c)(d(this,S)).tickFormat(t=>Object(l.a)(t)).tickValues(t).tickSize(d(this,_)));const e=Object(a.a)("#map");h(this,C,e.insert("g","g.pb").attr("class","axis d-none")),h(this,O,d(this,C).append("g")),h(this,k,e.insert("g","g.pb").attr("class","axis d-none")),h(this,P,d(this,k).append("g")),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round(Object(n.g)(d(this,m),d(this,m))),i=Math.round(Object(n.g)(d(this,_),d(this,_))),s=(i-e)/(t-1),a=[];for(let t=s;t<i;t+=s)a.push(Math.round(t));a.push(i);const o=a.slice(0).reverse().map(t=>-t);return o.push(0),o.concat(a)}_setupXAxis(){d(this,O).selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),d(this,O).attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){d(this,P).attr("text-anchor","end").attr("fill",null).attr("font-family",null),d(this,P).selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){const t=o.c?o.c.transform.k:1,e=Object(n.t)(d(this,b)/t),i=Object(n.t)(1/t),s=o.c?o.c.transform.y:0,a=s/t<d(this,f)?s/t:0,r=-d(this,_)-a,l=o.c?o.c.transform.x:0,h=l/t<d(this,g)?l/t:0,c=-d(this,_)-h;d(this,O).attr("font-size",e).attr("stroke-width",i).call(d(this,D).tickPadding(r)),d(this,P).attr("font-size",e).attr("stroke-width",i).call(d(this,x).tickPadding(c))}get show(){return d(this,c)}set show(t){h(this,c,t)}get zoomLevel(){return d(this,j)}set zoomLevel(t){h(this,j,t)}update(){let t=!1;d(this,c)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),d(this,p)&&this.gridToggle(t)}transform(){d(this,c)&&(this.testForInitialisation(),this._displayAxis())}gridToggle(t){d(this,u).gridOverlay.classList.toggle("overlay-grid",t),d(this,u).gridOverlay.classList.toggle("overlay-no-grid",!t),d(this,C).classed("d-none",!t),d(this,k).classed("d-none",!t)}testForInitialisation(){d(this,p)||(this._setupSvg(),h(this,p,!0))}}},"1mfJ":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},"2Coy":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d2ccc2' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"2TRZ":function(t,e,i){i.d(e,"a",(function(){return C})),i.d(e,"c",(function(){return f})),i.d(e,"b",(function(){return g}));var s=i("xo8x"),a=i("tU+D"),o=Math.SQRT2;function r(t){return((t=Math.exp(t))+1/t)/2}var n=function(t,e){var i,s,a=t[0],n=t[1],l=t[2],d=e[0],h=e[1],c=e[2],p=d-a,u=h-n,m=p*p+u*u;if(m<1e-12)s=Math.log(c/l)/o,i=function(t){return[a+t*p,n+t*u,l*Math.exp(o*t*s)]};else{var _=Math.sqrt(m),g=(c*c-l*l+4*m)/(2*l*2*_),f=(c*c-l*l-4*m)/(2*c*2*_),b=Math.log(Math.sqrt(g*g+1)-g),v=Math.log(Math.sqrt(f*f+1)-f);s=(v-b)/o,i=function(t){var e,i=t*s,d=r(b),h=l/(2*_)*(d*(e=o*i+b,((e=Math.exp(2*e))-1)/(e+1))-function(t){return((t=Math.exp(t))-1/t)/2}(b));return[a+h*p,n+h*u,l*d/r(o*i+b)]}}return i.duration=1e3*s,i},l=i("AWXE"),d=i("4k54"),h=i("AKWm"),c=i("YJZE"),p=i("sQjb"),u=function(t){return function(){return t}};function m(t,e,i){this.target=t,this.type=e,this.transform=i}function _(t,e,i){this.k=t,this.x=e,this.y=i}_.prototype={constructor:_,scale:function(t){return 1===t?this:new _(this.k*t,this.x,this.y)},translate:function(t,e){return 0===t&0===e?this:new _(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};var g=new _(1,0,0);function f(t){for(;!t.__zoom;)if(!(t=t.parentNode))return g;return t.__zoom}function b(){l.c.stopImmediatePropagation()}f.prototype=_.prototype;var v=function(){l.c.preventDefault(),l.c.stopImmediatePropagation()};function y(){return!l.c.ctrlKey&&!l.c.button}function w(){var t=this;return t instanceof SVGElement?(t=t.ownerSVGElement||t).hasAttribute("viewBox")?[[(t=t.viewBox.baseVal).x,t.y],[t.x+t.width,t.y+t.height]]:[[0,0],[t.width.baseVal.value,t.height.baseVal.value]]:[[0,0],[t.clientWidth,t.clientHeight]]}function S(){return this.__zoom||g}function D(){return-l.c.deltaY*(1===l.c.deltaMode?.05:l.c.deltaMode?1:.002)}function x(){return navigator.maxTouchPoints||"ontouchstart"in this}function j(t,e,i){var s=t.invertX(e[0][0])-i[0][0],a=t.invertX(e[1][0])-i[1][0],o=t.invertY(e[0][1])-i[0][1],r=t.invertY(e[1][1])-i[1][1];return t.translate(a>s?(s+a)/2:Math.min(0,s)||Math.max(0,a),r>o?(o+r)/2:Math.min(0,o)||Math.max(0,r))}var C=function(){var t,e,i=y,o=w,r=j,f=D,C=x,k=[0,1/0],O=[[-1/0,-1/0],[1/0,1/0]],P=250,I=n,$=Object(s.a)("start","zoom","end"),T=0;function A(t){t.property("__zoom",S).on("wheel.zoom",W).on("mousedown.zoom",E).on("dblclick.zoom",F).filter(C).on("touchstart.zoom",H).on("touchmove.zoom",V).on("touchend.zoom touchcancel.zoom",G).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function M(t,e){return(e=Math.max(k[0],Math.min(k[1],e)))===t.k?t:new _(e,t.x,t.y)}function B(t,e,i){var s=e[0]-i[0]*t.k,a=e[1]-i[1]*t.k;return s===t.x&&a===t.y?t:new _(t.k,s,a)}function N(t){return[(+t[0][0]+ +t[1][0])/2,(+t[0][1]+ +t[1][1])/2]}function L(t,e,i){t.on("start.zoom",(function(){z(this,arguments).start()})).on("interrupt.zoom end.zoom",(function(){z(this,arguments).end()})).tween("zoom",(function(){var t=this,s=arguments,a=z(t,s),r=o.apply(t,s),n=null==i?N(r):"function"==typeof i?i.apply(t,s):i,l=Math.max(r[1][0]-r[0][0],r[1][1]-r[0][1]),d=t.__zoom,h="function"==typeof e?e.apply(t,s):e,c=I(d.invert(n).concat(l/d.k),h.invert(n).concat(l/h.k));return function(t){if(1===t)t=h;else{var e=c(t),i=l/e[2];t=new _(i,n[0]-e[0]*i,n[1]-e[1]*i)}a.zoom(null,t)}}))}function z(t,e,i){return!i&&t.__zooming||new R(t,e)}function R(t,e){this.that=t,this.args=e,this.active=0,this.extent=o.apply(t,e),this.taps=0}function W(){if(i.apply(this,arguments)){var t=z(this,arguments),e=this.__zoom,s=Math.max(k[0],Math.min(k[1],e.k*Math.pow(2,f.apply(this,arguments)))),a=Object(d.a)(this);if(t.wheel)t.mouse[0][0]===a[0]&&t.mouse[0][1]===a[1]||(t.mouse[1]=e.invert(t.mouse[0]=a)),clearTimeout(t.wheel);else{if(e.k===s)return;t.mouse=[a,e.invert(a)],Object(p.a)(this),t.start()}v(),t.wheel=setTimeout(o,150),t.zoom("mouse",r(B(M(e,s),t.mouse[0],t.mouse[1]),t.extent,O))}function o(){t.wheel=null,t.end()}}function E(){if(!e&&i.apply(this,arguments)){var t=z(this,arguments,!0),s=Object(h.a)(l.c.view).on("mousemove.zoom",u,!0).on("mouseup.zoom",m,!0),o=Object(d.a)(this),n=l.c.clientX,c=l.c.clientY;Object(a.a)(l.c.view),b(),t.mouse=[o,this.__zoom.invert(o)],Object(p.a)(this),t.start()}function u(){if(v(),!t.moved){var e=l.c.clientX-n,i=l.c.clientY-c;t.moved=e*e+i*i>T}t.zoom("mouse",r(B(t.that.__zoom,t.mouse[0]=Object(d.a)(t.that),t.mouse[1]),t.extent,O))}function m(){s.on("mousemove.zoom mouseup.zoom",null),Object(a.b)(l.c.view,t.moved),v(),t.end()}}function F(){if(i.apply(this,arguments)){var t=this.__zoom,e=Object(d.a)(this),s=t.invert(e),a=t.k*(l.c.shiftKey?.5:2),n=r(B(M(t,a),e,s),o.apply(this,arguments),O);v(),P>0?Object(h.a)(this).transition().duration(P).call(L,n,e):Object(h.a)(this).call(A.transform,n)}}function H(){if(i.apply(this,arguments)){var e,s,a,o,r=l.c.touches,n=r.length,d=z(this,arguments,l.c.changedTouches.length===n);for(b(),s=0;s<n;++s)a=r[s],o=[o=Object(c.a)(this,r,a.identifier),this.__zoom.invert(o),a.identifier],d.touch0?d.touch1||d.touch0[2]===o[2]||(d.touch1=o,d.taps=0):(d.touch0=o,e=!0,d.taps=1+!!t);t&&(t=clearTimeout(t)),e&&(d.taps<2&&(t=setTimeout((function(){t=null}),500)),Object(p.a)(this),d.start())}}function V(){if(this.__zooming){var e,i,s,a,o=z(this,arguments),n=l.c.changedTouches,d=n.length;for(v(),t&&(t=clearTimeout(t)),o.taps=0,e=0;e<d;++e)i=n[e],s=Object(c.a)(this,n,i.identifier),o.touch0&&o.touch0[2]===i.identifier?o.touch0[0]=s:o.touch1&&o.touch1[2]===i.identifier&&(o.touch1[0]=s);if(i=o.that.__zoom,o.touch1){var h=o.touch0[0],p=o.touch0[1],u=o.touch1[0],m=o.touch1[1],_=(_=u[0]-h[0])*_+(_=u[1]-h[1])*_,g=(g=m[0]-p[0])*g+(g=m[1]-p[1])*g;i=M(i,Math.sqrt(_/g)),s=[(h[0]+u[0])/2,(h[1]+u[1])/2],a=[(p[0]+m[0])/2,(p[1]+m[1])/2]}else{if(!o.touch0)return;s=o.touch0[0],a=o.touch0[1]}o.zoom("touch",r(B(i,s,a),o.extent,O))}}function G(){if(this.__zooming){var t,i,s=z(this,arguments),a=l.c.changedTouches,o=a.length;for(b(),e&&clearTimeout(e),e=setTimeout((function(){e=null}),500),t=0;t<o;++t)i=a[t],s.touch0&&s.touch0[2]===i.identifier?delete s.touch0:s.touch1&&s.touch1[2]===i.identifier&&delete s.touch1;if(s.touch1&&!s.touch0&&(s.touch0=s.touch1,delete s.touch1),s.touch0)s.touch0[1]=this.__zoom.invert(s.touch0[0]);else if(s.end(),2===s.taps){var r=Object(h.a)(this).on("dblclick.zoom");r&&r.apply(this,arguments)}}}return A.transform=function(t,e,i){var s=t.selection?t.selection():t;s.property("__zoom",S),t!==s?L(t,e,i):s.interrupt().each((function(){z(this,arguments).start().zoom(null,"function"==typeof e?e.apply(this,arguments):e).end()}))},A.scaleBy=function(t,e,i){A.scaleTo(t,(function(){var t=this.__zoom.k,i="function"==typeof e?e.apply(this,arguments):e;return t*i}),i)},A.scaleTo=function(t,e,i){A.transform(t,(function(){var t=o.apply(this,arguments),s=this.__zoom,a=null==i?N(t):"function"==typeof i?i.apply(this,arguments):i,n=s.invert(a),l="function"==typeof e?e.apply(this,arguments):e;return r(B(M(s,l),a,n),t,O)}),i)},A.translateBy=function(t,e,i){A.transform(t,(function(){return r(this.__zoom.translate("function"==typeof e?e.apply(this,arguments):e,"function"==typeof i?i.apply(this,arguments):i),o.apply(this,arguments),O)}))},A.translateTo=function(t,e,i,s){A.transform(t,(function(){var t=o.apply(this,arguments),a=this.__zoom,n=null==s?N(t):"function"==typeof s?s.apply(this,arguments):s;return r(g.translate(n[0],n[1]).scale(a.k).translate("function"==typeof e?-e.apply(this,arguments):-e,"function"==typeof i?-i.apply(this,arguments):-i),t,O)}),s)},R.prototype={start:function(){return 1==++this.active&&(this.that.__zooming=this,this.emit("start")),this},zoom:function(t,e){return this.mouse&&"mouse"!==t&&(this.mouse[1]=e.invert(this.mouse[0])),this.touch0&&"touch"!==t&&(this.touch0[1]=e.invert(this.touch0[0])),this.touch1&&"touch"!==t&&(this.touch1[1]=e.invert(this.touch1[0])),this.that.__zoom=e,this.emit("zoom"),this},end:function(){return 0==--this.active&&(delete this.that.__zooming,this.emit("end")),this},emit:function(t){Object(l.a)(new m(A,t,this.that.__zoom),$.apply,$,[t,this.that,this.args])}},A.wheelDelta=function(t){return arguments.length?(f="function"==typeof t?t:u(+t),A):f},A.filter=function(t){return arguments.length?(i="function"==typeof t?t:u(!!t),A):i},A.touchable=function(t){return arguments.length?(C="function"==typeof t?t:u(!!t),A):C},A.extent=function(t){return arguments.length?(o="function"==typeof t?t:u([[+t[0][0],+t[0][1]],[+t[1][0],+t[1][1]]]),A):o},A.scaleExtent=function(t){return arguments.length?(k[0]=+t[0],k[1]=+t[1],A):[k[0],k[1]]},A.translateExtent=function(t){return arguments.length?(O[0][0]=+t[0][0],O[1][0]=+t[1][0],O[0][1]=+t[0][1],O[1][1]=+t[1][1],A):[[O[0][0],O[0][1]],[O[1][0],O[1][1]]]},A.constrain=function(t){return arguments.length?(r=t,A):r},A.duration=function(t){return arguments.length?(P=+t,A):P},A.interpolate=function(t){return arguments.length?(I=t,A):I},A.on=function(){var t=$.on.apply($,arguments);return t===$?A:t},A.clickDistance=function(t){return arguments.length?(T=(t=+t)*t,A):Math.sqrt(T)},A}},"3YHm":function(t,e,i){t.exports=i.p+"images/flags/PR.svg"},"5Bip":function(t,e,i){t.exports=function(t,e,i){e.prototype.isBetween=function(t,e,s,a){var o=i(t),r=i(e),n="("===(a=a||"()")[0],l=")"===a[1];return(n?this.isAfter(o,s):!this.isBefore(o,s))&&(l?this.isBefore(r,s):!this.isAfter(r,s))||(n?this.isBefore(o,s):!this.isAfter(o,s))&&(l?this.isAfter(r,s):!this.isBefore(r,s))}}},"7D/U":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"7PF8":function(t,e,i){(function(t){i.d(e,"a",(function(){return y}));i("WUlJ"),i("fCtr");var s=i("Mn03"),a=i("NltA"),o=i("AJ/N"),r=i("VIqg"),n=i("AWXE"),l=i("AKWm"),d=i("+ugm"),h=i("2TRZ"),c=(i("b6Yt"),i("Iohx"),i("pOjD")),p=i("Q4du"),u=i("Qs7V"),m=i("otg8"),_=i("dNoP"),g=i("u3gz");function f(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class y{constructor(t){v(this,"_fontSize",void 0),v(this,"_compassRadius",void 0),v(this,"_courseArrowWidth",void 0),v(this,"_line",void 0),v(this,"_labelPadding",void 0),v(this,"_degreesPerMinute",void 0),v(this,"_degreesSegment",void 0),v(this,"_minOWSpeed",void 0),v(this,"_owSpeedFactor",void 0),v(this,"_speedScale",void 0),v(this,"_defaultShipName",void 0),v(this,"_defaultShipSpeed",void 0),v(this,"_defaultStartWindDegrees",void 0),v(this,"_baseName",void 0),v(this,"_baseId",void 0),v(this,"_buttonId",void 0),v(this,"_compassId",void 0),v(this,"_deleteLastLegButtonId",void 0),v(this,"_modalId",void 0),v(this,"_sliderId",void 0),v(this,"_shipId",void 0),v(this,"_g",void 0),v(this,"_journey",void 0),v(this,"_shipCompare",void 0),v(this,"_compass",void 0),v(this,"_compassG",void 0),v(this,"_divJourneySummary",void 0),v(this,"_journeySummaryShip",void 0),v(this,"_journeySummaryTextShip",void 0),v(this,"_journeySummaryWind",void 0),v(this,"_journeySummaryTextWind",void 0),v(this,"_gJourneyPath",void 0),v(this,"_drag",void 0),this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(d.a)().x(t=>t[0]).y(t=>t[1]),this._labelPadding=20,this._degreesPerMinute=p.k/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(r.a)().domain(Object(a.a)(0,m.j,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-"+this._baseId,this._compassId="compass-"+this._baseId,this._deleteLastLegButtonId="button-delete-leg-"+this._baseId,this._modalId="modal-"+this._baseId,this._sliderId="slider-"+this._baseId,this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let s="in ";if(t<1)s+="less than a minute";else{const t=0===e?"":Object(p.p)(e,"hour");s+=t+(""===t?"":" ")+(0===i?"":Object(p.p)(i,"minute"))}return s}_setupDrag(){this._drag=o.a().on("start",(t,e,i)=>{n.c.sourceEvent.stopPropagation(),this._removeLabels(),Object(l.a)(i[e]).classed("drag-active",!0)}).on("drag",(t,e,i)=>{const s=n.c,a=t.position[0]+Number(s.dx),o=t.position[1]+Number(s.dy);0===e&&this._compass.attr("x",a).attr("y",o),Object(l.a)(i[e]).attr("cx",s.x).attr("cy",s.y),t.position=[a,o],this._printLines()}).on("end",(t,e,i)=>{Object(l.a)(i[e]).classed("drag-active",!1),this._printJourney()})}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(l.a)("#ports").append("g").attr("class","journey"),Object(l.a)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(){Object(c.b)("Menu","MakeJourney"),this._journeySelected()}_setupListener(){var t,e;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("mouseup",()=>this._navbarClick()),null===(e=document.querySelector("#"+this._deleteLastLegButtonId))||void 0===e||e.addEventListener("mouseup",()=>this._deleteLastLeg())}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>`${Object(_.e)(t.value)}<br>${String(t.value)}°`,t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/m.b.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){Object(p.n)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(l.a)(`#${this._modalId} .modal-body`).append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i=this._shipId+"-Base-select",s=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");s.append("label").attr("for",i).text("Ship (optional)"),s.append("select").attr("name",i).attr("id",i)}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new g.a(this._shipId),this._shipCompare.CompareShipsInit()}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segments[0].position[0],e=this._journey.segments[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e),this._compassG=this._compass.append("g"),Object(_.k)({element:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const i=(m.j-t+e)%m.j;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*m.u}_getStartWind(){const e=t("#"+this._sliderId),i=Number(e.roundSlider("getValue"));return e.length>0?i:0}_setShipSpeed(){let t;this._journey.shipName===this._defaultShipName?t=f(new Array(24).fill(this._defaultShipSpeed/2)):({speedDegrees:t}=this._shipCompare.singleShipData),this._speedScale.range(t)}_calculateMinutesForSegment(t,e,i){let s=i,a=e,o=0;for(this._setShipSpeed();s>0;){const e=this._calculateDistanceForSection(t,a);s>e?(s-=e,o+=1):(o+=s/e,s=0),a=(m.j+a-this._degreesPerMinute)%m.j}return this._journey.currentWindDegrees=a,o}_setShipName(){var t,e;(null===(t=this._shipCompare)||void 0===t||null===(e=t.singleShipData)||void 0===e?void 0:e.name)?this._journey.shipName=""+this._shipCompare.singleShipData.name:this._journey.shipName=this._defaultShipName}_removeLabels(){const t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(l.a)("#na-svg"),e=Object(h.c)(t.node()),i=Math.max(1,e.k),s=this._fontSize/i,a=h.b.translate(20/i,20/i),o=this._labelPadding/i,r=10/i,n=5/i;this._g.selectAll("g.journey g.label").each((t,e,i)=>{const n=Object(l.a)(i[e]),d=n.select("text"),h=t.label.split("|"),c=1.3*s;d.text("").attr("dy",0).attr("transform",a.toString()).style("font-size",s+"px"),h.forEach((t,e)=>{const i=d.append("tspan").html(t);e>0&&i.attr("x",0).attr("dy",c)});const p=d.node().getBBox(),u=t.label?p.width+2*o:0,m=t.label?p.height+o:0;n.select("rect").attr("width",u).attr("height",m);const _=n.select("circle").attr("r",r).attr("class","");n.append(()=>_.remove().node()),0===e&&_.attr("r",4*r).attr("class","drag-hidden"),e===i.length-1&&_.attr("r",r).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",n+"px"),this._compassG&&this._compassG.attr("transform",`scale(${1/i})`)}_printLabels(){const t=Object(s.c)().padding(this._labelPadding).value(t=>{const e=t.label.split("|"),i=e.reduce((t,e,i,s)=>s[t].length>e.length?t:i,0);return e[i]}),e=Object(s.a)(),i=Object(s.b)(e).size((t,e,i)=>{const s=t.label.split("|").length,a=i[e].querySelectorAll("text")[0].getBBox();return[a.width+2*this._labelPadding,a.height*s+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segments.map(t=>t)).call(i)}_setupSummary(){this._divJourneySummary=Object(l.a)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(l.a)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html("From "+Object(_.f)(this._journey.startWindDegrees))}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segments.length>1?this._journey.segments.map(t=>t.position):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)}_getTextDirection(t,e,i){return`${Object(_.f)(t,!0)} ⁖ F11: ${Object(u.a)(Object(m.f)(i.x,i.y))} / ${Object(u.a)(Object(m.g)(i.x,i.y))}`}_getTextDistance(t,e,i){let s=`${Math.round(t)} k ${y._getHumanisedDuration(e)}`;return i&&(s+=`⁖ total ${Math.round(this._journey.totalDistance)} k ${y._getHumanisedDuration(this._journey.totalMinutes)}`),s}_setSegmentLabel(t=this._journey.segments.length-1){const e={x:this._journey.segments[t].position[0],y:this._journey.segments[t].position[1]},i={x:this._journey.segments[t-1].position[0],y:this._journey.segments[t-1].position[1]},s=Object(_.m)(e,i),a=Object(m.p)(e,i),o=Object(m.m)(s),r=this._calculateMinutesForSegment(s,this._journey.currentWindDegrees,1e3*a);this._journey.totalDistance+=a,this._journey.totalMinutes+=r;const n=this._getTextDirection(o,s,e),l=this._getTextDistance(a,r,t>1);this._journey.segments[t].label=`${n}|${l}`}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData(),this._journey.segments.forEach((t,e)=>{e<this._journey.segments.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segments.pop(),this._journey.segments.length>0?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top",t+"px").style("right",e+"px")}plotCourse(t,e){this._journey.segments[0].position[0]>0?(this._journey.segments.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segments[0]={position:[t,e],label:""},this._initJourney())}}}).call(this,i("xeH2"))},"8KGH":function(t,e,i){(function(t){i.d(e,"a",(function(){return $}));i("UxlC"),i("WUlJ"),i("ry7D");var s=i("mrVq"),a=i("gj+k"),o=i("OWWo"),r=i("Ws9M"),n=i("VIqg"),l=i("3xmg"),d=i("AKWm"),h=i("2mXy"),c=i("JQHs"),p=i("Wgwc"),u=i.n(p),m=(i("9xm0"),i("+QaA")),_=i.n(m),g=i("QgiU"),f=i.n(g),b=i("Ds8A"),v=i.n(b),y=i("pxNS"),w=i("Q4du"),S=i("Qs7V"),D=i("otg8"),x=i("m+OL"),j=i("1RyA"),C=i("L2nF"),k=i("Bx8B"),O=i("oggF");function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}u.a.extend(_.a),u.a.extend(f.a),u.a.extend(v.a),u.a.locale("en-gb");const I=c.a.bind(h.a);class ${constructor(t){this.map=t,P(this,"circleType",""),P(this,"currentPort",void 0),P(this,"portData",void 0),P(this,"portDataDefault",void 0),P(this,"showCurrentGood",void 0),P(this,"showRadius",void 0),P(this,"showTradePortPartners",void 0),P(this,"tradeItem",void 0),P(this,"tradePortId",void 0),P(this,"zoomLevel",void 0),P(this,"_attackRadius",void 0),P(this,"_colourScaleCounty",void 0),P(this,"_colourScaleHostility",void 0),P(this,"_colourScaleNet",void 0),P(this,"_colourScalePoints",void 0),P(this,"_colourScaleTax",void 0),P(this,"_countyPolygon",void 0),P(this,"_countyPolygonFiltered",void 0),P(this,"_divPortSummary",void 0),P(this,"_gCounty",void 0),P(this,"_gIcon",void 0),P(this,"_gPort",void 0),P(this,"_gPortCircle",void 0),P(this,"_gRegion",void 0),P(this,"_gText",void 0),P(this,"_lowerBound",void 0),P(this,"_maxNetIncome",void 0),P(this,"_maxPortPoints",void 0),P(this,"_maxTaxIncome",void 0),P(this,"_minNetIncome",void 0),P(this,"_minPortPoints",void 0),P(this,"_minTaxIncome",void 0),P(this,"_nationIcons",void 0),P(this,"_portDataFiltered",void 0),P(this,"_portRadius",void 0),P(this,"_portSummaryNetIncome",void 0),P(this,"_portSummaryNumPorts",void 0),P(this,"_portSummaryTaxIncome",void 0),P(this,"_portSummaryTextNetIncome",void 0),P(this,"_portSummaryTextNumPorts",void 0),P(this,"_portSummaryTextTaxIncome",void 0),P(this,"_regionPolygon",void 0),P(this,"_regionPolygonFiltered",void 0),P(this,"_scale",void 0),P(this,"_upperBound",void 0),P(this,"_baseId",void 0),P(this,"_circleSize",void 0),P(this,"_cookie",void 0),P(this,"_f11",void 0),P(this,"_fontSize",void 0),P(this,"_iconSize",void 0),P(this,"_maxRadiusFactor",void 0),P(this,"_minRadiusFactor",void 0),P(this,"_minScale",void 0),P(this,"_radioButtonValues",void 0),P(this,"_radios",void 0),P(this,"_serverName",void 0),P(this,"_showPBZones",void 0),P(this,"_tooltipDuration",void 0),P(this,"_trilateratePosition",void 0),this._serverName=this.map.serverName,this._minScale=this.map.minScale,this._scale=this._minScale,this._f11=this.map.f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this.currentPort={id:366,coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=D.i,this._circleSize=D.h,this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","county","points","position","tax","net","off"],this._cookie=new x.a({id:this._baseId,values:this._radioButtonValues}),this._radios=new j.a(this._baseId,this._radioButtonValues),this.showRadius=this._getShowRadiusSetting(),this._trilateratePosition=new C.a(this)}static _importAll(t){const e={};return t.keys().forEach(i=>{e[i.replace("./","").replace(".svg","")]=t(i)}),e}static _hideDetails(e,i,s){t(Object(d.a)(s[i]).node()).tooltip("dispose")}async init(){await this._loadAndSetupData()}_setupData(t){this.portDataDefault=t.ports.map(e=>{var i,s;const a=null!==(i=t.server.find(t=>t.id===e.id))&&void 0!==i?i:{},o=null!==(s=t.pb.find(t=>t.id===e.id))&&void 0!==s?s:{};return{...e,...a,...o}}),this.portData=this.portDataDefault,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:this._serverName+"-ports.json",name:"server"},{fileName:this._serverName+"-pb.json",name:"pb"}],e={};try{e.ports=(await i.e(12).then(i.t.bind(null,"0dXp",3))).default;const s=await(await fetch(`data/${this._serverName}-items.json`)).json();this.tradeItem=new Map(s.map(t=>[t.id,t])),await(async t=>{for await(const i of t)e[i.name]=await(await fetch("data/"+i.fileName)).json()})(t)}catch(t){Object(y.f)(t)}return e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){var t,e,i,o,d,h;this._portRadius=Object(n.a)(),this._attackRadius=Object(n.a)().domain([0,1]),this._colourScaleHostility=Object(n.a)().domain([0,1]).range([w.j,w.i]).interpolate(r.a),this._colourScaleCounty=Object(l.a)().range(w.g),this._minTaxIncome=null!==(t=Object(s.a)(this.portData,t=>t.taxIncome))&&void 0!==t?t:0,this._maxTaxIncome=null!==(e=Object(a.a)(this.portData,t=>t.taxIncome))&&void 0!==e?e:0,this._colourScaleTax=Object(n.a)().domain([this._minTaxIncome,this._maxTaxIncome]).range([w.j,w.f]).interpolate(r.a),this._minNetIncome=null!==(i=Object(s.a)(this.portData,t=>t.netIncome))&&void 0!==i?i:0,this._maxNetIncome=null!==(o=Object(a.a)(this.portData,t=>t.netIncome))&&void 0!==o?o:0,this._colourScaleNet=Object(n.a)().domain([this._minNetIncome,0,this._maxNetIncome]).range([w.i,w.j,w.f]).interpolate(r.a),this._minPortPoints=null!==(d=Object(s.a)(this.portData,t=>t.portPoints))&&void 0!==d?d:0,this._maxPortPoints=null!==(h=Object(a.a)(this.portData,t=>t.portPoints))&&void 0!==h?h:0,this._colourScalePoints=Object(n.a)().domain([this._minPortPoints,this._maxPortPoints]).range([w.j,w.f]).interpolate(r.a)}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",()=>this._showRadiusSelected())}_getShowRadiusSetting(){let t=this._cookie.get();return"position"===t&&([t]=this._radioButtonValues,this._cookie.set(t)),this._radios.set(t),t}_showRadiusSelected(){this.showRadius=this._radios.get(),this._cookie.set(this.showRadius),this.update()}_setupSvg(){this._gPort=Object(d.a)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"),this._gRegion=this._gPort.append("g").attr("class","region"),this._gCounty=this._gPort.append("g").attr("class","county"),this._gPortCircle=this._gPort.append("g").attr("data-ui-component","port-circles"),this._gIcon=this._gPort.append("g").attr("class","port"),this._gText=this._gPort.append("g").attr("class","port-names")}_setupCounties(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}];const t={x:this.map.coord.max/2,y:this.map.coord.max/2};this._countyPolygon=this._countyPolygon.sort((e,i)=>{const s={x:e.centroid[0],y:e.centroid[1]},a={x:i.centroid[0],y:i.centroid[1]};return Object(D.o)(t,s)-Object(D.o)(t,a)}),this._colourScaleCounty.domain(this._countyPolygon.map(t=>t.name))}_setupRegions(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]}_setupSummary(){this._divPortSummary=Object(d.a)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind"),this._portSummaryNumPorts=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").attr("class","summary-des").html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").attr("class","summary-des").html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").attr("class","summary-des").html("net<br>income")}_setupFlags(){this._nationIcons=$._importAll(i("EPjG"));const t=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${this._iconSize} ${.75*this._iconSize}`),e},e=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(this._iconSize)),e.setAttribute("height",String(this._iconSize)),e.setAttribute("href",this._nationIcons[t].replace('"',"").replace('"',"")),e},s=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(this._iconSize/2)),t.setAttribute("cy",String(this._iconSize/2)),t.setAttribute("r","16"),t},a=document.querySelector("#na-svg defs");y.e.map(t=>t.short).forEach(i=>{const o=t(i);o.append(e(i));const r=a.appendChild(o);if("FT"!==i){const t=r.cloneNode(!0);t.id=i+"c",t.append(s()),a.append(t)}if("NT"!==i&&"FT"!==i){const t=r.cloneNode(!0);t.id=i+"a",t.append((()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",w.q),t.setAttribute("fill-opacity","0.7"),t})()),a.append(t);const e=t.cloneNode(!0);e.id=i+"ca",e.append(s()),a.append(e)}})}_getPortName(t){var e,i;return t&&null!==(e=null===(i=this.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}_getText(t){var e,i,s,a,o,r,n,l,d,h,c,p,m;const _=(t,e)=>`${String(t)} ‒ ${String(e)}`,g=(t,e)=>{const i=Number(u.a.utc().hour(t).local().format("H")),s=Number(u.a.utc().hour(e).local().format("H"));return I`${_(t,e)} (${_(i,s)})`},f=(t,e)=>e.profit.profit-t.profit.profit,b=u.a.utc(t.portBattle),v=u.a.utc(t.portBattle).local(),w=b===v?"":` (${v.format("H.mm")} local)`,D=u.a.utc(t.cooldownTime),x=u.a.utc(t.cooldownTime).local(),j=D===x?"":` (${x.format("H.mm")} local)`,C=t.portBattleStartTime?g((t.portBattleStartTime+10)%24,(t.portBattleStartTime+13)%24):g(11,8),P=b.isAfter(u.a.utc())?"s":"ed",$=t.portBattle?I`${Object(O.b)(t.attackerClan)} (${t.attackerNation})
              attack${t.portBattle?I`${P} ${b.fromNow()} at ${b.format("H.mm")}${w}`:I`s: ${Object(S.f)(null!==(e=t.attackHostility)&&void 0!==e?e:0)} hostility`}`:I``,T={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:(""===t.county?"":t.county+" / ")+t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?Object(O.b)(t.capturer):I``,captureTime:t.captured?""+Object(y.b)(u.a.utc(t.captured).fromNow()):"",attack:t.attackHostility?$:I``,cooldownTime:I`${D.fromNow()} at ${D.format("H.mm")}${j}`,pbTimeRange:t.capturable?C:"",brLimit:Object(S.c)(t.brLimit),portPoints:Object(S.c)(t.portPoints),taxIncome:Object(S.i)(t.taxIncome),portTax:Object(S.f)(t.portTax),netIncome:Object(S.i)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:null!==(i=null===(s=t.dropsTrading)||void 0===s?void 0:s.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==i?i:"",consumesTrading:null!==(a=null===(o=t.consumesTrading)||void 0===o?void 0:o.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==a?a:"",producesNonTrading:null!==(r=null===(n=t.producesNonTrading)||void 0===n?void 0:n.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==r?r:"",dropsNonTrading:null!==(l=null===(d=t.dropsNonTrading)||void 0===d?void 0:d.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==l?l:"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:null===(h=t.goodsToSellInTradePort)||void 0===h||null===(c=h.sort(f))||void 0===c?void 0:c.map(t=>`${t.name} (${Object(S.h)(t.profit.profit)})`).join(", "),goodsToBuyInTradePort:null===(p=t.goodsToBuyInTradePort)||void 0===p||null===(m=p.sort(f))||void 0===m?void 0:m.map(t=>`${t.name} (${Object(S.h)(t.profit.profit)})`).join(", ")};return T.dropsTrading.length>0&&T.dropsNonTrading.length>0&&(T.dropsNonTrading+=" ― "),T}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return I`
            <div class="d-flex align-items-center mb-4">
                <img
                    alt="${t.icon}"
                    class="flag-icon mr-3 align-self-stretch ${e}"
                    src="${this._nationIcons[t.icon].replace('"',"").replace('"',"")}"
                />

                <div class="text-left">
                    <div class="large">${t.name}</div>
                    <div class="caps">${t.county}</div>
                </div>

                <div class="ml-auto inline-block">
                    <span class="x-large text-lighter align-top mr-2">${t.portPoints}</span>
                    ${t.availableForAll?I`<i class="icon icon-light icon-open" aria-hidden="true"></i
                              ><span class="sr-only">Accessible to all</span>`:I``}
                    ${t.laborHoursDiscount?I`<i class="icon icon-light icon-labour" aria-hidden="true"></i
                              ><span class="sr-only">Labour hour discount level ${t.laborHoursDiscount}</span>`:I``}
                    ${t.tradingCompany?I`<i class="icon icon-light icon-trading mr-1" aria-hidden="true"></i
                              ><span class="sr-only">Trading company level ${t.tradingCompany}</span>`:I``}
                    ${t.shallow?I`<i class="icon icon-light icon-shallow" aria-hidden="true"></i
                              ><span class="sr-only">Shallow</span>`:I`<i class="icon icon-light icon-deep" aria-hidden="true"></i
                              ><span class="sr-only">Deep</span>`}
                </div>
            </div>

            ${void 0===t.attack?I`${t.cooldownTime?I`<div class="alert alert-info mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:I``}`:I`<div class="alert alert-danger mt-2" role="alert">${t.attack}</div>`}

            <div class="d-flex text-left mb-2">
                ${t.capital?I`<div>${t.portTax}<br /><span class="des">Tax rate</span></div>`:I`
                          <div class="mr-3">
                              ${t.pbTimeRange}<br />
                              <span class="des">Battle timer</span>
                          </div>
                          <div class="mr-3">
                              ${t.brLimit}<br />
                              <span class="des">Rating</span>
                          </div>
                          <div class="mr-3">
                              ${t.capturer}<br />
                              <span class="des">Capturer</span>
                          </div>
                          <div class="mr-5">
                              ${t.captureTime}<br />
                              <span class="des">Capture</span>
                          </div>

                          <div class="ml-auto mr-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des">Net income</span>
                          </div>
                      `}
            </div>

            ${t.producesNonTrading.length>0?I`<p class="mb-2">
                      <span class="caps">Produces―</span><span class="non-trading">${t.producesNonTrading}</span>
                  </p>`:I``}
            ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?I`<p class="mb-2">
                      <span class="caps">Drops―</span>
                      ${t.dropsNonTrading?I`<span class="non-trading">${t.dropsNonTrading}</span>`:I``}
                      ${t.dropsTrading}
                  </p> `:I``}
            ${t.consumesTrading.length>0?I`<p class="mb-2"><span class="caps">Consumes―</span>${t.consumesTrading}</p>`:I``}
            ${"tradePorts"===this.showRadius?I`${t.goodsToSellInTradePort.length>0?I`<p class="mb-2">
                            <span class="caps">Sell in ${t.tradePort}</span> (net profit)―
                            ${t.goodsToSellInTradePort}
                        </p>`:I``}
                  ${t.goodsToBuyInTradePort.length>0?I`<p class="mb-2">
                            <span class="caps">Buy in ${t.tradePort}</span> (net profit)―
                            ${t.goodsToBuyInTradePort}
                        </p>`:I``}`:I``}
        `}_getInventory(t){const e=t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""};let i="";const s=t.inventory.filter(t=>t.buyQuantity>0&&t.buyPrice>0).sort((t,i)=>e(t.id).localeCompare(e(i.id))).map(t=>`${Object(S.c)(t.buyQuantity)} ${e(t.id)} @ ${Object(S.g)(t.buyPrice)}`).join("<br>"),a=t.inventory.filter(t=>t.sellQuantity>0&&t.sellPrice>0).sort((t,i)=>e(t.id).localeCompare(e(i.id))).map(t=>`${Object(S.c)(t.sellQuantity)} ${e(t.id)} @ ${Object(S.g)(t.sellPrice)}`).join("<br>");return i+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,s.length>0&&(i+="<h6>Buy</h6>",i+=s),s.length>0&&a.length>0&&(i+="<p></p>"),a.length>0&&(i+="<h6>Sell</h6>",i+=a),i}_showDetails(e,i,s){const a=t(Object(d.a)(s[i]).node()).tooltip("dispose").tooltip({html:!0,placement:"auto",trigger:"manual",title:"Wait...",sanitize:!1});a.on("inserted.bs.tooltip",()=>{const i=t(document.body).find(".tooltip").find(".tooltip-inner")[0];i.textContent="",Object(h.b)(this._tooltipData(this._getText(e)),i),a.tooltip("update")}),a.tooltip("show"),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(this._getInventory(e)))}_updateIcons(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(D.t)(this._circleSize/t),i=this._portDataFiltered;this._gIcon.selectAll("circle").data(i,t=>String(t.id)).join(t=>t.append("circle").attr("fill",t=>{const e=`${t.countyCapital&&t.capturable?"c":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`}).attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1]).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",$._hideDetails)).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(D.t)(this._circleSize/t*this._minRadiusFactor),i=Object(D.t)(this._circleSize/t*this._maxRadiusFactor);let s=this._portDataFiltered,a=()=>"",o=()=>0,r=()=>"";"tax"===this.showRadius?(s=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minTaxIncome,this._maxTaxIncome]).range([e,i]),a=()=>"bubble",r=t=>this._colourScaleTax(t.taxIncome),o=t=>this._portRadius(t.taxIncome)):"net"===this.showRadius?(s=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minNetIncome,this._maxNetIncome]).range([e,i]),a=()=>"bubble",r=t=>this._colourScaleNet(t.netIncome),o=t=>this._portRadius(Math.abs(t.netIncome))):"points"===this.showRadius?(s=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minPortPoints,this._maxPortPoints]).range([e,i/2]),a=()=>"bubble",r=t=>this._colourScalePoints(t.portPoints),o=t=>this._portRadius(t.portPoints)):"position"===this.showRadius?(a=()=>"bubble here",o=t=>t.distance):"attack"===this.showRadius?(s=this._portDataFiltered.filter(t=>t.attackHostility),this._attackRadius.range([e,i/1.5]),a=()=>"bubble",r=t=>{var e;return"Neutral"===t.attackerNation?w.h:this._colourScaleHostility(null!==(e=t.attackHostility)&&void 0!==e?e:0)},o=t=>{var e;return this._attackRadius(null!==(e=t.attackHostility)&&void 0!==e?e:0)}):"currentGood"===this.circleType?(a=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"county"===this.showRadius?(a=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",r=t=>t.capturable?this._colourScaleCounty(t.county):"",o=t=>t.capturable?i/2:i/3):"tradePorts"===this.showRadius?(a=t=>"bubble "+this._getTradePortMarker(t),o=t=>t.id===this.tradePortId?i:i/2):"frontline"===this.showRadius?(a=t=>"bubble "+this._getFrontlineMarker(t),o=t=>t.ownPort?i/3:i/2,s=s.filter(t=>{var e;return null!==(e=t.enemyPort)&&void 0!==e?e:t.ownPort})):"currentGood"===this.showRadius?(a=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"off"===this.showRadius&&(s=[]),this._gPortCircle.selectAll("circle").data(s,t=>String(t.id)).join(t=>t.append("circle").attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1])).attr("class",t=>a(t)).attr("r",t=>o(t)).attr("fill",t=>r(t))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(D.n)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const s=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+s;const a=t.angle>90&&t.angle<270?i:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(D.n)(t.angle)))+a:t.coordinates[1]+s}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.angle>0&&t.angle<D.k?"start":"end":"middle"}updateTexts(){if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(D.t)(this._circleSize/t),i=2**Math.log2(.9*(Math.abs(this._minScale)+this._scale)),s=Object(D.t)(this._fontSize/i),a=this._portDataFiltered;this._gText.selectAll("text").data(a,t=>String(t.id)).join(t=>t.append("text").text(t=>t.name)).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,s)).attr("text-anchor",t=>this._updateTextsAnchor(t)),this._gText.attr("font-size",s+"px").classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this.portData).length;let e=0,i=0;t&&(e=Object(o.a)(this.portData,t=>t.taxIncome),i=Object(o.a)(this.portData,t=>t.netIncome)),this._portSummaryTextNumPorts.text(""+t),this._portSummaryTextTaxIncome.html(""+Object(S.h)(e)),this._portSummaryTextNetIncome.html(""+Object(S.h)(i))}_updateCounties(){if("portLabel"===this.zoomLevel){const t=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name),t=>t.attr("fill",t=>"county"===this.showRadius?this._colourScaleCounty(t.name):"")),this._gCounty.classed("d-none",!1)}else this._gCounty.classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)),this._gRegion.classed("d-none",!1)}else this._gRegion.classed("d-none",!0)}update(t){this._scale=null!=t?t:this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()}_filterVisible(){"position"===this.showRadius?this._portDataFiltered=this.portData:this._portDataFiltered=this.portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]),this._countyPolygonFiltered=this._countyPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1]),this._regionPolygonFiltered=this._regionPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1])}setBounds(t,e){this._lowerBound=t,this._upperBound=e}_showSummary(){this._divPortSummary.classed("hidden",!1)}setShowRadiusSetting(t=this._radioButtonValues[0]){this.showRadius=t,this._radios.set(this.showRadius),this._cookie.set(this.showRadius)}clearMap(t){this._showSummary(),this.portData=this.portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)}}}).call(this,i("xeH2"))},"9yav":function(t,e){t.exports="data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='currentColor' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 0a1 1 0 011 1v5.268l4.562-2.634a1 1 0 111 1.732L10 8l4.562 2.634a1 1 0 11-1 1.732L9 9.732V15a1 1 0 11-2 0V9.732l-4.562 2.634a1 1 0 11-1-1.732L6 8 1.438 5.366a1 1 0 011-1.732L7 6.268V1a1 1 0 011-1z' fill-rule='evenodd' fill='%23d2ccc2'/%3E%3C/svg%3E"},Bx8B:function(t,e,i){i.d(e,"a",(function(){return s})),i.d(e,"b",(function(){return a}));i("UxlC");const s=(t,e)=>t&&e?t.localeCompare(e):0,a=t=>(e,i)=>{let s=0;return t.some(t=>{let a=1;return String(t).startsWith("-")&&(a=-1,t=String(t).slice(1)),s=Number.isNaN(Number(e[t]))&&Number.isNaN(Number(i[t]))?String(e[t]).localeCompare(String(i[t]))*a:(Number(e[t])-Number(i[t]))*a,0!==s}),s}},EPjG:function(t,e,i){var s={"./CN.svg":"cA9Q","./DE.svg":"vYjh","./DK.svg":"TB//","./ES.svg":"RHiG","./FR.svg":"p7uB","./FT.svg":"9yav","./GB.svg":"tN7d","./NT.svg":"2Coy","./PL.svg":"wffX","./PR.svg":"3YHm","./RU.svg":"L1lh","./SE.svg":"YNpQ","./US.svg":"Ex7p","./VP.svg":"7D/U"};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}a.keys=function(){return Object.keys(s)},a.resolve=o,t.exports=a,a.id="EPjG"},Ex7p:function(t,e,i){t.exports=i.p+"images/flags/US.svg"},Iohx:function(t,e,i){},K2bk:function(t,e,i){(function(t){i.d(e,"a",(function(){return g}));i("WUlJ"),i("fCtr");var s=i("AKWm"),a=i("pOjD"),o=i("Qs7V"),r=i("Q4du"),n=i("otg8"),l=i("dNoP"),d=i("Wgwc"),h=i.n(d),c=i("+QaA"),p=i.n(c),u=i("Ds8A"),m=i.n(u);function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}h.a.extend(p.a),h.a.extend(m.a);class g{constructor(t,e){_(this,"_map",void 0),_(this,"_coord",void 0),_(this,"_baseName",void 0),_(this,"_baseId",void 0),_(this,"_buttonId",void 0),_(this,"_modalId",void 0),_(this,"_formId",void 0),_(this,"_xInputId",void 0),_(this,"_zInputId",void 0),_(this,"_copyButtonId",void 0),_(this,"_submitButtonId",void 0),_(this,"_modal$",void 0),_(this,"_g",void 0),_(this,"_formSel",void 0),_(this,"_xInputSel",void 0),_(this,"_zInputSel",void 0),this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._xInputId="input-x-"+this._baseId,this._zInputId="input-z-"+this._baseId,this._copyButtonId="copy-coord-"+this._baseId,this._submitButtonId="submit-"+this._baseId,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(s.a)("#map").append("g").attr("class","f11")}_navbarClick(){Object(a.b)("Menu","Go to F11"),this._f11Selected()}_setupListener(){var t;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",()=>this._navbarClick()),window.addEventListener("keydown",t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick()})}_injectModal(){Object(r.n)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(s.a)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const a=t.append("div").classed("float-right btn-group",!0).attr("role","group");a.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to");Object(s.a)(`#${this._modalId} .modal-footer`).remove()}_initModal(){this._injectModal()}_f11Selected(){var e,i;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId),this._xInputSel=document.querySelector("#"+this._xInputId),this._zInputSel=document.querySelector("#"+this._zInputId),this._formSel.addEventListener("submit",t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()}),null===(e=document.querySelector("#"+this._modalId))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)}),null===(i=document.querySelector("#"+this._copyButtonId))||void 0===i||i.addEventListener("click",t=>{this._copyCoordClicked(t)}));this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()}_getInputValue(t){const{value:e}=t;return""===e?1/0:Number(e)}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){Object(a.b)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this._getXCoord(),i=this._getZCoord();Object(l.b)(e,i,this._modal$)}_printF11Coord(t,e,i,s){var a,r,n,l;let d=10;const c=this._g.append("g").attr("transform",`translate(${t},${e})`),p=c.append("rect"),u=c.append("rect");c.append("circle").attr("r",d),d*=1.6;const m=c.append("text").attr("dx",-d+"px").attr("dy",-d/2-2+"px").attr("class","f11-coord").text(Object(o.a)(i)),_=c.append("text").attr("dx",-d+"px").attr("dy",d/2+2+"px").attr("class","f11-coord").text(Object(o.a)(s)),g=null===(a=m.node())||void 0===a?void 0:a.getBBox(),f=null===(r=_.node())||void 0===r?void 0:r.getBBox(),b=h()().utc(),v=h()(),y=c.append("text").attr("dx",d+"px").attr("dy",-d/2-2+"px").attr("class","f11-time").text(b.format("H.mm")),w=c.append("text").attr("dx",d+"px").attr("dy",d/2+2+"px").attr("class","f11-time").text(`(${v.format("H.mm")} local)`),S=null===(n=y.node())||void 0===n?void 0:n.getBBox(),D=null===(l=w.node())||void 0===l?void 0:l.getBBox(),x=g&&f?1.2*Math.round(g.height+f.height):0,j=g&&f?Math.round(Math.max(g.width,f.width)+5):0,C=S&&D?1.2*Math.round(S.height+D.height):0,k=S&&D?Math.round(Math.max(S.width,D.width)+5):0,O=Math.max(x,C);p.attr("x",-j-d).attr("y",-O/2).attr("height",O).attr("width",j+d),u.attr("x",0).attr("y",-O/2).attr("height",O).attr("width",k+d)}_goToF11(t,e){const i=Math.floor(Object(n.d)(t,e)),s=Math.floor(Object(n.e)(t,e));Object(n.a)(i,this._coord.min,this._coord.max,!0)&&Object(n.a)(s,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(i,s,t,e),this._map.zoomAndPan(i,s,1))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&(Object(a.b)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=Object(n.f)(t,e),s=Object(n.g)(t,e);this._printF11Coord(t,e,i,s)}clearMap(){this._g.selectAll("*").remove()}}}).call(this,i("xeH2"))},KD6d:function(t,e,i){i.d(e,"a",(function(){return h}));const s=t=>t*t,a=t=>Math.sqrt(s(t.x)+s(t.y)+s(t.z)),o=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,r=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),n=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),l=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),d=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e}),h=(t,e,i,h=!1)=>{const c=l(r(e,t),a(r(e,t))),p=o(c,r(i,t));let u=r(r(i,t),d(c,p));const m=l(u,a(u)),_=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(c,m),g=a(r(e,t)),f=o(m,r(i,t)),b=(s(t.r)-s(e.r)+s(g))/(2*g),v=(s(t.r)-s(i.r)+s(p)+s(f))/(2*f)-p/f*b;let y=s(t.r)-s(b)-s(v);Math.abs(y)<1e-10&&(y=0);const w=Math.sqrt(y);if(Number.isNaN(w))return;u=n(t,n(d(c,b),d(m,v)));const S=n(u,d(_,w)),D=r(u,d(_,w));return 0===w||h?u:[S,D]}},L1lh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},L2nF:function(t,e,i){(function(t){i.d(e,"a",(function(){return C}));i("WUlJ"),i("fCtr"),i("dbdZ");var s=i("AKWm"),a=i("pOjD"),o=i("otg8"),r=i("Q4du"),n=i("Bx8B"),l=i("dNoP"),d=i("KD6d"),h=i("XDPF");function c(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function u(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function m(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var _=new WeakMap,g=new WeakMap,f=new WeakMap,b=new WeakMap,v=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,D=new WeakMap,x=new WeakMap,j=new WeakMap;class C{constructor(t){_.set(this,{writable:!0,value:{}}),g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:[]}),w.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:[]}),j.set(this,{writable:!0,value:[]}),m(this,g,t),m(this,S,3),m(this,D,c(new Array(u(this,S)).keys())),m(this,b,"Get position"),m(this,f,"get-position"),m(this,v,"button-"+u(this,f)),m(this,w,"modal-"+u(this,f));for(const t of u(this,D))u(this,x)[t]=`${u(this,f)}-${t}-select`,u(this,y)[t]=`${u(this,f)}-${t}-input`;this._setupListener()}_navbarClick(){Object(a.b)("Menu","Get position"),this._positionSelected()}_setupListener(){var t;null===(t=document.querySelector("#"+u(this,v)))||void 0===t||t.addEventListener("click",()=>this._navbarClick())}_injectModal(){Object(r.n)({id:u(this,w),title:u(this,b),size:"modal-sm",buttonText:"Go"});const t=Object(s.a)(`#${u(this,w)} .modal-body`);t.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of u(this,D)){const i=e.append("div").attr("class","form-row");i.append("div").attr("class","col-md-6").append("label").append("select").attr("name",u(this,x)[t]).attr("id",u(this,x)[t]).attr("class","selectpicker"),i.append("div").attr("class","col-md-6").append("input").attr("id",u(this,y)[t]).attr("name",u(this,y)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)}}_setupSelects(){const e=""+u(this,g).portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(n.b)(["name"])).map(t=>`<option data-subtext="${t.nation}">${t.name}</option>`).join("");for(const i of u(this,D))u(this,j)[i]=document.querySelector("#"+u(this,x)[i]),u(this,j)[i].insertAdjacentHTML("beforeend",e),t(u(this,j)[i]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelects()}_showAndGoToPosition(){const t=u(this,g).portData.map(t=>{var e;return{x:t.coordinates[0],y:t.coordinates[1],z:0,r:null!==(e=t.distance)&&void 0!==e?e:0}}),e=Object(d.a)(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),u(this,g).map.f11.printCoord(e.x,e.y),u(this,g).map.zoomAndPan(e.x,e.y,1);const t=Math.round(Object(o.f)(e.x,e.y)/-1e3),i=Math.round(Object(o.g)(e.x,e.y)/-1e3);Object(l.b)(t,i,u(this,_)),new h.a("Get position","Coordinates copied to clipboard.")}else new h.a("Get position","No intersection found.")}_useUserInput(){const t=new Map;for(const e of u(this,D)){const i=u(this,j)[e].selectedIndex?u(this,j)[e].options[u(this,j)[e].selectedIndex].text:"",s=Number(document.querySelector("#"+u(this,y)[e]).value);s&&""!==i&&t.set(i,1.04*s*r.e)}t.size===u(this,S)?(u(this,g).setShowRadiusSetting("position"),u(this,g).portData=u(this,g).portDataDefault.filter(e=>t.has(e.name)).map(e=>(e.distance=t.get(e.name),e)),u(this,g).update(),this._showAndGoToPosition()):new h.a("Get position","Not enough data.")}_positionSelected(){document.querySelector("#"+u(this,w))||(this._initModal(),m(this,_,t("#"+u(this,w)))),u(this,_).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}}}).call(this,i("xeH2"))},Mn03:function(t,e,i){i.d(e,"b",(function(){return h})),i.d(e,"c",(function(){return c})),i.d(e,"a",(function(){return S}));var s=i("AKWm"),a=i("1OKp"),o=t=>"function"==typeof t?t:()=>t;var r=(t,e)=>{t=t||"g";let i=(t,e)=>e,s=null;const a=function(a,o){o=o||(t=>t);const r=a.selection?a:null;r&&(a=a.selection());let n=a.selectAll((t,e,i)=>Array.from(i[e].childNodes).filter(t=>1===t.nodeType)).filter(null==e?t:`${t}.${e}`).data(o,i);const l=n.enter().append(t).attr("class",e);let d=n.exit();n=n.merge(l);const h=r||s;return h&&(n=n.transition(h).style("opacity",1),l.style("opacity",1e-6),d=d.transition(h).style("opacity",1e-6)),d.remove(),n.enter=()=>l,n.exit=()=>d,n};return a.element=(...e)=>e.length?(t=e[0],a):t,a.className=(...t)=>t.length?(e=t[0],a):e,a.key=(...t)=>t.length?(i=t[0],a):i,a.transition=(...t)=>t.length?(s=t[0],a):s,a},n=(t,e,i)=>{const s=e[i];if("function"!=typeof s)throw new Error(`Attempt to rebind ${i} which isn't a function on the source object`);return(...i)=>{var a=s.apply(e,i);return a===e?t:a}};var l=(t,e,...i)=>{const s=(t=>e=>t.reduce((t,e)=>t&&e(t),e))(i);for(const i of Object.keys(e)){const a=s(i);a&&(t[a]=n(t,e,i))}return t},d=t=>t.map(t=>"string"==typeof t?new RegExp(`^${t}$`):t);var h=t=>{let e=()=>{},i=()=>[0,0],n=(t,e)=>[t.x,t.y],h=t||(t=>t),c=()=>{},p=Object(a.a)(),u=Object(a.a)();const m=r("g","label"),_=t=>{t.each((t,a,o)=>{const r=m(Object(s.a)(o[a]),t).call(c),l=r.nodes(),d=l.map((t,e)=>{let a=Object(s.a)(t).datum();const o=n(a,e,l);let r=[p(o[0]),u(o[1])],d=i(a,e,l);return{hidden:!1,x:r[0],y:r[1],width:d[0],height:d[1]}}),_=h(d);r.attr("style",(t,e)=>"display:"+(_[e].hidden?"none":"inherit")).attr("transform",(t,e)=>"translate("+_[e].x+", "+_[e].y+")").attr("layout-width",(t,e)=>_[e].width).attr("layout-height",(t,e)=>_[e].height).attr("anchor-x",(t,e,i)=>d[e].x-_[e].x).attr("anchor-y",(t,e,i)=>d[e].y-_[e].y),r.call(c),e(r,t,a)})};return l(_,m,((...t)=>(t=d(t),e=>t.some(t=>t.test(e))&&e))("key")),l(_,h),_.size=(...t)=>t.length?(i=o(t[0]),_):i,_.position=(...t)=>t.length?(n=o(t[0]),_):n,_.component=(...t)=>t.length?(c=t[0],_):c,_.decorate=(...t)=>t.length?(e=t[0],_):e,_.xScale=(...t)=>t.length?(p=t[0],_):p,_.yScale=(...t)=>t.length?(u=t[0],_):u,_},c=t=>{let e=2,i=t=>t;const a=r("text"),n=r("rect"),l=r("circle"),d=t=>{t.each((t,o,r)=>{const d=r[o],h=Object(s.a)(d);let c=Number(d.getAttribute("layout-width")),p=Number(d.getAttribute("layout-height"));n(h,[t]).attr("width",c).attr("height",p);let u=Number(d.getAttribute("anchor-x")),m=Number(d.getAttribute("anchor-y"));l(h,[t]).attr("r",2).attr("cx",u).attr("cy",m);let _=a(h,[t]);_.enter().attr("dy","0.9em").attr("transform",`translate(${e}, ${e})`),_.text(i)})};return d.padding=(...t)=>t.length?(e=t[0],d):e,d.value=(...t)=>t.length?(i=o(t[0]),d):i,d},p=i("OWWo");var u=(t,e)=>{if(((t,e)=>!(t.x>=e.x+e.width||t.x+t.width<=e.x||t.y>=e.y+e.height||t.y+t.height<=e.y))(t,e)){const i=Math.max(t.x,e.x),s=Math.min(t.x+t.width,e.x+e.width),a=Math.max(t.y,e.y);return(s-i)*(Math.min(t.y+t.height,e.y+e.height)-a)}return 0};const m=(t,e)=>Object(p.a)(t.map((i,s)=>e===s?0:u(t[e],i))),_=(t,e,i,s,a)=>({x:t,y:e,width:i,height:s,location:a});var g=t=>{const e=t.x,i=t.y,s=t.width,a=t.height;return[_(e,i,s,a,"bottom-right"),_(e-s,i,s,a,"bottom-left"),_(e-s,i-a,s,a,"top-left"),_(e,i-a,s,a,"top-right"),_(e,i-a/2,s,a,"middle-right"),_(e-s/2,i,s,a,"bottom-center"),_(e-s,i-a/2,s,a,"middle-left"),_(e-s/2,i-a,s,a,"top-center")]};const f=(t,e,i)=>[...t.slice(0,e),i,...t.slice(e+1)],b=(t,e)=>t<e,v=()=>{let t,e=null,i=b,s=()=>0;const a=(o,r)=>{e||(e=Object(p.a)(t.map((e,i)=>s(e,i,t))));const n=((i,a)=>e-s(t[a],a,t)+s(i,a,f(t,a,i)))(o,r);return i(n,e)?v().locationScore(s).winningScore(i).score(n).rectangles(f(t,r,o)):a};return a.rectangles=(...e)=>e.length?(t=e[0],a):t,a.score=(...t)=>t.length?(e=t[0],a):e,a.winningScore=(...t)=>t.length?(i=t[0],a):i,a.locationScore=(...t)=>t.length?(s=t[0],a):s,a};var y=v;const w=t=>Math.floor(Math.random()*t.length);var S=()=>{let t,e=1e3,i=1;const s=(e,i,s)=>m(s,i)+(e=>t?e.width*e.height-u(e,t):0)(e)+(t=>{switch(t.location){case"bottom-right":return 0;case"middle-right":case"bottom-center":return t.width*t.height/8}return t.width*t.height/4})(e),a=t=>{let a=e;let o=y().locationScore(s).winningScore((t,e)=>Math.exp((e-t)/a)>Math.random()).rectangles(t);for(;a>0;){const e=w(t);o=o((r=g(t[e]))[w(r)],e),a-=i}var r;return o.rectangles()};return a.temperature=(...t)=>t.length?(e=t[0],a):e,a.cooling=(...t)=>t.length?(i=t[0],a):i,a.bounds=(...e)=>e.length?(t=e[0],a):t,a};i("Ok6N")},Qs7V:function(t,e,i){i.d(e,"d",(function(){return n})),i.d(e,"b",(function(){return d})),i.d(e,"j",(function(){return h})),i.d(e,"a",(function(){return c})),i.d(e,"c",(function(){return p})),i.d(e,"k",(function(){return u})),i.d(e,"e",(function(){return m})),i.d(e,"h",(function(){return g})),i.d(e,"i",(function(){return f})),i.d(e,"g",(function(){return b})),i.d(e,"f",(function(){return v})),i.d(e,"l",(function(){return y}));i("UxlC");var s=i("sXBl"),a=i("JQHs"),o=i("2mXy");const r=a.a.bind(o.a),n=Object(s.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reales"],percent:" %",minus:"− "}),l=n.formatPrefix(",.0",1e3),d=(t,e=2)=>n.format(`,.${e}~r`)(t),h=(t,e=2)=>n.format(`+,.${e}~r`)(t).replace("+","+ "),c=t=>l(-1*t).replace("k"," k"),p=t=>n.format(",d")(t),u=t=>n.format("+,d")(t).replace("+","+ "),m=t=>n.format(",.0%")(t).replace("%","pp"),_='<span class="caps">m</span>',g=t=>n.format(",.2s")(t).replace(".0","").replace("k"," k").replace("m"," m").replace("M"," "+_),f=t=>{const e=g(t);return e.endsWith(_)?r`${e.replace(_,"")}<span class="caps">m</span>`:r`${e}`},b=t=>n.format("$,.2s")(t).replace(".0","").replace("M",' <span class="caps">m</span>').replace("k"," k"),v=(t,e=1)=>n.format(`.${e}%`)(t).replace(".0",""),y=t=>n.format("+.1%")(t).replace(".0","").replace("+","＋ ")},RHiG:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"TB//":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},XDPF:function(t,e,i){(function(t){i.d(e,"a",(function(){return c}));i("WUlJ"),i("bqEa");var s=i("AKWm"),a=i("Q4du");function o(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function r(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var n=new WeakMap,l=new WeakMap,d=new WeakMap,h=new WeakMap;class c{constructor(t,e){n.set(this,{writable:!0,value:void 0}),l.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:void 0}),r(this,n,t),r(this,l,e),r(this,h,Object(s.a)("#toast-column")),this._set(),this._show();window.setTimeout(this._remove.bind(this),1e4)}_set(){r(this,d,o(this,h).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=o(this,d).append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",a.l).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(o(this,n)),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),o(this,d).append("div").attr("class","toast-body").html(o(this,l))}_show(){const e=o(this,d).node();if(null!==e){t(e).toast({autohide:!1}).toast("show")}}_remove(){o(this,d).remove()}}}).call(this,i("xeH2"))},YNpQ:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},Z5fe:function(t,e,i){i.d(e,"a",(function(){return l}));var s=i("AKWm"),a=i("iPFw"),o=i("ZQwz"),r=i("Q4du");function n(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class l{constructor(t,e){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=t,this._shipCompare=e,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(t=>t+" knots"),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(t){let e=`<span class="badge badge-white">${t.maxCannonLb} / `;return t.maxCarroLb?e+=""+t.maxCarroLb:e+="–",e+=" lb</span>",e}static getCannonsPerDeck(t){let e=`${t.gunsPerDeck[0].amount} ${l.pd(t.gunsPerDeck[0])}`,i="";for(let s=1;s<4;s+=1)t.gunsPerDeck[s].amount?e=`${t.gunsPerDeck[s].amount} ${l.pd(t.gunsPerDeck[s])} <br>${e}`:i+="<br>";return[e,i]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(t){let e=0;function i(t){return e+=1,`<div class="row row-small ${e%2?"row-light":""}"><div class="col-compress col-3">${t}</div>`}function s(e,i,s=6){let a,o="";return"cannonsPerDeck"===e?([a,o]=t[e],o="<br>"+o):a=""===e?"":String(t[e]),`<div class="col-compress col-${s}">${a}<br><span class="des">${i}</span>${o}</div>`}let a="";return a+=i(t.shipRating),a+=l.displaySecondBlock(),a+=s("battleRating","Battle rating"),a+=s("guns","Cannons"),a+=s("upgradeXP","Knowledge XP"),a+=s("rollAngle","Roll angle"),a+="</div></div></div>",a+=i(t.decks),a+=l.displaySecondBlock(),a+=s("cannonsPerDeck","Gun decks"),a+=s("firezoneHorizontalWidth","Firezone horizontal width"),a+="</div></div></div>",a+=i("Broadside (lb)"),a+=l.displaySecondBlock(),a+=s("cannonBroadside","Cannons"),a+=s("carroBroadside","Carronades"),a+="</div></div></div>",a+=i("Chasers"),a+=l.displaySecondBlock(),a+=s("gunsFront","Bow"),a+=s("gunsBack","Stern"),a+="</div></div></div>",a+=i("Speed"),a+=l.displaySecondBlock(),a+=s("maxSpeed","Maximum"),a+=s("deceleration","Deceleration"),a+=s("acceleration","Acceleration"),a+=s("turnAcceleration","Turn acceleration"),a+=s("maxTurningSpeed","Rudder turn speed"),a+=s("halfturnTime","Rudder half time"),a+="</div></div></div>",a+=i('Hit points <span class="badge badge-white">Thickness</span>'),a+=l.displaySecondBlock(),a+=s("sideArmor","Sides"),a+=s("structure","Hull"),a+=s("frontArmor","Bow"),a+=s("backArmor","Stern"),a+="</div></div></div>",a+=i('Masts <span class="badge badge-white">Thickness</span>'),a+=l.displaySecondBlock(),a+=s("sails","Sails"),a+=s("mastBottomArmor","Bottom"),a+=s("mastMiddleArmor","Middle"),a+=s("mastTopArmor","Top"),a+="</div></div></div>",a+=i("Crew"),a+=l.displaySecondBlock(),a+=s("minCrew","Minimum",4),a+=s("sailingCrew","Sailing",4),a+=s("maxCrew","Maximum",4),a+=s("cannonCrew","Cannon",4),a+=s("carroCrew","Carronades",4),a+="</div></div></div>",a+=i("Boarding"),a+=l.displaySecondBlock(),a+=s("morale","Morale",4),a+=s("attack","Attack",4),a+=s("defense","Defense",4),a+=s("musketsCrew","Crew with muskets",4),a+=s("musketsAccuracy","Musket accuracy %",4),a+=s("cannonsAccuracy","Cannon accuracy %",4),a+=s("prepPerRound","Preparation per round",4),a+=s("prepInitial","Initial preparation",4),a+=s("disengageTime","Rounds to disengage",4),a+="</div></div></div>",a+=i("Resistance"),a+=l.displaySecondBlock(),a+=s("fireResistance","Fire %",4),a+=s("leakResistance","Leak %",4),a+=s("splinterResistance","Splinter %",4),a+="</div></div></div>",a+=i('Repairs needed <span class="badge badge-white">Set of 5</span>'),a+=l.displaySecondBlock(),a+=s("hullRepairsNeeded","Hull",4),a+=s("rigRepairsNeeded","Rig",4),a+=s("rumRepairsNeeded","Rum",4),a+="</div></div></div>",a+=i("Repair"),a+=l.displaySecondBlock(),a+=s("hullRepairAmount","Hull %",4),a+=s("rigRepairAmount","Rig %",4),a+=s("repairTime","Time (sec)",4),a+="</div></div></div>",a+=i("Hold"),a+=l.displaySecondBlock(),a+=s("holdSize","Cargo slots"),a+=s("maxWeight","Tons"),a+="</div></div></div>",a+=i("Weight"),a+=l.displaySecondBlock(),a+=s("cannonWeight","Cannons",4),a+=s("carroWeight","Carronades",4),a+=s("repairWeight","Repair Set",4),a+="</div></div></div>",a+="</div>",a}_setupSvg(){const t=Object(s.a)(this.select);Object(s.a)(this.select+" svg").remove(),this._svg=t.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),Object(s.a)(this.select+" div").remove(),t.append("div")}_setCompass(){const t=new Array(r.o/2);t.fill(1,0);const e=Object(a.a)().sort(null).value(1)(t),i=Object(o.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(e).join(t=>t.append("path").attr("d",i)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(t=>t.append("circle").attr("r",t=>this._shipCompare.radiusSpeedScale(t)))}}},awzk:function(t,e,i){(function(t){i.d(e,"a",(function(){return S}));var s=i("ZQwz"),a=i("iPFw"),o=i("VkQ2"),r=i("TI0E"),n=i("Qs7V"),l=i("otg8"),d=i("VIqg"),h=i("AWXE"),c=i("dNoP"),p=i("AJ/N"),u=i("pxNS"),m=i("Q4du"),_=i("1mfJ"),g=i.n(_),f=i("Z5fe"),b=i("oggF");function v(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class S extends f.a{constructor(t,e,i){super(t,i),w(this,"shipData",void 0),w(this,"_speedScale",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),this.shipData=e,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const t=Object(s.a)().outerRadius(t=>this._shipCompare.radiusSpeedScale(t)+2).innerRadius(t=>this._shipCompare.radiusSpeedScale(t)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(e=>e.append("path").attr("d",t).attr("id",(t,e)=>"tick"+e)),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(t=>t.append("text").append("textPath").attr("href",(t,e)=>"#tick"+e).text((t,e)=>this.ticksSpeedLabels[e]).attr("startOffset","10%"))}_getHeadingInDegrees(t,e){let i=t-e-180;return i<0&&(i+=360),i}_getSpeed(t){return Object(n.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(l.m)(t)}_updateCompareWindProfiles(){for(const t of this._shipCompare.columnsCompare)Object(u.d)(this._shipCompare.selectedShips[t])||this._shipCompare.selectedShips[t].updateWindProfileRotation()}_setupDrag(){const t=this.shipData.speedDegrees.length,e=360/t,i=new Array(t+1).fill(null).map((t,i)=>i*e);this._speedScale=Object(d.a)().domain(i).range([].concat(v(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=p.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:i}=h.c;t.rotate=this._getHeadingInDegrees(Object(c.m)({x:t.initX,y:t.initY},{x:e,y:i}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipData,e=this._shipCompare.shipMassScale(t),i=e,s=this._shipCompare.svgHeight/2-40,a={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(a).attr("class","ship-outline");o.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),o.append("image").attr("height",e).attr("width",i).attr("x",-e/2).attr("y",-i/2).attr("xlink:href",g.a),o.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const r=o.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=o.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(t.initRotate)),a.this=o,a.compassText=r,o.datum(a).attr("transform",t=>`rotate(${t.initRotate})`)}_drawWindProfile(){const t=Object(a.a)().sort(null).value(1)(this.shipData.speedDegrees),e=o.a,i=Object(r.a)().angle((t,e)=>e*m.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(e);this._shipCompare.windProfileRotate=0;const s=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-s,type:"windProfile"},l=this._mainG.append("g").datum(n).attr("class","wind-profile");l.append("path").attr("d",t=>String(Object(c.g)(t.compassTextX,t.compassTextY,20))+Object(c.h)(t.compassTextX,t.compassTextY,-t.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),l.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20);const d=l.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));l.append("path").attr("class","base-profile").attr("d",i(t)),l.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(t).join(t=>t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*m.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*m.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).append("title").text(t=>Math.round(10*t.data)/10+" knots")),n.this=l,n.compassText=d,l.datum(n).attr("transform",t=>`rotate(${t.initRotate})`)}_printText(){var e;const i=f.a.getCannonsPerDeck(this.shipData.guns),s=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/b.i),a=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/b.o),o=Math.round(this.shipData.crew.max*b.p),r={attack:Object(n.j)(this.shipData.boarding.attack,2),cannonsAccuracy:Object(n.k)(100*this.shipData.boarding.cannonsAccuracy),defense:Object(n.j)(this.shipData.boarding.defense,2),disengageTime:Object(n.c)(this.shipData.boarding.disengageTime),morale:Object(n.c)(this.shipData.boarding.morale),musketsAccuracy:Object(n.k)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:Object(n.c)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:Object(n.c)(this.shipData.boarding.prepPerRound),prepInitial:Object(n.c)(this.shipData.boarding.prepInitial),acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${Object(n.c)(this.shipData.stern.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:""+Object(n.c)(this.shipData.repairTime.bow),cannonBroadside:Object(n.c)(this.shipData.guns.broadside.cannons),cannonsPerDeck:i,carroBroadside:Object(n.c)(this.shipData.guns.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:Object(m.p)(this.shipData.guns.decks,"deck"),fireResistance:Object(n.k)(100*this.shipData.resistance.fire),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${Object(n.c)(this.shipData.bow.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.c)(this.shipData.holdSize),hullRepairAmount:""+Object(n.c)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:`${Object(n.c)(s)} <span class="badge badge-white">${Object(n.c)(s*b.m)}</span>`,leakResistance:Object(n.k)(100*this.shipData.resistance.leaks),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(n.c)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(n.c)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(n.c)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.topThickness)}</span>`,maxCrew:Object(n.c)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.c)(this.shipData.maxWeight),minCrew:Object(n.c)(this.shipData.crew.min),cannonCrew:Object(n.c)(this.shipData.crew.cannons),carroCrew:Object(n.c)(this.shipData.crew.carronades),pump:Object(n.c)(this.shipData.pump.armour),repairTime:""+Object(n.c)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(n.c)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:`${Object(n.c)(a)} <span class="badge badge-white">${Object(n.c)(a*b.m)}</span>`,rollAngle:Object(n.c)(this.shipData.ship.rollAngle),rudder:`${Object(n.c)(this.shipData.rudder.armour)} <span class="badge badge-white">${Object(n.c)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${Object(n.c)(o)} <span class="badge badge-white">${Object(n.c)(o*b.m)}</span>`,sailingCrew:Object(n.c)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:Object(n.c)(this.shipData.sails.armour),shipRating:Object(l.q)(this.shipData.class)+" rate",sideArmor:`${Object(n.c)(this.shipData.sides.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.sides.thickness)}</span>`,splinterResistance:Object(n.k)(100*this.shipData.resistance.splinter),sternRepair:""+Object(n.c)(this.shipData.repairTime.stern),structure:Object(n.c)(this.shipData.structure.armour),turnAcceleration:Object(n.b)(this.shipData.ship.turnAcceleration,4),upgradeXP:Object(n.c)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight),cannonWeight:Object(n.c)(this.shipData.guns.weight.cannons),carroWeight:Object(n.c)(this.shipData.guns.weight.carronades)};r.repairWeight=Object(n.c)((s+a+.1*o)*b.m),r.gunsFront?r.gunsFront+=" "+f.a.pd(r.limitFront):r.gunsFront="–",r.gunsBack?r.gunsBack+=" "+f.a.pd(r.limitBack):r.gunsBack="–",t(""+this.select).find("div").append(f.a.getText(r))}}}).call(this,i("xeH2"))},bqEa:function(t,e,i){t.exports=function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var r="toast",n=t.fn[r],l={animation:"boolean",autohide:"boolean",delay:"number"},d={animation:!0,autohide:!0,delay:500},h=function(){function s(t,e){this._element=t,this._config=this._getConfig(e),this._timeout=null,this._setListeners()}var a,n,h,c=s.prototype;return c.show=function(){var i=this,s=t.Event("show.bs.toast");if(t(this._element).trigger(s),!s.isDefaultPrevented()){this._config.animation&&this._element.classList.add("fade");var a=function(){i._element.classList.remove("showing"),i._element.classList.add("show"),t(i._element).trigger("shown.bs.toast"),i._config.autohide&&(i._timeout=setTimeout((function(){i.hide()}),i._config.delay))};if(this._element.classList.remove("hide"),e.reflow(this._element),this._element.classList.add("showing"),this._config.animation){var o=e.getTransitionDurationFromElement(this._element);t(this._element).one(e.TRANSITION_END,a).emulateTransitionEnd(o)}else a()}},c.hide=function(){if(this._element.classList.contains("show")){var e=t.Event("hide.bs.toast");t(this._element).trigger(e),e.isDefaultPrevented()||this._close()}},c.dispose=function(){clearTimeout(this._timeout),this._timeout=null,this._element.classList.contains("show")&&this._element.classList.remove("show"),t(this._element).off("click.dismiss.bs.toast"),t.removeData(this._element,"bs.toast"),this._element=null,this._config=null},c._getConfig=function(i){return i=o(o(o({},d),t(this._element).data()),"object"==typeof i&&i?i:{}),e.typeCheckConfig(r,i,this.constructor.DefaultType),i},c._setListeners=function(){var e=this;t(this._element).on("click.dismiss.bs.toast",'[data-dismiss="toast"]',(function(){return e.hide()}))},c._close=function(){var i=this,s=function(){i._element.classList.add("hide"),t(i._element).trigger("hidden.bs.toast")};if(this._element.classList.remove("show"),this._config.animation){var a=e.getTransitionDurationFromElement(this._element);t(this._element).one(e.TRANSITION_END,s).emulateTransitionEnd(a)}else s()},s._jQueryInterface=function(e){return this.each((function(){var i=t(this),a=i.data("bs.toast");if(a||(a=new s(this,"object"==typeof e&&e),i.data("bs.toast",a)),"string"==typeof e){if(void 0===a[e])throw new TypeError('No method named "'+e+'"');a[e](this)}}))},a=s,h=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"DefaultType",get:function(){return l}},{key:"Default",get:function(){return d}}],(n=null)&&i(a.prototype,n),h&&i(a,h),s}();return t.fn[r]=h._jQueryInterface,t.fn[r].Constructor=h,t.fn[r].noConflict=function(){return t.fn[r]=n,h._jQueryInterface},h}(i("xeH2"),i("WUlJ"))},cA9Q:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fecd21' d='M0 0h640v480H0z'/%3E%3Ccircle cx='30%25' cy='40%25' fill='red' r='100'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},ck04:function(t,e,i){(function(t){i.d(e,"a",(function(){return f}));i("WUlJ"),i("fCtr"),i("dbdZ");var s=i("mrVq"),a=i("gj+k"),o=i("AKWm"),r=i("pOjD"),n=i("Q4du"),l=i("Qs7V"),d=i("pxNS"),h=i("Bx8B");function c(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function u(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class m{constructor(t,e){u(this,"select",void 0),u(this,"_woodCompare",void 0),u(this,"_id",void 0),u(this,"_g",void 0),this._id=t,this._woodCompare=e,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(o.a)(this.select).select("g")}_setupMainDiv(){Object(o.a)(this.select+" div").remove(),Object(o.a)(this.select).append("div")}}class _ extends m{constructor(t,e,i){super(t,i),u(this,"_woodData",void 0),this._woodData=e,this._printText()}_getProperty(t,e){const i=this._woodData[e].properties.find(e=>e.modifier===t);let s=0,a=!1;return(null==i?void 0:i.amount)&&({amount:s,isPercentage:a}=i),{amount:s,isPercentage:a}}_getPropertySum(t){const e=this._getProperty(t,"frame"),i=this._getProperty(t,"trim");return{amount:e.amount+i.amount,isPercentage:i.isPercentage}}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';e+="<tr>",e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[r,n]of t.properties){if(e+=`<tr><td>${r}</td><td>${n.isPercentage?Object(l.f)(n.amount/100):Object(l.b)(n.amount)}`,e+='<span class="rate">',n.amount>0){var i,s;e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${n.amount/(null!==(i=null===(s=this._woodCompare.minMaxProperty.get(r))||void 0===s?void 0:s.max)&&void 0!==i?i:1)*50}%;"></span>`}else if(n.amount<0){var a,o;const t=n.amount/(null!==(a=null===(o=this._woodCompare.minMaxProperty.get(r))||void 0===o?void 0:o.min)&&void 0!==a?a:1)*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const i=this._getPropertySum(t);e.properties.set(t,{amount:i.amount,isPercentage:i.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class g extends m{constructor(t,e,i,s){super(t,s),u(this,"_baseData",void 0),u(this,"_compareData",void 0),this._baseData=e,this._compareData=i,this._printTextComparison()}static _getDiff(t,e,i,s=1){const a=Number.parseFloat((t-e).toFixed(s));return`${i?Object(l.f)(t/100,s):Object(l.b)(t)} <span class="badge badge-white">${Object(l.j)(a)}</span>`}_getBaseProperty(t,e){const i=this._baseData[e].properties.find(e=>e.modifier===t);let s=0,a=!1;return(null==i?void 0:i.amount)&&({amount:s,isPercentage:a}=i),{amount:s,isPercentage:a}}_getBasePropertySum(t){const e=this._getBaseProperty(t,"frame"),i=this._getBaseProperty(t,"trim");return{amount:e.amount+i.amount,isPercentage:i.isPercentage}}_getCompareProperty(t,e){const i=this._compareData[e].properties.find(e=>e.modifier===t);let s=0,a=!1;return(null==i?void 0:i.amount)&&(s=i.amount,a=i.isPercentage),{amount:s,isPercentage:a}}_getComparePropertySum(t){const e=this._getCompareProperty(t,"frame"),i=this._getCompareProperty(t,"trim");return{amount:e.amount+i.amount,isPercentage:e.isPercentage&&i.isPercentage}}_getText(t){let e=0,i=0,s=0,a="",o='<table class="table table-sm table-striped small wood mt-4"><thead>';o+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[f,b]of t.properties){var r,n,l,d;if(o+=`<tr><td>${f}</td><td>${g._getDiff(b.compare,b.base,b.isPercentage)}`,o+='<span class="rate">',b.compare>=0)b.base>=0?b.compare>b.base?(e=b.base,i=b.compare-b.base,a="pos"):(e=b.compare,i=b.base-b.compare,a="neg"):(e=0,i=b.compare,a="pos"),o+='<span class="bar neutral" style="width:50%;"></span>',o+=`<span class="bar pos diff" style="width:${e/(null!==(r=null===(n=this._woodCompare.minMaxProperty.get(f))||void 0===n?void 0:n.max)&&void 0!==r?r:1)*50}%;"></span>`,o+=`<span class="bar ${a}" style="width:${i/(null!==(l=null===(d=this._woodCompare.minMaxProperty.get(f))||void 0===d?void 0:d.max)&&void 0!==l?l:1)*50}%;"></span>`;else if(b.compare<0){var h,c,p,u,m,_;b.base<0?b.compare>=b.base?(e=b.compare,i=b.base-b.compare,s=-b.base,a="pos"):(e=b.base,i=b.compare-b.base,s=-b.compare,a="neg"):(e=0,i=b.compare,s=-b.compare,a="neg"),o+=`<span class="bar neutral" style="width:${50+s/(null!==(h=null===(c=this._woodCompare.minMaxProperty.get(f))||void 0===c?void 0:c.min)&&void 0!==h?h:1)*50}%;"></span>`,o+=`<span class="bar ${a}" style="width:${i/(null!==(p=null===(u=this._woodCompare.minMaxProperty.get(f))||void 0===u?void 0:u.min)&&void 0!==p?p:1)*50}%;"></span>`,o+=`<span class="bar neg diff" style="width:${e/(null!==(m=null===(_=this._woodCompare.minMaxProperty.get(f))||void 0===_?void 0:_.min)&&void 0!==m?m:1)*50}%;"></span>`}else o+='<span class="bar neutral"></span>';o+="</span></td></tr>"}return o+="</tbody></table>",o}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const i=this._getBasePropertySum(t),s=this._getComparePropertySum(t);e.properties.set(t,{base:i.amount,compare:s.amount,isPercentage:i.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class f{constructor(t){u(this,"baseFunction",void 0),u(this,"instances",{}),u(this,"minMaxProperty",new Map),u(this,"propertyNames",void 0),u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_woodData",void 0),u(this,"_columnsCompare",void 0),u(this,"_defaultWoodId",{}),u(this,"_columns",void 0),u(this,"_frameSelectData",void 0),u(this,"_trimSelectData",void 0),u(this,"_options",{}),u(this,"_woodIdsSelected",{}),this.baseFunction=t,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(t,e){var i,s;return null!==(i=null===(s=this._woodData[t].find(t=>t.id===e))||void 0===s?void 0:s.name)&&void 0!==i?i:""}_findWoodId(t,e){var i,s;return null!==(i=null===(s=this._woodData[t].find(t=>t.name===e))||void 0===s?void 0:s.id)&&void 0!==i?i:0}_setupData(){this.propertyNames=new Set([].concat(c(this._woodData.frame.flatMap(t=>t.properties.map(t=>t.modifier))),c(this._woodData.trim.flatMap(t=>t.properties.map(t=>t.modifier)))).sort(h.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await i.e(16).then(i.t.bind(null,"xOpV",3))).default,this._setupData()}catch(t){Object(d.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",this._baseName),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(h.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(h.b)(["name"])),this._setOption(this._frameSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString(),this._trimSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString());for(const r of this.propertyNames){var t,e,i,o;const n=c(this._woodData.frame.map(t=>{var e,i;return null!==(e=null===(i=t.properties.find(t=>t.modifier===r))||void 0===i?void 0:i.amount)&&void 0!==e?e:0})),l=c(this._woodData.trim.map(t=>{var e,i;return null!==(e=null===(i=t.properties.find(t=>t.modifier===r))||void 0===i?void 0:i.amount)&&void 0!==e?e:0})),d=null!==(t=Object(s.a)(n))&&void 0!==t?t:0,h=null!==(e=Object(a.a)(n))&&void 0!==e?e:0,p=null!==(i=Object(s.a)(l))&&void 0!==i?i:0,u=null!==(o=Object(a.a)(l))&&void 0!==o?o:0;this._addMinMaxProperty(r,{min:d+p>=0?0:d+p,max:h+u})}}_injectModal(){Object(n.n)({id:this._modalId,title:this._baseName});const t=Object(o.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const e of this._columns){const i=t.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp"));for(const t of d.h){const s=`${this.baseFunction}-${t}-${e}-select`;i.append("label").attr("for",s),i.append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}i.append("div").attr("id",`${this.baseFunction}-${e}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const i of d.h){const s=t(`#${this.baseFunction}-${i}-${e}-select`);this._setupWoodSelects(e,i,s),this._setupSelectListener(e,i,s)}}_setWoodsSelected(t,e,i){this._woodIdsSelected[t]||(this._woodIdsSelected[t]={}),this._woodIdsSelected[t][e]=i}_setupWoodSelects(t,e,i){this._setWoodsSelected(t,e,this._defaultWoodId[e]),i.append(this._options[e]),("wood"!==this.baseFunction||"Base"!==t&&"wood"===this.baseFunction)&&i.attr("disabled","disabled")}_setOtherSelect(e,i){const s="frame"===i?"trim":"frame";this._woodIdsSelected[e][s]===this._defaultWoodId[s]&&t(`#${this.baseFunction}-${s}-${e}-select`).val(this._defaultWoodId[s]).selectpicker("refresh")}enableSelects(e){for(const i of d.h)t(`#${this.baseFunction}-${i}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(t,e,i){const s=Number(i.val());if(this._setWoodsSelected(t,e,s),this._setOtherSelect(t,e),"Base"===t){this._addInstance(t,new _("Base",this._getWoodData("Base"),this));for(const t of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(t),this.instances[t]&&this._addInstance(t,new g(t,this._getWoodData("Base"),this._getWoodData(t),this))}else this._addInstance(t,new g(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,i){i.on("change",()=>this._woodSelected(t,e,i)).selectpicker({title:"Select "+e})}_getWoodData(t){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[t].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[t].trim)}}_addMinMaxProperty(t,e){this.minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this.instances[t]=e}getWoodTypeData(t,e){var i;return null!==(i=this._woodData[t].find(t=>t.id===e))&&void 0!==i?i:{}}}}).call(this,i("xeH2"))},dNoP:function(t,e,i){(function(t){i.d(e,"e",(function(){return r})),i.d(e,"f",(function(){return n})),i.d(e,"j",(function(){return l})),i.d(e,"m",(function(){return d})),i.d(e,"a",(function(){return h})),i.d(e,"k",(function(){return c})),i.d(e,"l",(function(){return p})),i.d(e,"d",(function(){return u})),i.d(e,"c",(function(){return m})),i.d(e,"b",(function(){return _})),i.d(e,"g",(function(){return g})),i.d(e,"i",(function(){return f})),i.d(e,"h",(function(){return b}));var s=i("sCaM"),a=i("Q4du"),o=i("otg8");const r=(t,e=!1)=>{let i;return i=Number.isNaN(Number(t))?t:Object(o.m)(Number(t)),`<${e?"tspan":"span"} class="caps">${i}</${e?"tspan":"span"}>`},n=(t,e=!1)=>{let i,s;return Number.isNaN(Number(t))?(i=t,s=Object(o.c)(i)%o.j):(s=Number(t),i=Object(o.m)(s)),`<${e?"tspan":"span"} class="caps">${i}</${e?"tspan":"span"}> (${s}°)`},l=e=>{const i=Object(o.m)(t("#"+e).roundSlider("getValue"));let s;return s=Number.isNaN(Number(i))?Object(o.c)(i):Number(i),s},d=(t,e)=>{let i=Math.atan2(e.y-t.y,e.x-t.x);i-=Math.PI/2;let s=Object(o.s)(i);return s<0&&(s+=o.j),s},h=(t,e,i=!0)=>{if(e<2)return[t];const s=t.length,a=[];let o,r=0;if(s%e==0)for(o=Math.floor(s/e);r<s;)a.push(t.slice(r,r+=o));else if(i)for(;r<s;)o=Math.ceil((s-r)/e--),a.push(t.slice(r,r+=o));else{for(e-=1,o=Math.floor(s/e),s%o==0&&(o-=1);r<o*e;)a.push(t.slice(r,r+=o));a.push(t.slice(o*e))}return a},c=({element:t,radius:e})=>{const i=a.o,r=o.j/i,n=Math.round(.8*e),l=new Array(i).fill(void 0).map((t,e)=>Object(o.m)(e*r)),d=Object(s.a)().range([0-r/2,o.j-r/2]).domain(l).align(0);t.append("circle").attr("r",n).style("stroke-width","3px");const h=t.append("text"),c=t.selectAll("g").data(l).join(t=>t.append("g").attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=d(t))&&void 0!==e?e:0)+d.bandwidth()/2-o.l)})translate(${n},0)`}));c.filter((t,e)=>e%3!=0).append("line").attr("x2",9),c.filter((t,e)=>e%3==0).append("text").attr("transform",t=>{var e,i,s,a,o;let r,n=Math.round((null!==(e=d(t))&&void 0!==e?e:0)+d.bandwidth()/2);h.text(t);const l=null!==(i=null===(s=h.node())||void 0===s?void 0:s.getBBox().height)&&void 0!==i?i:0,c=null!==(a=null===(o=h.node())||void 0===o?void 0:o.getBBox().width)&&void 0!==a?a:0;return n>=0&&n<=45||315===n?(n=90,r="0,-"+l/2):90===n?(n=0,r=c/2+3+",0"):270===n?(n=180,r=`-${c/2+3},0`):(n=-90,r="0,"+(l/2+3+2)),`rotate(${n})translate(${r})`}).text(t=>t),h.remove()},p=({element:t,radius:e})=>{const i=a.o,r=o.j/i,n=Math.round(.8*e),l=new Array(i).fill(void 0).map((t,e)=>Object(o.m)(e*r)),d=Object(s.a)().range([0-r/2,o.j-r/2]).domain(l).align(0);t.append("circle").attr("r",n).style("stroke-width","1.5px");t.selectAll("line").data(l).join(t=>t.append("line").attr("x2",(t,e)=>e%3==0?e%6==0?6:4:2).attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=d(t))&&void 0!==e?e:0)+d.bandwidth()/2)})translate(${n},0)`}))},u=t=>`<span class="caps">${t}</span>`,m=(t,e)=>{navigator.clipboard||((t,e)=>{var i,s;if(!(null===(i=(s=document).queryCommandSupported)||void 0===i?void 0:i.call(s,"copy")))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const i=document.createElement("input");i.type="text",i.value=t,i.style.position="absolute",i.style.left="-1000px",i.style.top="-1000px",e.append(i),i.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{i.remove()}}})(t,e),(async t=>{navigator.clipboard.writeText(t).then(()=>!0).catch(e=>(console.error(`Cannot copy ${t} to clipboard`,e),!1))})(t)},_=(t,e,i)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const s=new URL(window.location.href);s.searchParams.set("x",String(t)),s.searchParams.set("z",String(e)),m(s.href,i)}},g=(t,e,i)=>`M${t},${e} m${-i},0 a${i},${i} 0,1,0 ${2*i},0 a${i},${i} 0,1,0 ${2*-i},0`,f=(t,e,i)=>`M${t-i/2},${e-i/2}h${i}v${i}h${-i}z`,b=(t,e,i)=>`M${t},${e}v${i}`}).call(this,i("xeH2"))},"gQ/v":function(t,e,i){t.exports=function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function a(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function o(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?a(Object(i),!0).forEach((function(e){s(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):a(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var r="collapse",n="bs.collapse",l=t.fn[r],d={toggle:!0,parent:""},h={toggle:"boolean",parent:"(string|element)"},c=function(){function s(t,i){this._isTransitioning=!1,this._element=t,this._config=this._getConfig(i),this._triggerArray=[].slice.call(document.querySelectorAll('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'));for(var s=[].slice.call(document.querySelectorAll('[data-toggle="collapse"]')),a=0,o=s.length;a<o;a++){var r=s[a],n=e.getSelectorFromElement(r),l=[].slice.call(document.querySelectorAll(n)).filter((function(e){return e===t}));null!==n&&l.length>0&&(this._selector=n,this._triggerArray.push(r))}this._parent=this._config.parent?this._getParent():null,this._config.parent||this._addAriaAndCollapsedClass(this._element,this._triggerArray),this._config.toggle&&this.toggle()}var a,l,c,p=s.prototype;return p.toggle=function(){t(this._element).hasClass("show")?this.hide():this.show()},p.show=function(){var i,a,o=this;if(!(this._isTransitioning||t(this._element).hasClass("show")||(this._parent&&0===(i=[].slice.call(this._parent.querySelectorAll(".show, .collapsing")).filter((function(t){return"string"==typeof o._config.parent?t.getAttribute("data-parent")===o._config.parent:t.classList.contains("collapse")}))).length&&(i=null),i&&(a=t(i).not(this._selector).data(n))&&a._isTransitioning))){var r=t.Event("show.bs.collapse");if(t(this._element).trigger(r),!r.isDefaultPrevented()){i&&(s._jQueryInterface.call(t(i).not(this._selector),"hide"),a||t(i).data(n,null));var l=this._getDimension();t(this._element).removeClass("collapse").addClass("collapsing"),this._element.style[l]=0,this._triggerArray.length&&t(this._triggerArray).removeClass("collapsed").attr("aria-expanded",!0),this.setTransitioning(!0);var d="scroll"+(l[0].toUpperCase()+l.slice(1)),h=e.getTransitionDurationFromElement(this._element);t(this._element).one(e.TRANSITION_END,(function(){t(o._element).removeClass("collapsing").addClass("collapse show"),o._element.style[l]="",o.setTransitioning(!1),t(o._element).trigger("shown.bs.collapse")})).emulateTransitionEnd(h),this._element.style[l]=this._element[d]+"px"}}},p.hide=function(){var i=this;if(!this._isTransitioning&&t(this._element).hasClass("show")){var s=t.Event("hide.bs.collapse");if(t(this._element).trigger(s),!s.isDefaultPrevented()){var a=this._getDimension();this._element.style[a]=this._element.getBoundingClientRect()[a]+"px",e.reflow(this._element),t(this._element).addClass("collapsing").removeClass("collapse show");var o=this._triggerArray.length;if(o>0)for(var r=0;r<o;r++){var n=this._triggerArray[r],l=e.getSelectorFromElement(n);null!==l&&(t([].slice.call(document.querySelectorAll(l))).hasClass("show")||t(n).addClass("collapsed").attr("aria-expanded",!1))}this.setTransitioning(!0),this._element.style[a]="";var d=e.getTransitionDurationFromElement(this._element);t(this._element).one(e.TRANSITION_END,(function(){i.setTransitioning(!1),t(i._element).removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")})).emulateTransitionEnd(d)}}},p.setTransitioning=function(t){this._isTransitioning=t},p.dispose=function(){t.removeData(this._element,n),this._config=null,this._parent=null,this._element=null,this._triggerArray=null,this._isTransitioning=null},p._getConfig=function(t){return(t=o(o({},d),t)).toggle=Boolean(t.toggle),e.typeCheckConfig(r,t,h),t},p._getDimension=function(){return t(this._element).hasClass("width")?"width":"height"},p._getParent=function(){var i,a=this;e.isElement(this._config.parent)?(i=this._config.parent,void 0!==this._config.parent.jquery&&(i=this._config.parent[0])):i=document.querySelector(this._config.parent);var o='[data-toggle="collapse"][data-parent="'+this._config.parent+'"]',r=[].slice.call(i.querySelectorAll(o));return t(r).each((function(t,e){a._addAriaAndCollapsedClass(s._getTargetFromElement(e),[e])})),i},p._addAriaAndCollapsedClass=function(e,i){var s=t(e).hasClass("show");i.length&&t(i).toggleClass("collapsed",!s).attr("aria-expanded",s)},s._getTargetFromElement=function(t){var i=e.getSelectorFromElement(t);return i?document.querySelector(i):null},s._jQueryInterface=function(e){return this.each((function(){var i=t(this),a=i.data(n),r=o(o(o({},d),i.data()),"object"==typeof e&&e?e:{});if(!a&&r.toggle&&"string"==typeof e&&/show|hide/.test(e)&&(r.toggle=!1),a||(a=new s(this,r),i.data(n,a)),"string"==typeof e){if(void 0===a[e])throw new TypeError('No method named "'+e+'"');a[e]()}}))},a=s,c=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return d}}],(l=null)&&i(a.prototype,l),c&&i(a,c),s}();return t(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',(function(i){"A"===i.currentTarget.tagName&&i.preventDefault();var s=t(this),a=e.getSelectorFromElement(this),o=[].slice.call(document.querySelectorAll(a));t(o).each((function(){var e=t(this),i=e.data(n)?"toggle":s.data();c._jQueryInterface.call(e,i)}))})),t.fn[r]=c._jQueryInterface,t.fn[r].Constructor=c,t.fn[r].noConflict=function(){return t.fn[r]=l,c._jQueryInterface},c}(i("xeH2"),i("WUlJ"))},gQbg:function(t,e,i){(function(t){i.d(e,"a",(function(){return w}));i("WUlJ"),i("gUfG"),i("dbdZ");var s=i("Wgwc"),a=i.n(s),o=i("+QaA"),r=i.n(o),n=i("5Bip"),l=i.n(n),d=i("Ds8A"),h=i.n(d),c=i("pOjD"),p=i("pxNS"),u=i("Q4du"),m=i("Qs7V"),_=i("otg8"),g=i("Bx8B"),f=i("X2Cj");function b(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}a.a.extend(r.a),a.a.extend(l.a),a.a.extend(h.a),a.a.locale("en-gb");class w{constructor(t,e,i){y(this,"isInventorySelected",void 0),y(this,"_dataLoaded",!1),y(this,"_distances",new Map),y(this,"_frontlinesData",void 0),y(this,"_nation",void 0),y(this,"_ports",void 0),y(this,"_buyGoodsId",void 0),y(this,"_buyGoodsSelector",void 0),y(this,"_frontlineAttackingNationId",void 0),y(this,"_frontlineAttackingNationSelector",void 0),y(this,"_frontlineDefendingNationId",void 0),y(this,"_frontlineDefendingNationSelector",void 0),y(this,"_inventoryId",void 0),y(this,"_inventorySelector",void 0),y(this,"_map",void 0),y(this,"_numberPorts",void 0),y(this,"_pbZone",void 0),y(this,"_portNamesId",void 0),y(this,"_portNamesSelector",void 0),y(this,"_propClanId",void 0),y(this,"_propClanSelector",void 0),y(this,"_propNationId",void 0),y(this,"_propNationSelector",void 0),y(this,"_sellProfit",new Map),this._ports=t,this._pbZone=e,this._map=i,this._numberPorts=this._ports.portData.length,this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.querySelector("#"+this._frontlineAttackingNationId),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.querySelector("#"+this._frontlineDefendingNationId),this._portNamesId="port-names-select",this._portNamesSelector=document.querySelector("#"+this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.querySelector("#"+this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.querySelector("#"+this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.querySelector("#"+this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.querySelector("#"+this._propClanId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect()}_resetOtherSelects(e){for(const i of[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector])i===e||i===this._propClanSelector&&e===this._propNationSelector||i===this._propNationSelector&&e===this._propClanSelector||t(i).val("default").selectpicker("refresh")}async _loadData(){if(!this._dataLoaded){const t="data";try{this._frontlinesData=await(await fetch(`${t}/${this._map.serverName}-frontlines.json`)).json();const e=(await i.e(6).then(i.t.bind(null,"VEL/",3))).default;this._distances=new Map(e.map(([t,e,i])=>[t*this._numberPorts+e,i])),this._dataLoaded=!0}catch(t){Object(p.f)(t)}}}_setupListener(){var e,i,s,a,o,r,n,l;t(this._portNamesSelector).one("show.bs.select",()=>{this._injectPortSelect()}),this._portNamesSelector.addEventListener("change",async t=>{Object(c.b)("Menu","Trade relations"),await this._loadData(),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()}),t(this._buyGoodsSelector).one("show.bs.select",async()=>{await this._loadData(),this._injectGoodsSelect()}),this._buyGoodsSelector.addEventListener("change",t=>{Object(c.b)("Menu","Goods’ relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()}),this._inventorySelector.addEventListener("change",t=>{Object(c.b)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()}),this._frontlineAttackingNationSelector.addEventListener("change",async t=>{Object(c.b)("Menu","Frontlines Attack"),await this._loadData(),this._resetOtherSelects(this._frontlineAttackingNationSelector),this._frontlineAttackingNationSelected(),t.preventDefault()}),this._frontlineDefendingNationSelector.addEventListener("change",async t=>{Object(c.b)("Menu","Frontlines Defence"),await this._loadData(),this._resetOtherSelects(this._frontlineDefendingNationSelector),this._frontlineDefendingNationSelected(),t.preventDefault()}),this._propNationSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()}),this._propClanSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()}),null===(e=document.querySelector("#menu-prop-deep"))||void 0===e||e.addEventListener("click",()=>this._depthSelected("deep")),null===(i=document.querySelector("#menu-prop-shallow"))||void 0===i||i.addEventListener("click",()=>this._depthSelected("shallow")),null===(s=document.querySelector("#menu-prop-all"))||void 0===s||s.addEventListener("click",()=>this._allSelected()),null===(a=document.querySelector("#menu-prop-non-capturable"))||void 0===a||a.addEventListener("click",()=>this._nonCapSelected()),null===(o=document.querySelector("#menu-prop-today"))||void 0===o||o.addEventListener("click",()=>this._capturedToday()),null===(r=document.querySelector("#menu-prop-yesterday"))||void 0===r||r.addEventListener("click",()=>this._capturedYesterday()),null===(n=document.querySelector("#menu-prop-this-week"))||void 0===n||n.addEventListener("click",()=>this._capturedThisWeek()),null===(l=document.querySelector("#menu-prop-last-week"))||void 0===l||l.addEventListener("click",()=>this._capturedLastWeek()),Object(u.m)("selectPortNavbar")}_injectPortSelect(){const e=""+this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(g.b)(["name"])).map(t=>`<option data-subtext="${t.nation}" value="${t.coord.toString()}" data-id="${t.id}">${t.name}</option>`).join("");this._portNamesSelector.insertAdjacentHTML("beforeend",e),t(this._portNamesSelector).selectpicker("refresh")}_injectGoodsSelect(){const e=new Map,i=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const t of this._ports.portDataDefault)for(const o of i){const i=t[o];if(i)for(const t of i){var s,a;e.set(t,null!==(s=null===(a=this._ports.tradeItem.get(t))||void 0===a?void 0:a.name)&&void 0!==s?s:"")}}const o=""+b(e).sort((t,e)=>t[1].localeCompare(e[1])).map(t=>`<option value="${t[0]}">${t[1]}</option>`).join("");this._buyGoodsSelector.insertAdjacentHTML("beforeend",o),t(this._buyGoodsSelector).selectpicker("refresh")}setupInventorySelect(e){if(!this._inventorySelector.classList.contains("selectpicker")){const e=new Set;for(const t of this._ports.portDataDefault)if(t.inventory)for(const i of t.inventory)e.add(i.name);const i=""+b(e).sort(g.a).map(t=>`<option>${t}</option>`).join("");this._inventorySelector.insertAdjacentHTML("beforeend",i),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))}_getNationOptions(t=!0){return""+p.e.filter(e=>!(!t&&("FT"===e.short||"NT"===e.short))).sort(Object(g.b)(["name"])).map(t=>`<option value="${t.short}">${t.name}</option>`).join("")}_setupFrontlinesNationSelect(){const e=this._getNationOptions(!1);this._frontlineAttackingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineAttackingNationSelector.classList.add("selectpicker"),t(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),this._frontlineDefendingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineDefendingNationSelector.classList.add("selectpicker"),t(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupNationSelect(){const e=this._getNationOptions(!0);this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupClanSelect(){const e=new Set;for(const t of this._ports.portData.filter(t=>""!==t.capturer))e.add(t.capturer);this._propClanSelector.innerHTML="";let i="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,i=""+b(e).sort(g.a).map(t=>`<option value="${t}" class="caps">${t}</option>`).join("")),this._propClanSelector.insertAdjacentHTML("beforeend",i),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_getSailingDistance(t,e){var i,s;return t<e?null!==(i=this._distances.get(t*this._numberPorts+e))&&void 0!==i?i:0:null!==(s=this._distances.get(e*this._numberPorts+t))&&void 0!==s?s:0}_setTradePortPartners(){var t;const e=null!==(t=this._ports.portDataDefault.find(t=>t.id===this._ports.tradePortId))&&void 0!==t?t:[];e&&this._setTradeRelations(e)}_setTradeRelations(t){const e=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.price)&&void 0!==e?e:0},i=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.distanceFactor)&&void 0!==e?e:0},s=t=>{var e,i;return null!==(e=null===(i=this._ports.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.portTax)&&void 0!==e?e:0},a=t=>{var e,i;const s=this._ports.portDataDefault.find(e=>e.id===t);return{x:null!==(e=null==s?void 0:s.coordinates[0])&&void 0!==e?e:0,y:null!==(i=null==s?void 0:s.coordinates[1])&&void 0!==i?i:0}},o=(t,e)=>{const i=a(t),s=a(e);return Object(_.p)(i,s)},r=(t,e)=>{let i=1/0;const s=new Set(this._ports.portDataDefault.filter(t=>{var i,s,a;return null!==(i=null===(s=t.dropsTrading)||void 0===s?void 0:s.includes(e))&&void 0!==i?i:null===(a=t.dropsNonTrading)||void 0===a?void 0:a.includes(e)}).map(t=>t.id));for(const e of s)i=Math.min(i,o(e,t.id));return i},n=(t,a,o)=>{const n=r(a,o),l=this._getSailingDistance(t.id,a.id),d=s(t.id),h=s(a.id);let c=e(o),p=3*c+n*c*i(o)/6/100;c*=1+d,p/=1+h;const u=Math.round(p-c);return{profit:u,profitPerDistance:u/l}},l=(t,e,i)=>{const s=String(e.id).padStart(4,"0")+String(i).padStart(4,"0");return this._sellProfit.has(s)||this._sellProfit.set(s,n(t,e,i)),this._sellProfit.get(s)},d=e=>{var i,s,a,o;const r=null!==(i=new Set(null===(s=t.dropsTrading)||void 0===s?void 0:s.map(t=>t)))&&void 0!==i?i:[];return null!==(a=null===(o=e.consumesTrading)||void 0===o?void 0:o.filter(t=>r.has(t)).map(i=>{var s,a;return{name:null!==(s=null===(a=this._ports.tradeItem.get(i))||void 0===a?void 0:a.name)&&void 0!==s?s:"",profit:l(t,e,i)}}))&&void 0!==a?a:[]},h=e=>{var i,s,a,o;const r=null!==(i=new Set(null===(s=t.consumesTrading)||void 0===s?void 0:s.map(t=>t)))&&void 0!==i?i:[];return null!==(a=null===(o=e.dropsTrading)||void 0===o?void 0:o.filter(t=>r.has(t)).map(i=>{var s,a;return{name:null!==(s=null===(a=this._ports.tradeItem.get(i))||void 0===a?void 0:a.name)&&void 0!==s?s:"",profit:l(e,t,i)}}))&&void 0!==a?a:[]};this._ports.portData=this._ports.portDataDefault.map(e=>(e.sailingDistanceToTradePort=this._getSailingDistance(e.id,t.id),e.goodsToBuyInTradePort=d(e),e.buyInTradePort=Boolean(e.goodsToBuyInTradePort.length),e.goodsToSellInTradePort=h(e),e.sellInTradePort=Boolean(e.goodsToSellInTradePort.length),e)).filter(t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort)}_portSelected(){const t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),i=Number(t.getAttribute("data-id"));this._ports.currentPort={id:i,coord:{x:Number(e[0]),y:Number(e[1])}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone.showPB&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update(),this._map.initialZoomAndPan()}_goodSelected(){const t=Number(this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value),e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>{var i,s,a;return(null===(i=e.dropsTrading)||void 0===i?void 0:i.some(e=>e===t))||(null===(s=e.dropsNonTrading)||void 0===s?void 0:s.some(e=>e===t))||(null===(a=e.producesNonTrading)||void 0===a?void 0:a.some(e=>e===t))}))).map(t=>(t.isSource=!0,t)),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>{var i;return null===(i=e.consumesTrading)||void 0===i?void 0:i.some(e=>e===t)}))).map(t=>(t.isSource=!1,t));this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(i),this._ports.showRadius="currentGood",this._ports.update()}inventorySelected(){this.isInventorySelected=!0;const t=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,e=new Map,i=new Map,s=this._ports.portDataDefault.filter(e=>e.inventory.some(e=>e.name===t)).sort(Object(g.b)(["name"])).map(s=>{const a=s.inventory.find(e=>e.name===t);return a&&(s.sellInTradePort=a.buyQuantity>0,s.sellInTradePort&&e.set(s.name,{name:s.name,nation:s.nation,good:a}),s.buyInTradePort=a.sellQuantity>0,s.buyInTradePort&&i.set(s.name,{name:s.name,nation:s.nation,good:a})),s});this._ports.setShowRadiusSetting("off"),this._ports.portData=s,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{let s="";if(s+=`<h5>${t}</h5>`,e.size){s+="<h6>Buy</h6>";for(const[,t]of e)s+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(m.c)(t.good.buyQuantity)} @ ${Object(m.g)(t.good.buyPrice)}<br>`}if(e&&i&&(s+="<p></p>"),i.size){s+="<h6>Sell</h6>";for(const[,t]of i)s+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(m.c)(t.good.sellQuantity)} @ ${Object(m.g)(t.good.sellPrice)}<br>`}return s})()),this._ports.update()}_setFrontlinePorts(t,e){const i=this._frontlinesData[t][e],s=new Set(i.map(t=>Number(t.key))),a=new Set(i.flatMap(t=>t.value.map(t=>t)));this._ports.portData=this._ports.portDataDefault.map(t=>(t.enemyPort=s.has(t.id),t.ownPort=a.has(t.id),t))}_frontlineAttackingNationSelected(){const t=this._frontlineAttackingNationSelector.options[this._frontlineAttackingNationSelector.selectedIndex].value;Object(p.g)(t)&&(this._setFrontlinePorts("attacking",t),this._ports.showRadius="frontline",this._ports.update())}_frontlineDefendingNationSelected(){const t=this._frontlineDefendingNationSelector.options[this._frontlineDefendingNationSelector.selectedIndex].value;Object(p.g)(t)&&(this._setFrontlinePorts("defending",t),this._ports.showRadius="frontline",this._ports.update())}_nationSelected(){this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,Object(p.g)(this._nation)?(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")):this._nation="NT"}_clanSelected(){const t=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;t?this._ports.portData=this._ports.portDataDefault.filter(e=>e.capturer===t):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation)),this._ports.showRadius="",this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.shallow:!e.shallow);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.availableForAll);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_nonCapSelected(){const t=this._ports.portDataDefault.filter(t=>!t.capturable);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_filterCaptured(t,e){const i=this._ports.portDataDefault.filter(i=>a()(i.lastPortBattle,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]"));this._ports.portData=i,this._ports.showRadius="",this._ports.update()}_capturedToday(){const t=a.a.utc();let e=a()().utc().hour(f.c).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=a.a.utc();let e=a()().utc().hour(f.c).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=a()().utc().startOf("week"),e=t.utc().hour(f.c),i=a()(t).utc().add(7,"day").hour(f.c);this._filterCaptured(e,i)}_capturedLastWeek(){const t=a()().utc().startOf("week"),e=a()(t).utc().subtract(7,"day").hour(f.c),i=t.utc().hour(f.c);this._filterCaptured(e,i)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}}}).call(this,i("xeH2"))},gUfG:function(t,e,i){t.exports=function(t,e,i){function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function o(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function r(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?o(Object(i),!0).forEach((function(e){a(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):o(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var n="dropdown",l="bs.dropdown",d="."+l,h=t.fn[n],c=new RegExp("38|40|27"),p={offset:0,flip:!0,boundary:"scrollParent",reference:"toggle",display:"dynamic",popperConfig:null},u={offset:"(number|string|function)",flip:"boolean",boundary:"(string|element)",reference:"(string|element)",display:"string",popperConfig:"(null|object)"},m=function(){function a(t,e){this._element=t,this._popper=null,this._config=this._getConfig(e),this._menu=this._getMenuElement(),this._inNavbar=this._detectNavbar(),this._addEventListeners()}var o,h,m,_=a.prototype;return _.toggle=function(){if(!this._element.disabled&&!t(this._element).hasClass("disabled")){var e=t(this._menu).hasClass("show");a._clearMenus(),e||this.show(!0)}},_.show=function(s){if(void 0===s&&(s=!1),!(this._element.disabled||t(this._element).hasClass("disabled")||t(this._menu).hasClass("show"))){var o={relatedTarget:this._element},r=t.Event("show.bs.dropdown",o),n=a._getParentFromElement(this._element);if(t(n).trigger(r),!r.isDefaultPrevented()){if(!this._inNavbar&&s){if(void 0===e)throw new TypeError("Bootstrap's dropdowns require Popper.js (https://popper.js.org/)");var l=this._element;"parent"===this._config.reference?l=n:i.isElement(this._config.reference)&&(l=this._config.reference,void 0!==this._config.reference.jquery&&(l=this._config.reference[0])),"scrollParent"!==this._config.boundary&&t(n).addClass("position-static"),this._popper=new e(l,this._menu,this._getPopperConfig())}"ontouchstart"in document.documentElement&&0===t(n).closest(".navbar-nav").length&&t(document.body).children().on("mouseover",null,t.noop),this._element.focus(),this._element.setAttribute("aria-expanded",!0),t(this._menu).toggleClass("show"),t(n).toggleClass("show").trigger(t.Event("shown.bs.dropdown",o))}}},_.hide=function(){if(!this._element.disabled&&!t(this._element).hasClass("disabled")&&t(this._menu).hasClass("show")){var e={relatedTarget:this._element},i=t.Event("hide.bs.dropdown",e),s=a._getParentFromElement(this._element);t(s).trigger(i),i.isDefaultPrevented()||(this._popper&&this._popper.destroy(),t(this._menu).toggleClass("show"),t(s).toggleClass("show").trigger(t.Event("hidden.bs.dropdown",e)))}},_.dispose=function(){t.removeData(this._element,l),t(this._element).off(d),this._element=null,this._menu=null,null!==this._popper&&(this._popper.destroy(),this._popper=null)},_.update=function(){this._inNavbar=this._detectNavbar(),null!==this._popper&&this._popper.scheduleUpdate()},_._addEventListeners=function(){var e=this;t(this._element).on("click.bs.dropdown",(function(t){t.preventDefault(),t.stopPropagation(),e.toggle()}))},_._getConfig=function(e){return e=r(r(r({},this.constructor.Default),t(this._element).data()),e),i.typeCheckConfig(n,e,this.constructor.DefaultType),e},_._getMenuElement=function(){if(!this._menu){var t=a._getParentFromElement(this._element);t&&(this._menu=t.querySelector(".dropdown-menu"))}return this._menu},_._getPlacement=function(){var e=t(this._element.parentNode),i="bottom-start";return e.hasClass("dropup")?i=t(this._menu).hasClass("dropdown-menu-right")?"top-end":"top-start":e.hasClass("dropright")?i="right-start":e.hasClass("dropleft")?i="left-start":t(this._menu).hasClass("dropdown-menu-right")&&(i="bottom-end"),i},_._detectNavbar=function(){return t(this._element).closest(".navbar").length>0},_._getOffset=function(){var t=this,e={};return"function"==typeof this._config.offset?e.fn=function(e){return e.offsets=r(r({},e.offsets),t._config.offset(e.offsets,t._element)||{}),e}:e.offset=this._config.offset,e},_._getPopperConfig=function(){var t={placement:this._getPlacement(),modifiers:{offset:this._getOffset(),flip:{enabled:this._config.flip},preventOverflow:{boundariesElement:this._config.boundary}}};return"static"===this._config.display&&(t.modifiers.applyStyle={enabled:!1}),r(r({},t),this._config.popperConfig)},a._jQueryInterface=function(e){return this.each((function(){var i=t(this).data(l);if(i||(i=new a(this,"object"==typeof e?e:null),t(this).data(l,i)),"string"==typeof e){if(void 0===i[e])throw new TypeError('No method named "'+e+'"');i[e]()}}))},a._clearMenus=function(e){if(!e||3!==e.which&&("keyup"!==e.type||9===e.which))for(var i=[].slice.call(document.querySelectorAll('[data-toggle="dropdown"]')),s=0,o=i.length;s<o;s++){var r=a._getParentFromElement(i[s]),n=t(i[s]).data(l),d={relatedTarget:i[s]};if(e&&"click"===e.type&&(d.clickEvent=e),n){var h=n._menu;if(t(r).hasClass("show")&&!(e&&("click"===e.type&&/input|textarea/i.test(e.target.tagName)||"keyup"===e.type&&9===e.which)&&t.contains(r,e.target))){var c=t.Event("hide.bs.dropdown",d);t(r).trigger(c),c.isDefaultPrevented()||("ontouchstart"in document.documentElement&&t(document.body).children().off("mouseover",null,t.noop),i[s].setAttribute("aria-expanded","false"),n._popper&&n._popper.destroy(),t(h).removeClass("show"),t(r).removeClass("show").trigger(t.Event("hidden.bs.dropdown",d)))}}}},a._getParentFromElement=function(t){var e,s=i.getSelectorFromElement(t);return s&&(e=document.querySelector(s)),e||t.parentNode},a._dataApiKeydownHandler=function(e){if(!(/input|textarea/i.test(e.target.tagName)?32===e.which||27!==e.which&&(40!==e.which&&38!==e.which||t(e.target).closest(".dropdown-menu").length):!c.test(e.which))&&!this.disabled&&!t(this).hasClass("disabled")){var i=a._getParentFromElement(this),s=t(i).hasClass("show");if(s||27!==e.which){if(e.preventDefault(),e.stopPropagation(),!s||s&&(27===e.which||32===e.which))return 27===e.which&&t(i.querySelector('[data-toggle="dropdown"]')).trigger("focus"),void t(this).trigger("click");var o=[].slice.call(i.querySelectorAll(".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)")).filter((function(e){return t(e).is(":visible")}));if(0!==o.length){var r=o.indexOf(e.target);38===e.which&&r>0&&r--,40===e.which&&r<o.length-1&&r++,r<0&&(r=0),o[r].focus()}}}},o=a,m=[{key:"VERSION",get:function(){return"4.5.0"}},{key:"Default",get:function(){return p}},{key:"DefaultType",get:function(){return u}}],(h=null)&&s(o.prototype,h),m&&s(o,m),a}();return t(document).on("keydown.bs.dropdown.data-api",'[data-toggle="dropdown"]',m._dataApiKeydownHandler).on("keydown.bs.dropdown.data-api",".dropdown-menu",m._dataApiKeydownHandler).on("click.bs.dropdown.data-api keyup.bs.dropdown.data-api",m._clearMenus).on("click.bs.dropdown.data-api",'[data-toggle="dropdown"]',(function(e){e.preventDefault(),e.stopPropagation(),m._jQueryInterface.call(t(this),"toggle")})).on("click.bs.dropdown.data-api",".dropdown form",(function(t){t.stopPropagation()})),t.fn[n]=m._jQueryInterface,t.fn[n].Constructor=m,t.fn[n].noConflict=function(){return t.fn[n]=h,m._jQueryInterface},m}(i("xeH2"),i("27z4"),i("WUlJ"))},iftE:function(t,e,i){(function(t){i.d(e,"a",(function(){return S}));var s=i("mrVq"),a=i("gj+k"),o=i("AJ/N"),r=i("VIqg"),n=i("AWXE"),l=i("iPFw"),d=i("VkQ2"),h=i("TI0E"),c=i("Qs7V"),p=i("otg8"),u=i("dNoP"),m=i("1mfJ"),_=i.n(m),g=i("Z5fe"),f=i("Q4du"),b=i("oggF");function v(t){return function(t){if(Array.isArray(t))return y(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return y(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return y(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class S extends g.a{constructor(t,e,i,s){super(t,s),w(this,"shipCompareData",void 0),w(this,"_shipBaseData",void 0),w(this,"_speedScale",void 0),w(this,"_speedDiff",void 0),w(this,"_minSpeedDiff",void 0),w(this,"_maxSpeedDiff",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),w(this,"_windProfile",void 0),w(this,"_gWindProfile",void 0),w(this,"_arcsComp",void 0),this._shipBaseData=e,this.shipCompareData=i,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(t,e){const i=Math.min(t,this._shipCompare.colourScaleSpeedDiff.domain()[0]),s=Math.max(e,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([i,0,s])}_getHeadingInDegrees(t,e){let i=t-e-180;return i<0&&(i+=360),i}_getSpeed(t){return Object(c.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(p.m)(t)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const t=this.shipCompareData.speedDegrees.length,e=360/t,i=new Array(t+1).fill(0).map((t,i)=>i*e);this._speedScale=Object(r.a)().domain(i).range([].concat(v(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=o.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:i}=n.c;t.rotate=this._getHeadingInDegrees(Object(u.m)({x:t.initX,y:t.initY},{x:e,y:i}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),this._shipRotate=t.rotate,this._updateSpeedText()})()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipCompareData,e=this._shipCompare.shipMassScale(t),i=e,s=this._shipCompare.svgHeight/2-40,a={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(a).attr("class","ship-outline");o.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),o.append("image").attr("height",e).attr("width",i).attr("x",-e/2).attr("y",-i/2).attr("xlink:href",_.a),o.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const r=o.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=o.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(this._shipCompare.windProfileRotate-t.initRotate)),a.this=o,a.compassText=r,o.datum(a).attr("transform",t=>`rotate(${t.initRotate})`)}_drawDifferenceProfile(){var t,e;const i=Object(l.a)().sort(null).value(1),o=i(this._shipBaseData.speedDegrees);this._arcsComp=i(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((t,e)=>Object(p.t)(t-this._shipBaseData.speedDegrees[e])),this._minSpeedDiff=null!==(t=Object(s.a)(this._speedDiff))&&void 0!==t?t:0,this._maxSpeedDiff=null!==(e=Object(a.a)(this._speedDiff))&&void 0!==e?e:0;const r=d.a,n=Object(h.a)().angle((t,e)=>e*f.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(r),c=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-c,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(o)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(t=>{t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*f.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*f.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e])).append("title").text((t,e)=>`${Math.round(10*t.data)/10} (${Object(c.j)(this._speedDiff[e],1)}) knots`)}).select("circle").attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))}_injectTextComparison(){function e(t,e,i=0,s=!1){if(t===e)return"";let a,o,r="badge-danger";return s?(a=100*Number.parseFloat((e-t).toFixed(i)),o=Object(c.b)(Math.abs(a))):0===t||0===e?(a=e-t,o=Object(c.b)(Math.abs(a))):(a=1-t/e,o=Object(c.f)(Math.abs(a),0)),a<0&&(r="badge-success"),`<span class="badge ${r}">${o}</span>`}const i=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/b.i),s=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/b.o),a=Math.round(this._shipBaseData.crew.max*b.p),o=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/b.i),r=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/b.o),n=Math.round(this.shipCompareData.crew.max*b.p),l={morale:`${Object(c.c)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${Object(c.k)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${Object(c.c)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${Object(c.j)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${Object(c.j)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${Object(c.c)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${Object(c.c)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${Object(c.c)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${Object(c.k)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,acceleration:`${Object(c.b)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${Object(c.c)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:g.a.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${Object(c.b)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${Object(c.c)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${Object(c.b)(this.shipCompareData.ship.turnAcceleration)} ${e(this._shipBaseData.ship.turnAcceleration,this.shipCompareData.ship.turnAcceleration,2)}`,decks:Object(f.p)(this.shipCompareData.guns.decks,"deck"),fireResistance:`${Object(c.k)(100*this.shipCompareData.resistance.fire)} ${e(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0)}`,firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${Object(c.c)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${Object(c.b)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${Object(c.c)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${Object(c.c)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${Object(c.c)(o)} <span class="badge badge-white">${Object(c.c)(o*b.m)}</span>`,leakResistance:`${Object(c.k)(100*this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(c.c)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(c.c)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(c.c)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${Object(c.c)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${Object(c.b)(this.shipCompareData.speed.max,4)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxTurningSpeed:`${Object(c.b)(this.shipCompareData.rudder.turnSpeed,4)} ${e(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2)}`,maxWeight:`${Object(c.c)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:Object(c.c)(this.shipCompareData.crew.min),cannonCrew:`${Object(c.c)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${Object(c.c)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${Object(c.b)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${Object(c.c)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${Object(c.c)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${Object(c.c)(r)} <span class="badge badge-white">${Object(c.c)(r*b.m)}</span>`,rumRepairsNeeded:`${Object(c.c)(n)} <span class="badge badge-white">${Object(c.c)(n*b.m)}</span>`,sailingCrew:""+Object(c.c)(this.shipCompareData.crew.sailing),sails:`${Object(c.c)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:Object(p.q)(this.shipCompareData.class)+" rate",sideArmor:`${Object(c.c)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${Object(c.c)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${Object(c.k)(100*this.shipCompareData.resistance.splinter)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${Object(c.c)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${Object(c.c)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${Object(c.b)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${Object(c.c)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${Object(c.c)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};l.repairWeight=`${Object(c.c)((o+r+.1*n)*b.m)} ${e((i+s+.1*a)*b.m,(o+r+.1*n)*b.m)}`,l.gunsFront?l.gunsFront+=" "+g.a.pd(l.limitFront):l.gunsFront="–",l.gunsBack?l.gunsBack+=" "+g.a.pd(l.limitBack):l.gunsBack="–",t(""+this.select).find("div").append(g.a.getText(l))}}}).call(this,i("xeH2"))},oggF:function(t,e,i){i.d(e,"h",(function(){return u})),i.d(e,"i",(function(){return m})),i.d(e,"l",(function(){return _})),i.d(e,"n",(function(){return g})),i.d(e,"o",(function(){return f})),i.d(e,"p",(function(){return y})),i.d(e,"m",(function(){return w})),i.d(e,"g",(function(){return S})),i.d(e,"k",(function(){return D})),i.d(e,"q",(function(){return x})),i.d(e,"a",(function(){return j})),i.d(e,"c",(function(){return C})),i.d(e,"d",(function(){return k})),i.d(e,"j",(function(){return P})),i.d(e,"f",(function(){return I})),i.d(e,"e",(function(){return $})),i.d(e,"b",(function(){return T}));i("UxlC");var s=i("FmoU"),a=i("GjCO"),o=i.n(a),r=i("JQHs"),n=i("2mXy"),l=i("XXsb"),d=i.n(l),h=i("Q4du"),c=i("Qs7V");const p=r.a.bind(n.a),u=Number(.2),m=Number(300),_=Number(90),g=Number(.25),f=Number(300),b=Number(.25),v=Number(1),y=Number(b)/Number(v),w=5,S=new o.a("My salt: Yet another Naval Action map"),D=t=>t.includes(" (i)"),x=t=>t.replace(" (i)",""),j=t=>p`${x(t)} ${D(t)?p`<span class="caps small">imported</span>`:p``}`,C=(t,e=2)=>{const[i,s]=c.d.format(`.${e}f`)(t).split(".");let a=p`${s}`;return s&&(a="0"===s||"00"===s?p`<span class="hidden">.${s}</span>`:s.endsWith("0")?p`.${s.replace("0","")}<span class="hidden">0</span>`:p`.${s}`),p`${i}${a}`},k=({id:t,title:e,size:i="modal-xl",body:s,footer:a})=>p`
        <div id="${t}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${t}" aria-hidden="true">
            <div class="modal-dialog ${i}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${t}" class="modal-title">
                            ${e}
                        </h5>
                    </div>
                    <div class="modal-body">${s()}</div>
                    <div class="modal-footer">
                        ${a()}
                    </div>
                </div>
            </div>
        </div>
    `,O=t=>t.replace(/[^\d-.?]/g,""),P=()=>{d.a.extend("number",t=>{var e,i;return null!==(e=null!==(i=/^[+-]?[$¢£´Û€]?\d+\s*([,.]\d{0,2})/.exec(t))&&void 0!==i?i:/^[+-]?\d+\s*([,.]\d{0,2})?[$¢£´Û€]/.exec(t))&&void 0!==e?e:/^[+-]?(\d)*-?([,.])?-?(\d)+([,Ee][+-]\d+)?%?$/.exec(t)},(t,e)=>{const i=O(t);return((t,e)=>{let i=Number.parseFloat(t),s=Number.parseFloat(e);return i=Number.isNaN(i)?0:i,s=Number.isNaN(s)?0:s,i-s})(O(e),i)})},I=t=>`${t} real${Number(t)>1?"s":""}`,$=t=>{var e,i;const{r:a,g:o,b:r}=Object(s.d)(t);return(299*a+587*o+114*r)/1e3>=128?null!==(e=null===(i=Object(s.c)(h.j))||void 0===i?void 0:i.darker(5).toString())&&void 0!==e?e:"#111":h.j},T=t=>p`<span class="caps">${t}</span>`},oyY5:function(t,e,i){i.d(e,"a",(function(){return c}));var s=i("AKWm"),a=i("pxNS"),o=i("dNoP"),r=i("m+OL"),n=i("1RyA");function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const d=i("Bhad");var h=new WeakMap;class c{constructor(t,e){l(this,"showPB",void 0),h.set(this,{writable:!0,value:void 0}),l(this,"_ports",void 0),l(this,"_showId",void 0),l(this,"_showValues",void 0),l(this,"_showCookie",void 0),l(this,"_showRadios",void 0),l(this,"_isDataLoaded",void 0),l(this,"_pbZonesDefault",void 0),l(this,"_lowerBound",void 0),l(this,"_upperBound",void 0),l(this,"_defencesFiltered",void 0),l(this,"_pbZonesFiltered",void 0),l(this,"_raidZonesFiltered",void 0),l(this,"_g",void 0),this._ports=t,function(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}}(this,h,d.find(t=>t.id===e).type),this._showId="show-zones",this._showValues=[{id:"pb-all",label:"All ports"},{id:"pb-single",label:"Single port"},{id:"raid-all",label:"All raid"},{id:"raid-single",label:"Single raid"},{id:"off",label:"Off"}],this._setupRadios(),this._showCookie=new r.a({id:this._showId,values:this._showValues.map(t=>t.id)}),this._showRadios=new n.a(this._showId,this._showValues.map(t=>t.id)),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(s.a)("#map").insert("g","#ports").attr("class","pb")}_setupRadios(){const t=Object(s.a)("#show-zones");for(const e of this._showValues){const i=t.append("div").attr("class","custom-control custom-radio custom-control-inline");i.append("input").attr("type","radio").attr("class","custom-control-input").attr("name","show-zones").attr("id","show-zones-"+e.id).attr("value",e.id),i.append("label").attr("type","radio").attr("class","custom-control-label").attr("for","show-zones-"+e.id).text(e.label)}}async _loadData(){try{this._pbZonesDefault=(await i.e(11).then(i.t.bind(null,"VihV",3))).default}catch(t){Object(a.f)(t)}}_setupListener(){var t;null===(t=document.querySelector("#"+this._showId))||void 0===t||t.addEventListener("change",t=>{this._showPBZonesSelected(),t.preventDefault()})}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","pb-zones");return e.append("path").attr("class","pb-join-circle").attr("d",t=>Object(o.g)(t.joinCircle[0],t.joinCircle[1],28).concat(Object(o.g)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","pb-circle").attr("d",t=>t.pbCircles.map(t=>Object(o.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text pb-circle-text").attr("x",t=>t.pbCircles.map(t=>t[0]).join(",")).attr("y",t=>t.pbCircles.map(t=>t[1]).join(",")).text(t=>t.pbCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),"PVP"===function(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}(this,h)&&(e.append("path").attr("class","raid-point").attr("d",t=>t.spawnPoints.map(t=>Object(o.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.spawnPoints.map(t=>t[0]).join(",")).attr("y",t=>t.spawnPoints.map(t=>t[1]).join(",")).text(t=>t.spawnPoints.map((t,e)=>String.fromCharCode(88+e)).join(""))),e}),this._g.selectAll("g.defence").data(this._defencesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","defence");return e.append("path").attr("class","fort").attr("d",t=>t.forts.map(t=>Object(o.i)(t[0],t[1],3)).join("")),e.append("text").attr("class","pb-text pb-fort-text").attr("x",t=>t.forts.map(t=>t[0]).join(",")).attr("y",t=>t.forts.map(t=>t[1]).join(",")).text(t=>t.forts.map((t,e)=>""+(e+1)).join("")),e.append("path").attr("class","tower").attr("d",t=>t.towers.map(t=>Object(o.g)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text pb-tower-text").attr("x",t=>t.towers.map(t=>t[0]).join(",")).attr("y",t=>t.towers.map(t=>t[1]).join(",")).text(t=>t.towers.map((t,e)=>""+(e+1)).join("")),e}),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","raid-zones");return e.append("path").attr("class","raid-join-circle").attr("d",t=>Object(o.g)(t.joinCircle[0],t.joinCircle[1],35)),e.append("path").attr("class","raid-circle").attr("d",t=>t.raidCircles.map(t=>Object(o.g)(t[0],t[1],4.5)).join("")),e.append("text").attr("class","pb-text raid-circle-text").attr("x",t=>t.raidCircles.map(t=>t[0]).join(",")).attr("y",t=>t.raidCircles.map(t=>t[1]).join(",")).text(t=>t.raidCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),e.append("path").attr("class","raid-point").attr("d",t=>t.raidPoints.map(t=>Object(o.g)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.raidPoints.map(t=>t[0]).join(",")).attr("y",t=>t.raidPoints.map(t=>t[1]).join(",")).text(t=>t.raidPoints.map((t,e)=>String.fromCharCode(49+e)).join("")),e})}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?this._isDataLoaded?this._filterVisible():this._loadData().then(()=>{this._isDataLoaded=!0,this._filterVisible()}):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]).filter(t=>this._isPortIn(t));this._defencesFiltered=t.map(t=>({id:t.id,forts:t.forts,towers:t.towers})),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map(t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints})),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map(t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints})))}setBounds(t,e){this._lowerBound=t,this._upperBound=e}refresh(){this._setData(),this._update()}}},p7uB:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},qE0g:function(t,e,i){(function(t){i.d(e,"a",(function(){return M}));i("UxlC"),i("WUlJ"),i("fCtr");var s=i("mrVq"),a=i("gj+k"),o=i("APuy"),r=i("bwSX"),n=i("Ws9M"),l=i("VIqg"),d=i("AKWm"),h=i("Wgwc"),c=i.n(h),p=i("+QaA"),u=i.n(p),m=i("Ds8A"),_=i.n(m),g=i("pOjD"),f=i("Q4du"),b=i("pxNS"),v=i("Qs7V"),y=i("oggF"),w=i("otg8"),S=i("Bx8B"),D=i("dNoP"),x=i("ck04"),j=i("awzk"),C=i("iftE");function k(t){return function(t){if(Array.isArray(t))return O(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return O(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return O(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function I(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function $(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}c.a.extend(u.a),c.a.extend(_.a);var T=new WeakMap,A=new WeakMap;class M{constructor(t="ship-compare"){P(this,"colorScale",void 0),P(this,"colourScaleSpeedDiff",void 0),P(this,"columnsCompare",void 0),P(this,"innerRadius",void 0),P(this,"outerRadius",void 0),P(this,"radiusSpeedScale",void 0),P(this,"selectedShips",void 0),P(this,"singleShipData",void 0),P(this,"shipMassScale",void 0),P(this,"svgHeight",void 0),P(this,"svgWidth",void 0),P(this,"windProfileRotate",0),P(this,"woodCompare",void 0),T.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),P(this,"_maxSpeed",void 0),P(this,"_minSpeed",void 0),P(this,"_modal$",{}),P(this,"_modifierAmount",new Map),P(this,"_moduleAndWoodCaps",void 0),P(this,"_moduleAndWoodChanges",void 0),P(this,"_moduleDataDefault",void 0),P(this,"_moduleProperties",void 0),P(this,"_moduleTypes",void 0),P(this,"_selectedUpgradeIdsList",{}),P(this,"_selectedUpgradeIdsPerType",{}),P(this,"_selectModule$",{}),P(this,"_selectShip$",{}),P(this,"_selectWood$",{}),P(this,"_shipData",void 0),P(this,"_shipIds",{}),P(this,"_shipSelectData",void 0),P(this,"_baseId",void 0),P(this,"_baseName",void 0),P(this,"_buttonId",void 0),P(this,"_columns",void 0),P(this,"_copyButtonId",void 0),P(this,"_imageButtonId",void 0),P(this,"_modalId",void 0),P(this,"_moduleId",void 0),P(this,"_woodId",void 0),this._baseId=t,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._imageButtonId="button-image-"+this._baseId,this.colourScaleSpeedDiff=Object(l.a)().range([f.i,f.j,f.f]).interpolate(n.a),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(t){return t<=3?"L":t<=5?"M":"S"}static _adjustAbsolute(t,e){return t?t+e:e}static _adjustPercentage(t,e,i){return i?t?t*(1+e):e:t?t+e:e}static _getModifierFromModule(t){return`<p class="mb-0">${t.map(t=>{let e;return e=t.isPercentage?Object(v.l)(t.amount/100):t.amount<1&&t.amount>0?Object(v.e)(t.amount):Object(v.j)(t.amount,2),`${t.modifier} ${e}`}).join("<br>")}</p>`}static _setSelect(t,e){let i;i=Array.isArray(e)?e.map(t=>String(t)):String(e),i&&t.val(i),t.selectpicker("render")}static _saveCanvasAsImage(t){const e=`na-map ship compare ${c.a.utc().format("YYYY-MM-DD HH-mm-ss")}.png`,i=document.createElement("a");i.href=t,i.download=e,document.body.append(i),i.click(),i.remove()}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(t){var e;await this._loadAndSetupData();const i=y.g.decode(null!==(e=t.get("cmp"))&&void 0!==e?e:"");i.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(i),this._setModuleSelects(t))}_setupArrow(){const t=document.querySelector("#journey-arrow").cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(t)}_setupData(){var t,e,i;this._moduleAndWoodChanges=new Map([["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Rudder turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),$(this,T,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:.5,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:17,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const o=1.2*(null!==(t=Object(s.a)(this._shipData,t=>t.speed.min))&&void 0!==t?t:0),r=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=o,this._maxSpeed=r,this.colorScale=Object(l.a)().domain([this._minSpeed,0,this._maxSpeed]).range([f.i,f.j,f.f]).interpolate(n.a);const d=null!==(e=Object(s.a)(this._shipData,t=>t.shipMass))&&void 0!==e?e:0,h=null!==(i=Object(a.a)(this._shipData,t=>t.shipMass))&&void 0!==i?i:0;this.shipMassScale=Object(l.a)().domain([d,h]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await i.e(8).then(i.t.bind(null,"jhXC",3))).default,this._shipData=(await i.e(15).then(i.t.bind(null,"pcjM",3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new x.a(this._woodId),await this.woodCompare.woodInit())}catch(t){Object(b.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(g.b)("Tools",this._baseName),this._shipCompareSelected()})}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=t(`#${this._modalId} .column-base`).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(l.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(t){var e,i;return null!==(e=null===(i=this._shipData.find(e=>e.id===t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}_getSelectedData(t){const e={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[t]){e.ship=this._getShipName(this._shipIds[t]);for(const i of b.h)e.wood.push(this.woodCompare.getWoodName(i,Number(this._selectWood$[t][i].val())));if(this._selectedUpgradeIdsPerType[t])for(const a of k(this._moduleTypes)){const o=[];for(const e of this._selectedUpgradeIdsPerType[t][a]){var i,s;o.push(null!==(i=null===(s=this._moduleProperties.get(e))||void 0===s?void 0:s.name.replace(" Bonus",""))&&void 0!==i?i:"")}e.moduleData.set(a,o.join(", "))}}return e}_printSelectedData(t,e,i){const s=t.querySelectorAll(`#${this._baseId}-${i.toLowerCase()} label`),a=s[0].parentNode,o=s[0].offsetHeight;for(const t of s)t.remove();const r=Object(d.a)(a).insert("div",":first-child").style("height",5*o+"px");e.ship&&r.append("div").style("margin-bottom","5px").style("line-height","1.1").text(e.ship),""!==e.wood[0]&&r.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(e.wood.join(" | "));for(const[t,i]of e.moduleData)""!==i&&r.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${t}</em>: ${i}`)}_replaceSelectsWithText(t){for(const e of this._columns){const i=this._getSelectedData(e);this._printSelectedData(t,i,e)}}_setMakeImageSpinner(){I(this,A).select("i").remove(),I(this,A).attr("class","btn btn-primary").property("disabled",!0),I(this,A).append("span").attr("class","spinner-border spinner-border-sm").attr("role","status").attr("aria-hidden","true"),I(this,A).append("span").attr("class","sr-only").text("Loading...")}_unsetMakeImageSpinner(){I(this,A).selectAll("span").remove(),I(this,A).attr("class","btn btn-outline-secondary icon-outline-button").property("disabled",!1),I(this,A).append("i").attr("class","icon icon-image")}async _makeImage(t){t.preventDefault(),this._setMakeImageSpinner();const e=await i.e(23).then(i.t.bind(null,"wOnQ",7)),s=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(s){const t=await e.default(s,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:t=>t.classList.contains("central")||t.classList.contains("overlay")||t.classList.contains("navbar"),logging:!0,onclone:t=>{this._replaceSelectsWithText(t)},x:0,y:0});M._saveCanvasAsImage(t.toDataURL())}this._unsetMakeImageSpinner()}_shipCompareSelected(){var e,i,s;Object(b.d)(this._modal$)&&(this._initModal(),this._modal$=t("#"+this._modalId),null===(e=document.querySelector("#"+this._modalId))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyDataClicked(t)}),null===(i=document.querySelector("#"+this._copyButtonId))||void 0===i||i.addEventListener("click",t=>{this._copyDataClicked(t)}),null===(s=document.querySelector("#"+this._imageButtonId))||void 0===s||s.addEventListener("click",async t=>{Object(g.b)("Menu","Ship compare image"),await this._makeImage(t)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const t=[];for(const e of this._columns)if(this._shipIds[e]){t.push(this._shipIds[e]);for(const i of b.h)t.push(Number(this._selectWood$[e][i].val()))}return t}_copyDataClicked(t){Object(g.b)("Menu","Copy ship compare"),t.preventDefault();const e=this._getShipAndWoodIds();if(e.length>0){const t=new URL(window.location.href);t.searchParams.set("v",encodeURIComponent(f.d)),t.searchParams.set("cmp",y.g.encode(e));for(const e of this._columns){const i=this._columns.indexOf(e);if(this._selectedUpgradeIdsPerType[e])for(const s of k(this._moduleTypes)){const a=k(this._moduleTypes).indexOf(s),o=this._selectedUpgradeIdsPerType[e][s];if(null==o?void 0:o.length){const e=`${i}${a}`;t.searchParams.set(e,y.g.encode(o))}}}Object(D.c)(t.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(r.b)().key(t=>String(t.class)).sortKeys(o.a).entries(this._shipData.map(t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns.total})).sort(Object(S.b)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(t=>t[1].filter(t=>t.properties.some(t=>this._moduleAndWoodChanges.has(t.modifier))).map(t=>[t.id,t]))),this._moduleTypes=new Set(k(this._moduleProperties).map(t=>t[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(f.n)({id:this._modalId,title:this._baseName});const t=Object(d.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const e of this._columns){const i=t.append("div").attr("id",`${this._baseId}-${e.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp")),s=this._getShipSelectId(e);i.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker");for(const t of b.h){const s=this._getWoodSelectId(t,e);i.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}for(const t of this._moduleTypes){const s=this._getModuleSelectId(t,e);i.append("label").append("select").attr("name",s).attr("id",s).property("multiple",!0).attr("class","selectpicker")}i.append("div").attr("id",`${this._baseId}-${e}`).attr("class",("Base"===e?"ship-base":"ship-compare")+" compress")}const e=Object(d.a)(`#${this._modalId} .modal-footer`);e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),$(this,A,e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._imageButtonId).attr("title","Make image").attr("type","button")),I(this,A).append("i").classed("icon icon-image",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const i of b.h)this._selectWood$[e][i]=t("#"+this._getWoodSelectId(i,e)),this.woodCompare._setupWoodSelects(e,i,this._selectWood$[e][i])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(t=>`<optgroup label="${Object(w.q)(Number(t.key),!1)} rate">${t.values.map(t=>`<option data-subtext="${t.battleRating} ${Object(y.k)(t.name)?"Imported":""}" value="${t.id}">${Object(y.q)(t.name)} (${t.guns})`).join("</option>")}`).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=t("#"+this._getShipSelectId(e));const i=this._getShipOptions();this._selectShip$[e].append(i),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(t,e){const i=Object(r.b)().key(t=>t[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(o.a).sortValues((t,e)=>t[1].name.localeCompare(e[1].name)).entries(k(this._moduleProperties).filter(i=>i[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===t&&("U"===i[1].moduleLevel||i[1].moduleLevel===M._getModuleLevel(e))));let s;const a=new Set(["Permanent","Ship trim"]);return s=i.length>1?i.map(e=>`<optgroup label="${e.key}" data-max-options="${a.has(t.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${e.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")}`).join("</optgroup>"):i.map(t=>""+t.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")).join(""),s}_fillModuleSelect(t,e){const i=this._getUpgradesOptions(e,(()=>this._shipData.find(e=>e.id===this._shipIds[t]).class)());this._selectModule$[t][e].find("option").remove(),this._selectModule$[t][e].append(i)}_resetModuleSelects(t){for(const e of this._moduleTypes)this._fillModuleSelect(t,e),this._selectModule$[t][e].selectpicker("refresh")}_getModuleFromName(t){let e={};return this._moduleDataDefault.some(i=>(e=i[1].find(e=>e.name===t),Boolean(e))),e}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const i of this._moduleTypes)this._selectModule$[e][i]=t("#"+this._getModuleSelectId(i,e)),this._selectModule$[e][i].on("changed.bs.select",()=>{this._modulesSelected(e),this._refreshShips(e)}).on("show.bs.select",e=>{t(e.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",e=>{const i=t(e.currentTarget);for(const e of i.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const i=this._getModuleFromName(e.textContent);t(e).attr("data-original-title",M._getModifierFromModule(i.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:t=>`${t} ${i.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:i.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+i,width:"150px"})}this._resetModuleSelects(e)}_getShipData(t){const e=this._shipData.find(e=>e.id===this._shipIds[t]);e.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:e.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:e.boarding.prepInitial,prepPerRound:e.boarding.prepPerRound};let i=e;return i.repairAmount={armour:y.h,armourPerk:0,sails:y.n,sailsPerk:0},i.repairTime={sides:y.l,default:y.l},i.resistance={fire:0,leaks:0,splinter:0},i=this._addModulesAndWoodData(e,i,t),i}_roundPropertyValue(t,e,i=!1){return Number.isInteger(t)&&!i?Math.round(e):Math.trunc(100*e)/100}_adjustValue(t,e,i){var s,a;let o=t;if(null===(s=this._modifierAmount.get(e))||void 0===s?void 0:s.percentage){const t=this._modifierAmount.get(e).percentage/100;o=M._adjustPercentage(o,t,i)}if(null===(a=this._modifierAmount.get(e))||void 0===a?void 0:a.absolute){const{absolute:t}=this._modifierAmount.get(e);o=M._adjustAbsolute(o,t)}const r=!I(this,T).has(e)&&!i;return this._roundPropertyValue(t,o,r)}_setModifier(t){let e=t.isPercentage?0:t.amount,i=t.isPercentage?t.amount:0;var s,a,o,r;this._modifierAmount.has(t.modifier)&&(e+=null!==(s=null===(a=this._modifierAmount.get(t.modifier))||void 0===a?void 0:a.absolute)&&void 0!==s?s:0,i+=null!==(o=null===(r=this._modifierAmount.get(t.modifier))||void 0===r?void 0:r.percentage)&&void 0!==o?o:0);this._modifierAmount.set(t.modifier,{absolute:e,percentage:i})}_showCappingAdvice(t,e){const i=`${this._baseId}-${t}-capping`;let s=document.querySelector("#"+i);if(!s){var a;s=document.createElement("p"),s.id=i,s.className="alert alert-warning";const e=document.querySelector(`#${this._baseId}-${t}`);null==e||null===(a=e.firstChild)||void 0===a||a.after(s)}s.innerHTML=k(e).join(", ")+" capped"}_removeCappingAdvice(t){const e=`${this._baseId}-${t}-capping`,i=document.querySelector("#"+e);i&&i.remove()}_addModulesAndWoodData(t,e,i){const s=JSON.parse(JSON.stringify(e)),a=()=>{s.speedDegrees=s.speedDegrees.map(t=>{const e=1+this._modifierAmount.get("Max speed").percentage/100,i=t>0?t*e:t/e;return Math.max(Math.min(i,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const t of this._selectedUpgradeIdsList[i]){const e=this._moduleProperties.get(t);for(const t of e.properties)this._moduleAndWoodChanges.has(t.modifier)&&this._setModifier(t)}if(this.woodCompare.instances[i]){let t="_woodData";"Base"!==i&&(t="_compareData");for(const e of b.h)for(const s of this.woodCompare.instances[i][t][e].properties)this._moduleAndWoodChanges.has(s.modifier)&&this._setModifier(s)}})(),(()=>{for(const[e]of this._modifierAmount.entries()){var t;if(null===(t=this._moduleAndWoodChanges.get(e))||void 0===t?void 0:t.properties){const{properties:t,isBaseValueAbsolute:i}=this._moduleAndWoodChanges.get(e);for(const a of t){const t=a.split(".");t.length>1?s[t[0]][t[1]]=this._adjustValue(s[t[0]][t[1]],e,i):s[t[0]]=this._adjustValue(s[t[0]],e,i)}}}})(),(()=>{const e={isCapped:!1,modifiers:new Set},a=(t,i,s,{amount:a,isPercentage:o})=>{const r=Math.min(i,o?this._roundPropertyValue(s,s*(1+a)):a);return i>r&&(e.isCapped=!0,e.modifiers.add(t)),r};for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(e)){const{cap:i}=this._moduleAndWoodCaps.get(e);for(const o of this._moduleAndWoodCaps.get(e).properties){const r=o.split(".");r.length>1?s[r[0]][r[1]]&&(s[r[0]][r[1]]=a(e,s[r[0]][r[1]],t[r[0]][r[1]],i)):s[r[0]]&&(s[r[0]]=a(e,s[r[0]],t[r[0]],i))}}e.isCapped?this._showCappingAdvice(i,e.modifiers):this._removeCappingAdvice(i)})(),this._modifierAmount.has("Max speed")&&a(),s}_updateDifferenceProfileNeeded(t){"Base"===t||Object(b.d)(this.selectedShips[t])||this.selectedShips[t].updateDifferenceProfile()}_updateSailingProfile(t){this._updateDifferenceProfileNeeded(t);for(const e of this.columnsCompare)e!==t&&this._updateDifferenceProfileNeeded(e)}_refreshShips(t){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(e=>e.id===this._shipIds[t]);else{this._modulesSelected(t);const e=this._getShipData(t);if("Base"===t){this._setSelectedShip(t,new j.a(t,e,this));for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh"),Object(b.d)(this.selectedShips[t])||this._setSelectedShip(t,new C.a(t,e,this.selectedShips[t].shipCompareData,this))}else this._setSelectedShip(t,new C.a(t,this.selectedShips.Base.shipData,e,this));this._updateSailingProfile(t)}}_enableCompareSelects(){for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(t){this._selectedUpgradeIdsList[t]=[],this._selectedUpgradeIdsPerType[t]={};for(const e of this._moduleTypes)this._selectedUpgradeIdsPerType[t][e]=this._selectModule$[t][e].val(),Array.isArray(this._selectedUpgradeIdsPerType[t][e])?this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e].map(t=>Number(t)):this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e]?[Number(this._selectedUpgradeIdsPerType[t][e])]:[],this._selectedUpgradeIdsPerType[t][e].length>0&&(this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][e]))}_setupSelectListener(t){if(this._selectShip$[t].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[t]=Number(this._selectShip$[t].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(t),this._refreshShips(t),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(t)}),"ship-journey"!==this._baseId)for(const e of b.h)this._selectWood$[t][e].on("changed.bs.select",()=>{this.woodCompare._woodSelected(t,e,this._selectWood$[t][e]),this._refreshShips(t)}).selectpicker({title:"Wood "+e,width:"150px"})}_setShipAndWoodsSelects(t){let e=0;this._columns.some(i=>{if(!this._shipData.find(i=>i.id===t[e]))return!1;if(this._shipIds[i]=t[e],e+=1,M._setSelect(this._selectShip$[i],this._shipIds[i]),"Base"===i&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(i),this._setupModulesSelect(i),t[e])for(const s of b.h)M._setSelect(this._selectWood$[i][s],t[e]),e+=1,this.woodCompare._woodSelected(i,s,this._selectWood$[i][s]);else e+=2;return this._refreshShips(i),e>=t.length})}_setModuleSelects(t){for(const i of this._columns){const s=this._columns.indexOf(i);let a=!1;for(const o of k(this._moduleTypes)){const r=k(this._moduleTypes).indexOf(o);if(t.has(`${s}${r}`)){var e;const n=y.g.decode(t.get(`${s}${r}`));this._selectedUpgradeIdsPerType[i]||(this._selectedUpgradeIdsPerType[i]={}),this._selectedUpgradeIdsList[i]||(this._selectedUpgradeIdsList[i]=[]),this._selectedUpgradeIdsPerType[i][o]=n.map(t=>Number(t)),M._setSelect(this._selectModule$[i][o],this._selectedUpgradeIdsPerType[i][o]),(e=this._selectedUpgradeIdsList[i]).push.apply(e,k(this._selectedUpgradeIdsPerType[i][o])),a=!0}}a&&this._refreshShips(i)}}_getShipSelectId(t){return`${this._baseId}-${t}-select`}_getWoodSelectId(t,e){return`${this._woodId}-${t}-${e}-select`}_getModuleSelectId(t,e){return`${this._moduleId}-${t.replace(/\s/,"")}-${e}-select`}_setSelectedShip(t,e){this.selectedShips[t]=e}}}).call(this,i("xeH2"))},tN7d:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},u3gz:function(t,e,i){i("Z5fe"),i("awzk"),i("iftE");var s=i("qE0g");i.d(e,"a",(function(){return s.a}))},vYjh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},wffX:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},xp4X:function(t,e,i){i.r(e),function(t){i.d(e,"NAMap",(function(){return D}));i("WUlJ"),i("fCtr"),i("dbdZ");var s=i("NltA"),a=i("AKWm"),o=i("AWXE"),r=i("4k54"),n=i("2TRZ"),l=i("pOjD"),d=i("Q4du"),h=i("otg8"),c=i("dNoP"),p=i("m+OL"),u=i("1RyA"),m=i("1Gn1"),_=i("oyY5"),g=i("8KGH"),f=i("gQbg"),b=i("K2bk"),v=i("1Dm9"),y=i("7PF8"),w=i("X2Cj");function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class D{constructor(t,e){S(this,"coord",void 0),S(this,"f11",void 0),S(this,"gridOverlay",void 0),S(this,"height",0),S(this,"minScale",0),S(this,"rem",void 0),S(this,"serverName",void 0),S(this,"showGrid",void 0),S(this,"showTrades",void 0),S(this,"width",0),S(this,"xGridBackgroundHeight",void 0),S(this,"yGridBackgroundWidth",void 0),S(this,"_currentScale",0),S(this,"_currentTranslate",void 0),S(this,"_doubleClickAction",void 0),S(this,"_gMap",void 0),S(this,"_mainG",void 0),S(this,"_grid",void 0),S(this,"_journey",void 0),S(this,"_pbZone",void 0),S(this,"_ports",void 0),S(this,"_portSelect",void 0),S(this,"_showGrid",void 0),S(this,"_svg",void 0),S(this,"_zoom",void 0),S(this,"_zoomLevel",void 0),S(this,"_doubleClickActionCookie",void 0),S(this,"_doubleClickActionId",void 0),S(this,"_doubleClickActionRadios",void 0),S(this,"_doubleClickActionValues",void 0),S(this,"_labelZoomThreshold",void 0),S(this,"_maxScale",void 0),S(this,"_PBZoneZoomThreshold",void 0),S(this,"_searchParams",void 0),S(this,"_showGridCookie",void 0),S(this,"_showGridId",void 0),S(this,"_showGridRadios",void 0),S(this,"_showGridValues",void 0),S(this,"_tileSize",void 0),S(this,"_wheelDelta",void 0),this.serverName=t,this._searchParams=e,this.rem=h.i,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:w.b},this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new p.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new u.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new p.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new u.a(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener()}static _initModal(t){Object(d.n)({id:t,title:`${d.c} <span class="text-primary small">v${d.d}</span>`,size:"modal-lg"});a.a(`#${t} .modal-body`).html(`<p>${d.a} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan Bastards ${Object(c.d)("(BSTD)")}</a>.</p>`)}static _stopProperty(){o.c.defaultPrevented&&o.c.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this.f11=new b.a(this,this.coord),this._ports=new g.a(this),await this._ports.init(),this._pbZone=new _.a(this._ports,this.serverName),this._grid=new m.a(this),this._portSelect=new f.a(this._ports,this._pbZone,this),this.showTrades=new v.a(this.serverName,this._portSelect,this.minScale,[this.coord.min,this.coord.min],[this.width,this.height]),await this.showTrades.showOrHide(),this._init(),this._journey=new y.a(this.rem)}_setupListener(){var t,e,i,s,a,o,r;this._svg.on("dblclick.zoom",null).on("click",D._stopProperty,!0).on("dblclick",(t,e,i)=>this._doDoubleClickAction(i[e])),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",()=>{Object(l.b)("Menu","Select port on property")}),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",()=>{Object(l.b)("Menu","Settings")}),null===(i=document.querySelector("#button-download-pb-calc"))||void 0===i||i.addEventListener("click",()=>{Object(l.b)("Tools","Download pb calculator")}),null===(s=document.querySelector("#reset"))||void 0===s||s.addEventListener("click",()=>{this._clearMap()}),null===(a=document.querySelector("#about"))||void 0===a||a.addEventListener("click",()=>{this._showAbout()}),null===(o=document.querySelector("#double-click-action"))||void 0===o||o.addEventListener("change",()=>this._doubleClickSelected()),null===(r=document.querySelector("#show-grid"))||void 0===r||r.addEventListener("change",()=>this._showGridSelected())}_setupScale(){this.minScale=Object(h.r)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this.minScale}_setupSvg(){this._zoom=n.a().wheelDelta(()=>-this._wheelDelta*Math.sign(o.c.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this.minScale,this.coord.min-this.xGridBackgroundHeight*this.minScale],[this.coord.max,this.coord.max]]).scaleExtent([this.minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this._svg=a.a("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").attr("class","map-tiles"),this._mainG=this._svg.append("g").attr("id","map")}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_displayMap(t){const{x:e,y:i,k:a}=t,o=Math.log2(this._tileSize),r=Math.log2(this.coord.max)-o,l=this.coord.max*a,d=this.width,c=this.height,p=Math.floor(l<d?d-2*e:l),u=Math.floor(l<c?c-2*i:l),m=Math.log2(a),_=Math.min(r,Math.ceil(Math.log2(Math.max(p,u)))-o),g=Math.round(10*(_-m-r))/10,f=this._wheelDelta**g,b=this._tileSize*f,v=l<d?e:0,y=l<c?i:0,w=s.a(Math.max(0,Math.floor((0-e)/b)),Math.max(0,Math.min(Math.ceil((d-e-v)/b),2**_))),S=s.a(Math.max(0,Math.floor((0-i)/b)),Math.max(0,Math.min(Math.ceil((c-i-y)/b),2**_))),D=[];for(const t of S)for(const e of w)D.push({z:_,row:t,col:e,id:`${_.toString()}-${t.toString()}-${e.toString()}`});const x=n.b.translate(e,i).scale(Object(h.t)(f));this._updateMap(D,x)}_updateMap(t,e){this._gMap.attr("transform",e.toString()).selectAll("image").data(t,t=>t.id).join(t=>t.append("image").attr("xlink:href",t=>`images/map/${t.z}/${t.row}/${t.col}.webp`).attr("x",t=>t.col*this._tileSize).attr("y",t=>t.row*this._tileSize).attr("width",this._tileSize+1).attr("height",this._tileSize+1))}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){const e=t("#modal-about");0===e.length&&D._initModal("modal-about"),e.modal("show")}_doDoubleClickAction(t){const e=r.a(t),i=n.c(t),[s,a]=e,{k:o,x:l,y:d}=i,h=(s-l)/o,c=(a-d)/o;"f11"===this._doubleClickAction?this.f11.printCoord(h,c):this._journey.plotCourse(h,c),this.zoomAndPan(h,c,1)}_setZoomLevelAndData(){o.c.transform.k!==this._currentScale&&(this._currentScale=o.c.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)}_getLowerBound(t){return t.invert([this.coord.min,this.coord.min])}_getUpperBound(t){return t.invert([this.width,this.height])}_getZoomTransform(){return this._currentTranslate={x:Math.floor(o.c.transform.x),y:Math.floor(o.c.transform.y)},n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(h.t)(o.c.transform.k))}_naZoomed(){const t=this._getZoomTransform(),e=this._getLowerBound(t),i=this._getUpperBound(t);this._ports.setBounds(e,i),this._pbZone.setBounds(e,i),this.showTrades.setBounds(e,i),this._displayMap(t),this._grid.transform(),this.showTrades.transform(t),this._mainG.attr("transform",t.toString()),this._setZoomLevelAndData()}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight(),document.querySelector("#navbar-left").classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}resize(){const t=n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update()}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight()}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style",`height:${e}px`)}initialZoomAndPan(){this._svg.call(this._zoom.scaleTo,this.minScale)}zoomAndPan(t,e,i){const s=n.b.scale(i).translate(Math.round(-t+this.width/2/i),Math.round(-e+this.height/2/i));this._svg.call(this._zoom.transform,s)}goToPort(){0===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)}}}.call(this,i("xeH2"))}}]);