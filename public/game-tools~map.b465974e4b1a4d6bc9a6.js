/*! For license information please see game-tools~map.b465974e4b1a4d6bc9a6.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{162:function(e,t,s){s.d(t,"b",(function(){return m})),s.d(t,"k",(function(){return u})),s.d(t,"c",(function(){return _})),s.d(t,"d",(function(){return f})),s.d(t,"a",(function(){return b})),s.d(t,"e",(function(){return g})),s.d(t,"f",(function(){return D})),s.d(t,"l",(function(){return S})),s.d(t,"g",(function(){return v})),s.d(t,"j",(function(){return C})),s.d(t,"i",(function(){return w})),s.d(t,"h",(function(){return y})),s.d(t,"m",(function(){return j}));s(289),s(53),s(185),s(25);var a=s(390),i=s(56);function r(){const e=h(["","",""]);return r=function(){return e},e}function o(){const e=h([".",""]);return o=function(){return e},e}function n(){const e=h([".",'<span class="hidden">0</span>']);return n=function(){return e},e}function p(){const e=h(['<span class="hidden">.',"</span>"]);return p=function(){return e},e}function d(){const e=h(["",""]);return d=function(){return e},e}function h(e,t){return t||(t=e.slice(0)),e.raw=t,e}const c=Object(a.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reals"],percent:" %",minus:"− "}),l=c.formatPrefix(",.0",1e3),m=(e,t=2)=>c.format(",."+t+"~r")(e),u=(e,t=2)=>c.format("+,."+t+"~r")(e).replace("+","＋ "),_=(e,t=2)=>c.format("."+t+"f")(e).replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),f=(e,t=2)=>{const[s,a]=c.format("."+t+"f")(e).split(".");let h=Object(i.d)(d(),a);return a&&(h="0"===a||"00"===a?Object(i.d)(p(),a):a.endsWith("0")?Object(i.d)(n(),a.replace("0","")):Object(i.d)(o(),a)),Object(i.d)(r(),s,h)},b=e=>l(-1*e).replace("k"," k"),g=e=>c.format(",d")(e),D=e=>c.format(",d")(e-.5),S=e=>c.format("+,d")(e).replace("+","＋ "),v=e=>c.format(",.0%")(e).replace("%","pp"),C=e=>c.format(",.2s")(e).replace(".0","").replace("M"," ᴍ").replace("k"," k").replace("m"," m"),w=e=>c.format("$,.2s")(e).replace(".0","").replace("M"," ᴍ").replace("k"," k"),y=(e,t=1)=>c.format("."+t+"%")(e).replace(".0",""),j=e=>c.format("+.1%")(e).replace(".0","").replace("+","＋ ")},168:function(e,t,s){(function(e){s.d(t,"e",(function(){return o})),s.d(t,"f",(function(){return n})),s.d(t,"j",(function(){return p})),s.d(t,"m",(function(){return d})),s.d(t,"a",(function(){return h})),s.d(t,"k",(function(){return c})),s.d(t,"l",(function(){return l})),s.d(t,"d",(function(){return m})),s.d(t,"c",(function(){return u})),s.d(t,"b",(function(){return _})),s.d(t,"g",(function(){return f})),s.d(t,"i",(function(){return b})),s.d(t,"h",(function(){return g}));s(25),s(113);var a=s(228),i=s(20),r=s(52);const o=(e,t=!1)=>{let s;return s=Number.isNaN(Number(e))?e:Object(r.l)(Number(e)),"<"+(t?"tspan":"span")+' class="caps">'+s+"</"+(t?"tspan":"span")+">"},n=(e,t=!1)=>{let s,a;return Number.isNaN(Number(e))?(s=e,a=Object(r.c)(s)%r.j):(a=Number(e),s=Object(r.l)(a)),"<"+(t?"tspan":"span")+' class="caps">'+s+"</"+(t?"tspan":"span")+"> ("+a+"°)"},p=t=>{const s=Object(r.l)(e("#"+t).roundSlider("getValue"));let a;return a=Number.isNaN(Number(s))?Object(r.c)(s):Number(s),a},d=(e,t)=>{let s=Math.atan2(t.y-e.y,t.x-e.x);s-=Math.PI/2;let a=Object(r.r)(s);return a<0&&(a+=r.j),a},h=(e,t,s=!0)=>{if(t<2)return[e];const a=e.length,i=[];let r,o=0;if(a%t==0)for(r=Math.floor(a/t);o<a;)i.push(e.slice(o,o+=r));else if(s)for(;o<a;)r=Math.ceil((a-o)/t--),i.push(e.slice(o,o+=r));else{for(t-=1,r=Math.floor(a/t),a%r==0&&(r-=1);o<r*t;)i.push(e.slice(o,o+=r));i.push(e.slice(r*t))}return i},c=({element:e,radius:t})=>{const s=i.w,o=r.j/s,n=Math.round(.8*t),p=new Array(s).fill(null).map((e,t)=>Object(r.l)(t*o)),d=Object(a.a)().range([0-o/2,r.j-o/2]).domain(p).align(0);e.append("circle").attr("r",n).style("stroke-width","3px");const h=e.append("text"),c=e.selectAll("g").data(p).join(e=>e.append("g").attr("transform",e=>{var t;return"rotate("+Math.round((null!==(t=d(e))&&void 0!==t?t:0)+d.bandwidth()/2-r.k)+")translate("+n+",0)"}));c.filter((e,t)=>t%3!=0).append("line").attr("x2",9),c.filter((e,t)=>t%3==0).append("text").attr("transform",e=>{var t,s,a,i,r;let o=Math.round((null!==(t=d(e))&&void 0!==t?t:0)+d.bandwidth()/2),n="";h.text(e);const p=null!==(s=null==(a=h.node())?void 0:a.getBBox().height)&&void 0!==s?s:0,c=null!==(i=null==(r=h.node())?void 0:r.getBBox().width)&&void 0!==i?i:0;return o>=0&&o<=45||315===o?(o=90,n="0,-"+p/2):90===o?(o=0,n=c/2+3+",0"):270===o?(o=180,n="-"+(c/2+3)+",0"):(o=-90,n="0,"+(p/2+3+2)),"rotate("+o+")translate("+n+")"}).text(e=>e),h.remove()},l=({element:e,radius:t})=>{const s=i.w,o=r.j/s,n=Math.round(.8*t),p=new Array(s).fill(null).map((e,t)=>Object(r.l)(t*o)),d=Object(a.a)().range([0-o/2,r.j-o/2]).domain(p).align(0);e.append("circle").attr("r",n).style("stroke-width","1.5px");e.selectAll("line").data(p).join(e=>e.append("line").attr("x2",(e,t)=>t%3==0?t%6==0?6:4:2).attr("transform",e=>{var t;return"rotate("+Math.round((null!==(t=d(e))&&void 0!==t?t:0)+d.bandwidth()/2)+")translate("+n+",0)"}))},m=e=>'<span class="caps">'+e+"</span>",u=(e,t)=>{navigator.clipboard||((e,t)=>{if(!document.queryCommandSupported||!document.queryCommandSupported("copy"))return console.error("Insufficient rights to copy "+e+" to clipboard"),!1;{const s=document.createElement("input");s.type="text",s.value=e,s.style.position="absolute",s.style.left="-1000px",s.style.top="-1000px",t.append(s),s.select();try{document.execCommand("copy")}catch(e){return console.error("Copy to clipboard failed.",e),!1}finally{s.remove()}}})(e,t),(e=>{navigator.clipboard.writeText(e).then(()=>!0).catch(t=>(console.error("Cannot copy "+e+" to clipboard",t),!1))})(e)},_=(e,t,s)=>{if(Number.isFinite(e)&&Number.isFinite(t)){const a=new URL(window.location.href);a.searchParams.set("x",String(e)),a.searchParams.set("z",String(t)),u(a.href,s)}},f=(e,t,s)=>"M"+e+","+t+" m"+-s+",0 a"+s+","+s+" 0,1,0 "+2*s+",0 a"+s+","+s+" 0,1,0 "+2*-s+",0",b=(e,t,s)=>"M"+(e-s/2)+","+(t-s/2)+"h"+s+"v"+s+"h"+-s+"z",g=(e,t,s)=>"M"+e+","+t+"v"+s}).call(this,s(51))},169:function(e,t,s){s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return i})),s.d(t,"c",(function(){return r}));s(53),s(234);const a=(e,t)=>e&&t?e.localeCompare(t):0,i=(e,t)=>e&&t?e-t:0,r=e=>(t,s)=>{let a=0;return e.some(e=>{let i=1;return String(e).startsWith("-")&&(i=-1,e=String(e).slice(1)),a=Number.isNaN(Number(t[e]))&&Number.isNaN(Number(s[e]))?String(t[e]).localeCompare(String(s[e]))*i:Number(t[e])-Number(s[e])*i,0!==a}),a}},207:function(e,t,s){s.d(t,"b",(function(){return p})),s.d(t,"c",(function(){return d.a})),s.d(t,"d",(function(){return h.a})),s.d(t,"a",(function(){return c.a}));s(25);var a=s(155),i=s(423),r=s(418),o=s(20);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class p{constructor(e,t){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=e,this._shipCompare=t,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(e=>e+" knots"),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(e){let t='<span class="badge badge-white">'+e[0]+" / ";return e[1]?t+=""+e[1]:t+="–",t+=" lb</span>",t}static getCannonsPerDeck(e,t){let s=t[0]+" "+p.pd(e[0]),a="";for(let i=1;i<4;i+=1)t[i]?s=t[i]+" "+p.pd(e[i])+" <br>"+s:a+="<br>";return[s,a]}static displaySecondBlock(){return'<div class="col-9"><div class="row no-gutters">'}static getText(e){let t=0;function s(e){return t+=1,'<div class="row row-small '+(t%2?"row-light":"")+'"><div class="col-3">'+e+"</div>"}function a(t,s,a=6){let i="",r="";return"cannonsPerDeck"===t?([i,r]=e[t],r="<br>"+r):i=""===t?"":String(e[t]),'<div class="col-'+a+'">'+i+'<br><span class="des">'+s+"</span>"+r+"</div>"}let i="";return i+=s(e.shipRating),i+=p.displaySecondBlock(),i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("waterlineHeight","Water line"),i+="</div></div></div>",i+=s(e.decks),i+=p.displaySecondBlock(),i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (lb)"),i+=p.displaySecondBlock(),i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+=p.displaySecondBlock(),i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+=p.displaySecondBlock(),i+=a("maxSpeed","Maximum"),i+=a("",""),i+=a("acceleration","Acceleration"),i+=a("deceleration","Deceleration"),i+=a("maxTurningSpeed","Turn speed"),i+=a("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=s('Hit points <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+=a("pump","Pump"),i+=a("rudder","Rudder"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+=p.displaySecondBlock(),i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+="</div></div></div>",i+=s("Resistance"),i+=p.displaySecondBlock(),i+=a("fireResistance","Fire",4),i+=a("leakResistance","Leak",4),i+=a("splinterResistance","Splinter",4),i+="</div></div></div>",i+=s('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=p.displaySecondBlock(),i+=a("hullRepairsNeeded","Hull",4),i+=a("rigRepairsNeeded","Rig",4),i+=a("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=s("Repair"),i+=p.displaySecondBlock(),i+=a("hullRepairAmount","Hull %",4),i+=a("rigRepairAmount","Rig %",4),i+=a("repairTime","Time (sec)",4),i+="</div></div></div>",i+=s("Hold"),i+=p.displaySecondBlock(),i+=a("maxWeight","Tons"),i+=a("holdSize","Cargo slots"),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const e=Object(a.a)(this.select);Object(a.a)(this.select+" svg").remove(),this._svg=e.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform","translate("+this._shipCompare.svgWidth/2+","+this._shipCompare.svgHeight/2+")"),Object(a.a)(this.select+" div").remove(),e.append("div").attr("class","block-small")}_setCompass(){const e=new Array(o.w/2);e.fill(1,0);const t=Object(i.a)().sort(null).value(1)(e),s=Object(r.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(t).join(e=>e.append("path").attr("d",s)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(e=>e.append("circle").attr("r",e=>this._shipCompare.radiusSpeedScale(e)))}}var d=s(268),h=s(270),c=s(272)},268:function(e,t,s){(function(e){s.d(t,"a",(function(){return v}));s(99),s(97),s(25);var a=s(418),i=s(423),r=s(422),o=s(426),n=s(162),p=s(52),d=s(174),h=s(90),c=s(168),l=s(424),m=s(38),u=s(20),_=s(269),f=s.n(_),b=s(207);function g(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function S(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class v extends b.b{constructor(e,t,s){super(e,s),S(this,"shipData",void 0),S(this,"_speedScale",void 0),S(this,"_shipRotate",void 0),S(this,"_speedText",void 0),S(this,"_drag",void 0),this.shipData=t,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const e=Object(a.a)().outerRadius(e=>this._shipCompare.radiusSpeedScale(e)+2).innerRadius(e=>this._shipCompare.radiusSpeedScale(e)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(t=>t.append("path").attr("d",e).attr("id",(e,t)=>"tick"+t)),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(e=>e.append("text").append("textPath").attr("href",(e,t)=>"#tick"+t).text((e,t)=>this.ticksSpeedLabels[t]).attr("startOffset","10%"))}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(n.b)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(p.l)(e)}_updateCompareWindProfiles(){for(const e of this._shipCompare.columnsCompare)Object(m.c)(this._shipCompare.selectedShips[e])||this._shipCompare.selectedShips[e].updateWindProfileRotation()}_setupDrag(){const e=this.shipData.speedDegrees.length,t=360/e,s=new Array(e+1).fill(null).map((e,s)=>s*t);this._speedScale=Object(d.a)().domain(s).range([].concat(g(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=l.a().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=h.c;e.rotate=this._getHeadingInDegrees(Object(c.m)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>"rotate("+e.rotate+")"),e.compassText.attr("transform",e=>"rotate("+-e.rotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.rotate)),"ship"===e.type?this._shipRotate=e.rotate:"windProfile"===e.type&&(this._shipCompare.windProfileRotate=e.rotate),this._speedText.attr("transform","rotate("+-this._shipRotate+")").text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===e.type&&this._updateCompareWindProfiles()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",f.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>"rotate("+-e.initRotate+")").text(e=>this._getSpeed(e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>"rotate("+e.initRotate+")")}_drawWindProfile(){const e=Object(i.a)().sort(null).value(1)(this.shipData.speedDegrees),t=r.a,s=Object(o.a)().angle((e,t)=>t*u.C).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(t);this._shipCompare.windProfileRotate=0;const a=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-a,type:"windProfile"},p=this._mainG.append("g").datum(n).attr("class","wind-profile");p.append("path").attr("d",e=>String(Object(c.g)(e.compassTextX,e.compassTextY,20))+Object(c.h)(e.compassTextX,e.compassTextY,-e.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),p.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20);const d=p.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));p.append("path").attr("class","base-profile").attr("d",s(e)),p.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(e).join(e=>e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*u.C)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*u.C)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).append("title").text(e=>Math.round(10*e.data)/10+" knots")),n.this=p,n.compassText=d,p.datum(n).attr("transform",e=>"rotate("+e.initRotate+")")}_printText(){var t;const s=b.b.getCannonsPerDeck(this.shipData.deckClassLimit,this.shipData.gunsPerDeck),a=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/u.q),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/u.A),r=Math.round(this.shipData.crew.max*u.B),o={acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:this.shipData.decks<4?"<br> ":"",backArmor:Object(n.f)(this.shipData.stern.armour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.stern.thickness)+"</span>",battleRating:String(this.shipData.battleRating),bowRepair:""+Object(n.f)(this.shipData.repairTime.bow),cannonBroadside:Object(n.f)(this.shipData.broadside.cannons),cannonsPerDeck:s,carroBroadside:Object(n.f)(this.shipData.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:this.shipData.decks+" deck"+(this.shipData.decks>1?"s":""),fireResistance:Object(n.h)(this.shipData.resistance.fire,0),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:Object(n.f)(this.shipData.bow.armour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.bow.thickness)+"</span>",guns:String(this.shipData.guns),gunsBack:this.shipData.gunsPerDeck[5],gunsFront:this.shipData.gunsPerDeck[4],halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.f)(this.shipData.holdSize),hullRepairAmount:""+Object(n.f)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:Object(n.f)(a)+' <span class="badge badge-white">'+Object(n.f)(a*u.y)+"</span>",leakResistance:Object(n.h)(this.shipData.resistance.leaks,0),limitBack:this.shipData.deckClassLimit[5],limitFront:this.shipData.deckClassLimit[4],mastBottomArmor:Object(n.f)(this.shipData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.mast.bottomThickness)+"</span>",mastMiddleArmor:Object(n.f)(this.shipData.mast.middleArmour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.mast.middleThickness)+"</span>",mastTopArmor:Object(n.f)(this.shipData.mast.topArmour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.mast.topThickness)+"</span>",maxCrew:Object(n.f)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.f)(this.shipData.maxWeight),minCrew:Object(n.f)(this.shipData.crew.min),pump:Object(n.f)(this.shipData.pump.armour),repairTime:""+Object(n.f)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(n.f)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:Object(n.f)(i)+' <span class="badge badge-white">'+Object(n.f)(i*u.y)+"</span>",rudder:Object(n.f)(this.shipData.rudder.armour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.rudder.thickness)+"</span>",rumRepairsNeeded:Object(n.f)(r)+' <span class="badge badge-white">'+Object(n.f)(r*u.y)+"</span>",sailingCrew:Object(n.f)(null!==(t=this.shipData.crew.sailing)&&void 0!==t?t:0),sails:Object(n.f)(this.shipData.sails.armour),shipRating:Object(p.p)(this.shipData.class)+" rate",sideArmor:Object(n.f)(this.shipData.sides.armour)+' <span class="badge badge-white">'+Object(n.f)(this.shipData.sides.thickness)+"</span>",splinterResistance:Object(n.h)(this.shipData.resistance.splinter,0),sternRepair:""+Object(n.f)(this.shipData.repairTime.stern),structure:Object(n.f)(this.shipData.structure.armour),upgradeXP:Object(n.f)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight)};o.gunsFront?o.gunsFront+=" "+b.b.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+b.b.pd(o.limitBack):o.gunsBack="–",e(""+this.select).find("div").append(b.b.getText(o))}}}).call(this,s(51))},269:function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},270:function(e,t,s){(function(e){s.d(t,"a",(function(){return v}));s(99),s(271),s(97),s(25);var a=s(216),i=s(235),r=s(424),o=s(174),n=s(90),p=s(423),d=s(422),h=s(426),c=s(162),l=s(52),m=s(20),u=s(168),_=s(269),f=s.n(_),b=s(207);function g(e){return function(e){if(Array.isArray(e))return D(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return D(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return D(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function S(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class v extends b.b{constructor(e,t,s,a){super(e,a),S(this,"shipCompareData",void 0),S(this,"_shipBaseData",void 0),S(this,"_speedScale",void 0),S(this,"_speedDiff",void 0),S(this,"_minSpeedDiff",void 0),S(this,"_maxSpeedDiff",void 0),S(this,"_shipRotate",void 0),S(this,"_speedText",void 0),S(this,"_drag",void 0),S(this,"_windProfile",void 0),S(this,"_gWindProfile",void 0),S(this,"_arcsComp",void 0),this._shipBaseData=t,this.shipCompareData=s,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(e,t){const s=Math.min(e,this._shipCompare.colourScaleSpeedDiff.domain()[0]),a=Math.max(t,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([s,0,a])}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(c.b)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(l.l)(e)}_updateSpeedText(){this._speedText.attr("transform","rotate("+-this._shipRotate+")").text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const e=this.shipCompareData.speedDegrees.length,t=360/e,s=new Array(e+1).fill(0).map((e,s)=>s*t);this._speedScale=Object(o.a)().domain(s).range([].concat(g(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=r.a().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=n.c;e.rotate=this._getHeadingInDegrees(Object(u.m)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>"rotate("+e.rotate+")"),e.compassText.attr("transform",e=>"rotate("+-e.rotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.rotate)),this._shipRotate=e.rotate,this._updateSpeedText()})()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipCompareData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",f.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>"rotate("+-e.initRotate+")").text(e=>this._getSpeed(this._shipCompare.windProfileRotate-e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>"rotate("+e.initRotate+")")}_drawDifferenceProfile(){var e,t;const s=Object(p.a)().sort(null).value(1),r=s(this._shipBaseData.speedDegrees);this._arcsComp=s(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((e,t)=>Object(l.s)(e-this._shipBaseData.speedDegrees[t])),this._minSpeedDiff=null!==(e=Object(a.a)(this._speedDiff))&&void 0!==e?e:0,this._maxSpeedDiff=null!==(t=Object(i.a)(this._speedDiff))&&void 0!==t?t:0;const o=d.a,n=Object(h.a)().angle((e,t)=>t*m.C).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(o),c=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-c,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform","rotate("+this._windProfile.initRotate+")"),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(r)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform","rotate("+this._shipCompare.windProfileRotate+")"),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(e=>{e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*m.C)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*m.C)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t])).append("title").text((e,t)=>Math.round(10*e.data)/10+" ("+Object(c.k)(this._speedDiff[t],1)+") knots")}).select("circle").attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t]))}_injectTextComparison(){function t(e,t,s=0,a=!1){let i=Number.parseFloat((e-t).toFixed(s));return a&&(i*=100),i<0?'<span class="badge badge-danger">'+Object(c.b)(Math.abs(i))+"</span>":i>0?'<span class="badge badge-success">'+Object(c.b)(i)+"</span>":""}const s=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/m.q),a=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/m.A),i=Math.round(this._shipBaseData.crew.max*m.B),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/m.q),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/m.A),n=Math.round(this.shipCompareData.crew.max*m.B),p={acceleration:Object(c.b)(this.shipCompareData.ship.acceleration)+" "+t(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2),additionalRow:this.shipCompareData.decks<4?"<br> ":"",backArmor:Object(c.f)(this.shipCompareData.stern.armour)+" "+t(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.stern.thickness)+"</span>"+t(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness),battleRating:this.shipCompareData.battleRating+" "+t(this.shipCompareData.battleRating,this._shipBaseData.battleRating),cannonBroadside:this.shipCompareData.broadside.cannons+" "+t(this.shipCompareData.broadside.cannons,this._shipBaseData.broadside.cannons),cannonsPerDeck:b.b.getCannonsPerDeck(this.shipCompareData.deckClassLimit,this.shipCompareData.gunsPerDeck),carroBroadside:this.shipCompareData.broadside.carronades+" "+t(this.shipCompareData.broadside.carronades,this._shipBaseData.broadside.carronades),deceleration:Object(c.b)(this.shipCompareData.ship.deceleration)+" "+t(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2),decks:this.shipCompareData.decks+" "+t(this.shipCompareData.decks,this._shipBaseData.decks)+" deck"+(this.shipCompareData.decks>1?"s":""),fireResistance:Object(c.h)(this.shipCompareData.resistance.fire,0)+" "+t(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0),firezoneHorizontalWidth:this.shipCompareData.ship.firezoneHorizontalWidth+" "+t(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth),frontArmor:Object(c.f)(this.shipCompareData.bow.armour)+" "+t(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.bow.thickness)+"</span>"+t(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness),guns:this.shipCompareData.guns+" "+t(this.shipCompareData.guns,this._shipBaseData.guns),gunsBack:this.shipCompareData.gunsPerDeck[5],gunsFront:this.shipCompareData.gunsPerDeck[4],halfturnTime:Object(c.b)(this.shipCompareData.rudder.halfturnTime,4)+" "+t(this.shipCompareData.rudder.halfturnTime,this._shipBaseData.rudder.halfturnTime,2),holdSize:Object(c.f)(this.shipCompareData.holdSize)+" "+t(this.shipCompareData.holdSize,this._shipBaseData.holdSize),hullRepairAmount:Object(c.f)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))+" "+t(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0),hullRepairsNeeded:Object(c.f)(r)+" "+t(r,s)+' <span class="badge badge-white">'+Object(c.f)(r*m.y)+"</span>",leakResistance:Object(c.h)(this.shipCompareData.resistance.leaks,0)+" "+t(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0),limitBack:this.shipCompareData.deckClassLimit[5],limitFront:this.shipCompareData.deckClassLimit[4],mastBottomArmor:Object(c.f)(this.shipCompareData.mast.bottomArmour)+" "+t(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.mast.bottomThickness)+"</span>"+t(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness),mastMiddleArmor:Object(c.f)(this.shipCompareData.mast.middleArmour)+" "+t(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.mast.middleThickness)+"</span>"+t(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness),mastTopArmor:Object(c.f)(this.shipCompareData.mast.topArmour)+" "+t(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.mast.topThickness)+"</span>"+t(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness),maxCrew:Object(c.f)(this.shipCompareData.crew.max)+" "+t(this.shipCompareData.crew.max,this._shipBaseData.crew.max),maxSpeed:Object(c.b)(this.shipCompareData.speed.max,4)+" "+t(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2),maxTurningSpeed:Object(c.b)(this.shipCompareData.rudder.turnSpeed,4)+" "+t(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2),maxWeight:Object(c.f)(this.shipCompareData.maxWeight)+" "+t(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight),minCrew:Object(c.f)(this.shipCompareData.crew.min)+" "+t(this.shipCompareData.crew.min,this._shipBaseData.crew.min),minSpeed:Object(c.b)(this.shipCompareData.speed.min)+" "+t(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2),pump:Object(c.f)(this.shipCompareData.pump.armour)+" "+t(this.shipCompareData.pump.armour,this._shipBaseData.pump.armour),repairTime:Object(c.f)(this.shipCompareData.repairTime.sides)+" "+t(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides),rigRepairAmount:Object(c.f)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))+" "+t(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0),rigRepairsNeeded:Object(c.f)(o)+" "+t(o,a)+' <span class="badge badge-white">'+Object(c.f)(o*m.y)+"</span>",rudder:Object(c.f)(this.shipCompareData.rudder.armour)+" "+t(this.shipCompareData.rudder.armour,this._shipBaseData.rudder.armour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.rudder.thickness)+"</span>"+t(this.shipCompareData.rudder.thickness,this._shipBaseData.rudder.thickness),rumRepairsNeeded:Object(c.f)(n)+" "+t(n,i)+' <span class="badge badge-white">'+Object(c.f)(n*m.y)+"</span>",sailingCrew:Object(c.f)(this.shipCompareData.crew.sailing)+" "+t(this.shipCompareData.crew.sailing,this._shipBaseData.crew.sailing),sails:Object(c.f)(this.shipCompareData.sails.armour)+" "+t(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour),shipRating:Object(l.p)(this.shipCompareData.class)+" rate",sideArmor:Object(c.f)(this.shipCompareData.sides.armour)+" "+t(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)+' <span class="badge badge-white">'+Object(c.f)(this.shipCompareData.sides.thickness)+"</span>"+t(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness),splinterResistance:Object(c.h)(this.shipCompareData.resistance.splinter,0)+" "+t(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0),structure:Object(c.f)(this.shipCompareData.structure.armour)+" "+t(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour),upgradeXP:Object(c.f)(this.shipCompareData.upgradeXP)+" "+t(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP),waterlineHeight:Object(c.b)(this.shipCompareData.ship.waterlineHeight)+" "+t(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)};p.gunsFront?p.gunsFront+=" "+b.b.pd(p.limitFront):p.gunsFront="–",p.gunsBack?p.gunsBack+=" "+b.b.pd(p.limitBack):p.gunsBack="–",e(""+this.select).find("div").append(b.b.getText(p))}}}).call(this,s(51))},272:function(e,t,s){(function(e){s.d(t,"a",(function(){return C}));s(99),s(236),s(237),s(98),s(97),s(53),s(185),s(234),s(100),s(101),s(102),s(103),s(104),s(105),s(106),s(107),s(108),s(109),s(110),s(111),s(112),s(189),s(190),s(191),s(192),s(193),s(194),s(195),s(196),s(197),s(198),s(199),s(200),s(201),s(202),s(203),s(204),s(25),s(113),s(160),s(163);var a=s(216),i=s(235),r=s(175),o=s(225),n=s(402),p=s(174),d=s(155),h=s(37),c=s(20),l=s(38),m=s(162),u=s(52),_=s(169),f=s(168),b=s(207),g=s(273);function D(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function v(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class C{constructor(e="ship-compare"){v(this,"colorScale",void 0),v(this,"colourScaleSpeedDiff",void 0),v(this,"columnsCompare",void 0),v(this,"innerRadius",void 0),v(this,"outerRadius",void 0),v(this,"radiusSpeedScale",void 0),v(this,"selectedShips",void 0),v(this,"singleShipData",void 0),v(this,"shipMassScale",void 0),v(this,"svgHeight",void 0),v(this,"svgWidth",void 0),v(this,"windProfileRotate",0),v(this,"woodCompare",void 0),v(this,"_maxSpeed",void 0),v(this,"_minSpeed",void 0),v(this,"_modal$",{}),v(this,"_modifierAmount",void 0),v(this,"_moduleAndWoodCaps",void 0),v(this,"_moduleAndWoodChanges",void 0),v(this,"_moduleDataDefault",void 0),v(this,"_moduleProperties",void 0),v(this,"_moduleTypes",void 0),v(this,"_selectedUpgradeIdsList",{}),v(this,"_selectedUpgradeIdsPerType",{}),v(this,"_selectModule$",{}),v(this,"_selectShip$",{}),v(this,"_selectWood$",{}),v(this,"_shipData",void 0),v(this,"_shipIds",{}),v(this,"_shipSelectData",void 0),v(this,"_baseId",void 0),v(this,"_baseName",void 0),v(this,"_buttonId",void 0),v(this,"_columns",void 0),v(this,"_copyButtonId",void 0),v(this,"_modalId",void 0),v(this,"_moduleId",void 0),v(this,"_woodId",void 0),this._baseId=e,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this.colourScaleSpeedDiff=Object(p.a)().range([c.j,c.l,c.f]).interpolate(n.a),this._modifierAmount=new Map,"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(e){return e<=3?"L":e<=5?"M":"S"}static _adjustAbsolute(e,t){return e?e+t:t}static _adjustPercentage(e,t,s){return s?e?e*(1+t):t:e?e+t:t}static _getModifierFromModule(e){return'<p class="mb-0">'+e.map(e=>{let t;return t=e.isPercentage?Object(m.m)(e.amount/100):e.amount<1&&e.amount>0?Object(m.g)(e.amount):Object(m.l)(e.amount),e.modifier+" "+t}).join("<br>")+"</p>"}static _setSelect(e,t){t&&e.val(t.toString),e.selectpicker("render")}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(e){var t;await this._loadAndSetupData();const s=c.o.decode(null!==(t=e.get("cmp"))&&void 0!==t?t:"");s.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(s),this._setModuleSelects(e))}_setupArrow(){const e=document.querySelector("#journey-arrow").cloneNode(!0);if(e.id="wind-profile-arrow-head",e.hasChildNodes())for(const t of e.childNodes)t.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(e)}_setupData(){var e,t,s;this._moduleAndWoodChanges=new Map([["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Armour repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder repair time",{properties:["repairTime.rudder"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sail repair amount",{properties:["repairAmount.sails"],isBaseValueAbsolute:!0}],["Sail repair time",{properties:["repairTime.sails"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Side armour repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Speed decrease",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}],["Water repair time",{properties:["repairTime.pump"],isBaseValueAbsolute:!0}]]),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],cap:{amount:.4,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:.4,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:.4,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:.3,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:.3,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:16,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const r=1.2*(null!==(e=Object(a.a)(this._shipData,e=>e.speed.min))&&void 0!==e?e:0),o=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=r,this._maxSpeed=o,this.colorScale=Object(p.a)().domain([this._minSpeed,0,this._maxSpeed]).range([c.j,c.l,c.f]).interpolate(n.a);const d=null!==(t=Object(a.a)(this._shipData,e=>e.shipMass))&&void 0!==t?t:0,h=null!==(s=Object(i.a)(this._shipData,e=>e.shipMass))&&void 0!==s?s:0;this.shipMassScale=Object(p.a)().domain([d,h]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await s.e(5).then(s.t.bind(null,224,3))).default,this._shipData=(await s.e(12).then(s.t.bind(null,280,3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new g.a(this._woodId),await this.woodCompare.woodInit())}catch(e){Object(l.e)(e)}}_setupListener(){var e;let t=!0;null==(e=document.querySelector("#"+this._buttonId))||e.addEventListener("click",async e=>{t&&(t=!1,await this._loadAndSetupData()),Object(h.b)("Tools",this._baseName),e.stopPropagation(),this._shipCompareSelected()})}_setGraphicsParameters(){var t;this.svgWidth=null!==(t=e("#"+this._modalId+" .column-base").width())&&void 0!==t?t:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(p.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_shipCompareSelected(){var t,s;Object(l.c)(this._modal$)&&(this._initModal(),this._modal$=e("#"+this._modalId),null==(t=document.querySelector("#"+this._modalId))||t.addEventListener("keydown",e=>{"KeyC"===e.key&&e.ctrlKey&&this._copyDataClicked(e)}),null==(s=document.querySelector("#"+this._copyButtonId))||s.addEventListener("click",e=>{this._copyDataClicked(e)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];for(const t of this._columns)if(void 0!==this._shipIds[t]){e.push.apply(e,D(this._shipIds[t]));for(const s of["frame","trim"])e.push(Number(this._selectWood$[t][s].val()))}return e}_copyDataClicked(e){Object(h.b)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length>0){const e=new URL(window.location.href);e.searchParams.set("v",encodeURIComponent(c.d)),e.searchParams.set("cmp",c.o.encode(t));for(const t of this._columns){const s=this._columns.indexOf(t);if(this._selectedUpgradeIdsPerType[t])for(const a of D(this._moduleTypes)){const i=D(this._moduleTypes).indexOf(a),r=this._selectedUpgradeIdsPerType[t][a];if(null==r?void 0:r.length){const t=""+s+i;e.searchParams.set(t,c.o.encode(r))}}}Object(f.c)(e.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(o.b)().key(e=>String(e.class)).sortKeys(r.a).entries(this._shipData.map(e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns})).sort(Object(_.c)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(e=>e[1].filter(e=>e.properties.some(e=>this._moduleAndWoodChanges.has(e.modifier))).map(e=>[e.id,e]))),this._moduleTypes=new Set(D(this._moduleProperties).map(e=>e[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(c.u)({id:this._modalId,title:this._baseName});const e=Object(d.a)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row");for(const t of this._columns){const s=e.append("div").attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),a=this._getShipSelectId(t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker");for(const e of["frame","trim"]){const a=this._getWoodSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}for(const e of this._moduleTypes){const a=this._getModuleSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}s.append("div").attr("id",this._baseId+"-"+t).attr("class","Base"===t?"ship-base":"ship-compare")}Object(d.a)("#"+this._modalId+" .modal-footer").insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const t of this._columns){if(this._setupShipSelect(t),"ship-journey"!==this._baseId){this._selectWood$[t]={};for(const s of["frame","trim"])this._selectWood$[t][s]=e("#"+this._getWoodSelectId(s,t)),this.woodCompare._setupWoodSelects(t,s,this._selectWood$[t][s])}this._setupSelectListener(t)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(e=>'<optgroup label="'+Object(u.p)(Number(e.key),!1)+' rate">'+e.values.map(e=>'<option data-subtext="'+e.battleRating+'" value="'+e.id+'">'+e.name+" ("+e.guns+")").join("</option>")).join("</optgroup>")}_setupShipSelect(t){this._selectShip$[t]=e("#"+this._getShipSelectId(t));const s=this._getShipOptions();this._selectShip$[t].append(s),"Base"!==t&&this._selectShip$[t].attr("disabled","disabled")}_getUpgradesOptions(e,t){const s=Object(o.b)().key(e=>e[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(r.a).sortValues((e,t)=>e[1].name.localeCompare(t[1].name)).entries(D(this._moduleProperties).filter(s=>s[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===e&&("U"===s[1].moduleLevel||s[1].moduleLevel===C._getModuleLevel(t))));let a="";const i=new Set(["Permanent","Ship trim"]);return a=s.length>1?s.map(t=>'<optgroup label="'+t.key+'" data-max-options="'+(i.has(e.replace(/[\sA-Za-z]+\s–\s/,""))?1:5)+'">'+t.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>")).join("</optgroup>"):s.map(e=>""+e.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>")).join(""),a}_fillModuleSelect(e,t){const s=this._getUpgradesOptions(t,(()=>this._shipData.find(t=>t.id===this._shipIds[e]).class)());this._selectModule$[e][t].find("option").remove(),this._selectModule$[e][t].append(s)}_resetModuleSelects(e){for(const t of this._moduleTypes)this._fillModuleSelect(e,t),this._selectModule$[e][t].selectpicker("refresh")}_getModuleFromName(e){let t={};return this._moduleDataDefault.some(s=>(t=s[1].find(t=>t.name===e),Boolean(t))),t}_setupModulesSelect(t){if(!this._selectModule$[t]){this._selectModule$[t]={};for(const s of this._moduleTypes)this._selectModule$[t][s]=e("#"+this._getModuleSelectId(s,t)),this._selectModule$[t][s].on("changed.bs.select",()=>{this._modulesSelected(t),this._refreshShips(t)}).on("show.bs.select",t=>{e(t.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",t=>{const s=e(t.currentTarget);for(const t of s.data("selectpicker").selectpicker.current.elements)if(!t.classList.contains("dropdown-divider")&&!t.classList.contains("dropdown-header")){const s=this._getModuleFromName(t.textContent);e(t).attr("data-original-title",C._getModifierFromModule(s.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:e=>e+" "+s.toLowerCase()+"s selected",deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:s.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+s,width:"150px"})}this._resetModuleSelects(t)}_getShipData(e){const t=this._shipData.find(t=>t.id===this._shipIds[e]);let s=t;return s.repairAmount={armour:c.p,armourPerk:0,sails:c.z,sailsPerk:0},s.repairTime={sides:c.x,default:c.x},s.resistance={fire:0,leaks:0,splinter:0},s=this._addModulesAndWoodData(t,s,e),s}_adjustValue(e,t,s){var a,i;let r=e;if(null==(a=this._modifierAmount.get(t))?void 0:a.absolute){const{absolute:e}=this._modifierAmount.get(t);r=C._adjustAbsolute(r,e)}if(null==(i=this._modifierAmount.get(t))?void 0:i.percentage){const e=this._modifierAmount.get(t).percentage/100;r=C._adjustPercentage(r,e,s)}return Math.trunc(100*r)/100}_setModifier(e){let t=e.isPercentage?0:e.amount,s=e.isPercentage?e.amount:0;var a,i,r,o;this._modifierAmount.has(e.modifier)&&(t+=null!==(a=null==(i=this._modifierAmount.get(e.modifier))?void 0:i.absolute)&&void 0!==a?a:0,s+=null!==(r=null==(o=this._modifierAmount.get(e.modifier))?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(e.modifier,{absolute:t,percentage:s})}_showCappingAdvice(e,t){const s=this._baseId+"-"+e+"-capping";let a=document.querySelector("#"+s);if(!a){var i;a=document.createElement("p"),a.id=s,a.className="alert alert-warning";const t=document.querySelector("#"+this._baseId+"-"+e);null==t||null==(i=t.firstChild)||i.after(a)}a.innerHTML=D(t).join(", ")+" capped"}_removeCappingAdvice(e){const t=this._baseId+"-"+e+"-capping",s=document.querySelector("#"+t);s&&s.remove()}_addModulesAndWoodData(e,t,s){const a=JSON.parse(JSON.stringify(t)),i=()=>{a.speedDegrees=a.speedDegrees.map(e=>{const t=1+this._modifierAmount.get("Max speed").percentage/100,s=e>0?e*t:e/t;return Math.max(Math.min(s,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const e of this._selectedUpgradeIdsList[s]){const t=this._moduleProperties.get(e);for(const e of t.properties)this._moduleAndWoodChanges.has(e.modifier)&&this._setModifier(e)}if(this.woodCompare.instances[s]){let e="_woodData";"Base"!==s&&(e="_compareData");for(const t of["frame","trim"])for(const a of this.woodCompare.instances[s][e][t].properties)this._moduleAndWoodChanges.has(a.modifier)&&this._setModifier(a)}})(),(()=>{for(const[t]of this._modifierAmount.entries()){var e;if(null==(e=this._moduleAndWoodChanges.get(t))?void 0:e.properties){const{properties:e,isBaseValueAbsolute:s}=this._moduleAndWoodChanges.get(t);for(const i of e){const e=i.split(".");e.length>1?a[e[0]][e[1]]=this._adjustValue(a[e[0]][e[1]],t,s):a[e[0]]=this._adjustValue(a[e[0]],t,s)}}}})(),(()=>{const t={isCapped:!1,modifiers:new Set},i=(e,s,a,{amount:i,isPercentage:r})=>{const o=Math.min(s,r?a*(1+i):i);return s!==o&&(t.isCapped=!0,t.modifiers.add(e)),o};for(const[t]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(t)){const{cap:s}=this._moduleAndWoodCaps.get(t);for(const r of this._moduleAndWoodCaps.get(t).properties){const o=r.split(".");o.length>1?a[o[0]][o[1]]&&(a[o[0]][o[1]]=i(t,a[o[0]][o[1]],e[o[0]][o[1]],s)):a[o[0]]&&(a[o[0]]=i(t,a[o[0]],e[o[0]],s))}}t.isCapped?this._showCappingAdvice(s,t.modifiers):this._removeCappingAdvice(s)})(),this._modifierAmount.has("Max speed")&&i(),a}_updateDifferenceProfileNeeded(e){"Base"===e||Object(l.c)(this.selectedShips[e])||this.selectedShips[e].updateDifferenceProfile()}_updateSailingProfile(e){this._updateDifferenceProfileNeeded(e);for(const t of this.columnsCompare)t!==e&&this._updateDifferenceProfileNeeded(t)}_refreshShips(e){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(t=>t.id===this._shipIds[e]);else{this._modulesSelected(e);const t=this._getShipData(e);if("Base"===e){this._setSelectedShip(e,new b.c(e,t,this));for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),Object(l.c)(this.selectedShips[e])||this._setSelectedShip(e,new b.d(e,t,this.selectedShips[e].shipCompareData,this))}else this._setSelectedShip(e,new b.d(e,this.selectedShips.Base.shipData,t,this));this._updateSailingProfile(e)}}_enableCompareSelects(){for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={};for(const t of this._moduleTypes)this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map(Number):this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t]?[Number(this._selectedUpgradeIdsPerType[e][t])]:[],this._selectedUpgradeIdsPerType[e][t].length>0&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))}_setupSelectListener(e){if(this._selectShip$[e].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(e),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(e)}),"ship-journey"!==this._baseId)for(const t of["frame","trim"])this._selectWood$[e][t].on("changed.bs.select",()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)}).selectpicker({title:"Wood "+t,width:"150px"})}_setShipAndWoodsSelects(e){let t=0;this._columns.some(s=>{if(!this._shipData.find(s=>s.id===e[t]))return!1;if(this._shipIds[s]=e[t],t+=1,C._setSelect(this._selectShip$[s],this._shipIds[s]),"Base"===s&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(s),this._setupModulesSelect(s),e[t])for(const a of["frame","trim"])C._setSelect(this._selectWood$[s][a],e[t]),t+=1,this.woodCompare._woodSelected(s,a,this._selectWood$[s][a]);else t+=2;return this._refreshShips(s),t>=e.length})}_setModuleSelects(e){for(const s of this._columns){const a=this._columns.indexOf(s);let i=!1;for(const r of D(this._moduleTypes)){const o=D(this._moduleTypes).indexOf(r);if(e.has(""+a+o)){var t;const n=c.o.decode(e.get(""+a+o));this._selectedUpgradeIdsPerType[s]||(this._selectedUpgradeIdsPerType[s]={}),this._selectedUpgradeIdsList[s]||(this._selectedUpgradeIdsList[s]=[]),this._selectedUpgradeIdsPerType[s][r]=n.map(Number),C._setSelect(this._selectModule$[s][r],this._selectedUpgradeIdsPerType[s][r]),(t=this._selectedUpgradeIdsList[s]).push.apply(t,D(this._selectedUpgradeIdsPerType[s][r])),i=!0}}i&&this._refreshShips(s)}}_getShipSelectId(e){return this._baseId+"-"+e+"-select"}_getWoodSelectId(e,t){return this._woodId+"-"+e+"-"+t+"-select"}_getModuleSelectId(e,t){return this._moduleId+"-"+e.replace(/\s/,"")+"-"+t+"-select"}_setSelectedShip(e,t){this.selectedShips[e]=t}}}).call(this,s(51))},273:function(e,t,s){(function(e){s.d(t,"a",(function(){return b}));s(99),s(236),s(237),s(271),s(98),s(97),s(100),s(101),s(102),s(103),s(104),s(105),s(106),s(107),s(108),s(109),s(110),s(111),s(112),s(189),s(190),s(191),s(192),s(193),s(194),s(195),s(196),s(197),s(198),s(199),s(200),s(201),s(202),s(203),s(204),s(25),s(160),s(163),s(171);var a=s(216),i=s(235),r=s(155),o=s(37),n=s(162),p=s(20),d=s(38),h=s(169);function c(e){return function(e){if(Array.isArray(e))return l(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return l(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return Array.from(s);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return l(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,a=new Array(t);s<t;s++)a[s]=e[s];return a}function m(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class u{constructor(e,t){m(this,"select",void 0),m(this,"_woodCompare",void 0),m(this,"_id",void 0),m(this,"_g",void 0),this._id=e,this._woodCompare=t,this.select="#"+this._woodCompare.baseFunction+"-"+this._id,this._setupMainDiv(),this._g=Object(r.a)(this.select).select("g")}_setupMainDiv(){Object(r.a)(this.select+" div").remove(),Object(r.a)(this.select).append("div")}}class _ extends u{constructor(e,t,s){super(e,s),m(this,"_woodData",void 0),this._woodData=t,this._printText()}_getProperty(e,t){const s=this._woodData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),s=this._getProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';t+="<tr>",t+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,p]of e.properties){if(t+="<tr><td>"+o+"</td><td>"+(p.isPercentage?Object(n.h)(p.amount/100):Object(n.b)(p.amount)),t+='<span class="rate">',p.amount>0){var s,a;t+='<span class="bar neutral" style="width:50%;"></span>',t+='<span class="bar pos diff" style="width:'+p.amount/(null!==(s=null==(a=this._woodCompare.minMaxProperty.get(o))?void 0:a.max)&&void 0!==s?s:1)*50+'%;"></span>'}else if(p.amount<0){var i,r;const e=p.amount/(null!==(i=null==(r=this._woodCompare.minMaxProperty.get(o))?void 0:r.min)&&void 0!==i?i:1)*50;t+='<span class="bar neutral" style="width:'+(50-e)+'%;"></span>',t+='<span class="bar neg diff" style="width:'+e+'%;"></span>'}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}return t+="</tbody></table>",t}_printText(){const t={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const e of this._woodCompare.propertyNames){const s=this._getPropertySum(e);t.properties.set(e,{amount:s.amount,isPercentage:s.isPercentage})}e(""+this.select).find("div").append(this._getText(t))}}class f extends u{constructor(e,t,s,a){super(e,a),m(this,"_baseData",void 0),m(this,"_compareData",void 0),this._baseData=t,this._compareData=s,this._printTextComparison()}static _getDiff(e,t,s,a=1){const i=Number.parseFloat((e-t).toFixed(a));return(s?Object(n.h)(e/100,a):Object(n.b)(e))+' <span class="badge badge-white">'+Object(n.k)(i)+"</span>"}_getBaseProperty(e,t){const s=this._baseData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),s=this._getBaseProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(e,t){const s=this._compareData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return(null==s?void 0:s.amount)&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),s=this._getCompareProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:t.isPercentage&&s.isPercentage}}_getText(e){let t=0,s=0,a=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[b,g]of e.properties){var o,n,p,d;if(r+="<tr><td>"+b+"</td><td>"+f._getDiff(g.compare,g.base,g.isPercentage),r+='<span class="rate">',g.compare>=0)g.base>=0?g.compare>g.base?(t=g.base,s=g.compare-g.base,i="pos"):(t=g.compare,s=g.base-g.compare,i="neg"):(t=0,s=g.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+='<span class="bar pos diff" style="width:'+t/(null!==(o=null==(n=this._woodCompare.minMaxProperty.get(b))?void 0:n.max)&&void 0!==o?o:1)*50+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/(null!==(p=null==(d=this._woodCompare.minMaxProperty.get(b))?void 0:d.max)&&void 0!==p?p:1)*50+'%;"></span>';else if(g.compare<0){var h,c,l,m,u,_;g.base<0?g.compare>=g.base?(t=g.compare,s=g.base-g.compare,a=-g.base,i="pos"):(t=g.base,s=g.compare-g.base,a=-g.compare,i="neg"):(t=0,s=g.compare,a=-g.compare,i="neg"),r+='<span class="bar neutral" style="width:'+(50+a/(null!==(h=null==(c=this._woodCompare.minMaxProperty.get(b))?void 0:c.min)&&void 0!==h?h:1)*50)+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/(null!==(l=null==(m=this._woodCompare.minMaxProperty.get(b))?void 0:m.min)&&void 0!==l?l:1)*50+'%;"></span>',r+='<span class="bar neg diff" style="width:'+t/(null!==(u=null==(_=this._woodCompare.minMaxProperty.get(b))?void 0:_.min)&&void 0!==u?u:1)*50+'%;"></span>'}else r+='<span class="bar neutral"></span>';r+="</span></td></tr>"}return r+="</tbody></table>",r}_printTextComparison(){const t={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const e of this._woodCompare.propertyNames){const s=this._getBasePropertySum(e),a=this._getComparePropertySum(e);t.properties.set(e,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}e(""+this.select).find("div").append(this._getText(t))}}class b{constructor(e){m(this,"baseFunction",void 0),m(this,"instances",{}),m(this,"minMaxProperty",new Map),m(this,"propertyNames",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_woodData",void 0),m(this,"_columnsCompare",void 0),m(this,"_defaultWoodId",{}),m(this,"_columns",void 0),m(this,"_frameSelectData",void 0),m(this,"_trimSelectData",void 0),m(this,"_options",{}),m(this,"_woodIdsSelected",{}),this.baseFunction=e,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}_findWoodId(e,t){var s,a;return null!==(s=null==(a=this._woodData[e].find(e=>e.name===t))?void 0:a.id)&&void 0!==s?s:0}_setupData(){this.propertyNames=new Set([].concat(c(this._woodData.frame.flatMap(e=>e.properties.map(e=>e.modifier))),c(this._woodData.trim.flatMap(e=>e.properties.map(e=>e.modifier)))).sort(h.b)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await s.e(13).then(s.t.bind(null,252,3))).default,this._setupData()}catch(e){Object(d.e)(e)}}_setupListener(){var e;let t=!0;null==(e=document.querySelector("#"+this._buttonId))||e.addEventListener("click",async e=>{t&&(t=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),e.stopPropagation(),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),e("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(h.c)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(h.c)(["name"])),this._setOption(this._frameSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>").toString(),this._trimSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>").toString());for(const o of this.propertyNames){var e,t,s,r;const n=c(this._woodData.frame.map(e=>{var t,s;return null!==(t=null==(s=e.properties.find(e=>e.modifier===o))?void 0:s.amount)&&void 0!==t?t:0})),p=c(this._woodData.trim.map(e=>{var t,s;return null!==(t=null==(s=e.properties.find(e=>e.modifier===o))?void 0:s.amount)&&void 0!==t?t:0})),d=null!==(e=Object(a.a)(n))&&void 0!==e?e:0,h=null!==(t=Object(i.a)(n))&&void 0!==t?t:0,l=null!==(s=Object(a.a)(p))&&void 0!==s?s:0,m=null!==(r=Object(i.a)(p))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:d+l>=0?0:d+l,max:h+m})}}_injectModal(){Object(p.u)({id:this._modalId,title:this._baseName});const e=Object(r.a)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const t of this._columns){const s=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));for(const e of d.h){const a=this.baseFunction+"-"+e+"-"+t+"-select";s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}s.append("div").attr("id",this.baseFunction+"-"+t)}}_initModal(){this._initData(),this._injectModal();for(const t of this._columns)for(const s of d.h){const a=e("#"+this.baseFunction+"-"+s+"-"+t+"-select");this._setupWoodSelects(t,s,a),this._setupSelectListener(t,s,a)}}_setWoodsSelected(e,t,s){this._woodIdsSelected[e]||(this._woodIdsSelected[e]={}),this._woodIdsSelected[e][t]=s}_setupWoodSelects(e,t,s){this._setWoodsSelected(e,t,this._defaultWoodId[t]),s.append(this._options[t]),("wood"!==this.baseFunction||"Base"!==e&&"wood"===this.baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(t,s){const a="frame"===s?"trim":"frame";this._woodIdsSelected[t][a]===this._defaultWoodId[a]&&e("#"+this.baseFunction+"-"+a+"-"+t+"-select").val(this._defaultWoodId[a]).selectpicker("refresh")}enableSelects(t){for(const s of d.h)e("#"+this.baseFunction+"-"+s+"-"+t+"-select").removeAttr("disabled").selectpicker("refresh")}_woodSelected(e,t,s){const a=Number(s.val());if(this._setWoodsSelected(e,t,a),this._setOtherSelect(e,t),"Base"===e){this._addInstance(e,new _("Base",this._getWoodData("Base"),this));for(const e of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(e),this.instances[e]&&this._addInstance(e,new f(e,this._getWoodData("Base"),this._getWoodData(e),this))}else this._addInstance(e,new f(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,s){s.on("change",()=>this._woodSelected(e,t,s)).selectpicker({title:"Select "+t})}_getWoodData(e){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[e].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[e].trim)}}_addMinMaxProperty(e,t){this.minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this.instances[e]=t}getWoodTypeData(e,t){var s;return null!==(s=this._woodData[e].find(e=>e.id===t))&&void 0!==s?s:{}}}}).call(this,s(51))}}]);