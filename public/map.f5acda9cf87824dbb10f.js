/*! For license information please see map.f5acda9cf87824dbb10f.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+RFf":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"0kUG":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"1j+5":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"1qWw":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return g}));i("kypl"),i("9UJh"),i("U00V"),i("3XUK"),i("Peo2");var s=i("PVJp"),a=i("f4w0"),o=i("Av7d"),r=i("0lY5"),n=i("4PeS");function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}const l=t=>t*t,h=t=>Math.sqrt(l(t.x)+l(t.y)+l(t.z)),c=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,p=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),_=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),u=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),m=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});class g{constructor(t){this._ports=t,this._NumberOfInputs=3,this._baseName="Get position",this._baseId="get-position",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._modal$=null,this._select=[],this._input=[],this._selector=[];for(const t of d(new Array(this._NumberOfInputs).keys()))this._select[t]=this._baseId+"-"+t+"-select",this._input[t]=this._baseId+"-"+t+"-input";this._setupListener()}_navbarClick(t){Object(a.b)("Menu","Get position"),t.stopPropagation(),this._positionSelected()}_setupListener(){document.getElementById(""+this._buttonId).addEventListener("click",t=>this._navbarClick(t))}_injectModal(){Object(o.C)(this._modalId,this._baseName,"","Go");const t=Object(s.a)("#"+this._modalId+" .modal-body");t.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of d(new Array(this._NumberOfInputs).keys())){const i=e.append("div").attr("class","form-row");i.append("div").attr("class","col-md-6").append("label").append("select").attr("name",this._select[t]).attr("id",this._select[t]).attr("class","selectpicker"),i.append("div").attr("class","col-md-6").append("input").attr("id",this._input[t]).attr("name",this._input[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)}}_setupSelects(){const e=""+this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(r.M)(["name"])).map(t=>'<option data-subtext="'+t.nation+'">'+t.name+"</option>").join("");for(const i of d(new Array(this._NumberOfInputs).keys()))this._selector[i]=document.getElementById(this._select[i]),this._selector[i].insertAdjacentHTML("beforeend",e),t(this._selector[i]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelects()}_showAndGoToPosition(){const t=this._ports.portData.map(t=>({x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance})),e=function(t,e,i,s=!1){var a;const o=u(p(e,t),h(p(e,t))),r=c(o,p(i,t));let n=p(p(i,t),m(o,r));const d=u(n,h(n)),g=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(o,d),f=h(p(e,t)),b=c(d,p(i,t)),y=(l(t.r)-l(e.r)+l(f))/(2*f),v=(l(t.r)-l(i.r)+l(r)+l(b))/(2*b)-r/b*y;let w=l(t.r)-l(y)-l(v);Math.abs(w)<1e-10&&(w=0);const S=Math.sqrt(w);if(isNaN(S))return null;n=_(t,_(m(o,y),m(d,v)));const x=_(n,m(g,S)),C=p(n,m(g,S));return(null!==(a=0===S)&&void 0!==a?a:s)?n:[x,C]}(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),this._ports._map._f11.printCoord(e.x,e.y),this._ports._map.zoomAndPan(e.x,e.y,1);const t=Math.round(Object(o.o)(e.x,e.y)/-1e3),i=Math.round(Object(o.p)(e.x,e.y)/-1e3);Object(r.f)(t,i),new n.a("Get position","Coordinates copied to clipboard.")}else new n.a("Get position","No intersection found.")}_useUserInput(){const t=new Map;for(const e of d(new Array(this._NumberOfInputs).keys())){const i=this._selector[e].selectedIndex?this._selector[e].options[this._selector[e].selectedIndex].text:"",s=Number(document.getElementById(this._input[e]).value);s&&""!==i&&t.set(i,1.04*s*o.e)}t.size===this._NumberOfInputs?(this._ports.setShowRadiusSetting("position"),this._ports.portData=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>t.has(e.name)).map(e=>(e.distance=t.get(e.name),e)))),this._ports.update(),this._showAndGoToPosition()):new n.a("Get position","Not enough data.")}_positionSelected(){this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId)),this._modal$.modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}}}).call(this,i("xeH2"))},"2ISq":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"2beG":function(t,e,i){t.exports=i.p+"images/flags/PRa.svg"},"4PeS":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return o}));i("3XUK"),i("9q+R");var s=i("PVJp"),a=i("Av7d");class o{constructor(e,i){this._title=e,this._text=i,this._setupDiv(),this._set(e,i),t(this._toast.node()).toast({autohide:!1}).toast("show"),window.setTimeout(this._remove.bind(this),1e4)}_setupDiv(){this._mainDiv=Object(s.a)("#toast-column")}_set(){this._toast=this._mainDiv.append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true");const t=this._toast.append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",a.z).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(this._title),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),this._toast.append("div").attr("class","toast-body").html(this._text)}_remove(){this._toast.remove()}}}).call(this,i("xeH2"))},"4aJ5":function(t,e,i){t.exports=i.p+"images/flags/US.svg"},"62GW":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return h}));i("3XUK"),i("Peo2");var s=i("PVJp"),a=i("NBGV"),o=i("TiKg"),r=i.n(o),n=(i("YmdP"),i("W/Hz"),i("8sDi"),i("cRa1"),i("+NlM"),i("kCRU"),i("0lY5")),d=i("f4w0"),l=i("Av7d");class h{constructor(){this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._timeGroupId="input-group-"+this._baseId,this._timeInputId="input-"+this._baseId,this._setupSvg(),this._setupArrow(),this._setupListener()}_setupSvg(){this._svg=Object(s.a)("#wind svg")}_setupArrow(){const t=this._windArrowWidth,e=2*this._windArrowWidth;Object(s.a)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d","M0,-"+t+"L"+e+",0L0,"+t).attr("class","wind-predict-arrow-head")}_navbarClick(t){Object(d.b)("Menu",this._baseName),t.stopPropagation(),this._windSelected()}_setupListener(){document.getElementById(""+this._buttonId).addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const{_getTooltipPos:e}=t.fn.roundSlider.prototype;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>Object(n.k)(t.value)+"<br>"+t.value+"°",t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/n.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})}_injectModal(){r.a.locale("en-gb"),Object(l.C)(this._modalId,this._baseName,"sm");const e=Object(s.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId),i=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);i.append("label").attr("for",this._sliderId).text("Current in-game wind"),i.append("div").attr("id",this._sliderId).attr("class","rslider");const a=e.append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");a.append("label").attr("for",this._timeInputId).text("Predict time (server time)");const o=a.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest");o.append("input").classed("form-control datetimepicker-input",!0).attr("type","text").attr("id",this._timeInputId).attr("data-target","#"+this._timeGroupId).attr("aria-label",this._timeGroupId).attr("required",""),o.append("div").classed("input-group-append",!0).attr("data-target","#"+this._timeGroupId).attr("data-toggle","datetimepicker").append("span").attr("class","input-group-text").append("i").attr("class","icon icon-clock"),t("#"+this._timeGroupId).datetimepicker({defaultDate:r.a.utc(),format:"LT"})}_initModal(){this._injectModal(),this._setupWindInput()}_windSelected(){document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_useUserInput(){const e=Object(n.E)(this._sliderId),i=t("#"+this._timeInputId).val().trim();this._predictWind(e,i)}_predictWind(t,e){r.a.locale("en-gb");let i;const s=/(\d+)[\s.:](\d+)/.exec(e),a=parseInt(s[1],10),o=parseInt(s[2],10);i=Number.isNaN(Number(t))?Object(n.e)(t):Number(t);const d=r()().utc().seconds(0).milliseconds(0),h=r()(d).hour(a).minutes(o);h.isBefore(d)&&h.add(1,"day");const c=h.diff(d,"seconds"),p=360+(i-l.s*c)%360;this._printPredictedWind(p,h.format("H.mm"),Object(n.h)(t),d.format("H.mm"))}_printCompass(t){const e=Object(a.a)(),i=Math.min(this._height/1.4,this._width/1.4)/2,s=this._width/2,o=this._height/2.8,r=Object(n.i)(t),d=.6*i,l=d*Math.cos(r),h=d*Math.sin(r),c=[[Math.round(s+l),Math.round(o+h)],[Math.round(s-l),Math.round(o-h)]];this._svg.attr("height",this._height).attr("width",this._width);const p=this._svg.append("svg").attr("class","compass").attr("x",s).attr("y",o);Object(n.H)({element:p,radius:i}),this._svg.append("path").datum(c).attr("d",e).attr("marker-end","url(#wind-arrow)")}_printText(t,e,i,s){const a=Object(n.h)(t),o=parseInt(window.getComputedStyle(document.getElementById("wind")).getPropertyValue("line-height"),10),r=this._svg.append("svg"),d=r.append("text").attr("x","50%").attr("y","33%").html("From "+Object(n.l)(a,!0)+" at "+e),l=r.append("text").attr("x","50%").attr("y","66%").attr("class","text-light-separation").html("Currently at "+s+" from "+Object(n.l)(i,!0)),h=d.node().getBoundingClientRect(),c=l.node().getBoundingClientRect(),p=2*Math.max(h.height,c.height)+o,_=Math.max(h.width,c.width)+o;r.attr("x",(this._width-_)/2).attr("y","72%").attr("height",p).attr("width",_)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,e,i,s){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,i,s),this._addBackground()}setPosition(t,e){this._svg.style("margin-left",e+"px").style("margin-top",t+"px")}clearMap(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)}}}).call(this,i("xeH2"))},"8gAj":function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return b}));i("kypl"),i("9UJh"),i("aZFp"),i("U00V"),i("3XUK"),i("Peo2");var s=i("NsF1"),a=i("lpOn"),o=i("Tj8s"),r=i("OQCi"),n=i("PVJp"),d=i("XGRO"),l=i("NBGV"),h=i("NRFW"),c=i("TiKg"),p=i.n(c),_=(i("YmdP"),i("W/Hz"),i("8sDi"),i("cRa1"),i("f4w0")),u=i("Av7d"),m=i("0lY5"),g=i("iSiJ");function f(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}class b{constructor(t){this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(l.a)().x(t=>t[0]).y(t=>t[1]),this._labelPadding=20,this._degreesPerMinute=u.s/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(r.a)().domain(Object(a.a)(0,u.t,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-"+this._baseId,this._compassId="compass-"+this._baseId,this._deleteLastLegButtonId="button-delete-leg-"+this._baseId,this._modalId="modal-"+this._baseId,this._sliderId="slider-"+this._baseId,this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}_setupDrag(){this._drag=Object(o.a)().on("start",(t,e,i)=>{this._removeLabels(),Object(n.a)(i[e]).classed("drag-active",!0)}).on("drag",(t,e,i)=>{0===e&&this._compass.attr("x",t.position[0]+d.c.dx).attr("y",t.position[1]+d.c.dy),Object(n.a)(i[e]).attr("cx",d.c.x).attr("cy",d.c.y),t.position=[t.position[0]+d.c.dx,t.position[1]+d.c.dy],this._printLines()}).on("end",(t,e,i)=>{Object(n.a)(i[e]).classed("drag-active",!1),this._printJourney()})}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(n.a)("#na-svg").insert("g","g.pb").attr("class","journey"),Object(n.a)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d","M0,-"+t+"L"+e+",0L0,"+t)}_initJourneyData(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segment:[{position:[null,null],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(t){Object(_.b)("Menu","Journey"),t.stopPropagation(),this._journeySelected()}_setupListener(){document.getElementById(""+this._buttonId).addEventListener("mouseup",t=>this._navbarClick(t)),document.getElementById(this._deleteLastLegButtonId).addEventListener("mouseup",()=>this._deleteLastLeg())}_setupWindInput(){const{_getTooltipPos:e}=t.fn.roundSlider.prototype;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>Object(m.k)(t.value)+"<br>"+t.value+"°",t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/m.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})}_injectModal(){Object(u.C)(this._modalId,this._baseName,"sm");const t=Object(n.a)("#"+this._modalId+" .modal-body").append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i=this._shipId+"-Base-select",s=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");s.append("label").attr("for",i).text("Ship (optional)"),s.append("select").attr("name",i).attr("id",i)}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new g.a(this._shipId),this._shipCompare.CompareShipsInit()}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segment[0].position[0],e=this._journey.segment[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e).call(this._drag),this._compassG=this._compass.append("g"),Object(m.H)({element:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const i=(u.t-t+e)%u.t;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*u.M}_getStartWind(){const e=t("#"+this._sliderId),i=Number(e.roundSlider("getValue"));return e.length?i:0}_setShipSpeed(){let t=[];this._journey.shipName===this._defaultShipName?t=f(new Array(24).fill(this._defaultShipSpeed/2)):({speedDegrees:t}=this._shipCompare._singleShipData),this._speedScale.range(t)}_calculateMinutesForSegment(t,e,i){let s=i,a=e,o=0;for(this._setShipSpeed();s>0;){const e=this._calculateDistanceForSection(t,a);s>e?(s-=e,o+=1):(o+=s/e,s=0),a=(u.t+a-this._degreesPerMinute)%u.t}return this._journey.currentWindDegrees=a,o}_setShipName(){this._shipCompare&&this._shipCompare._singleShipData&&this._shipCompare._singleShipData.name?this._journey.shipName=""+this._shipCompare._singleShipData.name:this._journey.shipName=this._defaultShipName}_removeLabels(){const t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(h.c)(Object(n.a)("#na-svg").node()),e=Math.max(1,t.k),i=this._fontSize/e,s=h.b.translate(20/e,20/e),a=this._labelPadding/e,o=10/e,r=5/e;this._g.selectAll("g.journey g.label").each((t,e,r)=>{const d=Object(n.a)(r[e]),l=d.select("text"),h=t.label.split("|"),c=1.3*i;l.text("").attr("dy",0).attr("transform",s).style("font-size",i+"px"),h.forEach((t,e)=>{const i=l.append("tspan").html(t);e>0&&i.attr("x",0).attr("dy",c)});const p=l.node().getBBox(),_=t.label?p.width+2*a:0,u=t.label?p.height+a:0;d.select("rect").attr("width",_).attr("height",u);const m=d.select("circle").attr("r",o).attr("class","");d.append(()=>m.remove().node()),0===e&&m.attr("r",4*o).attr("class","drag-hidden"),e===r.length-1&&m.attr("r",o).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",r+"px"),this._compassG&&this._compassG.attr("transform","scale("+1/e+")")}_printLabels(){const t=Object(s.c)().padding(this._labelPadding).value(t=>{const e=t.label.split("|"),i=e.reduce((t,e,i,s)=>s[t].length>e.length?t:i,0);return e[i]}),e=Object(s.a)(),i=Object(s.b)(e).size((t,e,i)=>{const s=t.label.split("|").length,a=i[e].getElementsByTagName("text")[0].getBBox();return[a.width+2*this._labelPadding,a.height*s+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segment.map(t=>t)).call(i)}_setupSummary(){this._divJourneySummary=Object(n.a)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(n.a)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html("From "+Object(m.l)(this._journey.startWindDegrees))}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segment.length>1?this._journey.segment.map(t=>t.position):[[null,null]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)}_getTextDirection(t,e,i){return Object(m.l)(t,!0)+" ⁖ F11: "+Object(m.q)(Object(u.o)(i.x,i.y))+" / "+Object(m.q)(Object(u.p)(i.x,i.y))}static _pluralize(t,e){return t+" "+e+(1===t?"":"s")}_getTextDistance(t,e,i){function s(t){p.a.locale("en-gb");const e=Math.floor(t/60),i=Math.round(t%60);let s="in ";if(t<1)s+="less than a minute";else{const t=0===e?"":b._pluralize(e,"hour");s+=t+(""===t?"":" ")+(0===i?"":b._pluralize(i,"minute"))}return s}let a=Math.round(t)+" k "+s(e);return i&&(a+=" ⁖ total "+Math.round(this._journey.totalDistance)+" k "+s(this._journey.totalMinutes)),a}_setSegmentLabel(t=this._journey.segment.length-1){const e={x:this._journey.segment[t].position[0],y:this._journey.segment[t].position[1]},i={x:this._journey.segment[t-1].position[0],y:this._journey.segment[t-1].position[1]},s=Object(m.K)(e,i),a=Object(u.v)(e,i),o=Object(m.h)(s),r=this._calculateMinutesForSegment(s,this._journey.currentWindDegrees,1e3*a);this._journey.totalDistance+=a,this._journey.totalMinutes+=r;const n=this._getTextDirection(o,s,e),d=this._getTextDistance(a,r,t>1);this._journey.segment[t].label=n+"|"+d}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData(),this._journey.segment.forEach((t,e)=>{e<this._journey.segment.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segment.pop(),this._journey.segment.length?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top",t+"px").style("right",e+"px")}plotCourse(t,e){this._journey.segment[0].position[0]?(this._journey.segment.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segment[0]={position:[t,e],label:""},this._initJourney())}transform(t){this._g.attr("transform",t),this._correctJourney()}}}).call(this,i("xeH2"))},"8kDF":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"8niD":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 486.86 480'%3E%3Cpath d='M410.06 46.63L279.78 218.06v2.74l207.08-27.43v93.26l-207.08-24.68v2.74l131.65 164.57-86.4 49.37-82.29-192H240L150.86 480l-78.17-49.37 130.29-167.32v-2.74l-203 26.06v-93.26l201.6 26.06v-2.74L72.69 49.37l83.66-48 85 190.63h2.75L327.77 0z' fill='%23d2ccc2'/%3E%3C/svg%3E"},"98Ys":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},Fg8x:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},FmV8:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return g}));i("kypl"),i("KcJv"),i("wCa+"),i("FdtR"),i("y89P"),i("U00V"),i("3XUK"),i("/1Gu");var s=i("ED/D"),a=i("qKAC"),o=i("8RCj"),r=i("OQCi"),n=i("CZaE"),d=i("PVJp"),l=i("TiKg"),h=i.n(l),c=(i("YmdP"),i("Av7d")),p=i("0lY5"),_=i("NO11"),u=i("iJ1D"),m=i("1qWw");class g{constructor(t){this._map=t,this._serverName=this._map.serverName,this._minScale=this._map._minScale,this._scale=this._minScale,this.f11=this._map._f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this._currentPort={id:"366",coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=c.r,this._circleSize=c.q,this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","county","points","position","tax","net","off"],this._cookie=new _.a({id:this._baseId,values:this._radioButtonValues}),this._radios=new u.a(this._baseId,this._radioButtonValues),this.showRadius=this._getShowRadiusSetting(),this._trilateratePosition=new m.a(this)}async init(){await this._loadAndSetupData()}_setupData(t){const e=t.ports.map(e=>{const i=t.server.find(t=>t.id===e.id),s=t.pb.ports.find(t=>t.id===e.id),a=Object.assign({},e,{},i,{},s);return["dropsTrading","consumesTrading","producesNonTrading","dropsNonTrading"].forEach(t=>{a[t]||delete a[t]}),a});this._portDataDefault=e,this._portData=e,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:this._serverName+"-ports.json",name:"server"},{fileName:this._serverName+"-pb.json",name:"pb"}],e={},s=async t=>{var i,s=!0,a=!1;try{for(var o,r,n=function(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}(t);s=(o=await n.next()).done,r=await o.value,!s;s=!0){const t=r;e[t.name]=await(await fetch("data/"+t.fileName)).json()}}catch(t){a=!0,i=t}finally{try{s||null==n.return||await n.return()}finally{if(a)throw i}}};try{return e.ports=(await i.e(9).then(i.t.bind(null,"3rAh",3))).default,await s(t),e}catch(t){Object(p.J)(t)}}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){this._portRadius=Object(r.a)(),this._attackRadius=Object(r.a)().domain([0,1]),this._colourScaleHostility=Object(r.a)().domain([0,1]).range([c.l,c.j]).interpolate(o.a),this._colourScaleCounty=Object(n.a)().range(c.h),this._minTaxIncome=Object(s.a)(this._portData,t=>t.taxIncome),this._maxTaxIncome=Object(a.a)(this._portData,t=>t.taxIncome),this._colourScaleTax=Object(r.a)().domain([this._minTaxIncome,this._maxTaxIncome]).range([c.l,c.f]).interpolate(o.a),this._minNetIncome=Object(s.a)(this._portData,t=>t.netIncome),this._maxNetIncome=Object(a.a)(this._portData,t=>t.netIncome),this._colourScaleNet=Object(r.a)().domain([this._minNetIncome,this._minNetIncome/50,0,this._maxNetIncome/50,this._maxNetIncome]).range([c.j,c.k,c.l,c.g,c.f]).interpolate(o.a),this._minPortPoints=Object(s.a)(this._portData,t=>t.portPoints),this._maxPortPoints=Object(a.a)(this._portData,t=>t.portPoints),this._colourScalePoints=Object(r.a)().domain([this._minPortPoints,this._maxPortPoints]).range([c.l,c.f]).interpolate(o.a)}_setupListener(){document.getElementById("show-radius").addEventListener("change",()=>this._showRadiusSelected())}_getShowRadiusSetting(){let t=this._cookie.get();return"position"===t&&([t]=this._radioButtonValues,this._cookie.set(t)),this._radios.set(t),t}_showRadiusSelected(){this.showRadius=this._radios.get(),this._cookie.set(this.showRadius),this.update()}_setupSvg(){this._gPort=Object(d.a)("#na-svg").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"),this._gRegion=this._gPort.append("g").attr("class","region"),this._gCounty=this._gPort.append("g").attr("class","county"),this._gPortCircle=this._gPort.append("g").attr("data-ui-component","port-circles"),this._gIcon=this._gPort.append("g").attr("class","port"),this._gText=this._gPort.append("g").attr("class","port-names")}_setupCounties(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Cuidad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}];const t={x:this._map.coord.max/2,y:this._map.coord.max/2};this._countyPolygon=this._countyPolygon.sort((e,i)=>{const s={x:e.centroid[0],y:e.centroid[1]},a={x:i.centroid[0],y:i.centroid[1]};return Object(p.m)(t,s)-Object(p.m)(t,a)}),this._colourScaleCounty.domain(this._countyPolygon.map(t=>t.name))}_setupRegions(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]}_setupSummary(){this._divPortSummary=Object(d.a)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind"),this._portSummaryNumPorts=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").attr("class","summary-des").html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").attr("class","summary-des").html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").attr("class","summary-des").html("net<br>income")}static _importAll(t){const e={};return t.keys().forEach(i=>{e[i.replace("./","").replace(".svg","")]=t(i)}),e}_setupFlags(){this._nationIcons=g._importAll(i("wd6v"));const t=Object(d.a)("#na-svg defs");c.E.map(t=>t.short).forEach(e=>{if(t.append("pattern").attr("id",e).attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+this._iconSize+" "+.75*this._iconSize).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e].replace('"',"").replace('"',"")),"FT"!==e){const i=t.append("pattern").attr("id",e+"c").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+this._iconSize+" "+.75*this._iconSize);i.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[""+e].replace('"',"").replace('"',"")),i.append("circle").attr("cx",this._iconSize/2).attr("cy",this._iconSize/2).attr("r",16)}if("NT"!==e&&"FT"!==e){t.append("pattern").attr("id",e+"a").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+this._iconSize+" "+.75*this._iconSize).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e+"a"].replace('"',"").replace('"',""));const i=t.append("pattern").attr("id",e+"ca").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+this._iconSize+" "+.75*this._iconSize);i.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e+"a"].replace('"',"").replace('"',"")),i.append("circle").attr("cx",this._iconSize/2).attr("cy",this._iconSize/2).attr("r",16)}})}_getPortName(t){return t?this._portDataDefault.find(e=>e.id===t).name:""}_getText(t,e){h.a.locale("en-gb");const i=h.a.utc(e.portBattle).local(),s=h.a.utc(e.portBattle),a=s===i?"":" ("+i.format("H.mm")+" local)",o=e.portBattleStartTime?(e.portBattleStartTime+10)%24+".00 – "+(e.portBattleStartTime+13)%24+".00":"11.00 – 8.00",r=s.isAfter(h.a.utc())?"s":"ed",n=Object(p.j)(e.attackerClan)+" ("+e.attackerNation+") attack"+(e.portBattle.length?r+" "+s.fromNow()+" at "+s.format("H.mm")+a:"s: "+Object(p.x)(e.attackHostility)+" hostility"),d={name:e.name,icon:e.nation,availableForAll:e.availableForAll?"(accessible to all nations)":"",depth:e.shallow?"Shallow":"Deep",county:(""===e.county?"":e.county+" / ")+e.region,countyCapital:e.countyCapital?" (county capital)":"",nonCapturable:e.nonCapturable,captured:e.capturer?" captured by "+Object(p.j)(e.capturer)+" "+h.a.utc(e.lastPortBattle).fromNow():"",lastPortBattle:e.lastPortBattle,attack:e.attackHostility?n:"",pbTimeRange:e.nonCapturable?"":o,brLimit:Object(p.u)(e.brLimit),portPoints:Object(p.u)(e.portPoints),conquestMarksPension:e.conquestMarksPension,taxIncome:Object(p.z)(e.taxIncome),portTax:Object(p.x)(e.portTax),netIncome:Object(p.z)(e.netIncome),tradingCompany:e.tradingCompany?", trading company level "+e.tradingCompany:"",laborHoursDiscount:e.laborHoursDiscount?", labor hours discount level "+e.laborHoursDiscount:"",dropsTrading:e.dropsTrading?e.dropsTrading.join(", "):"",consumesTrading:e.consumesTrading?e.consumesTrading.join(", "):"",producesNonTrading:e.producesNonTrading?e.producesNonTrading.join(", "):"",dropsNonTrading:e.dropsNonTrading?e.dropsNonTrading.join(", "):"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:e.goodsToSellInTradePort?e.goodsToSellInTradePort.join(", "):"",goodsToBuyInTradePort:e.goodsToBuyInTradePort?e.goodsToBuyInTradePort.join(", "):""};switch(e.portBattleType){case"Large":d.pbType=Object(p.D)(1);break;case"Medium":d.pbType=Object(p.D)(4);break;default:d.pbType=Object(p.D)(6)}return d}_tooltipData(t){let e='<div class="d-flex align-items-baseline mb-1">';return e+='<img alt="'+t.icon+'" class="flag-icon align-self-stretch" src="'+this._nationIcons[t.icon].replace('"',"").replace('"',"")+'"/>',e+='<div class="port-name">'+t.name+"</div>",e+="<div> "+t.county+" "+t.availableForAll+"</div>",e+="</div>",t.attack.length&&(e+='<div class="alert alert-danger mt-2" role="alert">'+t.attack+"</div>"),e+="<p>"+t.depth+" water port "+t.countyCapital+t.captured+"<br>",t.nonCapturable?(e+="Not capturable",e+="<br>"+t.portTax+" tax"):(e+="Port battle "+t.pbTimeRange+", "+t.brLimit+' <span class="caps">BR</span>, ',e+=t.pbType+' rate <span class="caps">AI</span>, ',e+=t.conquestMarksPension+" conquest point",e+=t.conquestMarksPension>1?"s":"",e+=", "+t.portPoints+" port points",e+="<br>Tax income "+t.taxIncome+" ("+t.portTax+"), net income "+t.netIncome,e+=t.tradingCompany,e+=t.laborHoursDiscount),e+="</p>",e+="<table class='table table-sm'>",t.producesNonTrading.length&&(e+="<tr><td class='pl-0'>Produces </td><td>",e+='<span class="non-trading">'+t.producesNonTrading+"</span>",e+="</td></tr>"),(t.dropsTrading.length||t.dropsNonTrading.length)&&(e+="<tr><td class='pl-0'>Drops "+(t.dropsNonTrading.length?" ":"")+"</td><td>",t.dropsNonTrading.length&&(e+='<span class="non-trading">'+t.dropsNonTrading+"</span>",t.dropsTrading.length&&(e+="<br>")),t.dropsTrading.length&&(e+=""+t.dropsTrading),e+="</td></tr>"),t.consumesTrading.length&&(e+="<tr><td class='pl-0'>Consumes </td><td>",e+=t.consumesTrading,e+="</td></tr>"),"tradePorts"===this.showRadius&&(t.goodsToSellInTradePort.length&&(e+="<tr><td class='pl-0'>Sell in "+t.tradePort+" </td><td>"+t.goodsToSellInTradePort+"</td></tr>"),t.goodsToBuyInTradePort.length&&(e+="<tr><td class='pl-0'>Buy in "+t.tradePort+" </td><td>"+t.goodsToBuyInTradePort+"</td></tr>")),e+="</table>",e}static _getInventory(t){let e="";const i=t.inventory.filter(t=>t.buyQuantity>0).map(t=>Object(p.u)(t.buyQuantity)+" "+t.name+" @ "+Object(p.y)(t.buyPrice)).join("<br>"),s=t.inventory.filter(t=>t.sellQuantity>0).map(t=>Object(p.u)(t.sellQuantity)+" "+t.name+" @ "+Object(p.y)(t.sellPrice)).join("<br>");return e+='<h5 class="caps">'+t.name+' <span class="small">'+t.nation+"</span></h5>",i.length&&(e+="<h6>Buy</h6>",e+=i),i.length&&s.length&&(e+="<p></p>"),s.length&&(e+="<h6>Sell</h6>",e+=s),e}_showDetails(e,i,s){t(Object(d.a)(s[i]).node()).tooltip({html:!0,placement:"auto",title:this._tooltipData(this._getText(e.id,e)),trigger:"manual",sanitize:!1}).tooltip("show"),this._map.showTrades.show&&("inventory"!==this._map.showTrades.listType&&(this._map.showTrades.listType="inventory"),this._map.showTrades.update(g._getInventory(e)))}static _hideDetails(e,i,s){t(Object(d.a)(s[i]).node()).tooltip("dispose")}_updateIcons(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(p.L)(this._circleSize/t),i=this._portDataFiltered;this._gIcon.selectAll("circle").data(i,t=>t.id).join(t=>t.append("circle").attr("fill",t=>{const e=(t.countyCapital&&!t.nonCapturable?"c":"")+(t.availableForAll&&"NT"!==t.nation?"a":"");return"url(#"+t.nation+e+")"}).attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1]).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",g._hideDetails)).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(p.L)(this._circleSize/t*this._minRadiusFactor),i=Object(p.L)(this._circleSize/t*this._maxRadiusFactor);let s=this._portDataFiltered,a=()=>{},o=()=>{},r=()=>{};"tax"===this.showRadius?(s=this._portDataFiltered.filter(t=>!t.nonCapturable),this._portRadius.domain([this._minTaxIncome,this._maxTaxIncome]).range([e,i]),a=()=>"bubble",r=t=>this._colourScaleTax(t.taxIncome),o=t=>this._portRadius(t.taxIncome)):"net"===this.showRadius?(s=this._portDataFiltered.filter(t=>!t.nonCapturable),this._portRadius.domain([this._minNetIncome,this._maxNetIncome]).range([e,i]),a=()=>"bubble",r=t=>this._colourScaleNet(t.netIncome),o=t=>this._portRadius(Math.abs(t.netIncome))):"points"===this.showRadius?(s=this._portDataFiltered.filter(t=>!t.nonCapturable),this._portRadius.domain([this._minPortPoints,this._maxPortPoints]).range([e,i/2]),a=()=>"bubble",r=t=>this._colourScalePoints(t.portPoints),o=t=>this._portRadius(t.portPoints)):"position"===this.showRadius?(a=()=>"bubble here",o=t=>t.distance):"attack"===this.showRadius?(s=this._portDataFiltered.filter(t=>t.attackHostility),this._attackRadius.range([e,i/1.5]),a=()=>"bubble",r=t=>"Neutral"===t.attackerNation?c.i:this._colourScaleHostility(t.attackHostility),o=t=>this._attackRadius(t.attackHostility)):"currentGood"===this.circleType?(a=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"county"===this.showRadius?(a=t=>t.nonCapturable?"bubble not-capturable":t.countyCapital?"bubble capital":"bubble non-capital",r=t=>t.nonCapturable?"":this._colourScaleCounty(t.county),o=t=>t.nonCapturable?i/3:i/2):"tradePorts"===this.showRadius?(a=t=>"bubble "+this._getTradePortMarker(t),o=t=>t.id===this.tradePortId?i:i/2):"frontline"===this.showRadius?(a=t=>"bubble "+this._getFrontlineMarker(t),o=t=>t.ownPort?i/3:i/2,s=s.filter(t=>t.enemyPort||t.ownPort)):"currentGood"===this.showRadius?(a=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"off"===this.showRadius&&(s=[]),this._gPortCircle.selectAll("circle").data(s,t=>t.id).join(t=>t.append("circle").attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1])).attr("class",t=>a(t)).attr("r",t=>o(t)).attr("fill",t=>r(t))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(p.i)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const s=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+s;const a=t.angle>90&&t.angle<270?i:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(p.i)(t.angle)))+a:t.coordinates[1]+s}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.textAnchor:"middle"}updateTexts(){if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(p.L)(this._circleSize/t),i=2**Math.log2(.9*(Math.abs(this._minScale)+this._scale)),s=Object(p.L)(this._fontSize/i);this._gText.selectAll("text").data(this._portDataFiltered,t=>t.id).join(t=>t.append("text").text(t=>t.name)).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,s)).attr("text-anchor",t=>this._updateTextsAnchor(t)),this._gText.attr("font-size",s+"px").classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this._portData).length;let e=0,i=0;t&&(e=this._portData.map(t=>t.taxIncome).reduce((t,e)=>t+e),i=this._portData.map(t=>t.netIncome).reduce((t,e)=>t+e)),this._portSummaryTextNumPorts.text(""+t),this._portSummaryTextTaxIncome.text(""+Object(p.z)(e)),this._portSummaryTextNetIncome.text(""+Object(p.z)(i))}_updateCounties(){if("portLabel"===this.zoomLevel){const t=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")").text(t=>t.name),t=>t.attr("fill",t=>"county"===this.showRadius?this._colourScaleCounty(t.name):"")),this._gCounty.classed("d-none",!1)}else this._gCounty.classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")").text(t=>t.name)),this._gRegion.classed("d-none",!1)}else this._gRegion.classed("d-none",!0)}update(t=null){this._scale=null!=t?t:this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()}_filterVisible(){"position"===this.showRadius?this._portDataFiltered=this._portData:this._portDataFiltered=this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]),this._countyPolygonFiltered=this._countyPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1]),this._regionPolygonFiltered=this._regionPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1])}setBounds(t,e){this._lowerBound=t,this._upperBound=e}set portDataDefault(t){this._portDataDefault=t}get portDataDefault(){return this._portDataDefault}set portData(t){this._portData=t}get portData(){return this._portData}set currentPort(t){this._currentPort=t}get currentPort(){return this._currentPort}set zoomLevel(t){this._zoomLevel=t}get zoomLevel(){return this._zoomLevel}_showSummary(){this._divPortSummary.classed("hidden",!1)}setShowRadiusSetting(t=this._radioButtonValues[0]){this.showRadius=t,this._radios.set(this.showRadius),this._cookie.set(this.showRadius)}transform(t){this._gPort.attr("transform",t)}clearMap(t){this._showSummary(),this._portData=this._portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)}}}).call(this,i("xeH2"))},JNxp:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return p}));i("kypl"),i("wCa+"),i("FdtR"),i("9UJh"),i("y89P"),i("U00V"),i("3XUK"),i("hSFQ"),i("/1Gu");var s=i("2b7M"),a=i("0YW8"),o=i("OQCi"),r=i("PVJp"),n=i("Av7d"),d=i("0lY5"),l=i("NO11"),h=i("iJ1D");function c(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}class p{constructor(t,e,i,s,a){this._serverName=t,this._portSelect=e,this._isDataLoaded=!1,this._minScale=i,this._scale=this._minScale,this._fontSize=n.r,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=this._baseId+"-nation-select",this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new l.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new h.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new l.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new h.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(s,a),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}_setupSvg(){this._g=Object(r.a)("#na-svg").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(r.a)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d","M0,0L0,"+this._arrowY+"L"+this._arrowX+","+this._arrowY/2+"z").attr("class","trade-arrow-head"),this._tradeDetailsDiv=Object(r.a)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const e=""+n.E.map(t=>'<option value="'+t.short+'" selected>'+t.name+"</option>").join(""),i=this._baseId+"-card";this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const s=this._tradeDetailsHead.append("label"),a=s.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText(t){let e="";return e=t===n.E.length?"All":t,e+" nations selected"},title:"Select nations"}),s.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#"+i).text("Info"),this._tradeDetailsHead.append("div").attr("id",i).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=this._profitId+"-"+e.replace(/ /g,""),s=t.append("div").attr("class","custom-control custom-radio custom-control-inline");s.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),s.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){document.getElementById(this._showId).addEventListener("change",()=>this._showSelected()),document.getElementById(this._profitId).addEventListener("change",()=>this._profitValueSelected()),this._nationSelector.addEventListener("change",t=>{this._nationChanged(),t.preventDefault()})}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map(t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}])),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map(t=>{let e=0;switch(this._profitValue){case"weight":e=p._getProfitPerWeight(t);break;case"distance":e=p._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error("Wrong profit value "+this._profitValue)}return t.profit=e,t}).sort((t,e)=>e.profit-t.profit)}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){try{const t=(await i.e(9).then(i.t.bind(null,"3rAh",3))).default,e=await(await fetch("data/"+this._serverName+"-pb.json")).json();this._linkDataDefault=await(await fetch("data/"+this._serverName+"-trades.json")).json(),this._portData=t.map(t=>{const i=e.ports.find(e=>e.id===t.id);return Object.assign({},t,{},i)})}catch(t){Object(d.J)(t)}}async _loadAndSetupData(){try{await this._loadData(),this._setupData()}catch(t){Object(d.J)(t)}}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then(()=>{this._isDataLoaded=!0}),p._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(p._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}static _getId(t){return"trade-"+t.source.id+"-"+t.good.replace(/ /g,"")+"-"+t.target.id}static _addInfo(t){return"<div><div>"+t+"</div>"}static _addDes(t){return'<div class="des">'+t+"</div></div>"}static _getDepth(t){return t?"(shallow)":"(deep)"}_getTradeLimitedData(t){const e=t.weightPerItem*t.quantity;let i="";return i+=p._addInfo(Object(d.u)(t.quantity)+" "+t.good)+p._addDes("trade"),i+=p._addInfo(""+Object(d.y)(t.profit))+p._addDes(this._profitText),i+=p._addInfo(Object(d.z)(e)+" "+(1===e?"ton":"tons"))+p._addDes("weight"),i+=p._addInfo(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+p._addDes("from "+p._getDepth(this._nodeData.get(t.source.id).isShallow)),i+=p._addInfo(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+p._addDes("to "+p._getDepth(this._nodeData.get(t.target.id).isShallow)),i+=p._addInfo(Object(d.z)(t.distance)+" k")+p._addDes("distance"),i}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return'<div class="block-block"><span>'+t+"</span>"}static _endBlock(){return"</div>"}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,s=p._getProfitPerDistance(t),a=p._getProfitPerWeight(t);let o="";return o+=p._startBlock("Trade"),o+=p._addInfo(Object(d.u)(t.quantity)+" "+t.good)+p._addDes("good"),o+=p._addInfo(""+Object(d.y)(t.source.grossPrice))+p._addDes("gross buy price"),o+=p._addInfo(""+Object(d.y)(t.target.grossPrice))+p._addDes("gross sell price"),o+=p._addInfo(Object(d.z)(e)+" "+(1===e?"ton":"tons"))+p._addDes("weight"),o+=p._endBlock(),o+=p._startBlock("Profit"),o+=p._addInfo(""+Object(d.y)(t.profitTotal))+p._addDes("total"),o+=p._addInfo(""+Object(d.y)(i))+p._addDes("profit/item"),o+=p._addInfo(""+Object(d.y)(s))+p._addDes("profit/distance"),o+=p._addInfo(""+Object(d.y)(a))+p._addDes("profit/weight"),o+=p._endBlock(),o+=p._startBlock("Route"),o+=p._addInfo(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+p._addDes("from "+p._getDepth(this._nodeData.get(t.source.id).isShallow)),o+=p._addInfo(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+p._addDes("to "+p._getDepth(this._nodeData.get(t.source.id).isShallow)),o+=p._addInfo(Object(d.z)(t.distance)+" k")+p._addDes("distance"),o+=p._endBlock(),o}_showDetails(e,i,s){const a=Object(r.a)(s[i]),o=this._getTradeFullData(e);t(a.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:o,trigger:"manual",sanitize:!1}).tooltip("show")}static _hideDetails(e,i,s){t(Object(r.a)(s[i]).node()).tooltip("dispose")}_getSiblingLinks(t,e){return this._linkDataFiltered.filter(i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t).map(t=>t.profit)}_updateGraph(){const t=(t,e)=>{const i={x:this._nodeData.get(e.source.id).x,y:this._nodeData.get(e.source.id).y},s={x:this._nodeData.get(e.target.id).x,y:this._nodeData.get(e.target.id).y},o=t?i.x:s.x,r=t?i.y:s.y,n=t?s.x:i.x,d=t?s.y:i.y;let l=Math.sqrt((n-o)**2+(d-r)**2);const h=t?0:1,c=this._getSiblingLinks(e.source.id,e.target.id);if(c.length>1){const t=Object(a.b)().domain(c).range([1,c.length]);l/=1+1/c.length*(t(e.profit)-1)}return l=Math.round(l),"M"+o+","+r+"A"+l+","+l+" 0,0,"+h+" "+n+","+d},e=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,i=Object(o.a)().range([5/this._scale,15/this._scale]).domain(Object(s.a)(this._linkDataFiltered,t=>t.profit)),r=2**Math.log2(Math.abs(this._minScale)+this._scale),n=Object(d.L)(this._fontSize/r),l=this._g.transition().duration(500);this._g.selectAll(".trade-link").data(e,t=>p._getId(t)).join(t=>t.append("path").attr("class","trade-link").attr("marker-start",t=>this._nodeData.get(t.source.id).x<this._nodeData.get(t.target.id).x?"":"url(#trade-arrow)").attr("marker-end",t=>this._nodeData.get(t.source.id).x<this._nodeData.get(t.target.id).x?"url(#trade-arrow)":"").attr("id",t=>p._getId(t)).attr("opacity",0).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",p._hideDetails).call(t=>t.transition(l).attr("opacity",1)),t=>t.attr("opacity",1),t=>t.call(t=>t.transition(l).attr("opacity",0).remove())).attr("d",e=>t(this._nodeData.get(e.source.id).x<this._nodeData.get(e.target.id).x,e)).attr("stroke-width",t=>i(t.profit)+"px"),this._labelG.attr("font-size",n+"px"),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,t=>p._getId(t)).join(t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",t=>"#"+p._getId(t)).text(t=>Object(d.u)(t.quantity)+" "+t.good).attr("opacity",0).call(t=>t.transition(l).attr("opacity",1)),t=>t.attr("opacity",1),t=>t.call(t=>t.transition(l).attr("opacity",0).remove())).attr("dy",t=>"-"+i(t.profit)/1.5+"px")}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],p._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,p._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}get listType(){return this._listType}_updateList(t=null){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t)}_updatePortList(t){this._list.html(t)}_updateTradeList(){let t;const e=e=>{t=Object(r.a)("path#"+p._getId(e)).classed("highlight",!0),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,t=>p._getId(t)).join(t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i)).html(t=>this._getTradeLimitedData(t))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]).map(t=>t.id));this._linkDataFiltered=this._linkData.filter(e=>t.has(e.source.id)||t.has(e.target.id)).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter(t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id)).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set(c(this._nationSelector.selectedOptions).map(t=>t.value));this._portDataFiltered=new Set(this._portData.filter(e=>t.has(e.nation)).map(t=>t.id))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}update(t=null){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t,e){this._lowerBound=t,this._upperBound=e}transform(t){this._g.attr("transform",t),this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}}).call(this,i("xeH2"))},NKIh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},NhBM:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},VMvF:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d2ccc2' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},aQA4:function(t,e,i){t.exports=i.p+"images/flags/USa.svg"},cAXh:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return l}));i("kypl"),i("SJSz"),i("RsBt"),i("FdtR"),i("9UJh"),i("4NM0"),i("aZFp"),i("U00V"),i("3XUK"),i("m1XM"),i("btHz");var s=i("TiKg"),a=i.n(s),o=(i("+NlM"),i("kCRU"),i("f4w0")),r=i("Av7d"),n=i("0lY5");function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}class l{constructor(t,e,i){this._ports=t,this._pbZone=e,this._map=i,this._dateFormat="D MMM",this._timeFormat="HH.00",this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.getElementById(this._frontlineAttackingNationId),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.getElementById(this._frontlineDefendingNationId),this._portNamesId="port-names-select",this._portNamesSelector=document.getElementById(this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.getElementById(this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.getElementById(this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.getElementById(this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.getElementById(this._propClanId),this._propCMId="prop-cm-select",this._propCMSelector=document.getElementById(this._propCMId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupPortSelect(),this._setupGoodSelect(),this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect(),this._setupCMSelect()}_resetOtherSelects(e){for(const i of[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector,this._propCMSelector])i===e||i===this._propClanSelector&&e===this._propNationSelector||i===this._propNationSelector&&e===this._propClanSelector||t(i).val("default").selectpicker("refresh")}async _loadData(){try{this._frontlinesData=await(await fetch("data/"+this._map.serverName+"-frontlines.json")).json()}catch(t){Object(n.J)(t)}}_setupListener(){t(this._portNamesSelector).one("show.bs.select",()=>{this._injectPortSelect()}),this._portNamesSelector.addEventListener("change",t=>{Object(o.b)("Menu","Port relations"),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()}),t(this._buyGoodsSelector).one("show.bs.select",()=>{this._injectGoodsSelect()}),this._buyGoodsSelector.addEventListener("change",t=>{Object(o.b)("Menu","Goods’ relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()}),this._inventorySelector.addEventListener("change",t=>{Object(o.b)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()}),t(this._frontlineAttackingNationSelector).one("loaded.bs.select",async()=>{await this._loadData()}),this._frontlineAttackingNationSelector.addEventListener("change",t=>{Object(o.b)("Menu","Frontlines Attack"),this._resetOtherSelects(this._frontlineAttackingNationSelector),this._frontlineAttackingNationSelected(),t.preventDefault()}),t(this._frontlineDefendingNationSelector).one("loaded.bs.select",async()=>{await this._loadData()}),this._frontlineDefendingNationSelector.addEventListener("change",t=>{Object(o.b)("Menu","Frontlines Defence"),this._resetOtherSelects(this._frontlineDefendingNationSelector),this._frontlineDefendingNationSelected(),t.preventDefault()}),this._propNationSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()}),this._propClanSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()}),this._propCMSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propCMSelector),this._CMSelected(),t.preventDefault()}),document.getElementById("menu-prop-deep").addEventListener("click",()=>this._depthSelected("deep")),document.getElementById("menu-prop-shallow").addEventListener("click",()=>this._depthSelected("shallow")),document.getElementById("menu-prop-all").addEventListener("click",()=>this._allSelected()),document.getElementById("menu-prop-non-capturable").addEventListener("click",()=>this._nonCapSelected()),document.getElementById("menu-prop-large").addEventListener("click",()=>this._portSizeSelected("Large")),document.getElementById("menu-prop-medium").addEventListener("click",()=>this._portSizeSelected("Medium")),document.getElementById("menu-prop-small").addEventListener("click",()=>this._portSizeSelected("Small")),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"icon icon-clock",date:"icon icon-calendar",up:"icon icon-chevron-top",down:"icon icon-chevron-bottom",previous:"icon icon-chevron-left",next:"icon icon-chevron-right",clear:"icon icon-clear",close:"icon icon-close"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),t("#prop-pb-range").submit(t=>{this._capturePBRange(),t.preventDefault()}),document.getElementById("menu-prop-today").addEventListener("click",()=>this._capturedToday()),document.getElementById("menu-prop-yesterday").addEventListener("click",()=>this._capturedYesterday()),document.getElementById("menu-prop-this-week").addEventListener("click",()=>this._capturedThisWeek()),document.getElementById("menu-prop-last-week").addEventListener("click",()=>this._capturedLastWeek());const e=t("#prop-from"),i=t("#prop-to");e.datetimepicker({format:this._dateFormat}),i.datetimepicker({format:this._dateFormat,useCurrent:!1}),e.on("change.datetimepicker",t=>i.datetimepicker("minDate",t.date)),i.on("change.datetimepicker",t=>e.datetimepicker("maxDate",t.date)),t("#prop-range").submit(t=>{this._captureRange(),t.preventDefault()}),Object(r.A)("selectPortNavbar")}_injectPortSelect(){const e=""+this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(n.M)(["name"])).map(t=>'<option data-subtext="'+t.nation+'" value="'+t.coord+'" data-id="'+t.id+'">'+t.name+"</option>").join("");this._portNamesSelector.insertAdjacentHTML("beforeend",e),t(this._portNamesSelector).selectpicker("refresh")}_setupPortSelect(){this._portNamesSelector.classList.add("selectpicker"),t(this._portNamesSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show port relations",virtualScroll:!0})}_injectGoodsSelect(){const e=new Set;for(const t of this._ports.portDataDefault)for(const i of["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"])if(t[i])for(const s of t[i])e.add(s);const i=""+d(e).sort().map(t=>"<option>"+t+"</option>").join("");this._buyGoodsSelector.insertAdjacentHTML("beforeend",i),t(this._buyGoodsSelector).selectpicker("refresh")}_setupGoodSelect(){this._buyGoodsSelector.classList.add("selectpicker"),t(this._buyGoodsSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show goods’ relations",virtualScroll:!0})}setupInventorySelect(e){if(!this._inventorySelector.classList.contains("selectpicker")){const e=new Set;for(const t of this._ports.portDataDefault)if(t.inventory)for(const i of t.inventory)e.add(i.name);const i=""+d(e).sort().map(t=>"<option>"+t+"</option>").join("");this._inventorySelector.insertAdjacentHTML("beforeend",i),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))}_getNationOptions(t=!0){return""+r.E.filter(e=>!(!t&&("FT"===e.short||"NT"===e.short))).sort(Object(n.M)(["name"])).map(t=>'<option value="'+t.short+'">'+t.name+"</option>").join("")}_setupFrontlinesNationSelect(){const e=this._getNationOptions(!1);this._frontlineAttackingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineAttackingNationSelector.classList.add("selectpicker"),t(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),this._frontlineDefendingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineDefendingNationSelector.classList.add("selectpicker"),t(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupNationSelect(){const e=this._getNationOptions(!0);this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupClanSelect(){const e=new Set;for(const t of this._ports.portData.filter(t=>t.capturer))e.add(t.capturer);this._propClanSelector.innerHTML="";let i="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,i=""+d(e).sort().map(t=>'<option value="'+t+'" class="caps">'+t+"</option>").join("")),this._propClanSelector.insertAdjacentHTML("beforeend",i),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupCMSelect(){const e=new Set;for(const t of this._ports.portData)e.add(t.conquestMarksPension);const i=""+d(e).sort().map(t=>'<option value="'+t+'">'+t+"</option>").join("");this._propCMSelector.insertAdjacentHTML("beforeend",i),this._propCMSelector.classList.add("selectpicker"),t(this._propCMSelector).selectpicker()}_setTradePortPartners(){const t=this._ports.portDataDefault.find(t=>t.id===this._ports.tradePortId),e=t.consumesTrading?t.consumesTrading.map(t=>t):[],i=t.dropsTrading?t.dropsTrading.map(t=>t):[];this._ports.portData=this._ports.portDataDefault.map(t=>(t.goodsToBuyInTradePort=t.consumesTrading?t.consumesTrading.filter(t=>i.includes(t)).map(t=>t):[],t.buyInTradePort=Boolean(t.goodsToBuyInTradePort.length),t.goodsToSellInTradePort=t.dropsTrading?t.dropsTrading.filter(t=>e.includes(t)).map(t=>t):[],t.sellInTradePort=Boolean(t.goodsToSellInTradePort.length),t)).filter(t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort)}_portSelected(){const t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),i=Number(t.getAttribute("data-id"));this._ports.currentPort={id:i,coord:{x:Number(e[0]),y:Number(e[1])}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone._showPBZones&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update(),this._ports._map.initialZoomAndPan()}_goodSelected(){const t=this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value,e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>e.dropsTrading&&e.dropsTrading.some(e=>e===t)||e.dropsNonTrading&&e.dropsNonTrading.some(e=>e===t)||e.producesNonTrading&&e.producesNonTrading.some(e=>e===t)))).map(t=>(t.isSource=!0,t)),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>e.consumesTrading&&e.consumesTrading.some(e=>e===t)))).map(t=>(t.isSource=!1,t));this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(i),this._ports.showRadius="currentGood",this._ports.update()}inventorySelected(){this.isInventorySelected=!0;const t=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,e=new Map,i=new Map,s=this._ports.portDataDefault.filter(e=>e.inventory&&e.inventory.some(e=>e.name===t)).sort(Object(n.M)(["name"])).map(s=>{const a=s.inventory.find(e=>e.name===t);return s.sellInTradePort=a.buyQuantity>0,s.sellInTradePort&&e.set(s.name,{name:s.name,nation:s.nation,good:a}),s.buyInTradePort=a.sellQuantity>0,s.buyInTradePort&&i.set(s.name,{name:s.name,nation:s.nation,good:a}),s});this._ports.setShowRadiusSetting("off"),this._ports.portData=s,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{let s="";if(s+="<h5>"+t+"</h5>",e.size){s+="<h6>Buy</h6>";for(const t of e)s+=t.name+' <span class="caps">'+t.nation+"</span>: "+Object(n.u)(t.good.buyQuantity)+" @ "+Object(n.y)(t.good.buyPrice)+"<br>"}if(e&&i&&(s+="<p></p>"),i.size){s+="<h6>Sell</h6>";for(const t of i)s+=t.name+' <span class="caps">'+t.nation+"</span>: "+Object(n.u)(t.good.sellQuantity)+" @ "+Object(n.y)(t.good.sellPrice)+"<br>"}return s})()),this._ports.update()}_setFrontlinePorts(t,e){const i=new Set(this._frontlinesData[t][e].map(t=>Number(t.key))),s=new Set(this._frontlinesData[t][e].flatMap(t=>t.value.map(t=>t)));this._ports.portData=this._ports.portDataDefault.map(t=>(t.enemyPort=i.has(t.id),t.ownPort=s.has(t.id),t))}_frontlineAttackingNationSelected(){const t=this._frontlineAttackingNationSelector.options[this._frontlineAttackingNationSelector.selectedIndex].value;this._setFrontlinePorts("attacking",t),this._ports.showRadius="frontline",this._ports.update()}_frontlineDefendingNationSelected(){const t=this._frontlineDefendingNationSelector.options[this._frontlineDefendingNationSelector.selectedIndex].value;this._setFrontlinePorts("defending",t),this._ports.showRadius="frontline",this._ports.update()}_nationSelected(){this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}_clanSelected(){const t=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;0!==t?this._ports.portData=this._ports.portDataDefault.filter(e=>e.capturer===t):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation)),this._ports.showRadius="",this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.shallow:!e.shallow);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.availableForAll);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_nonCapSelected(){const t=this._ports.portDataDefault.filter(t=>t.nonCapturable);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_portSizeSelected(t){const e=this._ports.portDataDefault.filter(e=>t===e.portBattleType);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_CMSelected(){const t=Number(this._propCMSelector.options[this._propCMSelector.selectedIndex].value);let e;e=0===t?this._ports.portDataDefault:this._ports.portDataDefault.filter(e=>t===e.conquestMarksPension),this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_capturePBRange(){const t=Object(r.F)(r.L-2,r.L),e=24-(t.length+1),i=new Set,s=a()(document.getElementById("prop-pb-from-input").value,this._timeFormat).hour();let o=a()(document.getElementById("prop-pb-to-input").value,this._timeFormat).hour();if(!(t.includes(s)&&t.includes(o)&&s<=o)){i.add(0),o<s&&(o+=24);for(let t=s-2;t<=o-3;t+=1)i.add((t-10)%e)}const n=this._ports.portDataDefault.filter(t=>!t.nonCapturable&&"FT"!==t.nation&&i.has(t.portBattleStartTime));this._ports.portData=n,this._ports.showRadius="",this._ports.update()}_filterCaptured(t,e){const i=this._ports.portDataDefault.filter(i=>a()(i.lastPortBattle,"YYYY-MM-DD HH:mm").isBetween(t,e,null,"(]"));this._ports.portData=i,this._ports.showRadius="",this._ports.update()}_capturedToday(){const t=a.a.utc();let e=a()().utc().hour(r.L).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=a.a.utc();let e=a()().utc().hour(r.L).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=a()().utc().startOf("week"),e=t.utc().hour(r.L),i=a()(t).utc().add(7,"day").hour(r.L);this._filterCaptured(e,i)}_capturedLastWeek(){const t=a()().utc().startOf("week"),e=a()(t).utc().subtract(7,"day").hour(r.L),i=t.utc().hour(r.L);this._filterCaptured(e,i)}_captureRange(){const e=t("#prop-from").datetimepicker("viewDate"),i=t("#prop-to").datetimepicker("viewDate"),s=e.utc().hour(r.L).minute(0),a=i.utc().add(1,"day").hour(r.L).minute(0);this._filterCaptured(s,a)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}}}).call(this,i("xeH2"))},cCJq:function(t,e,i){"use strict";i.d(e,"a",(function(){return l}));var s=i("ntgT"),a=i("PVJp"),o=i("XGRO"),r=i("OQCi"),n=i("Av7d"),d=i("0lY5");class l{constructor(t){this._map=t,this._isShown="on"===this._map._showGrid,this._minCoord=this._map.coord.min,this._maxCoord=this._map.coord.max,this._height=this._map.height,this._width=this._map.width,this._defaultFontSize=this._map.rem,this._xBackgroundHeight=this._map.xGridBackgroundHeight,this._yBackgroundWidth=this._map.yGridBackgroundWidth,this._setupSvg()}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){this._xScale=Object(r.a)().clamp(!0).domain([Object(n.o)(this._minCoord,this._minCoord),Object(n.o)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord]),this._yScale=Object(r.a)().clamp(!0).domain([Object(n.p)(this._minCoord,this._minCoord),Object(n.p)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord])}_setupAxis(){const t=this._getTicks(65);this._xAxis=Object(s.a)(this._xScale).tickFormat(d.q).tickValues(t).tickSize(this._maxCoord),this._yAxis=Object(s.c)(this._yScale).tickFormat(d.q).tickValues(t).tickSize(this._maxCoord),this._svgMap=Object(a.a)("#na-svg"),this._svgXAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none"),this._gXAxis=this._svgXAxis.append("g"),this._svgYAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none"),this._gYAxis=this._svgYAxis.append("g"),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round(Object(n.p)(this._minCoord,this._minCoord)),i=Math.round(Object(n.p)(this._maxCoord,this._maxCoord)),s=(i-e)/(t-1),a=[];for(let t=s;t<i;t+=s)a.push(Math.round(t));a.push(i);const o=a.slice(0).reverse().map(t=>-t);return o.push(0),o.concat(a)}_setupXAxis(){this._gXAxis.selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),this._gXAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){this._gYAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null),this._gYAxis.selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){const t=o.c?o.c.transform.k:1,e=Object(d.L)(this._defaultFontSize/t),i=Object(d.L)(1/t),s=o.c?o.c.transform.y:0,a=s/t<this._width?s/t:0,r=-this._maxCoord-a,n=o.c?o.c.transform.x:0,l=n/t<this._height?n/t:0,h=-this._maxCoord-l;this._gXAxis.attr("font-size",e).attr("stroke-width",i).call(this._xAxis.tickPadding(r)),this._gYAxis.attr("font-size",e).attr("stroke-width",i).call(this._yAxis.tickPadding(h))}set show(t){this._isShown=t}get show(){return this._isShown}set zoomLevel(t){this._zoomLevel=t}get zoomLevel(){return this._zoomLevel}update(){let t=!1;this._isShown&&"initial"!==this.zoomLevel&&(t=!0),this._map.gridOverlay.classList.toggle("overlay-grid",t),this._map.gridOverlay.classList.toggle("overlay-no-grid",!t),this._svgXAxis.classed("d-none",!t),this._svgYAxis.classed("d-none",!t)}transform(t){this._gXAxis.attr("transform",t),this._gYAxis.attr("transform",t),this._displayAxis()}}},cRa1:function(t,e,i){},eqiN:function(t,e,i){"use strict";i.d(e,"a",(function(){return n}));i("FdtR");var s=i("PVJp"),a=i("0lY5"),o=i("NO11"),r=i("iJ1D");class n{constructor(t){this._ports=t,this._showId="show-zones",this._showValues=["pb-all","pb-single","raid-all","raid-single","off"],this._showCookie=new o.a({id:this._showId,values:this._showValues}),this._showRadios=new r.a(this._showId,this._showValues),this._showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(s.a)("#na-svg").insert("g","#ports").attr("class","pb")}async _loadData(){try{this._pbZonesDefault=(await i.e(8).then(i.t.bind(null,"uFbE",3))).default}catch(t){Object(a.J)(t)}}_setupListener(){document.getElementById(this._showId).addEventListener("change",t=>{this._showPBZonesSelected(),t.preventDefault()})}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this._showPB=this._showRadios.get(),this._showCookie.set(this._showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,t=>t.id).join(t=>{const e=t.append("g").attr("class","pb-zones");e.append("path").attr("class","pb-join-circle").attr("d",t=>Object(a.n)(t.joinCircles[0],t.joinCircles[1],28).concat(Object(a.n)(t.joinCircles[0],t.joinCircles[1],14))),e.append("path").attr("class","pb-circle").attr("d",t=>t.pbCircles.map(t=>Object(a.n)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text pb-circle-text").attr("x",t=>t.pbCircles.map(t=>t[0])).attr("y",t=>t.pbCircles.map(t=>t[1])).text(t=>t.pbCircles.map((t,e)=>String.fromCharCode(65+e)).join(""))}),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,t=>t.id).join(t=>{const e=t.append("g").attr("class","raid-zones");e.append("path").attr("class","raid-join-circle").attr("d",t=>Object(a.n)(t.joinCircles[0],t.joinCircles[1],35)),e.append("path").attr("class","raid-circle").attr("d",t=>t.raidCircles.map(t=>Object(a.n)(t[0],t[1],4.5)).join("")),e.append("text").attr("class","pb-text raid-circle-text").attr("x",t=>t.raidCircles.map(t=>t[0])).attr("y",t=>t.raidCircles.map(t=>t[1])).text(t=>t.raidCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),e.append("path").attr("class","raid-point").attr("d",t=>t.raidPoints.map(t=>Object(a.n)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.raidPoints.map(t=>t[0])).attr("y",t=>t.raidPoints.map(t=>t[1])).text(t=>t.raidPoints.map((t,e)=>String.fromCharCode(49+e)).join(""))}),this._g.selectAll("g.defence").data(this._defencesFiltered,t=>t.id).join(t=>{const e=t.append("g").attr("class","defence");e.append("path").attr("class","fort").attr("d",t=>t.forts.map(t=>Object(a.p)(t[0],t[1],3)).join("")),e.append("text").attr("class","pb-text pb-fort-text").attr("x",t=>t.forts.map(t=>t[0])).attr("y",t=>t.forts.map(t=>t[1])).text(t=>t.forts.map((t,e)=>""+(e+1)).join("")),e.append("path").attr("class","tower").attr("d",t=>t.towers.map(t=>Object(a.n)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text pb-tower-text").attr("x",t=>t.towers.map(t=>t[0])).attr("y",t=>t.towers.map(t=>t[1])).text(t=>t.towers.map((t,e)=>""+(e+1)).join(""))})}_isPortIn(t){return"pb-all"===this._showPB||"raid-all"===this._showPB||("pb-single"===this._showPB||"raid-single"===this._showPB)&&Number(t.id)===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this._showPB?this._isDataLoaded?this._filterVisible():this._loadData().then(()=>{this._isDataLoaded=!0,this._filterVisible()}):(this._defencesFiltered={},this._pbZonesFiltered={},this._raidZonesFiltered={})}_filterVisible(){const t=this._pbZonesDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]).filter(t=>this._isPortIn(t));this._defencesFiltered=t.map(t=>({id:t.id,forts:t.forts,towers:t.towers})),"pb-all"===this._showPB||"pb-single"===this._showPB?(this._pbZonesFiltered=t.map(t=>({id:t.id,pbCircles:t.pbCircles,joinCircles:t.joinCircles})),this._raidZonesFiltered={}):(this._pbZonesFiltered={},this._raidZonesFiltered=t.map(t=>({id:t.id,joinCircles:t.joinCircles,raidCircles:t.raidCircles,raidPoints:t.raidPoints})))}setBounds(t,e){this._lowerBound=t,this._upperBound=e}refresh(){this._setData(),this._update()}transform(t){this._g.attr("transform",t)}}},"hAv/":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},j9j5:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return c}));i("3XUK"),i("Peo2"),i("/1Gu");var s=i("PVJp"),a=i("NBGV"),o=i("TiKg"),r=i.n(o),n=(i("YmdP"),i("W/Hz"),i("8sDi"),i("f4w0")),d=i("Av7d"),l=i("0lY5"),h=i("NO11");class c{constructor(){this._line=Object(a.a)(),this._windPath=null,this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new h.a({id:this._baseId+"-degrees",expire:this._cookieExpire}),this._cookieTime=new h.a({id:this._baseId+"-time"}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}_getHeight(){const t=document.querySelector("#port-summary .block"),{height:e,top:i}=t.getBoundingClientRect();return e-i-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))}_getCurrentWindCookie(){const t=this._cookieWindDegrees.get();if(t){const e=this._cookieTime.get(),i=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-d.s*i)%360}return t}_getExpire(){const t=r.a.utc();let e=r()().utc().hour(10).minute(0).second(0);return t.hour()>=e.hour()&&(e=e.add(1,"day")),e.local().toDate()}_storeCurrentWindCookie(){this._cookieWindDegrees.set(this._currentWindDegrees),this._cookieTime.set(Date.now())}_setupSvg(){const t=Object(s.a)("#port-summary");t.classed("port-summary-no-wind",!1).classed("port-summary-wind",!0),this._div=t.insert("div",":first-child").attr("id",this._baseId).attr("class","block p-0"),this._svg=this._div.append("svg").attr("class","ingame-wind small")}_navbarClick(t){Object(n.b)("Menu",this._baseName),t.stopPropagation(),this._windRoseSelected()}_setupListener(){document.getElementById(""+this._buttonId).addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const{_getTooltipPos:e}=t.fn.roundSlider.prototype;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>Object(l.k)(t.value)+"<br>"+t.value+"°",t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/l.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})}_injectModal(){r.a.locale("en-gb"),Object(d.C)(this._modalId,this._baseName,"sm");const t=Object(s.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")}_initModal(){this._injectModal(),this._setupWindInput()}_windRoseSelected(){document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_windChange(){this._currentWindDegrees=360+(this._currentWindDegrees-d.s*this._intervalSeconds)%360,this._updateWindDirection()}_useUserInput(){this._currentWindDegrees=Object(l.E)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval(()=>{this._windChange()},1e3*this._intervalSeconds)}_updateWindDirection(){const t=Object(l.i)(this._currentWindDegrees),e=this._length*Math.cos(t),i=this._length*Math.sin(t),s=[[Math.round(this._xCompass+e),Math.round(this._yCompass+i)],[Math.round(this._xCompass-e),Math.round(this._yCompass-i)]];this._windPath.datum(s).attr("d",this._line),this._storeCurrentWindCookie()}_initPrintCompassRose(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);const t=this._svg.append("svg").attr("class","compass").attr("x",this._xCompass).attr("y",this._yCompass);Object(l.I)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").attr("marker-end","url(#wind-arrow)")}clearMap(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=null,this._cookieWindDegrees.remove()}}}).call(this,i("xeH2"))},kuLP:function(t,e,i){t.exports=i.p+"images/flags/PR.svg"},md73:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},ogJC:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},oogA:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},q1r0:function(t,e,i){"use strict";(function(t){i.d(e,"a",(function(){return l}));i("3XUK"),i("Peo2");var s=i("PVJp"),a=i("TiKg"),o=i.n(a),r=(i("YmdP"),i("f4w0")),n=i("Av7d"),d=i("0lY5");class l{constructor(t,e){this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._xInputId="input-x-"+this._baseId,this._zInputId="input-z-"+this._baseId,this._copyButtonId="copy-coord-"+this._baseId,this._submitButtonId="submit-"+this._baseId,this._modal$=null,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(s.a)("#na-svg").append("g").classed("f11",!0)}_navbarClick(t){Object(r.b)("Menu","Go to F11"),t.stopPropagation(),this._f11Selected()}_setupListener(){document.getElementById(""+this._buttonId).addEventListener("click",t=>this._navbarClick(t)),window.addEventListener("keydown",t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick(t)})}_injectModal(){Object(n.C)(this._modalId,this._baseName,"sm");const t=Object(s.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const a=t.append("div").classed("float-right btn-group",!0).attr("role","group");a.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to"),Object(s.a)("#"+this._modalId+" .modal-footer").remove()}_initModal(){this._injectModal()}_f11Selected(){this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId),this._xInputSel=document.getElementById(this._xInputId),this._zInputSel=document.getElementById(this._zInputId),this._formSel.addEventListener("submit",t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()}),this._modal$.on("keydown",t=>{"KeyC"===t.code&&t.ctrlKey&&this._copyCoordClicked(t)}),document.getElementById(this._copyButtonId).addEventListener("click",t=>{this._copyCoordClicked(t)})),this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()}_getInputValue(t){const{value:e}=t;return""===e?1/0:Number(e)}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){Object(r.b)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this._getXCoord(),i=this._getZCoord();Object(d.f)(e,i)}_printF11Coord(t,e,i,s){let a=10;const r=this._g.append("g").attr("transform","translate("+t+","+e+")"),n=r.append("rect"),l=r.append("rect");r.append("circle").attr("r",a),a*=1.6;const h=r.append("text").attr("dx",-a+"px").attr("dy",-a/2-2+"px").attr("class","f11-coord").text(Object(d.q)(i)),c=r.append("text").attr("dx",-a+"px").attr("dy",a/2+2+"px").attr("class","f11-coord").text(Object(d.q)(s)),p=h.node().getBBox(),_=c.node().getBBox(),u=o()().utc(),m=o()(),g=r.append("text").attr("dx",a+"px").attr("dy",-a/2-2+"px").attr("class","f11-time").text(u.format("H.mm")),f=r.append("text").attr("dx",a+"px").attr("dy",a/2+2+"px").attr("class","f11-time").text("("+m.format("H.mm")+" local)"),b=g.node().getBBox(),y=f.node().getBBox(),v=1.2*Math.round(p.height+_.height),w=Math.round(Math.max(p.width,_.width)+5),S=1.2*Math.round(b.height+y.height),x=Math.round(Math.max(b.width,y.width)+5),C=Math.max(v,S);n.attr("x",-w-a).attr("y",-C/2).attr("height",C).attr("width",w+a),l.attr("x",0).attr("y",-C/2).attr("height",C).attr("width",x+a)}_goToF11(t,e){const i=Number(t),s=Number(e),a=Math.floor(Object(n.m)(i,s)),o=Math.floor(Object(n.n)(i,s));Object(d.a)(a,this._coord.min,this._coord.max,!0)&&Object(d.a)(o,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(a,o,i,s),this._map.zoomAndPan(a,o,1))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&(Object(r.b)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=Object(n.o)(t,e),s=Object(n.p)(t,e);this._printF11Coord(t,e,i,s)}transform(t){this._g.attr("transform",t)}clearMap(){this._g.selectAll("*").remove()}}}).call(this,i("xeH2"))},q3Xn:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},sZIO:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},vi22:function(t,e,i){"use strict";i.r(e),function(t){i.d(e,"Map",(function(){return S}));i("FdtR"),i("9UJh"),i("U00V"),i("3XUK"),i("Peo2");var s=i("lpOn"),a=i("XGRO"),o=i("PVJp"),r=i("vq1v"),n=i("NRFW"),d=i("f4w0"),l=i("Av7d"),h=i("0lY5"),c=i("NO11"),p=i("iJ1D"),_=i("eqiN"),u=i("FmV8"),m=i("cAXh"),g=i("q1r0"),f=i("cCJq"),b=i("8gAj"),y=i("62GW"),v=i("j9j5"),w=i("JNxp");class S{constructor(t,e){this.serverName=t,this._searchParams=e,this.rem=l.r,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:8192},this._currentTranslate={},this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new c.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new p.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new c.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new p.a(this._showGridId,this._showGridValues),this._showGrid=this._getShowGridValue(),[this.gridOverlay]=document.getElementsByClassName("overlay"),this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this._f11=new g.a(this,this.coord),this._ports=new u.a(this),await this._ports.init(),this._pbZone=new _.a(this._ports),this._grid=new f.a(this),this._journey=new b.a(this.rem),this._windPrediction=new y.a,this._windRose=new v.a,this._portSelect=new m.a(this._ports,this._pbZone,this),this.showTrades=new w.a(this.serverName,this._portSelect,this._minScale,this.coord.min,this.coord.max),await this.showTrades.showOrHide(),this._init()}static _stopProperty(){a.c.defaultPrevented&&a.c.stopPropagation()}_setupListener(){this._svg.on("dblclick.zoom",null).on("click",S._stopProperty,!0).on("dblclick",(t,e,i)=>this._doDoubleClickAction(i[e])),document.getElementById("propertyDropdown").addEventListener("click",()=>{Object(d.b)("Menu","Select port on property")}),document.getElementById("settingsDropdown").addEventListener("click",()=>{Object(d.b)("Menu","Settings")}),document.getElementById("button-download-pb-calc").addEventListener("click",()=>{Object(d.b)("Tools","Download pb calculator")}),document.getElementById("reset").addEventListener("click",()=>{this._clearMap()}),document.getElementById("about").addEventListener("click",()=>{this._showAbout()}),document.getElementById("double-click-action").addEventListener("change",()=>this._doubleClickSelected()),document.getElementById("show-grid").addEventListener("change",()=>this._showGridSelected())}_setupScale(){this._minScale=Object(h.G)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this._minScale}_setupSvg(){this._zoom=Object(n.a)().wheelDelta(()=>-this._wheelDelta*Math.sign(a.c.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this._minScale,this.coord.min-this.xGridBackgroundHeight*this._minScale],[this.coord.max,this.coord.max]]).scaleExtent([this._minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this._svg=Object(o.a)("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").classed("map",!0)}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._refreshLayer()}_refreshLayer(){this._grid.update()}_displayMap(t){const{x:e,y:i,k:a}=t,o=Math.log2(this._tileSize),r=Math.log2(this.coord.max)-o,d=this.coord.max*a,l=this.width,c=this.height,p=Math.floor(d<l?l-2*e:d),_=Math.floor(d<c?c-2*i:d),u=Math.log2(a),m=Math.min(r,Math.ceil(Math.log2(Math.max(p,_)))-o),g=Math.round(10*(m-u-r))/10,f=this._wheelDelta**g,b=this._tileSize*f,y=d<l?e:0,v=d<c?i:0,w=Object(s.a)(Math.max(0,Math.floor((0-e)/b)),Math.max(0,Math.min(Math.ceil((l-e-y)/b),2**m))),S=Object(s.a)(Math.max(0,Math.floor((0-i)/b)),Math.max(0,Math.min(Math.ceil((c-i-v)/b),2**m))),x=[];for(const t of S)for(const e of w)x.push({z:m,row:t,col:e,id:m.toString()+"-"+t.toString()+"-"+e.toString()});x.transform=n.b.translate(e,i).scale(Object(h.L)(f)),this._updateMap(x)}_updateMap(t){this._gMap.attr("transform",t.transform).selectAll("image").data(t,t=>t.id).join(t=>t.append("image").attr("xlink:href",t=>"images/map/"+t.z+"/"+t.row+"/"+t.col+".webp").attr("x",t=>t.col*this._tileSize).attr("y",t=>t.row*this._tileSize).attr("width",this._tileSize+1).attr("height",this._tileSize+1))}_clearMap(){this._windPrediction.clearMap(),this._windRose.clearMap(),this._f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}static _initModal(t){Object(l.C)(t,l.c+' <span class="text-primary small">v'+l.d+"</span>",""),Object(o.a)("#"+t+" .modal-body").html("<p>"+l.a+' Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan Bastard Sons '+Object(h.j)("(BASTD)")+"</a>.</p>")}_showAbout(){t("#modal-about").length||S._initModal("modal-about"),t("#modal-about").modal("show")}_doDoubleClickAction(t){const e=Object(r.a)(t),i=Object(n.c)(t),[s,a]=e,{k:o,x:d,y:l}=i,h=(s-d)/o,c=(a-l)/o;"f11"===this._doubleClickAction?this._f11.printCoord(h,c):this._journey.plotCourse(h,c),this.zoomAndPan(h,c,1)}_setZoomLevelAndData(){a.c.transform.k!==this._currentScale&&(this._currentScale=a.c.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)}_naZoomed(){this._currentTranslate.x=Math.floor(a.c.transform.x),this._currentTranslate.y=Math.floor(a.c.transform.y);const t=n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(h.L)(a.c.transform.k)),e=t.invert([this.coord.min,this.coord.min]),i=t.invert([this.width,this.height]);this._ports.setBounds(e,i),this._pbZone.setBounds(e,i),this.showTrades.setBounds(e,i),this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._journey.transform(t),this._pbZone.transform(t),this._f11.transform(t),this.showTrades.transform(t),this._setZoomLevelAndData()}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this._f11.goToF11FromParam(this._searchParams)}_init(){this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight()}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}get zoomLevel(){return this._zoomLevel}resize(){const t=n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update()}getDimensions(){return document.getElementsByClassName("overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight()}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){const t=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);document.getElementById("summary-column").setAttribute("style","height:"+t+"px")}initialZoomAndPan(){this._svg.call(this._zoom.scaleTo,this._minScale)}zoomAndPan(t,e,i){const s=n.b.scale(i).translate(Math.round(-t+this.width/2/i),Math.round(-e+this.height/2/i));this._svg.call(this._zoom.transform,s)}goToPort(){"0"===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)}}}.call(this,i("xeH2"))},wOMk:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},wd6v:function(t,e,i){var s={"./DE.svg":"q3Xn","./DEa.svg":"2ISq","./DK.svg":"98Ys","./DKa.svg":"8kDF","./ES.svg":"ogJC","./ESa.svg":"wOMk","./FR.svg":"0kUG","./FRa.svg":"+RFf","./FT.svg":"8niD","./GB.svg":"oogA","./GBa.svg":"1j+5","./NT.svg":"VMvF","./PL.svg":"NhBM","./PLa.svg":"Fg8x","./PR.svg":"kuLP","./PRa.svg":"2beG","./RU.svg":"xdGh","./RUa.svg":"md73","./SE.svg":"hAv/","./SEa.svg":"sZIO","./US.svg":"4aJ5","./USa.svg":"aQA4","./VP.svg":"z0Ar","./VPa.svg":"NKIh"};function a(t){var e=o(t);return i(e)}function o(t){if(!i.o(s,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return s[t]}a.keys=function(){return Object.keys(s)},a.resolve=o,t.exports=a,a.id="wd6v"},xdGh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},z0Ar:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"}}]);