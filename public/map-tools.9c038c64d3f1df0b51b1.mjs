/*! For license information please see map-tools.9c038c64d3f1df0b51b1.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[674],{8800:(t,e,i)=>{i.r(e),i.d(e,{init:()=>y});i(6801),i(7424);var s=i(4017),r=i(5049),a=(i(3223),i(2855)),d=i(9022),n=i(393),o=i(1198),h=i(7484),l=i.n(h),p=i(285),_=i.n(p),u=i(178),c=i.n(u),m=i(3609);function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}l().extend(_()),l().extend(c()),l().locale("en-gb");class v{constructor(){g(this,"_height",void 0),g(this,"_width",void 0),g(this,"_windArrowWidth",void 0),g(this,"_baseName",void 0),g(this,"_baseId",void 0),g(this,"_buttonId",void 0),g(this,"_modalId",void 0),g(this,"_formId",void 0),g(this,"_sliderId",void 0),g(this,"_timeGroupId",void 0),g(this,"_timeInputId",void 0),g(this,"_svg",void 0),this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._timeGroupId=`input-group-${this._baseId}`,this._timeInputId=`input-${this._baseId}`,this._setupSvg(),this._setupArrow(),this._setupListener()}_setupSvg(){this._svg=(0,s.Z)("#wind svg")}_setupArrow(){const t=this._windArrowWidth,e=2*this._windArrowWidth;(0,s.Z)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d",`M0,-${t}L${e},0L0,${t}`).attr("class","wind-predict-arrow-head")}_navbarClick(){(0,a.KS)("Menu",this._baseName),this._windSelected()}_setupListener(){document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(()=>{this._navbarClick()}))}_setupWindInput(){const t=m.fn.roundSlider.prototype._getTooltipPos;m.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||m("body").append(this.tooltip);const e=t.call(this);return this.container.append(this.tooltip),e},window.tooltip=t=>`${(0,o.nD)(t.value)}<br>${String(t.value)}°`,m(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/n.Tm.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){(0,d.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,s.Z)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId),e=t.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i=t.append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");i.append("label").attr("for",this._timeInputId).text("Predict time (server time)");i.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest").append("input").attr("class","form-control").attr("type","time").attr("id",this._timeInputId).attr("value",l().utc().format("HH:mm")).attr("data-target",`#${this._timeGroupId}`).attr("aria-label",this._timeGroupId).attr("required","")}_initModal(){this._injectModal(),this._setupWindInput()}_windSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),m(`#${this._modalId}`).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}_useUserInput(){const t=(0,o.tj)(this._sliderId),e=m(`#${this._timeInputId}`).val().trim();this._predictWind(t,e)}_predictWind(t,e){const i="H.mm";let s;const r=/(\d+)[\s.:](\d+)/.exec(e),a=Number.parseInt(r[1],10),o=Number.parseInt(r[2],10);s=Number.isNaN(Number(t))?(0,n.Ri)(String(t)):Number(t);const h=l()().utc().second(0).millisecond(0),p=l()(h).hour(a).minute(o);p.isBefore(h)&&p.add(1,"day");const _=p.diff(h,"second"),u=360+(s-d.er*_)%360;this._printPredictedWind(u,p.format(i),(0,n.tT)(t),h.format(i))}_printCompass(t){const e=(0,r.Z)(),i=Math.min(this._height/1.4,this._width/1.4)/2,s=this._width/2,a=this._height/2.8,d=(0,n.Ht)(t),h=.6*i,l=h*Math.cos(d),p=h*Math.sin(d),_=[[Math.round(s+l),Math.round(a+p)],[Math.round(s-l),Math.round(a-p)]];this._svg.attr("height",this._height).attr("width",this._width);const u=this._svg.append("svg").attr("class","compass").attr("x",s).attr("y",a);(0,o.$G)({element:u,radius:i}),this._svg.append("path").datum(_).attr("d",e).attr("marker-end","url(#wind-arrow)")}_printText(t,e,i,s){const r=(0,n.tT)(t),a=Number.parseInt(window.getComputedStyle(document.querySelector("#wind")).getPropertyValue("line-height"),10),d=this._svg.append("svg"),h=d.append("text").attr("x","50%").attr("y","33%").html(`From ${(0,o.Iy)(r,!0)} at ${e}`),l=d.append("text").attr("x","50%").attr("y","66%").attr("class","text-light-separation").html(`Currently at ${s} from ${(0,o.Iy)(i,!0)}`),p=h.node()?.getBoundingClientRect(),_=l.node()?.getBoundingClientRect(),u=2*Math.max(Number(p?.height),Number(_?.height))+a,c=Math.max(Number(p?.width),Number(_?.width))+a;d.attr("x",(this._width-c)/2).attr("y","72%").attr("height",u).attr("width",c)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,e,i,s){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,i,s),this._addBackground()}setPosition(t,e){this._svg.style("margin-left",`${e}px`).style("margin-top",`${t}px`)}clearMap(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)}}i(3824);var w=i(3389),b=i(3609);function I(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}l().extend(_()),l().extend(c());class ${constructor(){I(this,"_line",void 0),I(this,"_windPath",void 0),I(this,"_windArrowWidth",void 0),I(this,"_intervalSeconds",void 0),I(this,"_baseName",void 0),I(this,"_baseId",void 0),I(this,"_buttonId",void 0),I(this,"_modalId",void 0),I(this,"_formId",void 0),I(this,"_sliderId",void 0),I(this,"_cookieExpire",void 0),I(this,"_cookieWindDegrees",void 0),I(this,"_cookieTime",void 0),I(this,"_currentWindDegrees",void 0),I(this,"_height",void 0),I(this,"_yCompass",void 0),I(this,"_width",void 0),I(this,"_xCompass",void 0),I(this,"_compassRadius",void 0),I(this,"_length",void 0),I(this,"_intervalId",void 0),I(this,"_svg",void 0),I(this,"_div",void 0),this._line=(0,r.Z)().x((t=>t[0])).y((t=>t[1])),this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new w.Z({id:`${this._baseId}-degrees`,expire:this._cookieExpire}),this._cookieTime=new w.Z({id:`${this._baseId}-time`}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:e,top:i}=t.getBoundingClientRect();return e-i-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))}return 0}_getCurrentWindCookie(){const t=Number(this._cookieWindDegrees.get());if(t){const e=Number(this._cookieTime.get()),i=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-d.er*i)%360}return t}_getExpire(){const t=l().utc();let e=l()().utc().hour(10).minute(0).second(0);return t.hour()>=e.hour()&&(e=e.add(1,"day")),e.local().toDate()}_storeCurrentWindCookie(){this._cookieWindDegrees.set(String(this._currentWindDegrees)),this._cookieTime.set(String(Date.now()))}_setupSvg(){const t=(0,s.Z)("#port-summary");t.classed("port-summary-no-wind",!1).classed("port-summary-wind",!0),this._div=t.insert("div",":first-child").attr("id",this._baseId).attr("class","block p-0"),this._svg=this._div.append("svg").attr("class","ingame-wind small")}_navbarClick(){(0,a.KS)("Menu",this._baseName),this._windRoseSelected()}_setupListener(){document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(()=>{this._navbarClick()}))}_setupWindInput(){const t=b.fn.roundSlider.prototype._getTooltipPos;b.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||b("body").append(this.tooltip);const e=t.call(this);return this.container.append(this.tooltip),e},window.tooltip=t=>`${(0,o.nD)(t.value)}<br>${String(t.value)}°`,b(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/n.Tm.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){(0,d.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,s.Z)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")}_initModal(){this._injectModal(),this._setupWindInput()}_windRoseSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),b(`#${this._modalId}`).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}_windChange(){this._currentWindDegrees=360+(this._currentWindDegrees-d.er*this._intervalSeconds)%360,this._updateWindDirection()}_useUserInput(){this._currentWindDegrees=(0,o.tj)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval((()=>{this._windChange()}),1e3*this._intervalSeconds)}_updateWindDirection(){const t=(0,n.Ht)(this._currentWindDegrees),e=this._length*Math.cos(t),i=this._length*Math.sin(t),s=[[Math.round(this._xCompass+e),Math.round(this._yCompass+i)],[Math.round(this._xCompass-e),Math.round(this._yCompass-i)]];this._windPath&&(this._windPath.datum(s).attr("d",this._line),this._storeCurrentWindCookie())}_initPrintCompassRose(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);const t=this._svg.append("svg").attr("class","compass").attr("x",this._xCompass).attr("y",this._yCompass);(0,o.ec)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").attr("marker-end","url(#wind-arrow)")}clearMap(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=void 0,this._cookieWindDegrees.remove()}}const y=()=>{new v,new $}},1198:(t,e,i)=>{i.d(e,{nD:()=>n,Iy:()=>o,tj:()=>h,Fq:()=>l,xp:()=>p,$G:()=>_,ec:()=>u,Mo:()=>c,vQ:()=>m,A1:()=>g,GZ:()=>v,yb:()=>w,PN:()=>b});var s=i(1138),r=i(9022),a=i(393),d=i(3609);const n=(t,e=!1)=>{let i;return i=Number.isNaN(Number(t))?t:(0,a.tT)(Number(t)),`<${e?"tspan":"span"} class="caps">${i}</${e?"tspan":"span"}>`},o=(t,e=!1)=>{let i,s;return Number.isNaN(Number(t))?(i=t,s=(0,a.Ri)(i)%a.QF):(s=Number(t),i=(0,a.tT)(s)),`<${e?"tspan":"span"} class="caps">${i}</${e?"tspan":"span"}> (${s}°)`},h=t=>{const e=(0,a.tT)(d(`#${t}`).roundSlider("getValue"));let i;return i=Number.isNaN(Number(e))?(0,a.Ri)(e):Number(e),i},l=(t,e)=>{let i=Math.atan2(e.y-t.y,e.x-t.x);i-=Math.PI/2;let s=(0,a.vi)(i);return s<0&&(s+=a.QF),s},p=(t,e,i=!0)=>{if(e<2)return[t];const s=t.length,r=[];let a,d=0;if(s%e==0)for(a=Math.floor(s/e);d<s;)r.push(t.slice(d,d+=a));else if(i)for(;d<s;)a=Math.ceil((s-d)/e--),r.push(t.slice(d,d+=a));else{for(e-=1,a=Math.floor(s/e),s%a==0&&(a-=1);d<a*e;)r.push(t.slice(d,d+=a));r.push(t.slice(a*e))}return r},_=({element:t,radius:e})=>{const i=r.f7,d=a.QF/i,n=Math.round(.8*e),o=[...new Array(i)].map(((t,e)=>(0,a.tT)(e*d))),h=(0,s.Z)().range([0-d/2,a.QF-d/2]).domain(o).align(0);t.append("circle").attr("r",n).style("stroke-width","3px");const l=t.append("text"),p=t.selectAll("g").data(o).join((t=>t.append("g").attr("transform",(t=>`rotate(${Math.round((h(t)??0)+h.bandwidth()/2-a.bT)})translate(${n},0)`))));p.filter(((t,e)=>e%3!=0)).append("line").attr("x2",9),p.filter(((t,e)=>e%3==0)).append("text").attr("transform",(t=>{let e,i=Math.round((h(t)??0)+h.bandwidth()/2);l.text(t);const s=l.node()?.getBBox().height??0,r=l.node()?.getBBox().width??0;return i>=0&&i<=45||315===i?(i=90,e="0,-"+s/2):90===i?(i=0,e=r/2+3+",0"):270===i?(i=180,e=`-${r/2+3},0`):(i=-90,e="0,"+(s/2+3+2)),`rotate(${i})translate(${e})`})).text((t=>t)),l.remove()},u=({element:t,radius:e})=>{const i=r.f7,d=a.QF/i,n=Math.round(.8*e),o=[...new Array(i)].map(((t,e)=>(0,a.tT)(e*d))),h=(0,s.Z)().range([0-d/2,a.QF-d/2]).domain(o).align(0);t.append("circle").attr("r",n).style("stroke-width","1.5px");t.selectAll("line").data(o).join((t=>t.append("line").attr("x2",((t,e)=>e%3==0?e%6==0?6:4:2)).attr("transform",(t=>`rotate(${Math.round((h(t)??0)+h.bandwidth()/2)})translate(${n},0)`))))},c=t=>`<span class="caps">${t}</span>`,m=(t,e)=>{navigator.clipboard||((t,e)=>{if(!document.queryCommandSupported?.("copy"))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const i=document.createElement("input");i.type="text",i.value=t,i.style.position="absolute",i.style.left="-1000px",i.style.top="-1000px",e.append(i),i.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{i.remove()}}})(t,e),(async t=>{navigator.clipboard.writeText(t).then((()=>!0)).catch((e=>(console.error(`Cannot copy ${t} to clipboard`,e),!1)))})(t)},g=(t,e,i)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const s=new URL(window.location.href);s.searchParams.set("x",String(t)),s.searchParams.set("z",String(e)),m(s.href,i)}},v=(t,e,i)=>`M${t-i},${e}a${i},${i} 0 10${2*i},0a${i},${i} 0 10${2*-i},0`,w=(t,e,i)=>`M${t-i/2},${e-i/2}h${i}v${i}h${-i}z`,b=(t,e,i)=>`M${t},${e}v${i}`}}]);