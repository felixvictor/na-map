/*! For license information please see game-tools.959cd7f20c6ef1ad1687.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[639],{4361:(t,e,a)=>{a.r(e),a.d(e,{init:()=>Ce});var s=a(2855),i=a(9022),o=a(27),n=a(2619),l=(a(6801),a(7424),a(4017)),d=(a(300),a(7015)),r=a(5923),h=a(4738),c=a(3609);function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class u{constructor(){p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_buildingData",void 0),this._baseName="List buildings",this._baseId="building-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._buildingData=[],this._setupListener()}async _loadAndSetupData(){this._buildingData=(await a.e(337).then(a.t.bind(a,374,19))).default}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`).addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._buildingListSelected()}))}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName});const t=`${this._baseId}-select`,e=(0,l.Z)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_getOptions(){return`${this._buildingData.sort((0,h.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupSelect(){const t=c(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){const t=c(`#${this._baseId}-select`);t.addClass("selectpicker").on("change",(t=>{this._buildingSelected(t)})).selectpicker({noneSelectedText:"Select building"}),t.val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),c(`#${this._modalId}`).modal("show")}_getBuildingData(t){return this._buildingData.find((e=>e.name===t))}_getProductText(t){let e="";return t.result&&(t.result.length>1?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.result.map((t=>t.name)).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.result[0].name}</h5>`,t.result[0].price&&(e+='<table class="table table-sm card-table"><tbody>',e+=`<tr><td>${(0,r.PK)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm card-table"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td class="text-left">`,e+=a.materials.map((t=>`${(0,d.yI)(t.amount)} ${t.item}`)).join("<br>"),e+="</td>",e+=`<td>${(0,d.yI)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour cost (%)</th><th>Storage</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${(0,d.yI)(a.production)}</td><td>${(0,d.yI)(-100*a.labourDiscount)}</td><td>${(0,d.yI)(a.maxStorage)}</td><td>${(0,d.yI)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-5"><div class="card-header">Product</div>',a+='<div class="card-body product">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-7"><div class="card-header">Requirements</div>',a+='<div class="card-body px-0 requirements">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(t){const e=String(c(t.currentTarget).find(":selected").val());(0,l.Z)(`#${this._baseId} div`).remove(),(0,l.Z)(`#${this._baseId}`).append("div").classed("buildings mt-4",!0),(0,l.Z)(`#${this._baseId} div`).html(this._getText(e))}}a(8471);var _=a(2157),m=a(3609);function b(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class v{constructor(){b(this,"_rows",{}),b(this,"_sortAscending",{}),b(this,"_sortIndex",{}),b(this,"_switchesSel",{}),b(this,"_tables",{}),b(this,"_groupOrder",["name","damage","penetration","generic","family"]),b(this,"_cannonData",{}),b(this,"_cannonDataDefault",{}),b(this,"_baseName",void 0),b(this,"_baseId",void 0),b(this,"_buttonId",void 0),b(this,"_checkboxId",void 0),b(this,"_modalId",void 0),b(this,"_header",void 0),this._baseName="List cannons",this._baseId="cannon-list",this._buttonId=`button-${this._baseId}`,this._checkboxId=`checkbox-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._header={group:new Map,element:new Set},this._setupListener()}async _loadAndSetupData(){const t=(await a.e(945).then(a.t.bind(a,2066,19))).default;this._setupData(t)}_getFormattedName(t){let e=t;const a=t.split(" "),s=`c${a[0].padStart(3,"0")}`,i=a[1]?a[1][1]:"0";return a.length>1&&(e=`${a[0]} <em>${a[1]}</em>`),{value:`${s}${i}`,formattedValue:e}}_setupData(t){const e=Object.entries(t.long[0]).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,a]of e)if("name"===t)this._header.group.set("",1),this._header.element.add("Lb");else if("family"!==t){this._header.group.set((0,_.fm)(t),Object.entries(a).length);for(const t of Object.keys(a))this._header.element.add((0,_.fm)(t))}for(const e of _.qg)this._cannonDataDefault[e]=t[e].map((t=>{const e=[],a=Object.entries(t).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,s]of a)if("name"===t)e.push(this._getFormattedName(s));else if("family"!==t)for(const[,t]of Object.entries(s))t&&e.push({value:t.value,formattedValue:0===t.value?"":(0,d.QM)(t.value,t?.digits??0)});return{family:t.family,data:e}}))}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._cannonListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const s=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t[e].value.localeCompare(a[e].value)*s:(t[e].value-a[e].value)*s))}_addNavPills(t){const e=t.append("ul").attr("class","nav nav-pills").attr("role","tablist");for(const[t,a]of _.qg.entries())e.append("li").attr("class","nav-item").attr("role","presentation").append("a").attr("class","nav-link"+(0===t?" active":"")).attr("id",`tab-${this._baseId}-${a}`).attr("href",`#tab-content-${this._baseId}-${a}`).attr("data-toggle","tab").attr("role","tab").attr("aria-controls",`${this._baseId}-${a}`).attr("aria-selected",""+(0===t?"true":"false")).text((0,_.fm)(a))}_injectSwitches(t,e){const a=t.append("div").attr("class","mb-3");for(const t of _.kK[e]){const s=a.append("div").attr("class","custom-control custom-switch custom-control-inline");s.append("input").attr("id",`${this._checkboxId}-${e}-${t}`).attr("name",`${this._checkboxId}-${e}`).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),s.append("label").attr("for",`${this._checkboxId}-${e}-${t}`).attr("class","custom-control-label").text((0,_.fm)(t))}this._switchesSel[e]=[...document.querySelectorAll(`input[name=${this._checkboxId}-${e}]`)];for(const t of this._switchesSel[e])t.addEventListener("change",(t=>{t.preventDefault(),this._cannonFamilySelected(e)}))}_injectTableStructure(t,e){this._sortAscending[e]=!0,this._tables[e]=t.append("table").attr("class","table table-sm small na-table");const a=this._tables[e].append("thead");a.append("tr").attr("class","thead-group").selectAll("th").data([...this._header.group]).join("th").classed("border-bottom-0",((t,e)=>0===e)).classed("text-center",((t,e)=>0!==e)).attr("colspan",(t=>`${t[1]}`)).attr("scope","col").text((t=>t[0])),a.append("tr").selectAll("th").data([...this._header.element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",((t,e)=>0===e)).classed("text-right",((t,e)=>0!==e)).text((t=>t.data)).on("click",((t,a)=>{this._sortRows(e,a.index)})),this._tables[e].append("tbody")}_insertTabContent(t,e,a){this._sortAscending[e]=!0;const s=t.append("div").attr("class","tab-pane fade"+(0===a?" show active":"")).attr("id",`tab-content-${this._baseId}-${e}`).attr("href",`#tab-content-${this._baseId}-${e}`).attr("role","tabpanel").attr("aria-labelledby",`${this._baseId}-${e}-tab`).append("div").attr("id",`${e}-list`);this._injectSwitches(s,e),this._injectTableStructure(s,e)}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=(0,l.Z)(`#${this._modalId} .modal-body`);this._addNavPills(t);const e=t.append("div").attr("class","tab-content pt-2");for(const[t,a]of _.qg.entries())this._sortIndex[a]=0,this._insertTabContent(e,a,t),this._cannonFamilySelected(a)}_initModal(){this._injectModal()}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._cannonData[t],(t=>t[0].formattedValue)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t.formattedValue))))}_cannonFamilySelected(t){const e=new Set;for(const a of this._switchesSel[t])if(a.checked){const s=a.id.replace(`${this._checkboxId}-${t}-`,"");e.add(s)}this._cannonData[t]=this._cannonDataDefault[t].filter((t=>e.has(t.family))).map((t=>t.data)),this._updateTable(t),this._sortRows(t,this._sortIndex[t],!1)}_cannonListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),m(`#${this._modalId}`).modal("show")}}a(3824);var f=a(1198),w=a(3609);function g(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class ${constructor(){g(this,"_baseName",void 0),g(this,"_baseId",void 0),g(this,"_buttonId",void 0),g(this,"_modalId",void 0),g(this,"_moduleData",{}),g(this,"_ingredientData",{}),this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}async _loadAndSetupData(){this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default,this._ingredientData=(await a.e(757).then(a.t.bind(a,7588,19))).default.ingredient}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._ingredientListSelected()}))}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName});(0,l.Z)(`#${this._modalId} .modal-body`).append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),w(`#${this._modalId}`).modal("show")}_getProperties(t){let e,a="",s="";for(const e of this._moduleData){const i=e[1].sort((0,h.MR)(["name"])).filter((e=>e.name===t));for(const t of i)a=e[0],s=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?(0,d.xp)(t.amount/100):(0,d.IH)(t.amount);return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return e=`<h6 class='text-muted text-left'>${a}</h6>`,e+=`<table class='table table-sm'><tbody>${s}</tbody></table>`,s?e:""}_getRows(){return this._ingredientData.map((t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map((t=>{const e=this._getProperties(t);return e?`<a data-toggle="tooltip" title="${e}">${t}</a>`:t})).join("<br>")}</td></tr>`))}_getText(){const t=this._getRows(),e=(0,f.xp)(t,2);let a="";for(const t of Array.from({length:e.length}).keys())a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm small na-table"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_injectList(){(0,l.Z)(`#${this._baseId} div`).remove(),(0,l.Z)(`#${this._baseId}`).append("div").classed("row",!0),(0,l.Z)(`#${this._baseId} div`).html(this._getText()),w('[data-toggle="tooltip"]').tooltip({html:!0,placement:"auto",sanitize:!1})}}var S=a(6400),y=a(5619),I=a(4332),M=a(3609);function x(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function k(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}const D=y.Z.bind(S.h);var L=new WeakMap,T=new WeakMap,j=new WeakMap,A=new WeakMap,W=new WeakMap,P=new WeakMap,N=new WeakMap,O=new WeakMap,R=new WeakMap,q=new WeakMap,C=new WeakMap,Z=new WeakMap;class E{constructor(){L.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:I.t}),P.set(this,{writable:!0,value:{}}),N.set(this,{writable:!0,value:{}}),O.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:{}}),C.set(this,{writable:!0,value:0}),Z.set(this,{writable:!0,value:""}),k(this,L,"List loot and chests"),k(this,T,"loot-list"),k(this,j,`button-${x(this,T)}`),k(this,A,`modal-${x(this,T)}`);for(const t of x(this,W))x(this,P)[t]=`${x(this,T)}-${t}-select`;this._setupListener()}static _printAmount(t){return t.min===t.max?(0,d.yI)(t.min):`${(0,d.yI)(t.min)} to ${(0,d.yI)(t.max)}`}static _printChance(t){return(0,d.yI)(100*(1-t))}async _loadAndSetupData(){const t=(await a.e(393).then(a.t.bind(a,9628,19))).default;console.log(t);for(const e of x(this,W))x(this,N)[e]=t[e]}_setupListener(){let t=!0;document.querySelector(`#${x(this,j)}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",x(this,L)),this._sourceListSelected()}))}_getTypeOptions(t){return D`
            ${x(this,N)[t].sort((0,h.MR)(["name"])).map((t=>D`<option value="${t.id}">${t.name}</option>`))}
        `}_getItemsOptions(){const t=new Map,e=(e,a,s)=>{const i=new Map([[e.id,{id:e.id,name:e.name,chance:s,amount:a.amount}]]);t.set(a.id,{name:a.name,sources:t.has(a.id)?new Map([...t.get(a.id).sources,...i]):i})};for(const t of[...x(this,N).loot,...x(this,N).fish]){const{items:a}=t;for(const s of a)e(t,s,s.chance)}for(const t of x(this,N).chest)for(const a of t.itemGroup){const{chance:s,items:i}=a;for(const a of i)e(t,a,s)}return k(this,O,new Map([...t.entries()].sort(((t,e)=>t[1].name.localeCompare(e[1].name))))),D`${[...x(this,O)].map((t=>D`<option value="${t[0]}">${t[1].name}</option>`))}`}_getOptions(t){const e=new Set(["chest","fish","loot"]);let a=D``;return e.has(t)?a=this._getTypeOptions(t):"item"===t&&(a=this._getItemsOptions()),a}_getModalBody(){return D`
            ${x(this,W).map((t=>D`
                        <label>
                            <select id="${x(this,P)[t]}" class="selectpicker">
                                ${this._getOptions(t)}
                            </select>
                        </label>
                    `))}
            <div id="${x(this,T)}"></div>
        `}_getModalFooter(){return D` <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> `}_injectModal(){(0,S.sY)((0,r.eb)({id:x(this,A),title:x(this,L),size:"modal-md",body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"))}_setupSelectListeners(){for(const t of x(this,W)){const e="loot"===t?"ship loot":"fish"===t?"fishing region":t;x(this,q)[t].on("change",(()=>{k(this,Z,t),this._itemSelected()})).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:`Select ${e}`,virtualScroll:!0})}}_initModal(){this._injectModal(),k(this,R,document.querySelector(`#${x(this,T)}`));for(const t of x(this,W))x(this,q)[t]=M(`#${x(this,P)[t]}`);this._setupSelectListeners()}_sourceListSelected(){document.querySelector(`#${x(this,A)}`)||this._initModal(),M(`#${x(this,A)}`).modal("show")}_getLootItemsText(t,e,a=!0){return D`
            <table class="table table-sm small na-table no-sort">
                <thead>
                    <tr>
                        <th scope="col">${e}</th>
                        ${a?D`<th scope="col" class="text-right">Chance (0 − 100)</th>`:""}
                        <th scope="col" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map((t=>D`
                                <tr>
                                    <td>${t.name}</td>
                                    ${a?D` <td class="text-right">
                                              ${E._printChance(t.chance)}
                                          </td>`:""}
                                    <td class="text-right">${E._printAmount(t.amount)}</td>
                                </tr>
                            `))}
                </tbody>
            </table>
        `}_getSourceText(){const t=[...x(this,O).get(x(this,C)).sources].map((t=>t[1])).sort((0,h.MR)(["chance","name"]));return D`${this._getLootItemsText(t,"Source")}`}_getChestsText(){const t=x(this,N).chest.find((t=>t.id===x(this,C)));return D`
            <p>Weight ${(0,d.yI)(t.weight)} tons<br />Lifetime ${(0,d.yI)(t.lifetime)} hours</p>
            ${t.itemGroup.map((t=>D` <h5>Group chance: ${E._printChance(t.chance)}</h5>
                    ${this._getLootItemsText(t.items.sort((0,h.MR)(["name"])),"Item",!1)}`))}
        `}_getLootText(){const t=x(this,N)[x(this,Z)].find((t=>t.id===x(this,C))).items.sort((0,h.MR)(["chance","name"]));return D`${this._getLootItemsText(t,"Item")}`}_getText(){return"item"===x(this,Z)?this._getSourceText():"chest"===x(this,Z)?this._getChestsText():this._getLootText()}_getTable(){return D` <div class="mt-4">${this._getText()}</div> `}_resetOtherSelects(){const t=x(this,W).filter((t=>t!==x(this,Z)));for(const e of t)x(this,q)[e].val("default").selectpicker("refresh")}_itemSelected(){const t=x(this,q)[x(this,Z)].find(":selected");k(this,C,Number(t.val())),this._resetOtherSelects(),(0,S.sY)(this._getTable(),x(this,R))}}var B=a(393),K=a(3609);function F(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class z{constructor(){F(this,"_baseName",void 0),F(this,"_baseId",void 0),F(this,"_buttonId",void 0),F(this,"_modalId",void 0),F(this,"_moduleData",{}),this._baseName="List modules",this._baseId="module-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}async _loadAndSetupData(){this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._moduleListSelected()}))}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName});const t=`${this._baseId}-select`,e=(0,l.Z)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",`${this._baseId}`)}_getOptions(){return`${this._moduleData.map((t=>`<option value="${t[0]}"">${t[0]}</option>;`)).join("")}`}_setupSelect(){const t=K(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){K(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>{this._moduleSelected(t)})).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),K(`#${this._modalId}`).modal("show")}_getRows(t){const e=new Map([["L",`${(0,B.hi)(1)} – ${(0,B.hi)(3)}`],["M",`${(0,B.hi)(4)} – ${(0,B.hi)(5)}`],["S",`${(0,B.hi)(6)} – ${(0,B.hi)(7)}`]]),a=t=>"U"===t?"":`${e.get(t)??""}`,s=(t,e)=>void 0!==e&&t.name===e.name&&JSON.stringify(t.properties)===JSON.stringify(e.properties);let i="";const o=[];for(const e of this._moduleData)if(e[0]===t)for(const[t,n]of e[1].sort((0,h.MR)(["name"])).entries())i=a(n.moduleLevel),s(n,e[1][t+1])&&(e[1][t+1].hasSamePropertiesAsPrevious=!0,i+=`<br>${a(e[1][t+1].moduleLevel)}`),s(n,e[1][t+2])&&(e[1][t+2].hasSamePropertiesAsPrevious=!0,i=""),void 0!==n.hasSamePropertiesAsPrevious&&n.hasSamePropertiesAsPrevious||o.push(`<tr><td><span class="name">${n.name}<br>${i}</span></td><td>${n.properties.map((t=>{let e;return e=t.isPercentage?(0,d.xp)(t.amount/100):t.amount<1&&t.amount>0?(0,d.nM)(t.amount,1):(0,d.IH)(t.amount),`${t.modifier} ${e}`})).join("<br>")}</td></tr>`);return o}_getText(t){const e=this._getRows(t),a=(0,f.xp)(e,3);let s="";for(const t of Array.from({length:a.length}).keys())s+=`<div class="col-md-${Math.floor(12/a.length)}">`,s+='<table class="table table-sm small na-table"><thead>',s+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",s+=a[t].join(""),s+="</tbody></table></div>";return s}_moduleSelected(t){const e=K(t.currentTarget).find(":selected").val();(0,l.Z)(`#${this._baseId} div`).remove(),(0,l.Z)(`#${this._baseId}`).append("div").classed("row mt-4",!0),(0,l.Z)(`#${this._baseId} div`).html(this._getText(e))}}var H=a(7484),U=a.n(H),V=(a(9517),a(285)),Q=a.n(V),G=a(4110),Y=a.n(G),J=a(178),X=a.n(J),tt=a(3609);function et(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function at(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}U().extend(Q()),U().extend(Y()),U().extend(X()),U().locale("en-gb");var st=new WeakMap,it=new WeakMap,ot=new WeakMap,nt=new WeakMap,lt=new WeakMap,dt=new WeakMap,rt=new WeakMap,ht=new WeakMap,ct=new WeakMap,pt=new WeakMap,ut=new WeakMap;class _t{constructor(t){st.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),nt.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),ht.set(this,{writable:!0,value:{}}),ct.set(this,{writable:!0,value:!0}),pt.set(this,{writable:!0,value:0}),ut.set(this,{writable:!0,value:{}}),at(this,ot,t),at(this,nt,"List of port battles"),at(this,lt,"pb-list"),at(this,dt,`button-${et(this,lt)}`),at(this,st,`table-${et(this,lt)}`),at(this,rt,`modal-${et(this,lt)}`),this._setupListener()}async _loadAndSetupData(){const t=await(0,i.qP)(`${et(this,ot)}-pb.json`);at(this,it,t.filter((t=>1===t.attackHostility)).map((t=>{const e=U().utc(t.portBattle).local(),a=U().utc(t.portBattle),s=a===e?"":` (${e.format("H.mm")} local)`,i=(0,_.$i)(t.nation)?.name,o=t.capturer?`${i??""} (${(0,f.Mo)(t.capturer)})`:i??"";return{sort:t.portBattle??"",data:[`${(0,_.fm)(a.fromNow())} at ${a.format("H.mm")} ${s}`,t.name,`${t?.attackerNation??""} (${(0,f.Mo)(t?.attackerClan??"")})`,o]}})))}_setupListener(){let t=!0;document.querySelector(`#${et(this,dt)}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",et(this,nt)),this._pbListSelected()}))}_sortRows(t,e=!0){e&&et(this,pt)===t&&at(this,ct,!et(this,ct)),at(this,pt,t);const a=et(this,ct)?1:-1;et(this,ht).sort(((e,s)=>0===t?e.sort.localeCompare(s.sort)*a:e.data[t].localeCompare(s.data[t])*a))}_initTable(){et(this,ut).append("thead").append("tr").selectAll("th").data(["Time","Port","Attacker","Defender"]).join("th").datum(((t,e)=>({data:t,index:e}))).attr("role","columnheader").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),et(this,ut).append("tbody")}_injectModal(){(0,i.Eu)({id:et(this,rt),title:et(this,nt),size:"modal-lg"});const t=(0,l.Z)(`#${et(this,rt)} .modal-body`);at(this,ut,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){at(this,ht,et(this,ut).select("tbody").selectAll("tr").data(et(this,it),(t=>t.sort)).join((t=>t.append("tr")))),et(this,ht).selectAll("td").data((t=>t.data)).join((t=>t.append("td").html((t=>t))))}_pbListSelected(){document.querySelector(`#${et(this,rt)}`)||this._initModal(),tt(`#${et(this,rt)}`).modal("show")}}var mt=a(155),bt=a(3609);function vt(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function ft(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}var wt=new WeakMap,gt=new WeakMap,$t=new WeakMap,St=new WeakMap,yt=new WeakMap,It=new WeakMap,Mt=new WeakMap,xt=new WeakMap,kt=new WeakMap,Dt=new WeakMap,Lt=new WeakMap,Tt=new WeakMap,jt=new WeakMap;class At{constructor(t){wt.set(this,{writable:!0,value:void 0}),gt.set(this,{writable:!0,value:void 0}),$t.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:void 0}),yt.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:{}}),Mt.set(this,{writable:!0,value:{}}),xt.set(this,{writable:!0,value:{}}),kt.set(this,{writable:!0,value:{}}),Dt.set(this,{writable:!0,value:{}}),Lt.set(this,{writable:!0,value:!0}),Tt.set(this,{writable:!0,value:0}),jt.set(this,{writable:!0,value:{}}),ft(this,yt,t),ft(this,gt,"List port bonuses"),ft(this,wt,"port-bonus-list"),ft(this,$t,`button-${vt(this,wt)}`),ft(this,St,`modal-${vt(this,wt)}`),this._setupListener()}async _loadData(){ft(this,It,await(0,i.qP)(`${vt(this,yt)}-ports.json`)),ft(this,xt,await(0,i.qP)(`${vt(this,yt)}-pb.json`)),ft(this,Mt,(await a.e(462).then(a.t.bind(a,7640,19))).default)}_setupData(){const t=[0,1,3,7,15],e={};for(const t of I.y)e[t]=0;const a=new Map(vt(this,Mt).map((t=>[t.id,{name:t.name,points:t.portPoints}]))),s=new Map(vt(this,xt).map((t=>[t.id,t.nation])));ft(this,kt,vt(this,It).filter((t=>t.portBonus)).map((i=>({id:i.id,name:a.get(i.id)?.name??"",nation:(0,_.$i)(s.get(i.id)??"")?.name??"",portBonusLevel:Object.values({...e,...i.portBonus}),points:a.get(i.id)?.points??0,pointsInvested:(0,mt.Z)(Object.values(i.portBonus).map((e=>t[e])))}))))}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){let t=!0;document.querySelector(`#${vt(this,$t)}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",vt(this,gt)),this._listSelected()}))}_sortRows(t,e=!0){e&&vt(this,Tt)===t&&ft(this,Lt,!vt(this,Lt)),ft(this,Tt,t);const a=vt(this,Lt)?1:-1;vt(this,Dt).sort(((e,s)=>0===t?e.name.localeCompare(s.name)*a:1===t?e.nation.localeCompare(s.nation)*a:7===t?(e.points-s.points)*a:8===t?(e.pointsInvested-s.pointsInvested)*a:(e.portBonusLevel[t-2]-s.portBonusLevel[t-2])*a))}_initTable(){ft(this,Lt,!0),vt(this,jt).append("thead").append("tr").selectAll("th").data(["Port","Nation",...I.y,"Port points","Points invested"]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>e>1)).attr("role","columnheader").style("width",((t,e)=>e>2?"3rem":"")).text((t=>(0,_.fm)(t.data))).on("click",((t,e)=>{this._sortRows(e.index)})),vt(this,jt).append("tbody")}_injectModal(){(0,i.Eu)({id:vt(this,St),title:vt(this,gt),size:"modal-lg"});const t=(0,l.Z)(`#${vt(this,St)} .modal-body`);ft(this,jt,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){ft(this,Dt,vt(this,jt).select("tbody").selectAll("tr").data(vt(this,kt),(t=>t.id)).join((t=>t.append("tr")))),vt(this,Dt).selectAll("td").data((t=>[t.name,t.nation,...t.portBonusLevel,t.points,t.pointsInvested])).join((t=>t.append("td").classed("text-right",((t,e)=>e>1)).text((t=>0===t?"":String(t)))))}_listSelected(){document.querySelector(`#${vt(this,St)}`)||this._initModal(),bt(`#${vt(this,St)}`).modal("show")}}var Wt=a(1460),Pt=a(3609);function Nt(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const Ot=(t,e,a)=>`${(0,B.hi)(e)} – ${(0,B.hi)(a)}`;class Rt{constructor(t){Nt(this,"_serverType",void 0),Nt(this,"_baseName",void 0),Nt(this,"_baseId",void 0),Nt(this,"_buttonId",void 0),Nt(this,"_modalId",void 0),Nt(this,"_moduleData",[]),Nt(this,"_recipeData",[]),Nt(this,"_recipes",void 0),this._serverType=Wt.c.find((e=>e.id===t)).type,this._baseName="List admiralty items and recipes",this._baseId="recipe-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}async _loadAndSetupData(){this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default,this._recipeData=(await a.e(757).then(a.t.bind(a,7588,19))).default.recipe,this._recipes=new Map(this._recipeData.flatMap((t=>t.recipes.map((t=>[t.id,t])))))}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._recipeListSelected()}))}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName});const t=`${this._baseId}-select`,e=(0,l.Z)(`#${this._modalId} .modal-body`);e.append("select").attr("name",t).attr("id",t),e.append("label").attr("for",t).attr("class","text-muted pl-2").text("Items listed here may not be available in the game (yet)."),e.append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_getOptions(){return this._recipeData.map((t=>`<optgroup label="${t.group}">${t.recipes.filter((t=>"Any"===t.serverType||t.serverType===this._serverType)).sort((0,h.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,Ot)}`)).join("</option>")}`)).join("</optgroup>")}_setupSelect(){const t=Pt(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){Pt(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>{this._recipeSelected(t)})).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),Pt(`#${this._modalId}`).modal("show")}_getRecipeData(t){return this._recipes.get(t)}_getRequirementText(t){let e='<table class="table table-sm card-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${(0,r.PK)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`<tr><td>${t.itemRequirements.map((t=>`${t.amount} ${t.name}`)).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",s="";for(const e of this._moduleData){const i=e[1].filter((e=>e.id===t.result.id));for(const t of i)[a]=e,s=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?(0,d.xp)(t.amount/100):t.amount;return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return s?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm card-table na-table"><tbody>${s}</tbody></table>`):e+=`<p>${(0,d.yI)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-6"><div class="card-header">Item</div>',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card col-6"><div class="card-header">Result</div>',a+='<div class="card-body">',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(t){const e=Number(Pt(t.currentTarget).find(":selected").val());(0,l.Z)(`#${this._baseId} div`).remove(),(0,l.Z)(`#${this._baseId}`).append("div").classed("mt-4",!0),(0,l.Z)(`#${this._baseId} div`).html(this._getText(e))}}var qt=a(3609);function Ct(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function Zt(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}var Et=new WeakMap,Bt=new WeakMap,Kt=new WeakMap,Ft=new WeakMap,zt=new WeakMap,Ht=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,Qt=new WeakMap;class Gt{constructor(){Et.set(this,{writable:!0,value:void 0}),Bt.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:{}}),Ht.set(this,{writable:!0,value:{}}),Ut.set(this,{writable:!0,value:!0}),Vt.set(this,{writable:!0,value:0}),Qt.set(this,{writable:!0,value:{}}),Zt(this,Et,"List ships"),Zt(this,Bt,"ship-list"),Zt(this,Kt,`button-${Ct(this,Bt)}`),Zt(this,Ft,`modal-${Ct(this,Bt)}`),this._setupListener()}async _loadAndSetupData(){const t=(await a.e(228).then(a.t.bind(a,4237,19))).default.sort((0,h.MR)(["class","-battleRating","name"]));Zt(this,zt,t.map((t=>[[t.class,String(t.class)],[t.name,(0,r.Y8)(t.name)],[t.guns.total,String(t.guns.total)],[t.battleRating,(0,d.yI)(t.battleRating)],[t.crew.max,(0,d.yI)(t.crew.max)],[t.ship.maxSpeed,(0,d.QM)(t.ship.maxSpeed)],[t.ship.turnSpeed,(0,d.QM)(t.ship.turnSpeed)],[t.guns.broadside.cannons,(0,d.yI)(t.guns.broadside.cannons)],[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4].amount?String(t.guns.gunsPerDeck[4].amount):""],[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5].amount?String(t.guns.gunsPerDeck[5].amount):""],[t.sides.armour,`${(0,d.yI)(t.sides.armour)} (${t.sides.thickness})`]])))}_setupListener(){let t=!0;document.querySelector(`#${Ct(this,Kt)}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",Ct(this,Et)),this._shipListSelected()}))}_sortRows(t,e=!0){e&&Ct(this,Vt)===t&&Zt(this,Ut,!Ct(this,Ut)),Zt(this,Vt,t);const a=Ct(this,Ut)?1:-1;Ct(this,Ht).sort(((e,s)=>1===t?e[t][0].localeCompare(s[t][0])*a:(e[t][0]-s[t][0])*a))}_initTable(){const t={group:new Map([["dummy1",5],["Speed",2],["dummy2",1],["Chasers",2],["dummy3",1]]),element:new Set(["Class","Name","Guns","Battle rating","Crew","Maximum","Turn","Broadside","Bow","Stern","Sides"])},e=Ct(this,Qt).append("thead");e.append("tr").attr("class","thead-group").selectAll("th").data([...t.group]).join("th").classed("border-bottom-0",(t=>t[0].startsWith("dummy"))).classed("text-center",!0).attr("colspan",(t=>t[1])).attr("scope","col").text((t=>t[0].startsWith("dummy")?"":t[0])),e.append("tr").selectAll("th").data([...t.element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",!0).classed("text-right",((t,e)=>1!==e)).text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),Ct(this,Qt).append("tbody")}_injectModal(){(0,i.Eu)({id:Ct(this,Ft),title:Ct(this,Et),size:"modal-lg"});const t=(0,l.Z)(`#${Ct(this,Ft)} .modal-body`);Zt(this,Qt,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){Zt(this,Ht,Ct(this,Qt).select("tbody").selectAll("tr").data(Ct(this,zt),(t=>t[1][0])).join((t=>t.append("tr")))),Ct(this,Ht).selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>1!==e)).html((t=>t[1]))))}_shipListSelected(){document.querySelector(`#${Ct(this,Ft)}`)||this._initModal(),qt(`#${Ct(this,Ft)}`).modal("show")}}var Yt=a(3609);function Jt(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const Xt=["Resources","Extra","Materials"];class te{constructor(){Jt(this,"_baseName",void 0),Jt(this,"_baseId",void 0),Jt(this,"_buttonId",void 0),Jt(this,"_modalId",void 0),Jt(this,"_init",!0),Jt(this,"_blueprintData",{}),Jt(this,"_woodData",{}),Jt(this,"_extractionCosts",{}),Jt(this,"_craftingCosts",{}),Jt(this,"_blueprint",void 0),Jt(this,"_woodOptions",{}),Jt(this,"_defaultWood",void 0),Jt(this,"_woodsSelected",{}),Jt(this,"_blueprintList",void 0),Jt(this,"_currentBlueprint",{}),Jt(this,"_tables",{}),this._baseName="List ship blueprint",this._baseId="ship-blueprint-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._defaultWood={frame:"Fir",trim:"Crew Space"},this._setupListener()}async _loadAndSetupData(){this._blueprintData=(await a.e(263).then(a.t.bind(a,8041,19))).default,this._woodData=(await a.e(799).then(a.t.bind(a,7384,19))).default;const t=(await a.e(263).then(a.t.bind(a,5702,19))).default;this._extractionCosts=new Map(t.standard.map((t=>[t.name,{reales:t.reales,labour:t?.labour??0}]))),this._craftingCosts=new Map(t.seasoned.map((t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}])))}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._listSelected()}))}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName,size:"modal-lg"});const t=`${this._baseId}-ship-select`,e=(0,l.Z)(`#${this._modalId} .modal-body`);let a=e.append("div").classed("row no-gutters mb-2",!0);a.append("label").attr("for",t),a.append("select").attr("name",t).attr("id",t),a=e.append("div").classed("row no-gutters",!0);for(const t of _.Kf){const e=`${this._baseId}-${t}-select`;a.append("label").attr("for",e),a.append("select").attr("name",e).attr("id",e).classed("pr-2",!0)}this._blueprintList=e.append("div").attr("id",`${this._baseId}`).classed("blueprint mt-4",!0)}_getShipOptions(){return`${this._blueprintData.sort((0,h.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupShipSelect(){const t=Yt(`#${this._baseId}-ship-select`),e=this._getShipOptions();t.append(e)}_setupWoodOptions(){const t=this._woodData.frame.sort((0,h.MR)(["name"])),e=this._woodData.trim.filter((t=>"Light"!==t.name)).sort((0,h.MR)(["name"]));this._woodOptions={frame:t.map((t=>`<option value="${t.name}">${t.name}</option>`)).join(""),trim:e.map((t=>`<option value="${t.name}">${t.name}</option>`)).join("")}}_setupWoodSelect(t,e){this._setupWoodOptions(),this._woodsSelected[t]=this._defaultWood[t],e.append(this._woodOptions[t]),e.attr("disabled","disabled")}_setupSelects(){this._setupShipSelect();for(const t of _.Kf){const e=Yt(`#${this._baseId}-${t}-select`);this._setupWoodSelect(t,e)}}_setupShipSelectListener(){Yt(`#${this._baseId}-ship-select`).addClass("selectpicker").on("change",(t=>{this._blueprintSelected(t)})).selectpicker({noneSelectedText:"Select blueprint",width:"fit"}).val("default").selectpicker("refresh")}_setupWoodSelectListener(t,e){e.addClass("selectpicker").on("change",(()=>{this._woodSelected(t,e)})).selectpicker({noneSelectedText:`Select ${t}`,width:"fit"}).val("default").selectpicker("refresh")}_setupSelectListener(){this._setupShipSelectListener();for(const t of _.Kf){const e=Yt(`#${this._baseId}-${t}-select`);this._setupWoodSelectListener(t,e)}}_initModal(){this._injectModal(),this._setupSelects(),this._setupSelectListener()}_setWoodSelect(t){Yt(`#${this._baseId}-${t}-select`).removeAttr("disabled").val(this._defaultWood[t]).selectpicker("refresh")}_woodSelected(t,e){this._woodsSelected[t]=e.val(),this._updateText()}_listSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),Yt(`#${this._modalId}`).modal("show")}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join((t=>t.append("tr"))).selectAll("td").data((t=>t)).join((t=>t.append("td"))).html((t=>t))}_updateText(){let t=this._currentBlueprint.resources.map((t=>[t.name,t.amount])),e=!1,a=!1,s=0,i=0;if("Crew Space"===this._woodsSelected.trim){const e=this._currentBlueprint.wood.find((t=>"Crew Space"===t.name)).amount,a=t.findIndex((t=>"Hemp"===t[0]));t[a][1]=t[a][1]+e}else if(i=this._currentBlueprint.wood.find((t=>"Planking"===t.name)).amount,this._woodsSelected.trim===this._woodsSelected.frame)s+=i;else{const e=t.findIndex((t=>t[0]===this._woodsSelected.trim));e>=0?t[e][1]=t[e][1]+i:(a=!0,t.push([this._woodsSelected.trim,i]))}s+=this._currentBlueprint.wood.find((t=>"Frame"===t.name)).amount;const o=t.findIndex((t=>t[0]===this._woodsSelected.frame));if(o>=0?t[o][1]=t[o][1]+s:(e=!0,t.push([this._woodsSelected.frame,s])),e&&a){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let n=[];this._currentBlueprint.price&&n.push(["Reales",this._currentBlueprint.price]),n.push(["Provisions",this._currentBlueprint.provisions]),this._currentBlueprint.permit&&n.push(["Permit",this._currentBlueprint.permit]),n.push(["Craft level",this._currentBlueprint.craftLevel],["Shipyard level",this._currentBlueprint.shipyardLevel],["Labour hours",this._currentBlueprint.labourHours],["Craft experience",this._currentBlueprint.craftXP]);const l=[];let r=0,h=0;const c=t=>(this._extractionCosts.get(t[0])?.reales??0)*t[1],p=t=>(this._extractionCosts.get(t[0])?.labour??0)*t[1],u=t=>{for(const e of t.filter((t=>this._extractionCosts.has(t[0]))))r+=c(e),h+=p(e)};u(t),u(n),r&&l.push(["Reales",(0,d.yI)(r)],["Labour hours",(0,d.yI)(h)]);let m=0,b=0,v=0,f=0;for(const t of _.Kf){const e=this._craftingCosts.get(this._woodsSelected[t]);e&&(m+=(e.reales??0)*s,b+=(e.labour??0)*s,v+=(e.doubloon??0)*s,f+=(e.tool??0)*s)}m&&l.push(["(S) reales",(0,d.yI)(m)]),b&&l.push(["(S) labour hours",(0,d.yI)(b)]),v&&l.push(["(S) doubloons",(0,d.yI)(v)]),f&&l.push(["(S) tools",(0,d.yI)(f)]),t=t.map((t=>[t[0],(0,d.yI)(t[1])])),n=n.map((t=>[t[0],(0,d.yI)(t[1])])),this._updateTable(this._tables.Resources,t),this._updateTable(this._tables.Extra,n),this._updateTable(this._tables.Materials,l)}_blueprintSelected(t){if(this._init){this._init=!1;for(const t of _.Kf)this._setWoodSelect(t);const t=this._blueprintList.append("div").classed("card-deck",!0),e=e=>{const a=t.append("div").classed("card",!0);a.append("div").classed("card-header",!0).text(e);const s=a.append("div").classed("card-body",!0);this._tables[e]=s.append("table").classed("table table-sm card-table",!0),this._tables[e].append("thead"),this._tables[e].append("tbody")};for(const t of Xt)e(t)}this._blueprint=Yt(t.currentTarget).find(":selected").val(),this._currentBlueprint=this._getBlueprintData(this._blueprint),this._updateText()}_getBlueprintData(t){return this._blueprintData.find((e=>e.name===t))}}var ee=a(3609);function ae(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class se{constructor(){ae(this,"_modifiers",{}),ae(this,"_rows",{}),ae(this,"_sortAscending",{}),ae(this,"_sortIndex",{}),ae(this,"_switchesSel",void 0),ae(this,"_tables",{}),ae(this,"_woodData",{}),ae(this,"_woodDataDefault",{}),ae(this,"_baseId",void 0),ae(this,"_baseName",void 0),ae(this,"_buttonId",void 0),ae(this,"_checkboxId",void 0),ae(this,"_modalId",void 0),ae(this,"_modifiersNotUsed",new Set(["Ship material","Boarding morale"])),this._baseName="List woods",this._baseId="wood-list",this._buttonId=`button-${this._baseId}`,this._checkboxId=`checkbox-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_getModifiers(t){const e=new Set;for(const a of this._woodDataDefault[t])for(const t of a.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))))e.add(t.modifier);return[...e].sort(h.I4)}async _loadData(){this._woodDataDefault=(await a.e(799).then(a.t.bind(a,7384,19))).default}_setupData(){for(const t of _.Kf){this._modifiers[t]=new Set(this._getModifiers(t));for(const e of this._woodDataDefault[t]){const a=new Set(e.properties.map((t=>t.modifier)));for(const s of this._modifiers[t])a.has(s)||e.properties.push({modifier:s,amount:0,isPercentage:!1});e.properties.sort(((t,e)=>t.modifier.localeCompare(e.modifier)))}}this._woodData={...this._woodDataDefault}}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){let t=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this._baseName),this._woodListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const s=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t.name.localeCompare(a.name)*s:(t.properties[e-1].amount-a.properties[e-1].amount)*s))}_initTable(t){this._sortAscending[t]=!0,this._tables[t].append("thead").append("tr").selectAll("th").data(["Wood",...this._modifiers[t]]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>0!==e)).attr("role","columnheader").text((t=>t.data)).on("click",((e,a)=>{this._sortRows(t,a.index)})),this._tables[t].append("tbody")}_injectModal(){(0,i.Eu)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=(0,l.Z)(`#${this._modalId} .modal-body`),e=t.append("div").attr("class","mb-3");for(const t of _.pe){const a=e.append("div").attr("class","custom-control custom-switch custom-control-inline");a.append("input").attr("id",`${this._checkboxId}-${t}`).attr("name",`${this._checkboxId}`).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),a.append("label").attr("for",`${this._checkboxId}-${t}`).attr("class","custom-control-label").text((0,_.fm)(t))}this._switchesSel=[...document.querySelectorAll(`input[name=${this._checkboxId}]`)];for(const t of this._switchesSel)t.addEventListener("change",(t=>{t.preventDefault(),this._woodFamilySelected()}));for(const e of _.Kf)t.append("h5").text((0,_.fm)(`${e}s`)),this._tables[e]=t.append("table").attr("class","table table-sm small na-table"),this._initTable(e),this._updateTable(e),this._sortRows(e,0,!1)}_initModal(){this._injectModal()}_getFormattedAmount(t){let e;return e="Repair amount"===t.modifier&&t.amount?(0,d.nM)(t.amount,1):t.amount?(0,d.QM)(t.amount):"",e}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._woodData[t],(t=>t.id)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>[t.name,...t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).map((t=>this._getFormattedAmount(t)))])).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t))))}_woodFamilySelected(){const t=new Set;for(const e of this._switchesSel)if(e.checked){const a=e.id.replace(`${this._checkboxId}-`,"");t.add(a)}for(const e of _.Kf)this._woodData[e]=this._woodDataDefault[e].filter((e=>t.has(e.family))),this._updateTable(e),this._sortRows(e,this._sortIndex[e],!1)}_woodListSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),ee(`#${this._modalId}`).modal("show")}}var ie=a(7622),oe=a(8823),ne=a(3657),le=a(7290),de=a(7603),re=a(289),he=a(9714),ce=a(6377),pe=a.n(ce),ue=a(995),_e=a(3609);function me(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function be(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}var ve=new WeakMap,fe=new WeakMap,we=new WeakMap,ge=new WeakMap,$e=new WeakMap,Se=new WeakMap,ye=new WeakMap,Ie=new WeakMap,Me=new WeakMap;class xe extends ue.I{constructor(t){super(t,"Show port net income"),ve.set(this,{writable:!0,value:0}),fe.set(this,{writable:!0,value:0}),we.set(this,{writable:!0,value:{}}),ge.set(this,{writable:!0,value:{}}),$e.set(this,{writable:!0,value:{}}),Se.set(this,{writable:!0,value:{}}),ye.set(this,{writable:!0,value:{}}),Ie.set(this,{writable:!0,value:void 0}),Me.set(this,{writable:!0,value:{}}),be(this,Ie,(0,de.Z)().range(i.q4)),this._setupListener()}static _hideDetails(){_e(this).tooltip("dispose")}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){return Math.floor(me(this,$e).node().offsetWidth)??0}_setupData(t){const e=t.ports.map((e=>{const a=t.server.find((t=>t.id===e.id))??{},s=t.pb.find((t=>t.id===e.id))??{};return{...e,...a,...s}})),a=(0,ie.Z)(e,(t=>t.netIncome))??0,s=(0,oe.Z)(e,(t=>t.netIncome))??0;be(this,Me,(0,re.Z)().domain([a,s]).range([8,32]).clamp(!0));const i=new Set(["NT","FT"]),o=new Set,n=[...e.filter((t=>t.netIncome>0&&!i.has(t.nation))).map((t=>(o.add(t.nation),{id:t.name,value:t.netIncome,parentId:(0,_.$i)(t.nation)?.sortName}))),..._.nU.filter((t=>o.has(t.short))).map((t=>({id:t.sortName,value:0,parentId:"World"}))),{id:"World",value:0,parentId:void 0}];be(this,we,(0,ne.Z)()(n)),be(this,ge,(0,le.ZP)(me(this,we)).sum((t=>t.data.value)))}async _loadData(){const t=[{fileName:`${this.serverId}-ports.json`,name:"server"},{fileName:`${this.serverId}-pb.json`,name:"pb"}],e={};return e.ports=(await a.e(462).then(a.t.bind(a,7640,19))).default,await(0,i.EZ)(t,e),e}async _loadAndSetupData(){(0,i.dM)();const t=await this._loadData();this._setupData(t),(0,i.V4)()}_setupListener(){let t=!0;document.querySelector(`#${this.buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this.baseName),this._menuItemSelected()}))}_drawLegend(){const t=Math.floor(20*B.L9),e=Math.floor(2*B.L9),a=Math.floor(5*B.L9),s=(me(this,ge).children??[]).sort(((t,e)=>e.value-t.value)),i=160+2*a,o=s.length*i-2*a,n=Math.ceil(o/me(this,fe)),l=Math.ceil(s.length/n),h=Math.ceil(me(this,fe)/l-2*a);me(this,$e).append("div").attr("class","d-flex flex-wrap justify-content-between mt-3").selectAll(".legend").data(s).join((s=>{const i=s.append("div").attr("class","legend mt-3"),o=i.append("svg").attr("class","svg-text").attr("width",h).attr("height",2*t+e);return o.append("rect").attr("width",h).attr("height",t).style("fill",(t=>me(this,Ie).call(this,t.data.id))),o.append("text").attr("x",a).attr("y","25%").text((t=>t.data.id)).style("fill",(t=>(0,r.IF)(me(this,Ie).call(this,t.data.id)))),o.append("rect").attr("class","rect-background").attr("y",t+e).attr("width",h).attr("height",t).style("fill",(t=>me(this,Ie).call(this,t.data.id))),o.append("rect").attr("y",t+e).attr("width",(t=>h*(t.value/(t.parent?.value??1)))).attr("height",t).style("fill",(t=>me(this,Ie).call(this,t.data.id))),o.append("text").attr("x",h-a).attr("y","75%").html((t=>(0,d.Dw)(t.value,!0))).style("text-anchor","end"),i}))}_getTooltipText(t){return`\n            <div class="d-flex justify-content-between align-items-center">\n            <div class="d-flex flex-column text-left mt-1 mr-3 p-0">\n                <div><span class="x-large">${t.data.id??""}</span><br />${t.parent?.data?.id??""}</div>\n            </div>\n            <div class="d-flex flex-column text-left mt-1 p-0">\n                <div class="mr-3">\n                    ${(0,d.Dw)(t.data.data.value)}<br />\n                    <span class="des">Port</span>\n                </div>\n                <div class="mr-3">\n                    ${(0,d.me)(t.data.data.value/(t.parent?.value??1))}<br />\n                    <span class="des">Nation</span>\n                </div>\n                <div class="mr-3">\n                    ${(0,d.me)(t.data.data.value/(t.parent?.parent?.value??1))}<br />\n                    <span class="des">World</span>\n                </div>\n            </div>\n            </div>`}_showDetails(t,e){_e(t.currentTarget).tooltip("dispose").tooltip({html:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-smaller"></div></div>',title:this._getTooltipText(e),sanitize:!1}).tooltip("show")}_drawCells(t){me(this,Se).append("g").attr("class","cells").selectAll(".cell").data(t).join((t=>t.append("path").attr("class","cell").attr("d",(t=>`M${t.polygon.join(",")}z`)).style("fill",(t=>me(this,Ie).call(this,t.parent?.data.id??"")))))}_drawLabels(t){const e=me(this,Se).append("g").attr("class","labels").selectAll(".label").data(t).join((t=>t.append("g").attr("class","label").attr("transform",(t=>`translate(${t.polygon.site.x},${t.polygon.site.y})`)).style("font-size",(t=>`${me(this,Me).call(this,t.data.data.value)}px`)).style("fill",(t=>(0,r.IF)(me(this,Ie).call(this,t.parent?.data.id??""))))));e.append("text").attr("class","name").text((t=>t.data.data.id)),e.append("text").attr("class","value").html((t=>(0,d.Pj)(t.data.data.value,!0)))}_drawHover(t){me(this,Se).append("g").selectAll(".hoverer").data(t).join((t=>t.append("path").attr("class","hoverer").attr("d",(t=>`M${t.polygon.join(",")}z`)).on("mouseover",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",xe._hideDetails)))}_drawTreemap(){const t=me(this,ge).leaves();this._drawCells(t),this._drawLabels(t),this._drawHover(t),this._drawLegend()}_initTreemap(){be(this,ve,xe.getHeight()),be(this,fe,this._getWidth()),be(this,ye,me(this,$e).append("svg").attr("class","voronoi").attr("width",me(this,fe)).attr("height",me(this,ve))),be(this,Se,me(this,ye).append("g").attr("class","drawingArea")),(0,he.voronoiTreemap)().clip([[0,0],[0,me(this,ve)],[me(this,fe),me(this,ve)],[me(this,fe),0]]).minWeightRatio(1e-10).prng(pe()(this.baseId))(me(this,ge))}_injectModal(){(0,i.Eu)({id:this.modalId,title:this.baseName});const t=(0,l.Z)(`#${this.modalId} .modal-body`);be(this,$e,t.append("div").attr("id",`${this.baseId}`))}_initModal(){this._injectModal()}_menuItemSelected(){let t=!1;document.querySelector(`#${this.modalId}`)||(t=!0,this._initModal()),(0,i.dM)(),_e(`#${this.modalId}`).on("shown.bs.modal",(()=>{t&&(t=!1,this._initTreemap(),this._drawTreemap()),(0,i.V4)()})).modal("show")}}var ke=a(1316),De=a(3865),Le=a(604),Te=a(2461),je=a(7658),Ae=a(9766),We=a(7633),Pe=a(7829),Ne=a(3609);function Oe(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}var Re=new WeakMap;class qe extends ue.I{constructor(t){super(t,"Ownership overview"),Re.set(this,{writable:!0,value:void 0}),Oe(this,"_ownershipData",{}),Oe(this,"_nationData",{}),Oe(this,"_colourScale",void 0),Oe(this,"_mainDiv",void 0),Oe(this,"_div",void 0),Oe(this,"_svg",void 0),this._colourScale=(0,de.Z)().range(i.q4),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){return Math.floor(this._mainDiv.node().offsetWidth)??0}async _loadAndSetupData(){(0,i.dM)(),this._nationData=await(0,i.qP)(`${this.serverId}-nation.json`),this._ownershipData=await(0,i.qP)(`${this.serverId}-ownership.json`),(0,i.V4)()}_setupListener(){let t=!0;document.querySelector(`#${this.buttonId}`)?.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,s.KS)("Tools",this.baseName),this._ownershipListSelected()}))}_injectModal(){(0,i.Eu)({id:this.modalId,title:this.baseName});const t=`${this.baseId}-select`,e=(0,l.Z)(`#${this.modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t),this._mainDiv=e.append("div").attr("id",`${this.baseId}`),this._div=this._mainDiv.append("div"),this._svg=this._mainDiv.append("svg").attr("class","area")}_getOptions(){return`${this._ownershipData.map((t=>`<option value="${t.region}">${t.region}</option>;`)).join("")}`}_setupSelect(){const t=Ne(`#${this.baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){Ne(`#${this.baseId}-select`).addClass("selectpicker").on("change",(t=>{this._regionSelected(t)})).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let t=!1;document.querySelector(`#${this.modalId}`)||(t=!0,this._initModal()),Ne(`#${this.modalId}`).on("shown.bs.modal",(()=>{t&&(this._injectArea(),t=!1)})).modal("show")}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,qe.getHeight()),a=32,s=32,i=32,o=_.nU.filter((t=>9!==t.id)).map((t=>t.short)),n=this._nationData;n.keys=o;const l=(0,je.Z)().offset(Ae.Z).keys(o)(n);this._svg.attr("width",t).attr("height",e),(()=>{const d=(()=>{const o=(0,re.Z)().domain((0,De.Z)(n,(t=>new Date(t.date)))).range([i,t-a]),d=(0,re.Z)().domain([(0,ie.Z)(l[0],(t=>t[0])),(0,oe.Z)(l[l.length-1],(t=>t[1]))]).range([e-s,0]);return(0,We.Z)().x((t=>o(new Date(t.data.date))??0)).y0((t=>d(t[0])??0)).y1((t=>d(t[1])??0)).curve(Pe.ZP)})(),h=new Map(_.nU.map((t=>[t.short,t.name])));this._colourScale.domain(o),this._svg.selectAll("path").data(l).join((t=>t.append("path").attr("fill",(t=>this._colourScale(t.key))).attr("stroke",(t=>this._colourScale(t.key))).attr("d",d))),this._svg.selectAll(".area-label").data(l).join((t=>t.append("text").attr("class","area-label").text((t=>h.get(t.key))).attr("fill",(t=>(0,r.IF)(this._colourScale(t.key)))).attr("transform",(0,ke.areaLabel)(d))))})(),this._svg.append("g").call((o=>{const l=(0,Te.Z)().domain((0,De.Z)(n,(t=>new Date(t.date)))).range([i,t-a]);o.attr("transform",`translate(0,${e-s})`).call((0,Le.LL)(l).ticks(t/80).tickSizeOuter(0)),o.attr("font-size",".8rem").attr("font-family","")}))}async _injectChart(t){(await a.e(782).then(a.bind(a,6280))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(t){const e=Ne(t.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const a=this._ownershipData.filter((t=>t.region===e)).map((t=>t.data))[0];this._injectChart(a)}}const Ce=(t,e)=>{const a=new o.qn("ship-compare");(()=>{if(e.has("cmp")&&e.has("v")){const t=e.get("v");t&&t.split(".")[0]===i.f4.split(".")[0]&&((0,s.KS)("Menu","Paste ship compare"),a.initFromClipboard(e))}})(),new n.Z("wood"),new se,new u,new v,new $,new E,new z,new _t(t),new At(t),new Rt(t),new Gt,new te,new xe(t),new qe(t)}},3906:()=>{}}]);