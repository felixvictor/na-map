/*! For license information please see game-tools.4998af89baf11c268811.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[639],{4564:(t,e,a)=>{a.r(e),a.d(e,{init:()=>$s});var i=a(4622),s=a(2855),n=a(2157),r=a(9022),o=a(7015),l=a(5923),h=a(9843),d=a(29);function c(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function u(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,m(t,e,"get"))}function p(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,m(t,e,"set"),a),a}function m(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var w=new WeakMap,f=new WeakMap,v=new WeakMap,b=new WeakMap,g=new WeakMap,_=new WeakMap,y=new WeakMap;class S{constructor(){c(this,w,{writable:!0,value:void 0}),c(this,f,{writable:!0,value:"List of buildings"}),c(this,v,{writable:!0,value:void 0}),c(this,b,{writable:!0,value:{}}),c(this,g,{writable:!0,value:{}}),c(this,_,{writable:!0,value:void 0}),c(this,y,{writable:!0,value:{}}),p(this,w,(0,r.MF)(u(this,f))),p(this,v,`menu-${u(this,w)}`),this._setupListener()}async _loadAndSetupData(){p(this,b,(await a.e(337).then(a.t.bind(a,6045,19))).default)}async _menuClicked(){(0,s.KS)("Tools",u(this,f)),u(this,_)?u(this,_).show():(await this._loadAndSetupData(),p(this,_,new h.Z(u(this,f),"lg")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${u(this,v)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${u(this,b).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupSelect(){p(this,y,new d.Z(u(this,w),u(this,_).baseIdSelects,{noneSelectedText:"Select building"},this._getOptions(),!1)),p(this,g,u(this,_).selectsSel.select("label")),u(this,g).attr("class","ps-2")}_setupSelectListener(){u(this,y).select$.on("change",(()=>{this._buildingSelected()}))}_getBuildingData(t){return u(this,b).find((e=>e.name===t))}_getProductText(t){let e="";return t.result&&(t.result.length>1?(u(this,g).text(""),e+='<table class="table table-sm table-hover text-table"><tbody>',e+=`${t.result.map((t=>`<tr><td>${t.name}</td></tr>`)).join("")}`,e+="</tbody></table>"):(u(this,g).text(`produces ${t.result[0].name}`),t.result[0].price&&(e+='<table class="table table-sm table-hover text-table"><tbody>',e+=`<tr><td>${(0,l.PK)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm table-hover"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>`,e+=a.materials.map((t=>`${(0,o.yI)(t.amount)} ${t.item}`)).join("<br>"),e+="</td>",e+=`<td>${(0,o.yI)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour<br>cost (%)</th><th>Storage</th><th>Build price<br>(reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${(0,o.yI)(a.production)}</td><td>${(0,o.yI)(-100*a.labourDiscount)}</td><td>${(0,o.yI)(a.maxStorage)}</td><td>${(0,o.yI)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-4">',a+='<div class="card-body">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-8">',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(){const t=String(u(this,y).getValues()),e=u(this,_).outputSel;e.select("div").remove(),e.append("div").classed("mt-4",!0).html(this._getText(t))}}var k=a(8471),$=a.n(k);function M(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function x(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,T(t,e,"get"))}function W(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,T(t,e,"set"),a),a}function T(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var D=new WeakMap,L=new WeakMap,j=new WeakMap,I=new WeakMap,C=new WeakMap,A=new WeakMap,P=new WeakMap,E=new WeakMap,O=new WeakMap,R=new WeakMap,N=new WeakMap,Z=new WeakMap,q=new WeakMap,F=new WeakMap;class K{constructor(){M(this,D,{writable:!0,value:void 0}),M(this,L,{writable:!0,value:"List of cannons"}),M(this,j,{writable:!0,value:void 0}),M(this,I,{writable:!0,value:["name","damage","penetration","generic","family"]}),M(this,C,{writable:!0,value:{group:new Map,element:new Set}}),M(this,A,{writable:!0,value:void 0}),M(this,P,{writable:!0,value:{}}),M(this,E,{writable:!0,value:{}}),M(this,O,{writable:!0,value:{}}),M(this,R,{writable:!0,value:{}}),M(this,N,{writable:!0,value:{}}),M(this,Z,{writable:!0,value:void 0}),M(this,q,{writable:!0,value:{}}),M(this,F,{writable:!0,value:{}}),W(this,D,(0,r.MF)(x(this,L))),W(this,A,`menu-${x(this,D)}`),W(this,j,`checkbox-${x(this,D)}`),this._setupListener()}async _loadAndSetupData(){const t=(await a.e(945).then(a.t.bind(a,7412,19))).default;this._setupData(t)}_getFormattedName(t){let e=t;const a=t.split(" "),i=`c${a[0].padStart(3,"0")}`,s=a[1]?a[1][1]:"0";return a.length>1&&(e=`${a[0]} <em>${a[1]}</em>`),{value:`${i}${s}`,formattedValue:e}}_setupData(t){const e=Object.entries(t.long[0]).sort(((t,e)=>x(this,I).indexOf(t[0])-x(this,I).indexOf(e[0])));for(const[t,a]of e)if("name"===t)x(this,C).group.set("",1),x(this,C).element.add("Lb");else if("family"!==t){x(this,C).group.set((0,n.fm)(t),Object.entries(a).length);for(const t of Object.keys(a))x(this,C).element.add((0,n.fm)(t))}for(const e of n.qg)x(this,N)[e]=t[e].map((t=>{const e=[],a=Object.entries(t).sort(((t,e)=>x(this,I).indexOf(t[0])-x(this,I).indexOf(e[0])));for(const[t,i]of a)if("name"===t)e.push(this._getFormattedName(i));else if("family"!==t)for(const[,t]of Object.entries(i))t&&e.push({value:t.value,formattedValue:0===t.value?"":(0,o.QM)(t.value,(null==t?void 0:t.digits)??0)});return{family:t.family,data:e}}))}async _menuClicked(){(0,s.KS)("Tools",x(this,L)),x(this,Z)?x(this,Z).show():(await this._loadAndSetupData(),W(this,Z,new h.Z(x(this,L),"xl")),this._injectTab())}_setupListener(){var t;null===(t=document.querySelector(`#${x(this,A)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e,a=!0){a&&x(this,F)[t]===e&&(x(this,q)[t]=!x(this,q)[t]),x(this,F)[t]=e;const i=x(this,q)[t]?1:-1;x(this,P)[t].sort(((t,a)=>0===e?t[e].value.localeCompare(a[e].value)*i:(t[e].value-a[e].value)*i))}_getTabId(){return`${x(this,D)}-tab`}_getTabItemId(t){return`${this._getTabId()}-${t}-item`}_getTabContentId(t){return`${this._getTabId()}-${t}-content`}_getListId(t){return`${this._getTabId()}-${t}-list`}_addNavPills(t){const e=t.append("ul").attr("id",this._getTabId()).attr("class","nav nav-tabs").attr("role","tablist");for(const[t,a]of n.qg.entries()){const i=e.append("li").attr("class","nav-item").attr("role","presentation").append("button").attr("class","nav-link").attr("id",this._getTabItemId(a)).attr("data-bs-target",`#${this._getTabContentId(a)}`).attr("data-bs-toggle","tab").attr("role","tab").text((0,n.fm)(a));0===t&&i.attr("class","nav-link active").attr("aria-current","page")}}_injectSwitches(t,e){const a=t.append("div").attr("class","mb-3");for(const t of n.kK[e]){const i=a.append("div").attr("class","form-check form-check-inline form-switch");i.append("input").attr("id",`${x(this,j)}-${e}-${t}`).attr("name",`${x(this,j)}-${e}`).attr("class","form-check-input").attr("type","checkbox").property("checked",!0),i.append("label").attr("for",`${x(this,j)}-${e}-${t}`).attr("class","form-check-label").text((0,n.fm)(t))}x(this,E)[e]=[...document.querySelectorAll(`input[name=${x(this,j)}-${e}]`)];for(const t of x(this,E)[e])t.addEventListener("change",(t=>{t.preventDefault(),this._cannonFamilySelected(e)}))}_injectTableStructure(t,e){x(this,q)[e]=!0,x(this,O)[e]=t.append("table").attr("class","table table-sm table-sort table-striped table-hover");const a=x(this,O)[e].append("thead");a.append("tr").attr("class","thead-group").selectAll("th").data([...x(this,C).group]).join("th").classed("border-bottom-0",((t,e)=>0===e)).classed("text-center",((t,e)=>0!==e)).attr("colspan",(t=>`${t[1]}`)).attr("scope","col").text((t=>t[0])),a.append("tr").selectAll("th").data([...x(this,C).element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",((t,e)=>0===e)).classed("text-end",((t,e)=>0!==e)).text((t=>t.data)).on("click",((t,a)=>{this._sortRows(e,a.index)})),x(this,O)[e].append("tbody")}_insertTabContent(t,e,a){x(this,q)[e]=!0;const i=t.append("div").attr("class","tab-pane fade"+(0===a?" show active":"")).attr("id",this._getTabContentId(e)).attr("role","tabpanel").attr("aria-labelledby",this._getTabItemId(e)).append("div").attr("id",this._getListId(e));this._injectSwitches(i,e),this._injectTableStructure(i,e)}_injectTab(){const t=x(this,Z).outputSel;this._addNavPills(t);const e=t.append("div").attr("class","tab-content pt-2");for(const[t,a]of n.qg.entries())x(this,F)[a]=0,this._insertTabContent(e,a,t),this._cannonFamilySelected(a);const a=document.querySelector(`#${this._getTabId()} li:first-child button`);new($())(a).show()}_updateTable(t){x(this,P)[t]=x(this,O)[t].select("tbody").selectAll("tr").data(x(this,R)[t],(t=>t[0].formattedValue)).join((t=>t.append("tr"))),x(this,P)[t].selectAll("td").data((t=>t)).join((t=>t.append("td").html((t=>t.formattedValue))))}_cannonFamilySelected(t){const e=new Set;for(const a of x(this,E)[t])if(a.checked){const i=a.id.replace(`${x(this,j)}-${t}-`,"");e.add(i)}x(this,R)[t]=x(this,N)[t].filter((t=>e.has(t.family))).map((t=>t.data)),this._updateTable(t),this._sortRows(t,x(this,F)[t],!1)}}a(2087);var z=a(7484),B=a.n(z),V=(a(9517),a(4110)),H=a.n(V),U=a(178),Q=a.n(U),J=a(4194),G=a(3389);function Y(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function X(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,et(t,e,"get"))}function tt(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,et(t,e,"set"),a),a}function et(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}B().extend(H()),B().extend(Q()),B().locale("en-gb");var at=new WeakMap,it=new WeakMap,st=new WeakMap,nt=new WeakMap,rt=new WeakMap,ot=new WeakMap,lt=new WeakMap,ht=new WeakMap,dt=new WeakMap,ct=new WeakMap,ut=new WeakMap,pt=new WeakMap,mt=new WeakMap,wt=new WeakMap,ft=new WeakMap,vt=new WeakMap;class bt{constructor(t){Y(this,at,{writable:!0,value:void 0}),Y(this,it,{writable:!0,value:"List of conquest flags"}),Y(this,st,{writable:!0,value:void 0}),Y(this,nt,{writable:!0,value:void 0}),Y(this,rt,{writable:!0,value:void 0}),Y(this,ot,{writable:!0,value:[]}),Y(this,lt,{writable:!0,value:{}}),Y(this,ht,{writable:!0,value:[]}),Y(this,dt,{writable:!0,value:[]}),Y(this,ct,{writable:!0,value:[]}),Y(this,ut,{writable:!0,value:void 0}),Y(this,pt,{writable:!0,value:{}}),Y(this,mt,{writable:!0,value:!0}),Y(this,wt,{writable:!0,value:0}),Y(this,ft,{writable:!0,value:{}}),Y(this,vt,{writable:!0,value:{}}),tt(this,rt,t),tt(this,at,(0,r.MF)(X(this,it))),tt(this,nt,`menu-${X(this,at)}`),tt(this,st,`${X(this,at)}-input`),"eu1"===t?this._setupListener():this._removeMenu()}_removeMenu(){document.querySelector(`#${X(this,nt)}`).remove()}async _loadData(){tt(this,ct,await(0,r.qP)(`${X(this,rt)}-flags.json`))}_setupData(){for(const t of X(this,ct))for(const e of t.flags)X(this,dt).push([e.expire,t.nation,this._fromNow(e.expire),this._getDate(e.expire),this._getTime(e.expire),e.number])}async _loadAndSetupData(){await this._loadData(),this._setupData()}async _menuClicked(){(0,s.KS)("Tools",X(this,it)),X(this,ut)?X(this,ut).show():(await this._loadAndSetupData(),tt(this,ut,new h.Z(X(this,it),"lg")),this._listSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${X(this,nt)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){let a=0;3===t&&(a=5),e&&X(this,wt)===a&&tt(this,mt,!X(this,mt)),tt(this,wt,a);const i=X(this,mt)?1:-1;X(this,pt).sort(((e,s)=>3===t?(e[a]-s[a])*i:e[a].localeCompare(s[a])*i))}_initTable(){tt(this,mt,!0),X(this,ft).append("thead").append("tr").selectAll("th").data(["Expires in","Date","Time","Flags"]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>e<=1)).attr("scope","col").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),X(this,ft).append("tbody")}_fromNow(t){return`${B().utc(t).fromNow().replace("in ","").replace("a ","1 ")}`}_getDate(t){return`${B().utc(t).format("dddd, D MMM")}`}_getTime(t){const e=B().utc(t).local(),a=B().utc(t),i=a===e?"":` (${e.format("H.mm")} local)`;return`${a.format("H.mm")} ${i}`}_updateTable(){tt(this,pt,X(this,ft).select("tbody").selectAll("tr").data(X(this,ht),(t=>t[0])).join((t=>t.append("tr")))),X(this,pt).selectAll("td").data((t=>t.slice(2))).join((t=>t.append("td").classed("text-start",((t,e)=>e<=1)).text((t=>t))))}_getActiveNation(){return Number(X(this,vt).get())}_injectToggleButtons(){const t=n.nU.filter((t=>!("NT"===t.short||"FT"===t.short))).sort(((t,e)=>t.sortName.localeCompare(e.sortName)));tt(this,ot,t.map((t=>String(t.id))));const e=X(this,ut).selectsSel.append("div").attr("id",X(this,st)).attr("class","d-flex flex-wrap justify-content-between mb-3");for(const a of t)e.append("input").attr("type","radio").attr("class","btn-check").attr("name",X(this,st)).attr("id",`${X(this,st)}-${a.id}`).attr("value",a.id).attr("autocomplete","off"),e.append("label").attr("for",`${X(this,st)}-${a.id}`).attr("class","btn btn-toggle").attr("title",a.name).append("i").attr("class",`flag-icon-${a.short} flag-icon-button`).attr("role","img")}_showSelected(){const t=this._getActiveNation();tt(this,ht,X(this,dt).filter((e=>e[1]===t))),X(this,lt).set(String(t)),this._updateTable(),this._sortRows(0,!1)}_setupButtonListener(){var t;null===(t=document.querySelector(`#${X(this,st)}`))||void 0===t||t.addEventListener("change",(async()=>{this._showSelected()}))}_listSelected(){tt(this,ft,X(this,ut).outputSel.append("table").attr("class","table table-sm table-striped table-hover table-sort text-table mt-3")),this._initTable(),this._injectToggleButtons(),tt(this,vt,new J.Z(X(this,st),X(this,ot))),tt(this,lt,new G.Z({id:X(this,st),values:X(this,ot)})),X(this,vt).set(X(this,lt).get()),this._setupButtonListener(),this._showSelected()}}var gt=a(3824),_t=a.n(gt),yt=a(1198);function St(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function kt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Mt(t,e,"get"))}function $t(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Mt(t,e,"set"),a),a}function Mt(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var xt=new WeakMap,Wt=new WeakMap,Tt=new WeakMap,Dt=new WeakMap,Lt=new WeakMap,jt=new WeakMap;class It{constructor(){St(this,xt,{writable:!0,value:[]}),St(this,Wt,{writable:!0,value:void 0}),St(this,Tt,{writable:!0,value:[]}),St(this,Dt,{writable:!0,value:void 0}),St(this,Lt,{writable:!0,value:"List of recipe ingredients"}),St(this,jt,{writable:!0,value:void 0}),$t(this,Dt,(0,r.MF)(kt(this,Lt))),$t(this,jt,`menu-${kt(this,Dt)}`),this._setupListener()}async _loadAndSetupData(){$t(this,Tt,(await a.e(303).then(a.t.bind(a,3092,19))).default),$t(this,xt,(await a.e(757).then(a.t.bind(a,7002,19))).default.ingredient)}async _menuClicked(){(0,s.KS)("Tools",kt(this,Lt)),kt(this,Wt)?kt(this,Wt).show():(await this._loadAndSetupData(),$t(this,Wt,new h.Z(kt(this,Lt),"xl")),this._ingredientListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${kt(this,jt)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getProperties(t){let e,a="",i="";for(const e of kt(this,Tt)){const s=e[1].sort((0,n.MR)(["name"])).filter((e=>e.name===t));for(const t of s)a=e[0],i=`${t.properties.map((t=>{const e=t.isPercentage?(0,o.QO)(t.amount/100).replace(/"/g,"'"):(0,o.IH)(t.amount);return`<tr><td class='text-start pe-3'>${t.modifier}</td><td>${e}</td></tr>`})).join("")}`}return e=`<h6 class='text-muted'>${a}</h6>`,e+=`<table class='table table-striped w-auto'><tbody>${i}</tbody></table>`,i?e:""}_getRows(){return kt(this,xt).map((t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map((t=>{const e=this._getProperties(t);return e?`<a data-bs-toggle="tooltip" title="${e}">${t}</a>`:t})).join("<br>")}</td></tr>`))}_getText(){const t=this._getRows(),e=(0,yt.xp)(t,2);let a="";for(const t of Array.from({length:e.length}).keys())a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm table-striped table-hover text-table text-start"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_ingredientListSelected(){const t=kt(this,Wt).outputSel;t.select("div").remove(),t.append("div").attr("class","row").html(this._getText());Array.prototype.slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map((function(t){return new(_t())(t,{html:!0,placement:"auto",sanitize:!1})}))}}var Ct=a(6400),At=a(5619),Pt=a(4332);function Et(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Ot(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Nt(t,e,"get"))}function Rt(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Nt(t,e,"set"),a),a}function Nt(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const Zt=At.Z.bind(Ct.h);var qt=new WeakMap,Ft=new WeakMap,Kt=new WeakMap,zt=new WeakMap,Bt=new WeakMap,Vt=new WeakMap,Ht=new WeakMap,Ut=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,Gt=new WeakMap,Yt=new WeakMap;class Xt{constructor(){Et(this,qt,{writable:!0,value:{}}),Et(this,Ft,{writable:!0,value:new Map}),Et(this,Kt,{writable:!0,value:void 0}),Et(this,zt,{writable:!0,value:new Map}),Et(this,Bt,{writable:!0,value:{}}),Et(this,Vt,{writable:!0,value:0}),Et(this,Ht,{writable:!0,value:""}),Et(this,Ut,{writable:!0,value:void 0}),Et(this,Qt,{writable:!0,value:"List of loot and chests"}),Et(this,Jt,{writable:!0,value:void 0}),Et(this,Gt,{writable:!0,value:new Set(["chest","fish","loot"])}),Et(this,Yt,{writable:!0,value:Pt.tJ}),Rt(this,Ut,(0,r.MF)(Ot(this,Qt))),Rt(this,Jt,`menu-${Ot(this,Ut)}`),this._setupListener()}static _printAmount(t){return t.min===t.max?(0,o.yI)(t.min):`${(0,o.yI)(t.min)} – ${(0,o.yI)(t.max)}`}static _printChance(t){return(0,o.yI)(100*(1-t))}async _loadAndSetupData(){const t=(await a.e(393).then(a.t.bind(a,5530,19))).default;for(const e of Ot(this,Yt))Ot(this,qt)[e]=t[e]}async _menuClicked(){(0,s.KS)("Tools",Ot(this,Qt)),Ot(this,Kt)?Ot(this,Kt).show():(await this._loadAndSetupData(),Rt(this,Kt,new h.Z(Ot(this,Qt),"md")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${Ot(this,Jt)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getTypeOptions(t){return Ot(this,qt)[t].sort((0,n.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name}</option>`)).join("")}_setOptionItems(t,e,a){const i=new Map([[t.id,{id:t.id,name:t.name,chance:a,amount:e.amount}]]);Ot(this,zt).set(e.id,{name:e.name,sources:Ot(this,zt).has(e.id)?new Map([...Ot(this,zt).get(e.id).sources,...i]):i})}_getItemsOptions(){for(const t of[...Ot(this,qt).loot,...Ot(this,qt).fish]){const{items:e}=t;for(const a of e)this._setOptionItems(t,a,a.chance)}for(const t of Ot(this,qt).chest)for(const e of t.itemGroup){const{chance:a,items:i}=e;for(const e of i)this._setOptionItems(t,e,a)}return Rt(this,Ft,new Map([...Ot(this,zt).entries()].sort(((t,e)=>t[1].name.localeCompare(e[1].name))))),[...Ot(this,Ft)].map((t=>`<option value="${t[0]}">${t[1].name}</option>`)).join("")}_getOptions(t){let e="";return Ot(this,Gt).has(t)?e=this._getTypeOptions(t):"item"===t&&(e=this._getItemsOptions()),e}_setupSelect(){Ot(this,Kt).selectsSel.attr("class","d-flex flex-wrap mb-3");for(const t of Ot(this,Yt)){const e={dropupAuto:!1,liveSearch:!0,placeholder:`Select ${"loot"===t?"ship loot":"fish"===t?"fishing region":t}`,virtualScroll:!0};"item"===t&&(e.width="440px"),Ot(this,Bt)[t]=new d.Z(`${Ot(this,Ut)}-${t}`,Ot(this,Kt).baseIdSelects,e,this._getOptions(t))}}_setupSelectListener(){for(const t of Ot(this,Yt))Ot(this,Bt)[t].select$.on("change",(()=>{Rt(this,Ht,t),this._itemSelected()}))}_getLootItemsText(t,e,a=!0){return Zt`
            <table class="table table-sm table-striped table-hover">
                <thead>
                    <tr>
                        <th scope="col" class="text-start">${e}</th>
                        ${a?Zt`<th scope="col">Chance<br />(0 − 100)</th>`:""}
                        <th scope="col">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map((t=>Zt`
                                <tr>
                                    <td class="text-start">${t.name}</td>
                                    ${a?Zt` <td>${Xt._printChance(t.chance)}</td>`:""}
                                    <td>${Xt._printAmount(t.amount)}</td>
                                </tr>
                            `))}
                </tbody>
            </table>
        `}_getSourceText(){const t=Ot(this,Ft).get(Ot(this,Vt));if(t){const e=[...t.sources].map((t=>t[1])).sort((0,n.MR)(["chance","name"]));return Zt`${this._getLootItemsText(e,"Source")}`}return Zt``}_getChestsText(){const t=Ot(this,qt).chest.find((t=>t.id===Ot(this,Vt)));return t?Zt`
                <p>
                    Weight ${(0,o.yI)(t.weight)} tons<br />Lifetime ${(0,o.yI)(t.lifetime)} hours
                </p>
                ${t.itemGroup.map((t=>Zt`<h5>Group chance: ${Xt._printChance(t.chance)}</h5>
                        ${this._getLootItemsText(t.items.sort((0,n.MR)(["name"])),"Item",!1)}`))}
            `:Zt``}_getLootText(){const t=Ot(this,qt)[Ot(this,Ht)].find((t=>t.id===Ot(this,Vt)));if(t){const e=t.items.sort((0,n.MR)(["chance","name"]));return Zt`${this._getLootItemsText(e,"Item")}`}return Zt``}_getText(){return"item"===Ot(this,Ht)?this._getSourceText():"chest"===Ot(this,Ht)?this._getChestsText():this._getLootText()}_getTable(){return Zt`<div class="mt-4">${this._getText()}</div>`}_resetOtherSelects(){const t=Ot(this,Yt).filter((t=>t!==Ot(this,Ht)));for(const e of t)Ot(this,Bt)[e].reset()}_itemSelected(){Rt(this,Vt,Number(Ot(this,Bt)[Ot(this,Ht)].getValues()));const t=Ot(this,Kt).outputSel;this._resetOtherSelects(),(0,Ct.sY)(this._getTable(),t.node())}}var te=a(393);function ee(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function ae(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,se(t,e,"get"))}function ie(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,se(t,e,"set"),a),a}function se(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var ne=new WeakMap,re=new WeakMap,oe=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap;class ce{constructor(){ee(this,ne,{writable:!0,value:void 0}),ee(this,re,{writable:!0,value:"List of modules"}),ee(this,oe,{writable:!0,value:void 0}),ee(this,le,{writable:!0,value:void 0}),ee(this,he,{writable:!0,value:{}}),ee(this,de,{writable:!0,value:{}}),ie(this,ne,(0,r.MF)(ae(this,re))),ie(this,oe,`menu-${ae(this,ne)}`),this._setupListener()}async _loadAndSetupData(){ie(this,de,(await a.e(303).then(a.t.bind(a,3092,19))).default)}async _menuClicked(){(0,s.KS)("Tools",ae(this,re)),ae(this,le)?ae(this,le).show():(await this._loadAndSetupData(),ie(this,le,new h.Z(ae(this,re),"xl")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${ae(this,oe)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${ae(this,de).map((t=>`<option value="${t[0]}">${t[0]}</option>`)).join("")}`}_setupSelect(){ie(this,he,new d.Z(ae(this,ne),ae(this,le).baseIdSelects,{noneSelectedText:"Select module category",width:"fit"},this._getOptions()))}_setupSelectListener(){ae(this,he).select$.on("change",(()=>{this._moduleSelected()}))}_getRows(t){const e=new Map([["L",`${(0,te.hi)(1)} – ${(0,te.hi)(3)}`],["M",`${(0,te.hi)(4)} – ${(0,te.hi)(5)}`],["S",`${(0,te.hi)(6)} – ${(0,te.hi)(7)}`]]),a=t=>"U"===t?"":`${e.get(t)??""}`,i=(t,e)=>void 0!==e&&t.name===e.name&&JSON.stringify(t.properties)===JSON.stringify(e.properties);let s="";const r=[];for(const e of ae(this,de))if(e[0]===t)for(const[t,h]of e[1].sort((0,n.MR)(["name"])).entries()){var l;if(s=a(h.moduleLevel),i(h,e[1][t+1])&&(e[1][t+1].hasSamePropertiesAsPrevious=!0,s+=`<br>${a(e[1][t+1].moduleLevel)}`),i(h,e[1][t+2])&&(e[1][t+2].hasSamePropertiesAsPrevious=!0,s=""),void 0===h.hasSamePropertiesAsPrevious||!h.hasSamePropertiesAsPrevious)r.push(`<tr>\n                                <td class="pe-2">${h.name}<br>${s}</td>\n                                <td class="py-0 ps-0">\n                                    <table class="table table-sm table-hover text-table text-start mb-0"><tbody>${null===(l=h.properties)||void 0===l?void 0:l.map((t=>{let e;return e=t.isPercentage?(0,o.QO)(t.amount/100):t.amount<1&&t.amount>0?(0,o.nM)(t.amount,1):(0,o.IH)(t.amount),`<tr>\n                                                        <td class="pe-2">${t.modifier}</td>\n                                                        <td class="text-end pe-2">${e}</td>\n                                                    </tr>`})).join("")}</tbody></table></td>\n                            </tr>`)}return r}_getText(t){const e=this._getRows(t),a=(0,yt.xp)(e,3);let i="";for(const t of Array.from({length:a.length}).keys())i+=`<div class="col-md-${Math.floor(12/a.length)}">`,i+='<table class="table table-sm table-striped table-hover text-table text-start"><thead>',i+="<tr>\n                        <th>Module</th>\n                        <th>Modifier</th>\n                    </tr>",i+="</thead><tbody>",i+=a[t].join(""),i+="</tbody></table></div>";return i}_moduleSelected(){const t=String(ae(this,he).getValues()),e=ae(this,le).outputSel;e.select("div").remove(),e.append("div").classed("row mt-4",!0).html(this._getText(t))}}var ue=a(285),pe=a.n(ue);function me(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function we(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function fe(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,be(t,e,"get"))}function ve(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,be(t,e,"set"),a),a}function be(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}B().extend(pe()),B().extend(H()),B().extend(Q()),B().locale("en-gb");var ge=new WeakMap,_e=new WeakMap,ye=new WeakMap,Se=new WeakMap,ke=new WeakMap,$e=new WeakMap,Me=new WeakMap,xe=new WeakMap,We=new WeakMap,Te=new WeakMap,De=new WeakMap;class Le{constructor(t){we(this,ge,{writable:!0,value:[]}),we(this,_e,{writable:!0,value:void 0}),we(this,ye,{writable:!0,value:{}}),we(this,Se,{writable:!0,value:!0}),we(this,ke,{writable:!0,value:0}),we(this,$e,{writable:!0,value:{}}),we(this,Me,{writable:!0,value:void 0}),we(this,xe,{writable:!0,value:void 0}),we(this,We,{writable:!0,value:"List of port battles"}),we(this,Te,{writable:!0,value:void 0}),we(this,De,{writable:!0,value:void 0}),me(this,"_compareTime",((t,e,a)=>t[4].localeCompare(e[4])*a)),me(this,"_getNationSortName",(t=>{var e,a;const i=(null===(e=/flag-icon-(\w{2})/.exec(t))||void 0===e?void 0:e[1])??"";return(null===(a=(0,n.$i)(i))||void 0===a?void 0:a.sortName)??""})),ve(this,De,t),ve(this,xe,(0,r.MF)(fe(this,We))),ve(this,Te,`menu-${fe(this,xe)}`),ve(this,Me,`${fe(this,xe)}-table`),this._setupListener()}async _loadAndSetupData(){const t=await(0,r.qP)(`${fe(this,De)}-pb.json`);ve(this,ge,t.filter((t=>1===t.attackHostility)).map((t=>{var e,a;const i=B().utc(t.portBattle).local(),s=B().utc(t.portBattle),r=s===i?"":` (${i.format("H.mm")} local)`,o=`<span class="flag-icon-${t.nation} flag-icon-small me-1" role="img" title="${(null===(e=(0,n.$i)(t.nation))||void 0===e?void 0:e.sortName)??""}"></span>`,l=t.capturer&&"RAIDER"!==t.capturer?`${(0,yt.Mo)(t.capturer)}`:"",h=`<span class="flag-icon-${t.attackerNation} flag-icon-small me-1" role="img" title="${(null===(a=(0,n.$i)(t.attackerNation))||void 0===a?void 0:a.sortName)??""}"></span>`,d=`${(0,yt.Mo)((null==t?void 0:t.attackerClan)??"")}`;return{sort:t.portBattle??"",data:[`${(0,n.fm)(s.fromNow())} at ${s.format("H.mm")} ${r}`,t.name,h+d,o+l,s.toISOString()]}})))}async _menuClicked(){(0,s.KS)("Tools",fe(this,We)),fe(this,_e)?fe(this,_e).show():(await this._loadAndSetupData(),ve(this,_e,new h.Z(fe(this,We),"lg")),this._pbListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${fe(this,Te)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){e&&fe(this,ke)===t&&ve(this,Se,!fe(this,Se)),ve(this,ke,t);const a=fe(this,Se)?1:-1;fe(this,ye).sort(((e,i)=>{if(0===t)return this._compareTime(e.data,i.data,a);const s=this._getNationSortName(e.data[t]),n=this._getNationSortName(i.data[t]);let r=s.localeCompare(n)*a;return 1===t||0===r&&(r=this._compareTime(e.data,i.data,1)),r}))}_initTable(){fe(this,$e).append("thead").append("tr").selectAll("th").data(["Time","Port","Attacker","Defender"]).join("th").datum(((t,e)=>({data:t,index:e}))).attr("scope","col").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),fe(this,$e).append("tbody")}_updateTable(){ve(this,ye,fe(this,$e).select("tbody").selectAll("tr").data(fe(this,ge),(t=>t.sort)).join((t=>t.append("tr")))),fe(this,ye).selectAll("td").data((t=>t.data.slice(0,-1))).join((t=>t.append("td").html((t=>t))))}_pbListSelected(){ve(this,$e,fe(this,_e).outputSel.append("table").attr("class","table table-sm table-striped table-hover text-table table-sort")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}}var je=a(3838),Ie=a(1460);function Ce(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Ae(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ee(t,e,"get"))}function Pe(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Ee(t,e,"set"),a),a}function Ee(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const Oe=(t,e,a)=>`${(0,te.hi)(e)} – ${(0,te.hi)(a)}`;var Re=new WeakMap,Ne=new WeakMap,Ze=new WeakMap,qe=new WeakMap,Fe=new WeakMap,Ke=new WeakMap,ze=new WeakMap,Be=new WeakMap,Ve=new WeakMap;class He{constructor(t){Ce(this,Re,{writable:!0,value:void 0}),Ce(this,Ne,{writable:!0,value:"List of admiralty items and recipes"}),Ce(this,Ze,{writable:!0,value:void 0}),Ce(this,qe,{writable:!0,value:void 0}),Ce(this,Fe,{writable:!0,value:void 0}),Ce(this,Ke,{writable:!0,value:{}}),Ce(this,ze,{writable:!0,value:[]}),Ce(this,Be,{writable:!0,value:[]}),Ce(this,Ve,{writable:!0,value:void 0}),Pe(this,qe,(0,Ie.Oy)(t)),Pe(this,Re,(0,r.MF)(Ae(this,Ne))),Pe(this,Ze,`menu-${Ae(this,Re)}`),this._setupListener()}async _loadAndSetupData(){Pe(this,ze,(await a.e(303).then(a.t.bind(a,3092,19))).default),Pe(this,Be,(await a.e(757).then(a.t.bind(a,7002,19))).default.recipe),Pe(this,Ve,new Map(Ae(this,Be).flatMap((t=>t.recipes.map((t=>[t.id,t]))))))}async _menuClicked(){(0,s.KS)("Tools",Ae(this,Ne)),Ae(this,Fe)?Ae(this,Fe).show():(await this._loadAndSetupData(),Pe(this,Fe,new h.Z(Ae(this,Ne),"lg")),this._setupSelect(),this._setupSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${Ae(this,Ze)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return Ae(this,Be).map((t=>`<optgroup label="${t.group}">${t.recipes.filter((t=>"Any"===t.serverType||t.serverType===Ae(this,qe))).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,Oe)}</option>`)).join("")}</optgroup>`)).join("")}_setupSelect(){Pe(this,Ke,new d.Z(Ae(this,Re),Ae(this,Fe).baseIdSelects,{dropupAuto:!1,liveSearch:!0,placeholder:"Select item",virtualScroll:!0,width:"fit"},this._getOptions())),(0,je.Z)(`#${Ae(this,Fe).baseIdSelects} label`).attr("class","text-muted ps-2").text("Items listed here may not be available in the game (yet).")}_setupSelectListener(){Ae(this,Ke).select$.on("change",(()=>{this._recipeSelected()}))}_getRecipeData(t){return Ae(this,Ve).get(t)}_getRequirementText(t){let e='<table class="table table-sm table-hover text-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${(0,l.PK)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`${t.itemRequirements.map((t=>`<tr><td>${t.amount} ${t.name}</td></tr>`)).join("")}`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",i="";for(const e of Ae(this,ze)){const n=e[1].filter((e=>e.id===t.result.id));for(const t of n){var s;[a]=e,i=`<tr><td>${null===(s=t.properties)||void 0===s?void 0:s.map((t=>{const e=t.isPercentage?(0,o.QO)(t.amount/100):t.amount;return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}}return i?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm table-hover text-table"><tbody>${i}</tbody></table>`):e+=`<p>${(0,o.yI)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="card-group">';return a+='<div class="card"><div class="card-body">',a+='<h5 class="card-title">Item</h5>',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card"><div class="card-body">',a+='<h5 class="card-title">Result</h5>',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(){const t=Number(Ae(this,Ke).getValues()),e=Ae(this,Fe).outputSel;e.select("div").remove(),e.append("div").classed("mt-4",!0).html(this._getText(t))}}function Ue(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Qe(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ge(t,e,"get"))}function Je(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Ge(t,e,"set"),a),a}function Ge(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ye=new WeakMap,Xe=new WeakMap,ta=new WeakMap,ea=new WeakMap,aa=new WeakMap,ia=new WeakMap,sa=new WeakMap,na=new WeakMap,ra=new WeakMap;class oa{constructor(){Ue(this,Ye,{writable:!0,value:void 0}),Ue(this,Xe,{writable:!0,value:{}}),Ue(this,ta,{writable:!0,value:[]}),Ue(this,ea,{writable:!0,value:!0}),Ue(this,aa,{writable:!0,value:0}),Ue(this,ia,{writable:!0,value:{}}),Ue(this,sa,{writable:!0,value:void 0}),Ue(this,na,{writable:!0,value:"List of ships"}),Ue(this,ra,{writable:!0,value:void 0}),Je(this,sa,(0,r.MF)(Qe(this,na))),Je(this,ra,`menu-${Qe(this,sa)}`),this._setupListener()}async _loadAndSetupData(){const t=(await a.e(228).then(a.t.bind(a,8422,19))).default.sort((0,n.MR)(["class","-battleRating","name"]));Je(this,ta,t.map((t=>[[t.class,String(t.class)],[t.name,`${(0,l.Y8)(t.name)} ${t.battleRating<=n.rg?'<i class="ps-2 icon icon-small icon-lighter icon-shallow" role="img" aria-label="Shallow"></i>':""}`],[t.guns.total,String(t.guns.total)],[t.guns.damage.cannons,(0,o.yI)(t.guns.damage.cannons)],[t.battleRating,(0,o.yI)(t.battleRating)],[t.crew.max,(0,o.yI)(t.crew.max)],[t.speed.max,(0,o.QM)(t.speed.max,1)],[t.ship.turnSpeed,(0,o.QM)(t.ship.turnSpeed,1)],[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4].amount?String(t.guns.gunsPerDeck[4].amount):""],[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5].amount?String(t.guns.gunsPerDeck[5].amount):""],[t.sides.armour,`${(0,o.yI)(t.sides.armour)} <span class="badge badge-highlight">${t.sides.thickness}</span>`]])))}async _menuClicked(){(0,s.KS)("Tools",Qe(this,na)),Qe(this,Ye)?Qe(this,Ye).show():(await this._loadAndSetupData(),Je(this,Ye,new h.Z(Qe(this,na),"lg")),this._shipListSelected())}_setupListener(){var t;null===(t=document.querySelector(`#${Qe(this,ra)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_sortRows(t,e=!0){e&&Qe(this,aa)===t&&Je(this,ea,!Qe(this,ea)),Je(this,aa,t);const a=Qe(this,ea)?1:-1;Qe(this,Xe).sort(((e,i)=>1===t?e[t][0].localeCompare(i[t][0])*a:(e[t][0]-i[t][0])*a))}_initTable(){const t={group:new Map([["dummy1",2],["Guns",2],["dummy2",2],["Speed",2],["Chasers",2],["dummy3",1]]),element:new Set(["","Name","No.","Damage","<span class='caps'>br</span>","Crew","Max","Turn","Bow","Stern","Sides"])},e=Qe(this,ia).append("thead");e.append("tr").attr("class","thead-group").selectAll("th").data([...t.group]).join("th").classed("border-bottom-0",(t=>t[0].startsWith("dummy"))).classed("text-center",!0).attr("colspan",(t=>t[1])).attr("scope","col").text((t=>t[0].startsWith("dummy")?"":t[0])),e.append("tr").selectAll("th").data([...t.element]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>1===e)).classed("pe-1",((t,e)=>1!==e)).html((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),Qe(this,ia).append("tbody")}_updateTable(){Je(this,Xe,Qe(this,ia).select("tbody").selectAll("tr").data(Qe(this,ta),(t=>t[1][0])).join((t=>t.append("tr")))),Qe(this,Xe).selectAll("td").data((t=>t)).join((t=>t.append("td").classed("pe-1",((t,e)=>1!==e)).classed("text-start",((t,e)=>1===e)).html((t=>t[1]))))}_shipListSelected(){Je(this,ia,Qe(this,Ye).outputSel.append("table").attr("class","table table-sm table-striped table-hover table-sort")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}}var la=a(4695);function ha(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function da(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ua(t,e,"get"))}function ca(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ua(t,e,"set"),a),a}function ua(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}const pa=["Resources","Extra","Materials"];var ma=new WeakMap,wa=new WeakMap,fa=new WeakMap,va=new WeakMap,ba=new WeakMap,ga=new WeakMap,_a=new WeakMap,ya=new WeakMap,Sa=new WeakMap,ka=new WeakMap,$a=new WeakMap,Ma=new WeakMap,xa=new WeakMap;class Wa{constructor(){var t,e,a;ha(this,ma,{writable:!0,value:void 0}),ha(this,wa,{writable:!0,value:[]}),ha(this,fa,{writable:!0,value:{}}),ha(this,va,{writable:!0,value:{}}),ha(this,ba,{writable:!0,value:{}}),ha(this,ga,{writable:!0,value:void 0}),ha(this,_a,{writable:!0,value:{}}),ha(this,ya,{writable:!0,value:{}}),ha(this,Sa,{writable:!0,value:{}}),ha(this,ka,{writable:!0,value:{}}),ha(this,$a,{writable:!0,value:void 0}),ha(this,Ma,{writable:!0,value:"List of ship blueprints"}),ha(this,xa,{writable:!0,value:void 0}),a=t=>{var e;return(null===(e=da(this,va).wood.find((e=>e.name===t)))||void 0===e?void 0:e.amount)??0},(e="_getResourceAmount")in(t=this)?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,ca(this,$a,(0,r.MF)(da(this,Ma))),ca(this,xa,`menu-${da(this,$a)}`),this._setupListener()}async _setupWoodData(){ca(this,ka,new la.J(da(this,$a))),await da(this,ka).init()}async _loadAndSetupData(){ca(this,wa,(await a.e(263).then(a.t.bind(a,2830,19))).default);const t=(await a.e(263).then(a.t.bind(a,4845,19))).default;ca(this,ba,new Map(t.standard.map((t=>[t.name,{reales:t.reales,labour:(null==t?void 0:t.labour)??0}])))),ca(this,fa,new Map(t.seasoned.map((t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}])))),await this._setupWoodData()}async _menuClicked(){(0,s.KS)("Tools",da(this,Ma)),da(this,ga)?da(this,ga).show():(await this._loadAndSetupData(),ca(this,ga,new h.Z(da(this,Ma),"lg")),this._setupSelects(),this._setupShipSelectListener(),this._setupWoodSelectListener())}_setupListener(){var t;null===(t=document.querySelector(`#${da(this,xa)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getOptions(){return`${da(this,wa).sort((0,n.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}`}_setupShipSelect(){ca(this,_a,new d.Z(da(this,$a),da(this,ga).baseIdSelects,{noneSelectedText:"Select blueprint"},this._getOptions()))}_setupWoodSelects(){for(const t of Pt.Kf){const e={noneSelectedText:`Select ${t}`};da(this,ya)[t]=new d.Z(`${da(this,$a)}-wood-${t}`,da(this,ga).baseIdSelects,e,da(this,ka).getOptions(t)),da(this,ya)[t].disable()}}_setupSelects(){da(this,ga).selectsSel.attr("class","d-flex justify-content-between"),this._setupShipSelect(),this._setupWoodSelects()}_enableWoodSelects(){for(const t of Pt.Kf)da(this,ya)[t].enable()}_setDefaultWoods(){const t={frame:da(this,ka).findWoodId("frame","Fir"),trim:da(this,ka).findWoodId("trim","Crew Space")};for(const e of Pt.Kf)da(this,ya)[e].reset(t[e])}_setupShipSelectListener(){da(this,_a).select$.one("change",(()=>{this._enableWoodSelects(),this._setDefaultWoods(),this._initOutput()})).on("change",(()=>{ca(this,ma,String(da(this,_a).getValues())),ca(this,va,this._getBlueprintData(da(this,ma))),this._updateText()}))}_setupWoodSelectListener(){for(const t of Pt.Kf)da(this,ya)[t].select$.on("change",(()=>{this._updateText()}))}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join((t=>t.append("tr"))).selectAll("td").data((t=>t)).join((t=>t.append("td"))).classed("text-start",((t,e)=>0===e)).html((t=>t))}_updateText(){let t=da(this,va).resources.map((t=>[t.name,t.amount]));const e=e=>t.findIndex((t=>t[0]===e))??0,a=da(this,ka).getWoodName(Number(da(this,ya).trim.getValues())),i=da(this,ka).getWoodName(Number(da(this,ya).frame.getValues()));let s=!1,n=!1,r=0,l=0;if("Crew Space"===a){const a=this._getResourceAmount("Crew Space"),i=e("Hemp");t[i][1]=t[i][1]+a}else if(l=this._getResourceAmount("Planking"),a===i)r+=l;else{const i=e(a);i>=0?t[i][1]=t[i][1]+l:(n=!0,t.push([a,l]))}r+=this._getResourceAmount("Frame");const h=e(i);if(h>=0?t[h][1]=t[h][1]+r:(s=!0,t.push([i,r])),s&&n){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let d=[];da(this,va).price&&d.push(["Reales",da(this,va).price]),d.push(["Provisions",da(this,va).provisions]),da(this,va).permit&&d.push(["Permit",da(this,va).permit]),d.push(["Craft level",da(this,va).craftLevel],["Shipyard level",da(this,va).shipyardLevel],["Labour hours",da(this,va).labourHours],["Craft experience",da(this,va).craftXP]);const c=[];let u=0,p=0;const m=t=>{var e;return((null===(e=da(this,ba).get(t[0]))||void 0===e?void 0:e.reales)??0)*t[1]},w=t=>{var e;return((null===(e=da(this,ba).get(t[0]))||void 0===e?void 0:e.labour)??0)*t[1]},f=t=>{for(const e of t.filter((t=>da(this,ba).has(t[0]))))u+=m(e),p+=w(e)};f(t),f(d),u&&c.push(["Reales",(0,o.yI)(u)],["Labour hours",(0,o.yI)(p)]);let v=0,b=0,g=0,_=0;for(const t of Pt.Kf){const e=da(this,fa).get(String(da(this,ya)[t].getValues()));e&&(v+=(e.reales??0)*r,b+=(e.labour??0)*r,g+=(e.doubloon??0)*r,_+=(e.tool??0)*r)}v&&c.push(["(S) reales",(0,o.yI)(v)]),b&&c.push(["(S) labour hours",(0,o.yI)(b)]),g&&c.push(["(S) doubloons",(0,o.yI)(g)]),_&&c.push(["(S) tools",(0,o.yI)(_)]),t=t.map((t=>[t[0],(0,o.yI)(t[1])])),d=d.map((t=>[t[0],(0,o.yI)(t[1])])),this._updateTable(da(this,Sa).Resources,t),this._updateTable(da(this,Sa).Extra,d),this._updateTable(da(this,Sa).Materials,c)}_getBlueprintData(t){return da(this,wa).find((e=>e.name===t))??{}}_initOutput(){const t=da(this,ga).outputSel.append("div").attr("class","card-group mt-3"),e=e=>{const a=t.append("div").attr("class","card").append("div").attr("class","card-body");a.append("h5").attr("class","card-title").text(e),da(this,Sa)[e]=a.append("table").attr("class","table table-sm table-striped table-hover"),da(this,Sa)[e].append("thead"),da(this,Sa)[e].append("tbody")};for(const t of pa)e(t)}}function Ta(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function Da(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function La(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ia(t,e,"get"))}function ja(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Ia(t,e,"set"),a),a}function Ia(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ca=new WeakMap,Aa=new WeakMap,Pa=new WeakMap,Ea=new WeakMap,Oa=new WeakMap;class Ra{constructor(){Da(this,Ca,{writable:!0,value:void 0}),Da(this,Aa,{writable:!0,value:void 0}),Da(this,Pa,{writable:!0,value:"List of woods"}),Da(this,Ea,{writable:!0,value:void 0}),Da(this,Oa,{writable:!0,value:void 0}),Ta(this,"_modifiers",{}),Ta(this,"_rows",{}),Ta(this,"_sortAscending",{}),Ta(this,"_sortIndex",{}),Ta(this,"_switchesSel",void 0),Ta(this,"_tables",{}),Ta(this,"_woodData",{}),Ta(this,"_woodDataDefault",{}),Ta(this,"_modifiersNotUsed",new Set(["Boarding morale","Crew","Morale","Repair time","Ship material"])),ja(this,Aa,(0,r.MF)(La(this,Pa))),ja(this,Oa,`menu-${La(this,Aa)}`),ja(this,Ea,`checkbox-${La(this,Aa)}`),this._setupListener()}async _menuClicked(){(0,s.KS)("Tools",La(this,Pa)),La(this,Ca)?La(this,Ca).show():(await this._loadAndSetupData(),ja(this,Ca,new h.Z(La(this,Pa),"xl")),this._injectBody(),this._woodFamilySelected())}_setupListener(){var t;null===(t=document.querySelector(`#${La(this,Oa)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_getModifiers(t){const e=new Set;for(const a of this._woodDataDefault[t])for(const t of a.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))))e.add(t.modifier);return[...e].sort(n.I4)}async _loadData(){this._woodDataDefault=(await a.e(799).then(a.t.bind(a,1258,19))).default}_setupData(){for(const t of Pt.Kf){this._modifiers[t]=new Set(this._getModifiers(t));for(const e of this._woodDataDefault[t]){const a=new Set(e.properties.map((t=>t.modifier)));for(const i of this._modifiers[t])a.has(i)||e.properties.push({modifier:i,amount:0,isPercentage:!1});e.properties.sort(((t,e)=>t.modifier.localeCompare(e.modifier)))}}this._woodData={...this._woodDataDefault}}async _loadAndSetupData(){await this._loadData(),this._setupData()}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const i=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t.name.localeCompare(a.name)*i:(t.properties[e-1].amount-a.properties[e-1].amount)*i))}_initTable(t){this._sortAscending[t]=!0,this._tables[t].append("thead").append("tr").selectAll("th").data(["Wood",...this._modifiers[t]]).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-start",((t,e)=>0===e)).attr("role","columnheader").html((t=>t.data.replace(" ","<br>"))).on("click",((e,a)=>{this._sortRows(t,a.index)})),this._tables[t].append("tbody")}_injectBody(){const t=La(this,Ca).outputSel,e=t.append("div").attr("class","mb-3");for(const t of Pt.pe){const a=e.append("div").attr("class","form-check form-check-inline form-switch");a.append("input").attr("id",`${La(this,Ea)}-${t}`).attr("name",`${La(this,Ea)}`).attr("class","form-check-input").attr("type","checkbox").property("checked",!0),a.append("label").attr("for",`${La(this,Ea)}-${t}`).attr("class","form-check-label").text((0,n.fm)(t))}this._switchesSel=[...document.querySelectorAll(`input[name=${La(this,Ea)}]`)];for(const t of this._switchesSel)t.addEventListener("change",(t=>{t.preventDefault(),this._woodFamilySelected()}));for(const e of Pt.Kf)t.append("h5").text((0,n.fm)(`${e}s`)),this._tables[e]=t.append("table").attr("class","table table-sm table-striped table-hover table-sort"),this._initTable(e),this._updateTable(e),this._sortRows(e,0,!1)}_getFormattedAmount(t){let e;return e="Repair amount"===t.modifier&&t.amount?(0,o.nM)(t.amount,1):t.amount?(0,o.QM)(t.amount):"",e}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._woodData[t],(t=>t.id)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>[t.name,...t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).map((t=>this._getFormattedAmount(t)))])).join((t=>t.append("td").classed("text-start",((t,e)=>0===e)).html((t=>t))))}_woodFamilySelected(){const t=new Set;for(const e of this._switchesSel)if(e.checked){const a=e.id.replace(`${La(this,Ea)}-`,"");t.add(a)}for(const e of Pt.Kf)this._woodData[e]=this._woodDataDefault[e].filter((e=>t.has(e.family))),this._updateTable(e),this._sortRows(e,this._sortIndex[e],!1)}}var Na=a(8398),Za=a(8776),qa=a(2474),Fa=a(7995),Ka=a(8973),za=a(9937),Ba=a(9714),Va=a(6377),Ha=a.n(Va);function Ua(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Qa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ga(t,e,"get"))}function Ja(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Ga(t,e,"set"),a),a}function Ga(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ya=new WeakMap,Xa=new WeakMap,ti=new WeakMap,ei=new WeakMap,ai=new WeakMap,ii=new WeakMap,si=new WeakMap,ni=new WeakMap,ri=new WeakMap,oi=new WeakMap,li=new WeakMap,hi=new WeakMap,di=new WeakMap,ci=new WeakMap,ui=new WeakMap;class pi{constructor(t){Ua(this,Ya,{writable:!0,value:{}}),Ua(this,Xa,{writable:!0,value:0}),Ua(this,ti,{writable:!0,value:{}}),Ua(this,ei,{writable:!0,value:{}}),Ua(this,ai,{writable:!0,value:void 0}),Ua(this,ii,{writable:!0,value:{}}),Ua(this,si,{writable:!0,value:void 0}),Ua(this,ni,{writable:!0,value:{}}),Ua(this,ri,{writable:!0,value:void 0}),Ua(this,oi,{writable:!0,value:{}}),Ua(this,li,{writable:!0,value:0}),Ua(this,hi,{writable:!0,value:void 0}),Ua(this,di,{writable:!0,value:"Net income"}),Ua(this,ci,{writable:!0,value:void 0}),Ua(this,ui,{writable:!0,value:void 0}),Ja(this,si,t),Ja(this,hi,`show-${(0,r.MF)(Qa(this,di))}`),Ja(this,ui,`menu-${Qa(this,hi)}`),Ja(this,ci,(0,Ka.Z)().domain(n.nU.map((t=>t.short))).range(n.nU.map((t=>t.colours[0])))),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){return Math.floor(Qa(this,ti).node().offsetWidth)??0}_setupData(t){const e=t.ports.map((e=>{const a=t.server.find((t=>t.id===e.id))??{},i=t.pb.find((t=>t.id===e.id))??{};return{...e,...a,...i}})),a=(0,Na.Z)(e,(t=>t.netIncome))??0,i=(0,Za.Z)(e,(t=>t.netIncome))??0;Ja(this,Ya,(0,za.Z)().domain([a,i]).range([8,32]).clamp(!0));const s=new Set(["NT","FT"]),r=new Set,o=[...e.filter((t=>t.netIncome>0&&!s.has(t.nation))).map((t=>(r.add(t.nation),{id:t.name,value:t.netIncome,parentId:t.nation}))),...n.nU.filter((t=>r.has(t.short))).map((t=>({id:t.short,value:0,parentId:"World"}))),{id:"World",value:0,parentId:void 0}];Ja(this,ii,(0,qa.Z)()(o)),Ja(this,oi,(0,Fa.ZP)(Qa(this,ii)).sum((t=>t.data.value)))}async _loadData(){const t=[{fileName:`${Qa(this,si)}-ports.json`,name:"server"},{fileName:`${Qa(this,si)}-pb.json`,name:"pb"}],e={};return e.ports=(await a.e(462).then(a.t.bind(a,9131,19))).default,await(0,r.EZ)(t,e),e}async _loadAndSetupData(){(0,r.dM)();const t=await this._loadData();this._setupData(t),(0,r.V4)()}async _menuClicked(){(0,s.KS)("Tools",Qa(this,di)),Qa(this,ai)?Qa(this,ai).show():(await this._loadAndSetupData(),Ja(this,ai,new h.Z(Qa(this,di),"xl")),Ja(this,ti,Qa(this,ai).outputSel),this._initTreemap(),this._drawTreemap())}_setupListener(){var t;null===(t=document.querySelector(`#${Qa(this,ui)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_drawLegend(){const t=Math.floor(20*te.L9),e=.8*t,a=Math.floor(2*te.L9),i=Math.floor(5*te.L9),s=(Qa(this,oi).children??[]).sort(((t,e)=>e.value-t.value)),n=160+2*i,r=s.length*n-2*i,h=Math.ceil(r/Qa(this,li)),d=Math.ceil(s.length/h),c=Math.ceil(Qa(this,li)/d-2*i);Qa(this,ti).append("div").attr("class","d-flex flex-wrap justify-content-between mt-3").selectAll(".legend").data(s).join((s=>{const n=s.append("div").attr("class","legend mt-3"),r=n.append("svg").attr("width",c).attr("height",2*t+a);return r.append("rect").attr("width",c).attr("height",t).style("fill",(t=>Qa(this,ci).call(this,t.data.id))),r.append("rect").attr("x",i).attr("y","5%").attr("width",4*e/3).attr("height",e).attr("fill",(t=>`url(#${t.data.id})`)),r.append("text").attr("x",c-i).attr("y","25%").text((t=>t.data.id)).attr("class","text-end").style("fill",(t=>(0,l.IF)(Qa(this,ci).call(this,t.data.id)))),r.append("rect").attr("class","opacity-low").attr("y",t+a).attr("width",c).attr("height",t).style("fill",(t=>Qa(this,ci).call(this,t.data.id))),r.append("rect").attr("y",t+a).attr("width",(t=>{var e;return c*(t.value/((null===(e=t.parent)||void 0===e?void 0:e.value)??1))})).attr("height",t).style("fill",(t=>Qa(this,ci).call(this,t.data.id))),r.append("text").attr("x",c-i).attr("y","75%").html((t=>(0,o.Dw)(t.value,!0))).style("text-anchor","end"),n}))}_getTooltipText(t){var e,a,i,s,n;return`\n            <div class="d-flex justify-content-between align-items-center">\n            <div class="d-flex flex-column text-start mt-1 me-3 p-0">\n                <div><i class="flag-icon-${null===(e=t.parent)||void 0===e||null===(a=e.data)||void 0===a?void 0:a.id} flag-icon-small me-2" role="img"></i><span class="x-large">${t.data.id??""}</span></div>\n            </div>\n            <div class="d-flex flex-column text-start mt-1 p-0">\n                <div class="me-3">\n                    ${(0,o.Dw)(t.data.data.value)}<br />\n                    <span class="des">Port</span>\n                </div>\n                <div class="me-3">\n                    ${(0,o.me)(t.data.data.value/((null===(i=t.parent)||void 0===i?void 0:i.value)??1))}<br />\n                    <span class="des">Nation</span>\n                </div>\n                <div class="me-3">\n                    ${(0,o.me)(t.data.data.value/((null===(s=t.parent)||void 0===s||null===(n=s.parent)||void 0===n?void 0:n.value)??1))}<br />\n                    <span class="des">World</span>\n                </div>\n            </div>\n            </div>`}_hideDetails(){void 0!==Qa(this,ri)&&(Qa(this,ri).dispose(),Ja(this,ri,void 0))}_showDetails(t,e){const a=t.currentTarget;this._hideDetails(),Ja(this,ri,new(_t())(a,{html:!0,template:'<div class="tooltip  bs-tooltip-top" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-smaller"></div></div>',title:this._getTooltipText(e),trigger:"manual",sanitize:!1})),Qa(this,ri).show()}_drawCells(t){Qa(this,ei).append("g").attr("class","cells").selectAll(".cell").data(t).join((t=>t.append("path").attr("class","cell").attr("d",(t=>`M${t.polygon.join(",")}z`)).style("fill",(t=>{var e;return Qa(this,ci).call(this,(null===(e=t.parent)||void 0===e?void 0:e.data.id)??"")}))))}_drawLabels(t){const e=Qa(this,ei).append("g").attr("class","labels").selectAll(".label").data(t).join((t=>t.append("g").attr("class","label").attr("transform",(t=>`translate(${t.polygon.site.x},${t.polygon.site.y})`)).style("font-size",(t=>`${Qa(this,Ya).call(this,t.data.data.value)}px`)).style("fill",(t=>{var e;return(0,l.IF)(Qa(this,ci).call(this,(null===(e=t.parent)||void 0===e?void 0:e.data.id)??""))}))));e.append("text").attr("class","name").text((t=>t.data.data.id)),e.append("text").attr("class","value").html((t=>(0,o.Pj)(t.data.data.value,!0)))}_drawHover(t){Qa(this,ei).append("g").selectAll(".hoverer").data(t).join((t=>t.append("path").attr("class","hoverer").attr("d",(t=>`M${t.polygon.join(",")}z`)).on("mouseover",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",(()=>{this._hideDetails()}))))}_drawTreemap(){const t=Qa(this,oi).leaves();this._drawCells(t),this._drawLabels(t),this._drawHover(t),this._drawLegend()}_initTreemap(){Ja(this,Xa,pi.getHeight()),Ja(this,li,this._getWidth()),Ja(this,ni,Qa(this,ti).append("svg").attr("class","voronoi").attr("width",Qa(this,li)).attr("height",Qa(this,Xa))),Ja(this,ei,Qa(this,ni).append("g").attr("class","drawingArea")),(0,Ba.voronoiTreemap)().clip([[0,0],[0,Qa(this,Xa)],[Qa(this,li),Qa(this,Xa)],[Qa(this,li),0]]).minWeightRatio(1e-10).prng(Ha()(Qa(this,hi)))(Qa(this,oi))}}var mi=a(1316),wi=a(9089),fi=a(4752),vi=a(6437),bi=a(259),gi=a(4038),_i=a(3419),yi=a(8990),Si=a(7454);function ki(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function $i(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Mi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Wi(t,e,"get"))}function xi(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Wi(t,e,"set"),a),a}function Wi(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ti=new WeakMap,Di=new WeakMap,Li=new WeakMap,ji=new WeakMap,Ii=new WeakMap,Ci=new WeakMap,Ai=new WeakMap,Pi=new WeakMap,Ei=new WeakMap,Oi=new WeakMap;class Ri{constructor(t){$i(this,Ti,{writable:!0,value:void 0}),$i(this,Di,{writable:!0,value:{}}),$i(this,Li,{writable:!0,value:void 0}),$i(this,ji,{writable:!0,value:{}}),$i(this,Ii,{writable:!0,value:{}}),$i(this,Ci,{writable:!0,value:{}}),$i(this,Ai,{writable:!0,value:{}}),$i(this,Pi,{writable:!0,value:void 0}),$i(this,Ei,{writable:!0,value:"Ownership overview"}),$i(this,Oi,{writable:!0,value:void 0}),ki(this,"_ownershipData",{}),ki(this,"_nationData",{}),ki(this,"_colourScale",void 0),xi(this,Li,t),xi(this,Pi,`show-${(0,r.MF)(Mi(this,Ei))}`),xi(this,Oi,`menu-${Mi(this,Pi)}`),this._colourScale=(0,Ka.Z)().range(r.q4),this._setupListener()}static getHeight(){var t;return Math.floor(.75*((null===(t=top)||void 0===t?void 0:t.innerHeight)??0))}_getWidth(){return Math.floor(Mi(this,ji).node().offsetWidth)??0}async _loadAndSetupData(){(0,r.dM)(),this._nationData=await(0,r.qP)(`${Mi(this,Li)}-nation.json`),this._ownershipData=await(0,r.qP)(`${Mi(this,Li)}-ownership.json`),(0,r.V4)()}async _menuClicked(){(0,s.KS)("Tools",Mi(this,Ei)),Mi(this,Ti)?Mi(this,Ti).show():(await this._loadAndSetupData(),xi(this,Ti,new h.Z(Mi(this,Ei),"xl")),this._setupOutput(),this._setupTextures(),this._setupSelect(),this._setupSelectListener(),this._injectArea())}_setupListener(){var t;null===(t=document.querySelector(`#${Mi(this,Oi)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_setupOutput(){xi(this,ji,Mi(this,Ti).outputSel),xi(this,Ii,Mi(this,ji).append("div")),xi(this,Ci,Mi(this,ji).append("svg").attr("class","area"))}_setupTextures(){const t=["2/8","4/8","6/8"];let e=0;for(const{short:a,colours:i}of n.nU)1===i.length?Mi(this,Ai)[a]=Si.Z.lines().stroke(i[0]).background(i[0]).id(`texture-${a}`):2===i.length?(Mi(this,Ai)[a]=Si.Z.lines().orientation(t[e]).size(40).strokeWidth(20).stroke(i[0]).background(i[1]).id(`texture-${a}`),e=(e+1)%t.length):Mi(this,Ai)[a]=Si.Z.circles().radius(5).strokeWidth(3).stroke(i[1]).fill(i[2]).background(i[0]).id(`texture-${a}`),Mi(this,Ci).call(Mi(this,Ai)[a])}_getOptions(){return`${this._ownershipData.map((t=>`<option value="${t.region}">${t.region}</option>;`)).join("")}`}_setupSelect(){xi(this,Di,new d.Z(Mi(this,Pi),Mi(this,Ti).baseIdSelects,{noneSelectedText:"Select region"},this._getOptions()))}_setupSelectListener(){Mi(this,Di).select$.on("change",(()=>{this._regionSelected()}))}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,Ri.getHeight()),a=0,i=32,s=0,o=n.nU.filter((t=>9!==t.id)).map((t=>t.short)),h=this._nationData;h.keys=o;const d=(0,bi.Z)().offset(gi.Z).keys(o)(h);Mi(this,Ci).attr("width",t).attr("height",e),(()=>{const c=(()=>{const n=(0,za.Z)().domain((0,wi.Z)(h,(t=>new Date(t.date)))).range([s,t-a]),r=(0,za.Z)().domain([(0,Na.Z)(d[0],(t=>t[0])),(0,Za.Z)(d[d.length-1],(t=>t[1]))]).range([e-i,0]);return(0,_i.Z)().x((t=>n(new Date(t.data.date))??0)).y0((t=>r(t[0])??0)).y1((t=>r(t[1])??0)).curve(yi.ZP)})(),u=new Map(n.nU.map((t=>[t.short,t.name])));this._colourScale.domain(o),Mi(this,Ci).selectAll("path.nation").data(d).join((t=>t.append("path").attr("class","nation").attr("fill",(t=>Mi(this,Ai)[t.key].url())).attr("stroke",r.Om).attr("stroke-width","3px").attr("d",c))),Mi(this,Ci).selectAll(".area-label").data(d).join((t=>t.append("text").attr("class","area-label text-shadow").text((t=>u.get(t.key)??"")).attr("fill",(t=>{var e;return(0,l.IF)((null===(e=(0,n.$i)(t.key))||void 0===e?void 0:e.colours[0])??"")})).attr("transform",(0,mi.areaLabel)(c))))})(),Mi(this,Ci).append("g").call((n=>{const r=(0,vi.Z)().domain((0,wi.Z)(h,(t=>new Date(t.date)))).range([s,t-a]);n.attr("transform",`translate(0,${e-i})`).call((0,fi.LL)(r).ticks(t/80).tickSizeOuter(0)),n.attr("font-size",".8rem").attr("font-family","")}))}async _injectChart(t){(await a.e(782).then(a.bind(a,4058))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(Mi(this,Ii).node())}_regionSelected(){const t=String(Mi(this,Di).getValues());Mi(this,Ii).selectAll("*").remove();const e=this._ownershipData.filter((e=>e.region===t)).map((t=>t.data))[0];this._injectChart(e)}}function Ni(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Zi(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,qi(t,e,"set"),a),a}function qi(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Fi=new WeakMap;class Ki extends h.Z{constructor(t,e){super(t,"xl"),Ni(this,Fi,{writable:!0,value:void 0}),Zi(this,Fi,e),this._init()}getBaseIdSelects(t){return`${super.baseIdSelects}-${t}`}getBaseIdOutput(t){return`${super.baseIdOutput}-${t}`}_init(){this._injectModal()}_injectModal(){const t=super.bodySel.append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const a of function(t,e){return e.get?e.get.call(t):e.value}(e=this,qi(e,Fi,"get"))){const e=t.append("div").attr("class","col-md-3 ms-auto pt-2 "+("base"===a?"column-base":"column-comp bg-paper"));e.append("div").attr("id",`${this.getBaseIdSelects(a)}`),e.append("div").attr("id",`${this.getBaseIdOutput(a)}`)}var e}}function zi(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Bi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Hi(t,e,"get"))}function Vi(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,Hi(t,e,"set"),a),a}function Hi(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var Ui=new WeakMap,Qi=new WeakMap;class Ji{constructor(t,e){zi(this,Ui,{writable:!0,value:void 0}),zi(this,Qi,{writable:!0,value:void 0}),Vi(this,Ui,(0,je.Z)(`#${t}`)),Vi(this,Qi,e),this._setupMainDiv()}get div(){return Bi(this,Ui)}get woodData(){return Bi(this,Qi)}_setupMainDiv(){Bi(this,Ui).select("div").remove(),Bi(this,Ui).append("div")}getProperty(t,e){const a=(null==t?void 0:t.properties.find((t=>t.modifier===e)))??{};return{amount:(null==a?void 0:a.amount)??0,isPercentage:(null==a?void 0:a.isPercentage)??!1}}}function Gi(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function Yi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ts(t,e,"get"))}function Xi(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ts(t,e,"set"),a),a}function ts(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var es=new WeakMap;class as extends Ji{constructor(t,e,a){super(t,e),Gi(this,es,{writable:!0,value:void 0}),Xi(this,es,a),this._printText()}_getPropertySum(t){const e=super.getProperty(Yi(this,es).frame,t),a=super.getProperty(Yi(this,es).trim,t);return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getText(t){let e='<table class="table table-striped table-hover text-table mt-4"><thead>';e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[a,i]of t){if(e+=`<tr><td>${a}</td><td>${i.isPercentage?(0,o.ub)(i.amount/100):(0,o.$1)(i.amount)}`,e+='<span class="rate">',i.amount>0){e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${i.amount/i.max*50}%;"></span>`}else if(i.amount<0){const t=i.amount/i.min*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const t=new Map;for(const e of super.woodData.modifierNames){const a=this._getPropertySum(e);t.set(e,{amount:a.amount,isPercentage:a.isPercentage,min:super.woodData.getMinProperty(e),max:super.woodData.getMaxProperty(e)})}super.div.html(this._getText(t))}}function is(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function ss(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,rs(t,e,"get"))}function ns(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,rs(t,e,"set"),a),a}function rs(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var os=new WeakMap,ls=new WeakMap;class hs extends Ji{constructor(t,e,a,i){super(t,e),is(this,os,{writable:!0,value:void 0}),is(this,ls,{writable:!0,value:void 0}),ns(this,os,a),ns(this,ls,i),this._printTextComparison()}static _getDiff(t,e,a,i=1){const s=Number.parseFloat((t-e).toFixed(i));return`${a?(0,o.ub)(t/100,i):(0,o.$1)(t)} <span class="badge bg-white text-dark">${(0,o.LQ)(s)}</span>`}_getBasePropertySum(t){const e=super.getProperty(ss(this,os).frame,t),a=super.getProperty(ss(this,os).trim,t);return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getComparePropertySum(t){const e=super.getProperty(ss(this,ls).frame,t),a=super.getProperty(ss(this,ls).trim,t);return{amount:e.amount+a.amount,isPercentage:e.isPercentage&&a.isPercentage}}_getText(t){const e=50;let a=0,i=0,s=0,n="",r='<table class="table table-striped table-hover text-table mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,l]of t)r+=`<tr><td>${o}</td><td>${hs._getDiff(l.compare,l.base,l.isPercentage)}`,r+='<span class="rate">',l.compare>=0?(l.base>=0?l.compare>l.base?(a=l.base,i=l.compare-l.base,n="pos"):(a=l.compare,i=l.base-l.compare,n="neg"):(a=0,i=l.compare,n="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+=`<span class="bar pos diff" style="width:${a/l.max*e}%;"></span>`,r+=`<span class="bar ${n}" style="width:${i/l.max*e}%;"></span>`):l.compare<0?(l.base<0?l.compare>=l.base?(a=l.compare,i=l.base-l.compare,s=-l.base,n="pos"):(a=l.base,i=l.compare-l.base,s=-l.compare,n="neg"):(a=0,i=l.compare,s=-l.compare,n="neg"),r+=`<span class="bar neutral" style="width:${e+s/l.min*e}%;"></span>`,r+=`<span class="bar ${n}" style="width:${i/l.min*e}%;"></span>`,r+=`<span class="bar neg diff" style="width:${a/l.min*e}%;"></span>`):r+='<span class="bar neutral"></span>',r+="</span></td></tr>";return r+="</tbody></table>",r}_printTextComparison(){const t=new Map;for(const e of super.woodData.modifierNames){const a=this._getBasePropertySum(e),i=this._getComparePropertySum(e);t.set(e,{base:a.amount,compare:i.amount,isPercentage:a.isPercentage,min:super.woodData.getMinProperty(e),max:super.woodData.getMaxProperty(e)})}super.div.html(this._getText(t))}}function ds(t,e,a){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,a)}function cs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ps(t,e,"get"))}function us(t,e,a){return function(t,e,a){if(e.set)e.set.call(t,a);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=a}}(t,ps(t,e,"set"),a),a}function ps(t,e,a){if(!e.has(t))throw new TypeError("attempted to "+a+" private field on non-instance");return e.get(t)}var ms=new WeakMap,ws=new WeakMap,fs=new WeakMap,vs=new WeakMap,bs=new WeakMap,gs=new WeakMap,_s=new WeakMap,ys=new WeakMap,Ss=new WeakMap;class ks{constructor(t="compare-wood"){ds(this,ms,{writable:!0,value:{}}),ds(this,ws,{writable:!0,value:{}}),ds(this,fs,{writable:!0,value:{}}),ds(this,vs,{writable:!0,value:void 0}),ds(this,bs,{writable:!0,value:{}}),ds(this,gs,{writable:!0,value:{}}),ds(this,_s,{writable:!0,value:void 0}),ds(this,ys,{writable:!0,value:void 0}),ds(this,Ss,{writable:!0,value:void 0}),us(this,ys,t),us(this,_s,"compare-wood"===cs(this,ys)?"Compare woods":cs(this,ys)),us(this,Ss,`menu-${cs(this,ys)}`),"compare-wood"===cs(this,ys)&&this._setupMenuListener(),this._setupData()}_enableSelects(t){for(const e of Pt.Kf)cs(this,bs)[t][e].enable()}_disableSelects(t){for(const e of Pt.Kf)cs(this,bs)[t][e].disable()}initSelects(t,e){cs(this,bs)[t]={};for(const a of Pt.Kf)cs(this,bs)[t][a]=new d.Z(`${cs(this,ys)}-${t}-${a}`,e,{placeholder:`Select ${a}`},cs(this,gs).getOptions(a))}async init(){us(this,gs,new la.J(cs(this,ys))),await cs(this,gs).init();for(const t of cs(this,ms))cs(this,fs)[t]=!1,"compare-wood"===cs(this,ys)&&(this.initSelects(t,cs(this,vs).getBaseIdSelects(t)),this._setupSelectListener(t),"base"!==t&&this._disableSelects(t))}_setupData(){"compare-wood"===cs(this,ys)?us(this,ws,["c1","c2","c3"]):"ship-journey"===cs(this,ys)?us(this,ws,[]):"compare-ship"===cs(this,ys)&&us(this,ws,["c1","c2"]),us(this,ms,[...cs(this,ws)]),cs(this,ms).unshift("base")}_setupMenuListener(){document.querySelector(`#${cs(this,Ss)}`).addEventListener("click",(()=>{this._menuClicked()}))}async _menuClicked(){(0,s.KS)("Menu",cs(this,_s)),cs(this,vs)?cs(this,vs).show():(us(this,vs,new Ki(cs(this,_s),cs(this,ms))),await this.init())}_setColumns(t){if("base"===t){cs(this,fs)[t]=!0,new as(cs(this,vs).getBaseIdOutput(t),cs(this,gs),this._getWoodData("base"));for(const t of cs(this,ws))"compare-wood"===cs(this,ys)&&this._enableSelects(t),cs(this,fs)[t]&&(cs(this,fs)[t]=!0,new hs(cs(this,vs).getBaseIdOutput(t),cs(this,gs),this._getWoodData("base"),this._getWoodData(t)))}else cs(this,fs)[t]=!0,new hs(cs(this,vs).getBaseIdOutput(t),cs(this,gs),this._getWoodData("base"),this._getWoodData(t))}_setOtherSelect(t,e){const a="frame"===e?"trim":"frame";0===Number(cs(this,bs)[t][a].getValues())&&cs(this,bs)[t][a].reset(cs(this,gs).defaultWoodId[a])}woodSelected(t,e){this._setOtherSelect(t,e),"compare-wood"===cs(this,ys)&&this._setColumns(t)}_setupSelectListener(t){for(const e of Pt.Kf){const{select$:a}=cs(this,bs)[t][e];a.on("change",(()=>{this.woodSelected(t,e)}))}}_getWoodData(t){const e=Number(cs(this,bs)[t].frame.getValues()),a=Number(cs(this,bs)[t].trim.getValues());return{frame:cs(this,gs).getWoodTypeData(e),trim:cs(this,gs).getWoodTypeData(a)}}}const $s=(t,e)=>{(0,i.V4)(e),new ks,new Ra,new S,new K,new bt(t),new It,new Xt,new ce,new Le(t),new He(t),new oa,new Wa,new pi(t),new Ri(t)}},5042:()=>{}}]);