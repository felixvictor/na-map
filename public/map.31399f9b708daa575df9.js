/*! For license information please see map.31399f9b708daa575df9.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+RFf":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"0kUG":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"1j+5":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"1qWw":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return g}));n("iPZ8"),n("kypl"),n("pCzD"),n("lYjL"),n("4owi"),n("/YXa"),n("8cZI"),n("lmye"),n("D/wG"),n("1Qwx"),n("fp7Y"),n("JBxO"),n("9UJh"),n("WoWj"),n("3dw1"),n("U00V"),n("3XUK"),n("Peo2");var i=n("PVJp"),r=n("f4w0"),a=n("Av7d"),o=n("0lY5"),s=n("4PeS");function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var d=function(t){return t*t},l=function(t){return Math.sqrt(d(t.x)+d(t.y)+d(t.z))},u=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},h=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},p=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},_=function(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}},f=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},m=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}};var g=function(){function e(t){var e=this;this._ports=t,this._NumberOfInputs=3,this._baseName="Get position",this._baseId="get-position",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._modal$=null,this._select=[],this._input=[],this._selector=[],c(new Array(this._NumberOfInputs).keys()).forEach((function(t){e._select[t]=e._baseId+"-"+t+"-select",e._input[t]=e._baseId+"-"+t+"-input"})),this._setupListener()}var n=e.prototype;return n._navbarClick=function(t){Object(r.b)("Menu","Get position"),t.stopPropagation(),this._positionSelected()},n._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",(function(e){return t._navbarClick(e)}))},n._injectModal=function(){var t=this;Object(a.C)(this._modalId,this._baseName,"","Go");var e=Object(i.a)("#"+this._modalId+" .modal-body");e.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");var n=e.append("form"),r=n.append("datalist").attr("id","defaultDistances");[5,10,15,20,30,50,100,200].forEach((function(t){r.append("option").attr("value",t)})),c(new Array(this._NumberOfInputs).keys()).forEach((function(e){var i=n.append("div").attr("class","form-row");i.append("div").attr("class","col-md-6").append("label").append("select").attr("name",t._select[e]).attr("id",t._select[e]).attr("class","selectpicker"),i.append("div").attr("class","col-md-6").append("input").attr("id",t._input[e]).attr("name",t._input[e]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)}))},n._setupSelects=function(){var e=this,n=""+this._ports.portDataDefault.map((function(t){return{id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}})).sort(Object(o.M)(["name"])).map((function(t){return'<option data-subtext="'+t.nation+'">'+t.name+"</option>"})).join("");c(new Array(this._NumberOfInputs).keys()).forEach((function(i){e._selector[i]=document.getElementById(e._select[i]),e._selector[i].insertAdjacentHTML("beforeend",n),t(e._selector[i]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0})}))},n._initModal=function(){this._injectModal(),this._setupSelects()},n._showAndGoToPosition=function(){var t=this._ports.portData.map((function(t){return{x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance}})),e=function(t,e,n,i){void 0===i&&(i=!1);var r=_(h(e,t),l(h(e,t))),a=u(r,h(n,t)),o=h(h(n,t),f(r,a)),s=_(o,l(o)),c=m(r,s),g=l(h(e,t)),v=u(s,h(n,t)),b=(d(t.r)-d(e.r)+d(g))/(2*g),y=(d(t.r)-d(n.r)+d(a)+d(v))/(2*v)-a/v*b,w=d(t.r)-d(b)-d(y);Math.abs(w)<1e-10&&(w=0);var S=Math.sqrt(w);if(isNaN(S))return null;o=p(t,p(f(r,b),f(s,y)));var x=p(o,f(c,S)),I=h(o,f(c,S));return 0===S||i?o:[x,I]}(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),this._ports._map._f11.printCoord(e.x,e.y),this._ports._map.zoomAndPan(e.x,e.y,1);var n=Math.round(Object(a.o)(e.x,e.y)/-1e3),i=Math.round(Object(a.p)(e.x,e.y)/-1e3);Object(o.f)(n,i),new s.a("Get position","Coordinates copied to clipboard.")}else new s.a("Get position","No intersection found.")},n._useUserInput=function(){var t=this,e=new Map;c(new Array(this._NumberOfInputs).keys()).forEach((function(n){var i=t._selector[n].selectedIndex?t._selector[n].options[t._selector[n].selectedIndex].text:"",r=Number(document.getElementById(t._input[n]).value);r&&""!==i&&e.set(i,1.04*r*a.e)})),e.size===this._NumberOfInputs?(this._ports.setShowRadiusSetting("position"),this._ports.portData=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter((function(t){return e.has(t.name)})).map((function(t){return t.distance=e.get(t.name),t})))),this._ports.update(),this._showAndGoToPosition()):new s.a("Get position","Not enough data.")},n._positionSelected=function(){var e=this;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId)),this._modal$.modal("show").one("hidden.bs.modal",(function(){e._useUserInput()}))},e}()}).call(this,n("xeH2"))},"2ISq":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"2beG":function(t,e,n){t.exports=n.p+"images/flags/PRa.svg"},"4PeS":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a}));n("3XUK"),n("9q+R");var i=n("PVJp"),r=n("Av7d"),a=function(){function e(e,n){this._title=e,this._text=n,this._setupDiv(),this._set(e,n),t(this._toast.node()).toast({autohide:!1}).toast("show"),window.setTimeout(this._remove.bind(this),1e4)}var n=e.prototype;return n._setupDiv=function(){this._mainDiv=Object(i.a)("#toast-column")},n._set=function(){this._toast=this._mainDiv.append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true");var t=this._toast.append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",r.z).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(this._title),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),this._toast.append("div").attr("class","toast-body").html(this._text)},n._remove=function(){this._toast.remove()},e}()}).call(this,n("xeH2"))},"4aJ5":function(t,e,n){t.exports=n.p+"images/flags/US.svg"},"62GW":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return l}));n("fp7Y"),n("SQIU"),n("Muwe"),n("SgDD"),n("3XUK"),n("Peo2");var i=n("PVJp"),r=n("NBGV"),a=n("TiKg"),o=n.n(a),s=(n("YmdP"),n("W/Hz"),n("8sDi"),n("cRa1"),n("+NlM"),n("kCRU"),n("0lY5")),c=n("f4w0"),d=n("Av7d"),l=function(){function e(){this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._timeGroupId="input-group-"+this._baseId,this._timeInputId="input-"+this._baseId,this._setupSvg(),this._setupArrow(),this._setupListener()}var n=e.prototype;return n._setupSvg=function(){this._svg=Object(i.a)("#wind svg")},n._setupArrow=function(){var t=this._windArrowWidth,e=2*this._windArrowWidth;Object(i.a)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d","M0,-"+t+"L"+e+",0L0,"+t).attr("class","wind-predict-arrow-head")},n._navbarClick=function(t){Object(c.b)("Menu",this._baseName),t.stopPropagation(),this._windSelected()},n._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",(function(e){return t._navbarClick(e)}))},n._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var n=e.call(this);return this.container.append(this.tooltip),n},window.tooltip=function(t){return Object(s.k)(t.value)+"<br>"+t.value+"°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/s.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},n._injectModal=function(){o.a.locale("en-gb"),Object(d.C)(this._modalId,this._baseName,"sm");var e=Object(i.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId),n=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);n.append("label").attr("for",this._sliderId).text("Current in-game wind"),n.append("div").attr("id",this._sliderId).attr("class","rslider");var r=e.append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");r.append("label").attr("for",this._timeInputId).text("Predict time (server time)");var a=r.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest");a.append("input").classed("form-control datetimepicker-input",!0).attr("type","text").attr("id",this._timeInputId).attr("data-target","#"+this._timeGroupId).attr("aria-label",this._timeGroupId).attr("required",""),a.append("div").classed("input-group-append",!0).attr("data-target","#"+this._timeGroupId).attr("data-toggle","datetimepicker").append("span").attr("class","input-group-text").append("i").attr("class","icon icon-clock"),t("#"+this._timeGroupId).datetimepicker({defaultDate:o.a.utc(),format:"LT"})},n._initModal=function(){this._injectModal(),this._setupWindInput()},n._windSelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",(function(){e._useUserInput()}))},n._useUserInput=function(){var e=Object(s.E)(this._sliderId),n=t("#"+this._timeInputId).val().trim();this._predictWind(e,n)},n._predictWind=function(t,e){o.a.locale("en-gb");var n,i=/(\d+)[\s.:](\d+)/.exec(e),r=parseInt(i[1],10),a=parseInt(i[2],10);n=Number.isNaN(Number(t))?Object(s.e)(t):Number(t);var c=o()().utc().seconds(0).milliseconds(0),l=o()(c).hour(r).minutes(a);l.isBefore(c)&&l.add(1,"day");var u=l.diff(c,"seconds"),h=360+(n-d.s*u)%360;this._printPredictedWind(h,l.format("H.mm"),Object(s.h)(t),c.format("H.mm"))},n._printCompass=function(t){var e=Object(r.a)(),n=Math.min(this._height/1.4,this._width/1.4)/2,i=this._width/2,a=this._height/2.8,o=Object(s.i)(t),c=.6*n,d=c*Math.cos(o),l=c*Math.sin(o),u=[[Math.round(i+d),Math.round(a+l)],[Math.round(i-d),Math.round(a-l)]];this._svg.attr("height",this._height).attr("width",this._width);var h=this._svg.append("svg").attr("class","compass").attr("x",i).attr("y",a);Object(s.H)({element:h,radius:n}),this._svg.append("path").datum(u).attr("d",e).attr("marker-end","url(#wind-arrow)")},n._printText=function(t,e,n,i){var r=Object(s.h)(t),a=parseInt(window.getComputedStyle(document.getElementById("wind")).getPropertyValue("line-height"),10),o=this._svg.append("svg"),c=o.append("text").attr("x","50%").attr("y","33%").html("From "+Object(s.l)(r,!0)+" at "+e),d=o.append("text").attr("x","50%").attr("y","66%").attr("class","text-light-separation").html("Currently at "+i+" from "+Object(s.l)(n,!0)),l=c.node().getBoundingClientRect(),u=d.node().getBoundingClientRect(),h=2*Math.max(l.height,u.height)+a,p=Math.max(l.width,u.width)+a;o.attr("x",(this._width-p)/2).attr("y","72%").attr("height",h).attr("width",p)},n._addBackground=function(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)},n._printPredictedWind=function(t,e,n,i){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,n,i),this._addBackground()},n.setPosition=function(t,e){this._svg.style("margin-left",e+"px").style("margin-top",t+"px")},n.clearMap=function(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)},e}()}).call(this,n("xeH2"))},"8gAj":function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return v}));n("iPZ8"),n("kypl"),n("pCzD"),n("C4nn"),n("4owi"),n("/YXa"),n("lmye"),n("D/wG"),n("fp7Y"),n("JBxO"),n("Muwe"),n("9UJh"),n("WoWj"),n("aZFp"),n("3dw1"),n("U00V"),n("3XUK"),n("Peo2");var i=n("NsF1"),r=n("lpOn"),a=n("Tj8s"),o=n("OQCi"),s=n("PVJp"),c=n("XGRO"),d=n("NBGV"),l=n("NRFW"),u=n("TiKg"),h=n.n(u),p=(n("YmdP"),n("W/Hz"),n("8sDi"),n("cRa1"),n("f4w0")),_=n("Av7d"),f=n("0lY5"),m=n("iSiJ");function g(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var v=function(){function e(t){this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(d.a)().x((function(t){return t[0]})).y((function(t){return t[1]})),this._labelPadding=20,this._degreesPerMinute=_.s/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(o.a)().domain(Object(r.a)(0,_.t,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-"+this._baseId,this._compassId="compass-"+this._baseId,this._deleteLastLegButtonId="button-delete-leg-"+this._baseId,this._modalId="modal-"+this._baseId,this._sliderId="slider-"+this._baseId,this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}var n=e.prototype;return n._setupDrag=function(){var t=this;this._drag=Object(a.a)().on("start",(function(e,n,i){t._removeLabels(),Object(s.a)(i[n]).classed("drag-active",!0)})).on("drag",(function(e,n,i){0===n&&t._compass.attr("x",e.position[0]+c.c.dx).attr("y",e.position[1]+c.c.dy),Object(s.a)(i[n]).attr("cx",c.c.x).attr("cy",c.c.y),e.position=[e.position[0]+c.c.dx,e.position[1]+c.c.dy],t._printLines()})).on("end",(function(e,n,i){Object(s.a)(i[n]).classed("drag-active",!1),t._printJourney()}))},n._setupSvg=function(){var t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(s.a)("#na-svg").insert("g","g.pb").attr("class","journey"),Object(s.a)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d","M0,-"+t+"L"+e+",0L0,"+t)},n._initJourneyData=function(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segment:[{position:[null,null],label:""}]}},n._resetJourneyData=function(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0},n._navbarClick=function(t){Object(p.b)("Menu","Journey"),t.stopPropagation(),this._journeySelected()},n._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("mouseup",(function(e){return t._navbarClick(e)})),document.getElementById(this._deleteLastLegButtonId).addEventListener("mouseup",(function(){return t._deleteLastLeg()}))},n._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var n=e.call(this);return this.container.append(this.tooltip),n},window.tooltip=function(t){return Object(f.k)(t.value)+"<br>"+t.value+"°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/f.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},n._injectModal=function(){Object(_.C)(this._modalId,this._baseName,"sm");var t=Object(s.a)("#"+this._modalId+" .modal-body").append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");var n=this._shipId+"-Base-select",i=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");i.append("label").attr("for",n).text("Ship (optional)"),i.append("select").attr("name",n).attr("id",n)},n._initModal=function(){this._injectModal(),this._setupWindInput(),this._shipCompare=new m.a(this._shipId),this._shipCompare.CompareShipsInit()},n._useUserInput=function(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()},n._journeySelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",(function(){e._useUserInput()}))},n._printCompass=function(){var t=this._journey.segment[0].position[0],e=this._journey.segment[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e).call(this._drag),this._compassG=this._compass.append("g"),Object(f.H)({element:this._compassG,radius:this._compassRadius})},n._removeCompass=function(){this._compass.remove()},n._getSpeedAtDegrees=function(t){return Math.max(this._speedScale(t),this._minOWSpeed)},n._calculateDistanceForSection=function(t,e){var n=(_.t-t+e)%_.t;return this._getSpeedAtDegrees(n)*this._owSpeedFactor*_.M},n._getStartWind=function(){var e=t("#"+this._sliderId),n=Number(e.roundSlider("getValue"));return e.length?n:0},n._setShipSpeed=function(){var t=[];t=this._journey.shipName===this._defaultShipName?g(new Array(24).fill(this._defaultShipSpeed/2)):this._shipCompare._singleShipData.speedDegrees,this._speedScale.range(t)},n._calculateMinutesForSegment=function(t,e,n){var i=n,r=e,a=0;for(this._setShipSpeed();i>0;){var o=this._calculateDistanceForSection(t,r);i>o?(i-=o,a+=1):(a+=i/o,i=0),r=(_.t+r-this._degreesPerMinute)%_.t}return this._journey.currentWindDegrees=r,a},n._setShipName=function(){this._shipCompare&&this._shipCompare._singleShipData&&this._shipCompare._singleShipData.name?this._journey.shipName=""+this._shipCompare._singleShipData.name:this._journey.shipName=this._defaultShipName},n._removeLabels=function(){var t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()},n._correctJourney=function(){var t=Object(l.c)(Object(s.a)("#na-svg").node()),e=Math.max(1,t.k),n=this._fontSize/e,i=l.b.translate(20/e,20/e),r=this._labelPadding/e,a=10/e,o=5/e;this._g.selectAll("g.journey g.label").each((function(t,e,o){var c=Object(s.a)(o[e]),d=c.select("text"),l=t.label.split("|"),u=1.3*n;d.text("").attr("dy",0).attr("transform",i).style("font-size",n+"px"),l.forEach((function(t,e){var n=d.append("tspan").html(t);e>0&&n.attr("x",0).attr("dy",u)}));var h=d.node().getBBox(),p=t.label?h.width+2*r:0,_=t.label?h.height+r:0;c.select("rect").attr("width",p).attr("height",_);var f=c.select("circle").attr("r",a).attr("class","");c.append((function(){return f.remove().node()})),0===e&&f.attr("r",4*a).attr("class","drag-hidden"),e===o.length-1&&f.attr("r",a).attr("class","drag-hidden")})),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",o+"px"),this._compassG&&this._compassG.attr("transform","scale("+1/e+")")},n._printLabels=function(){var t=this,e=Object(i.c)().padding(this._labelPadding).value((function(t){var e=t.label.split("|"),n=e.reduce((function(t,e,n,i){return i[t].length>e.length?t:n}),0);return e[n]})),n=Object(i.a)(),r=Object(i.b)(n).size((function(e,n,i){var r=e.label.split("|").length,a=i[n].getElementsByTagName("text")[0].getBBox();return[a.width+2*t._labelPadding,a.height*r+2*t._labelPadding]})).position((function(t){return t.position})).component(e);this._g.datum(this._journey.segment.map((function(t){return t}))).call(r)},n._setupSummary=function(){this._divJourneySummary=Object(s.a)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")},n._displaySummary=function(t){this._divJourneySummary.classed("d-none",!t),Object(s.a)("#port-summary").classed("d-none",t)},n._showSummary=function(){this._displaySummary(!0)},n._hideSummary=function(){this._displaySummary(!1)},n._printSummaryShip=function(){this._journeySummaryTextShip.text(this._journey.shipName)},n._printSummaryWind=function(){this._journeySummaryTextWind.html("From "+Object(f.l)(this._journey.startWindDegrees))},n._printSummary=function(){this._printSummaryWind(),this._printSummaryShip()},n._printLines=function(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segment.length>1?this._journey.segment.map((function(t){return t.position})):[[null,null]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)},n._getTextDirection=function(t,e,n){return Object(f.l)(t,!0)+" ⁖ F11: "+Object(f.q)(Object(_.o)(n.x,n.y))+" / "+Object(f.q)(Object(_.p)(n.x,n.y))},e._pluralize=function(t,e){return t+" "+e+(1===t?"":"s")},n._getTextDistance=function(t,n,i){function r(t){h.a.locale("en-gb");var n=Math.floor(t/60),i=Math.round(t%60),r="in ";if(t<1)r+="less than a minute";else{var a=0===n?"":e._pluralize(n,"hour");r+=a+(""===a?"":" ")+(0===i?"":e._pluralize(i,"minute"))}return r}var a=Math.round(t)+" k "+r(n);return i&&(a+=" ⁖ total "+Math.round(this._journey.totalDistance)+" k "+r(this._journey.totalMinutes)),a},n._setSegmentLabel=function(t){void 0===t&&(t=this._journey.segment.length-1);var e={x:this._journey.segment[t].position[0],y:this._journey.segment[t].position[1]},n={x:this._journey.segment[t-1].position[0],y:this._journey.segment[t-1].position[1]},i=Object(f.K)(e,n),r=Object(_.v)(e,n),a=Object(f.h)(i),o=this._calculateMinutesForSegment(i,this._journey.currentWindDegrees,1e3*r);this._journey.totalDistance+=r,this._journey.totalMinutes+=o;var s=this._getTextDirection(a,i,e),c=this._getTextDistance(r,o,t>1);this._journey.segment[t].label=s+"|"+c},n._printSegment=function(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)},n._printJourney=function(){var t=this;this._printLines(),this._resetJourneyData(),this._journey.segment.forEach((function(e,n){n<t._journey.segment.length-1&&t._setSegmentLabel(n+1)})),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)},n._deleteLastLeg=function(){this._journey.segment.pop(),this._journey.segment.length?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())},n._initJourney=function(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")},n.setSummaryPosition=function(t,e){this._divJourneySummary.style("top",t+"px").style("right",e+"px")},n.plotCourse=function(t,e){this._journey.segment[0].position[0]?(this._journey.segment.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segment[0]={position:[t,e],label:""},this._initJourney())},n.transform=function(t){this._g.attr("transform",t),this._correctJourney()},e}()}).call(this,n("xeH2"))},"8kDF":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"8niD":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 486.86 480'%3E%3Cpath d='M410.06 46.63L279.78 218.06v2.74l207.08-27.43v93.26l-207.08-24.68v2.74l131.65 164.57-86.4 49.37-82.29-192H240L150.86 480l-78.17-49.37 130.29-167.32v-2.74l-203 26.06v-93.26l201.6 26.06v-2.74L72.69 49.37l83.66-48 85 190.63h2.75L327.77 0z' fill='%23d2ccc2'/%3E%3C/svg%3E"},"98Ys":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},Fg8x:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},FmV8:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return y}));n("iPZ8"),n("kypl"),n("KcJv"),n("pCzD"),n("lYjL"),n("IlJM"),n("/YXa"),n("8cZI"),n("lmye"),n("D/wG"),n("eUWX"),n("wCa+"),n("SUr3"),n("JBxO"),n("FdtR"),n("Muwe"),n("WoWj"),n("y89P"),n("3dw1"),n("U00V"),n("wcNg"),n("3XUK"),n("/1Gu");var i=n("ED/D"),r=n("qKAC"),a=n("8RCj"),o=n("OQCi"),s=n("CZaE"),c=n("PVJp"),d=n("TiKg"),l=n.n(d),u=(n("YmdP"),n("Av7d")),h=n("0lY5"),p=n("NO11"),_=n("iJ1D"),f=n("1qWw");function m(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function g(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){m(a,i,r,o,s,"next",t)}function s(t){m(a,i,r,o,s,"throw",t)}o(void 0)}))}}function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function b(t){var e;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(e=t[Symbol.asyncIterator]))return e.call(t);if(Symbol.iterator&&null!=(e=t[Symbol.iterator]))return e.call(t)}throw new TypeError("Object is not async iterable")}var y=function(){function e(t){this._map=t,this._serverName=this._map.serverName,this._minScale=this._map._minScale,this._scale=this._minScale,this.f11=this._map._f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this._currentPort={id:"366",coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=u.r,this._circleSize=u.q,this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","county","points","position","tax","net","off"],this._cookie=new p.a({id:this._baseId,values:this._radioButtonValues}),this._radios=new _.a(this._baseId,this._radioButtonValues),this.showRadius=this._getShowRadiusSetting(),this._trilateratePosition=new f.a(this)}var d,m,y,w=e.prototype;return w.init=function(){var t=g(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadAndSetupData();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),w._setupData=function(t){var e=t.ports.map((function(e){var n=t.server.find((function(t){return t.id===e.id})),i=t.pb.ports.find((function(t){return t.id===e.id})),r=Object.assign({},e,{},n,{},i);return["dropsTrading","consumesTrading","producesNonTrading","dropsNonTrading"].forEach((function(t){r[t]||delete r[t]})),r}));this._portDataDefault=e,this._portData=e,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags()},w._loadData=function(){var t=g(regeneratorRuntime.mark((function t(){var e,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"data",e=[{fileName:this._serverName+"-ports.json",name:"server"},{fileName:this._serverName+"-pb.json",name:"pb"}],i={},r=function(){var t=g(regeneratorRuntime.mark((function t(e){var n,r,a,o,s,c,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=!0,r=!1,t.prev=2,o=b(e);case 4:return t.next=6,o.next();case 6:return s=t.sent,n=s.done,t.next=10,s.value;case 10:if(c=t.sent,n){t.next=21;break}return d=c,t.next=15,fetch("data/"+d.fileName);case 15:return t.next=17,t.sent.json();case 17:i[d.name]=t.sent;case 18:n=!0,t.next=4;break;case 21:t.next=27;break;case 23:t.prev=23,t.t0=t.catch(2),r=!0,a=t.t0;case 27:if(t.prev=27,t.prev=28,n||null==o.return){t.next=32;break}return t.next=32,o.return();case 32:if(t.prev=32,!r){t.next=35;break}throw a;case 35:return t.finish(32);case 36:return t.finish(27);case 37:case"end":return t.stop()}}),t,null,[[2,23,27,37],[28,,32,36]])})));return function(e){return t.apply(this,arguments)}}(),t.prev=4,t.next=7,n.e(9).then(n.t.bind(null,"3rAh",3));case 7:return i.ports=t.sent.default,t.next=10,r(e);case 10:return t.abrupt("return",i);case 13:t.prev=13,t.t0=t.catch(4),Object(h.J)(t.t0);case 16:case"end":return t.stop()}}),t,this,[[4,13]])})));return function(){return t.apply(this,arguments)}}(),w._loadAndSetupData=function(){var t=g(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadData();case 2:e=t.sent,this._setupData(e);case 4:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),w._setupScales=function(){this._portRadius=Object(o.a)(),this._attackRadius=Object(o.a)().domain([0,1]),this._colourScaleHostility=Object(o.a)().domain([0,1]).range([u.l,u.j]).interpolate(a.a),this._colourScaleCounty=Object(s.a)().range(u.h),this._minTaxIncome=Object(i.a)(this._portData,(function(t){return t.taxIncome})),this._maxTaxIncome=Object(r.a)(this._portData,(function(t){return t.taxIncome})),this._colourScaleTax=Object(o.a)().domain([this._minTaxIncome,this._maxTaxIncome]).range([u.l,u.f]).interpolate(a.a),this._minNetIncome=Object(i.a)(this._portData,(function(t){return t.netIncome})),this._maxNetIncome=Object(r.a)(this._portData,(function(t){return t.netIncome})),this._colourScaleNet=Object(o.a)().domain([this._minNetIncome,this._minNetIncome/50,0,this._maxNetIncome/50,this._maxNetIncome]).range([u.j,u.k,u.l,u.g,u.f]).interpolate(a.a),this._minPortPoints=Object(i.a)(this._portData,(function(t){return t.portPoints})),this._maxPortPoints=Object(r.a)(this._portData,(function(t){return t.portPoints})),this._colourScalePoints=Object(o.a)().domain([this._minPortPoints,this._maxPortPoints]).range([u.l,u.f]).interpolate(a.a)},w._setupListener=function(){var t=this;document.getElementById("show-radius").addEventListener("change",(function(){return t._showRadiusSelected()}))},w._getShowRadiusSetting=function(){var t=this._cookie.get();"position"===t&&(t=this._radioButtonValues[0],this._cookie.set(t));return this._radios.set(t),t},w._showRadiusSelected=function(){this.showRadius=this._radios.get(),this._cookie.set(this.showRadius),this.update()},w._setupSvg=function(){this._gPort=Object(c.a)("#na-svg").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"),this._gRegion=this._gPort.append("g").attr("class","region"),this._gCounty=this._gPort.append("g").attr("class","county"),this._gPortCircle=this._gPort.append("g").attr("data-ui-component","port-circles"),this._gIcon=this._gPort.append("g").attr("class","port"),this._gText=this._gPort.append("g").attr("class","port-names")},w._setupCounties=function(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Cuidad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}];var t={x:this._map.coord.max/2,y:this._map.coord.max/2};this._countyPolygon=this._countyPolygon.sort((function(e,n){var i={x:e.centroid[0],y:e.centroid[1]},r={x:n.centroid[0],y:n.centroid[1]};return Object(h.m)(t,i)-Object(h.m)(t,r)})),this._colourScaleCounty.domain(this._countyPolygon.map((function(t){return t.name})))},w._setupRegions=function(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]},w._setupSummary=function(){this._divPortSummary=Object(c.a)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind"),this._portSummaryNumPorts=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").attr("class","summary-des").html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").attr("class","summary-des").html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").attr("class","summary-des").html("net<br>income")},e._importAll=function(t){var e={};return t.keys().forEach((function(n){e[n.replace("./","").replace(".svg","")]=t(n)})),e},w._setupFlags=function(){var t=this;this._nationIcons=e._importAll(n("ceqg"));var i=Object(c.a)("#na-svg defs");u.E.map((function(t){return t.short})).forEach((function(e){if(i.append("pattern").attr("id",e).attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+t._iconSize+" "+.75*t._iconSize).append("image").attr("height",t._iconSize).attr("width",t._iconSize).attr("href",t._nationIcons[e].replace('"',"").replace('"',"")),"FT"!==e){var n=i.append("pattern").attr("id",e+"c").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+t._iconSize+" "+.75*t._iconSize);n.append("image").attr("height",t._iconSize).attr("width",t._iconSize).attr("href",t._nationIcons[""+e].replace('"',"").replace('"',"")),n.append("circle").attr("cx",t._iconSize/2).attr("cy",t._iconSize/2).attr("r",16)}if("NT"!==e&&"FT"!==e){i.append("pattern").attr("id",e+"a").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+t._iconSize+" "+.75*t._iconSize).append("image").attr("height",t._iconSize).attr("width",t._iconSize).attr("href",t._nationIcons[e+"a"].replace('"',"").replace('"',""));var r=i.append("pattern").attr("id",e+"ca").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+t._iconSize+" "+.75*t._iconSize);r.append("image").attr("height",t._iconSize).attr("width",t._iconSize).attr("href",t._nationIcons[e+"a"].replace('"',"").replace('"',"")),r.append("circle").attr("cx",t._iconSize/2).attr("cy",t._iconSize/2).attr("r",16)}}))},w._getPortName=function(t){return t?this._portDataDefault.find((function(e){return e.id===t})).name:""},w._getText=function(t,e){l.a.locale("en-gb");var n=l.a.utc(e.portBattle).local(),i=l.a.utc(e.portBattle),r=i===n?"":" ("+n.format("H.mm")+" local)",a=e.portBattleStartTime?(e.portBattleStartTime+10)%24+".00 – "+(e.portBattleStartTime+13)%24+".00":"11.00 – 8.00",o=i.isAfter(l.a.utc())?"s":"ed",s=Object(h.j)(e.attackerClan)+" ("+e.attackerNation+") attack"+(e.portBattle.length?o+" "+i.fromNow()+" at "+i.format("H.mm")+r:"s: "+Object(h.x)(e.attackHostility)+" hostility"),c={name:e.name,icon:e.nation,availableForAll:e.availableForAll?"(accessible to all nations)":"",depth:e.shallow?"Shallow":"Deep",county:(""===e.county?"":e.county+" / ")+e.region,countyCapital:e.countyCapital?" (county capital)":"",nonCapturable:e.nonCapturable,captured:e.capturer?" captured by "+Object(h.j)(e.capturer)+" "+l.a.utc(e.lastPortBattle).fromNow():"",lastPortBattle:e.lastPortBattle,attack:e.attackHostility?s:"",pbTimeRange:e.nonCapturable?"":a,brLimit:Object(h.u)(e.brLimit),portPoints:Object(h.u)(e.portPoints),conquestMarksPension:e.conquestMarksPension,taxIncome:Object(h.z)(e.taxIncome),portTax:Object(h.x)(e.portTax),netIncome:Object(h.z)(e.netIncome),tradingCompany:e.tradingCompany?", trading company level "+e.tradingCompany:"",laborHoursDiscount:e.laborHoursDiscount?", labor hours discount level "+e.laborHoursDiscount:"",dropsTrading:e.dropsTrading?e.dropsTrading.join(", "):"",consumesTrading:e.consumesTrading?e.consumesTrading.join(", "):"",producesNonTrading:e.producesNonTrading?e.producesNonTrading.join(", "):"",dropsNonTrading:e.dropsNonTrading?e.dropsNonTrading.join(", "):"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:e.goodsToSellInTradePort?e.goodsToSellInTradePort.join(", "):"",goodsToBuyInTradePort:e.goodsToBuyInTradePort?e.goodsToBuyInTradePort.join(", "):""};switch(e.portBattleType){case"Large":c.pbType=Object(h.D)(1);break;case"Medium":c.pbType=Object(h.D)(4);break;default:c.pbType=Object(h.D)(6)}return c},w._tooltipData=function(t){var e='<div class="d-flex align-items-baseline mb-1">';return e+='<img alt="'+t.icon+'" class="flag-icon align-self-stretch" src="'+this._nationIcons[t.icon].replace('"',"").replace('"',"")+'"/>',e+='<div class="port-name">'+t.name+"</div>",e+="<div> "+t.county+" "+t.availableForAll+"</div>",e+="</div>",t.attack.length&&(e+='<div class="alert alert-danger mt-2" role="alert">'+t.attack+"</div>"),e+="<p>"+t.depth+" water port "+t.countyCapital+t.captured+"<br>",t.nonCapturable?(e+="Not capturable",e+="<br>"+t.portTax+" tax"):(e+="Port battle "+t.pbTimeRange+", "+t.brLimit+' <span class="caps">BR</span>, ',e+=t.pbType+' rate <span class="caps">AI</span>, ',e+=t.conquestMarksPension+" conquest point",e+=t.conquestMarksPension>1?"s":"",e+=", "+t.portPoints+" port points",e+="<br>Tax income "+t.taxIncome+" ("+t.portTax+"), net income "+t.netIncome,e+=t.tradingCompany,e+=t.laborHoursDiscount),e+="</p>",e+="<table class='table table-sm'>",t.producesNonTrading.length&&(e+="<tr><td class='pl-0'>Produces </td><td>",e+='<span class="non-trading">'+t.producesNonTrading+"</span>",e+="</td></tr>"),(t.dropsTrading.length||t.dropsNonTrading.length)&&(e+="<tr><td class='pl-0'>Drops "+(t.dropsNonTrading.length?" ":"")+"</td><td>",t.dropsNonTrading.length&&(e+='<span class="non-trading">'+t.dropsNonTrading+"</span>",t.dropsTrading.length&&(e+="<br>")),t.dropsTrading.length&&(e+=""+t.dropsTrading),e+="</td></tr>"),t.consumesTrading.length&&(e+="<tr><td class='pl-0'>Consumes </td><td>",e+=t.consumesTrading,e+="</td></tr>"),"tradePorts"===this.showRadius&&(t.goodsToSellInTradePort.length&&(e+="<tr><td class='pl-0'>Sell in "+t.tradePort+" </td><td>"+t.goodsToSellInTradePort+"</td></tr>"),t.goodsToBuyInTradePort.length&&(e+="<tr><td class='pl-0'>Buy in "+t.tradePort+" </td><td>"+t.goodsToBuyInTradePort+"</td></tr>")),e+="</table>"},e._getInventory=function(t){var e="",n=t.inventory.filter((function(t){return t.buyQuantity>0})).map((function(t){return Object(h.u)(t.buyQuantity)+" "+t.name+" @ "+Object(h.y)(t.buyPrice)})).join("<br>"),i=t.inventory.filter((function(t){return t.sellQuantity>0})).map((function(t){return Object(h.u)(t.sellQuantity)+" "+t.name+" @ "+Object(h.y)(t.sellPrice)})).join("<br>");return e+='<h5 class="caps">'+t.name+' <span class="small">'+t.nation+"</span></h5>",n.length&&(e+="<h6>Buy</h6>",e+=n),n.length&&i.length&&(e+="<p></p>"),i.length&&(e+="<h6>Sell</h6>",e+=i),e},w._showDetails=function(n,i,r){t(Object(c.a)(r[i]).node()).tooltip({html:!0,placement:"auto",title:this._tooltipData(this._getText(n.id,n)),trigger:"manual",sanitize:!1}).tooltip("show"),this._map.showTrades.show&&("inventory"!==this._map.showTrades.listType&&(this._map.showTrades.listType="inventory"),this._map.showTrades.update(e._getInventory(n)))},e._hideDetails=function(e,n,i){t(Object(c.a)(i[n]).node()).tooltip("dispose")},w._updateIcons=function(){var t=this,n=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),i=Object(h.L)(this._circleSize/n),r=this._portDataFiltered;this._gIcon.selectAll("circle").data(r,(function(t){return t.id})).join((function(n){return n.append("circle").attr("fill",(function(t){var e=(t.countyCapital&&!t.nonCapturable?"c":"")+(t.availableForAll&&"NT"!==t.nation?"a":"");return"url(#"+t.nation+e+")"})).attr("cx",(function(t){return t.coordinates[0]})).attr("cy",(function(t){return t.coordinates[1]})).on("click",(function(e,n,i){return t._showDetails(e,n,i)})).on("mouseleave",e._hideDetails)})).attr("r",i)},w._getTradePortMarker=function(t){var e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e},w._getFrontlineMarker=function(t){var e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e},w._updatePortCircles=function(){var t=this,e=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),n=Object(h.L)(this._circleSize/e*this._minRadiusFactor),i=Object(h.L)(this._circleSize/e*this._maxRadiusFactor),r=this._portDataFiltered,a=function(){},o=function(){},s=function(){};"tax"===this.showRadius?(r=this._portDataFiltered.filter((function(t){return!t.nonCapturable})),this._portRadius.domain([this._minTaxIncome,this._maxTaxIncome]).range([n,i]),a=function(){return"bubble"},s=function(e){return t._colourScaleTax(e.taxIncome)},o=function(e){return t._portRadius(e.taxIncome)}):"net"===this.showRadius?(r=this._portDataFiltered.filter((function(t){return!t.nonCapturable})),this._portRadius.domain([this._minNetIncome,this._maxNetIncome]).range([n,i]),a=function(){return"bubble"},s=function(e){return t._colourScaleNet(e.netIncome)},o=function(e){return t._portRadius(Math.abs(e.netIncome))}):"points"===this.showRadius?(r=this._portDataFiltered.filter((function(t){return!t.nonCapturable})),this._portRadius.domain([this._minPortPoints,this._maxPortPoints]).range([n,i/2]),a=function(){return"bubble"},s=function(e){return t._colourScalePoints(e.portPoints)},o=function(e){return t._portRadius(e.portPoints)}):"position"===this.showRadius?(a=function(){return"bubble here"},o=function(t){return t.distance}):"attack"===this.showRadius?(r=this._portDataFiltered.filter((function(t){return t.attackHostility})),this._attackRadius.range([n,i/1.5]),a=function(){return"bubble"},s=function(e){return"Neutral"===e.attackerNation?u.i:t._colourScaleHostility(e.attackHostility)},o=function(e){return t._attackRadius(e.attackHostility)}):"currentGood"===this.circleType?(a=function(t){return"bubble "+(t.isSource?"pos":"neg")},o=function(){return i/2}):"county"===this.showRadius?(a=function(t){return t.nonCapturable?"bubble not-capturable":t.countyCapital?"bubble capital":"bubble non-capital"},s=function(e){return e.nonCapturable?"":t._colourScaleCounty(e.county)},o=function(t){return t.nonCapturable?i/3:i/2}):"tradePorts"===this.showRadius?(a=function(e){return"bubble "+t._getTradePortMarker(e)},o=function(e){return e.id===t.tradePortId?i:i/2}):"frontline"===this.showRadius?(a=function(e){return"bubble "+t._getFrontlineMarker(e)},o=function(t){return t.ownPort?i/3:i/2},r=r.filter((function(t){return t.enemyPort||t.ownPort}))):"currentGood"===this.showRadius?(a=function(t){return"bubble "+(t.isSource?"pos":"neg")},o=function(){return i/2}):"off"===this.showRadius&&(r=[]),this._gPortCircle.selectAll("circle").data(r,(function(t){return t.id})).join((function(t){return t.append("circle").attr("cx",(function(t){return t.coordinates[0]})).attr("cy",(function(t){return t.coordinates[1]}))})).attr("class",(function(t){return a(t)})).attr("r",(function(t){return o(t)})).attr("fill",(function(t){return s(t)}))},w._updateTextsX=function(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(h.i)(t.angle))):t.coordinates[0]},w._updateTextsY=function(t,e,n){var i=e+1.2*n;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+i;var r=t.angle>90&&t.angle<270?n:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(h.i)(t.angle)))+r:t.coordinates[1]+i},w._updateTextsAnchor=function(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.textAnchor:"middle"},w.updateTexts=function(){var t=this;if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{var e=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),n=Object(h.L)(this._circleSize/e),i=Math.pow(2,Math.log2(.9*(Math.abs(this._minScale)+this._scale))),r=Object(h.L)(this._fontSize/i);this._gText.selectAll("text").data(this._portDataFiltered,(function(t){return t.id})).join((function(t){return t.append("text").text((function(t){return t.name}))})).attr("x",(function(e){return t._updateTextsX(e,n)})).attr("y",(function(e){return t._updateTextsY(e,n,r)})).attr("text-anchor",(function(e){return t._updateTextsAnchor(e)})),this._gText.attr("font-size",r+"px").classed("d-none",!1)}},w._updateSummary=function(){var t=Object.keys(this._portData).length,e=0,n=0;t&&(e=this._portData.map((function(t){return t.taxIncome})).reduce((function(t,e){return t+e})),n=this._portData.map((function(t){return t.netIncome})).reduce((function(t,e){return t+e}))),this._portSummaryTextNumPorts.text(""+t),this._portSummaryTextTaxIncome.text(""+Object(h.z)(e)),this._portSummaryTextNetIncome.text(""+Object(h.z)(n))},w._updateCounties=function(){var t=this;if("portLabel"===this.zoomLevel){var e=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(e,(function(t){return t.name})).join((function(t){return t.append("text").attr("transform",(function(t){return"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")"})).text((function(t){return t.name}))}),(function(e){return e.attr("fill",(function(e){return"county"===t.showRadius?t._colourScaleCounty(e.name):""}))})),this._gCounty.classed("d-none",!1)}else this._gCounty.classed("d-none",!0)},w._updateRegions=function(){if("initial"===this.zoomLevel){var t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,(function(t){return t.name})).join((function(t){return t.append("text").attr("transform",(function(t){return"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")"})).text((function(t){return t.name}))})),this._gRegion.classed("d-none",!1)}else this._gRegion.classed("d-none",!0)},w.update=function(t){void 0===t&&(t=null),this._scale=t||this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()},w._filterVisible=function(){var t=this;"position"===this.showRadius?this._portDataFiltered=this._portData:this._portDataFiltered=this._portData.filter((function(e){return e.coordinates[0]>=t._lowerBound[0]&&e.coordinates[0]<=t._upperBound[0]&&e.coordinates[1]>=t._lowerBound[1]&&e.coordinates[1]<=t._upperBound[1]})),this._countyPolygonFiltered=this._countyPolygon.filter((function(e){return e.centroid[0]>=t._lowerBound[0]&&e.centroid[0]<=t._upperBound[0]&&e.centroid[1]>=t._lowerBound[1]&&e.centroid[1]<=t._upperBound[1]})),this._regionPolygonFiltered=this._regionPolygon.filter((function(e){return e.centroid[0]>=t._lowerBound[0]&&e.centroid[0]<=t._upperBound[0]&&e.centroid[1]>=t._lowerBound[1]&&e.centroid[1]<=t._upperBound[1]}))},w.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},w._showSummary=function(){this._divPortSummary.classed("hidden",!1)},w.setShowRadiusSetting=function(t){void 0===t&&(t=this._radioButtonValues[0]),this.showRadius=t,this._radios.set(this.showRadius),this._cookie.set(this.showRadius)},w.transform=function(t){this._gPort.attr("transform",t)},w.clearMap=function(t){this._showSummary(),this._portData=this._portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)},d=e,(m=[{key:"portDataDefault",set:function(t){this._portDataDefault=t},get:function(){return this._portDataDefault}},{key:"portData",set:function(t){this._portData=t},get:function(){return this._portData}},{key:"currentPort",set:function(t){this._currentPort=t},get:function(){return this._currentPort}},{key:"zoomLevel",set:function(t){this._zoomLevel=t},get:function(){return this._zoomLevel}}])&&v(d.prototype,m),y&&v(d,y),e}()}).call(this,n("xeH2"))},JNxp:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return f}));n("iPZ8"),n("kypl"),n("pCzD"),n("lYjL"),n("IlJM"),n("4owi"),n("/YXa"),n("8cZI"),n("lmye"),n("WB5j"),n("D/wG"),n("1Qwx"),n("eUWX"),n("wCa+"),n("JBxO"),n("FdtR"),n("Muwe"),n("9UJh"),n("RsMT"),n("WoWj"),n("y89P"),n("3dw1"),n("U00V"),n("wcNg"),n("3XUK"),n("hSFQ"),n("/1Gu");var i=n("2b7M"),r=n("0YW8"),a=n("OQCi"),o=n("PVJp"),s=n("Av7d"),c=n("0lY5"),d=n("NO11"),l=n("iJ1D");function u(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function p(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){h(a,i,r,o,s,"next",t)}function s(t){h(a,i,r,o,s,"throw",t)}o(void 0)}))}}function _(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(){function e(t,e,n,i,r){this._serverName=t,this._portSelect=e,this._isDataLoaded=!1,this._minScale=n,this._scale=this._minScale,this._fontSize=s.r,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=this._baseId+"-nation-select",this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new d.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new l.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new d.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new l.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(i,r),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}var h,f,m,g=e.prototype;return g._setupSvg=function(){this._g=Object(o.a)("#na-svg").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(o.a)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d","M0,0L0,"+this._arrowY+"L"+this._arrowX+","+this._arrowY/2+"z").attr("class","trade-arrow-head"),this._tradeDetailsDiv=Object(o.a)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")},g._setupSelects=function(){var e=""+s.E.map((function(t){return'<option value="'+t.short+'" selected>'+t.name+"</option>"})).join(""),n=this._baseId+"-card";this._tradeDetailsHead=this._tradeDetailsDiv.append("div");var i=this._tradeDetailsHead.append("label"),r=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=r.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:function(t){return(t===s.E.length?"All":t)+" nations selected"},title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#"+n).text("Info"),this._tradeDetailsHead.append("div").attr("id",n).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")},g._setupProfitRadios=function(){var t=this,e=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");e.append("legend").attr("class","col-form-label").text("Sort net profit by"),this._profitRadioValues.forEach((function(n){var i=t._profitId+"-"+n.replace(/ /g,""),r=e.append("div").attr("class","custom-control custom-radio custom-control-inline");r.append("input").attr("id",i).attr("name",t._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",n),r.append("label").attr("for",i).attr("class","custom-control-label").text(n)}))},g._setupListener=function(){var t=this;document.getElementById(this._showId).addEventListener("change",(function(){return t._showSelected()})),document.getElementById(this._profitId).addEventListener("change",(function(){return t._profitValueSelected()})),this._nationSelector.addEventListener("change",(function(e){t._nationChanged(),e.preventDefault()}))},g._setupList=function(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")},g._setupData=function(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map((function(t){return[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]}))),this._filterPortsBySelectedNations(),this._sortLinkData()},g._sortLinkData=function(){var t=this;this._linkData=this._linkData.map((function(n){var i=0;switch(t._profitValue){case"weight":i=e._getProfitPerWeight(n);break;case"distance":i=e._getProfitPerDistance(n);break;case"total":i=n.profitTotal;break;default:throw new Error("Wrong profit value "+t._profitValue)}return n.profit=i,n})).sort((function(t,e){return e.profit-t.profit}))},g._showSelected=function(){var t=p(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=this._showRadios.get(),this.show="on"===e,this._showCookie.set(e),t.next=5,this.showOrHide();case 5:this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update();case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),g._loadData=function(){var t=p(regeneratorRuntime.mark((function t(){var e,i,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e="data",t.prev=1,t.next=4,n.e(9).then(n.t.bind(null,"3rAh",3));case 4:return i=t.sent.default,t.next=7,fetch(e+"/"+this._serverName+"-pb.json");case 7:return t.next=9,t.sent.json();case 9:return r=t.sent,t.next=12,fetch(e+"/"+this._serverName+"-trades.json");case 12:return t.next=14,t.sent.json();case 14:this._linkDataDefault=t.sent,this._portData=i.map((function(t){var e=r.ports.find((function(e){return e.id===t.id}));return Object.assign({},t,{},e)})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(1),Object(c.J)(t.t0);case 21:case"end":return t.stop()}}),t,this,[[1,18]])})));return function(){return t.apply(this,arguments)}}(),g._loadAndSetupData=function(){var t=p(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this._loadData();case 3:this._setupData(),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),Object(c.J)(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})));return function(){return t.apply(this,arguments)}}(),g.showOrHide=function(){var t=p(regeneratorRuntime.mark((function t(){var n=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.show){t.next=8;break}if(this._isDataLoaded){t.next=4;break}return t.next=4,this._loadAndSetupData().then((function(){n._isDataLoaded=!0}));case 4:e._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault,t.next=10;break;case 8:e._hideElem(this._tradeDetailsDiv),this._linkData=[];case 10:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),g._profitValueSelected=function(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()},g._nationChanged=function(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()},e._getId=function(t){return"trade-"+t.source.id+"-"+t.good.replace(/ /g,"")+"-"+t.target.id},e._addInfo=function(t){return"<div><div>"+t+"</div>"},e._addDes=function(t){return'<div class="des">'+t+"</div></div>"},e._getDepth=function(t){return t?"(shallow)":"(deep)"},g._getTradeLimitedData=function(t){var n=t.weightPerItem*t.quantity,i="";return i+=e._addInfo(Object(c.u)(t.quantity)+" "+t.good)+e._addDes("trade"),i+=e._addInfo(""+Object(c.y)(t.profit))+e._addDes(this._profitText),i+=e._addInfo(Object(c.z)(n)+" "+(1===n?"ton":"tons"))+e._addDes("weight"),i+=e._addInfo(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+e._addDes("from "+e._getDepth(this._nodeData.get(t.source.id).isShallow)),i+=e._addInfo(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+e._addDes("to "+e._getDepth(this._nodeData.get(t.target.id).isShallow)),i+=e._addInfo(Object(c.z)(t.distance)+" k")+e._addDes("distance")},e._getProfitPerWeight=function(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))},e._getProfitPerDistance=function(t){return t.profitTotal/t.distance},e._startBlock=function(t){return'<div class="block-block"><span>'+t+"</span>"},e._endBlock=function(){return"</div>"},g._getTradeFullData=function(t){var n=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,r=e._getProfitPerDistance(t),a=e._getProfitPerWeight(t),o="";return o+=e._startBlock("Trade"),o+=e._addInfo(Object(c.u)(t.quantity)+" "+t.good)+e._addDes("good"),o+=e._addInfo(""+Object(c.y)(t.source.grossPrice))+e._addDes("gross buy price"),o+=e._addInfo(""+Object(c.y)(t.target.grossPrice))+e._addDes("gross sell price"),o+=e._addInfo(Object(c.z)(n)+" "+(1===n?"ton":"tons"))+e._addDes("weight"),o+=e._endBlock(),o+=e._startBlock("Profit"),o+=e._addInfo(""+Object(c.y)(t.profitTotal))+e._addDes("total"),o+=e._addInfo(""+Object(c.y)(i))+e._addDes("profit/item"),o+=e._addInfo(""+Object(c.y)(r))+e._addDes("profit/distance"),o+=e._addInfo(""+Object(c.y)(a))+e._addDes("profit/weight"),o+=e._endBlock(),o+=e._startBlock("Route"),o+=e._addInfo(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+e._addDes("from "+e._getDepth(this._nodeData.get(t.source.id).isShallow)),o+=e._addInfo(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+e._addDes("to "+e._getDepth(this._nodeData.get(t.source.id).isShallow)),o+=e._addInfo(Object(c.z)(t.distance)+" k")+e._addDes("distance"),o+=e._endBlock()},g._showDetails=function(e,n,i){var r=Object(o.a)(i[n]),a=this._getTradeFullData(e);t(r.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:a,trigger:"manual",sanitize:!1}).tooltip("show")},e._hideDetails=function(e,n,i){t(Object(o.a)(i[n]).node()).tooltip("dispose")},g._getSiblingLinks=function(t,e){return this._linkDataFiltered.filter((function(n){return n.source.id===t&&n.target.id===e||n.source.id===e&&n.target.id===t})).map((function(t){return t.profit}))},g._updateGraph=function(){var t=this,n=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,o=Object(a.a)().range([5/this._scale,15/this._scale]).domain(Object(i.a)(this._linkDataFiltered,(function(t){return t.profit}))),s=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),d=Object(c.L)(this._fontSize/s),l=this._g.transition().duration(500);this._g.selectAll(".trade-link").data(n,(function(t){return e._getId(t)})).join((function(n){return n.append("path").attr("class","trade-link").attr("marker-start",(function(e){return t._nodeData.get(e.source.id).x<t._nodeData.get(e.target.id).x?"":"url(#trade-arrow)"})).attr("marker-end",(function(e){return t._nodeData.get(e.source.id).x<t._nodeData.get(e.target.id).x?"url(#trade-arrow)":""})).attr("id",(function(t){return e._getId(t)})).attr("opacity",0).on("click",(function(e,n,i){return t._showDetails(e,n,i)})).on("mouseleave",e._hideDetails).call((function(t){return t.transition(l).attr("opacity",1)}))}),(function(t){return t.attr("opacity",1)}),(function(t){return t.call((function(t){return t.transition(l).attr("opacity",0).remove()}))})).attr("d",(function(e){return function(e,n){var i={x:t._nodeData.get(n.source.id).x,y:t._nodeData.get(n.source.id).y},a={x:t._nodeData.get(n.target.id).x,y:t._nodeData.get(n.target.id).y},o=e?i.x:a.x,s=e?i.y:a.y,c=e?a.x:i.x,d=e?a.y:i.y,l=Math.sqrt(Math.pow(c-o,2)+Math.pow(d-s,2)),u=e?0:1,h=t._getSiblingLinks(n.source.id,n.target.id);if(h.length>1){var p=Object(r.b)().domain(h).range([1,h.length]);l/=1+1/h.length*(p(n.profit)-1)}return"M"+o+","+s+"A"+(l=Math.round(l))+","+l+" 0,0,"+u+" "+c+","+d}(t._nodeData.get(e.source.id).x<t._nodeData.get(e.target.id).x,e)})).attr("stroke-width",(function(t){return o(t.profit)+"px"})),this._labelG.attr("font-size",d+"px"),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,(function(t){return e._getId(t)})).join((function(t){return t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",(function(t){return"#"+e._getId(t)})).text((function(t){return Object(c.u)(t.quantity)+" "+t.good})).attr("opacity",0).call((function(t){return t.transition(l).attr("opacity",1)}))}),(function(t){return t.attr("opacity",1)}),(function(t){return t.call((function(t){return t.transition(l).attr("opacity",0).remove()}))})).attr("dy",(function(t){return"-"+o(t.profit)/1.5+"px"}))},g._updateList=function(t){switch(void 0===t&&(t=null),this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}},g._updateInventory=function(t){this._list.html(t)},g._updatePortList=function(t){this._list.html(t)},g._updateTradeList=function(){var t,n=this,i=function(n){(t=Object(o.a)("path#"+e._getId(n)).classed("highlight",!0)).dispatch("click")},r=function(){t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,(function(t){return e._getId(t)})).join((function(t){return t.append("div").attr("class","block").on("mouseenter",i).on("mouseleave",r)})).html((function(t){return n._getTradeLimitedData(t)}))},g._filterTradesByVisiblePorts=function(){var t=this,e=new Set(this._portData.filter((function(e){return e.coordinates[0]>=t._lowerBound[0]&&e.coordinates[0]<=t._upperBound[0]&&e.coordinates[1]>=t._lowerBound[1]&&e.coordinates[1]<=t._upperBound[1]})).map((function(t){return t.id})));this._linkDataFiltered=this._linkData.filter((function(t){return e.has(t.source.id)||e.has(t.target.id)})).slice(0,this._numTrades)},g._filterTradesBySelectedNations=function(){var t=this;this._linkData=this._linkData.filter((function(e){return t._portDataFiltered.has(e.source.id)&&t._portDataFiltered.has(e.target.id)})).slice(0,this._numTrades)},g._filterPortsBySelectedNations=function(){var t=new Set(u(this._nationSelector.selectedOptions).map((function(t){return t.value})));this._portDataFiltered=new Set(this._portData.filter((function(e){return t.has(e.nation)})).map((function(t){return t.id})))},g._getShowValue=function(){var t=this._showCookie.get();return this._showRadios.set(t),"on"===t},g._getProfitValue=function(){var t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t},e._showElem=function(t){t.classed("d-none",!1)},e._hideElem=function(t){t.classed("d-none",!0)},g.update=function(t){void 0===t&&(t=null),this.show&&(this._filterTradesByVisiblePorts(),this._updateGraph(),this._updateList(t))},g.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},g.transform=function(t){this._g.attr("transform",t),this._scale=t.k,this.update()},g.clearMap=function(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()},h=e,(f=[{key:"listType",set:function(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],e._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,e._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}},get:function(){return this._listType}}])&&_(h.prototype,f),m&&_(h,m),e}()}).call(this,n("xeH2"))},NKIh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},NhBM:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},VMvF:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d2ccc2' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},aQA4:function(t,e,n){t.exports=n.p+"images/flags/USa.svg"},cAXh:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return u}));n("iPZ8"),n("kypl"),n("pCzD"),n("hi3g"),n("lYjL"),n("IlJM"),n("SJSz"),n("4owi"),n("IvQZ"),n("/YXa"),n("8cZI"),n("lmye"),n("RsBt"),n("D/wG"),n("1Qwx"),n("fp7Y"),n("JBxO"),n("FdtR"),n("Muwe"),n("9UJh"),n("RsMT"),n("4NM0"),n("WoWj"),n("aZFp"),n("3dw1"),n("U00V"),n("wcNg"),n("3XUK"),n("m1XM"),n("btHz");var i=n("TiKg"),r=n.n(i),a=(n("+NlM"),n("kCRU"),n("f4w0")),o=n("Av7d"),s=n("0lY5");function c(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function d(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function l(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){d(a,i,r,o,s,"next",t)}function s(t){d(a,i,r,o,s,"throw",t)}o(void 0)}))}}var u=function(){function e(t,e,n){this._ports=t,this._pbZone=e,this._map=n,this._dateFormat="D MMM",this._timeFormat="HH.00",this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.getElementById(this._frontlineAttackingNationId),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.getElementById(this._frontlineDefendingNationId),this._portNamesId="port-names-select",this._portNamesSelector=document.getElementById(this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.getElementById(this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.getElementById(this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.getElementById(this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.getElementById(this._propClanId),this._propCMId="prop-cm-select",this._propCMSelector=document.getElementById(this._propCMId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}var n=e.prototype;return n._setupSelects=function(){this._setupPortSelect(),this._setupGoodSelect(),this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect(),this._setupCMSelect()},n._resetOtherSelects=function(e){var n=this;[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector,this._propCMSelector].forEach((function(i){i===e||i===n._propClanSelector&&e===n._propNationSelector||i===n._propNationSelector&&e===n._propClanSelector||t(i).val("default").selectpicker("refresh")}))},n._loadData=function(){var t=l(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"data",t.prev=1,t.next=4,fetch("data/"+this._map.serverName+"-frontlines.json");case 4:return t.next=6,t.sent.json();case 6:this._frontlinesData=t.sent,t.next=12;break;case 9:t.prev=9,t.t0=t.catch(1),Object(s.J)(t.t0);case 12:case"end":return t.stop()}}),t,this,[[1,9]])})));return function(){return t.apply(this,arguments)}}(),n._setupListener=function(){var e=this;t(this._portNamesSelector).one("show.bs.select",(function(){e._injectPortSelect()})),this._portNamesSelector.addEventListener("change",(function(t){Object(a.b)("Menu","Port relations"),e._resetOtherSelects(e._portNamesSelector),e._portSelected(),t.preventDefault()})),t(this._buyGoodsSelector).one("show.bs.select",(function(){e._injectGoodsSelect()})),this._buyGoodsSelector.addEventListener("change",(function(t){Object(a.b)("Menu","Goods’ relations"),e._resetOtherSelects(e._buyGoodsSelector),e._goodSelected(),t.preventDefault()})),this._inventorySelector.addEventListener("change",(function(t){Object(a.b)("Menu","Inventory"),e._resetOtherSelects(e._inventorySelector),e.inventorySelected(),t.preventDefault()})),t(this._frontlineAttackingNationSelector).one("loaded.bs.select",l(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._loadData();case 2:case"end":return t.stop()}}),t)})))),this._frontlineAttackingNationSelector.addEventListener("change",(function(t){Object(a.b)("Menu","Frontlines Attack"),e._resetOtherSelects(e._frontlineAttackingNationSelector),e._frontlineAttackingNationSelected(),t.preventDefault()})),t(this._frontlineDefendingNationSelector).one("loaded.bs.select",l(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e._loadData();case 2:case"end":return t.stop()}}),t)})))),this._frontlineDefendingNationSelector.addEventListener("change",(function(t){Object(a.b)("Menu","Frontlines Defence"),e._resetOtherSelects(e._frontlineDefendingNationSelector),e._frontlineDefendingNationSelected(),t.preventDefault()})),this._propNationSelector.addEventListener("change",(function(t){e._resetOtherSelects(e._propNationSelector),e._nationSelected(),t.preventDefault()})),this._propClanSelector.addEventListener("change",(function(t){e._resetOtherSelects(e._propClanSelector),e._clanSelected(),t.preventDefault()})),this._propCMSelector.addEventListener("change",(function(t){e._resetOtherSelects(e._propCMSelector),e._CMSelected(),t.preventDefault()})),document.getElementById("menu-prop-deep").addEventListener("click",(function(){return e._depthSelected("deep")})),document.getElementById("menu-prop-shallow").addEventListener("click",(function(){return e._depthSelected("shallow")})),document.getElementById("menu-prop-all").addEventListener("click",(function(){return e._allSelected()})),document.getElementById("menu-prop-non-capturable").addEventListener("click",(function(){return e._nonCapSelected()})),document.getElementById("menu-prop-large").addEventListener("click",(function(){return e._portSizeSelected("Large")})),document.getElementById("menu-prop-medium").addEventListener("click",(function(){return e._portSizeSelected("Medium")})),document.getElementById("menu-prop-small").addEventListener("click",(function(){return e._portSizeSelected("Small")})),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"icon icon-clock",date:"icon icon-calendar",up:"icon icon-chevron-top",down:"icon icon-chevron-bottom",previous:"icon icon-chevron-left",next:"icon icon-chevron-right",clear:"icon icon-clear",close:"icon icon-close"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),t("#prop-pb-range").submit((function(t){e._capturePBRange(),t.preventDefault()})),document.getElementById("menu-prop-today").addEventListener("click",(function(){return e._capturedToday()})),document.getElementById("menu-prop-yesterday").addEventListener("click",(function(){return e._capturedYesterday()})),document.getElementById("menu-prop-this-week").addEventListener("click",(function(){return e._capturedThisWeek()})),document.getElementById("menu-prop-last-week").addEventListener("click",(function(){return e._capturedLastWeek()}));var n=t("#prop-from"),i=t("#prop-to");n.datetimepicker({format:this._dateFormat}),i.datetimepicker({format:this._dateFormat,useCurrent:!1}),n.on("change.datetimepicker",(function(t){return i.datetimepicker("minDate",t.date)})),i.on("change.datetimepicker",(function(t){return n.datetimepicker("maxDate",t.date)})),t("#prop-range").submit((function(t){e._captureRange(),t.preventDefault()})),Object(o.A)("selectPortNavbar")},n._injectPortSelect=function(){var e=""+this._ports.portDataDefault.map((function(t){return{id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}})).sort(Object(s.M)(["name"])).map((function(t){return'<option data-subtext="'+t.nation+'" value="'+t.coord+'" data-id="'+t.id+'">'+t.name+"</option>"})).join("");this._portNamesSelector.insertAdjacentHTML("beforeend",e),t(this._portNamesSelector).selectpicker("refresh")},n._setupPortSelect=function(){this._portNamesSelector.classList.add("selectpicker"),t(this._portNamesSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show port relations",virtualScroll:!0})},n._injectGoodsSelect=function(){var e=new Set;this._ports.portDataDefault.forEach((function(t){["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"].forEach((function(n){t[n]&&t[n].forEach((function(t){return e.add(t)}))}))}));var n=""+c(e).sort().map((function(t){return"<option>"+t+"</option>"})).join("");this._buyGoodsSelector.insertAdjacentHTML("beforeend",n),t(this._buyGoodsSelector).selectpicker("refresh")},n._setupGoodSelect=function(){this._buyGoodsSelector.classList.add("selectpicker"),t(this._buyGoodsSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show goods’ relations",virtualScroll:!0})},n.setupInventorySelect=function(e){if(!this._inventorySelector.classList.contains("selectpicker")){var n=new Set;this._ports.portDataDefault.forEach((function(t){t.inventory&&t.inventory.forEach((function(t){return n.add(t.name)}))}));var i=""+c(n).sort().map((function(t){return"<option>"+t+"</option>"})).join("");this._inventorySelector.insertAdjacentHTML("beforeend",i),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))},n._getNationOptions=function(t){return void 0===t&&(t=!0),""+o.E.filter((function(e){return!(!t&&("FT"===e.short||"NT"===e.short))})).sort(Object(s.M)(["name"])).map((function(t){return'<option value="'+t.short+'">'+t.name+"</option>"})).join("")},n._setupFrontlinesNationSelect=function(){var e=this._getNationOptions(!1);this._frontlineAttackingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineAttackingNationSelector.classList.add("selectpicker"),t(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),this._frontlineDefendingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineDefendingNationSelector.classList.add("selectpicker"),t(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})},n._setupNationSelect=function(){var e=this._getNationOptions(!0);this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})},n._setupClanSelect=function(){var e=new Set;this._ports.portData.filter((function(t){return t.capturer})).forEach((function(t){return e.add(t.capturer)})),this._propClanSelector.innerHTML="";var n="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,n=""+c(e).sort().map((function(t){return'<option value="'+t+'" class="caps">'+t+"</option>"})).join("")),this._propClanSelector.insertAdjacentHTML("beforeend",n),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})},n._setupCMSelect=function(){var e=new Set;this._ports.portData.forEach((function(t){return e.add(t.conquestMarksPension)}));var n=""+c(e).sort().map((function(t){return'<option value="'+t+'">'+t+"</option>"})).join("");this._propCMSelector.insertAdjacentHTML("beforeend",n),this._propCMSelector.classList.add("selectpicker"),t(this._propCMSelector).selectpicker()},n._setTradePortPartners=function(){var t=this,e=this._ports.portDataDefault.find((function(e){return e.id===t._ports.tradePortId})),n=e.consumesTrading?e.consumesTrading.map((function(t){return t})):[],i=e.dropsTrading?e.dropsTrading.map((function(t){return t})):[];this._ports.portData=this._ports.portDataDefault.map((function(t){return t.goodsToBuyInTradePort=t.consumesTrading?t.consumesTrading.filter((function(t){return i.includes(t)})).map((function(t){return t})):[],t.buyInTradePort=Boolean(t.goodsToBuyInTradePort.length),t.goodsToSellInTradePort=t.dropsTrading?t.dropsTrading.filter((function(t){return n.includes(t)})).map((function(t){return t})):[],t.sellInTradePort=Boolean(t.goodsToSellInTradePort.length),t})).filter((function(e){return e.id===t._ports.tradePortId||e.sellInTradePort||e.buyInTradePort}))},n._portSelected=function(){var t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),n=Number(t.getAttribute("data-id"));this._ports.currentPort={id:n,coord:{x:Number(e[0]),y:Number(e[1])}},this._ports.tradePortId=n,this._setTradePortPartners(),this._pbZone._showPBZones&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update(),this._ports._map.initialZoomAndPan()},n._goodSelected=function(){var t=this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value,e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter((function(e){return e.dropsTrading&&e.dropsTrading.some((function(e){return e===t}))||e.dropsNonTrading&&e.dropsNonTrading.some((function(e){return e===t}))||e.producesNonTrading&&e.producesNonTrading.some((function(e){return e===t}))})))).map((function(t){return t.isSource=!0,t})),n=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter((function(e){return e.consumesTrading&&e.consumesTrading.some((function(e){return e===t}))})))).map((function(t){return t.isSource=!1,t}));this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(n),this._ports.showRadius="currentGood",this._ports.update()},n.inventorySelected=function(){this.isInventorySelected=!0;var t,e=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,n=new Map,i=new Map,r=this._ports.portDataDefault.filter((function(t){return t.inventory&&t.inventory.some((function(t){return t.name===e}))})).sort(Object(s.M)(["name"])).map((function(t){var r=t.inventory.find((function(t){return t.name===e}));return t.sellInTradePort=r.buyQuantity>0,t.sellInTradePort&&n.set(t.name,{name:t.name,nation:t.nation,good:r}),t.buyInTradePort=r.sellQuantity>0,t.buyInTradePort&&i.set(t.name,{name:t.name,nation:t.nation,good:r}),t}));this._ports.setShowRadiusSetting("off"),this._ports.portData=r,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((t="",t+="<h5>"+e+"</h5>",n.size&&(t+="<h6>Buy</h6>",n.forEach((function(e){t+=e.name+' <span class="caps">'+e.nation+"</span>: "+Object(s.u)(e.good.buyQuantity)+" @ "+Object(s.y)(e.good.buyPrice)+"<br>"}))),n&&i&&(t+="<p></p>"),i.size&&(t+="<h6>Sell</h6>",i.forEach((function(e){t+=e.name+' <span class="caps">'+e.nation+"</span>: "+Object(s.u)(e.good.sellQuantity)+" @ "+Object(s.y)(e.good.sellPrice)+"<br>"}))),t)),this._ports.update()},n._setFrontlinePorts=function(t,e){var n=new Set(this._frontlinesData[t][e].map((function(t){return Number(t.key)}))),i=new Set(this._frontlinesData[t][e].flatMap((function(t){return t.value.map((function(t){return t}))})));this._ports.portData=this._ports.portDataDefault.map((function(t){return t.enemyPort=n.has(t.id),t.ownPort=i.has(t.id),t}))},n._frontlineAttackingNationSelected=function(){var t=this._frontlineAttackingNationSelector.options[this._frontlineAttackingNationSelector.selectedIndex].value;this._setFrontlinePorts("attacking",t),this._ports.showRadius="frontline",this._ports.update()},n._frontlineDefendingNationSelected=function(){var t=this._frontlineDefendingNationSelector.options[this._frontlineDefendingNationSelector.selectedIndex].value;this._setFrontlinePorts("defending",t),this._ports.showRadius="frontline",this._ports.update()},n._nationSelected=function(){var e=this;this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,this._ports.portData=this._ports.portDataDefault.filter((function(t){return t.nation===e._nation})),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")},n._clanSelected=function(){var t=this,e=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;0!==e?this._ports.portData=this._ports.portDataDefault.filter((function(t){return t.capturer===e})):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter((function(e){return e.nation===t._nation}))),this._ports.showRadius="",this._ports.update()},n._depthSelected=function(t){var e=this._ports.portDataDefault.filter((function(e){return"shallow"===t?e.shallow:!e.shallow}));this._ports.portData=e,this._ports.showRadius="",this._ports.update()},n._allSelected=function(){var t=this._ports.portDataDefault.filter((function(t){return t.availableForAll}));this._ports.portData=t,this._ports.showRadius="",this._ports.update()},n._nonCapSelected=function(){var t=this._ports.portDataDefault.filter((function(t){return t.nonCapturable}));this._ports.portData=t,this._ports.showRadius="",this._ports.update()},n._portSizeSelected=function(t){var e=this._ports.portDataDefault.filter((function(e){return t===e.portBattleType}));this._ports.portData=e,this._ports.showRadius="",this._ports.update()},n._CMSelected=function(){var t,e=Number(this._propCMSelector.options[this._propCMSelector.selectedIndex].value);t=0===e?this._ports.portDataDefault:this._ports.portDataDefault.filter((function(t){return e===t.conquestMarksPension})),this._ports.portData=t,this._ports.showRadius="",this._ports.update()},n._capturePBRange=function(){var t=Object(o.F)(o.L-2,o.L),e=24-(t.length+1),n=new Set,i=r()(document.getElementById("prop-pb-from-input").value,this._timeFormat).hour(),a=r()(document.getElementById("prop-pb-to-input").value,this._timeFormat).hour();if(!(t.includes(i)&&t.includes(a)&&i<=a)){n.add(0),a<i&&(a+=24);for(var s=i-2;s<=a-3;s+=1)n.add((s-10)%e)}var c=this._ports.portDataDefault.filter((function(t){return!t.nonCapturable&&"FT"!==t.nation&&n.has(t.portBattleStartTime)}));this._ports.portData=c,this._ports.showRadius="",this._ports.update()},n._filterCaptured=function(t,e){var n=this._ports.portDataDefault.filter((function(n){return r()(n.lastPortBattle,"YYYY-MM-DD HH:mm").isBetween(t,e,null,"(]")}));this._ports.portData=n,this._ports.showRadius="",this._ports.update()},n._capturedToday=function(){var t=r.a.utc(),e=r()().utc().hour(o.L).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,r.a.utc(e).add(1,"day"))},n._capturedYesterday=function(){var t=r.a.utc(),e=r()().utc().hour(o.L).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,r.a.utc(e).add(1,"day"))},n._capturedThisWeek=function(){var t=r()().utc().startOf("week"),e=t.utc().hour(o.L),n=r()(t).utc().add(7,"day").hour(o.L);this._filterCaptured(e,n)},n._capturedLastWeek=function(){var t=r()().utc().startOf("week"),e=r()(t).utc().subtract(7,"day").hour(o.L),n=t.utc().hour(o.L);this._filterCaptured(e,n)},n._captureRange=function(){var e=t("#prop-from").datetimepicker("viewDate"),n=t("#prop-to").datetimepicker("viewDate"),i=e.utc().hour(o.L).minute(0),r=n.utc().add(1,"day").hour(o.L).minute(0);this._filterCaptured(i,r)},n.clearMap=function(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")},e}()}).call(this,n("xeH2"))},cCJq:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));n("hi3g"),n("lmye"),n("WB5j");var i=n("ntgT"),r=n("PVJp"),a=n("XGRO"),o=n("OQCi"),s=n("Av7d"),c=n("0lY5");function d(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=function(){function t(t){this._map=t,this._isShown="on"===this._map._showGrid,this._minCoord=this._map.coord.min,this._maxCoord=this._map.coord.max,this._height=this._map.height,this._width=this._map.width,this._defaultFontSize=this._map.rem,this._xBackgroundHeight=this._map.xGridBackgroundHeight,this._yBackgroundWidth=this._map.yGridBackgroundWidth,this._setupSvg()}var e,n,l,u=t.prototype;return u._setupSvg=function(){this._setupScale(),this._setupAxis()},u._setupScale=function(){this._xScale=Object(o.a)().clamp(!0).domain([Object(s.o)(this._minCoord,this._minCoord),Object(s.o)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord]),this._yScale=Object(o.a)().clamp(!0).domain([Object(s.p)(this._minCoord,this._minCoord),Object(s.p)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord])},u._setupAxis=function(){var t=this._getTicks(65);this._xAxis=Object(i.a)(this._xScale).tickFormat(c.q).tickValues(t).tickSize(this._maxCoord),this._yAxis=Object(i.c)(this._yScale).tickFormat(c.q).tickValues(t).tickSize(this._maxCoord),this._svgMap=Object(r.a)("#na-svg"),this._svgXAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none"),this._gXAxis=this._svgXAxis.append("g"),this._svgYAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none"),this._gYAxis=this._svgYAxis.append("g"),this._displayAxis(),this._setupXAxis(),this._setupYAxis()},u._getTicks=function(t){for(var e=Math.round(Object(s.p)(this._minCoord,this._minCoord)),n=Math.round(Object(s.p)(this._maxCoord,this._maxCoord)),i=(n-e)/(t-1),r=[],a=i;a<n;a+=i)r.push(Math.round(a));r.push(n);var o=r.slice(0).reverse().map((function(t){return-t}));return o.push(0),o.concat(r)},u._setupXAxis=function(){this._gXAxis.selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),this._gXAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null)},u._setupYAxis=function(){this._gYAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null),this._gYAxis.selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")},u._displayAxis=function(){var t=a.c?a.c.transform.k:1,e=Object(c.L)(this._defaultFontSize/t),n=Object(c.L)(1/t),i=a.c?a.c.transform.y:0,r=i/t<this._width?i/t:0,o=-this._maxCoord-r,s=a.c?a.c.transform.x:0,d=s/t<this._height?s/t:0,l=-this._maxCoord-d;this._gXAxis.attr("font-size",e).attr("stroke-width",n).call(this._xAxis.tickPadding(o)),this._gYAxis.attr("font-size",e).attr("stroke-width",n).call(this._yAxis.tickPadding(l))},u.update=function(){var t=!1;this._isShown&&"initial"!==this.zoomLevel&&(t=!0),this._map.gridOverlay.classList.toggle("overlay-grid",t),this._map.gridOverlay.classList.toggle("overlay-no-grid",!t),this._svgXAxis.classed("d-none",!t),this._svgYAxis.classed("d-none",!t)},u.transform=function(t){this._gXAxis.attr("transform",t),this._gYAxis.attr("transform",t),this._displayAxis()},e=t,(n=[{key:"show",set:function(t){this._isShown=t},get:function(){return this._isShown}},{key:"zoomLevel",set:function(t){this._zoomLevel=t},get:function(){return this._zoomLevel}}])&&d(e.prototype,n),l&&d(e,l),t}()},cRa1:function(t,e,n){},ceqg:function(t,e,n){var i={"./DE.svg":"q3Xn","./DEa.svg":"2ISq","./DK.svg":"98Ys","./DKa.svg":"8kDF","./ES.svg":"ogJC","./ESa.svg":"wOMk","./FR.svg":"0kUG","./FRa.svg":"+RFf","./FT.svg":"8niD","./GB.svg":"oogA","./GBa.svg":"1j+5","./NT.svg":"VMvF","./PL.svg":"NhBM","./PLa.svg":"Fg8x","./PR.svg":"kuLP","./PRa.svg":"2beG","./RU.svg":"xdGh","./RUa.svg":"md73","./SE.svg":"hAv/","./SEa.svg":"sZIO","./US.svg":"4aJ5","./USa.svg":"aQA4","./VP.svg":"z0Ar","./VPa.svg":"NKIh"};function r(t){var e=a(t);return n(e)}function a(t){if(!n.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}r.keys=function(){return Object.keys(i)},r.resolve=a,t.exports=r,r.id="ceqg"},eqiN:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));n("hi3g"),n("lYjL"),n("8cZI"),n("lmye"),n("fp7Y"),n("JBxO"),n("FdtR"),n("wcNg");var i=n("PVJp"),r=n("0lY5"),a=n("NO11"),o=n("iJ1D");function s(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}var c=function(){function t(t){this._ports=t,this._showId="show-zones",this._showValues=["pb-all","pb-single","raid-all","raid-single","off"],this._showCookie=new a.a({id:this._showId,values:this._showValues}),this._showRadios=new o.a(this._showId,this._showValues),this._showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}var e=t.prototype;return e._setupSvg=function(){this._g=Object(i.a)("#na-svg").insert("g","#ports").attr("class","pb")},e._loadData=function(){var t,e=(t=regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,n.e(8).then(n.t.bind(null,"uFbE",3));case 3:this._pbZonesDefault=t.sent.default,t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),Object(r.J)(t.t0);case 9:case"end":return t.stop()}}),t,this,[[0,6]])})),function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){s(a,i,r,o,c,"next",t)}function c(t){s(a,i,r,o,c,"throw",t)}o(void 0)}))});return function(){return e.apply(this,arguments)}}(),e._setupListener=function(){var t=this;document.getElementById(this._showId).addEventListener("change",(function(e){t._showPBZonesSelected(),e.preventDefault()}))},e._getShowPBSetting=function(){var t=this._showCookie.get();return this._showRadios.set(t),t},e._refreshPBZones=function(){this.refresh(),this._ports.updateTexts()},e._showPBZonesSelected=function(){this._showPB=this._showRadios.get(),this._showCookie.set(this._showPB),this._refreshPBZones()},e._update=function(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,(function(t){return t.id})).join((function(t){var e=t.append("g").attr("class","pb-zones");e.append("path").attr("class","pb-join-circle").attr("d",(function(t){return Object(r.n)(t.joinCircles[0],t.joinCircles[1],28).concat(Object(r.n)(t.joinCircles[0],t.joinCircles[1],14))})),e.append("path").attr("class","pb-circle").attr("d",(function(t){return t.pbCircles.map((function(t){return Object(r.n)(t[0],t[1],3.5)})).join("")})),e.append("text").attr("class","pb-text pb-circle-text").attr("x",(function(t){return t.pbCircles.map((function(t){return t[0]}))})).attr("y",(function(t){return t.pbCircles.map((function(t){return t[1]}))})).text((function(t){return t.pbCircles.map((function(t,e){return String.fromCharCode(65+e)})).join("")}))})),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,(function(t){return t.id})).join((function(t){var e=t.append("g").attr("class","raid-zones");e.append("path").attr("class","raid-join-circle").attr("d",(function(t){return Object(r.n)(t.joinCircles[0],t.joinCircles[1],35)})),e.append("path").attr("class","raid-circle").attr("d",(function(t){return t.raidCircles.map((function(t){return Object(r.n)(t[0],t[1],4.5)})).join("")})),e.append("text").attr("class","pb-text raid-circle-text").attr("x",(function(t){return t.raidCircles.map((function(t){return t[0]}))})).attr("y",(function(t){return t.raidCircles.map((function(t){return t[1]}))})).text((function(t){return t.raidCircles.map((function(t,e){return String.fromCharCode(65+e)})).join("")})),e.append("path").attr("class","raid-point").attr("d",(function(t){return t.raidPoints.map((function(t){return Object(r.n)(t[0],t[1],1.5)})).join("")})),e.append("text").attr("class","pb-text raid-point-text").attr("x",(function(t){return t.raidPoints.map((function(t){return t[0]}))})).attr("y",(function(t){return t.raidPoints.map((function(t){return t[1]}))})).text((function(t){return t.raidPoints.map((function(t,e){return String.fromCharCode(49+e)})).join("")}))})),this._g.selectAll("g.defence").data(this._defencesFiltered,(function(t){return t.id})).join((function(t){var e=t.append("g").attr("class","defence");e.append("path").attr("class","fort").attr("d",(function(t){return t.forts.map((function(t){return Object(r.p)(t[0],t[1],3)})).join("")})),e.append("text").attr("class","pb-text pb-fort-text").attr("x",(function(t){return t.forts.map((function(t){return t[0]}))})).attr("y",(function(t){return t.forts.map((function(t){return t[1]}))})).text((function(t){return t.forts.map((function(t,e){return""+(e+1)})).join("")})),e.append("path").attr("class","tower").attr("d",(function(t){return t.towers.map((function(t){return Object(r.n)(t[0],t[1],1.5)})).join("")})),e.append("text").attr("class","pb-text pb-tower-text").attr("x",(function(t){return t.towers.map((function(t){return t[0]}))})).attr("y",(function(t){return t.towers.map((function(t){return t[1]}))})).text((function(t){return t.towers.map((function(t,e){return""+(e+1)})).join("")}))}))},e._isPortIn=function(t){return"pb-all"===this._showPB||"raid-all"===this._showPB||("pb-single"===this._showPB||"raid-single"===this._showPB)&&Number(t.id)===this._ports.currentPort.id},e._setData=function(){var t=this;"pbZone"===this._ports.zoomLevel&&"off"!==this._showPB?this._isDataLoaded?this._filterVisible():this._loadData().then((function(){t._isDataLoaded=!0,t._filterVisible()})):(this._defencesFiltered={},this._pbZonesFiltered={},this._raidZonesFiltered={})},e._filterVisible=function(){var t=this,e=this._pbZonesDefault.filter((function(e){return e.position[0]>=t._lowerBound[0]&&e.position[0]<=t._upperBound[0]&&e.position[1]>=t._lowerBound[1]&&e.position[1]<=t._upperBound[1]})).filter((function(e){return t._isPortIn(e)}));this._defencesFiltered=e.map((function(t){return{id:t.id,forts:t.forts,towers:t.towers}})),"pb-all"===this._showPB||"pb-single"===this._showPB?(this._pbZonesFiltered=e.map((function(t){return{id:t.id,pbCircles:t.pbCircles,joinCircles:t.joinCircles}})),this._raidZonesFiltered={}):(this._pbZonesFiltered={},this._raidZonesFiltered=e.map((function(t){return{id:t.id,joinCircles:t.joinCircles,raidCircles:t.raidCircles,raidPoints:t.raidPoints}})))},e.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},e.refresh=function(){this._setData(),this._update()},e.transform=function(t){this._g.attr("transform",t)},t}()},"hAv/":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},j9j5:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return u}));n("3XUK"),n("Peo2"),n("/1Gu");var i=n("PVJp"),r=n("NBGV"),a=n("TiKg"),o=n.n(a),s=(n("YmdP"),n("W/Hz"),n("8sDi"),n("f4w0")),c=n("Av7d"),d=n("0lY5"),l=n("NO11"),u=function(){function e(){this._line=Object(r.a)(),this._windPath=null,this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new l.a({id:this._baseId+"-degrees",expire:this._cookieExpire}),this._cookieTime=new l.a({id:this._baseId+"-time"}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}var n=e.prototype;return n._getHeight=function(){var t=document.querySelector("#port-summary .block"),e=t.getBoundingClientRect();return e.height-e.top-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))},n._getCurrentWindCookie=function(){var t=this._cookieWindDegrees.get();if(t){var e=this._cookieTime.get(),n=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-c.s*n)%360}return t},n._getExpire=function(){var t=o.a.utc(),e=o()().utc().hour(10).minute(0).second(0);return t.hour()>=e.hour()&&(e=e.add(1,"day")),e.local().toDate()},n._storeCurrentWindCookie=function(){this._cookieWindDegrees.set(this._currentWindDegrees),this._cookieTime.set(Date.now())},n._setupSvg=function(){var t=Object(i.a)("#port-summary");t.classed("port-summary-no-wind",!1).classed("port-summary-wind",!0),this._div=t.insert("div",":first-child").attr("id",this._baseId).attr("class","block p-0"),this._svg=this._div.append("svg").attr("class","ingame-wind small")},n._navbarClick=function(t){Object(s.b)("Menu",this._baseName),t.stopPropagation(),this._windRoseSelected()},n._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",(function(e){return t._navbarClick(e)}))},n._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var n=e.call(this);return this.container.append(this.tooltip),n},window.tooltip=function(t){return Object(d.k)(t.value)+"<br>"+t.value+"°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/d.d.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},n._injectModal=function(){o.a.locale("en-gb"),Object(c.C)(this._modalId,this._baseName,"sm");var t=Object(i.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")},n._initModal=function(){this._injectModal(),this._setupWindInput()},n._windRoseSelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",(function(){e._useUserInput()}))},n._windChange=function(){this._currentWindDegrees=360+(this._currentWindDegrees-c.s*this._intervalSeconds)%360,this._updateWindDirection()},n._useUserInput=function(){this._currentWindDegrees=Object(d.E)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()},n._initShowCurrentWind=function(){var t=this;this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval((function(){t._windChange()}),1e3*this._intervalSeconds)},n._updateWindDirection=function(){var t=Object(d.i)(this._currentWindDegrees),e=this._length*Math.cos(t),n=this._length*Math.sin(t),i=[[Math.round(this._xCompass+e),Math.round(this._yCompass+n)],[Math.round(this._xCompass-e),Math.round(this._yCompass-n)]];this._windPath.datum(i).attr("d",this._line),this._storeCurrentWindCookie()},n._initPrintCompassRose=function(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);var t=this._svg.append("svg").attr("class","compass").attr("x",this._xCompass).attr("y",this._yCompass);Object(d.I)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").attr("marker-end","url(#wind-arrow)")},n.clearMap=function(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=null,this._cookieWindDegrees.remove()},e}()}).call(this,n("xeH2"))},kuLP:function(t,e,n){t.exports=n.p+"images/flags/PR.svg"},md73:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},ogJC:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},oogA:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},q1r0:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return d}));n("fp7Y"),n("Pgdl"),n("3XUK"),n("Peo2");var i=n("PVJp"),r=n("TiKg"),a=n.n(r),o=(n("YmdP"),n("f4w0")),s=n("Av7d"),c=n("0lY5"),d=function(){function e(t,e){this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._xInputId="input-x-"+this._baseId,this._zInputId="input-z-"+this._baseId,this._copyButtonId="copy-coord-"+this._baseId,this._submitButtonId="submit-"+this._baseId,this._modal$=null,this._setupSvg(),this._setupListener()}var n=e.prototype;return n._setupSvg=function(){this._g=Object(i.a)("#na-svg").append("g").classed("f11",!0)},n._navbarClick=function(t){Object(o.b)("Menu","Go to F11"),t.stopPropagation(),this._f11Selected()},n._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",(function(e){return t._navbarClick(e)})),window.addEventListener("keydown",(function(e){"F11"===e.code&&e.shiftKey&&t._navbarClick(e)}))},n._injectModal=function(){Object(s.C)(this._modalId,this._baseName,"sm");var t=Object(i.a)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");var e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");var n=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);n.append("label").attr("for",this._zInputId),n.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),n.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");var r=t.append("div").classed("float-right btn-group",!0).attr("role","group");r.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),r.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to"),Object(i.a)("#"+this._modalId+" .modal-footer").remove()},n._initModal=function(){this._injectModal()},n._f11Selected=function(){var e=this;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId),this._xInputSel=document.getElementById(this._xInputId),this._zInputSel=document.getElementById(this._zInputId),this._formSel.addEventListener("submit",(function(t){e._modal$.modal("hide"),t.preventDefault(),e._useUserInput()})),this._modal$.on("keydown",(function(t){"KeyC"===t.code&&t.ctrlKey&&e._copyCoordClicked(t)})),document.getElementById(this._copyButtonId).addEventListener("click",(function(t){e._copyCoordClicked(t)}))),this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()},n._getInputValue=function(t){var e=t.value;return""===e?1/0:Number(e)},n._getXCoord=function(){return this._getInputValue(this._xInputSel)},n._getZCoord=function(){return this._getInputValue(this._zInputSel)},n._useUserInput=function(){var t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)},n._copyCoordClicked=function(t){Object(o.b)("Menu","Copy F11 coordinates"),t.preventDefault();var e=this._getXCoord(),n=this._getZCoord();Object(c.f)(e,n)},n._printF11Coord=function(t,e,n,i){var r=10,o=this._g.append("g").attr("transform","translate("+t+","+e+")"),s=o.append("rect"),d=o.append("rect");o.append("circle").attr("r",r),r*=1.6;var l=o.append("text").attr("dx",-r+"px").attr("dy",-r/2-2+"px").attr("class","f11-coord").text(Object(c.q)(n)),u=o.append("text").attr("dx",-r+"px").attr("dy",r/2+2+"px").attr("class","f11-coord").text(Object(c.q)(i)),h=l.node().getBBox(),p=u.node().getBBox(),_=a()().utc(),f=a()(),m=o.append("text").attr("dx",r+"px").attr("dy",-r/2-2+"px").attr("class","f11-time").text(_.format("H.mm")),g=o.append("text").attr("dx",r+"px").attr("dy",r/2+2+"px").attr("class","f11-time").text("("+f.format("H.mm")+" local)"),v=m.node().getBBox(),b=g.node().getBBox(),y=1.2*Math.round(h.height+p.height),w=Math.round(Math.max(h.width,p.width)+5),S=1.2*Math.round(v.height+b.height),x=Math.round(Math.max(v.width,b.width)+5),I=Math.max(y,S);s.attr("x",-w-r).attr("y",-I/2).attr("height",I).attr("width",w+r),d.attr("x",0).attr("y",-I/2).attr("height",I).attr("width",x+r)},n._goToF11=function(t,e){var n=Number(t),i=Number(e),r=Math.floor(Object(s.m)(n,i)),a=Math.floor(Object(s.n)(n,i));Object(c.a)(r,this._coord.min,this._coord.max,!0)&&Object(c.a)(a,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(r,a,n,i),this._map.zoomAndPan(r,a,1))},n.goToF11FromParam=function(t){var e=-1e3*Number(t.get("x")),n=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(n)&&(Object(o.b)("Menu","Paste F11 coordinates"),this._goToF11(e,n))},n.printCoord=function(t,e){var n=Object(s.o)(t,e),i=Object(s.p)(t,e);this._printF11Coord(t,e,n,i)},n.transform=function(t){this._g.attr("transform",t)},n.clearMap=function(){this._g.selectAll("*").remove()},e}()}).call(this,n("xeH2"))},q3Xn:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},sZIO:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},vi22:function(t,e,n){"use strict";n.r(e),function(t){n.d(e,"Map",(function(){return C}));n("8cZI"),n("eUWX"),n("uAsx"),n("JBxO"),n("FdtR"),n("9UJh"),n("3dw1"),n("wcNg"),n("3XUK"),n("Peo2");var i=n("lpOn"),r=n("XGRO"),a=n("PVJp"),o=n("vq1v"),s=n("NRFW"),c=n("f4w0"),d=n("Av7d"),l=n("0lY5"),u=n("NO11"),h=n("iJ1D"),p=n("eqiN"),_=n("FmV8"),f=n("cAXh"),m=n("q1r0"),g=n("cCJq"),v=n("8gAj"),b=n("62GW"),y=n("j9j5"),w=n("JNxp");function S(t,e,n,i,r,a,o){try{var s=t[a](o),c=s.value}catch(t){return void n(t)}s.done?e(c):Promise.resolve(c).then(i,r)}function x(t){return function(){var e=this,n=arguments;return new Promise((function(i,r){var a=t.apply(e,n);function o(t){S(a,i,r,o,s,"next",t)}function s(t){S(a,i,r,o,s,"throw",t)}o(void 0)}))}}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var C=function(){function e(t,e){this.serverName=t,this._searchParams=e,this.rem=d.r,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:8192},this._currentTranslate={},this._tileSize=256,this._maxScale=Math.pow(2,3),this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new u.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new h.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new u.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new h.a(this._showGridId,this._showGridValues),this._showGrid=this._getShowGridValue();var n=document.getElementsByClassName("overlay");this.gridOverlay=n[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener()}var n,S,C,k=e.prototype;return k.MapInit=function(){var t=x(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._setupData();case 2:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),k._getDoubleClickAction=function(){var t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t},k._getShowGridValue=function(){var t=this._showGridCookie.get();return this._showGridRadios.set(t),t},k._setupData=function(){var t=x(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._f11=new m.a(this,this.coord),this._ports=new _.a(this),t.next=4,this._ports.init();case 4:return this._pbZone=new p.a(this._ports),this._grid=new g.a(this),this._journey=new v.a(this.rem),this._windPrediction=new b.a,this._windRose=new y.a,this._portSelect=new f.a(this._ports,this._pbZone,this),this.showTrades=new w.a(this.serverName,this._portSelect,this._minScale,this.coord.min,this.coord.max),t.next=13,this.showTrades.showOrHide();case 13:this._init();case 14:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),e._stopProperty=function(){r.c.defaultPrevented&&r.c.stopPropagation()},k._setupListener=function(){var t=this;this._svg.on("dblclick.zoom",null).on("click",e._stopProperty,!0).on("dblclick",(function(e,n,i){return t._doDoubleClickAction(i[n])})),document.getElementById("propertyDropdown").addEventListener("click",(function(){Object(c.b)("Menu","Select port on property")})),document.getElementById("settingsDropdown").addEventListener("click",(function(){Object(c.b)("Menu","Settings")})),document.getElementById("button-download-pb-calc").addEventListener("click",(function(){Object(c.b)("Tools","Download pb calculator")})),document.getElementById("reset").addEventListener("click",(function(){t._clearMap()})),document.getElementById("about").addEventListener("click",(function(){t._showAbout()})),document.getElementById("double-click-action").addEventListener("change",(function(){return t._doubleClickSelected()})),document.getElementById("show-grid").addEventListener("change",(function(){return t._showGridSelected()}))},k._setupScale=function(){this._minScale=Object(l.G)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this._minScale},k._setupSvg=function(){var t=this;this._zoom=Object(s.a)().wheelDelta((function(){return-t._wheelDelta*Math.sign(r.c.deltaY)})).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this._minScale,this.coord.min-this.xGridBackgroundHeight*this._minScale],[this.coord.max,this.coord.max]]).scaleExtent([this._minScale,this._maxScale]).on("zoom",(function(){return t._naZoomed()})),this._svg=Object(a.a)("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").classed("map",!0)},k._doubleClickSelected=function(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()},k._showGridSelected=function(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._refreshLayer()},k._refreshLayer=function(){this._grid.update()},k._displayMap=function(t){var e=t.x,n=t.y,r=t.k,a=Math.log2(this._tileSize),o=Math.log2(this.coord.max)-a,c=this.coord.max*r,d=this.width,u=this.height,h=Math.floor(c<d?d-2*e:c),p=Math.floor(c<u?u-2*n:c),_=Math.log2(r),f=Math.min(o,Math.ceil(Math.log2(Math.max(h,p)))-a),m=Math.round(10*(f-_-o))/10,g=Math.pow(this._wheelDelta,m),v=this._tileSize*g,b=c<d?e:0,y=c<u?n:0,w=Object(i.a)(Math.max(0,Math.floor((0-e)/v)),Math.max(0,Math.min(Math.ceil((d-e-b)/v),Math.pow(2,f)))),S=Object(i.a)(Math.max(0,Math.floor((0-n)/v)),Math.max(0,Math.min(Math.ceil((u-n-y)/v),Math.pow(2,f)))),x=[];S.forEach((function(t){w.forEach((function(e){x.push({z:f,row:t,col:e,id:f.toString()+"-"+t.toString()+"-"+e.toString()})}))})),x.transform=s.b.translate(e,n).scale(Object(l.L)(g)),this._updateMap(x)},k._updateMap=function(t){var e=this;this._gMap.attr("transform",t.transform).selectAll("image").data(t,(function(t){return t.id})).join((function(t){return t.append("image").attr("xlink:href",(function(t){return"images/map/"+t.z+"/"+t.row+"/"+t.col+".webp"})).attr("x",(function(t){return t.col*e._tileSize})).attr("y",(function(t){return t.row*e._tileSize})).attr("width",e._tileSize+1).attr("height",e._tileSize+1)}))},k._clearMap=function(){this._windPrediction.clearMap(),this._windRose.clearMap(),this._f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")},e._initModal=function(t){Object(d.C)(t,d.c+' <span class="text-primary small">v'+d.d+"</span>",""),Object(a.a)("#"+t+" .modal-body").html("<p>"+d.a+' Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan Bastard Sons '+Object(l.j)("(BASTD)")+"</a>.</p>")},k._showAbout=function(){t("#modal-about").length||e._initModal("modal-about"),t("#modal-about").modal("show")},k._doDoubleClickAction=function(t){var e=Object(o.a)(t),n=Object(s.c)(t),i=e[0],r=e[1],a=n.k,c=(i-n.x)/a,d=(r-n.y)/a;"f11"===this._doubleClickAction?this._f11.printCoord(c,d):this._journey.plotCourse(c,d),this.zoomAndPan(c,d,1)},k._setZoomLevelAndData=function(){r.c.transform.k!==this._currentScale&&(this._currentScale=r.c.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)},k._naZoomed=function(){this._currentTranslate.x=Math.floor(r.c.transform.x),this._currentTranslate.y=Math.floor(r.c.transform.y);var t=s.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(l.L)(r.c.transform.k)),e=t.invert([this.coord.min,this.coord.min]),n=t.invert([this.width,this.height]);this._ports.setBounds(e,n),this._pbZone.setBounds(e,n),this.showTrades.setBounds(e,n),this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._journey.transform(t),this._pbZone.transform(t),this._f11.transform(t),this.showTrades.transform(t),this._setZoomLevelAndData()},k._checkF11Coord=function(){this._searchParams.has("x")&&this._searchParams.has("z")&&this._f11.goToF11FromParam(this._searchParams)},k._init=function(){this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight()},k.resize=function(){var t=s.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update()},k.getDimensions=function(){return document.getElementsByClassName("overlay")[0].getBoundingClientRect()},k._getWidth=function(){var t=this.getDimensions().width;return Math.floor(t)},k._getHeight=function(){var t=this.getDimensions().top,e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)},k._setHeightWidth=function(){this.width=this._getWidth(),this.height=this._getHeight()},k._setSvgSize=function(){this._svg.attr("width",this.width).attr("height",this.height)},k._setFlexOverlayHeight=function(){var t=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);document.getElementById("summary-column").setAttribute("style","height:"+t+"px")},k.initialZoomAndPan=function(){this._svg.call(this._zoom.scaleTo,this._minScale)},k.zoomAndPan=function(t,e,n){var i=s.b.scale(n).translate(Math.round(-t+this.width/2/n),Math.round(-e+this.height/2/n));this._svg.call(this._zoom.transform,i)},k.goToPort=function(){"0"===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)},n=e,(S=[{key:"zoomLevel",set:function(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t},get:function(){return this._zoomLevel}}])&&I(n.prototype,S),C&&I(n,C),e}()}.call(this,n("xeH2"))},wOMk:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},xdGh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},z0Ar:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"}}]);