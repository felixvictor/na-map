/*! For license information please see game-tools.65e2104b9caf9f5eab06.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"1mfJ":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},"8ZGG":function(t,e,a){a.d(e,"a",(function(){return s}));const s=["loot","chests","items"]},Bx8B:function(t,e,a){a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));a("UxlC");const s=(t,e)=>t&&e?t.localeCompare(e):0,i=t=>(e,a)=>{let s=0;return t.some(t=>{let i=1;return String(t).startsWith("-")&&(i=-1,t=String(t).slice(1)),s=Number.isNaN(Number(e[t]))&&Number.isNaN(Number(a[t]))?String(e[t]).localeCompare(String(a[t]))*i:(Number(e[t])-Number(a[t]))*i,0!==s}),s}},D04b:function(t,e,a){(function(t){a.d(e,"a",(function(){return w}));a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("PuWf"),i=a("wz8V"),r=a("mrVq"),o=a("gj+k"),n=a("RhHs"),d=a("3xmg"),c=a("R0i0"),l=a("VIqg"),h=a("AKWm"),p=a("wIsI"),u=a("0T5i"),m=a("44y/"),b=a("jICm"),_=a("pOjD"),g=a("pxNS"),f=a("Q4du"),v=a("oggF");function S(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class w{constructor(){S(this,"_baseName",void 0),S(this,"_baseId",void 0),S(this,"_buttonId",void 0),S(this,"_modalId",void 0),S(this,"_ownershipData",{}),S(this,"_nationData",{}),S(this,"_colourScale",void 0),S(this,"_mainDiv",void 0),S(this,"_div",void 0),S(this,"_svg",void 0),this._baseName="Port ownership",this._baseId="ownership-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._colourScale=Object(d.a)().range(f.g),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){var t;return null!==(t=Math.floor(this._mainDiv.node().offsetWidth))&&void 0!==t?t:0}async _loadAndSetupData(){try{this._nationData=(await a.e(9).then(a.t.bind(null,"igRa",3))).default,this._ownershipData=(await a.e(10).then(a.t.bind(null,"kH+C",3))).default}catch(t){Object(g.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._ownershipListSelected()})}_injectModal(){Object(f.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(h.a)(`#${this._modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t),this._mainDiv=e.append("div").attr("id",""+this._baseId),this._div=this._mainDiv.append("div"),this._svg=this._mainDiv.append("svg").attr("class","area")}_getOptions(){return""+this._ownershipData.map(t=>`<option value="${t.region}">${t.region}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._regionSelected(t)).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let e=!1;document.querySelector("#"+this._modalId)||(e=!0,this._initModal()),t("#"+this._modalId).on("shown.bs.modal",()=>{e&&(this._injectArea(),e=!1)}).modal("show")}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,w.getHeight()),a=32,d=32,h=32,_=g.e.filter(t=>9!==t.id).map(t=>t.short),f=this._nationData;f.keys=_;const S=Object(p.a)().offset(u.a).keys(_)(f);this._svg.attr("width",t).attr("height",e),(()=>{const n=(()=>{const s=Object(l.a)().domain(Object(i.a)(f,t=>new Date(t.date))).range([h,t-a]),n=Object(l.a)().domain([Object(r.a)(S[0],t=>t[0]),Object(o.a)(S[S.length-1],t=>t[1])]).range([e-d,0]);return Object(m.a)().x(t=>s(new Date(t.data.date))).y0(t=>n(t[0])).y1(t=>n(t[1])).curve(b.a)})(),c=new Map(g.e.map(t=>[t.short,t.name]));this._colourScale.domain(_),this._svg.selectAll("path").data(S).join(t=>t.append("path").attr("fill",t=>this._colourScale(t.key)).attr("stroke",t=>this._colourScale(t.key)).attr("d",n)),this._svg.selectAll(".area-label").data(S).join(t=>t.append("text").attr("class","area-label").text(t=>c.get(t.key)).attr("fill",t=>Object(v.e)(this._colourScale(t.key))).attr("transform",Object(s.areaLabel)(n)))})(),this._svg.append("g").call(s=>{const r=Object(c.b)().domain(Object(i.a)(f,t=>new Date(t.date))).range([h,t-a]);s.attr("transform",`translate(0,${e-d})`).call(Object(n.a)(r).ticks(t/80).tickSizeOuter(0)),s.attr("font-size",".8rem").attr("font-family","")})}async _injectChart(t){(await Promise.all([a.e(3),a.e(25)]).then(a.bind(null,"ZiDp"))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(e){const a=t(e.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const s=this._ownershipData.filter(t=>t.region===a).map(t=>t.data)[0];this._injectChart(s)}}}).call(this,a("xeH2"))},"Jz/z":function(t,e,a){(function(t){a.d(e,"a",(function(){return h}));a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("AKWm"),i=a("pOjD"),r=a("pxNS"),o=a("Q4du"),n=a("Qs7V"),d=a("Bx8B");function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const l=["Resources","Extra","Materials"];class h{constructor(){c(this,"_baseName",void 0),c(this,"_baseId",void 0),c(this,"_buttonId",void 0),c(this,"_modalId",void 0),c(this,"_init",!0),c(this,"_blueprintData",{}),c(this,"_woodData",{}),c(this,"_extractionCosts",{}),c(this,"_craftingCosts",{}),c(this,"_blueprint",void 0),c(this,"_woodOptions",{}),c(this,"_defaultWood",void 0),c(this,"_woodsSelected",{}),c(this,"_blueprintList",void 0),c(this,"_currentBlueprint",{}),c(this,"_tables",{}),this._baseName="List ship blueprint",this._baseId="ship-blueprint-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._defaultWood={frame:"Fir",trim:"Crew Space"},this._setupListener()}async _loadAndSetupData(){try{this._blueprintData=(await a.e(14).then(a.t.bind(null,"lFc/",3))).default,this._woodData=(await a.e(16).then(a.t.bind(null,"xOpV",3))).default;const t=(await a.e(14).then(a.t.bind(null,"ZII7",3))).default;this._extractionCosts=new Map(t.standard.map(t=>{var e;return[t.name,{reales:t.reales,labour:null!==(e=null==t?void 0:t.labour)&&void 0!==e?e:0}]})),this._craftingCosts=new Map(t.seasoned.map(t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}]))}catch(t){Object(r.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._listSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName,size:"modal-lg"});const t=this._baseId+"-ship-select",e=Object(s.a)(`#${this._modalId} .modal-body`);let a=e.append("div").classed("row no-gutters mb-2",!0);a.append("label").attr("for",t),a.append("select").attr("name",t).attr("id",t),a=e.append("div").classed("row no-gutters",!0);for(const t of r.h){const e=`${this._baseId}-${t}-select`;a.append("label").attr("for",e),a.append("select").attr("name",e).attr("id",e).classed("pr-2",!0)}this._blueprintList=e.append("div").attr("id",""+this._baseId).classed("blueprint mt-4",!0)}_getShipOptions(){return""+this._blueprintData.sort(Object(d.b)(["name"])).map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}_setupShipSelect(){const e=t(`#${this._baseId}-ship-select`),a=this._getShipOptions();e.append(a)}_setupWoodOptions(){const t=this._woodData.frame.sort(Object(d.b)(["name"])),e=this._woodData.trim.filter(t=>"Light"!==t.name).sort(Object(d.b)(["name"]));this._woodOptions={frame:t.map(t=>`<option value="${t.name}">${t.name}</option>`).join(""),trim:e.map(t=>`<option value="${t.name}">${t.name}</option>`).join("")}}_setupWoodSelect(t,e){this._setupWoodOptions(),this._woodsSelected[t]=this._defaultWood[t],e.append(this._woodOptions[t]),e.attr("disabled","disabled")}_setupSelects(){this._setupShipSelect();for(const e of r.h){const a=t(`#${this._baseId}-${e}-select`);this._setupWoodSelect(e,a)}}_setupShipSelectListener(){t(`#${this._baseId}-ship-select`).addClass("selectpicker").on("change",t=>this._blueprintSelected(t)).selectpicker({noneSelectedText:"Select blueprint",width:"fit"}).val("default").selectpicker("refresh")}_setupWoodSelectListener(t,e){e.addClass("selectpicker").on("change",()=>this._woodSelected(t,e)).selectpicker({noneSelectedText:"Select "+t,width:"fit"}).val("default").selectpicker("refresh")}_setupSelectListener(){this._setupShipSelectListener();for(const e of r.h){const a=t(`#${this._baseId}-${e}-select`);this._setupWoodSelectListener(e,a)}}_initModal(){this._injectModal(),this._setupSelects(),this._setupSelectListener()}_setWoodSelect(e){t(`#${this._baseId}-${e}-select`).removeAttr("disabled").val(this._defaultWood[e]).selectpicker("refresh")}_woodSelected(t,e){this._woodsSelected[t]=e.val(),this._updateText()}_listSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join(t=>t.append("tr")).selectAll("td").data(t=>t).join(t=>t.append("td")).html(t=>t)}_updateText(){let t=this._currentBlueprint.resources.map(t=>[t.name,t.amount]),e=!1,a=!1,s=0,i=0;if("Crew Space"===this._woodsSelected.trim){const e=this._currentBlueprint.wood.find(t=>"Crew Space"===t.name).amount,a=t.findIndex(t=>"Hemp"===t[0]);t[a][1]=t[a][1]+e}else if(i=this._currentBlueprint.wood.find(t=>"Planking"===t.name).amount,this._woodsSelected.trim===this._woodsSelected.frame)s+=i;else{const e=t.findIndex(t=>t[0]===this._woodsSelected.trim);e>=0?t[e][1]=t[e][1]+i:(a=!0,t.push([this._woodsSelected.trim,i]))}s+=this._currentBlueprint.wood.find(t=>"Frame"===t.name).amount;const o=t.findIndex(t=>t[0]===this._woodsSelected.frame);if(o>=0?t[o][1]=t[o][1]+s:(e=!0,t.push([this._woodsSelected.frame,s])),e&&a){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let d=[];this._currentBlueprint.price&&d.push(["Reales",this._currentBlueprint.price]),d.push(["Provisions",this._currentBlueprint.provisions]),this._currentBlueprint.permit&&d.push(["Permit",this._currentBlueprint.permit]),d.push(["Craft level",this._currentBlueprint.craftLevel],["Shipyard level",this._currentBlueprint.shipyardLevel],["Labour hours",this._currentBlueprint.labourHours],["Craft experience",this._currentBlueprint.craftXP]);const c=[];let l=0,h=0;const p=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.reales)&&void 0!==e?e:0)*t[1]},u=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.labour)&&void 0!==e?e:0)*t[1]},m=t=>{for(const e of t.filter(t=>this._extractionCosts.has(t[0])))l+=p(e),h+=u(e)};m(t),m(d),l&&c.push(["Reales",Object(n.c)(l)],["Labour hours",Object(n.c)(h)]);let b=0,_=0,g=0,f=0;for(const t of r.h){const e=this._craftingCosts.get(this._woodsSelected[t]);var v,S,w,y;if(e)b+=(null!==(v=e.reales)&&void 0!==v?v:0)*s,_+=(null!==(S=e.labour)&&void 0!==S?S:0)*s,g+=(null!==(w=e.doubloon)&&void 0!==w?w:0)*s,f+=(null!==(y=e.tool)&&void 0!==y?y:0)*s}b&&c.push(["(S) reales",Object(n.c)(b)]),_&&c.push(["(S) labour hours",Object(n.c)(_)]),g&&c.push(["(S) doubloons",Object(n.c)(g)]),f&&c.push(["(S) tools",Object(n.c)(f)]),t=t.map(t=>[t[0],Object(n.c)(t[1])]),d=d.map(t=>[t[0],Object(n.c)(t[1])]),this._updateTable(this._tables.Resources,t),this._updateTable(this._tables.Extra,d),this._updateTable(this._tables.Materials,c)}_blueprintSelected(e){if(this._init){this._init=!1;for(const t of r.h)this._setWoodSelect(t);const t=this._blueprintList.append("div").classed("card-deck",!0),e=e=>{const a=t.append("div").classed("card",!0);a.append("div").classed("card-header",!0).text(e);const s=a.append("div").classed("card-body",!0);this._tables[e]=s.append("table").classed("table table-sm card-table",!0),this._tables[e].append("thead"),this._tables[e].append("tbody")};for(const t of l)e(t)}this._blueprint=t(e.currentTarget).find(":selected").val(),this._currentBlueprint=this._getBlueprintData(this._blueprint),this._updateText()}_getBlueprintData(t){return this._blueprintData.find(e=>e.name===t)}}}).call(this,a("xeH2"))},K5dq:function(t,e,a){(function(t){a.d(e,"a",(function(){return f}));a("WUlJ"),a("fCtr");var s=a("AKWm"),i=a("XXsb"),r=a.n(i),o=a("2mXy"),n=a("JQHs"),d=a("pOjD"),c=a("pxNS"),l=a("Q4du"),h=a("Qs7V"),p=a("oggF"),u=a("Bx8B");function m(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function _(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const g=n.a.bind(o.a);class f{constructor(){_(this,"_baseName",void 0),_(this,"_baseId",void 0),_(this,"_buttonId",void 0),_(this,"_modalId",void 0),_(this,"_woodData",{}),_(this,"_div",void 0),this._baseName="List woods",this._baseId="wood-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._woodData=(await a.e(16).then(a.t.bind(null,"xOpV",3))).default}catch(t){Object(c.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(d.b)("Tools",this._baseName),this._woodListSelected()})}_injectModal(){Object(l.n)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=Object(s.a)(`#${this._modalId} .modal-body`);this._div={};for(const e of c.h)t.append("h5").text(Object(c.b)(e+"s")),this._div[e]=t.append("div").attr("id",e+"-list")}_initModal(){Object(p.j)(),this._injectModal();for(const t of c.h)this._injectList(t)}_woodListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getModifiers(t){const e=new Set;return this._woodData[t].forEach(t=>{t.properties.forEach(t=>{"Ship material"!==t.modifier&&"Boarding morale"!==t.modifier&&e.add(t.modifier)})}),m(e).sort(u.a)}_getList(t){const e=this._getModifiers(t);return g`
            <table id="table-${this._baseId}-${t}-list" class="table table-sm small tablesort na-table">
                ${g` <thead>
                <tr>
                    <th data-sort-default>Wood</th>
                    ${e.map(t=>g`<th class="text-right">
                            ${(t=>{const e=t.split(" ",2),a=t.slice(e.join(" ").length);return g`${e[0]}<br />${e[1]} ${a}`})(t)}
                        </th>`)}
                </tr>
            </thead>`} ${(t=>g`<tbody>
                ${this._woodData[t].map(t=>g`
                            <tr>
                                <td>${t.name}</td>

                                ${e.map(e=>{var a,s;const i=null!==(a=null===(s=t.properties.find(t=>t.modifier===e))||void 0===s?void 0:s.amount)&&void 0!==a?a:0;let r;return r="Repair amount"===e&&i?Object(h.e)(i,1):i?Object(p.c)(i):"",g`<td class="text-right" data-sort="${null!=i?i:0}">
                                        ${r}
                                    </td>`})}
                            </tr>
                        `)}
            </tbody>`)(t)}
            </table>
        `}_injectList(t){Object(o.b)(this._getList(t),this._div[t].node());const e=document.querySelector(`#table-${this._baseId}-${t}-list`);new r.a(e)}}}).call(this,a("xeH2"))},KbbR:function(t,e,a){(function(t){a.d(e,"a",(function(){return u}));a("WUlJ"),a("fCtr"),a("ry7D");var s=a("AKWm"),i=a("pOjD"),r=a("pxNS"),o=a("Q4du"),n=a("Qs7V"),d=a("Bx8B"),c=a("dNoP");function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class u{constructor(){p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_moduleData",{}),p(this,"_ingredientData",{}),this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(8).then(a.t.bind(null,"jhXC",3))).default,this._ingredientData=(await a.e(13).then(a.t.bind(null,"Oi4q",3))).default.ingredient}catch(t){Object(r.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._ingredientListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});Object(s.a)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getProperties(t){let e,a="",s="";for(const e of this._moduleData){const i=e[1].sort(Object(d.b)(["name"])).filter(e=>e.name===t);for(const t of i)a=e[0],s=`<tr><td>${t.properties.map(t=>{const e=t.isPercentage?Object(n.l)(t.amount/100):Object(n.k)(t.amount);return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`}return e=`<h6 class='text-muted text-left'>${a}</h6>`,e+=`<table class='table table-sm'><tbody>${s}</tbody></table>`,s?e:""}_getRows(){return this._ingredientData.map(t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map(t=>{const e=this._getProperties(t);return e?`<a data-toggle="tooltip" title="${e}">${t}</a>`:t}).join("<br>")}</td></tr>`)}_getText(){const t=this._getRows(),e=Object(c.a)(t,2);let a="";for(const t of l(new Array(e.length).keys()))a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm na-table"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_injectList(){Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("row",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText()),t('[data-toggle="tooltip"]').tooltip({html:!0,placement:"auto",sanitize:!1})}}}).call(this,a("xeH2"))},MICP:function(t,e,a){(function(t){a.d(e,"a",(function(){return m}));a("UxlC"),a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("AKWm"),i=a("pOjD"),r=a("pxNS"),o=a("Q4du"),n=a("Qs7V"),d=a("oggF"),c=a("otg8"),l=a("Bx8B");function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const p=a("Bhad"),u=(t,e,a)=>`${Object(c.q)(e)} – ${Object(c.q)(a)}`;class m{constructor(t){h(this,"_serverType",void 0),h(this,"_baseName",void 0),h(this,"_baseId",void 0),h(this,"_buttonId",void 0),h(this,"_modalId",void 0),h(this,"_moduleData",[]),h(this,"_recipeData",[]),h(this,"_recipes",void 0),this._serverType=p.find(e=>e.id===t).type,this._baseName="List admiralty items and recipes",this._baseId="recipe-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(8).then(a.t.bind(null,"jhXC",3))).default,this._recipeData=(await a.e(13).then(a.t.bind(null,"Oi4q",3))).default.recipe,this._recipes=new Map(this._recipeData.flatMap(t=>t.recipes.map(t=>[t.id,t])))}catch(t){Object(r.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._recipeListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("select").attr("name",t).attr("id",t),e.append("label").attr("for",t).attr("class","text-muted pl-2").text("Items listed here may not be available in the game (yet)."),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return this._recipeData.map(t=>`<optgroup label="${t.group}">${t.recipes.filter(t=>"Any"===t.serverType||t.serverType===this._serverType).sort(Object(l.b)(["name"])).map(t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,u)}`).join("</option>")}`).join("</optgroup>")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._recipeSelected(t)).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRecipeData(t){return this._recipes.get(t)}_getRequirementText(t){let e='<table class="table table-sm card-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${Object(d.f)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`<tr><td>${t.itemRequirements.map(t=>`${t.amount} ${t.name}`).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",s="";for(const e of this._moduleData){const i=e[1].filter(e=>e.id===t.result.id);for(const t of i)[a]=e,s=`<tr><td>${t.properties.map(t=>{const e=t.isPercentage?Object(n.l)(t.amount/100):t.amount;return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`}return s?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm card-table na-table"><tbody>${s}</tbody></table>`):e+=`<p>${Object(n.c)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-6"><div class="card-header">Item</div>',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card col-6"><div class="card-header">Result</div>',a+='<div class="card-body">',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(e){const a=Number(t(e.currentTarget).find(":selected").val());Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a("xeH2"))},Qs7V:function(t,e,a){a.d(e,"d",(function(){return n})),a.d(e,"b",(function(){return c})),a.d(e,"j",(function(){return l})),a.d(e,"a",(function(){return h})),a.d(e,"c",(function(){return p})),a.d(e,"k",(function(){return u})),a.d(e,"e",(function(){return m})),a.d(e,"h",(function(){return _})),a.d(e,"i",(function(){return g})),a.d(e,"g",(function(){return f})),a.d(e,"f",(function(){return v})),a.d(e,"l",(function(){return S}));a("UxlC");var s=a("sXBl"),i=a("JQHs"),r=a("2mXy");const o=i.a.bind(r.a),n=Object(s.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reales"],percent:" %",minus:"− "}),d=n.formatPrefix(",.0",1e3),c=(t,e=2)=>n.format(`,.${e}~r`)(t),l=(t,e=2)=>n.format(`+,.${e}~r`)(t).replace("+","+ "),h=t=>d(-1*t).replace("k"," k"),p=t=>n.format(",d")(t),u=t=>n.format("+,d")(t).replace("+","+ "),m=(t,e=0)=>n.format(`,.${e}%`)(t).replace("%","pp"),b='<span class="caps">m</span>',_=t=>n.format(",.2s")(t).replace(".0","").replace("k"," k").replace("m"," m").replace("M"," "+b),g=t=>{const e=_(t);return e.endsWith(b)?o`${e.replace(b,"")}<span class="caps">m</span>`:o`${e}`},f=t=>n.format("$,.2s")(t).replace(".0","").replace("M",' <span class="caps">m</span>').replace("k"," k"),v=(t,e=1)=>n.format(`.${e}%`)(t).replace(".0",""),S=t=>n.format("+.1%")(t).replace(".0","").replace("+","＋ ")},TwRt:function(t,e,a){a.r(e),a.d(e,"init",(function(){return f}));var s=a("pOjD"),i=a("Q4du"),r=a("u3gz"),o=a("ck04"),n=a("q1Yc"),d=a("eA68"),c=a("KbbR"),l=a("VUH8"),h=a("VnNF"),p=a("qTn5"),u=a("D04b"),m=a("MICP"),b=a("hVxF"),_=a("Jz/z"),g=a("K5dq");a("yU80");const f=(t,e)=>{const a=new r.a("ship-compare");(()=>{if(e.has("cmp")&&e.has("v")){const t=e.get("v");t&&t.split(".")[0]===i.d.split(".")[0]&&(Object(s.b)("Menu","Paste ship compare"),a.initFromClipboard(e))}})(),new o.a("wood"),new g.a,new n.a,new d.a,new c.a,new l.a,new h.a,new p.a(t),new u.a,new m.a(t),new b.a,new _.a}},VUH8:function(t,e,a){(function(t){a.d(e,"a",(function(){return x}));a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("2mXy"),i=a("JQHs"),r=a("pOjD"),o=a("pxNS"),n=a("Qs7V"),d=a("oggF"),c=a("Bx8B"),l=a("8ZGG");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function m(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}const b=i.a.bind(s.a);var _=new WeakMap,g=new WeakMap,f=new WeakMap,v=new WeakMap,S=new WeakMap,w=new WeakMap,y=new WeakMap,D=new WeakMap,$=new WeakMap,j=new WeakMap,O=new WeakMap,C=new WeakMap,I=new WeakMap;class x{constructor(){_.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:l.a}),w.set(this,{writable:!0,value:""}),y.set(this,{writable:!0,value:{}}),D.set(this,{writable:!0,value:{}}),$.set(this,{writable:!0,value:0}),j.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),m(this,_,"List loot and chests"),m(this,g,"loot-list"),m(this,f,"button-"+u(this,g)),m(this,v,"modal-"+u(this,g));for(const t of u(this,S))u(this,y)[t]=`${u(this,g)}-${t}-select`;this._setupListener()}static _printAmount(t){return t.min===t.max?Object(n.c)(t.min):`${Object(n.c)(t.min)} to ${Object(n.c)(t.max)}`}static _printChance(t){return Object(n.c)(100*(1-t))}async _loadAndSetupData(){try{const t=(await a.e(7).then(a.t.bind(null,"fg1m",3))).default;m(this,C,t.loot),m(this,I,t.chests)}catch(t){Object(o.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+u(this,f)))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",u(this,_)),this._sourceListSelected()})}_getLootOptions(){return b`
            ${u(this,C).sort(Object(c.b)(["name"])).map(t=>b`<option value="${t.id}">${t.name}</option>`)}
        `}_getChestsOptions(){return b`
            ${u(this,I).sort(Object(c.b)(["name"])).map(t=>b`<option value="${t.id}">${t.name}</option>`)}
        `}_getItemsOptions(){const t=new Map,e=(e,a,s)=>{const i=new Map([[e.id,{id:e.id,name:e.name,chance:s,amount:a.amount}]]);t.set(a.id,{name:a.name,sources:t.has(a.id)?new Map([].concat(h(t.get(a.id).sources),h(i))):i})};for(const t of u(this,C)){const{items:a}=t;for(const s of a)e(t,s,s.chance)}for(const t of u(this,I))for(const a of t.itemGroup){const{items:s}=a;for(const i of s)e(t,i,a.chance)}return m(this,O,new Map(h(t.entries()).sort((t,e)=>t[1].name.localeCompare(e[1].name)))),b`${h(u(this,O)).map(t=>b`<option value="${t[0]}">${t[1].name}</option>`)}`}_getOptions(t){let e=b``;return"items"===t&&(e=this._getItemsOptions()),"chests"===t&&(e=this._getChestsOptions()),"loot"===t&&(e=this._getLootOptions()),e}_getModalBody(){return b`
            ${u(this,S).map(t=>b`
                        <label>
                            <select id="${u(this,y)[t]}" class="selectpicker">
                                ${this._getOptions(t)}
                            </select>
                        </label>
                    `)}
            <div id="${u(this,g)}"></div>
        `}_getModalFooter(){return b`
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
            </button>
        `}_injectModal(){Object(s.b)(Object(d.d)({id:u(this,v),title:u(this,_),size:"modal-md",body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"))}_setupSelectListeners(){for(const t of u(this,S))u(this,D)[t].on("change",()=>{m(this,w,t),this._itemSelected()}).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select "+t,virtualScroll:!0})}_initModal(){this._injectModal(),m(this,j,document.querySelector("#"+u(this,g)));for(const e of u(this,S))u(this,D)[e]=t("#"+u(this,y)[e]);this._setupSelectListeners()}_sourceListSelected(){document.querySelector("#"+u(this,v))||this._initModal(),t("#"+u(this,v)).modal("show")}_getLootItemsText(t,e=!0){return b`
            <table class="table table-sm small na-table no-sort">
                <thead>
                    <tr>
                        <th scope="col">Item</th>
                        ${e?b`<th scope="col" class="text-right">Chance (0 − 100)</th>`:""}
                        <th scope="col" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map(t=>b`
                                <tr>
                                    <td>${t.name}</td>
                                    ${e?b` <td class="text-right">
                                              ${x._printChance(t.chance)}
                                          </td>`:""}
                                    <td class="text-right">
                                        ${x._printAmount(t.amount)}
                                    </td>
                                </tr>
                            `)}
                </tbody>
            </table>
        `}_getSourceText(){const t=h(u(this,O).get(u(this,$)).sources).map(t=>t[1]).sort(Object(c.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getChestsText(){const t=u(this,I).find(t=>t.id===u(this,$));return b`
            <p>Weight ${Object(n.c)(t.weight)} tons<br />Lifetime ${Object(n.c)(t.lifetime)} hours</p>
            ${t.itemGroup.map(t=>b` <h5>Group chance: ${x._printChance(t.chance)}</h5>
                    ${this._getLootItemsText(t.items.sort(Object(c.b)(["name"])),!1)}`)}
        `}_getLootText(){const t=u(this,C).find(t=>t.id===u(this,$)).items.sort(Object(c.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getText(){return"items"===u(this,w)?this._getSourceText():"chests"===u(this,w)?this._getChestsText():this._getLootText()}_getTable(){return b`
            <div class="mt-4">
                ${this._getText()}
            </div>
        `}_resetOtherSelects(){const t=u(this,S).filter(t=>t!==u(this,w));for(const e of t)u(this,D)[e].val("default").selectpicker("refresh")}_itemSelected(){const t=u(this,D)[u(this,w)].find(":selected");m(this,$,Number(t.val())),this._resetOtherSelects(),Object(s.b)(this._getTable(),u(this,j))}}}).call(this,a("xeH2"))},VnNF:function(t,e,a){(function(t){a.d(e,"a",(function(){return m}));a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("AKWm"),i=a("pOjD"),r=a("pxNS"),o=a("Q4du"),n=a("Qs7V"),d=a("otg8"),c=a("Bx8B"),l=a("dNoP");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class m{constructor(){u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_moduleData",{}),this._baseName="List modules",this._baseId="module-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(8).then(a.t.bind(null,"jhXC",3))).default}catch(t){Object(r.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._moduleListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId)}_getOptions(){return""+this._moduleData.map(t=>`<option value="${t[0]}"">${t[0]}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._moduleSelected(t)).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRows(t){const e=new Map([["L",`${Object(d.q)(1)} – ${Object(d.q)(3)}`],["M",`${Object(d.q)(4)} – ${Object(d.q)(5)}`],["S",`${Object(d.q)(6)} – ${Object(d.q)(7)}`]]),a=t=>{var a;return"U"===t?"":""+(null!==(a=e.get(t))&&void 0!==a?a:"")};let s="";const i=[];for(const e of this._moduleData)e[0]===t&&e[1].sort(Object(c.b)(["name"])).forEach((t,r)=>{const o=a=>a<e[1].length&&t.name===e[1][a].name&&JSON.stringify(t.properties)===JSON.stringify(e[1][a].properties);s=a(t.moduleLevel),o(r+1)&&(e[1][r+1].hasSamePropertiesAsPrevious=!0,s+="<br>"+a(e[1][r+1].moduleLevel)),o(r+2)&&(e[1][r+2].hasSamePropertiesAsPrevious=!0,s=""),void 0!==t.hasSamePropertiesAsPrevious&&t.hasSamePropertiesAsPrevious||i.push(`<tr><td><span class="name">${t.name}<br>${s}</span></td><td>${t.properties.map(t=>{let e;return e=t.isPercentage?Object(n.l)(t.amount/100):t.amount<1&&t.amount>0?Object(n.e)(t.amount,1):Object(n.k)(t.amount),`${t.modifier} ${e}`}).join("<br>")}</td></tr>`)});return i}_getText(t){const e=this._getRows(t),a=Object(l.a)(e,3);let s="";for(const t of h(new Array(a.length).keys()))s+=`<div class="col-md-${Math.floor(12/a.length)}">`,s+='<table class="table table-sm small na-table"><thead>',s+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",s+=a[t].join(""),s+="</tbody></table></div>";return s}_moduleSelected(e){const a=t(e.currentTarget).find(":selected").val();Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("row mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a("xeH2"))},Z5fe:function(t,e,a){a.d(e,"a",(function(){return d}));var s=a("AKWm"),i=a("iPFw"),r=a("ZQwz"),o=a("Q4du");function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class d{constructor(t,e){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=t,this._shipCompare=e,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(t=>t+" knots"),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(t){let e=`<span class="badge badge-white">${t.maxCannonLb} / `;return t.maxCarroLb?e+=""+t.maxCarroLb:e+="–",e+=" lb</span>",e}static getCannonsPerDeck(t){let e=`${t.gunsPerDeck[0].amount} ${d.pd(t.gunsPerDeck[0])}`,a="";for(let s=1;s<4;s+=1)t.gunsPerDeck[s].amount?e=`${t.gunsPerDeck[s].amount} ${d.pd(t.gunsPerDeck[s])} <br>${e}`:a+="<br>";return[e,a]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(t){let e=0;function a(t){return e+=1,`<div class="row row-small ${e%2?"row-light":""}"><div class="col-compress col-3">${t}</div>`}function s(e,a,s=6){let i,r="";return"cannonsPerDeck"===e?([i,r]=t[e],r="<br>"+r):i=""===e?"":String(t[e]),`<div class="col-compress col-${s}">${i}<br><span class="des">${a}</span>${r}</div>`}let i="";return i+=a(t.shipRating),i+=d.displaySecondBlock(),i+=s("battleRating","Battle rating"),i+=s("guns","Cannons"),i+=s("upgradeXP","Knowledge XP"),i+=s("rollAngle","Roll angle"),i+="</div></div></div>",i+=a(t.decks),i+=d.displaySecondBlock(),i+=s("cannonsPerDeck","Gun decks"),i+=s("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=a("Broadside (lb)"),i+=d.displaySecondBlock(),i+=s("cannonBroadside","Cannons"),i+=s("carroBroadside","Carronades"),i+="</div></div></div>",i+=a("Chasers"),i+=d.displaySecondBlock(),i+=s("gunsFront","Bow"),i+=s("gunsBack","Stern"),i+="</div></div></div>",i+=a("Speed"),i+=d.displaySecondBlock(),i+=s("maxSpeed","Maximum"),i+=s("deceleration","Deceleration"),i+=s("acceleration","Acceleration"),i+=s("turnAcceleration","Turn acceleration"),i+=s("maxTurningSpeed","Rudder turn speed"),i+=s("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=a('Hit points <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=s("sideArmor","Sides"),i+=s("structure","Hull"),i+=s("frontArmor","Bow"),i+=s("backArmor","Stern"),i+="</div></div></div>",i+=a('Masts <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=s("sails","Sails"),i+=s("mastBottomArmor","Bottom"),i+=s("mastMiddleArmor","Middle"),i+=s("mastTopArmor","Top"),i+="</div></div></div>",i+=a("Crew"),i+=d.displaySecondBlock(),i+=s("minCrew","Minimum",4),i+=s("sailingCrew","Sailing",4),i+=s("maxCrew","Maximum",4),i+=s("cannonCrew","Cannon",4),i+=s("carroCrew","Carronades",4),i+="</div></div></div>",i+=a("Boarding"),i+=d.displaySecondBlock(),i+=s("morale","Morale",4),i+=s("attack","Attack",4),i+=s("defense","Defense",4),i+=s("musketsCrew","Crew with muskets",4),i+=s("musketsAccuracy","Musket accuracy %",4),i+=s("cannonsAccuracy","Cannon accuracy %",4),i+=s("prepPerRound","Preparation per round",4),i+=s("prepInitial","Initial preparation",4),i+=s("disengageTime","Rounds to disengage",4),i+="</div></div></div>",i+=a("Resistance"),i+=d.displaySecondBlock(),i+=s("fireResistance","Fire %",4),i+=s("leakResistance","Leak %",4),i+=s("splinterResistance","Splinter %",4),i+="</div></div></div>",i+=a('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=d.displaySecondBlock(),i+=s("hullRepairsNeeded","Hull",4),i+=s("rigRepairsNeeded","Rig",4),i+=s("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=a("Repair"),i+=d.displaySecondBlock(),i+=s("hullRepairAmount","Hull %",4),i+=s("rigRepairAmount","Rig %",4),i+=s("repairTime","Time (sec)",4),i+="</div></div></div>",i+=a("Hold"),i+=d.displaySecondBlock(),i+=s("holdSize","Cargo slots"),i+=s("maxWeight","Tons"),i+="</div></div></div>",i+=a("Weight"),i+=d.displaySecondBlock(),i+=s("cannonWeight","Cannons",4),i+=s("carroWeight","Carronades",4),i+=s("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const t=Object(s.a)(this.select);Object(s.a)(this.select+" svg").remove(),this._svg=t.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),Object(s.a)(this.select+" div").remove(),t.append("div")}_setCompass(){const t=new Array(o.o/2);t.fill(1,0);const e=Object(i.a)().sort(null).value(1)(t),a=Object(r.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(e).join(t=>t.append("path").attr("d",a)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(t=>t.append("circle").attr("r",t=>this._shipCompare.radiusSpeedScale(t)))}}},awzk:function(t,e,a){(function(t){a.d(e,"a",(function(){return y}));var s=a("ZQwz"),i=a("iPFw"),r=a("VkQ2"),o=a("TI0E"),n=a("Qs7V"),d=a("otg8"),c=a("VIqg"),l=a("AWXE"),h=a("dNoP"),p=a("AJ/N"),u=a("pxNS"),m=a("Q4du"),b=a("1mfJ"),_=a.n(b),g=a("Z5fe"),f=a("oggF");function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class y extends g.a{constructor(t,e,a){super(t,a),w(this,"shipData",void 0),w(this,"_speedScale",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),this.shipData=e,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const t=Object(s.a)().outerRadius(t=>this._shipCompare.radiusSpeedScale(t)+2).innerRadius(t=>this._shipCompare.radiusSpeedScale(t)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(e=>e.append("path").attr("d",t).attr("id",(t,e)=>"tick"+e)),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(t=>t.append("text").append("textPath").attr("href",(t,e)=>"#tick"+e).text((t,e)=>this.ticksSpeedLabels[e]).attr("startOffset","10%"))}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){return Object(n.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(d.m)(t)}_updateCompareWindProfiles(){for(const t of this._shipCompare.columnsCompare)Object(u.d)(this._shipCompare.selectedShips[t])||this._shipCompare.selectedShips[t].updateWindProfileRotation()}_setupDrag(){const t=this.shipData.speedDegrees.length,e=360/t,a=new Array(t+1).fill(null).map((t,a)=>a*e);this._speedScale=Object(c.a)().domain(a).range([].concat(v(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=p.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:a}=l.c;t.rotate=this._getHeadingInDegrees(Object(h.m)({x:t.initX,y:t.initY},{x:e,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipData,e=this._shipCompare.shipMassScale(t),a=e,s=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),r.append("image").attr("height",e).attr("width",a).attr("x",-e/2).attr("y",-a/2).attr("xlink:href",_.a),r.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=r.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(t.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",t=>`rotate(${t.initRotate})`)}_drawWindProfile(){const t=Object(i.a)().sort(null).value(1)(this.shipData.speedDegrees),e=r.a,a=Object(o.a)().angle((t,e)=>e*m.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(e);this._shipCompare.windProfileRotate=0;const s=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-s,type:"windProfile"},d=this._mainG.append("g").datum(n).attr("class","wind-profile");d.append("path").attr("d",t=>String(Object(h.g)(t.compassTextX,t.compassTextY,20))+Object(h.h)(t.compassTextX,t.compassTextY,-t.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),d.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20);const c=d.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));d.append("path").attr("class","base-profile").attr("d",a(t)),d.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(t).join(t=>t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*m.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*m.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).append("title").text(t=>Math.round(10*t.data)/10+" knots")),n.this=d,n.compassText=c,d.datum(n).attr("transform",t=>`rotate(${t.initRotate})`)}_printText(){var e;const a=g.a.getCannonsPerDeck(this.shipData.guns),s=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/f.i),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/f.o),r=Math.round(this.shipData.crew.max*f.p),o={attack:Object(n.j)(this.shipData.boarding.attack,2),cannonsAccuracy:Object(n.k)(100*this.shipData.boarding.cannonsAccuracy),defense:Object(n.j)(this.shipData.boarding.defense,2),disengageTime:Object(n.c)(this.shipData.boarding.disengageTime),morale:Object(n.c)(this.shipData.boarding.morale),musketsAccuracy:Object(n.k)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:Object(n.c)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:Object(n.c)(this.shipData.boarding.prepPerRound),prepInitial:Object(n.c)(this.shipData.boarding.prepInitial),acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${Object(n.c)(this.shipData.stern.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:""+Object(n.c)(this.shipData.repairTime.bow),cannonBroadside:Object(n.c)(this.shipData.guns.broadside.cannons),cannonsPerDeck:a,carroBroadside:Object(n.c)(this.shipData.guns.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:Object(m.p)(this.shipData.guns.decks,"deck"),fireResistance:Object(n.k)(100*this.shipData.resistance.fire),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${Object(n.c)(this.shipData.bow.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.c)(this.shipData.holdSize),hullRepairAmount:""+Object(n.c)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:`${Object(n.c)(s)} <span class="badge badge-white">${Object(n.c)(s*f.m)}</span>`,leakResistance:Object(n.k)(100*this.shipData.resistance.leaks),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(n.c)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(n.c)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(n.c)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.mast.topThickness)}</span>`,maxCrew:Object(n.c)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.c)(this.shipData.maxWeight),minCrew:Object(n.c)(this.shipData.crew.min),cannonCrew:Object(n.c)(this.shipData.crew.cannons),carroCrew:Object(n.c)(this.shipData.crew.carronades),pump:Object(n.c)(this.shipData.pump.armour),repairTime:""+Object(n.c)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(n.c)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:`${Object(n.c)(i)} <span class="badge badge-white">${Object(n.c)(i*f.m)}</span>`,rollAngle:Object(n.c)(this.shipData.ship.rollAngle),rudder:`${Object(n.c)(this.shipData.rudder.armour)} <span class="badge badge-white">${Object(n.c)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${Object(n.c)(r)} <span class="badge badge-white">${Object(n.c)(r*f.m)}</span>`,sailingCrew:Object(n.c)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:Object(n.c)(this.shipData.sails.armour),shipRating:Object(d.q)(this.shipData.class)+" rate",sideArmor:`${Object(n.c)(this.shipData.sides.armour)}</br><span class="badge badge-white">${Object(n.c)(this.shipData.sides.thickness)}</span>`,splinterResistance:Object(n.k)(100*this.shipData.resistance.splinter),sternRepair:""+Object(n.c)(this.shipData.repairTime.stern),structure:Object(n.c)(this.shipData.structure.armour),turnAcceleration:Object(n.b)(this.shipData.ship.turnAcceleration,4),upgradeXP:Object(n.c)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight),cannonWeight:Object(n.c)(this.shipData.guns.weight.cannons),carroWeight:Object(n.c)(this.shipData.guns.weight.carronades)};o.repairWeight=Object(n.c)((s+i+.1*r)*f.m),o.gunsFront?o.gunsFront+=" "+g.a.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+g.a.pd(o.limitBack):o.gunsBack="–",t(""+this.select).find("div").append(g.a.getText(o))}}}).call(this,a("xeH2"))},ck04:function(t,e,a){(function(t){a.d(e,"a",(function(){return g}));a("WUlJ"),a("fCtr"),a("dbdZ");var s=a("mrVq"),i=a("gj+k"),r=a("AKWm"),o=a("pOjD"),n=a("Q4du"),d=a("Qs7V"),c=a("pxNS"),l=a("Bx8B");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class m{constructor(t,e){u(this,"select",void 0),u(this,"_woodCompare",void 0),u(this,"_id",void 0),u(this,"_g",void 0),this._id=t,this._woodCompare=e,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(r.a)(this.select).select("g")}_setupMainDiv(){Object(r.a)(this.select+" div").remove(),Object(r.a)(this.select).append("div")}}class b extends m{constructor(t,e,a){super(t,a),u(this,"_woodData",void 0),this._woodData=e,this._printText()}_getProperty(t,e){const a=this._woodData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getPropertySum(t){const e=this._getProperty(t,"frame"),a=this._getProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';e+="<tr>",e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,n]of t.properties){if(e+=`<tr><td>${o}</td><td>${n.isPercentage?Object(d.f)(n.amount/100):Object(d.b)(n.amount)}`,e+='<span class="rate">',n.amount>0){var a,s;e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${n.amount/(null!==(a=null===(s=this._woodCompare.minMaxProperty.get(o))||void 0===s?void 0:s.max)&&void 0!==a?a:1)*50}%;"></span>`}else if(n.amount<0){var i,r;const t=n.amount/(null!==(i=null===(r=this._woodCompare.minMaxProperty.get(o))||void 0===r?void 0:r.min)&&void 0!==i?i:1)*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getPropertySum(t);e.properties.set(t,{amount:a.amount,isPercentage:a.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class _ extends m{constructor(t,e,a,s){super(t,s),u(this,"_baseData",void 0),u(this,"_compareData",void 0),this._baseData=e,this._compareData=a,this._printTextComparison()}static _getDiff(t,e,a,s=1){const i=Number.parseFloat((t-e).toFixed(s));return`${a?Object(d.f)(t/100,s):Object(d.b)(t)} <span class="badge badge-white">${Object(d.j)(i)}</span>`}_getBaseProperty(t,e){const a=this._baseData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getBasePropertySum(t){const e=this._getBaseProperty(t,"frame"),a=this._getBaseProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getCompareProperty(t,e){const a=this._compareData[e].properties.find(e=>e.modifier===t);let s=0,i=!1;return(null==a?void 0:a.amount)&&(s=a.amount,i=a.isPercentage),{amount:s,isPercentage:i}}_getComparePropertySum(t){const e=this._getCompareProperty(t,"frame"),a=this._getCompareProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:e.isPercentage&&a.isPercentage}}_getText(t){let e=0,a=0,s=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[g,f]of t.properties){var o,n,d,c;if(r+=`<tr><td>${g}</td><td>${_._getDiff(f.compare,f.base,f.isPercentage)}`,r+='<span class="rate">',f.compare>=0)f.base>=0?f.compare>f.base?(e=f.base,a=f.compare-f.base,i="pos"):(e=f.compare,a=f.base-f.compare,i="neg"):(e=0,a=f.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+=`<span class="bar pos diff" style="width:${e/(null!==(o=null===(n=this._woodCompare.minMaxProperty.get(g))||void 0===n?void 0:n.max)&&void 0!==o?o:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${a/(null!==(d=null===(c=this._woodCompare.minMaxProperty.get(g))||void 0===c?void 0:c.max)&&void 0!==d?d:1)*50}%;"></span>`;else if(f.compare<0){var l,h,p,u,m,b;f.base<0?f.compare>=f.base?(e=f.compare,a=f.base-f.compare,s=-f.base,i="pos"):(e=f.base,a=f.compare-f.base,s=-f.compare,i="neg"):(e=0,a=f.compare,s=-f.compare,i="neg"),r+=`<span class="bar neutral" style="width:${50+s/(null!==(l=null===(h=this._woodCompare.minMaxProperty.get(g))||void 0===h?void 0:h.min)&&void 0!==l?l:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${a/(null!==(p=null===(u=this._woodCompare.minMaxProperty.get(g))||void 0===u?void 0:u.min)&&void 0!==p?p:1)*50}%;"></span>`,r+=`<span class="bar neg diff" style="width:${e/(null!==(m=null===(b=this._woodCompare.minMaxProperty.get(g))||void 0===b?void 0:b.min)&&void 0!==m?m:1)*50}%;"></span>`}else r+='<span class="bar neutral"></span>';r+="</span></td></tr>"}return r+="</tbody></table>",r}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getBasePropertySum(t),s=this._getComparePropertySum(t);e.properties.set(t,{base:a.amount,compare:s.amount,isPercentage:a.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class g{constructor(t){u(this,"baseFunction",void 0),u(this,"instances",{}),u(this,"minMaxProperty",new Map),u(this,"propertyNames",void 0),u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_woodData",void 0),u(this,"_columnsCompare",void 0),u(this,"_defaultWoodId",{}),u(this,"_columns",void 0),u(this,"_frameSelectData",void 0),u(this,"_trimSelectData",void 0),u(this,"_options",{}),u(this,"_woodIdsSelected",{}),this.baseFunction=t,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find(t=>t.id===e))||void 0===s?void 0:s.name)&&void 0!==a?a:""}_findWoodId(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find(t=>t.name===e))||void 0===s?void 0:s.id)&&void 0!==a?a:0}_setupData(){this.propertyNames=new Set([].concat(h(this._woodData.frame.flatMap(t=>t.properties.map(t=>t.modifier))),h(this._woodData.trim.flatMap(t=>t.properties.map(t=>t.modifier)))).sort(l.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await a.e(16).then(a.t.bind(null,"xOpV",3))).default,this._setupData()}catch(t){Object(c.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(l.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(l.b)(["name"])),this._setOption(this._frameSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString(),this._trimSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString());for(const o of this.propertyNames){var t,e,a,r;const n=h(this._woodData.frame.map(t=>{var e,a;return null!==(e=null===(a=t.properties.find(t=>t.modifier===o))||void 0===a?void 0:a.amount)&&void 0!==e?e:0})),d=h(this._woodData.trim.map(t=>{var e,a;return null!==(e=null===(a=t.properties.find(t=>t.modifier===o))||void 0===a?void 0:a.amount)&&void 0!==e?e:0})),c=null!==(t=Object(s.a)(n))&&void 0!==t?t:0,l=null!==(e=Object(i.a)(n))&&void 0!==e?e:0,p=null!==(a=Object(s.a)(d))&&void 0!==a?a:0,u=null!==(r=Object(i.a)(d))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:c+p>=0?0:c+p,max:l+u})}}_injectModal(){Object(n.n)({id:this._modalId,title:this._baseName});const t=Object(r.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const e of this._columns){const a=t.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp"));for(const t of c.h){const s=`${this.baseFunction}-${t}-${e}-select`;a.append("label").attr("for",s),a.append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}a.append("div").attr("id",`${this.baseFunction}-${e}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const a of c.h){const s=t(`#${this.baseFunction}-${a}-${e}-select`);this._setupWoodSelects(e,a,s),this._setupSelectListener(e,a,s)}}_setWoodsSelected(t,e,a){this._woodIdsSelected[t]||(this._woodIdsSelected[t]={}),this._woodIdsSelected[t][e]=a}_setupWoodSelects(t,e,a){this._setWoodsSelected(t,e,this._defaultWoodId[e]),a.append(this._options[e]),("wood"!==this.baseFunction||"Base"!==t&&"wood"===this.baseFunction)&&a.attr("disabled","disabled")}_setOtherSelect(e,a){const s="frame"===a?"trim":"frame";this._woodIdsSelected[e][s]===this._defaultWoodId[s]&&t(`#${this.baseFunction}-${s}-${e}-select`).val(this._defaultWoodId[s]).selectpicker("refresh")}enableSelects(e){for(const a of c.h)t(`#${this.baseFunction}-${a}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(t,e,a){const s=Number(a.val());if(this._setWoodsSelected(t,e,s),this._setOtherSelect(t,e),"Base"===t){this._addInstance(t,new b("Base",this._getWoodData("Base"),this));for(const t of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(t),this.instances[t]&&this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}else this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,a){a.on("change",()=>this._woodSelected(t,e,a)).selectpicker({title:"Select "+e})}_getWoodData(t){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[t].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[t].trim)}}_addMinMaxProperty(t,e){this.minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this.instances[t]=e}getWoodTypeData(t,e){var a;return null!==(a=this._woodData[t].find(t=>t.id===e))&&void 0!==a?a:{}}}}).call(this,a("xeH2"))},dNoP:function(t,e,a){(function(t){a.d(e,"e",(function(){return o})),a.d(e,"f",(function(){return n})),a.d(e,"j",(function(){return d})),a.d(e,"m",(function(){return c})),a.d(e,"a",(function(){return l})),a.d(e,"k",(function(){return h})),a.d(e,"l",(function(){return p})),a.d(e,"d",(function(){return u})),a.d(e,"c",(function(){return m})),a.d(e,"b",(function(){return b})),a.d(e,"g",(function(){return _})),a.d(e,"i",(function(){return g})),a.d(e,"h",(function(){return f}));var s=a("sCaM"),i=a("Q4du"),r=a("otg8");const o=(t,e=!1)=>{let a;return a=Number.isNaN(Number(t))?t:Object(r.m)(Number(t)),`<${e?"tspan":"span"} class="caps">${a}</${e?"tspan":"span"}>`},n=(t,e=!1)=>{let a,s;return Number.isNaN(Number(t))?(a=t,s=Object(r.c)(a)%r.j):(s=Number(t),a=Object(r.m)(s)),`<${e?"tspan":"span"} class="caps">${a}</${e?"tspan":"span"}> (${s}°)`},d=e=>{const a=Object(r.m)(t("#"+e).roundSlider("getValue"));let s;return s=Number.isNaN(Number(a))?Object(r.c)(a):Number(a),s},c=(t,e)=>{let a=Math.atan2(e.y-t.y,e.x-t.x);a-=Math.PI/2;let s=Object(r.s)(a);return s<0&&(s+=r.j),s},l=(t,e,a=!0)=>{if(e<2)return[t];const s=t.length,i=[];let r,o=0;if(s%e==0)for(r=Math.floor(s/e);o<s;)i.push(t.slice(o,o+=r));else if(a)for(;o<s;)r=Math.ceil((s-o)/e--),i.push(t.slice(o,o+=r));else{for(e-=1,r=Math.floor(s/e),s%r==0&&(r-=1);o<r*e;)i.push(t.slice(o,o+=r));i.push(t.slice(r*e))}return i},h=({element:t,radius:e})=>{const a=i.o,o=r.j/a,n=Math.round(.8*e),d=new Array(a).fill(void 0).map((t,e)=>Object(r.m)(e*o)),c=Object(s.a)().range([0-o/2,r.j-o/2]).domain(d).align(0);t.append("circle").attr("r",n).style("stroke-width","3px");const l=t.append("text"),h=t.selectAll("g").data(d).join(t=>t.append("g").attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2-r.l)})translate(${n},0)`}));h.filter((t,e)=>e%3!=0).append("line").attr("x2",9),h.filter((t,e)=>e%3==0).append("text").attr("transform",t=>{var e,a,s,i,r;let o,n=Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2);l.text(t);const d=null!==(a=null===(s=l.node())||void 0===s?void 0:s.getBBox().height)&&void 0!==a?a:0,h=null!==(i=null===(r=l.node())||void 0===r?void 0:r.getBBox().width)&&void 0!==i?i:0;return n>=0&&n<=45||315===n?(n=90,o="0,-"+d/2):90===n?(n=0,o=h/2+3+",0"):270===n?(n=180,o=`-${h/2+3},0`):(n=-90,o="0,"+(d/2+3+2)),`rotate(${n})translate(${o})`}).text(t=>t),l.remove()},p=({element:t,radius:e})=>{const a=i.o,o=r.j/a,n=Math.round(.8*e),d=new Array(a).fill(void 0).map((t,e)=>Object(r.m)(e*o)),c=Object(s.a)().range([0-o/2,r.j-o/2]).domain(d).align(0);t.append("circle").attr("r",n).style("stroke-width","1.5px");t.selectAll("line").data(d).join(t=>t.append("line").attr("x2",(t,e)=>e%3==0?e%6==0?6:4:2).attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2)})translate(${n},0)`}))},u=t=>`<span class="caps">${t}</span>`,m=(t,e)=>{navigator.clipboard||((t,e)=>{var a,s;if(!(null===(a=(s=document).queryCommandSupported)||void 0===a?void 0:a.call(s,"copy")))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const a=document.createElement("input");a.type="text",a.value=t,a.style.position="absolute",a.style.left="-1000px",a.style.top="-1000px",e.append(a),a.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{a.remove()}}})(t,e),(async t=>{navigator.clipboard.writeText(t).then(()=>!0).catch(e=>(console.error(`Cannot copy ${t} to clipboard`,e),!1))})(t)},b=(t,e,a)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const s=new URL(window.location.href);s.searchParams.set("x",String(t)),s.searchParams.set("z",String(e)),m(s.href,a)}},_=(t,e,a)=>`M${t},${e} m${-a},0 a${a},${a} 0,1,0 ${2*a},0 a${a},${a} 0,1,0 ${2*-a},0`,g=(t,e,a)=>`M${t-a/2},${e-a/2}h${a}v${a}h${-a}z`,f=(t,e,a)=>`M${t},${e}v${a}`}).call(this,a("xeH2"))},eA68:function(t,e,a){(function(t){a.d(e,"a",(function(){return m}));a("WUlJ"),a("sfzn"),a("fCtr");var s=a("2mXy"),i=a("JQHs"),r=a("XXsb"),o=a.n(r),n=a("pOjD"),d=a("pxNS"),c=a("oggF");function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const u=i.a.bind(s.a);class m{constructor(){p(this,"_cannonData",{}),p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_groups",void 0),this._groups=new Map,this._baseName="List cannons",this._baseId="cannon-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(5).then(a.t.bind(null,"XG8V",3))).default;this._setupData(t)}catch(t){Object(d.f)(t)}}_setupData(t){for(const e of t.long)for(const[t,a]of Object.entries(e))"name"!==t&&this._groups.set(t,{values:a,count:Object.entries(a).length});const e=["name","damage","penetration","dispersion","traverse","generic"];for(const a of d.a)this._cannonData[a]=t[a].map(t=>Object.keys(t).sort((t,a)=>e.indexOf(t)-e.indexOf(a)).reduce((e,a)=>(e[a]=t[a],e),{}));this._groups=new Map(l(this._groups.entries()).sort((t,a)=>e.indexOf(t[0])-e.indexOf(a[0])))}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(n.b)("Tools",this._baseName),this._cannonListSelected()})}_getList(t){return u`
            <table id="table-${this._baseId}-${t}-list" class="table table-sm small tablesort na-table">
                <thead>
                    <tr class="thead-group">
                        <th scope="col" class="border-bottom-0"></th>
                        ${l(this._groups).map(t=>(t=>u`
            <th scope="col" class="text-center" colspan="${t[1].count}">
                ${Object(d.b)(t[0])}
            </th>
        `)(t))}
                    </tr>
                    <tr data-sort-method="thead">
                        <th scope="col" class="text-right border-top-0" data-sort-default>Lb</th>
                        ${l(this._groups).map(t=>(t=>u`
            ${Object.entries(t[1].values).map(t=>u`<th class="text-right">${Object(d.b)(t[0])}</th>`)}
        `)(t))}
                    </tr>
                </thead>
                <tbody>
                    ${this._cannonData[t].map(t=>u`
                            <tr>
                                ${(t=>{let e=t;const a=t.split(" "),s="c"+a[0].padStart(3,"0"),i=a[1]?a[1][1]:"0";return a.length>1&&(e=u`${a[0]} <em>${a[1]}</em>`),u`
                <td class="text-right" data-sort="${s}${i}">
                    ${e}
                </td>
            `})(t.name)}${(t=>u`
            ${Object.entries(t).map(t=>"name"===t[0]?u``:Object.entries(t[1]).map(t=>{var e,a;return u`
                            <td class="text-right" data-sort="${null!==(e=t[1].value)&&void 0!==e?e:0}">
                                ${t[1]?Object(c.c)(t[1].value,null!==(a=t[1].digits)&&void 0!==a?a:0):""}
                            </td>
                        `}))}
        `)(t)}
                            </tr>
                        `)}
                </tbody>
            </table>
        `}_getModalBody(){return u`
            <ul class="nav nav-pills" role="tablist">
                ${d.a.map((t,e)=>u`
                            <li class="nav-item">
                                <a
                                    class="nav-link${0===e?" active":""}"
                                    id="tab-${this._baseId}-${t}"
                                    data-toggle="tab"
                                    href="#tab-content-${this._baseId}-${t}"
                                    role="tab"
                                    aria-controls="home"
                                    aria-selected="true"
                                    >${Object(d.b)(t)}</a
                                >
                            </li>
                        `)}
            </ul>
            <div class="tab-content pt-2">
                ${d.a.map((t,e)=>u`
                            <div
                                class="tab-pane fade${0===e?" show active":""}"
                                id="tab-content-${this._baseId}-${t}"
                                role="tabpanel"
                                aria-labelledby="tab-${this._baseId}-${t}"
                            >
                                <div id="${t}-list">
                                    ${this._getList(t)}
                                </div>
                            </div>
                        `)}
            </div>
        `}_getModalFooter(){return u`
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
            </button>
        `}_injectModal(){Object(s.b)(Object(c.d)({id:this._modalId,title:this._baseName,body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"));for(const t of d.a){const e=document.querySelector(`#table-${this._baseId}-${t}-list`);e&&new o.a(e)}}_initModal(){Object(c.j)(),this._injectModal()}_cannonListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}}}).call(this,a("xeH2"))},hVxF:function(t,e,a){(function(t){a.d(e,"a",(function(){return _}));a("WUlJ"),a("fCtr");var s=a("AKWm"),i=a("2mXy"),r=a("JQHs"),o=a("XXsb"),n=a.n(o),d=a("pOjD"),c=a("pxNS"),l=a("Q4du"),h=a("Qs7V"),p=a("oggF"),u=a("Bx8B");function m(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const b=r.a.bind(i.a);class _{constructor(){m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_shipListData",{}),m(this,"_mainDiv",void 0),this._baseName="List ships",this._baseId="ship-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(15).then(a.t.bind(null,"pcjM",3))).default.sort(Object(u.b)(["class","-battleRating","name"]));this._shipListData=t.map(t=>({class:[t.class,t.class],name:[t.name,Object(p.a)(t.name)],guns:[t.guns.total,t.guns.total],battleRating:[t.battleRating,Object(h.c)(t.battleRating)],crew:[t.crew.max,Object(h.c)(t.crew.max)],maxSpeed:[t.ship.maxSpeed,Object(p.c)(t.ship.maxSpeed)],turnSpeed:[t.rudder.turnSpeed,Object(p.c)(t.rudder.turnSpeed)],broadside:[t.guns.broadside.cannons,Object(h.c)(t.guns.broadside.cannons)],bowChaser:[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4]?String(t.guns.gunsPerDeck[4].amount):""],sternChaser:[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5]?String(t.guns.gunsPerDeck[5].amount):""],sides:[t.sides.armour,`${Object(h.c)(t.sides.armour)} (${t.sides.thickness})`]}))}catch(t){Object(c.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(d.b)("Tools",this._baseName),this._shipListSelected()})}_injectModal(){Object(l.n)({id:this._modalId,title:this._baseName,size:"modal-lg"}),this._mainDiv=Object(s.a)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId)}_initModal(){Object(p.j)(),this._injectModal(),this._injectList()}_shipListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getHead(){return b`
            <thead>
                <tr class="thead-group">
                    <th scope="col" class="border-bottom-0"></th>
                    <th scope="col" class="border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-center" colspan="2">Speed</th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-center" colspan="2">Chasers</th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                </tr>

                <tr data-sort-method="thead">
                    <th scope="col" class="text-right border-top-0">Class</th>
                    <th scope="col" class="border-top-0">Name</th>
                    <th scope="col" class="text-right border-top-0">Guns</th>
                    <th scope="col" class="text-right border-top-0">Battle rating</th>
                    <th scope="col" class="text-right border-top-0">Crew</th>
                    <th scope="col" class="text-right">Maximum</th>
                    <th scope="col" class="text-right">Turn</th>
                    <th scope="col" class="text-right border-top-0">Broadside</th>
                    <th scope="col" class="text-right border-top-0">Bow</th>
                    <th scope="col" class="text-right">Stern</th>
                    <th scope="col" class="text-right border-top-0">Sides</th>
                </tr>
            </thead>
        `}_getBody(){return b`
            <tbody>
                ${this._shipListData.map(t=>b`<tr>
                        ${Object.entries(t).map(t=>b`<td class="${"name"===t[0]?"":"text-right"}" data-sort="${t[1][0]}">
                                    ${t[1][1]}
                                </td>`)}
                    </tr>`)}
            </tbody>
        `}_getList(){return b`
            <table id="table-${this._baseId}" class="table table-sm small tablesort na-table">
                ${this._getHead()} ${this._getBody()}
            </table>
        `}_injectList(){Object(i.b)(this._getList(),this._mainDiv.node());const t=document.querySelector("#table-"+this._baseId);new n.a(t)}}}).call(this,a("xeH2"))},iftE:function(t,e,a){(function(t){a.d(e,"a",(function(){return y}));var s=a("mrVq"),i=a("gj+k"),r=a("AJ/N"),o=a("VIqg"),n=a("AWXE"),d=a("iPFw"),c=a("VkQ2"),l=a("TI0E"),h=a("Qs7V"),p=a("otg8"),u=a("dNoP"),m=a("1mfJ"),b=a.n(m),_=a("Z5fe"),g=a("Q4du"),f=a("oggF");function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class y extends _.a{constructor(t,e,a,s){super(t,s),w(this,"shipCompareData",void 0),w(this,"_shipBaseData",void 0),w(this,"_speedScale",void 0),w(this,"_speedDiff",void 0),w(this,"_minSpeedDiff",void 0),w(this,"_maxSpeedDiff",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),w(this,"_windProfile",void 0),w(this,"_gWindProfile",void 0),w(this,"_arcsComp",void 0),this._shipBaseData=e,this.shipCompareData=a,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(t,e){const a=Math.min(t,this._shipCompare.colourScaleSpeedDiff.domain()[0]),s=Math.max(e,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([a,0,s])}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){return Object(h.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(p.m)(t)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const t=this.shipCompareData.speedDegrees.length,e=360/t,a=new Array(t+1).fill(0).map((t,a)=>a*e);this._speedScale=Object(o.a)().domain(a).range([].concat(v(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=r.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:a}=n.c;t.rotate=this._getHeadingInDegrees(Object(u.m)({x:t.initX,y:t.initY},{x:e,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),this._shipRotate=t.rotate,this._updateSpeedText()})()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipCompareData,e=this._shipCompare.shipMassScale(t),a=e,s=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:s,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",t=>t.initX).attr("y1",s-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),r.append("image").attr("height",e).attr("width",a).attr("x",-e/2).attr("y",-a/2).attr("xlink:href",b.a),r.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=r.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(this._shipCompare.windProfileRotate-t.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",t=>`rotate(${t.initRotate})`)}_drawDifferenceProfile(){var t,e;const a=Object(d.a)().sort(null).value(1),r=a(this._shipBaseData.speedDegrees);this._arcsComp=a(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((t,e)=>Object(p.t)(t-this._shipBaseData.speedDegrees[e])),this._minSpeedDiff=null!==(t=Object(s.a)(this._speedDiff))&&void 0!==t?t:0,this._maxSpeedDiff=null!==(e=Object(i.a)(this._speedDiff))&&void 0!==e?e:0;const o=c.a,n=Object(l.a)().angle((t,e)=>e*g.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(o),h=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-h,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(r)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(t=>{t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*g.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*g.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e])).append("title").text((t,e)=>`${Math.round(10*t.data)/10} (${Object(h.j)(this._speedDiff[e],1)}) knots`)}).select("circle").attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))}_injectTextComparison(){function e(t,e,a=0,s=!1){if(t===e)return"";let i,r,o="badge-danger";return s?(i=100*Number.parseFloat((e-t).toFixed(a)),r=Object(h.b)(Math.abs(i))):0===t||0===e?(i=e-t,r=Object(h.b)(Math.abs(i))):(i=1-t/e,r=Object(h.f)(Math.abs(i),0)),i<0&&(o="badge-success"),`<span class="badge ${o}">${r}</span>`}const a=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.i),s=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.o),i=Math.round(this._shipBaseData.crew.max*f.p),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.i),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.o),n=Math.round(this.shipCompareData.crew.max*f.p),d={morale:`${Object(h.c)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${Object(h.k)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${Object(h.c)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${Object(h.j)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${Object(h.j)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${Object(h.c)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${Object(h.c)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${Object(h.c)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${Object(h.k)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,acceleration:`${Object(h.b)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${Object(h.c)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:_.a.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${Object(h.b)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${Object(h.c)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${Object(h.b)(this.shipCompareData.ship.turnAcceleration)} ${e(this._shipBaseData.ship.turnAcceleration,this.shipCompareData.ship.turnAcceleration,2)}`,decks:Object(g.p)(this.shipCompareData.guns.decks,"deck"),fireResistance:`${Object(h.k)(100*this.shipCompareData.resistance.fire)} ${e(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0)}`,firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${Object(h.c)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${Object(h.b)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${Object(h.c)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${Object(h.c)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${Object(h.c)(r)} <span class="badge badge-white">${Object(h.c)(r*f.m)}</span>`,leakResistance:`${Object(h.k)(100*this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(h.c)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(h.c)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(h.c)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${Object(h.c)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${Object(h.b)(this.shipCompareData.speed.max,4)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxTurningSpeed:`${Object(h.b)(this.shipCompareData.rudder.turnSpeed,4)} ${e(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2)}`,maxWeight:`${Object(h.c)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:Object(h.c)(this.shipCompareData.crew.min),cannonCrew:`${Object(h.c)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${Object(h.c)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${Object(h.b)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${Object(h.c)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${Object(h.c)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${Object(h.c)(o)} <span class="badge badge-white">${Object(h.c)(o*f.m)}</span>`,rumRepairsNeeded:`${Object(h.c)(n)} <span class="badge badge-white">${Object(h.c)(n*f.m)}</span>`,sailingCrew:""+Object(h.c)(this.shipCompareData.crew.sailing),sails:`${Object(h.c)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:Object(p.q)(this.shipCompareData.class)+" rate",sideArmor:`${Object(h.c)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${Object(h.c)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${Object(h.k)(100*this.shipCompareData.resistance.splinter)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${Object(h.c)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${Object(h.c)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${Object(h.b)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${Object(h.c)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${Object(h.c)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${Object(h.c)((r+o+.1*n)*f.m)} ${e((a+s+.1*i)*f.m,(r+o+.1*n)*f.m)}`,d.gunsFront?d.gunsFront+=" "+_.a.pd(d.limitFront):d.gunsFront="–",d.gunsBack?d.gunsBack+=" "+_.a.pd(d.limitBack):d.gunsBack="–",t(""+this.select).find("div").append(_.a.getText(d))}}}).call(this,a("xeH2"))},oggF:function(t,e,a){a.d(e,"h",(function(){return u})),a.d(e,"i",(function(){return m})),a.d(e,"l",(function(){return b})),a.d(e,"n",(function(){return _})),a.d(e,"o",(function(){return g})),a.d(e,"p",(function(){return S})),a.d(e,"m",(function(){return w})),a.d(e,"g",(function(){return y})),a.d(e,"k",(function(){return D})),a.d(e,"q",(function(){return $})),a.d(e,"a",(function(){return j})),a.d(e,"c",(function(){return O})),a.d(e,"d",(function(){return C})),a.d(e,"j",(function(){return x})),a.d(e,"f",(function(){return A})),a.d(e,"e",(function(){return k})),a.d(e,"b",(function(){return M}));a("UxlC");var s=a("FmoU"),i=a("GjCO"),r=a.n(i),o=a("JQHs"),n=a("2mXy"),d=a("XXsb"),c=a.n(d),l=a("Q4du"),h=a("Qs7V");const p=o.a.bind(n.a),u=Number(.2),m=Number(300),b=Number(90),_=Number(.25),g=Number(300),f=Number(.25),v=Number(1),S=Number(f)/Number(v),w=5,y=new r.a("My salt: Yet another Naval Action map"),D=t=>t.includes(" (i)"),$=t=>t.replace(" (i)",""),j=t=>p`${$(t)} ${D(t)?p`<span class="caps small">imported</span>`:p``}`,O=(t,e=2)=>{const[a,s]=h.d.format(`.${e}f`)(t).split(".");let i=p`${s}`;return s&&(i="0"===s||"00"===s?p`<span class="hidden">.${s}</span>`:s.endsWith("0")?p`.${s.replace("0","")}<span class="hidden">0</span>`:p`.${s}`),p`${a}${i}`},C=({id:t,title:e,size:a="modal-xl",body:s,footer:i})=>p`
        <div id="${t}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${t}" aria-hidden="true">
            <div class="modal-dialog ${a}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${t}" class="modal-title">
                            ${e}
                        </h5>
                    </div>
                    <div class="modal-body">${s()}</div>
                    <div class="modal-footer">
                        ${i()}
                    </div>
                </div>
            </div>
        </div>
    `,I=t=>t.replace(/[^\d-.?]/g,""),x=()=>{c.a.extend("number",t=>{var e,a;return null!==(e=null!==(a=/^[+-]?[$¢£´Û€]?\d+\s*([,.]\d{0,2})/.exec(t))&&void 0!==a?a:/^[+-]?\d+\s*([,.]\d{0,2})?[$¢£´Û€]/.exec(t))&&void 0!==e?e:/^[+-]?(\d)*-?([,.])?-?(\d)+([,Ee][+-]\d+)?%?$/.exec(t)},(t,e)=>{const a=I(t);return((t,e)=>{let a=Number.parseFloat(t),s=Number.parseFloat(e);return a=Number.isNaN(a)?0:a,s=Number.isNaN(s)?0:s,a-s})(I(e),a)})},A=t=>`${t} real${Number(t)>1?"s":""}`,k=t=>{var e,a;const{r:i,g:r,b:o}=Object(s.d)(t);return(299*i+587*r+114*o)/1e3>=128?null!==(e=null===(a=Object(s.c)(l.j))||void 0===a?void 0:a.darker(5).toString())&&void 0!==e?e:"#111":l.j},M=t=>p`<span class="caps">${t}</span>`},q1Yc:function(t,e,a){(function(t){a.d(e,"a",(function(){return h}));a("WUlJ"),a("fCtr");var s=a("AKWm"),i=(a("dbdZ"),a("pOjD")),r=a("Q4du"),o=a("pxNS"),n=a("Qs7V"),d=a("oggF"),c=a("Bx8B");function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class h{constructor(){l(this,"_baseName",void 0),l(this,"_baseId",void 0),l(this,"_buttonId",void 0),l(this,"_modalId",void 0),l(this,"_buildingData",void 0),this._baseName="List buildings",this._baseId="building-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._buildingData=[],this._setupListener()}async _loadAndSetupData(){try{this._buildingData=(await a.e(4).then(a.t.bind(null,"7IKn",3))).default}catch(t){Object(o.f)(t)}}_setupListener(){let t=!0;document.querySelector("#"+this._buttonId).addEventListener("click",async()=>{t&&(t=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._buildingListSelected()})}_injectModal(){Object(r.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return""+this._buildingData.sort(Object(c.b)(["name"])).map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){const e=t(`#${this._baseId}-select`);e.addClass("selectpicker").on("change",t=>this._buildingSelected(t)).selectpicker({noneSelectedText:"Select building"}),e.val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getBuildingData(t){return this._buildingData.filter(e=>e.name===t)[0]}_getProductText(t){let e="";return t.result&&(t.result.length>1?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.result.map(t=>t.name).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.result[0].name}</h5>`,t.result[0].price&&(e+='<table class="table table-sm card-table"><tbody>',e+=`<tr><td>${Object(d.f)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm card-table"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td class="text-left">`,e+=a.materials.map(t=>`${Object(n.c)(t.amount)} ${t.item}`).join("<br>"),e+="</td>",e+=`<td>${Object(n.c)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour cost (%)</th><th>Storage</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${Object(n.c)(a.production)}</td><td>${Object(n.c)(-100*a.labourDiscount)}</td><td>${Object(n.c)(a.maxStorage)}</td><td>${Object(n.c)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-5"><div class="card-header">Product</div>',a+='<div class="card-body product">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-7"><div class="card-header">Requirements</div>',a+='<div class="card-body px-0 requirements">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(e){const a=String(t(e.currentTarget).find(":selected").val());Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("buildings mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a("xeH2"))},qE0g:function(t,e,a){(function(t){a.d(e,"a",(function(){return P}));a("UxlC"),a("WUlJ"),a("fCtr");var s=a("mrVq"),i=a("gj+k"),r=a("APuy"),o=a("bwSX"),n=a("Ws9M"),d=a("VIqg"),c=a("AKWm"),l=a("Wgwc"),h=a.n(l),p=a("+QaA"),u=a.n(p),m=a("Ds8A"),b=a.n(m),_=a("pOjD"),g=a("Q4du"),f=a("pxNS"),v=a("Qs7V"),S=a("oggF"),w=a("otg8"),y=a("Bx8B"),D=a("dNoP"),$=a("ck04"),j=a("awzk"),O=a("iftE");function C(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return I(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function x(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function A(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function k(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}h.a.extend(u.a),h.a.extend(b.a);var M=new WeakMap,T=new WeakMap;class P{constructor(t="ship-compare"){x(this,"colorScale",void 0),x(this,"colourScaleSpeedDiff",void 0),x(this,"columnsCompare",void 0),x(this,"innerRadius",void 0),x(this,"outerRadius",void 0),x(this,"radiusSpeedScale",void 0),x(this,"selectedShips",void 0),x(this,"singleShipData",void 0),x(this,"shipMassScale",void 0),x(this,"svgHeight",void 0),x(this,"svgWidth",void 0),x(this,"windProfileRotate",0),x(this,"woodCompare",void 0),M.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),x(this,"_maxSpeed",void 0),x(this,"_minSpeed",void 0),x(this,"_modal$",{}),x(this,"_modifierAmount",new Map),x(this,"_moduleAndWoodCaps",void 0),x(this,"_moduleAndWoodChanges",void 0),x(this,"_moduleDataDefault",void 0),x(this,"_moduleProperties",void 0),x(this,"_moduleTypes",void 0),x(this,"_selectedUpgradeIdsList",{}),x(this,"_selectedUpgradeIdsPerType",{}),x(this,"_selectModule$",{}),x(this,"_selectShip$",{}),x(this,"_selectWood$",{}),x(this,"_shipData",void 0),x(this,"_shipIds",{}),x(this,"_shipSelectData",void 0),x(this,"_baseId",void 0),x(this,"_baseName",void 0),x(this,"_buttonId",void 0),x(this,"_columns",void 0),x(this,"_copyButtonId",void 0),x(this,"_imageButtonId",void 0),x(this,"_modalId",void 0),x(this,"_moduleId",void 0),x(this,"_woodId",void 0),this._baseId=t,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._imageButtonId="button-image-"+this._baseId,this.colourScaleSpeedDiff=Object(d.a)().range([g.i,g.j,g.f]).interpolate(n.a),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(t){return t<=3?"L":t<=5?"M":"S"}static _adjustAbsolute(t,e){return t?t+e:e}static _adjustPercentage(t,e,a){return a?t?t*(1+e):e:t?t+e:e}static _getModifierFromModule(t){return`<p class="mb-0">${t.map(t=>{let e;return e=t.isPercentage?Object(v.l)(t.amount/100):t.amount<1&&t.amount>0?Object(v.e)(t.amount,1):Object(v.j)(t.amount,2),`${t.modifier} ${e}`}).join("<br>")}</p>`}static _setSelect(t,e){let a;a=Array.isArray(e)?e.map(t=>String(t)):String(e),a&&t.val(a),t.selectpicker("render")}static _saveCanvasAsImage(t){const e=`na-map ship compare ${h.a.utc().format("YYYY-MM-DD HH-mm-ss")}.png`,a=document.createElement("a");a.href=t,a.download=e,document.body.append(a),a.click(),a.remove()}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(t){var e;await this._loadAndSetupData();const a=S.g.decode(null!==(e=t.get("cmp"))&&void 0!==e?e:"");a.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(a),this._setModuleSelects(t))}_setupArrow(){const t=document.querySelector("#journey-arrow").cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(t)}_setupData(){var t,e,a;this._moduleAndWoodChanges=new Map([["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Rudder turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),k(this,M,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:.5,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:17,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const r=1.2*(null!==(t=Object(s.a)(this._shipData,t=>t.speed.min))&&void 0!==t?t:0),o=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=r,this._maxSpeed=o,this.colorScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([g.i,g.j,g.f]).interpolate(n.a);const c=null!==(e=Object(s.a)(this._shipData,t=>t.shipMass))&&void 0!==e?e:0,l=null!==(a=Object(i.a)(this._shipData,t=>t.shipMass))&&void 0!==a?a:0;this.shipMassScale=Object(d.a)().domain([c,l]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await a.e(8).then(a.t.bind(null,"jhXC",3))).default,this._shipData=(await a.e(15).then(a.t.bind(null,"pcjM",3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new $.a(this._woodId),await this.woodCompare.woodInit())}catch(t){Object(f.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._shipCompareSelected()})}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=t(`#${this._modalId} .column-base`).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(t){var e,a;return null!==(e=null===(a=this._shipData.find(e=>e.id===t))||void 0===a?void 0:a.name)&&void 0!==e?e:""}_getSelectedData(t){const e={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[t]){e.ship=this._getShipName(this._shipIds[t]);for(const a of f.h)e.wood.push(this.woodCompare.getWoodName(a,Number(this._selectWood$[t][a].val())));if(this._selectedUpgradeIdsPerType[t])for(const i of C(this._moduleTypes)){const r=[];for(const e of this._selectedUpgradeIdsPerType[t][i]){var a,s;r.push(null!==(a=null===(s=this._moduleProperties.get(e))||void 0===s?void 0:s.name.replace(" Bonus",""))&&void 0!==a?a:"")}e.moduleData.set(i,r.join(", "))}}return e}_printSelectedData(t,e,a){const s=t.querySelectorAll(`#${this._baseId}-${a.toLowerCase()} label`),i=s[0].parentNode,r=s[0].offsetHeight;for(const t of s)t.remove();const o=Object(c.a)(i).insert("div",":first-child").style("height",5*r+"px");e.ship&&o.append("div").style("margin-bottom","5px").style("line-height","1.1").text(e.ship),""!==e.wood[0]&&o.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(e.wood.join(" | "));for(const[t,a]of e.moduleData)""!==a&&o.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${t}</em>: ${a}`)}_replaceSelectsWithText(t){for(const e of this._columns){const a=this._getSelectedData(e);this._printSelectedData(t,a,e)}}_setMakeImageSpinner(){A(this,T).select("i").remove(),A(this,T).attr("class","btn btn-primary").property("disabled",!0),A(this,T).append("span").attr("class","spinner-border spinner-border-sm").attr("role","status").attr("aria-hidden","true"),A(this,T).append("span").attr("class","sr-only").text("Loading...")}_unsetMakeImageSpinner(){A(this,T).selectAll("span").remove(),A(this,T).attr("class","btn btn-outline-secondary icon-outline-button").property("disabled",!1),A(this,T).append("i").attr("class","icon icon-image")}async _makeImage(t){t.preventDefault(),this._setMakeImageSpinner();const e=await a.e(23).then(a.t.bind(null,"wOnQ",7)),s=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(s){const t=await e.default(s,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:t=>t.classList.contains("central")||t.classList.contains("overlay")||t.classList.contains("navbar"),logging:!0,onclone:t=>{this._replaceSelectsWithText(t)},x:0,y:0});P._saveCanvasAsImage(t.toDataURL())}this._unsetMakeImageSpinner()}_shipCompareSelected(){var e,a,s;Object(f.d)(this._modal$)&&(this._initModal(),this._modal$=t("#"+this._modalId),null===(e=document.querySelector("#"+this._modalId))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyDataClicked(t)}),null===(a=document.querySelector("#"+this._copyButtonId))||void 0===a||a.addEventListener("click",t=>{this._copyDataClicked(t)}),null===(s=document.querySelector("#"+this._imageButtonId))||void 0===s||s.addEventListener("click",async t=>{Object(_.b)("Menu","Ship compare image"),await this._makeImage(t)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const t=[];for(const e of this._columns)if(this._shipIds[e]){t.push(this._shipIds[e]);for(const a of f.h)t.push(Number(this._selectWood$[e][a].val()))}return t}_copyDataClicked(t){Object(_.b)("Menu","Copy ship compare"),t.preventDefault();const e=this._getShipAndWoodIds();if(e.length>0){const t=new URL(window.location.href);t.searchParams.set("v",encodeURIComponent(g.d)),t.searchParams.set("cmp",S.g.encode(e));for(const e of this._columns){const a=this._columns.indexOf(e);if(this._selectedUpgradeIdsPerType[e])for(const s of C(this._moduleTypes)){const i=C(this._moduleTypes).indexOf(s),r=this._selectedUpgradeIdsPerType[e][s];if(null==r?void 0:r.length){const e=`${a}${i}`;t.searchParams.set(e,S.g.encode(r))}}}Object(D.c)(t.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(o.b)().key(t=>String(t.class)).sortKeys(r.a).entries(this._shipData.map(t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns.total})).sort(Object(y.b)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(t=>t[1].filter(t=>t.properties.some(t=>this._moduleAndWoodChanges.has(t.modifier))).map(t=>[t.id,t]))),this._moduleTypes=new Set(C(this._moduleProperties).map(t=>t[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(g.n)({id:this._modalId,title:this._baseName});const t=Object(c.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const e of this._columns){const a=t.append("div").attr("id",`${this._baseId}-${e.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp")),s=this._getShipSelectId(e);a.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker");for(const t of f.h){const s=this._getWoodSelectId(t,e);a.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}for(const t of this._moduleTypes){const s=this._getModuleSelectId(t,e);a.append("label").append("select").attr("name",s).attr("id",s).property("multiple",!0).attr("class","selectpicker")}a.append("div").attr("id",`${this._baseId}-${e}`).attr("class",("Base"===e?"ship-base":"ship-compare")+" compress")}const e=Object(c.a)(`#${this._modalId} .modal-footer`);e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),k(this,T,e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._imageButtonId).attr("title","Make image").attr("type","button")),A(this,T).append("i").classed("icon icon-image",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const a of f.h)this._selectWood$[e][a]=t("#"+this._getWoodSelectId(a,e)),this.woodCompare._setupWoodSelects(e,a,this._selectWood$[e][a])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(t=>`<optgroup label="${Object(w.q)(Number(t.key),!1)} rate">${t.values.map(t=>`<option data-subtext="${t.battleRating} ${Object(S.k)(t.name)?"Imported":""}" value="${t.id}">${Object(S.q)(t.name)} (${t.guns})`).join("</option>")}`).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=t("#"+this._getShipSelectId(e));const a=this._getShipOptions();this._selectShip$[e].append(a),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(t,e){const a=Object(o.b)().key(t=>t[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(r.a).sortValues((t,e)=>t[1].name.localeCompare(e[1].name)).entries(C(this._moduleProperties).filter(a=>a[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===t&&("U"===a[1].moduleLevel||a[1].moduleLevel===P._getModuleLevel(e))));let s;const i=new Set(["Permanent","Ship trim"]);return s=a.length>1?a.map(e=>`<optgroup label="${e.key}" data-max-options="${i.has(t.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${e.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")}`).join("</optgroup>"):a.map(t=>""+t.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")).join(""),s}_fillModuleSelect(t,e){const a=this._getUpgradesOptions(e,(()=>this._shipData.find(e=>e.id===this._shipIds[t]).class)());this._selectModule$[t][e].find("option").remove(),this._selectModule$[t][e].append(a)}_resetModuleSelects(t){for(const e of this._moduleTypes)this._fillModuleSelect(t,e),this._selectModule$[t][e].selectpicker("refresh")}_getModuleFromName(t){let e={};return this._moduleDataDefault.some(a=>(e=a[1].find(e=>e.name===t),Boolean(e))),e}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const a of this._moduleTypes)this._selectModule$[e][a]=t("#"+this._getModuleSelectId(a,e)),this._selectModule$[e][a].on("changed.bs.select",()=>{this._modulesSelected(e),this._refreshShips(e)}).on("show.bs.select",e=>{t(e.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",e=>{const a=t(e.currentTarget);for(const e of a.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const a=this._getModuleFromName(e.textContent);t(e).attr("data-original-title",P._getModifierFromModule(a.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:t=>`${t} ${a.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:a.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+a,width:"150px"})}this._resetModuleSelects(e)}_getShipData(t){const e=this._shipData.find(e=>e.id===this._shipIds[t]);e.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:e.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:e.boarding.prepInitial,prepPerRound:e.boarding.prepPerRound};let a=e;return a.repairAmount={armour:S.h,armourPerk:0,sails:S.n,sailsPerk:0},a.repairTime={sides:S.l,default:S.l},a.resistance={fire:0,leaks:0,splinter:0},a=this._addModulesAndWoodData(e,a,t),a}_roundPropertyValue(t,e,a=!1){return Number.isInteger(t)&&!a?Math.round(e):Math.trunc(100*e)/100}_adjustValue(t,e,a){var s,i;let r=t;if(null===(s=this._modifierAmount.get(e))||void 0===s?void 0:s.percentage){const t=this._modifierAmount.get(e).percentage/100;r=P._adjustPercentage(r,t,a)}if(null===(i=this._modifierAmount.get(e))||void 0===i?void 0:i.absolute){const{absolute:t}=this._modifierAmount.get(e);r=P._adjustAbsolute(r,t)}const o=!A(this,M).has(e)&&!a;return this._roundPropertyValue(t,r,o)}_setModifier(t){let e=t.isPercentage?0:t.amount,a=t.isPercentage?t.amount:0;var s,i,r,o;this._modifierAmount.has(t.modifier)&&(e+=null!==(s=null===(i=this._modifierAmount.get(t.modifier))||void 0===i?void 0:i.absolute)&&void 0!==s?s:0,a+=null!==(r=null===(o=this._modifierAmount.get(t.modifier))||void 0===o?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(t.modifier,{absolute:e,percentage:a})}_showCappingAdvice(t,e){const a=`${this._baseId}-${t}-capping`;let s=document.querySelector("#"+a);if(!s){var i;s=document.createElement("p"),s.id=a,s.className="alert alert-warning";const e=document.querySelector(`#${this._baseId}-${t}`);null==e||null===(i=e.firstChild)||void 0===i||i.after(s)}s.innerHTML=C(e).join(", ")+" capped"}_removeCappingAdvice(t){const e=`${this._baseId}-${t}-capping`,a=document.querySelector("#"+e);a&&a.remove()}_addModulesAndWoodData(t,e,a){const s=JSON.parse(JSON.stringify(e)),i=()=>{s.speedDegrees=s.speedDegrees.map(t=>{const e=1+this._modifierAmount.get("Max speed").percentage/100,a=t>0?t*e:t/e;return Math.max(Math.min(a,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const t of this._selectedUpgradeIdsList[a]){const e=this._moduleProperties.get(t);for(const t of e.properties)this._moduleAndWoodChanges.has(t.modifier)&&this._setModifier(t)}if(this.woodCompare.instances[a]){let t="_woodData";"Base"!==a&&(t="_compareData");for(const e of f.h)for(const s of this.woodCompare.instances[a][t][e].properties)this._moduleAndWoodChanges.has(s.modifier)&&this._setModifier(s)}})(),(()=>{for(const[e]of this._modifierAmount.entries()){var t;if(null===(t=this._moduleAndWoodChanges.get(e))||void 0===t?void 0:t.properties){const{properties:t,isBaseValueAbsolute:a}=this._moduleAndWoodChanges.get(e);for(const i of t){const t=i.split(".");t.length>1?s[t[0]][t[1]]=this._adjustValue(s[t[0]][t[1]],e,a):s[t[0]]=this._adjustValue(s[t[0]],e,a)}}}})(),(()=>{const e={isCapped:!1,modifiers:new Set},i=(t,a,s,{amount:i,isPercentage:r})=>{const o=Math.min(a,r?this._roundPropertyValue(s,s*(1+i)):i);return a>o&&(e.isCapped=!0,e.modifiers.add(t)),o};for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(e)){const{cap:a}=this._moduleAndWoodCaps.get(e);for(const r of this._moduleAndWoodCaps.get(e).properties){const o=r.split(".");o.length>1?s[o[0]][o[1]]&&(s[o[0]][o[1]]=i(e,s[o[0]][o[1]],t[o[0]][o[1]],a)):s[o[0]]&&(s[o[0]]=i(e,s[o[0]],t[o[0]],a))}}e.isCapped?this._showCappingAdvice(a,e.modifiers):this._removeCappingAdvice(a)})(),this._modifierAmount.has("Max speed")&&i(),s}_updateDifferenceProfileNeeded(t){"Base"===t||Object(f.d)(this.selectedShips[t])||this.selectedShips[t].updateDifferenceProfile()}_updateSailingProfile(t){this._updateDifferenceProfileNeeded(t);for(const e of this.columnsCompare)e!==t&&this._updateDifferenceProfileNeeded(e)}_refreshShips(t){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(e=>e.id===this._shipIds[t]);else{this._modulesSelected(t);const e=this._getShipData(t);if("Base"===t){this._setSelectedShip(t,new j.a(t,e,this));for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh"),Object(f.d)(this.selectedShips[t])||this._setSelectedShip(t,new O.a(t,e,this.selectedShips[t].shipCompareData,this))}else this._setSelectedShip(t,new O.a(t,this.selectedShips.Base.shipData,e,this));this._updateSailingProfile(t)}}_enableCompareSelects(){for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(t){this._selectedUpgradeIdsList[t]=[],this._selectedUpgradeIdsPerType[t]={};for(const e of this._moduleTypes)this._selectedUpgradeIdsPerType[t][e]=this._selectModule$[t][e].val(),Array.isArray(this._selectedUpgradeIdsPerType[t][e])?this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e].map(t=>Number(t)):this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e]?[Number(this._selectedUpgradeIdsPerType[t][e])]:[],this._selectedUpgradeIdsPerType[t][e].length>0&&(this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][e]))}_setupSelectListener(t){if(this._selectShip$[t].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[t]=Number(this._selectShip$[t].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(t),this._refreshShips(t),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(t)}),"ship-journey"!==this._baseId)for(const e of f.h)this._selectWood$[t][e].on("changed.bs.select",()=>{this.woodCompare._woodSelected(t,e,this._selectWood$[t][e]),this._refreshShips(t)}).selectpicker({title:"Wood "+e,width:"150px"})}_setShipAndWoodsSelects(t){let e=0;this._columns.some(a=>{if(!this._shipData.find(a=>a.id===t[e]))return!1;if(this._shipIds[a]=t[e],e+=1,P._setSelect(this._selectShip$[a],this._shipIds[a]),"Base"===a&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(a),this._setupModulesSelect(a),t[e])for(const s of f.h)P._setSelect(this._selectWood$[a][s],t[e]),e+=1,this.woodCompare._woodSelected(a,s,this._selectWood$[a][s]);else e+=2;return this._refreshShips(a),e>=t.length})}_setModuleSelects(t){for(const a of this._columns){const s=this._columns.indexOf(a);let i=!1;for(const r of C(this._moduleTypes)){const o=C(this._moduleTypes).indexOf(r);if(t.has(`${s}${o}`)){var e;const n=S.g.decode(t.get(`${s}${o}`));this._selectedUpgradeIdsPerType[a]||(this._selectedUpgradeIdsPerType[a]={}),this._selectedUpgradeIdsList[a]||(this._selectedUpgradeIdsList[a]=[]),this._selectedUpgradeIdsPerType[a][r]=n.map(t=>Number(t)),P._setSelect(this._selectModule$[a][r],this._selectedUpgradeIdsPerType[a][r]),(e=this._selectedUpgradeIdsList[a]).push.apply(e,C(this._selectedUpgradeIdsPerType[a][r])),i=!0}}i&&this._refreshShips(a)}}_getShipSelectId(t){return`${this._baseId}-${t}-select`}_getWoodSelectId(t,e){return`${this._woodId}-${t}-${e}-select`}_getModuleSelectId(t,e){return`${this._moduleId}-${t.replace(/\s/,"")}-${e}-select`}_setSelectedShip(t,e){this.selectedShips[t]=e}}}).call(this,a("xeH2"))},qTn5:function(t,e,a){(function(t){a.d(e,"a",(function(){return I}));a("WUlJ"),a("fCtr");var s=a("AKWm"),i=a("XXsb"),r=a.n(i),o=a("2mXy"),n=a("JQHs"),d=a("Wgwc"),c=a.n(d),l=(a("9xm0"),a("+QaA")),h=a.n(l),p=a("QgiU"),u=a.n(p),m=a("Ds8A"),b=a.n(m),_=a("pOjD"),g=a("pxNS"),f=a("Q4du"),v=a("oggF");function S(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function w(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function y(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}const D=n.a.bind(o.a);c.a.extend(h.a),c.a.extend(u.a),c.a.extend(b.a),c.a.locale("en-gb");var $=new WeakMap,j=new WeakMap,O=new WeakMap,C=new WeakMap;class I{constructor(t){$.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),S(this,"_baseName",void 0),S(this,"_baseId",void 0),S(this,"_buttonId",void 0),S(this,"_modalId",void 0),y(this,C,t),this._baseName="List of port battles",this._baseId="pb-list",this._buttonId="button-"+this._baseId,y(this,j,"table-"+this._baseId),this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{const t=await(await fetch(`data/${w(this,C)}-pb.json`)).json();y(this,O,t.filter(t=>1===t.attackHostility))}catch(t){Object(g.f)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._pbListSelected()})}_injectModal(){Object(f.n)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=Object(s.a)(`#${this._modalId} .modal-body`);y(this,$,t.append("div").attr("id",this._baseId))}_initModal(){Object(v.j)(),this._injectModal(),this._injectList()}_pbListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getList(){return D`
            <table id="${w(this,j)}" class="table table-sm tablesort na-table">
                ${D` <thead>
                <tr>
                    <th data-sort-default>Time</th>
                    <th>Port</th>
                    <th>Attacker</th>
                    <th>Defender</th>
                </tr>
            </thead>`} ${(()=>D`<tbody>
                ${w(this,O).map(t=>{var e;const a=c.a.utc(t.portBattle).local(),s=c.a.utc(t.portBattle),i=s===a?"":` (${a.format("H.mm")} local)`,r=null===(e=Object(g.c)(t.nation))||void 0===e?void 0:e.name,o=t.capturer?D`${r} (${Object(v.b)(t.capturer)})`:r;return D`
                        <tr>
                            <td data-sort="${t.portBattle}">
                                ${Object(g.b)(s.fromNow())} at ${s.format("H.mm")}
                                ${i}
                            </td>
                            <td>${t.name}</td>
                            <td>${t.attackerNation} (${Object(v.b)(t.attackerClan)})</td>
                            <td>${o}</td>
                        </tr>
                    `})}
            </tbody>`)()}
            </table>
        `}_injectList(){Object(o.b)(this._getList(),w(this,$).node());const t=document.querySelector("#"+w(this,j));new r.a(t)}}}).call(this,a("xeH2"))},u3gz:function(t,e,a){a("Z5fe"),a("awzk"),a("iftE");var s=a("qE0g");a.d(e,"a",(function(){return s.a}))},yU80:function(t,e,a){}}]);