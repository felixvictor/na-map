/*! For license information please see map.63b6e0c2568a4acd26f0.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"1Dm9":function(t,e,i){(function(t){i.d(e,"a",(function(){return m}));i("UxlC"),i("WUlJ"),i("gQ/v"),i("ry7D"),i("dbdZ");var a=i("wz8V"),s=i("sCaM"),o=i("VIqg"),r=i("AKWm"),n=i("pxNS"),l=i("Qs7V"),d=i("otg8"),h=i("m+OL"),c=i("1RyA");function p(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class m{constructor(t,e,i,a,s){_(this,"show",void 0),_(this,"_serverName",void 0),_(this,"_portSelect",void 0),_(this,"_isDataLoaded",void 0),_(this,"_minScale",void 0),_(this,"_scale",void 0),_(this,"_fontSize",void 0),_(this,"_numTrades",void 0),_(this,"_arrowX",void 0),_(this,"_arrowY",void 0),_(this,"_baseId",void 0),_(this,"_nationSelectId",void 0),_(this,"_listType",void 0),_(this,"_showId",void 0),_(this,"_showRadioValues",void 0),_(this,"_showCookie",void 0),_(this,"_showRadios",void 0),_(this,"_profitId",void 0),_(this,"_profitRadioValues",void 0),_(this,"_profitCookie",void 0),_(this,"_profitRadios",void 0),_(this,"_profitValue",void 0),_(this,"_lowerBound",void 0),_(this,"_upperBound",void 0),_(this,"_profitText",void 0),_(this,"_g",void 0),_(this,"_labelG",void 0),_(this,"_tradeDetailsDiv",void 0),_(this,"_tradeDetailsHead",void 0),_(this,"_nationSelector",void 0),_(this,"_list",void 0),_(this,"_linkDataDefault",void 0),_(this,"_linkData",void 0),_(this,"_portData",void 0),_(this,"_nodeData",void 0),_(this,"_linkDataFiltered",void 0),_(this,"_portDataFiltered",void 0),_(this,"_tradeItem",void 0),this._serverName=t,this._portSelect=e,this._minScale=i,this._scale=this._minScale,this._fontSize=d.i,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=this._baseId+"-nation-select",this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new h.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new c.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new h.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new c.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(a,s),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _hideDetails(e,i,a){t(Object(r.a)(a[i]).node()).tooltip("dispose")}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=Object(r.a)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(r.a)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=Object(r.a)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const e=""+n.f.map(t=>`<option value="${t.short}" selected>${t.name}</option>`).join(""),i=this._baseId+"-card";this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const a=this._tradeDetailsHead.append("label"),s=a.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=s.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText(t){let e="";return e=t===n.f.length?"All":String(t),e+" nations selected"},title:"Select nations"}),a.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#"+i).text("Info"),this._tradeDetailsHead.append("div").attr("id",i).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,a=t.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),a.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector("#"+this._showId))||void 0===t||t.addEventListener("change",async()=>this._showSelected()),null===(e=document.querySelector("#"+this._profitId))||void 0===e||e.addEventListener("change",()=>this._profitValueSelected()),this._nationSelector.addEventListener("change",t=>{this._nationChanged(),t.preventDefault()})}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map(t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}])),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map(t=>{let e=0;switch(this._profitValue){case"weight":e=m._getProfitPerWeight(t);break;case"distance":e=m._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error("Wrong profit value "+this._profitValue)}return t.profit=e,t}).sort((t,e)=>{var i,a;return null!==(i=e.profit)&&void 0!==i?i:0-(null!==(a=t.profit)&&void 0!==a?a:0)})}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){try{const t=(await i.e(13).then(i.t.bind(null,"0dXp",3))).default,e=await(await fetch(`data/${this._serverName}-pb.json`)).json();this._linkDataDefault=await(await fetch(`data/${this._serverName}-trades.json`)).json(),this._portData=t.map(t=>{const i=e.find(e=>e.id===t.id);return{...t,...i}});const a=await(await fetch(`data/${this._serverName}-items.json`)).json();this._tradeItem=new Map(a.map(t=>[t.id,t.name]))}catch(t){Object(n.g)(t)}}async _loadAndSetupData(){try{await this._loadData(),this._setupData()}catch(t){Object(n.g)(t)}}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then(()=>{this._isDataLoaded=!0}),m._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(m._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e,i;return null===(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.isShallow)||void 0===e||e}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){var e;const i=t.weightPerItem*t.quantity;let a="";return a+=m._addInfo(`${Object(l.d)(t.quantity)} ${this._tradeItem.get(t.good)}`)+m._addDes("trade"),a+=m._addInfo(""+Object(l.h)(null!==(e=t.profit)&&void 0!==e?e:0))+m._addDes(this._profitText),a+=m._addInfo(`${Object(l.i)(i)} ${1===i?"ton":"tons"}`)+m._addDes("weight"),a+=m._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+m._addDes("from "+this._getDepth(t.source.id)),a+=m._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+m._addDes("to "+this._getDepth(t.target.id)),a+=m._addInfo(Object(l.i)(t.distance)+" k")+m._addDes("distance"),a}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,a=m._getProfitPerDistance(t),s=m._getProfitPerWeight(t);let o="";return o+=m._startBlock("Trade"),o+=m._addInfo(`${Object(l.d)(t.quantity)} ${this._tradeItem.get(t.good)}`)+m._addDes("good"),o+=m._addInfo(""+Object(l.h)(t.source.grossPrice))+m._addDes("gross buy price"),o+=m._addInfo(""+Object(l.h)(t.target.grossPrice))+m._addDes("gross sell price"),o+=m._addInfo(`${Object(l.i)(e)} ${1===e?"ton":"tons"}`)+m._addDes("weight"),o+=m._endBlock(),o+=m._startBlock("Profit"),o+=m._addInfo(""+Object(l.h)(t.profitTotal))+m._addDes("total"),o+=m._addInfo(""+Object(l.h)(i))+m._addDes("profit/item"),o+=m._addInfo(""+Object(l.h)(a))+m._addDes("profit/distance"),o+=m._addInfo(""+Object(l.h)(s))+m._addDes("profit/weight"),o+=m._endBlock(),o+=m._startBlock("Route"),o+=m._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+m._addDes("from "+this._getDepth(t.source.id)),o+=m._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+m._addDes("to "+this._getDepth(t.source.id)),o+=m._addInfo(Object(l.i)(t.distance)+" k")+m._addDes("distance"),o+=m._endBlock(),o}_showDetails(e,i,a){const s=Object(r.a)(a[i]),o=this._getTradeFullData(e);t(s.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:o,trigger:"manual",sanitize:!1}).tooltip("show")}_getSiblingLinks(t,e){return this._linkDataFiltered.filter(i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t).map(t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0})}_getXCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.x)&&void 0!==e?e:0}_getYCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.y)&&void 0!==e?e:0}_updateGraph(){const t=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},a={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},o=t?i.x:a.x,r=t?i.y:a.y,n=t?a.x:i.x,l=t?a.y:i.y;let d=Math.sqrt((n-o)**2+(l-r)**2);const h=t?0:1,c=this._getSiblingLinks(e.source.id,e.target.id);if(c.length>1){var p,u;const t=Object(s.b)().domain(c).range([1,c.length]);d/=1+1/c.length*(null!==(p=t(null!==(u=e.profit)&&void 0!==u?u:0))&&void 0!==p?p:-1)}return d=Math.round(d),`M${o},${r}A${d},${d} 0,0,${h} ${n},${l}`},e=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,i=Object(a.a)(this._linkDataFiltered,t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0}),r=Object(o.a)().range([5/this._scale,15/this._scale]).domain(i),n=2**Math.log2(Math.abs(this._minScale)+this._scale),h=Object(d.u)(this._fontSize/n);this._g.selectAll(".trade-link").data(e,t=>m._getId(t)).join(t=>t.append("path").attr("class","trade-link").attr("marker-start",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)").attr("marker-end",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"").attr("id",t=>m._getId(t)).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",m._hideDetails)).attr("d",e=>t(this._getXCoord(e.source.id)<this._getXCoord(e.target.id),e)).attr("stroke-width",t=>{var e;return r(null!==(e=t.profit)&&void 0!==e?e:0)+"px"}),this._labelG.attr("font-size",h+"px"),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,t=>m._getId(t)).join(t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",t=>"#"+m._getId(t)).text(t=>`${Object(l.d)(t.quantity)} ${t.good}`)).attr("dy",t=>{var e;return`-${r(null!==(e=t.profit)&&void 0!==e?e:0)/1.5}px`})}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],m._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,m._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(null!=t?t:"")}_updatePortList(t){this._list.html(null!=t?t:"")}_updateTradeList(){let t;const e=e=>{t=Object(r.a)("path#"+m._getId(e)).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,t=>m._getId(t)).join(t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i)).html(t=>this._getTradeLimitedData(t))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]).map(t=>t.id));this._linkDataFiltered=this._linkData.filter(e=>t.has(e.source.id)||t.has(e.target.id)).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter(t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id)).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set(p(this._nationSelector.selectedOptions).map(t=>t.value));this._portDataFiltered=new Set(this._portData.filter(e=>t.has(e.nation)).map(t=>t.id))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t,e){this._lowerBound=t,this._upperBound=e}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}}).call(this,i("xeH2"))},"1Gn1":function(t,e,i){i.d(e,"a",(function(){return T}));var a=i("RhHs"),s=i("AKWm"),o=i("AWXE"),r=i("VIqg"),n=i("otg8"),l=i("Qs7V");function d(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function h(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}var c=new WeakMap,p=new WeakMap,u=new WeakMap,_=new WeakMap,m=new WeakMap,v=new WeakMap,g=new WeakMap,b=new WeakMap,f=new WeakMap,w=new WeakMap,y=new WeakMap,S=new WeakMap,x=new WeakMap,k=new WeakMap,j=new WeakMap,D=new WeakMap,C=new WeakMap,I=new WeakMap,M=new WeakMap;class T{constructor(t){c.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:!1}),u.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),h(this,u,t),h(this,c,"on"===d(this,u).showGrid),h(this,_,d(this,u).coord.min),h(this,m,d(this,u).coord.max),h(this,v,d(this,u).height),h(this,g,d(this,u).width),h(this,b,d(this,u).rem),h(this,f,d(this,u).xGridBackgroundHeight),h(this,w,d(this,u).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){h(this,y,Object(r.a)().clamp(!0).domain([Object(n.f)(d(this,_),d(this,_)),Object(n.f)(d(this,m),d(this,m))]).range([d(this,_),d(this,m)])),h(this,S,Object(r.a)().clamp(!0).domain([Object(n.g)(d(this,_),d(this,_)),Object(n.g)(d(this,m),d(this,m))]).range([d(this,_),d(this,m)]))}_setupAxis(){const t=this._getTicks(65);h(this,x,Object(a.a)(d(this,y)).tickFormat(t=>Object(l.a)(t)).tickValues(t).tickSize(d(this,m))),h(this,k,Object(a.c)(d(this,S)).tickFormat(t=>Object(l.a)(t)).tickValues(t).tickSize(d(this,m)));const e=Object(s.a)("#map");h(this,D,e.insert("g","g.pb").attr("class","axis d-none")),h(this,I,d(this,D).append("g")),h(this,C,e.insert("g","g.pb").attr("class","axis d-none")),h(this,M,d(this,C).append("g")),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round(Object(n.g)(d(this,_),d(this,_))),i=Math.round(Object(n.g)(d(this,m),d(this,m))),a=(i-e)/(t-1),s=[];for(let t=a;t<i;t+=a)s.push(Math.round(t));s.push(i);const o=s.slice(0).reverse().map(t=>-t);return o.push(0),o.concat(s)}_setupXAxis(){d(this,I).selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),d(this,I).attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){d(this,M).attr("text-anchor","end").attr("fill",null).attr("font-family",null),d(this,M).selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){const t=o.c?o.c.transform.k:1,e=Object(n.u)(d(this,b)/t),i=Object(n.u)(1/t),a=o.c?o.c.transform.y:0,s=a/t<d(this,g)?a/t:0,r=-d(this,m)-s,l=o.c?o.c.transform.x:0,h=l/t<d(this,v)?l/t:0,c=-d(this,m)-h;d(this,I).attr("font-size",e).attr("stroke-width",i).call(d(this,x).tickPadding(r)),d(this,M).attr("font-size",e).attr("stroke-width",i).call(d(this,k).tickPadding(c))}get show(){return d(this,c)}set show(t){h(this,c,t)}get zoomLevel(){return d(this,j)}set zoomLevel(t){h(this,j,t)}update(){let t=!1;d(this,c)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),d(this,p)&&this.gridToggle(t)}transform(){d(this,c)&&(this.testForInitialisation(),this._displayAxis())}gridToggle(t){d(this,u).gridOverlay.classList.toggle("overlay-grid",t),d(this,u).gridOverlay.classList.toggle("overlay-no-grid",!t),d(this,D).classed("d-none",!t),d(this,C).classed("d-none",!t)}testForInitialisation(){d(this,p)||(this._setupSvg(),h(this,p,!0))}}},"2Coy":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d2ccc2' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"3YHm":function(t,e,i){t.exports=i.p+"images/flags/PR.svg"},"7D/U":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"7PF8":function(t,e,i){(function(t){i.d(e,"a",(function(){return w}));i("WUlJ"),i("fCtr");var a=i("Mn03"),s=i("NltA"),o=i("AJ/N"),r=i("VIqg"),n=i("AWXE"),l=i("AKWm"),d=i("+ugm"),h=i("2TRZ"),c=(i("b6Yt"),i("Iohx"),i("pOjD")),p=i("Q4du"),u=i("Qs7V"),_=i("otg8"),m=i("dNoP"),v=i("u3gz");function g(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class w{constructor(t){f(this,"_fontSize",void 0),f(this,"_compassRadius",void 0),f(this,"_courseArrowWidth",void 0),f(this,"_line",void 0),f(this,"_labelPadding",void 0),f(this,"_degreesPerMinute",void 0),f(this,"_degreesSegment",void 0),f(this,"_minOWSpeed",void 0),f(this,"_owSpeedFactor",void 0),f(this,"_speedScale",void 0),f(this,"_defaultShipName",void 0),f(this,"_defaultShipSpeed",void 0),f(this,"_defaultStartWindDegrees",void 0),f(this,"_baseName",void 0),f(this,"_baseId",void 0),f(this,"_buttonId",void 0),f(this,"_compassId",void 0),f(this,"_deleteLastLegButtonId",void 0),f(this,"_modalId",void 0),f(this,"_sliderId",void 0),f(this,"_shipId",void 0),f(this,"_g",void 0),f(this,"_journey",void 0),f(this,"_shipCompare",void 0),f(this,"_compass",void 0),f(this,"_compassG",void 0),f(this,"_divJourneySummary",void 0),f(this,"_journeySummaryShip",void 0),f(this,"_journeySummaryTextShip",void 0),f(this,"_journeySummaryWind",void 0),f(this,"_journeySummaryTextWind",void 0),f(this,"_gJourneyPath",void 0),f(this,"_drag",void 0),this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(d.a)().x(t=>t[0]).y(t=>t[1]),this._labelPadding=20,this._degreesPerMinute=p.i/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(r.a)().domain(Object(s.a)(0,_.j,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-"+this._baseId,this._compassId="compass-"+this._baseId,this._deleteLastLegButtonId="button-delete-leg-"+this._baseId,this._modalId="modal-"+this._baseId,this._sliderId="slider-"+this._baseId,this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0===e?"":Object(p.m)(e,"hour");a+=t+(""===t?"":" ")+(0===i?"":Object(p.m)(i,"minute"))}return a}_setupDrag(){this._drag=o.a().on("start",(t,e,i)=>{n.c.sourceEvent.stopPropagation(),this._removeLabels(),Object(l.a)(i[e]).classed("drag-active",!0)}).on("drag",(t,e,i)=>{const a=n.c,s=t.position[0]+Number(a.dx),o=t.position[1]+Number(a.dy);0===e&&this._compass.attr("x",s).attr("y",o),Object(l.a)(i[e]).attr("cx",a.x).attr("cy",a.y),t.position=[s,o],this._printLines()}).on("end",(t,e,i)=>{Object(l.a)(i[e]).classed("drag-active",!1),this._printJourney()})}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(l.a)("#ports").append("g").attr("class","journey"),Object(l.a)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(){Object(c.b)("Menu","MakeJourney"),this._journeySelected()}_setupListener(){var t,e;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("mouseup",()=>this._navbarClick()),null===(e=document.querySelector("#"+this._deleteLastLegButtonId))||void 0===e||e.addEventListener("mouseup",()=>this._deleteLastLeg())}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>`${Object(m.e)(t.value)}<br>${String(t.value)}°`,t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/_.b.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){Object(p.k)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(l.a)(`#${this._modalId} .modal-body`).append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i=this._shipId+"-Base-select",a=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new v.a(this._shipId),this._shipCompare.CompareShipsInit()}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segments[0].position[0],e=this._journey.segments[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e),this._compassG=this._compass.append("g"),Object(m.k)({element:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const i=(_.j-t+e)%_.j;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*_.v}_getStartWind(){const e=t("#"+this._sliderId),i=Number(e.roundSlider("getValue"));return e.length>0?i:0}_setShipSpeed(){let t;this._journey.shipName===this._defaultShipName?t=g(new Array(24).fill(this._defaultShipSpeed/2)):({speedDegrees:t}=this._shipCompare.singleShipData),this._speedScale.range(t)}_calculateMinutesForSegment(t,e,i){let a=i,s=e,o=0;for(this._setShipSpeed();a>0;){const e=this._calculateDistanceForSection(t,s);a>e?(a-=e,o+=1):(o+=a/e,a=0),s=(_.j+s-this._degreesPerMinute)%_.j}return this._journey.currentWindDegrees=s,o}_setShipName(){var t,e;(null===(t=this._shipCompare)||void 0===t||null===(e=t.singleShipData)||void 0===e?void 0:e.name)?this._journey.shipName=""+this._shipCompare.singleShipData.name:this._journey.shipName=this._defaultShipName}_removeLabels(){const t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(l.a)("#na-svg"),e=Object(h.c)(t.node()),i=Math.max(1,e.k),a=this._fontSize/i,s=h.b.translate(20/i,20/i),o=this._labelPadding/i,r=10/i,n=5/i;this._g.selectAll("g.journey g.label").each((t,e,i)=>{const n=Object(l.a)(i[e]),d=n.select("text"),h=t.label.split("|"),c=1.3*a;d.text("").attr("dy",0).attr("transform",s.toString()).style("font-size",a+"px"),h.forEach((t,e)=>{const i=d.append("tspan").html(t);e>0&&i.attr("x",0).attr("dy",c)});const p=d.node().getBBox(),u=t.label?p.width+2*o:0,_=t.label?p.height+o:0;n.select("rect").attr("width",u).attr("height",_);const m=n.select("circle").attr("r",r).attr("class","");n.append(()=>m.remove().node()),0===e&&m.attr("r",4*r).attr("class","drag-hidden"),e===i.length-1&&m.attr("r",r).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",n+"px"),this._compassG&&this._compassG.attr("transform",`scale(${1/i})`)}_printLabels(){const t=Object(a.c)().padding(this._labelPadding).value(t=>{const e=t.label.split("|"),i=e.reduce((t,e,i,a)=>a[t].length>e.length?t:i,0);return e[i]}),e=Object(a.a)(),i=Object(a.b)(e).size((t,e,i)=>{const a=t.label.split("|").length,s=i[e].querySelectorAll("text")[0].getBBox();return[s.width+2*this._labelPadding,s.height*a+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segments.map(t=>t)).call(i)}_setupSummary(){this._divJourneySummary=Object(l.a)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(l.a)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html("From "+Object(m.f)(this._journey.startWindDegrees))}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segments.length>1?this._journey.segments.map(t=>t.position):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)}_getTextDirection(t,e,i){return`${Object(m.f)(t,!0)} ⁖ F11: ${Object(u.a)(Object(_.f)(i.x,i.y))} / ${Object(u.a)(Object(_.g)(i.x,i.y))}`}_getTextDistance(t,e,i){let a=`${Math.round(t)} k ${w._getHumanisedDuration(e)}`;return i&&(a+=`⁖ total ${Math.round(this._journey.totalDistance)} k ${w._getHumanisedDuration(this._journey.totalMinutes)}`),a}_setSegmentLabel(t=this._journey.segments.length-1){const e={x:this._journey.segments[t].position[0],y:this._journey.segments[t].position[1]},i={x:this._journey.segments[t-1].position[0],y:this._journey.segments[t-1].position[1]},a=Object(m.m)(e,i),s=Object(_.p)(e,i),o=Object(_.m)(a),r=this._calculateMinutesForSegment(a,this._journey.currentWindDegrees,1e3*s);this._journey.totalDistance+=s,this._journey.totalMinutes+=r;const n=this._getTextDirection(o,a,e),l=this._getTextDistance(s,r,t>1);this._journey.segments[t].label=`${n}|${l}`}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData(),this._journey.segments.forEach((t,e)=>{e<this._journey.segments.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segments.pop(),this._journey.segments.length>0?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top",t+"px").style("right",e+"px")}plotCourse(t,e){this._journey.segments[0].position[0]>0?(this._journey.segments.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segments[0]={position:[t,e],label:""},this._initJourney())}}}).call(this,i("xeH2"))},"8KGH":function(t,e,i){(function(t){i.d(e,"a",(function(){return Tt}));i("UxlC"),i("WUlJ"),i("ry7D");var a=i("mrVq"),s=i("gj+k"),o=i("OWWo"),r=i("Ws9M"),n=i("VIqg"),l=i("3xmg"),d=i("AKWm"),h=i("JQHs"),c=i("2mXy"),p=i("Wgwc"),u=i.n(p),_=(i("9xm0"),i("+QaA")),m=i.n(_),v=i("QgiU"),g=i.n(v),b=i("Ds8A"),f=i.n(b),w=i("pxNS"),y=i("Q4du"),S=i("Qs7V"),x=i("otg8"),k=i("Bx8B"),j=i("oggF"),D=i("m+OL"),C=i("1RyA"),I=i("y+tX"),M=i.n(I),T=i("8ZGG");function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function O(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function $(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}u.a.extend(m.a),u.a.extend(g.a),u.a.extend(f.a),u.a.locale("en-gb");const A=h.a.bind(c.a);var L=new WeakMap,N=new WeakMap,B=new WeakMap,E=new WeakMap,W=new WeakMap,z=new WeakMap,H=new WeakMap,F=new WeakMap,R=new WeakMap,G=new WeakMap,V=new WeakMap,Z=new WeakMap,q=new WeakMap,J=new WeakMap,X=new WeakMap,Y=new WeakMap,Q=new WeakMap,U=new WeakMap,K=new WeakMap,tt=new WeakMap,et=new WeakMap,it=new WeakMap,at=new WeakMap,st=new WeakMap,ot=new WeakMap,rt=new WeakMap,nt=new WeakMap,lt=new WeakMap,dt=new WeakMap,ht=new WeakMap,ct=new WeakMap,pt=new WeakMap,ut=new WeakMap,_t=new WeakMap,mt=new WeakMap,vt=new WeakMap,gt=new WeakMap,bt=new WeakMap,ft=new WeakMap,wt=new WeakMap,yt=new WeakMap,St=new WeakMap,xt=new WeakMap,kt=new WeakMap,jt=new WeakMap,Dt=new WeakMap,Ct=new WeakMap,It=new WeakMap,Mt=new WeakMap;class Tt{constructor(t){this.map=t,P(this,"circleType",""),P(this,"currentPort",void 0),P(this,"portData",void 0),P(this,"portDataDefault",void 0),P(this,"showCurrentGood",void 0),P(this,"showRadius",void 0),P(this,"showTradePortPartners",void 0),P(this,"tradeItem",void 0),P(this,"tradePortId",void 0),P(this,"zoomLevel","initial"),L.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),B.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),H.set(this,{writable:!0,value:void 0}),F.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:void 0}),G.set(this,{writable:!0,value:void 0}),V.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),q.set(this,{writable:!0,value:void 0}),J.set(this,{writable:!0,value:void 0}),X.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:void 0}),Q.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),K.set(this,{writable:!0,value:void 0}),tt.set(this,{writable:!0,value:void 0}),et.set(this,{writable:!0,value:void 0}),it.set(this,{writable:!0,value:void 0}),at.set(this,{writable:!0,value:void 0}),st.set(this,{writable:!0,value:void 0}),ot.set(this,{writable:!0,value:void 0}),rt.set(this,{writable:!0,value:void 0}),nt.set(this,{writable:!0,value:void 0}),lt.set(this,{writable:!0,value:void 0}),dt.set(this,{writable:!0,value:void 0}),ht.set(this,{writable:!0,value:void 0}),ct.set(this,{writable:!0,value:void 0}),pt.set(this,{writable:!0,value:void 0}),ut.set(this,{writable:!0,value:void 0}),_t.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),vt.set(this,{writable:!0,value:void 0}),gt.set(this,{writable:!0,value:"show-radius"}),bt.set(this,{writable:!0,value:x.h}),ft.set(this,{writable:!0,value:void 0}),wt.set(this,{writable:!0,value:void 0}),yt.set(this,{writable:!0,value:x.i}),St.set(this,{writable:!0,value:48}),xt.set(this,{writable:!0,value:4.854}),kt.set(this,{writable:!0,value:1.618}),jt.set(this,{writable:!0,value:void 0}),Dt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:void 0}),Mt.set(this,{writable:!0,value:"all"}),$(this,It,this.map.serverName),$(this,jt,this.map.minScale),$(this,mt,O(this,jt)),$(this,wt,this.map.f11),this.showCurrentGood=!1,this.showTradePortPartners=!1,this.currentPort={id:366,coord:{x:4396,y:2494}},$(this,Dt,["attack","county","points","position","tax","net","off"]),$(this,ft,new D.a({id:O(this,gt),values:O(this,Dt)})),$(this,Ct,new C.a(O(this,gt),O(this,Dt))),this.showRadius=this._getShowRadiusSetting()}static _importAll(t){const e={};return t.keys().forEach(i=>{e[i.replace("./","").replace(".svg","")]=t(i)}),e}static _hideDetails(e,i,a){t(Object(d.a)(a[i]).node()).tooltip("dispose")}async init(){await this._loadAndSetupData()}_setupData(t){this.portDataDefault=t.ports.map(e=>{var i,a;const s=null!==(i=t.server.find(t=>t.id===e.id))&&void 0!==i?i:{},o=null!==(a=t.pb.find(t=>t.id===e.id))&&void 0!==a?a:{};return{...e,...s,...o}}),this.portData=this.portDataDefault,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupPatrolZones(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:O(this,It)+"-ports.json",name:"server"},{fileName:O(this,It)+"-pb.json",name:"pb"}],e={};try{e.ports=(await i.e(13).then(i.t.bind(null,"0dXp",3))).default;const a=await(await fetch(`data/${O(this,It)}-items.json`)).json();this.tradeItem=new Map(a.map(t=>[t.id,t])),await(async t=>{for await(const i of t)e[i.name]=await(await fetch("data/"+i.fileName)).json()})(t)}catch(t){Object(w.g)(t)}return e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){var t,e,i,o,d,h;$(this,rt,Object(n.a)()),$(this,L,Object(n.a)().domain([0,1])),$(this,B,Object(n.a)().domain([0,1]).range([y.h,y.g]).interpolate(r.a)),$(this,N,Object(l.a)().range(y.f)),$(this,at,null!==(t=Object(a.a)(this.portData,t=>t.taxIncome))&&void 0!==t?t:0),$(this,tt,null!==(e=Object(s.a)(this.portData,t=>t.taxIncome))&&void 0!==e?e:0),$(this,z,Object(n.a)().domain([O(this,at),O(this,tt)]).range([y.h,y.e]).interpolate(r.a)),$(this,et,null!==(i=Object(a.a)(this.portData,t=>t.netIncome))&&void 0!==i?i:0),$(this,U,null!==(o=Object(s.a)(this.portData,t=>t.netIncome))&&void 0!==o?o:0),$(this,E,Object(n.a)().domain([O(this,et),0,O(this,U)]).range([y.g,y.h,y.e]).interpolate(r.a)),$(this,it,null!==(d=Object(a.a)(this.portData,t=>t.portPoints))&&void 0!==d?d:0),$(this,K,null!==(h=Object(s.a)(this.portData,t=>t.portPoints))&&void 0!==h?h:0),$(this,W,Object(n.a)().domain([O(this,it),O(this,K)]).range([y.h,y.e]).interpolate(r.a))}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",()=>this._showRadiusSelected())}_getShowRadiusSetting(){let t=O(this,ft).get();return"position"===t&&([t]=O(this,Dt),O(this,ft).set(t)),O(this,Ct).set(t),t}_showRadiusSelected(){this.showRadius=O(this,Ct).get(),O(this,ft).set(this.showRadius),this.update()}_setupSvg(){$(this,Z,Object(d.a)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports")),$(this,X,O(this,Z).append("g").attr("class","region")),$(this,G,O(this,Z).append("g").attr("class","county")),$(this,q,O(this,Z).append("g").attr("data-ui-component","port-circles")),$(this,V,O(this,Z).append("g").attr("class","port")),$(this,Y,O(this,Z).append("g").attr("class","port-names")),$(this,J,O(this,Z).append("g").attr("class","pz"))}_setupCounties(){$(this,H,[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}]);const t={x:this.map.coord.max/2,y:this.map.coord.max/2};$(this,H,O(this,H).sort((e,i)=>{const a={x:e.centroid[0],y:e.centroid[1]},s={x:i.centroid[0],y:i.centroid[1]};return Object(x.o)(t,a)-Object(x.o)(t,s)})),O(this,N).domain(O(this,H).map(t=>t.name))}_setupRegions(){$(this,ut,[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}])}_setupPatrolZones(){const t=[{name:"Hispaniola",coordinates:[4900,3635],radius:150,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"Tumbado",coordinates:[2400,3050],radius:150,shallow:!1},{name:"Léogane",coordinates:[5130,3770],radius:90,shallow:!1,shipClass:{min:7,max:4}},{name:"Tortuga",coordinates:[5435,3420],radius:100,shallow:!1,shipClass:{min:7,max:5}},{name:"Antilles",coordinates:[7555,4470],radius:140,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"La Mona",coordinates:[6180,4100],radius:170,shallow:!1,shipClass:{min:7,max:4}}],e=u.a.utc("2020-07-24").hour(10),i=u.a.utc().diff(e,"day")%t.length,{radius:a,name:s,shallow:o,shipClass:r}=t[i],n=1.6*a,[l,d]=t[i].coordinates,h=Math.round(a/1.2),c=Math.round(O(this,yt)*a/100);O(this,J).append("circle").attr("cx",l).attr("cy",d).attr("r",a).attr("opacity",.7),O(this,J).append("image").attr("height",n).attr("width",n).attr("x",l).attr("y",d).attr("transform",`translate(${Math.floor(-n/2)},${Math.floor(-n/1.6)})`).attr("xlink:href",M.a).attr("alt","Patrol zone"),O(this,J).append("text").text(s).attr("x",l).attr("y",d).attr("dy",h).attr("font-size",Math.round(1.6*c)),O(this,J).append("text").html(o?"Shallow water ships":(r?`${Object(x.r)(r.min)} to ${Object(x.r)(r.max)} rate`:"All")+" ships").attr("x",l).attr("y",d).attr("dy",h-1.6*c).attr("font-size",c)}_setupSummary(){$(this,R,Object(d.a)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind")),$(this,lt,O(this,R).append("div").attr("class","block")),$(this,ct,O(this,lt).append("div")),O(this,lt).append("div").attr("class","summary-des").html("selected<br>ports"),$(this,dt,O(this,R).append("div").attr("class","block")),$(this,pt,O(this,dt).append("div")),O(this,dt).append("div").attr("class","summary-des").html("tax<br>income"),$(this,nt,O(this,R).append("div").attr("class","block")),$(this,ht,O(this,nt).append("div")),O(this,nt).append("div").attr("class","summary-des").html("net<br>income")}_setupFlags(){$(this,st,Tt._importAll(i("EPjG")));const t=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${O(this,St)} ${.75*O(this,St)}`),e},e=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(O(this,St))),e.setAttribute("height",String(O(this,St))),e.setAttribute("href",O(this,st)[t].replace('"',"").replace('"',"")),e},a=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(O(this,St)/2)),t.setAttribute("cy",String(O(this,St)/2)),t.setAttribute("r","16"),t},s=document.querySelector("#na-svg defs");w.f.map(t=>t.short).forEach(i=>{const o=t(i);o.append(e(i));const r=s.appendChild(o);if("FT"!==i){const t=r.cloneNode(!0);t.id=i+"c",t.append(a()),s.append(t)}if("NT"!==i&&"FT"!==i){const t=r.cloneNode(!0);t.id=i+"a",t.append((()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",y.n),t.setAttribute("fill-opacity","0.7"),t})()),s.append(t);const e=t.cloneNode(!0);e.id=i+"ca",e.append(a()),s.append(e)}})}_getPortName(t){var e,i;return t&&null!==(e=null===(i=this.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}_getText(t){var e,i,a,s,o,r,n,l,d,h,c,p,_;const m=(t,e)=>`${String(t)} ‒ ${String(e)}`,v=(t,e)=>{const i=Number(u.a.utc().hour(t).local().format("H")),a=Number(u.a.utc().hour(e).local().format("H"));return A`${m(t,e)} (${m(i,a)})`},g=(t,e)=>e.profit.profit-t.profit.profit,b=u.a.utc(t.portBattle),f=u.a.utc(t.portBattle).local(),y=b===f?"":` (${f.format("H.mm")} local)`,x=u.a.utc(t.cooldownTime),D=u.a.utc(t.cooldownTime).local(),C=x===D?"":` (${D.format("H.mm")} local)`,I=t.portBattleStartTime?v((t.portBattleStartTime+10)%24,(t.portBattleStartTime+13)%24):v(11,8),M=b.isAfter(u.a.utc())?"s":"ed",T=t.portBattle?A`${Object(j.b)(t.attackerClan)} (${t.attackerNation})
              attack${t.portBattle?A`${M} ${b.fromNow()} at ${b.format("H.mm")}${y}`:A`s: ${Object(S.g)(null!==(e=t.attackHostility)&&void 0!==e?e:0)} hostility`}`:A``,P={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:""===t.county?"":t.county,region:""===t.region?"":t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?Object(j.b)(t.capturer):A``,captureTime:t.captured?""+Object(w.c)(u.a.utc(t.captured).fromNow()):"",attack:t.attackHostility?T:A``,isNPCAttacker:"Neutral"===t.attackerNation,pbTimeRange:t.capturable?I:"",brLimit:Object(S.d)(t.brLimit),portPoints:t.capturable?Object(S.d)(t.portPoints):"",taxIncome:Object(S.j)(t.taxIncome),portTax:Object(S.g)(t.portTax),netIncome:Object(S.j)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:null!==(i=null===(a=t.dropsTrading)||void 0===a?void 0:a.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==i?i:"",consumesTrading:null!==(s=null===(o=t.consumesTrading)||void 0===o?void 0:o.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==s?s:"",producesNonTrading:null!==(r=null===(n=t.producesNonTrading)||void 0===n?void 0:n.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==r?r:"",dropsNonTrading:null!==(l=null===(d=t.dropsNonTrading)||void 0===d?void 0:d.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==l?l:"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:null===(h=t.goodsToSellInTradePort)||void 0===h||null===(c=h.sort(g))||void 0===c?void 0:c.map(t=>`${t.name} (${Object(S.i)(t.profit.profit)})`).join(", "),goodsToBuyInTradePort:null===(p=t.goodsToBuyInTradePort)||void 0===p||null===(_=p.sort(g))||void 0===_?void 0:_.map(t=>`${t.name} (${Object(S.i)(t.profit.profit)})`).join(", ")};return P.dropsTrading.length>0&&P.dropsNonTrading.length>0&&(P.dropsNonTrading+=" ‒ "),t.cooldownTime&&(P.cooldownTime=A`${x.fromNow()} at <em>approximately</em> ${x.format("H.mm")}${C}`),t.portBonus&&(P.portBonus=t.portBonus),P}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return A`
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center ">
                    <img
                        alt="${t.icon}"
                        class="flag-icon mr-3 align-self-stretch ${e}"
                        src="${O(this,st)[t.icon].replace('"',"").replace('"',"")}"
                    />

                    <div class="text-left mr-1">
                        <div class="large">${t.name}</div>
                        <div class="caps">${t.county}</div>
                        <div class="caps">${t.region}</div>
                    </div>
                </div>

                ${t.portBonus?A`<div class="d-flex mr-1">${A`${T.b.map(e=>{var i;return A`${(null==t||null===(i=t.portBonus)||void 0===i?void 0:i[e])?A`<div>
                          <i class="icon icon-light icon-${e} mr-1" aria-hidden="true"></i>
                          <span class="sr-only">${e} bonus </span>
                          <span class="x-large text-lighter align-top mr-1">${t.portBonus[e]}</span>
                      </div>`:A``}`})}`}</div>`:A``}

                <div class="d-flex flex-column justify-content-end">
                    <div class="ml-auto">
                        ${t.portPoints?A`<span class="x-large text-lighter">${t.portPoints}</span>`:A``}
                    </div>
                    <div class="ml-auto">
                        ${t.laborHoursDiscount?A`<i class="icon icon-light icon-labour mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Labour hour discount level ${t.laborHoursDiscount}</span>`:A``}
                        ${t.tradingCompany?A`<i class="icon icon-light icon-trading mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Trading company level ${t.tradingCompany}</span>`:A``}
                        ${t.availableForAll?A`<i class="icon icon-light icon-open mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Accessible to all</span>`:A``}
                        ${t.shallow?A`<i class="icon icon-light icon-shallow" aria-hidden="true"></i
                                  ><span class="sr-only">Shallow</span>`:A`<i class="icon icon-light icon-deep" aria-hidden="true"></i
                                  ><span class="sr-only">Deep</span>`}
                    </div>
                </div>
            </div>

            ${void 0===t.attack?A`${t.cooldownTime?A`<div class="alert alert-success mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:A``}`:A`<div class="alert mt-2 ${t.isNPCAttacker?"alert-warning":"alert-danger"}" role="alert">
                      ${t.attack}
                  </div>`}

            <div class="d-flex text-left mb-2">
                ${t.capital||"FT"===t.icon?A`<div>${t.portTax}<br /><span class="des">Tax rate</span></div>`:A`
                          <div class="mr-3">
                              ${t.pbTimeRange}<br />
                              <span class="des">Battle timer</span>
                          </div>
                          <div class="mr-3">
                              ${t.brLimit}<br />
                              <span class="des">Rating</span>
                          </div>
                          <div class="mr-3">
                              ${t.capturer}<br />
                              <span class="des">Capturer</span>
                          </div>
                          <div class="mr-5">
                              ${t.captureTime}<br />
                              <span class="des">Capture</span>
                          </div>

                          <div class="ml-auto mr-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des">Net income</span>
                          </div>
                      `}
            </div>

            ${t.producesNonTrading.length>0?A`<p class="mb-2">
                      <span class="caps">Produces—</span><span class="non-trading">${t.producesNonTrading}</span>
                  </p>`:A``}
            ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?A`<p class="mb-2">
                      <span class="caps">Drops—</span>
                      ${t.dropsNonTrading?A`<span class="non-trading">${t.dropsNonTrading}</span>`:A``}
                      ${t.dropsTrading}
                  </p> `:A``}
            ${t.consumesTrading.length>0?A`<p class="mb-2"><span class="caps">Consumes—</span>${t.consumesTrading}</p>`:A``}
            ${"tradePorts"===this.showRadius?A`${t.goodsToSellInTradePort.length>0?A`<p class="mb-2">
                            <span class="caps">Sell in ${t.tradePort}</span> (net profit)—
                            ${t.goodsToSellInTradePort}
                        </p>`:A``}
                  ${t.goodsToBuyInTradePort.length>0?A`<p class="mb-2">
                            <span class="caps">Buy in ${t.tradePort}</span> (net profit)—
                            ${t.goodsToBuyInTradePort}
                        </p>`:A``}`:A``}
        `}_getInventory(t){const e=t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""};let i="";const a=t.inventory.filter(t=>t.buyQuantity>0&&t.buyPrice>0).sort((t,i)=>e(t.id).localeCompare(e(i.id))).map(t=>`${Object(S.d)(t.buyQuantity)} ${e(t.id)} @ ${Object(S.h)(t.buyPrice)}`).join("<br>"),s=t.inventory.filter(t=>t.sellQuantity>0&&t.sellPrice>0).sort((t,i)=>e(t.id).localeCompare(e(i.id))).map(t=>`${Object(S.d)(t.sellQuantity)} ${e(t.id)} @ ${Object(S.h)(t.sellPrice)}`).join("<br>");return i+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,a.length>0&&(i+="<h6>Buy</h6>",i+=a),a.length>0&&s.length>0&&(i+="<p></p>"),s.length>0&&(i+="<h6>Sell</h6>",i+=s),i}_showDetails(e,i,a){const s=t(Object(d.a)(a[i]).node()).tooltip("dispose").tooltip({html:!0,placement:"auto",trigger:"manual",title:"Wait...",sanitize:!1});s.on("inserted.bs.tooltip",()=>{const i=t(document.body).find(".tooltip").find(".tooltip-inner")[0];i.textContent="",Object(c.b)(this._tooltipData(this._getText(e)),i),s.tooltip("update")}),s.tooltip("show"),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(this._getInventory(e)))}_updateIcons(){const t=2**Math.log2(Math.abs(O(this,jt))+O(this,mt)),e=Object(x.u)(O(this,bt)/t),i=O(this,ot);O(this,V).selectAll("circle").data(i,t=>String(t.id)).join(t=>t.append("circle").attr("fill",t=>{const e=`${t.countyCapital&&t.capturable?"c":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`}).attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1]).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",Tt._hideDetails)).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getAttackMarker(t){let e="";return t.cooldownTime?e="cooldown":"Neutral"===t.attackerNation&&(e="raider"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=2**Math.log2(Math.abs(O(this,jt))+O(this,mt)),e=Object(x.u)(O(this,bt)/t*O(this,kt)),i=Object(x.u)(O(this,bt)/t*O(this,xt));let a=O(this,ot),s=()=>"",o=()=>0,r=()=>"";"tax"===this.showRadius?(a=O(this,ot).filter(t=>t.capturable),O(this,rt).domain([O(this,at),O(this,tt)]).range([e,i]),s=()=>"bubble",r=t=>O(this,z).call(this,t.taxIncome),o=t=>O(this,rt).call(this,t.taxIncome)):"net"===this.showRadius?(a=O(this,ot).filter(t=>t.capturable),O(this,rt).domain([O(this,et),O(this,U)]).range([e,i]),s=()=>"bubble",r=t=>O(this,E).call(this,t.netIncome),o=t=>O(this,rt).call(this,Math.abs(t.netIncome))):"points"===this.showRadius?(a=O(this,ot).filter(t=>t.capturable),O(this,rt).domain([O(this,it),O(this,K)]).range([e,i/2]),s=()=>"bubble",r=t=>O(this,W).call(this,t.portPoints),o=t=>O(this,rt).call(this,t.portPoints)):"position"===this.showRadius?(s=()=>"bubble here",o=t=>t.distance):"attack"===this.showRadius?(a=O(this,ot).filter(t=>t.attackHostility||t.cooldownTime),O(this,L).range([e,i/1.5]),s=t=>"bubble "+this._getAttackMarker(t),r=t=>{var e;return"Neutral"===t.attackerNation?"":O(this,B).call(this,null!==(e=t.attackHostility)&&void 0!==e?e:0)},o=t=>{var e;return O(this,L).call(this,null!==(e=t.attackHostility)&&void 0!==e?e:t.cooldownTime?.2:0)}):"currentGood"===this.circleType?(s=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"county"===this.showRadius?(s=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",r=t=>t.capturable?O(this,N).call(this,t.county):"",o=t=>t.capturable?i/2:i/3):"tradePorts"===this.showRadius?(s=t=>"bubble "+this._getTradePortMarker(t),o=t=>t.id===this.tradePortId?i:i/2):"frontline"===this.showRadius?(s=t=>"bubble "+this._getFrontlineMarker(t),o=t=>t.ownPort?i/3:i/2,a=a.filter(t=>{var e;return null!==(e=t.enemyPort)&&void 0!==e?e:t.ownPort})):"currentGood"===this.showRadius?(s=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>i/2):"off"===this.showRadius&&(a=[]),O(this,q).selectAll("circle").data(a,t=>String(t.id)).join(t=>t.append("circle").attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1])).attr("class",t=>s(t)).attr("r",t=>o(t)).attr("fill",t=>r(t))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===O(this,Mt)||"single"===O(this,Mt)&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(x.n)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const a=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+a;const s=t.angle>90&&t.angle<270?i:0;return"all"===O(this,Mt)||"single"===O(this,Mt)&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(x.n)(t.angle)))+s:t.coordinates[1]+a}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===O(this,Mt)||"single"===O(this,Mt)&&t.id===this.currentPort.id)?t.angle>0&&t.angle<x.k?"start":"end":"middle"}updateTexts(){if("initial"===this.zoomLevel)O(this,Y).classed("d-none",!0);else{const t=2**Math.log2(Math.abs(O(this,jt))+O(this,mt)),e=Object(x.u)(O(this,bt)/t),i=2**Math.log2(.9*(Math.abs(O(this,jt))+O(this,mt))),a=Object(x.u)(O(this,yt)/i),s=O(this,ot);O(this,Y).selectAll("text").data(s,t=>String(t.id)).join(t=>t.append("text").text(t=>t.name)).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,a)).attr("text-anchor",t=>this._updateTextsAnchor(t)),O(this,Y).attr("font-size",a+"px").classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this.portData).length;let e=0,i=0;t&&(e=Object(o.a)(this.portData,t=>t.taxIncome),i=Object(o.a)(this.portData,t=>t.netIncome)),O(this,ct).text(""+t),O(this,pt).html(""+Object(S.i)(e)),O(this,ht).html(""+Object(S.i)(i))}_updateCounties(){if("portLabel"===this.zoomLevel){const t=O(this,F);O(this,G).selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name),t=>t.attr("fill",t=>"county"===this.showRadius?O(this,N).call(this,t.name):"")),O(this,G).classed("d-none",!1)}else O(this,G).classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=O(this,_t);O(this,X).selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)),O(this,X).classed("d-none",!1)}else O(this,X).classed("d-none",!0)}_updatePZ(){"pbZone"===this.zoomLevel?O(this,J).classed("d-none",!0):O(this,J).classed("d-none",!1)}update(t){$(this,mt,null!=t?t:O(this,mt)),this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions(),this._updatePZ()}_filterVisible(){"position"===this.showRadius?$(this,ot,this.portData):$(this,ot,this.portData.filter(t=>t.coordinates[0]>=O(this,Q)[0]&&t.coordinates[0]<=O(this,vt)[0]&&t.coordinates[1]>=O(this,Q)[1]&&t.coordinates[1]<=O(this,vt)[1])),$(this,F,O(this,H).filter(t=>t.centroid[0]>=O(this,Q)[0]&&t.centroid[0]<=O(this,vt)[0]&&t.centroid[1]>=O(this,Q)[1]&&t.centroid[1]<=O(this,vt)[1])),$(this,_t,O(this,ut).filter(t=>t.centroid[0]>=O(this,Q)[0]&&t.centroid[0]<=O(this,vt)[0]&&t.centroid[1]>=O(this,Q)[1]&&t.centroid[1]<=O(this,vt)[1]))}setBounds(t,e){$(this,Q,t),$(this,vt,e)}_showSummary(){O(this,R).classed("hidden",!1)}setShowRadiusSetting(t=O(this,Dt)[0]){this.showRadius=t,O(this,Ct).set(this.showRadius),O(this,ft).set(this.showRadius)}clearMap(t){this._showSummary(),this.portData=this.portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)}}}).call(this,i("xeH2"))},"9yav":function(t,e){t.exports="data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='currentColor' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 0a1 1 0 011 1v5.268l4.562-2.634a1 1 0 111 1.732L10 8l4.562 2.634a1 1 0 11-1 1.732L9 9.732V15a1 1 0 11-2 0V9.732l-4.562 2.634a1 1 0 11-1-1.732L6 8 1.438 5.366a1 1 0 011-1.732L7 6.268V1a1 1 0 011-1z' fill-rule='evenodd' fill='%23d2ccc2'/%3E%3C/svg%3E"},EPjG:function(t,e,i){var a={"./CN.svg":"cA9Q","./DE.svg":"vYjh","./DK.svg":"TB//","./ES.svg":"RHiG","./FR.svg":"p7uB","./FT.svg":"9yav","./GB.svg":"tN7d","./NT.svg":"2Coy","./PL.svg":"wffX","./PR.svg":"3YHm","./RU.svg":"L1lh","./SE.svg":"YNpQ","./US.svg":"Ex7p","./VP.svg":"7D/U"};function s(t){var e=o(t);return i(e)}function o(t){if(!i.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}s.keys=function(){return Object.keys(a)},s.resolve=o,t.exports=s,s.id="EPjG"},Ex7p:function(t,e,i){t.exports=i.p+"images/flags/US.svg"},Iohx:function(t,e,i){},K2bk:function(t,e,i){(function(t){i.d(e,"a",(function(){return v}));i("WUlJ"),i("fCtr");var a=i("AKWm"),s=i("pOjD"),o=i("Qs7V"),r=i("Q4du"),n=i("otg8"),l=i("dNoP"),d=i("Wgwc"),h=i.n(d),c=i("+QaA"),p=i.n(c),u=i("Ds8A"),_=i.n(u);function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}h.a.extend(p.a),h.a.extend(_.a);class v{constructor(t,e){m(this,"_map",void 0),m(this,"_coord",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_formId",void 0),m(this,"_xInputId",void 0),m(this,"_zInputId",void 0),m(this,"_copyButtonId",void 0),m(this,"_submitButtonId",void 0),m(this,"_modal$",void 0),m(this,"_g",void 0),m(this,"_formSel",void 0),m(this,"_xInputSel",void 0),m(this,"_zInputSel",void 0),this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._xInputId="input-x-"+this._baseId,this._zInputId="input-z-"+this._baseId,this._copyButtonId="copy-coord-"+this._baseId,this._submitButtonId="submit-"+this._baseId,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(a.a)("#map").append("g").attr("class","f11")}_navbarClick(){Object(s.b)("Menu","Go to F11"),this._f11Selected()}_setupListener(){var t;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",()=>this._navbarClick()),window.addEventListener("keydown",t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick()})}_injectModal(){Object(r.k)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(a.a)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const s=t.append("div").classed("float-right btn-group",!0).attr("role","group");s.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),s.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to");Object(a.a)(`#${this._modalId} .modal-footer`).remove()}_initModal(){this._injectModal()}_f11Selected(){var e,i,a,s;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId),this._xInputSel=document.querySelector("#"+this._xInputId),this._zInputSel=document.querySelector("#"+this._zInputId),this._formSel.addEventListener("submit",t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()}),null===(a=document.querySelector("#"+this._modalId))||void 0===a||a.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)}),null===(s=document.querySelector("#"+this._copyButtonId))||void 0===s||s.addEventListener("click",t=>{this._copyCoordClicked(t)}));this._modal$.modal("show"),null===(e=this._xInputSel)||void 0===e||e.focus(),null===(i=this._xInputSel)||void 0===i||i.select()}_getInputValue(t){const{value:e}=t;return""===e?1/0:Number(e)}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){Object(s.b)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this._getXCoord(),i=this._getZCoord();Object(l.b)(e,i,this._modal$)}_printF11Coord(t,e,i,a){var s,r,n,l;let d=10;const c=this._g.append("g").attr("transform",`translate(${t},${e})`),p=c.append("rect"),u=c.append("rect");c.append("circle").attr("r",d),d*=1.6;const _=c.append("text").attr("dx",-d+"px").attr("dy",-d/2-2+"px").attr("class","f11-coord").text(Object(o.a)(i)),m=c.append("text").attr("dx",-d+"px").attr("dy",d/2+2+"px").attr("class","f11-coord").text(Object(o.a)(a)),v=null===(s=_.node())||void 0===s?void 0:s.getBBox(),g=null===(r=m.node())||void 0===r?void 0:r.getBBox(),b=h()().utc(),f=h()(),w=c.append("text").attr("dx",d+"px").attr("dy",-d/2-2+"px").attr("class","f11-time").text(b.format("H.mm")),y=c.append("text").attr("dx",d+"px").attr("dy",d/2+2+"px").attr("class","f11-time").text(`(${f.format("H.mm")} local)`),S=null===(n=w.node())||void 0===n?void 0:n.getBBox(),x=null===(l=y.node())||void 0===l?void 0:l.getBBox(),k=v&&g?1.2*Math.round(v.height+g.height):0,j=v&&g?Math.round(Math.max(v.width,g.width)+5):0,D=S&&x?1.2*Math.round(S.height+x.height):0,C=S&&x?Math.round(Math.max(S.width,x.width)+5):0,I=Math.max(k,D);p.attr("x",-j-d).attr("y",-I/2).attr("height",I).attr("width",j+d),u.attr("x",0).attr("y",-I/2).attr("height",I).attr("width",C+d)}_goToF11(t,e){const i=Math.floor(Object(n.d)(t,e)),a=Math.floor(Object(n.e)(t,e));Object(n.a)(i,this._coord.min,this._coord.max,!0)&&Object(n.a)(a,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(i,a,t,e),this._map.zoomAndPan(i,a,1))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&(Object(s.b)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=Object(n.f)(t,e),a=Object(n.g)(t,e);this._printF11Coord(t,e,i,a)}clearMap(){this._g.selectAll("*").remove()}}}).call(this,i("xeH2"))},L1lh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},RHiG:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"TB//":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},YNpQ:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},cA9Q:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fecd21' d='M0 0h640v480H0z'/%3E%3Ccircle cx='30%25' cy='40%25' fill='red' r='100'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},gQbg:function(t,e,i){(function(t){i.d(e,"a",(function(){return y}));i("WUlJ"),i("gUfG"),i("dbdZ");var a=i("Wgwc"),s=i.n(a),o=i("+QaA"),r=i.n(o),n=i("5Bip"),l=i.n(n),d=i("Ds8A"),h=i.n(d),c=i("pOjD"),p=i("pxNS"),u=i("Q4du"),_=i("Qs7V"),m=i("otg8"),v=i("Bx8B"),g=i("X2Cj");function b(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}s.a.extend(r.a),s.a.extend(l.a),s.a.extend(h.a),s.a.locale("en-gb");class y{constructor(t,e,i){w(this,"isInventorySelected",void 0),w(this,"_dataLoaded",!1),w(this,"_distances",new Map),w(this,"_frontlinesData",void 0),w(this,"_nation",void 0),w(this,"_ports",void 0),w(this,"_buyGoodsId",void 0),w(this,"_buyGoodsSelector",void 0),w(this,"_frontlineAttackingNationId",void 0),w(this,"_frontlineAttackingNationSelector",void 0),w(this,"_frontlineDefendingNationId",void 0),w(this,"_frontlineDefendingNationSelector",void 0),w(this,"_inventoryId",void 0),w(this,"_inventorySelector",void 0),w(this,"_map",void 0),w(this,"_numberPorts",void 0),w(this,"_pbZone",void 0),w(this,"_portNamesId",void 0),w(this,"_portNamesSelector",void 0),w(this,"_propClanId",void 0),w(this,"_propClanSelector",void 0),w(this,"_propNationId",void 0),w(this,"_propNationSelector",void 0),w(this,"_sellProfit",new Map),this._ports=t,this._pbZone=e,this._map=i,this._numberPorts=this._ports.portData.length,this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.querySelector("#"+this._frontlineAttackingNationId),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.querySelector("#"+this._frontlineDefendingNationId),this._portNamesId="port-names-select",this._portNamesSelector=document.querySelector("#"+this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.querySelector("#"+this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.querySelector("#"+this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.querySelector("#"+this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.querySelector("#"+this._propClanId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect()}_resetOtherSelects(e){for(const i of[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector])!i||i===e||i===this._propClanSelector&&e===this._propNationSelector||i===this._propNationSelector&&e===this._propClanSelector||t(i).val("default").selectpicker("refresh")}async _loadData(){if(!this._dataLoaded){const t="data";try{this._frontlinesData=await(await fetch(`${t}/${this._map.serverName}-frontlines.json`)).json();const e=(await i.e(7).then(i.t.bind(null,"VEL/",3))).default;this._distances=new Map(e.map(([t,e,i])=>[t*this._numberPorts+e,i])),this._dataLoaded=!0}catch(t){Object(p.g)(t)}}}_setupListener(){var e,i,a,s,o,r,n,l,d,h,p,_,m,v,g;t(this._portNamesSelector).one("show.bs.select",()=>{this._injectPortSelect()}),null===(e=this._portNamesSelector)||void 0===e||e.addEventListener("change",async t=>{Object(c.b)("Menu","Trade relations"),await this._loadData(),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()}),t(this._buyGoodsSelector).one("show.bs.select",async()=>{await this._loadData(),this._injectGoodsSelect()}),null===(i=this._buyGoodsSelector)||void 0===i||i.addEventListener("change",t=>{Object(c.b)("Menu","Goods’ relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()}),null===(a=this._inventorySelector)||void 0===a||a.addEventListener("change",t=>{Object(c.b)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()}),null===(s=this._frontlineAttackingNationSelector)||void 0===s||s.addEventListener("change",async t=>{Object(c.b)("Menu","Frontlines Attack"),await this._loadData(),this._resetOtherSelects(this._frontlineAttackingNationSelector),this._frontlineAttackingNationSelected(),t.preventDefault()}),null===(o=this._frontlineDefendingNationSelector)||void 0===o||o.addEventListener("change",async t=>{Object(c.b)("Menu","Frontlines Defence"),await this._loadData(),this._resetOtherSelects(this._frontlineDefendingNationSelector),this._frontlineDefendingNationSelected(),t.preventDefault()}),null===(r=this._propNationSelector)||void 0===r||r.addEventListener("change",t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()}),null===(n=this._propClanSelector)||void 0===n||n.addEventListener("change",t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()}),null===(l=document.querySelector("#menu-prop-deep"))||void 0===l||l.addEventListener("click",()=>this._depthSelected("deep")),null===(d=document.querySelector("#menu-prop-shallow"))||void 0===d||d.addEventListener("click",()=>this._depthSelected("shallow")),null===(h=document.querySelector("#menu-prop-all"))||void 0===h||h.addEventListener("click",()=>this._allSelected()),null===(p=document.querySelector("#menu-prop-non-capturable"))||void 0===p||p.addEventListener("click",()=>this._nonCapSelected()),null===(_=document.querySelector("#menu-prop-today"))||void 0===_||_.addEventListener("click",()=>this._capturedToday()),null===(m=document.querySelector("#menu-prop-yesterday"))||void 0===m||m.addEventListener("click",()=>this._capturedYesterday()),null===(v=document.querySelector("#menu-prop-this-week"))||void 0===v||v.addEventListener("click",()=>this._capturedThisWeek()),null===(g=document.querySelector("#menu-prop-last-week"))||void 0===g||g.addEventListener("click",()=>this._capturedLastWeek()),Object(u.j)("selectPortNavbar")}_injectPortSelect(){var e;const i=""+this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(v.b)(["name"])).map(t=>`<option data-subtext="${t.nation}" value="${t.coord.toString()}" data-id="${t.id}">${t.name}</option>`).join("");null===(e=this._portNamesSelector)||void 0===e||e.insertAdjacentHTML("beforeend",i),t(this._portNamesSelector).selectpicker("refresh")}_injectGoodsSelect(){var e;const i=new Map,a=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const t of this._ports.portDataDefault)for(const e of a){const a=t[e];if(a)for(const t of a){var s,o;i.set(t,null!==(s=null===(o=this._ports.tradeItem.get(t))||void 0===o?void 0:o.name)&&void 0!==s?s:"")}}const r=""+b(i).sort((t,e)=>t[1].localeCompare(e[1])).map(t=>`<option value="${t[0]}">${t[1]}</option>`).join("");null===(e=this._buyGoodsSelector)||void 0===e||e.insertAdjacentHTML("beforeend",r),t(this._buyGoodsSelector).selectpicker("refresh")}setupInventorySelect(e){var i,a,s,o,r;if(!(null===(i=this._inventorySelector)||void 0===i?void 0:i.classList.contains("selectpicker"))){var n,l;const e=new Map;for(const t of this._ports.portDataDefault)if(t.inventory)for(const i of t.inventory){var d,h;e.set(i.id,null!==(d=null===(h=this._ports.tradeItem.get(i.id))||void 0===h?void 0:h.name)&&void 0!==d?d:"")}const i=""+b(e).sort((t,e)=>t[1].localeCompare(e[1])).map(t=>`<option value="${t[0]}">${t[1]}</option>`).join("");null===(n=this._inventorySelector)||void 0===n||n.insertAdjacentHTML("beforeend",i),null===(l=this._inventorySelector)||void 0===l||l.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(null===(a=this._inventorySelector)||void 0===a||a.classList.remove("d-none"),(null===(s=this._inventorySelector)||void 0===s?void 0:s.parentNode).classList.remove("d-none")):(null===(o=this._inventorySelector)||void 0===o||o.classList.add("d-none"),(null===(r=this._inventorySelector)||void 0===r?void 0:r.parentNode).classList.add("d-none"))}_getNationOptions(t=!0){return""+p.f.filter(e=>!(!t&&("FT"===e.short||"NT"===e.short))).sort(Object(v.b)(["name"])).map(t=>`<option value="${t.short}">${t.name}</option>`).join("")}_setupFrontlinesNationSelect(){var e,i,a,s;const o=this._getNationOptions(!1);null===(e=this._frontlineAttackingNationSelector)||void 0===e||e.insertAdjacentHTML("beforeend",o),null===(i=this._frontlineAttackingNationSelector)||void 0===i||i.classList.add("selectpicker"),t(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),null===(a=this._frontlineDefendingNationSelector)||void 0===a||a.insertAdjacentHTML("beforeend",o),null===(s=this._frontlineDefendingNationSelector)||void 0===s||s.classList.add("selectpicker"),t(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupNationSelect(){var e,i;const a=this._getNationOptions(!0);null===(e=this._propNationSelector)||void 0===e||e.insertAdjacentHTML("beforeend",a),null===(i=this._propNationSelector)||void 0===i||i.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupClanSelect(){const e=new Set;for(const t of this._ports.portData.filter(t=>""!==(null==t?void 0:t.capturer)))e.add(t.capturer);if(this._propClanSelector){this._propClanSelector.innerHTML="";let i="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,i=""+b(e).sort(v.a).map(t=>`<option value="${t}" class="caps">${t}</option>`).join("")),this._propClanSelector.insertAdjacentHTML("beforeend",i),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}}_getSailingDistance(t,e){var i,a;return t<e?null!==(i=this._distances.get(t*this._numberPorts+e))&&void 0!==i?i:0:null!==(a=this._distances.get(e*this._numberPorts+t))&&void 0!==a?a:0}_setTradePortPartners(){var t;const e=null!==(t=this._ports.portDataDefault.find(t=>t.id===this._ports.tradePortId))&&void 0!==t?t:[];e&&this._setTradeRelations(e)}_setTradeRelations(t){const e=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.price)&&void 0!==e?e:0},i=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.distanceFactor)&&void 0!==e?e:0},a=t=>{var e,i;return null!==(e=null===(i=this._ports.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.portTax)&&void 0!==e?e:0},s=t=>{var e,i;const a=this._ports.portDataDefault.find(e=>e.id===t);return{x:null!==(e=null==a?void 0:a.coordinates[0])&&void 0!==e?e:0,y:null!==(i=null==a?void 0:a.coordinates[1])&&void 0!==i?i:0}},o=(t,e)=>{const i=s(t),a=s(e);return Object(m.p)(i,a)},r=(t,e)=>{let i=1/0;const a=new Set(this._ports.portDataDefault.filter(t=>{var i,a,s;return null!==(i=null===(a=t.dropsTrading)||void 0===a?void 0:a.includes(e))&&void 0!==i?i:null===(s=t.dropsNonTrading)||void 0===s?void 0:s.includes(e)}).map(t=>t.id));for(const e of a)i=Math.min(i,o(e,t.id));return i},n=(t,s,o)=>{const n=r(s,o),l=this._getSailingDistance(t.id,s.id),d=a(t.id),h=a(s.id);let c=e(o),p=3*c+n*c*i(o)/6/100;c*=1+d,p/=1+h;const u=Math.round(p-c);return{profit:u,profitPerDistance:u/l}},l=(t,e,i)=>{const a=String(e.id).padStart(4,"0")+String(i).padStart(4,"0");return this._sellProfit.has(a)||this._sellProfit.set(a,n(t,e,i)),this._sellProfit.get(a)},d=e=>{var i,a,s,o;const r=null!==(i=new Set(null===(a=t.dropsTrading)||void 0===a?void 0:a.map(t=>t)))&&void 0!==i?i:[];return null!==(s=null===(o=e.consumesTrading)||void 0===o?void 0:o.filter(t=>r.has(t)).map(i=>{var a,s;return{name:null!==(a=null===(s=this._ports.tradeItem.get(i))||void 0===s?void 0:s.name)&&void 0!==a?a:"",profit:l(t,e,i)}}))&&void 0!==s?s:[]},h=e=>{var i,a,s,o;const r=null!==(i=new Set(null===(a=t.consumesTrading)||void 0===a?void 0:a.map(t=>t)))&&void 0!==i?i:[];return null!==(s=null===(o=e.dropsTrading)||void 0===o?void 0:o.filter(t=>r.has(t)).map(i=>{var a,s;return{name:null!==(a=null===(s=this._ports.tradeItem.get(i))||void 0===s?void 0:s.name)&&void 0!==a?a:"",profit:l(e,t,i)}}))&&void 0!==s?s:[]};this._ports.portData=this._ports.portDataDefault.map(e=>(e.sailingDistanceToTradePort=this._getSailingDistance(e.id,t.id),e.goodsToBuyInTradePort=d(e),e.buyInTradePort=Boolean(e.goodsToBuyInTradePort.length),e.goodsToSellInTradePort=h(e),e.sellInTradePort=Boolean(e.goodsToSellInTradePort.length),e)).filter(t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort)}_portSelected(){var t;const e=null===(t=this._portNamesSelector)||void 0===t?void 0:t.options[this._portNamesSelector.selectedIndex],i=null==e?void 0:e.value.split(","),a=Number(null==e?void 0:e.getAttribute("data-id"));this._ports.currentPort={id:a,coord:{x:Number(null==i?void 0:i[0]),y:Number(null==i?void 0:i[1])}},this._ports.tradePortId=a,this._setTradePortPartners(),this._pbZone.showPB&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update(),this._map.initialZoomAndPan()}_goodSelected(){var t;const e=Number(null===(t=this._buyGoodsSelector)||void 0===t?void 0:t.options[this._buyGoodsSelector.selectedIndex].value),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(t=>{var i,a,s;return(null===(i=t.dropsTrading)||void 0===i?void 0:i.some(t=>t===e))||(null===(a=t.dropsNonTrading)||void 0===a?void 0:a.some(t=>t===e))||(null===(s=t.producesNonTrading)||void 0===s?void 0:s.some(t=>t===e))}))).map(t=>(t.isSource=!0,t)),a=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(t=>{var i;return null===(i=t.consumesTrading)||void 0===i?void 0:i.some(t=>t===e)}))).map(t=>(t.isSource=!1,t));this._ports.setShowRadiusSetting("off"),this._ports.portData=i.concat(a),this._ports.showRadius="currentGood",this._ports.update()}inventorySelected(){var t;this.isInventorySelected=!0;const e=Number(null===(t=this._inventorySelector)||void 0===t?void 0:t.options[this._inventorySelector.selectedIndex].value),i=new Map,a=new Map;console.log(e);const s=this._ports.portDataDefault.filter(t=>t.inventory.some(t=>t.id===e)).sort(Object(v.b)(["name"])).map(t=>{const s=t.inventory.find(t=>t.id===e);return s&&(t.sellInTradePort=s.buyQuantity>0,t.sellInTradePort&&i.set(t.name,{name:t.name,nation:t.nation,good:s}),t.buyInTradePort=s.sellQuantity>0,t.buyInTradePort&&a.set(t.name,{name:t.name,nation:t.nation,good:s})),t});this._ports.setShowRadiusSetting("off"),this._ports.portData=s,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{var t,s;let o="";if(o+=`<h5>${null!==(t=null===(s=this._ports.tradeItem.get(e))||void 0===s?void 0:s.name)&&void 0!==t?t:""}</h5>`,i.size){o+="<h6>Buy</h6>";for(const[,t]of i)o+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(_.d)(t.good.buyQuantity)} @ ${Object(_.h)(t.good.buyPrice)}<br>`}if(i&&a&&(o+="<p></p>"),a.size){o+="<h6>Sell</h6>";for(const[,t]of a)o+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(_.d)(t.good.sellQuantity)} @ ${Object(_.h)(t.good.sellPrice)}<br>`}return o})()),this._ports.update()}_setFrontlinePorts(t,e){const i=this._frontlinesData[t][e],a=new Set(i.map(t=>Number(t.key))),s=new Set(i.flatMap(t=>t.value.map(t=>t)));this._ports.portData=this._ports.portDataDefault.map(t=>(t.enemyPort=a.has(t.id),t.ownPort=s.has(t.id),t))}_frontlineAttackingNationSelected(){var t;const e=null===(t=this._frontlineAttackingNationSelector)||void 0===t?void 0:t.options[this._frontlineAttackingNationSelector.selectedIndex].value;Object(p.h)(e)&&(this._setFrontlinePorts("attacking",e),this._ports.showRadius="frontline",this._ports.update())}_frontlineDefendingNationSelected(){var t;const e=null===(t=this._frontlineDefendingNationSelector)||void 0===t?void 0:t.options[this._frontlineDefendingNationSelector.selectedIndex].value;Object(p.h)(e)&&(this._setFrontlinePorts("defending",e),this._ports.showRadius="frontline",this._ports.update())}_nationSelected(){var e;this._nation=null===(e=this._propNationSelector)||void 0===e?void 0:e.options[this._propNationSelector.selectedIndex].value,Object(p.h)(this._nation)?(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")):this._nation="NT"}_clanSelected(){var t;const e=null===(t=this._propClanSelector)||void 0===t?void 0:t.options[this._propClanSelector.selectedIndex].value;e?this._ports.portData=this._ports.portDataDefault.filter(t=>t.capturer===e):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation)),this._ports.showRadius="",this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.shallow:!e.shallow);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.availableForAll);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_nonCapSelected(){const t=this._ports.portDataDefault.filter(t=>!t.capturable);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_filterCaptured(t,e){const i=this._ports.portDataDefault.filter(i=>s()(i.captured,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]"));this._ports.portData=i,this._ports.showRadius="",this._ports.update()}_capturedToday(){const t=s.a.utc();let e=s()().utc().hour(g.c).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,s.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=s.a.utc();let e=s()().utc().hour(g.c).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,s.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=s()().utc().startOf("week"),e=t.utc().hour(g.c),i=s()(t).utc().add(7,"day").hour(g.c);this._filterCaptured(e,i)}_capturedLastWeek(){const t=s()().utc().startOf("week"),e=s()(t).utc().subtract(7,"day").hour(g.c),i=t.utc().hour(g.c);this._filterCaptured(e,i)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}}}).call(this,i("xeH2"))},oyY5:function(t,e,i){i.d(e,"a",(function(){return c}));var a=i("AKWm"),s=i("pxNS"),o=i("dNoP"),r=i("m+OL"),n=i("1RyA");function l(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}const d=i("Bhad");var h=new WeakMap;class c{constructor(t,e){l(this,"showPB",void 0),h.set(this,{writable:!0,value:void 0}),l(this,"_ports",void 0),l(this,"_showId",void 0),l(this,"_showValues",void 0),l(this,"_showCookie",void 0),l(this,"_showRadios",void 0),l(this,"_isDataLoaded",void 0),l(this,"_pbZonesDefault",void 0),l(this,"_lowerBound",void 0),l(this,"_upperBound",void 0),l(this,"_defencesFiltered",void 0),l(this,"_pbZonesFiltered",void 0),l(this,"_raidZonesFiltered",void 0),l(this,"_g",void 0),this._ports=t,function(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}}(this,h,d.find(t=>t.id===e).type),this._showId="show-zones",this._showValues=[{id:"pb-all",label:"All ports"},{id:"pb-single",label:"Single port"},{id:"raid-all",label:"All raid"},{id:"raid-single",label:"Single raid"},{id:"off",label:"Off"}],this._setupRadios(),this._showCookie=new r.a({id:this._showId,values:this._showValues.map(t=>t.id)}),this._showRadios=new n.a(this._showId,this._showValues.map(t=>t.id)),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(a.a)("#map").insert("g","#ports").attr("class","pb")}_setupRadios(){const t=Object(a.a)("#show-zones");for(const e of this._showValues){const i=t.append("div").attr("class","custom-control custom-radio custom-control-inline");i.append("input").attr("type","radio").attr("class","custom-control-input").attr("name","show-zones").attr("id","show-zones-"+e.id).attr("value",e.id),i.append("label").attr("type","radio").attr("class","custom-control-label").attr("for","show-zones-"+e.id).text(e.label)}}async _loadData(){try{this._pbZonesDefault=(await i.e(12).then(i.t.bind(null,"VihV",3))).default}catch(t){Object(s.g)(t)}}_setupListener(){var t;null===(t=document.querySelector("#"+this._showId))||void 0===t||t.addEventListener("change",t=>{this._showPBZonesSelected(),t.preventDefault()})}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","pb-zones");return e.append("path").attr("class","pb-join-circle").attr("d",t=>Object(o.g)(t.joinCircle[0],t.joinCircle[1],28).concat(Object(o.g)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","pb-circle").attr("d",t=>t.pbCircles.map(t=>Object(o.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text pb-circle-text").attr("x",t=>t.pbCircles.map(t=>t[0]).join(",")).attr("y",t=>t.pbCircles.map(t=>t[1]).join(",")).text(t=>t.pbCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),"PVP"===function(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}(this,h)&&(e.append("path").attr("class","raid-point").attr("d",t=>t.spawnPoints.map(t=>Object(o.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.spawnPoints.map(t=>t[0]).join(",")).attr("y",t=>t.spawnPoints.map(t=>t[1]).join(",")).text(t=>t.spawnPoints.map((t,e)=>String.fromCharCode(88+e)).join(""))),e}),this._g.selectAll("g.defence").data(this._defencesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","defence");return e.append("path").attr("class","fort").attr("d",t=>t.forts.map(t=>Object(o.i)(t[0],t[1],3)).join("")),e.append("text").attr("class","pb-text pb-fort-text").attr("x",t=>t.forts.map(t=>t[0]).join(",")).attr("y",t=>t.forts.map(t=>t[1]).join(",")).text(t=>t.forts.map((t,e)=>""+(e+1)).join("")),e.append("path").attr("class","tower").attr("d",t=>t.towers.map(t=>Object(o.g)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text pb-tower-text").attr("x",t=>t.towers.map(t=>t[0]).join(",")).attr("y",t=>t.towers.map(t=>t[1]).join(",")).text(t=>t.towers.map((t,e)=>""+(e+1)).join("")),e}),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","raid-zones");return e.append("path").attr("class","raid-join-circle").attr("d",t=>Object(o.g)(t.joinCircle[0],t.joinCircle[1],35)),e.append("path").attr("class","raid-circle").attr("d",t=>t.raidCircles.map(t=>Object(o.g)(t[0],t[1],4.5)).join("")),e.append("text").attr("class","pb-text raid-circle-text").attr("x",t=>t.raidCircles.map(t=>t[0]).join(",")).attr("y",t=>t.raidCircles.map(t=>t[1]).join(",")).text(t=>t.raidCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),e.append("path").attr("class","raid-point").attr("d",t=>t.raidPoints.map(t=>Object(o.g)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.raidPoints.map(t=>t[0]).join(",")).attr("y",t=>t.raidPoints.map(t=>t[1]).join(",")).text(t=>t.raidPoints.map((t,e)=>String.fromCharCode(49+e)).join("")),e})}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?this._isDataLoaded?this._filterVisible():this._loadData().then(()=>{this._isDataLoaded=!0,this._filterVisible()}):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]).filter(t=>this._isPortIn(t));this._defencesFiltered=t.map(t=>({id:t.id,forts:t.forts,towers:t.towers})),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map(t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints})),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map(t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints})))}setBounds(t,e){this._lowerBound=t,this._upperBound=e}refresh(){this._setData(),this._update()}}},p7uB:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},tN7d:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},vYjh:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},wffX:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},xp4X:function(t,e,i){i.r(e),function(t){i.d(e,"NAMap",(function(){return x}));i("WUlJ"),i("fCtr"),i("dbdZ");var a=i("NltA"),s=i("AKWm"),o=i("AWXE"),r=i("4k54"),n=i("2TRZ"),l=i("pOjD"),d=i("Q4du"),h=i("otg8"),c=i("dNoP"),p=i("m+OL"),u=i("1RyA"),_=i("1Gn1"),m=i("oyY5"),v=i("8KGH"),g=i("gQbg"),b=i("K2bk"),f=i("1Dm9"),w=i("7PF8"),y=i("X2Cj");function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class x{constructor(t,e){S(this,"coord",void 0),S(this,"f11",void 0),S(this,"gridOverlay",void 0),S(this,"height",0),S(this,"minScale",0),S(this,"rem",void 0),S(this,"serverName",void 0),S(this,"showGrid",void 0),S(this,"showTrades",void 0),S(this,"width",0),S(this,"xGridBackgroundHeight",void 0),S(this,"yGridBackgroundWidth",void 0),S(this,"_currentScale",0),S(this,"_currentTranslate",void 0),S(this,"_doubleClickAction",void 0),S(this,"_gMap",void 0),S(this,"_mainG",void 0),S(this,"_grid",void 0),S(this,"_journey",void 0),S(this,"_pbZone",void 0),S(this,"_ports",void 0),S(this,"_portSelect",void 0),S(this,"_showGrid",void 0),S(this,"_svg",void 0),S(this,"_zoom",void 0),S(this,"_zoomLevel",void 0),S(this,"_doubleClickActionCookie",void 0),S(this,"_doubleClickActionId",void 0),S(this,"_doubleClickActionRadios",void 0),S(this,"_doubleClickActionValues",void 0),S(this,"_labelZoomThreshold",void 0),S(this,"_maxScale",void 0),S(this,"_PBZoneZoomThreshold",void 0),S(this,"_searchParams",void 0),S(this,"_showGridCookie",void 0),S(this,"_showGridId",void 0),S(this,"_showGridRadios",void 0),S(this,"_showGridValues",void 0),S(this,"_tileSize",void 0),S(this,"_wheelDelta",void 0),this.serverName=t,this._searchParams=e,this.rem=h.i,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:y.b},this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new p.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new u.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new p.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new u.a(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener()}static _initModal(t){Object(d.k)({id:t,title:`${d.c} <span class="text-primary small">v${d.d}</span>`,size:"modal-lg"});s.a(`#${t} .modal-body`).html(`<p>${d.a} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/">Game-Labs forum post</a> for further details. Feedback is very welcome.</p>\n                    <p>Designed by iB aka Felix Victor, <em>Bastards</em> clan ${Object(c.d)("(BSTD)")}</a>.</p>\n                    <div class="alert alert-secondary" role="alert"><h5 class="alert-heading">Did you know?</h5><p class="mb-0">My clan mate, Aquillas, wrote a most comprehensive <a href="https://drive.google.com/file/d/1QzWugoYY6yi8K-mYIKUwn2iiUjNDWJ8E/view?usp=sharing">user guide</a>.</p></div>`)}static _stopProperty(){o.c.defaultPrevented&&o.c.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this.f11=new b.a(this,this.coord),this._ports=new v.a(this),await this._ports.init(),this._pbZone=new m.a(this._ports,this.serverName),this._grid=new _.a(this),this._portSelect=new g.a(this._ports,this._pbZone,this),this.showTrades=new f.a(this.serverName,this._portSelect,this.minScale,[this.coord.min,this.coord.min],[this.width,this.height]),await this.showTrades.showOrHide(),this._init(),this._journey=new w.a(this.rem)}_setupListener(){var t,e,i,a,s,o,r;this._svg.on("dblclick.zoom",null).on("click",x._stopProperty,!0).on("dblclick",(t,e,i)=>this._doDoubleClickAction(i[e])),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",()=>{Object(l.b)("Menu","Select port on property")}),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",()=>{Object(l.b)("Menu","Settings")}),null===(i=document.querySelector("#button-download-pb-calc"))||void 0===i||i.addEventListener("click",()=>{Object(l.b)("Tools","Download pb calculator")}),null===(a=document.querySelector("#reset"))||void 0===a||a.addEventListener("click",()=>{this._clearMap()}),null===(s=document.querySelector("#about"))||void 0===s||s.addEventListener("click",()=>{this._showAbout()}),null===(o=document.querySelector("#double-click-action"))||void 0===o||o.addEventListener("change",()=>this._doubleClickSelected()),null===(r=document.querySelector("#show-grid"))||void 0===r||r.addEventListener("change",()=>this._showGridSelected())}_setupScale(){this.minScale=Object(h.s)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this.minScale}_setupSvg(){this._zoom=n.a().wheelDelta(()=>-this._wheelDelta*Math.sign(o.c.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this.minScale,this.coord.min-this.xGridBackgroundHeight*this.minScale],[this.coord.max,this.coord.max]]).scaleExtent([this.minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this._svg=s.a("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").attr("class","map-tiles"),this._mainG=this._svg.append("g").attr("id","map")}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_displayMap(t){const{x:e,y:i,k:s}=t,o=Math.log2(this._tileSize),r=Math.log2(this.coord.max)-o,l=this.coord.max*s,d=this.width,c=this.height,p=Math.floor(l<d?d-2*e:l),u=Math.floor(l<c?c-2*i:l),_=Math.log2(s),m=Math.min(r,Math.ceil(Math.log2(Math.max(p,u)))-o),v=Math.round(10*(m-_-r))/10,g=this._wheelDelta**v,b=this._tileSize*g,f=l<d?e:0,w=l<c?i:0,y=a.a(Math.max(0,Math.floor((0-e)/b)),Math.max(0,Math.min(Math.ceil((d-e-f)/b),2**m))),S=a.a(Math.max(0,Math.floor((0-i)/b)),Math.max(0,Math.min(Math.ceil((c-i-w)/b),2**m))),x=[];for(const t of S)for(const e of y)x.push({z:m,row:t,col:e,id:`${m.toString()}-${t.toString()}-${e.toString()}`});const k=n.b.translate(e,i).scale(Object(h.u)(g));this._updateMap(x,k)}_updateMap(t,e){this._gMap.attr("transform",e.toString()).selectAll("image").data(t,t=>t.id).join(t=>t.append("image").attr("xlink:href",t=>`images/map/${t.z}/${t.row}/${t.col}.webp`).attr("x",t=>t.col*this._tileSize).attr("y",t=>t.row*this._tileSize).attr("width",this._tileSize+1).attr("height",this._tileSize+1))}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){const e="modal-about";document.querySelector("#"+e)||x._initModal(e),t("#"+e).modal("show")}_doDoubleClickAction(t){const e=r.a(t),i=n.c(t),[a,s]=e,{k:o,x:l,y:d}=i,h=(a-l)/o,c=(s-d)/o;"f11"===this._doubleClickAction?this.f11.printCoord(h,c):this._journey.plotCourse(h,c),this.zoomAndPan(h,c,1)}_setZoomLevelAndData(){o.c.transform.k!==this._currentScale&&(this._currentScale=o.c.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)}_getLowerBound(t){return t.invert([this.coord.min,this.coord.min])}_getUpperBound(t){return t.invert([this.width,this.height])}_getZoomTransform(){return this._currentTranslate={x:Math.floor(o.c.transform.x),y:Math.floor(o.c.transform.y)},n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(h.u)(o.c.transform.k))}_naZoomed(){const t=this._getZoomTransform(),e=this._getLowerBound(t),i=this._getUpperBound(t);this._ports.setBounds(e,i),this._pbZone.setBounds(e,i),this.showTrades.setBounds(e,i),this._displayMap(t),this._grid.transform(),this.showTrades.transform(t),this._mainG.attr("transform",t.toString()),this._setZoomLevelAndData()}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){var t;this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight(),null===(t=document.querySelector("#navbar-left"))||void 0===t||t.classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}resize(){const t=n.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update()}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight()}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style",`height:${e}px`)}initialZoomAndPan(){this._svg.call(this._zoom.scaleTo,this.minScale)}zoomAndPan(t,e,i){const a=n.b.scale(i).translate(Math.round(-t+this.width/2/i),Math.round(-e+this.height/2/i));this._svg.call(this._zoom.transform,a)}goToPort(){0===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)}}}.call(this,i("xeH2"))},"y+tX":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%2356430c' fill-opacity='.7' d='M438 411.3l-37.6-37.6c.1-.2.1-.2.1-.4 9.7-20.8 6.2-46.3-11-63.5L363 336.3l-80.5-80.5 96.6-96.6c24-24 37.5-56.6 37.5-90.5L256 229.3 95.4 68.7c0 34 13.5 66.5 37.5 90.5l96.6 96.6-80.5 80.5-26.5-26.5c-17.2 17.2-20.7 42.7-11 63.5.1.2.1.2.1.4L74 411.3c-7.3 7.3-7.3 19.2 0 26.5 7.3 7.3 19.2 7.3 26.5 0l37.6-37.6c.2.1.2.1.4.1 20.8 9.7 46.3 6.2 63.5-11l-26.5-26.5 80.5-80.5 80.5 80.5-26.5 26.6c17.2 17.2 42.7 20.7 63.5 11 .1-.1.2-.1.4-.1l37.6 37.6c7.3 7.3 19.2 7.3 26.5 0 7.3-7.4 7.3-19.3 0-26.6z'/%3E%3C/svg%3E"}}]);