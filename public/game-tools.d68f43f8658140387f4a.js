/*! For license information please see game-tools.d68f43f8658140387f4a.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[639],{4361:function(t,e,a){a.r(e),a.d(e,{init:function(){return na}});var i=a(2855),s=a(9022),n=a(27),o=a(2619),r=(a(6801),a(7424),a(4017)),l=(a(1936),a(2157)),d=a(7015),c=a(5923),h=a(4738),u=a(3609);function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class m{constructor(){p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_buildingData",void 0),this._baseName="List buildings",this._baseId="building-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._buildingData=[],this._setupListener()}async _loadAndSetupData(){try{this._buildingData=(await a.e(337).then(a.t.bind(a,374,19))).default}catch(t){(0,l.lo)(t)}}_setupListener(){let t=!0;document.querySelector("#"+this._buttonId).addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._buildingListSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=(0,r.Z)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return""+this._buildingData.sort((0,h.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}_setupSelect(){const t=u(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){const t=u(`#${this._baseId}-select`);t.addClass("selectpicker").on("change",(t=>this._buildingSelected(t))).selectpicker({noneSelectedText:"Select building"}),t.val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),u("#"+this._modalId).modal("show")}_getBuildingData(t){return this._buildingData.find((e=>e.name===t))}_getProductText(t){let e="";return t.result&&(t.result.length>1?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.result.map((t=>t.name)).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.result[0].name}</h5>`,t.result[0].price&&(e+='<table class="table table-sm card-table"><tbody>',e+=`<tr><td>${(0,c.PK)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm card-table"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td class="text-left">`,e+=a.materials.map((t=>`${(0,d.yI)(t.amount)} ${t.item}`)).join("<br>"),e+="</td>",e+=`<td>${(0,d.yI)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour cost (%)</th><th>Storage</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${(0,d.yI)(a.production)}</td><td>${(0,d.yI)(-100*a.labourDiscount)}</td><td>${(0,d.yI)(a.maxStorage)}</td><td>${(0,d.yI)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-5"><div class="card-header">Product</div>',a+='<div class="card-body product">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-7"><div class="card-header">Requirements</div>',a+='<div class="card-body px-0 requirements">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(t){const e=String(u(t.currentTarget).find(":selected").val());(0,r.Z)(`#${this._baseId} div`).remove(),(0,r.Z)("#"+this._baseId).append("div").classed("buildings mt-4",!0),(0,r.Z)(`#${this._baseId} div`).html(this._getText(e))}}a(8471);var _=a(3609);function b(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function f(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class w{constructor(){f(this,"_rows",{}),f(this,"_sortAscending",{}),f(this,"_sortIndex",{}),f(this,"_switchesSel",{}),f(this,"_tables",{}),f(this,"_groupOrder",["name","damage","penetration","generic","family"]),f(this,"_cannonData",{}),f(this,"_cannonDataDefault",{}),f(this,"_baseName",void 0),f(this,"_baseId",void 0),f(this,"_buttonId",void 0),f(this,"_checkboxId",void 0),f(this,"_modalId",void 0),f(this,"_header",void 0),this._baseName="List cannons",this._baseId="cannon-list",this._buttonId="button-"+this._baseId,this._checkboxId="checkbox-"+this._baseId,this._modalId="modal-"+this._baseId,this._header={group:new Map,element:new Set},this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(945).then(a.t.bind(a,2066,19))).default;this._setupData(t)}catch(t){(0,l.lo)(t)}}_getFormattedName(t){let e=t;const a=t.split(" "),i="c"+a[0].padStart(3,"0"),s=a[1]?a[1][1]:"0";return a.length>1&&(e=`${a[0]} <em>${a[1]}</em>`),{value:`${i}${s}`,formattedValue:e}}_setupData(t){const e=Object.entries(t.long[0]).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,a]of e)if("name"===t)this._header.group.set("",1),this._header.element.add("Lb");else if("family"!==t){this._header.group.set((0,l.fm)(t),Object.entries(a).length);for(const t of Object.keys(a))this._header.element.add((0,l.fm)(t))}for(const e of l.qg)this._cannonDataDefault[e]=t[e].map((t=>{const e=[],a=Object.entries(t).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,s]of a)if("name"===t)e.push(this._getFormattedName(s));else if("family"!==t)for(const[,t]of Object.entries(s)){var i;e.push({value:t.value,formattedValue:0===t.value?"":(0,d.QM)(t.value,null!==(i=t.digits)&&void 0!==i?i:0)})}return{family:t.family,data:e}}))}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._cannonListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const i=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t[e].value.localeCompare(a[e].value)*i:(t[e].value-a[e].value)*i))}_addNavPills(t){const e=t.append("ul").attr("class","nav nav-pills").attr("role","tablist");for(const[t,a]of l.qg.entries())e.append("li").attr("class","nav-item").attr("role","presentation").append("a").attr("class","nav-link"+(0===t?" active":"")).attr("id",`tab-${this._baseId}-${a}`).attr("href",`#tab-content-${this._baseId}-${a}`).attr("data-toggle","tab").attr("role","tab").attr("aria-controls",`${this._baseId}-${a}`).attr("aria-selected",""+(0===t?"true":"false")).text((0,l.fm)(a))}_injectSwitches(t,e){const a=t.append("div").attr("class","mb-3");for(const t of l.kK[e]){const i=a.append("div").attr("class","custom-control custom-switch custom-control-inline");i.append("input").attr("id",`${this._checkboxId}-${e}-${t}`).attr("name",`${this._checkboxId}-${e}`).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),i.append("label").attr("for",`${this._checkboxId}-${e}-${t}`).attr("class","custom-control-label").text((0,l.fm)(t))}this._switchesSel[e]=b(document.querySelectorAll(`input[name=${this._checkboxId}-${e}]`));for(const t of this._switchesSel[e])t.addEventListener("change",(t=>{t.preventDefault(),this._cannonFamilySelected(e)}))}_injectTableStructure(t,e){this._sortAscending[e]=!0,this._tables[e]=t.append("table").attr("class","table table-sm small na-table");const a=this._tables[e].append("thead");a.append("tr").attr("class","thead-group").selectAll("th").data(b(this._header.group)).join("th").classed("border-bottom-0",((t,e)=>0===e)).classed("text-center",((t,e)=>0!==e)).attr("colspan",(t=>""+t[1])).attr("scope","col").text((t=>t[0])),a.append("tr").selectAll("th").data(b(this._header.element)).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",((t,e)=>0===e)).classed("text-right",((t,e)=>0!==e)).text((t=>t.data)).on("click",((t,a)=>{this._sortRows(e,a.index)})),this._tables[e].append("tbody")}_insertTabContent(t,e,a){this._sortAscending[e]=!0;const i=t.append("div").attr("class","tab-pane fade"+(0===a?" show active":"")).attr("id",`tab-content-${this._baseId}-${e}`).attr("href",`#tab-content-${this._baseId}-${e}`).attr("role","tabpanel").attr("aria-labelledby",`${this._baseId}-${e}-tab`).append("div").attr("id",e+"-list");this._injectSwitches(i,e),this._injectTableStructure(i,e)}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=(0,r.Z)(`#${this._modalId} .modal-body`);this._addNavPills(t);const e=t.append("div").attr("class","tab-content pt-2");for(const[t,a]of l.qg.entries())this._sortIndex[a]=0,this._insertTabContent(e,a,t),this._cannonFamilySelected(a)}_initModal(){this._injectModal()}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._cannonData[t],(t=>t[0].formattedValue)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t.formattedValue))))}_cannonFamilySelected(t){const e=new Set;for(const a of this._switchesSel[t])if(a.checked){const i=a.id.replace(`${this._checkboxId}-${t}-`,"");e.add(i)}this._cannonData[t]=this._cannonDataDefault[t].filter((t=>e.has(t.family))).map((t=>t.data)),this._updateTable(t),this._sortRows(t,this._sortIndex[t],!1)}_cannonListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),_("#"+this._modalId).modal("show")}}a(3824);var g=a(1198),y=a(3609);function S(t){return function(t){if(Array.isArray(t))return I(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return I(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return I(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function $(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class M{constructor(){$(this,"_baseName",void 0),$(this,"_baseId",void 0),$(this,"_buttonId",void 0),$(this,"_modalId",void 0),$(this,"_moduleData",{}),$(this,"_ingredientData",{}),this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default,this._ingredientData=(await a.e(757).then(a.t.bind(a,7588,19))).default.ingredient}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._ingredientListSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName});(0,r.Z)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),y("#"+this._modalId).modal("show")}_getProperties(t){let e,a="",i="";for(const e of this._moduleData){const s=e[1].sort((0,h.MR)(["name"])).filter((e=>e.name===t));for(const t of s)a=e[0],i=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?(0,d.xp)(t.amount/100):(0,d.IH)(t.amount);return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return e=`<h6 class='text-muted text-left'>${a}</h6>`,e+=`<table class='table table-sm'><tbody>${i}</tbody></table>`,i?e:""}_getRows(){return this._ingredientData.map((t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map((t=>{const e=this._getProperties(t);return e?`<a data-toggle="tooltip" title="${e}">${t}</a>`:t})).join("<br>")}</td></tr>`))}_getText(){const t=this._getRows(),e=(0,g.xp)(t,2);let a="";for(const t of S(new Array(e.length).keys()))a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm na-table"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_injectList(){(0,r.Z)(`#${this._baseId} div`).remove(),(0,r.Z)("#"+this._baseId).append("div").classed("row",!0),(0,r.Z)(`#${this._baseId} div`).html(this._getText()),y('[data-toggle="tooltip"]').tooltip({html:!0,placement:"auto",sanitize:!1})}}var x=a(6400),k=a(5619),j=a(4332),A=a(3609);function D(t){return function(t){if(Array.isArray(t))return L(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return L(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return L(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function T(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function W(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}const O=k.Z.bind(x.h);var P=new WeakMap,E=new WeakMap,C=new WeakMap,N=new WeakMap,R=new WeakMap,Z=new WeakMap,q=new WeakMap,B=new WeakMap,K=new WeakMap,F=new WeakMap,z=new WeakMap,U=new WeakMap,H=new WeakMap;class Q{constructor(){P.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),R.set(this,{writable:!0,value:j.t}),Z.set(this,{writable:!0,value:""}),q.set(this,{writable:!0,value:{}}),B.set(this,{writable:!0,value:{}}),K.set(this,{writable:!0,value:0}),F.set(this,{writable:!0,value:void 0}),z.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),H.set(this,{writable:!0,value:void 0}),W(this,P,"List loot and chests"),W(this,E,"loot-list"),W(this,C,"button-"+T(this,E)),W(this,N,"modal-"+T(this,E));for(const t of T(this,R))T(this,q)[t]=`${T(this,E)}-${t}-select`;this._setupListener()}static _printAmount(t){return t.min===t.max?(0,d.yI)(t.min):`${(0,d.yI)(t.min)} to ${(0,d.yI)(t.max)}`}static _printChance(t){return(0,d.yI)(100*(1-t))}async _loadAndSetupData(){try{const t=(await a.e(393).then(a.t.bind(a,9628,19))).default;W(this,U,t.loot),W(this,H,t.chests)}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+T(this,C)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",T(this,P)),this._sourceListSelected()}))}_getLootOptions(){return O`
            ${T(this,U).sort((0,h.MR)(["name"])).map((t=>O`<option value="${t.id}">${t.name}</option>`))}
        `}_getChestsOptions(){return O`
            ${T(this,H).sort((0,h.MR)(["name"])).map((t=>O`<option value="${t.id}">${t.name}</option>`))}
        `}_getItemsOptions(){const t=new Map,e=(e,a,i)=>{const s=new Map([[e.id,{id:e.id,name:e.name,chance:i,amount:a.amount}]]);t.set(a.id,{name:a.name,sources:t.has(a.id)?new Map([].concat(D(t.get(a.id).sources),D(s))):s})};for(const t of T(this,U)){const{items:a}=t;for(const i of a)e(t,i,i.chance)}for(const t of T(this,H))for(const a of t.itemGroup){const{items:i}=a;for(const s of i)e(t,s,a.chance)}return W(this,z,new Map(D(t.entries()).sort(((t,e)=>t[1].name.localeCompare(e[1].name))))),O`${D(T(this,z)).map((t=>O`<option value="${t[0]}">${t[1].name}</option>`))}`}_getOptions(t){let e=O``;return"items"===t&&(e=this._getItemsOptions()),"chests"===t&&(e=this._getChestsOptions()),"loot"===t&&(e=this._getLootOptions()),e}_getModalBody(){return O`
            ${T(this,R).map((t=>O`
                        <label>
                            <select id="${T(this,q)[t]}" class="selectpicker">
                                ${this._getOptions(t)}
                            </select>
                        </label>
                    `))}
            <div id="${T(this,E)}"></div>
        `}_getModalFooter(){return O` <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> `}_injectModal(){(0,x.sY)((0,c.eb)({id:T(this,N),title:T(this,P),size:"modal-md",body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"))}_setupSelectListeners(){for(const t of T(this,R))T(this,B)[t].on("change",(()=>{W(this,Z,t),this._itemSelected()})).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select "+t,virtualScroll:!0})}_initModal(){this._injectModal(),W(this,F,document.querySelector("#"+T(this,E)));for(const t of T(this,R))T(this,B)[t]=A("#"+T(this,q)[t]);this._setupSelectListeners()}_sourceListSelected(){document.querySelector("#"+T(this,N))||this._initModal(),A("#"+T(this,N)).modal("show")}_getLootItemsText(t,e=!0){return O`
            <table class="table table-sm small na-table no-sort">
                <thead>
                    <tr>
                        <th scope="col">Item</th>
                        ${e?O`<th scope="col" class="text-right">Chance (0 − 100)</th>`:""}
                        <th scope="col" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map((t=>O`
                                <tr>
                                    <td>${t.name}</td>
                                    ${e?O` <td class="text-right">
                                              ${Q._printChance(t.chance)}
                                          </td>`:""}
                                    <td class="text-right">${Q._printAmount(t.amount)}</td>
                                </tr>
                            `))}
                </tbody>
            </table>
        `}_getSourceText(){const t=D(T(this,z).get(T(this,K)).sources).map((t=>t[1])).sort((0,h.MR)(["chance","name"]));return O`${this._getLootItemsText(t)}`}_getChestsText(){const t=T(this,H).find((t=>t.id===T(this,K)));return O`
            <p>Weight ${(0,d.yI)(t.weight)} tons<br />Lifetime ${(0,d.yI)(t.lifetime)} hours</p>
            ${t.itemGroup.map((t=>O` <h5>Group chance: ${Q._printChance(t.chance)}</h5>
                    ${this._getLootItemsText(t.items.sort((0,h.MR)(["name"])),!1)}`))}
        `}_getLootText(){const t=T(this,U).find((t=>t.id===T(this,K))).items.sort((0,h.MR)(["chance","name"]));return O`${this._getLootItemsText(t)}`}_getText(){return"items"===T(this,Z)?this._getSourceText():"chests"===T(this,Z)?this._getChestsText():this._getLootText()}_getTable(){return O` <div class="mt-4">${this._getText()}</div> `}_resetOtherSelects(){const t=T(this,R).filter((t=>t!==T(this,Z)));for(const e of t)T(this,B)[e].val("default").selectpicker("refresh")}_itemSelected(){const t=T(this,B)[T(this,Z)].find(":selected");W(this,K,Number(t.val())),this._resetOtherSelects(),(0,x.sY)(this._getTable(),T(this,F))}}var G=a(393),V=a(3609);function Y(t){return function(t){if(Array.isArray(t))return J(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return J(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return J(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function X(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class tt{constructor(){X(this,"_baseName",void 0),X(this,"_baseId",void 0),X(this,"_buttonId",void 0),X(this,"_modalId",void 0),X(this,"_moduleData",{}),this._baseName="List modules",this._baseId="module-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._moduleListSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=(0,r.Z)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId)}_getOptions(){return""+this._moduleData.map((t=>`<option value="${t[0]}"">${t[0]}</option>;`)).join("")}_setupSelect(){const t=V(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){V(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._moduleSelected(t))).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),V("#"+this._modalId).modal("show")}_getRows(t){const e=new Map([["L",`${(0,G.hi)(1)} – ${(0,G.hi)(3)}`],["M",`${(0,G.hi)(4)} – ${(0,G.hi)(5)}`],["S",`${(0,G.hi)(6)} – ${(0,G.hi)(7)}`]]),a=t=>{var a;return"U"===t?"":""+(null!==(a=e.get(t))&&void 0!==a?a:"")},i=(t,e)=>void 0!==e&&t.name===e.name&&JSON.stringify(t.properties)===JSON.stringify(e.properties);let s="";const n=[];for(const e of this._moduleData)e[0]===t&&e[1].sort((0,h.MR)(["name"])).forEach(((t,o)=>{s=a(t.moduleLevel),i(t,e[1][o+1])&&(e[1][o+1].hasSamePropertiesAsPrevious=!0,s+="<br>"+a(e[1][o+1].moduleLevel)),i(t,e[1][o+2])&&(e[1][o+2].hasSamePropertiesAsPrevious=!0,s=""),void 0!==t.hasSamePropertiesAsPrevious&&t.hasSamePropertiesAsPrevious||n.push(`<tr><td><span class="name">${t.name}<br>${s}</span></td><td>${t.properties.map((t=>{let e;return e=t.isPercentage?(0,d.xp)(t.amount/100):t.amount<1&&t.amount>0?(0,d.nM)(t.amount,1):(0,d.IH)(t.amount),`${t.modifier} ${e}`})).join("<br>")}</td></tr>`)}));return n}_getText(t){const e=this._getRows(t),a=(0,g.xp)(e,3);let i="";for(const t of Y(new Array(a.length).keys()))i+=`<div class="col-md-${Math.floor(12/a.length)}">`,i+='<table class="table table-sm small na-table"><thead>',i+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",i+=a[t].join(""),i+="</tbody></table></div>";return i}_moduleSelected(t){const e=V(t.currentTarget).find(":selected").val();(0,r.Z)(`#${this._baseId} div`).remove(),(0,r.Z)("#"+this._baseId).append("div").classed("row mt-4",!0),(0,r.Z)(`#${this._baseId} div`).html(this._getText(e))}}var et=a(7484),at=a.n(et),it=(a(9517),a(285)),st=a.n(it),nt=a(4110),ot=a.n(nt),rt=a(178),lt=a.n(rt),dt=a(3609);function ct(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function ht(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}at().extend(st()),at().extend(ot()),at().extend(lt()),at().locale("en-gb");var ut=new WeakMap,pt=new WeakMap,mt=new WeakMap,_t=new WeakMap,bt=new WeakMap,vt=new WeakMap,ft=new WeakMap,wt=new WeakMap,gt=new WeakMap,yt=new WeakMap,St=new WeakMap;class It{constructor(t){ut.set(this,{writable:!0,value:void 0}),pt.set(this,{writable:!0,value:void 0}),mt.set(this,{writable:!0,value:void 0}),_t.set(this,{writable:!0,value:void 0}),bt.set(this,{writable:!0,value:void 0}),vt.set(this,{writable:!0,value:void 0}),ft.set(this,{writable:!0,value:void 0}),wt.set(this,{writable:!0,value:{}}),gt.set(this,{writable:!0,value:!0}),yt.set(this,{writable:!0,value:0}),St.set(this,{writable:!0,value:{}}),ht(this,mt,t),ht(this,_t,"List of port battles"),ht(this,bt,"pb-list"),ht(this,vt,"button-"+ct(this,bt)),ht(this,ut,"table-"+ct(this,bt)),ht(this,ft,"modal-"+ct(this,bt)),this._setupListener()}async _loadAndSetupData(){try{const t=await(await fetch(`data/${ct(this,mt)}-pb.json`)).json();ht(this,pt,t.filter((t=>1===t.attackHostility)).map((t=>{var e,a,i,s;const n=at().utc(t.portBattle).local(),o=at().utc(t.portBattle),r=o===n?"":` (${n.format("H.mm")} local)`,d=null===(e=(0,l.$i)(t.nation))||void 0===e?void 0:e.name,c=t.capturer?`${null!=d?d:""} (${(0,g.Mo)(t.capturer)})`:null!=d?d:"";return{sort:null!==(a=t.portBattle)&&void 0!==a?a:"",data:[`${(0,l.fm)(o.fromNow())} at ${o.format("H.mm")} ${r}`,t.name,`${null!==(i=null==t?void 0:t.attackerNation)&&void 0!==i?i:""} (${(0,g.Mo)(null!==(s=null==t?void 0:t.attackerClan)&&void 0!==s?s:"")})`,c]}})))}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+ct(this,vt)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",ct(this,_t)),this._pbListSelected()}))}_sortRows(t,e=!0){e&&ct(this,yt)===t&&ht(this,gt,!ct(this,gt)),ht(this,yt,t);const a=ct(this,gt)?1:-1;ct(this,wt).sort(((e,i)=>0===t?e.sort.localeCompare(i.sort)*a:e.data[t].localeCompare(i.data[t])*a))}_initTable(){ct(this,St).append("thead").append("tr").selectAll("th").data(["Time","Port","Attacker","Defender"]).join("th").datum(((t,e)=>({data:t,index:e}))).attr("role","columnheader").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),ct(this,St).append("tbody")}_injectModal(){(0,s.Eu)({id:ct(this,ft),title:ct(this,_t),size:"modal-lg"});const t=(0,r.Z)(`#${ct(this,ft)} .modal-body`);ht(this,St,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){ht(this,wt,ct(this,St).select("tbody").selectAll("tr").data(ct(this,pt),(t=>t.sort)).join((t=>t.append("tr")))),ct(this,wt).selectAll("td").data((t=>t.data)).join((t=>t.append("td").html((t=>t))))}_pbListSelected(){document.querySelector("#"+ct(this,ft))||this._initModal(),dt("#"+ct(this,ft)).modal("show")}}var $t=a(155),Mt=a(3609);function xt(t){return function(t){if(Array.isArray(t))return kt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return kt(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return kt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kt(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function jt(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function At(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}var Dt=new WeakMap,Lt=new WeakMap,Tt=new WeakMap,Wt=new WeakMap,Ot=new WeakMap,Pt=new WeakMap,Et=new WeakMap,Ct=new WeakMap,Nt=new WeakMap,Rt=new WeakMap,Zt=new WeakMap,qt=new WeakMap,Bt=new WeakMap;class Kt{constructor(t){Dt.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:void 0}),Tt.set(this,{writable:!0,value:void 0}),Wt.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:{}}),Et.set(this,{writable:!0,value:{}}),Ct.set(this,{writable:!0,value:{}}),Nt.set(this,{writable:!0,value:{}}),Rt.set(this,{writable:!0,value:{}}),Zt.set(this,{writable:!0,value:!0}),qt.set(this,{writable:!0,value:0}),Bt.set(this,{writable:!0,value:{}}),At(this,Ot,t),At(this,Lt,"List port bonuses"),At(this,Dt,"port-bonus-list"),At(this,Tt,"button-"+jt(this,Dt)),At(this,Wt,"modal-"+jt(this,Dt)),this._setupListener()}async _loadData(){try{At(this,Pt,await(await fetch(`data/${jt(this,Ot)}-ports.json`)).json()),At(this,Ct,await(await fetch(`data/${jt(this,Ot)}-pb.json`)).json()),At(this,Et,(await a.e(462).then(a.t.bind(a,7640,19))).default)}catch(t){(0,l.lo)(t)}}_setupData(){const t=[0,1,3,7,15],e={};for(const t of j.y)e[t]=0;const a=new Map(jt(this,Et).map((t=>[t.id,{name:t.name,points:t.portPoints}]))),i=new Map(jt(this,Ct).map((t=>[t.id,t.nation])));At(this,Nt,jt(this,Pt).filter((t=>t.portBonus)).map((s=>{var n,o,r,d,c,h,u;return{id:s.id,name:null!==(n=null===(o=a.get(s.id))||void 0===o?void 0:o.name)&&void 0!==n?n:"",nation:null!==(r=null===(d=(0,l.$i)(null!==(c=i.get(s.id))&&void 0!==c?c:""))||void 0===d?void 0:d.name)&&void 0!==r?r:"",portBonusLevel:Object.values({...e,...s.portBonus}),points:null!==(h=null===(u=a.get(s.id))||void 0===u?void 0:u.points)&&void 0!==h?h:0,pointsInvested:(0,$t.Z)(Object.values(s.portBonus).map((e=>t[e])))}})))}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+jt(this,Tt)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",jt(this,Lt)),this._listSelected()}))}_sortRows(t,e=!0){e&&jt(this,qt)===t&&At(this,Zt,!jt(this,Zt)),At(this,qt,t);const a=jt(this,Zt)?1:-1;jt(this,Rt).sort(((e,i)=>0===t?e.name.localeCompare(i.name)*a:1===t?e.nation.localeCompare(i.nation)*a:7===t?(e.points-i.points)*a:8===t?(e.pointsInvested-i.pointsInvested)*a:(e.portBonusLevel[t-2]-i.portBonusLevel[t-2])*a))}_initTable(){At(this,Zt,!0),jt(this,Bt).append("thead").append("tr").selectAll("th").data(["Port","Nation"].concat(xt(j.y),["Port points","Points invested"])).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>e>1)).attr("role","columnheader").style("width",((t,e)=>e>2?"3rem":"")).text((t=>(0,l.fm)(t.data))).on("click",((t,e)=>{this._sortRows(e.index)})),jt(this,Bt).append("tbody")}_injectModal(){(0,s.Eu)({id:jt(this,Wt),title:jt(this,Lt),size:"modal-lg"});const t=(0,r.Z)(`#${jt(this,Wt)} .modal-body`);At(this,Bt,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){At(this,Rt,jt(this,Bt).select("tbody").selectAll("tr").data(jt(this,Nt),(t=>t.id)).join((t=>t.append("tr")))),jt(this,Rt).selectAll("td").data((t=>[t.name,t.nation].concat(xt(t.portBonusLevel),[t.points,t.pointsInvested]))).join((t=>t.append("td").classed("text-right",((t,e)=>e>1)).text((t=>0===t?"":String(t)))))}_listSelected(){document.querySelector("#"+jt(this,Wt))||this._initModal(),Mt("#"+jt(this,Wt)).modal("show")}}var Ft=a(1460),zt=a(3609);function Ut(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const Ht=(t,e,a)=>`${(0,G.hi)(e)} – ${(0,G.hi)(a)}`;class Qt{constructor(t){Ut(this,"_serverType",void 0),Ut(this,"_baseName",void 0),Ut(this,"_baseId",void 0),Ut(this,"_buttonId",void 0),Ut(this,"_modalId",void 0),Ut(this,"_moduleData",[]),Ut(this,"_recipeData",[]),Ut(this,"_recipes",void 0),this._serverType=Ft.c.find((e=>e.id===t)).type,this._baseName="List admiralty items and recipes",this._baseId="recipe-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(303).then(a.t.bind(a,7728,19))).default,this._recipeData=(await a.e(757).then(a.t.bind(a,7588,19))).default.recipe,this._recipes=new Map(this._recipeData.flatMap((t=>t.recipes.map((t=>[t.id,t])))))}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._recipeListSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=(0,r.Z)(`#${this._modalId} .modal-body`);e.append("select").attr("name",t).attr("id",t),e.append("label").attr("for",t).attr("class","text-muted pl-2").text("Items listed here may not be available in the game (yet)."),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return this._recipeData.map((t=>`<optgroup label="${t.group}">${t.recipes.filter((t=>"Any"===t.serverType||t.serverType===this._serverType)).sort((0,h.MR)(["name"])).map((t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,Ht)}`)).join("</option>")}`)).join("</optgroup>")}_setupSelect(){const t=zt(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){zt(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._recipeSelected(t))).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),zt("#"+this._modalId).modal("show")}_getRecipeData(t){return this._recipes.get(t)}_getRequirementText(t){let e='<table class="table table-sm card-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${(0,c.PK)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`<tr><td>${t.itemRequirements.map((t=>`${t.amount} ${t.name}`)).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",i="";for(const e of this._moduleData){const s=e[1].filter((e=>e.id===t.result.id));for(const t of s)[a]=e,i=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?(0,d.xp)(t.amount/100):t.amount;return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return i?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm card-table na-table"><tbody>${i}</tbody></table>`):e+=`<p>${(0,d.yI)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-6"><div class="card-header">Item</div>',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card col-6"><div class="card-header">Result</div>',a+='<div class="card-body">',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(t){const e=Number(zt(t.currentTarget).find(":selected").val());(0,r.Z)(`#${this._baseId} div`).remove(),(0,r.Z)("#"+this._baseId).append("div").classed("mt-4",!0),(0,r.Z)(`#${this._baseId} div`).html(this._getText(e))}}var Gt=a(3609);function Vt(t){return function(t){if(Array.isArray(t))return Yt(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Yt(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Yt(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function Jt(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function Xt(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}var te=new WeakMap,ee=new WeakMap,ae=new WeakMap,ie=new WeakMap,se=new WeakMap,ne=new WeakMap,oe=new WeakMap,re=new WeakMap,le=new WeakMap;class de{constructor(){te.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:void 0}),ae.set(this,{writable:!0,value:void 0}),ie.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:{}}),ne.set(this,{writable:!0,value:{}}),oe.set(this,{writable:!0,value:!0}),re.set(this,{writable:!0,value:0}),le.set(this,{writable:!0,value:{}}),Xt(this,te,"List ships"),Xt(this,ee,"ship-list"),Xt(this,ae,"button-"+Jt(this,ee)),Xt(this,ie,"modal-"+Jt(this,ee)),this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(228).then(a.t.bind(a,4237,19))).default.sort((0,h.MR)(["class","-battleRating","name"]));Xt(this,se,t.map((t=>[[t.class,String(t.class)],[t.name,(0,c.Y8)(t.name)],[t.guns.total,String(t.guns.total)],[t.battleRating,(0,d.yI)(t.battleRating)],[t.crew.max,(0,d.yI)(t.crew.max)],[t.ship.maxSpeed,(0,d.QM)(t.ship.maxSpeed)],[t.ship.turnSpeed,(0,d.QM)(t.ship.turnSpeed)],[t.guns.broadside.cannons,(0,d.yI)(t.guns.broadside.cannons)],[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4].amount?String(t.guns.gunsPerDeck[4].amount):""],[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5].amount?String(t.guns.gunsPerDeck[5].amount):""],[t.sides.armour,`${(0,d.yI)(t.sides.armour)} (${t.sides.thickness})`]])))}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+Jt(this,ae)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",Jt(this,te)),this._shipListSelected()}))}_sortRows(t,e=!0){e&&Jt(this,re)===t&&Xt(this,oe,!Jt(this,oe)),Xt(this,re,t);const a=Jt(this,oe)?1:-1;Jt(this,ne).sort(((e,i)=>1===t?e[t][0].localeCompare(i[t][0])*a:(e[t][0]-i[t][0])*a))}_initTable(){const t={group:new Map([["dummy1",5],["Speed",2],["dummy2",1],["Chasers",2],["dummy3",1]]),element:new Set(["Class","Name","Guns","Battle rating","Crew","Maximum","Turn","Broadside","Bow","Stern","Sides"])},e=Jt(this,le).append("thead");e.append("tr").attr("class","thead-group").selectAll("th").data(Vt(t.group)).join("th").classed("border-bottom-0",(t=>t[0].startsWith("dummy"))).classed("text-center",!0).attr("colspan",(t=>t[1])).attr("scope","col").text((t=>t[0].startsWith("dummy")?"":t[0])),e.append("tr").selectAll("th").data(Vt(t.element)).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",!0).classed("text-right",((t,e)=>1!==e)).text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),Jt(this,le).append("tbody")}_injectModal(){(0,s.Eu)({id:Jt(this,ie),title:Jt(this,te),size:"modal-lg"});const t=(0,r.Z)(`#${Jt(this,ie)} .modal-body`);Xt(this,le,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){Xt(this,ne,Jt(this,le).select("tbody").selectAll("tr").data(Jt(this,se),(t=>t[1][0])).join((t=>t.append("tr")))),Jt(this,ne).selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>1!==e)).html((t=>t[1]))))}_shipListSelected(){document.querySelector("#"+Jt(this,ie))||this._initModal(),Gt("#"+Jt(this,ie)).modal("show")}}var ce=a(3609);function he(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const ue=["Resources","Extra","Materials"];class pe{constructor(){he(this,"_baseName",void 0),he(this,"_baseId",void 0),he(this,"_buttonId",void 0),he(this,"_modalId",void 0),he(this,"_init",!0),he(this,"_blueprintData",{}),he(this,"_woodData",{}),he(this,"_extractionCosts",{}),he(this,"_craftingCosts",{}),he(this,"_blueprint",void 0),he(this,"_woodOptions",{}),he(this,"_defaultWood",void 0),he(this,"_woodsSelected",{}),he(this,"_blueprintList",void 0),he(this,"_currentBlueprint",{}),he(this,"_tables",{}),this._baseName="List ship blueprint",this._baseId="ship-blueprint-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._defaultWood={frame:"Fir",trim:"Crew Space"},this._setupListener()}async _loadAndSetupData(){try{this._blueprintData=(await a.e(263).then(a.t.bind(a,8041,19))).default,this._woodData=(await a.e(799).then(a.t.bind(a,7384,19))).default;const t=(await a.e(263).then(a.t.bind(a,5702,19))).default;this._extractionCosts=new Map(t.standard.map((t=>{var e;return[t.name,{reales:t.reales,labour:null!==(e=null==t?void 0:t.labour)&&void 0!==e?e:0}]}))),this._craftingCosts=new Map(t.seasoned.map((t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}])))}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._listSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName,size:"modal-lg"});const t=this._baseId+"-ship-select",e=(0,r.Z)(`#${this._modalId} .modal-body`);let a=e.append("div").classed("row no-gutters mb-2",!0);a.append("label").attr("for",t),a.append("select").attr("name",t).attr("id",t),a=e.append("div").classed("row no-gutters",!0);for(const t of l.Kf){const e=`${this._baseId}-${t}-select`;a.append("label").attr("for",e),a.append("select").attr("name",e).attr("id",e).classed("pr-2",!0)}this._blueprintList=e.append("div").attr("id",""+this._baseId).classed("blueprint mt-4",!0)}_getShipOptions(){return""+this._blueprintData.sort((0,h.MR)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}_setupShipSelect(){const t=ce(`#${this._baseId}-ship-select`),e=this._getShipOptions();t.append(e)}_setupWoodOptions(){const t=this._woodData.frame.sort((0,h.MR)(["name"])),e=this._woodData.trim.filter((t=>"Light"!==t.name)).sort((0,h.MR)(["name"]));this._woodOptions={frame:t.map((t=>`<option value="${t.name}">${t.name}</option>`)).join(""),trim:e.map((t=>`<option value="${t.name}">${t.name}</option>`)).join("")}}_setupWoodSelect(t,e){this._setupWoodOptions(),this._woodsSelected[t]=this._defaultWood[t],e.append(this._woodOptions[t]),e.attr("disabled","disabled")}_setupSelects(){this._setupShipSelect();for(const t of l.Kf){const e=ce(`#${this._baseId}-${t}-select`);this._setupWoodSelect(t,e)}}_setupShipSelectListener(){ce(`#${this._baseId}-ship-select`).addClass("selectpicker").on("change",(t=>this._blueprintSelected(t))).selectpicker({noneSelectedText:"Select blueprint",width:"fit"}).val("default").selectpicker("refresh")}_setupWoodSelectListener(t,e){e.addClass("selectpicker").on("change",(()=>this._woodSelected(t,e))).selectpicker({noneSelectedText:"Select "+t,width:"fit"}).val("default").selectpicker("refresh")}_setupSelectListener(){this._setupShipSelectListener();for(const t of l.Kf){const e=ce(`#${this._baseId}-${t}-select`);this._setupWoodSelectListener(t,e)}}_initModal(){this._injectModal(),this._setupSelects(),this._setupSelectListener()}_setWoodSelect(t){ce(`#${this._baseId}-${t}-select`).removeAttr("disabled").val(this._defaultWood[t]).selectpicker("refresh")}_woodSelected(t,e){this._woodsSelected[t]=e.val(),this._updateText()}_listSelected(){document.querySelector("#"+this._modalId)||this._initModal(),ce("#"+this._modalId).modal("show")}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join((t=>t.append("tr"))).selectAll("td").data((t=>t)).join((t=>t.append("td"))).html((t=>t))}_updateText(){let t=this._currentBlueprint.resources.map((t=>[t.name,t.amount])),e=!1,a=!1,i=0,s=0;if("Crew Space"===this._woodsSelected.trim){const e=this._currentBlueprint.wood.find((t=>"Crew Space"===t.name)).amount,a=t.findIndex((t=>"Hemp"===t[0]));t[a][1]=t[a][1]+e}else if(s=this._currentBlueprint.wood.find((t=>"Planking"===t.name)).amount,this._woodsSelected.trim===this._woodsSelected.frame)i+=s;else{const e=t.findIndex((t=>t[0]===this._woodsSelected.trim));e>=0?t[e][1]=t[e][1]+s:(a=!0,t.push([this._woodsSelected.trim,s]))}i+=this._currentBlueprint.wood.find((t=>"Frame"===t.name)).amount;const n=t.findIndex((t=>t[0]===this._woodsSelected.frame));if(n>=0?t[n][1]=t[n][1]+i:(e=!0,t.push([this._woodsSelected.frame,i])),e&&a){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let o=[];this._currentBlueprint.price&&o.push(["Reales",this._currentBlueprint.price]),o.push(["Provisions",this._currentBlueprint.provisions]),this._currentBlueprint.permit&&o.push(["Permit",this._currentBlueprint.permit]),o.push(["Craft level",this._currentBlueprint.craftLevel],["Shipyard level",this._currentBlueprint.shipyardLevel],["Labour hours",this._currentBlueprint.labourHours],["Craft experience",this._currentBlueprint.craftXP]);const r=[];let c=0,h=0;const u=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.reales)&&void 0!==e?e:0)*t[1]},p=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.labour)&&void 0!==e?e:0)*t[1]},m=t=>{for(const e of t.filter((t=>this._extractionCosts.has(t[0]))))c+=u(e),h+=p(e)};m(t),m(o),c&&r.push(["Reales",(0,d.yI)(c)],["Labour hours",(0,d.yI)(h)]);let _=0,b=0,v=0,f=0;for(const t of l.Kf){const e=this._craftingCosts.get(this._woodsSelected[t]);var w,g,y,S;if(e)_+=(null!==(w=e.reales)&&void 0!==w?w:0)*i,b+=(null!==(g=e.labour)&&void 0!==g?g:0)*i,v+=(null!==(y=e.doubloon)&&void 0!==y?y:0)*i,f+=(null!==(S=e.tool)&&void 0!==S?S:0)*i}_&&r.push(["(S) reales",(0,d.yI)(_)]),b&&r.push(["(S) labour hours",(0,d.yI)(b)]),v&&r.push(["(S) doubloons",(0,d.yI)(v)]),f&&r.push(["(S) tools",(0,d.yI)(f)]),t=t.map((t=>[t[0],(0,d.yI)(t[1])])),o=o.map((t=>[t[0],(0,d.yI)(t[1])])),this._updateTable(this._tables.Resources,t),this._updateTable(this._tables.Extra,o),this._updateTable(this._tables.Materials,r)}_blueprintSelected(t){if(this._init){this._init=!1;for(const t of l.Kf)this._setWoodSelect(t);const t=this._blueprintList.append("div").classed("card-deck",!0),e=e=>{const a=t.append("div").classed("card",!0);a.append("div").classed("card-header",!0).text(e);const i=a.append("div").classed("card-body",!0);this._tables[e]=i.append("table").classed("table table-sm card-table",!0),this._tables[e].append("thead"),this._tables[e].append("tbody")};for(const t of ue)e(t)}this._blueprint=ce(t.currentTarget).find(":selected").val(),this._currentBlueprint=this._getBlueprintData(this._blueprint),this._updateText()}_getBlueprintData(t){return this._blueprintData.find((e=>e.name===t))}}var me=a(3609);function _e(t){return function(t){if(Array.isArray(t))return be(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return be(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return be(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function ve(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class fe{constructor(){ve(this,"_modifiers",{}),ve(this,"_rows",{}),ve(this,"_sortAscending",{}),ve(this,"_sortIndex",{}),ve(this,"_switchesSel",void 0),ve(this,"_tables",{}),ve(this,"_woodData",{}),ve(this,"_woodDataDefault",{}),ve(this,"_baseId",void 0),ve(this,"_baseName",void 0),ve(this,"_buttonId",void 0),ve(this,"_checkboxId",void 0),ve(this,"_modalId",void 0),ve(this,"_modifiersNotUsed",new Set(["Ship material","Boarding morale"])),this._baseName="List woods",this._baseId="wood-list",this._buttonId="button-"+this._baseId,this._checkboxId="checkbox-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}_getModifiers(t){const e=new Set;return this._woodDataDefault[t].forEach((t=>{t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).forEach((t=>{e.add(t.modifier)}))})),_e(e).sort(h.I4)}async _loadData(){try{this._woodDataDefault=(await a.e(799).then(a.t.bind(a,7384,19))).default}catch(t){(0,l.lo)(t)}}_setupData(){for(const t of l.Kf)this._modifiers[t]=new Set(this._getModifiers(t)),this._woodDataDefault[t].forEach((e=>{const a=new Set(e.properties.map((t=>t.modifier)));for(const i of this._modifiers[t])a.has(i)||e.properties.push({modifier:i,amount:0,isPercentage:!1});e.properties.sort(((t,e)=>t.modifier.localeCompare(e.modifier)))}));this._woodData={...this._woodDataDefault}}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._woodListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const i=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t.name.localeCompare(a.name)*i:(t.properties[e-1].amount-a.properties[e-1].amount)*i))}_initTable(t){this._sortAscending[t]=!0,this._tables[t].append("thead").append("tr").selectAll("th").data(["Wood"].concat(_e(this._modifiers[t]))).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>0!==e)).attr("role","columnheader").text((t=>t.data)).on("click",((e,a)=>{this._sortRows(t,a.index)})),this._tables[t].append("tbody")}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=(0,r.Z)(`#${this._modalId} .modal-body`),e=t.append("div").attr("class","mb-3");for(const t of l.pe){const a=e.append("div").attr("class","custom-control custom-switch custom-control-inline");a.append("input").attr("id",`${this._checkboxId}-${t}`).attr("name",""+this._checkboxId).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),a.append("label").attr("for",`${this._checkboxId}-${t}`).attr("class","custom-control-label").text((0,l.fm)(t))}this._switchesSel=_e(document.querySelectorAll(`input[name=${this._checkboxId}]`));for(const t of this._switchesSel)t.addEventListener("change",(t=>{t.preventDefault(),this._woodFamilySelected()}));for(const e of l.Kf)t.append("h5").text((0,l.fm)(e+"s")),this._tables[e]=t.append("table").attr("class","table table-sm small na-table"),this._initTable(e),this._updateTable(e),this._sortRows(e,0,!1)}_initModal(){this._injectModal()}_getFormattedAmount(t){let e;return e="Repair amount"===t.modifier&&t.amount?(0,d.nM)(t.amount,1):t.amount?(0,d.QM)(t.amount):"",e}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._woodData[t],(t=>t.id)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>[t.name].concat(_e(t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).map((t=>this._getFormattedAmount(t))))))).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t))))}_woodFamilySelected(){const t=new Set;for(const e of this._switchesSel)if(e.checked){const a=e.id.replace(this._checkboxId+"-","");t.add(a)}for(const e of l.Kf)this._woodData[e]=this._woodDataDefault[e].filter((e=>t.has(e.family))),this._updateTable(e),this._sortRows(e,this._sortIndex[e],!1)}_woodListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),me("#"+this._modalId).modal("show")}}var we=a(3657),ge=a(7290),ye=a(7603),Se=a(289),Ie=a(9714),$e=a(7622),Me=a(8823),xe=a(3609);function ke(t){return function(t){if(Array.isArray(t))return je(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return je(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return je(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function je(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=new Array(e);a<e;a++)i[a]=t[a];return i}function Ae(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function De(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}return a}var Le=new WeakMap,Te=new WeakMap,We=new WeakMap,Oe=new WeakMap,Pe=new WeakMap,Ee=new WeakMap,Ce=new WeakMap,Ne=new WeakMap,Re=new WeakMap,Ze=new WeakMap,qe=new WeakMap,Be=new WeakMap,Ke=new WeakMap,Fe=new WeakMap;class ze{constructor(t){Le.set(this,{writable:!0,value:0}),Te.set(this,{writable:!0,value:0}),We.set(this,{writable:!0,value:{}}),Oe.set(this,{writable:!0,value:{}}),Pe.set(this,{writable:!0,value:{}}),Ee.set(this,{writable:!0,value:{}}),Ce.set(this,{writable:!0,value:{}}),Ne.set(this,{writable:!0,value:void 0}),Re.set(this,{writable:!0,value:void 0}),Ze.set(this,{writable:!0,value:void 0}),qe.set(this,{writable:!0,value:void 0}),Be.set(this,{writable:!0,value:void 0}),Ke.set(this,{writable:!0,value:void 0}),Fe.set(this,{writable:!0,value:{}}),De(this,Ne,t),De(this,Re,"Port net income"),De(this,Ze,"income-list"),De(this,qe,"button-"+Ae(this,Ze)),De(this,Be,"modal-"+Ae(this,Ze)),De(this,Ke,(0,ye.Z)().range(s.q4)),this._setupListener()}static _hideDetails(){xe(this).tooltip("dispose")}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){var t;return null!==(t=Math.floor(Ae(this,Pe).node().offsetWidth))&&void 0!==t?t:0}_setupData(t){var e,a;const i=t.ports.map((e=>{var a,i;const s=null!==(a=t.server.find((t=>t.id===e.id)))&&void 0!==a?a:{},n=null!==(i=t.pb.find((t=>t.id===e.id)))&&void 0!==i?i:{};return{...e,...s,...n}})),s=null!==(e=(0,$e.Z)(i,(t=>t.netIncome)))&&void 0!==e?e:0,n=null!==(a=(0,Me.Z)(i,(t=>t.netIncome)))&&void 0!==a?a:0;De(this,Fe,(0,Se.Z)().domain([s,n]).range([8,48]).clamp(!0));const o=new Set(["NT","FT"]),r=new Set,d=[].concat(ke(i.filter((t=>t.netIncome>0&&!o.has(t.nation))).map((t=>{var e;return r.add(t.nation),{id:t.name,value:t.netIncome,parentId:null===(e=(0,l.$i)(t.nation))||void 0===e?void 0:e.sortName}}))),ke(l.nU.filter((t=>r.has(t.short))).map((t=>({id:t.sortName,value:0,parentId:"World"})))),[{id:"World",value:0,parentId:void 0}]);De(this,We,(0,we.Z)()(d)),De(this,Oe,(0,ge.ZP)(Ae(this,We)).sum((t=>t.data.value)))}async _loadData(){const t=[{fileName:Ae(this,Ne)+"-ports.json",name:"server"},{fileName:Ae(this,Ne)+"-pb.json",name:"pb"}],e={};try{e.ports=(await a.e(462).then(a.t.bind(a,7640,19))).default,await(async t=>{for await(const a of t)e[a.name]=await(await fetch("data/"+a.fileName)).json()})(t)}catch(t){(0,l.lo)(t)}return e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+Ae(this,qe)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",Ae(this,Re)),this._incomeListSelected()}))}_drawLegends(){var t;const e=Math.floor(32.36),a=Math.floor(3.236),i=Math.floor(16.18),s=(null!==(t=Ae(this,Oe).children)&&void 0!==t?t:[]).sort(((t,e)=>e.value-t.value)),n=s.length*(190+i),o=Math.ceil(n/Ae(this,Te)),r=s.length/o,l=Math.floor(Ae(this,Te)/r-i);Ae(this,Pe).append("div").attr("class","d-flex flex-wrap justify-content-between mt-3").selectAll(".legend").data(s).join((t=>{const s=t.append("div").attr("class","mt-3"),n=s.append("svg").attr("class","svg-text").attr("width",l).attr("height",2*e+a);return n.append("rect").attr("width",l).attr("height",e).style("fill",(t=>Ae(this,Ke).call(this,t.data.id))),n.append("text").attr("x",i).attr("y","25%").text((t=>t.data.id)).style("fill",(t=>(0,c.IF)(Ae(this,Ke).call(this,t.data.id)))),n.append("rect").attr("class","rect-background").attr("y",e+a).attr("width",l).attr("height",e).style("fill",(t=>Ae(this,Ke).call(this,t.data.id))),n.append("rect").attr("y",e+a).attr("width",(t=>{var e;return l*(t.value/(null===(e=t.parent)||void 0===e?void 0:e.value))})).attr("height",e).style("fill",(t=>Ae(this,Ke).call(this,t.data.id))),n.append("text").attr("x",l-i).attr("y","75%").html((t=>(0,d.Dw)(t.value,!0))).style("text-anchor","end"),s}))}_showDetails(t,e){var a,i,s,n;const o=`\n            <div class="d-flex justify-content-between align-items-center">\n            <div class="d-flex flex-column text-left mt-1 mr-3 p-0">\n                <div><span class="x-large">${e.data.id}</span><br />${null===(a=e.parent)||void 0===a?void 0:a.data.id}</div>\n            </div>\n            <div class="d-flex flex-column text-left mt-1 p-0">\n                <div class="mr-3">\n                    ${(0,d.Dw)(e.data.data.value)}<br />\n                    <span class="des">Port</span>\n                </div>\n                <div class="mr-3">\n                    ${(0,d.me)(e.data.data.value/(null===(i=e.parent)||void 0===i?void 0:i.value))}<br />\n                    <span class="des">Nation</span>\n                </div>\n                <div class="mr-3">\n                    ${(0,d.me)(e.data.data.value/(null===(s=e.parent)||void 0===s||null===(n=s.parent)||void 0===n?void 0:n.value))}<br />\n                    <span class="des">World</span>\n                </div>\n            </div>\n            </div>`;xe(t.currentTarget).tooltip("dispose").tooltip({html:!0,template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-smaller"></div></div>',title:o,sanitize:!1}).tooltip("show")}_drawTreemap(){const t=Ae(this,Oe).leaves();Ae(this,Ee).append("g").attr("class","cells").selectAll(".cell").data(t).join((t=>t.append("path").attr("class","cell").attr("d",(t=>`M${t.polygon.join(",")}z`)).style("fill",(t=>{var e;return Ae(this,Ke).call(this,null===(e=t.parent)||void 0===e?void 0:e.data.id)}))));const e=Ae(this,Ee).append("g").attr("class","labels").selectAll(".label").data(t).join((t=>t.append("g").attr("class","label").attr("transform",(t=>`translate(${t.polygon.site.x},${t.polygon.site.y})`)).style("font-size",(t=>Ae(this,Fe).call(this,t.data.data.value)+"px")).style("fill",(t=>{var e;return(0,c.IF)(Ae(this,Ke).call(this,null===(e=t.parent)||void 0===e?void 0:e.data.id))}))));e.append("text").attr("class","name").text((t=>t.data.data.id)),e.append("text").attr("class","value").html((t=>(0,d.Pj)(t.data.data.value,!0))),Ae(this,Ee).append("g").selectAll(".hoverer").data(t).join((t=>t.append("path").attr("class","hoverer").attr("d",(t=>`M${t.polygon.join(",")}z`)).on("mouseover",((t,e)=>this._showDetails(t,e))).on("mouseleave",ze._hideDetails)))}_initTreemap(){De(this,Le,ze.getHeight()),De(this,Te,this._getWidth()),De(this,Ce,Ae(this,Pe).append("svg").attr("class","voronoi").attr("width",Ae(this,Te)).attr("height",Ae(this,Le))),De(this,Ee,Ae(this,Ce).append("g").attr("class","drawingArea")),(0,Ie.voronoiTreemap)().clip([[0,0],[0,Ae(this,Le)],[Ae(this,Te),Ae(this,Le)],[Ae(this,Te),0]]).minWeightRatio(1e-10)(Ae(this,Oe))}_injectModal(){(0,s.Eu)({id:Ae(this,Be),title:Ae(this,Re)});const t=(0,r.Z)(`#${Ae(this,Be)} .modal-body`);De(this,Pe,t.append("div").attr("id",""+Ae(this,Ze)))}_initModal(){this._injectModal()}_incomeListSelected(){let t=!1;document.querySelector("#"+Ae(this,Be))||(t=!0,this._initModal()),xe("#"+Ae(this,Be)).on("shown.bs.modal",(()=>{t&&(t=!1,this._initTreemap(),this._drawTreemap(),this._drawLegends())})).modal("show")}}var Ue=a(1316),He=a(3865),Qe=a(604),Ge=a(2461),Ve=a(7658),Ye=a(9766),Je=a(7633),Xe=a(7829),ta=a(3609);function ea(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function aa(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}var ia=new WeakMap;class sa{constructor(t){ia.set(this,{writable:!0,value:void 0}),ea(this,"_baseName",void 0),ea(this,"_baseId",void 0),ea(this,"_buttonId",void 0),ea(this,"_modalId",void 0),ea(this,"_ownershipData",{}),ea(this,"_nationData",{}),ea(this,"_colourScale",void 0),ea(this,"_mainDiv",void 0),ea(this,"_div",void 0),ea(this,"_svg",void 0),function(t,e,a){var i=e.get(t);if(!i)throw new TypeError("attempted to set private field on non-instance");if(i.set)i.set.call(t,a);else{if(!i.writable)throw new TypeError("attempted to set read only private field");i.value=a}}(this,ia,t),this._baseName="Port ownership",this._baseId="ownership-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._colourScale=(0,ye.Z)().range(s.q4),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){var t;return null!==(t=Math.floor(this._mainDiv.node().offsetWidth))&&void 0!==t?t:0}async _loadAndSetupData(){try{this._nationData=await(await fetch(`data/${aa(this,ia)}-nation.json`)).json(),this._ownershipData=await(await fetch(`data/${aa(this,ia)}-ownership.json`)).json()}catch(t){(0,l.lo)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,i.KS)("Tools",this._baseName),this._ownershipListSelected()}))}_injectModal(){(0,s.Eu)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=(0,r.Z)(`#${this._modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t),this._mainDiv=e.append("div").attr("id",""+this._baseId),this._div=this._mainDiv.append("div"),this._svg=this._mainDiv.append("svg").attr("class","area")}_getOptions(){return""+this._ownershipData.map((t=>`<option value="${t.region}">${t.region}</option>;`)).join("")}_setupSelect(){const t=ta(`#${this._baseId}-select`),e=this._getOptions();t.append(e)}_setupSelectListener(){ta(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._regionSelected(t))).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let t=!1;document.querySelector("#"+this._modalId)||(t=!0,this._initModal()),ta("#"+this._modalId).on("shown.bs.modal",(()=>{t&&(this._injectArea(),t=!1)})).modal("show")}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,sa.getHeight()),a=32,i=32,s=32,n=l.nU.filter((t=>9!==t.id)).map((t=>t.short)),o=this._nationData;o.keys=n;const r=(0,Ve.Z)().offset(Ye.Z).keys(n)(o);this._svg.attr("width",t).attr("height",e),(()=>{const d=(()=>{const n=(0,Se.Z)().domain((0,He.Z)(o,(t=>new Date(t.date)))).range([s,t-a]),l=(0,Se.Z)().domain([(0,$e.Z)(r[0],(t=>t[0])),(0,Me.Z)(r[r.length-1],(t=>t[1]))]).range([e-i,0]);return(0,Je.Z)().x((t=>{var e;return null!==(e=n(new Date(t.data.date)))&&void 0!==e?e:0})).y0((t=>{var e;return null!==(e=l(t[0]))&&void 0!==e?e:0})).y1((t=>{var e;return null!==(e=l(t[1]))&&void 0!==e?e:0})).curve(Xe.ZP)})(),h=new Map(l.nU.map((t=>[t.short,t.name])));this._colourScale.domain(n),this._svg.selectAll("path").data(r).join((t=>t.append("path").attr("fill",(t=>this._colourScale(t.key))).attr("stroke",(t=>this._colourScale(t.key))).attr("d",d))),this._svg.selectAll(".area-label").data(r).join((t=>t.append("text").attr("class","area-label").text((t=>h.get(t.key))).attr("fill",(t=>(0,c.IF)(this._colourScale(t.key)))).attr("transform",(0,Ue.areaLabel)(d))))})(),this._svg.append("g").call((n=>{const r=(0,Ge.Z)().domain((0,He.Z)(o,(t=>new Date(t.date)))).range([s,t-a]);n.attr("transform",`translate(0,${e-i})`).call((0,Qe.LL)(r).ticks(t/80).tickSizeOuter(0)),n.attr("font-size",".8rem").attr("font-family","")}))}async _injectChart(t){(await Promise.all([a.e(821),a.e(782)]).then(a.bind(a,6356))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(t){const e=ta(t.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const a=this._ownershipData.filter((t=>t.region===e)).map((t=>t.data))[0];this._injectChart(a)}}const na=(t,e)=>{const a=new n.qn("ship-compare");(()=>{if(e.has("cmp")&&e.has("v")){const t=e.get("v");t&&t.split(".")[0]===s.f4.split(".")[0]&&((0,i.KS)("Menu","Paste ship compare"),a.initFromClipboard(e))}})(),new o.Z("wood"),new fe,new m,new w,new M,new Q,new tt,new It(t),new Kt(t),new Qt(t),new de,new pe,new ze(t),new sa(t)}}}]);