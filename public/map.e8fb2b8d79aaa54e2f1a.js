/*! For license information please see map.e8fb2b8d79aaa54e2f1a.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[842],{605:(t,e,i)=>{i.r(e),i.d(e,{NAMap:()=>xc});var a=i(3838),s=i(3466),n=i(8457),r=i(2855),o=i(393),l=i(9949),h=i(3389),d=i(4752),c=i(9937),u=i(7015);function p(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function w(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,m(t,e,"get"))}function v(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,m(t,e,"set"),i),i}function m(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var g=new WeakMap,f=new WeakMap,_=new WeakMap,b=new WeakMap,y=new WeakMap,k=new WeakMap,M=new WeakMap,S=new WeakMap,W=new WeakMap,T=new WeakMap,x=new WeakMap,$=new WeakMap,D=new WeakMap,P=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap,E=new WeakMap,Z=new WeakMap;class N{constructor(t){p(this,g,{writable:!0,value:void 0}),p(this,f,{writable:!0,value:!1}),p(this,_,{writable:!0,value:void 0}),p(this,b,{writable:!0,value:void 0}),p(this,y,{writable:!0,value:void 0}),p(this,k,{writable:!0,value:void 0}),p(this,M,{writable:!0,value:void 0}),p(this,S,{writable:!0,value:void 0}),p(this,W,{writable:!0,value:void 0}),p(this,T,{writable:!0,value:void 0}),p(this,x,{writable:!0,value:void 0}),p(this,$,{writable:!0,value:void 0}),p(this,D,{writable:!0,value:void 0}),p(this,P,{writable:!0,value:void 0}),p(this,C,{writable:!0,value:void 0}),p(this,I,{writable:!0,value:void 0}),p(this,L,{writable:!0,value:void 0}),p(this,E,{writable:!0,value:void 0}),p(this,Z,{writable:!0,value:void 0}),v(this,_,t),v(this,g,"on"===w(this,_).showGrid),v(this,b,w(this,_).coord.min),v(this,y,w(this,_).coord.max),v(this,k,w(this,_).height),v(this,M,w(this,_).width),v(this,S,w(this,_).rem),v(this,W,w(this,_).xGridBackgroundHeight),v(this,T,w(this,_).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){v(this,x,(0,c.Z)().clamp(!0).domain([(0,o.IK)(w(this,b),w(this,b)),(0,o.IK)(w(this,y),w(this,y))]).range([w(this,b),w(this,y)])),v(this,$,(0,c.Z)().clamp(!0).domain([(0,o.pw)(w(this,b),w(this,b)),(0,o.pw)(w(this,y),w(this,y))]).range([w(this,b),w(this,y)]))}_setupAxis(){const t=this._getTicks(65);v(this,D,(0,d.LL)(w(this,x)).tickFormat((t=>(0,u.Hu)(t))).tickValues(t).tickSize(w(this,y))),v(this,P,(0,d.Kh)(w(this,$)).tickFormat((t=>(0,u.Hu)(t))).tickValues(t).tickSize(w(this,y)));const e=(0,a.Z)("#map");v(this,I,e.insert("g","g.pb").attr("class","axis d-none")),v(this,E,w(this,I).append("g")),v(this,L,e.insert("g","g.pb").attr("class","axis d-none")),v(this,Z,w(this,L).append("g")),this._displayAxis(void 0),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round((0,o.pw)(w(this,b),w(this,b))),i=Math.round((0,o.pw)(w(this,y),w(this,y))),a=(i-e)/(t-1),s=[];for(let t=a;t<i;t+=a)s.push(Math.round(t));s.push(i);const n=[...s].reverse().map((t=>-t));return n.push(0),[...n,...s]}_setupXAxis(){w(this,E).selectAll(".tick text").attr("dx","-0.3rem").attr("dy","2rem"),w(this,E).attr("font-family","inherit")}_setupYAxis(){w(this,Z).attr("font-family","inherit"),w(this,Z).selectAll(".tick text").attr("dx","3.5rem").attr("dy","-.5rem")}_displayAxis(t){const e=t?t.k:1,i=(0,o.qY)(w(this,S)/e),a=(0,o.qY)(1/e),s=t?t.y:0,n=s/e<w(this,M)?s/e:0,r=-w(this,y)-n,l=t?t.x:0,h=l/e<w(this,k)?l/e:0,d=-w(this,y)-h;w(this,E).attr("font-size",i).attr("stroke-width",a).call(w(this,D).tickPadding(r)),w(this,Z).attr("font-size",i).attr("stroke-width",a).call(w(this,P).tickPadding(d))}get show(){return w(this,g)}set show(t){v(this,g,t)}get zoomLevel(){return w(this,C)}set zoomLevel(t){v(this,C,t)}update(){let t=!1;w(this,g)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),w(this,f)&&this.gridToggle(t)}transform(t){w(this,g)&&(this.testForInitialisation(),this._displayAxis(t))}gridToggle(t){w(this,_).gridOverlay.classList.toggle("overlay-grid",t),w(this,_).gridOverlay.classList.toggle("overlay-no-grid",!t),w(this,I).classed("d-none",!t),w(this,L).classed("d-none",!t)}testForInitialisation(){w(this,f)||(this._setupSvg(),v(this,f,!0))}}var A=i(1460),j=i(1198),z=i(4194);function B(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function F(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function R(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,G(t,e,"get"))}function V(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,G(t,e,"set"),i),i}function G(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var q=new WeakMap,H=new WeakMap,O=new WeakMap,Y=new WeakMap,K=new WeakMap;class U{constructor(t,e){F(this,q,{writable:!0,value:12}),F(this,H,{writable:!0,value:10}),B(this,"showPB",void 0),F(this,O,{writable:!0,value:void 0}),F(this,Y,{writable:!0,value:{}}),F(this,K,{writable:!0,value:{}}),B(this,"_ports",void 0),B(this,"_showId",void 0),B(this,"_showValues",void 0),B(this,"_showCookie",void 0),B(this,"_showRadios",void 0),B(this,"_isDataLoaded",void 0),B(this,"_pbZonesDefault",void 0),B(this,"_defencesFiltered",void 0),B(this,"_pbZonesFiltered",void 0),B(this,"_raidZonesFiltered",void 0),B(this,"_g",void 0),this._ports=t,V(this,O,(0,A.Oy)(e)),this._showId="show-zones",this._showValues=["pb-all","pb-single","raid-all","raid-single","off"],this._showCookie=new h.Z({id:this._showId,values:this._showValues}),this._showRadios=new z.Z(this._showId,this._showValues),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","#ports").attr("class","pb")}async _loadData(){this._pbZonesDefault=(await i.e(268).then(i.t.bind(i,5912,19))).default}_setupListener(){var t;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(()=>{this._showPBZonesSelected()}))}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.portNamesUpdate()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","pb-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,j.GZ)(t.joinCircle[0],t.joinCircle[1],28)+(0,j.GZ)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.pbCircles.map((t=>(0,j.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.pbCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.pbCircles.map((t=>t[1])).join(","))).text((t=>t.pbCircles.map(((t,e)=>String.fromCodePoint(65+e))).join(""))),"PVP"===R(this,O)&&(e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.spawnPoints.map((t=>(0,j.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.spawnPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.spawnPoints.map((t=>t[1])).join(","))).text((t=>t.spawnPoints.map(((t,e)=>String.fromCodePoint(88+e))).join("")))),e}));this._g.selectAll("g.defence").data(this._defencesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","defence svg-text-center fill-white text-tiny");return e.selectAll("path.tower-range").data((t=>t.towers)).join((t=>t.append("path").attr("class","tower-range background-primary-light").attr("d",(t=>(0,j.GZ)(t[0],t[1],R(this,H)))))),e.selectAll("path.fort-range").data((t=>t.forts)).join((t=>t.append("path").attr("class","fort-range background-red").attr("d",(t=>(0,j.GZ)(t[0],t[1],R(this,q)))))),e.append("path").attr("class","fort fill-red").attr("d",(t=>t.forts.map((t=>(0,j.yb)(t[0],t[1],3))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.forts.map((t=>t[0])).join(","))).attr("y",(t=>t.forts.map((t=>t[1])).join(","))).text((t=>t.forts.map(((t,e)=>`${e+1}`)).join(""))),e.append("path").attr("class","tower fill-dark").attr("d",(t=>t.towers.map((t=>(0,j.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.towers.map((t=>t[0])).join(","))).attr("y",(t=>t.towers.map((t=>t[1])).join(","))).text((t=>t.towers.map(((t,e)=>`${e+1}`)).join(""))),e})),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","raid-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,j.GZ)(t.joinCircle[0],t.joinCircle[1],35))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.raidCircles.map((t=>(0,j.GZ)(t[0],t[1],4.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.raidCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.raidCircles.map((t=>t[1])).join(","))).text((t=>t.raidCircles.map(((t,e)=>String.fromCodePoint(65+e))).join(""))),e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.raidPoints.map((t=>(0,j.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.raidPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.raidPoints.map((t=>t[1])).join(","))).text((t=>t.raidPoints.map(((t,e)=>String.fromCodePoint(49+e))).join(""))),e}))}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}async _setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?(this._isDataLoaded||(await this._loadData(),this._isDataLoaded=!0),this._filterVisible()):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter((t=>t.position[0]>=R(this,Y)[0]&&t.position[0]<=R(this,K)[0]&&t.position[1]>=R(this,Y)[1]&&t.position[1]<=R(this,K)[1])).filter((t=>this._isPortIn(t)));this._defencesFiltered=t.map((t=>({id:t.id,forts:t.forts,towers:t.towers}))),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map((t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints}))),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map((t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints}))))}setBounds(t){V(this,Y,t[0]),V(this,K,t[1])}async refresh(){await this._setData(),this._update()}}var X=i(9022),J=i(8398),Q=i(8776),tt=i(577),et=i(8973);const it=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}],at={x:l.zb/2,y:l.zb/2},st=it.sort(((t,e)=>{const i={x:t.centroid[0],y:t.centroid[1]},a={x:e.centroid[0],y:e.centroid[1]};return(0,o.UI)(at,i)-(0,o.UI)(at,a)})),nt=(0,et.Z)().range(X.q4).domain(st.map((t=>t.name))),rt=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}],ot=[{name:"Hispaniola",coordinates:[4900,3635],radius:150,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"Tumbado",coordinates:[2400,3050],radius:150,shallow:!1},{name:"Léogane",coordinates:[5130,3770],radius:90,shallow:!1,shipClass:{min:7,max:4}},{name:"Tortuga",coordinates:[5435,3420],radius:100,shallow:!1,shipClass:{min:7,max:5}},{name:"Antilles",coordinates:[7555,4470],radius:140,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"La Mona",coordinates:[6180,4100],radius:170,shallow:!1,shipClass:{min:7,max:4}}];function lt(t,e){dt(t,e),e.add(t)}function ht(t,e,i){dt(t,e),e.set(t,i)}function dt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ct(t,e,i){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),i}function ut(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,wt(t,e,"get"))}function pt(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,wt(t,e,"set"),i),i}function wt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function vt(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var mt=new WeakMap,gt=new WeakMap,ft=new WeakMap,_t=new WeakMap,bt=new WeakMap,yt=new WeakMap,kt=new WeakMap,Mt=new WeakMap,St=new WeakMap,Wt=new WeakMap,Tt=new WeakMap,xt=new WeakMap,$t=new WeakMap,Dt=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,It=new WeakMap,Lt=new WeakMap,Et=new WeakMap,Zt=new WeakMap,Nt=new WeakMap,At=new WeakMap,jt=new WeakSet,zt=new WeakSet,Bt=new WeakSet,Ft=new WeakSet,Rt=new WeakSet;class Vt{constructor(t){lt(this,Rt),lt(this,Ft),lt(this,Bt),lt(this,zt),lt(this,jt),ht(this,mt,{writable:!0,value:{}}),ht(this,gt,{writable:!0,value:{}}),ht(this,ft,{writable:!0,value:{}}),ht(this,_t,{writable:!0,value:{}}),ht(this,bt,{writable:!0,value:{}}),ht(this,yt,{writable:!0,value:{}}),ht(this,kt,{writable:!0,value:0}),ht(this,Mt,{writable:!0,value:0}),ht(this,St,{writable:!0,value:0}),ht(this,Wt,{writable:!0,value:0}),ht(this,Tt,{writable:!0,value:0}),ht(this,xt,{writable:!0,value:0}),ht(this,$t,{writable:!0,value:[]}),ht(this,Dt,{writable:!0,value:{}}),ht(this,Pt,{writable:!0,value:1}),ht(this,Ct,{writable:!0,value:""}),ht(this,It,{writable:!0,value:0}),ht(this,Lt,{writable:!0,value:o.w7}),ht(this,Et,{writable:!0,value:1e5}),ht(this,Zt,{writable:!0,value:4*o.L9}),ht(this,Nt,{writable:!0,value:o.L9}),ht(this,At,{writable:!0,value:30}),vt(this,jt,Gt).call(this),vt(this,zt,qt).call(this,t)}update(t,e,i,a){pt(this,Pt,t),pt(this,$t,e),pt(this,Ct,i),pt(this,It,a),vt(this,Rt,Ut).call(this)}}function Gt(){pt(this,yt,(0,a.Z)("#ports").append("g").attr("data-ui-component","port-circles"))}function qt(t){pt(this,Dt,(0,c.Z)()),pt(this,mt,(0,c.Z)().domain([0,1])),pt(this,gt,(0,c.Z)().domain([0,1]).range([X.Q0,X.gc]).interpolate(tt.Z)),pt(this,xt,(0,J.Z)(t,(t=>t.taxIncome))??0),pt(this,St,(0,Q.Z)(t,(t=>t.taxIncome))??0),pt(this,bt,(0,c.Z)().domain([ut(this,xt),ut(this,St)]).range([X.Q0,X.fy]).interpolate(tt.Z)),pt(this,Wt,(0,J.Z)(t,(t=>t.netIncome))??0),pt(this,kt,(0,Q.Z)(t,(t=>t.netIncome))??0),pt(this,ft,(0,c.Z)().domain([ut(this,Wt),0,ut(this,kt)]).range([X.gc,X.Q0,X.fy]).interpolate(tt.Z)),pt(this,Tt,(0,J.Z)(t,(t=>t.portPoints))??0),pt(this,Mt,(0,Q.Z)(t,(t=>t.portPoints))??0),pt(this,_t,(0,c.Z)().domain([ut(this,Tt),ut(this,Mt)]).range([X.Q0,X.fy]).interpolate(tt.Z))}function Ht(t){let e="";return t.id===ut(this,It)?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}function Ot(t){let e="";return t.cooldownTime?e="cooldown":"NT"===t.attackerNation&&(e="raider"),e}function Yt(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}function Kt(){const t=ut(this,Pt)<.5?2*ut(this,Pt):ut(this,Pt),e=ut(this,Lt)/t,i=(0,o.qY)(e*ut(this,Nt)),a=(0,o.qY)(e*ut(this,Zt));let s=ut(this,$t),n=()=>"",r=()=>0,l=()=>"";switch(ut(this,Ct)){case"tax":s=ut(this,$t).filter((t=>t.capturable&&t.taxIncome>ut(this,Et))),ut(this,Dt).domain([ut(this,xt),ut(this,St)]).range([i,a]),n=()=>"bubble",l=t=>ut(this,bt).call(this,t.taxIncome)??"",r=t=>ut(this,Dt).call(this,t.taxIncome)??0;break;case"net":s=ut(this,$t).filter((t=>t.capturable&&Math.abs(t.netIncome)>ut(this,Et))),ut(this,Dt).domain([ut(this,Wt),ut(this,kt)]).range([i,a]),n=()=>"bubble",l=t=>ut(this,ft).call(this,t.netIncome)??"",r=t=>ut(this,Dt).call(this,Math.abs(t.netIncome))??0;break;case"points":s=ut(this,$t).filter((t=>t.capturable&&t.portPoints>ut(this,At))),ut(this,Dt).domain([ut(this,Tt),ut(this,Mt)]).range([i,a/2]),n=()=>"bubble",l=t=>ut(this,_t).call(this,t.portPoints)??"",r=t=>ut(this,Dt).call(this,t.portPoints)??0;break;case"position":n=()=>"bubble here",r=t=>t.distance??0;break;case"attack":s=ut(this,$t).filter((t=>t.attackHostility||t.cooldownTime)),ut(this,mt).range([i,a/1.5]),n=t=>`bubble ${ct(Vt,Vt,Ot).call(Vt,t)}`,l=t=>"NT"===t.attackerNation?"":ut(this,gt).call(this,t.attackHostility??0)??"",r=t=>ut(this,mt).call(this,t.attackHostility??(t.cooldownTime?.2:0))??0;break;default:switch(ut(this,Ct)){case"county":n=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",l=t=>t.capturable?nt(t.county):"",r=t=>t.capturable?a/2:a/3;break;case"tradePorts":n=t=>`bubble ${vt(this,Bt,Ht).call(this,t)}`,r=t=>t.id===ut(this,It)?a:a/2;break;case"frontline":n=t=>`bubble ${ct(Vt,Vt,Yt).call(Vt,t)}`,r=t=>t.ownPort?a/3:a/2,s=s.filter((t=>t.enemyPort??t.ownPort));break;case"currentGood":n=t=>"bubble "+(t.isSource?"pos":"neg"),r=()=>a/2;break;case"off":s=[]}}return{data:s,cssClass:n,r,fill:l}}function Ut(){const{data:t,cssClass:e,r:i,fill:a}=vt(this,Ft,Kt).call(this);ut(this,yt).selectAll("circle").data(t,(t=>String(t.id))).join((t=>t.append("circle").attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])))).attr("class",(t=>e(t))).attr("r",(t=>i(t))).attr("fill",(t=>a(t)))}function Xt(t,e){Qt(t,e),e.add(t)}function Jt(t,e,i){Qt(t,e),e.set(t,i)}function Qt(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function te(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ie(t,e,"get"))}function ee(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ie(t,e,"set"),i),i}function ie(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function ae(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var se=new WeakMap,ne=new WeakMap,re=new WeakSet,oe=new WeakSet;class le{constructor(){Xt(this,oe),Xt(this,re),Jt(this,se,{writable:!0,value:it}),Jt(this,ne,{writable:!0,value:{}}),ae(this,re,he).call(this)}update(t,e,i,a){"portLabel"===t?(ae(this,oe,de).call(this,e,i,a),te(this,ne).classed("d-none",!1)):te(this,ne).classed("d-none",!0)}}function he(){ee(this,ne,(0,a.Z)("#ports").append("g").attr("data-ui-component","county").attr("class","sub-title"))}function de(t,e,i){const a=te(this,se).filter((i=>i.centroid[0]>=t[0]&&i.centroid[0]<=e[0]&&i.centroid[1]>=t[1]&&i.centroid[1]<=e[1]));te(this,ne).selectAll("text").data(a,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name))),(t=>t.attr("fill",(t=>"county"===i?nt(t.name):""))))}var ce=i(2157);function ue(t,e){we(t,e),e.add(t)}function pe(t,e,i){we(t,e),e.set(t,i)}function we(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ve(t,e,i){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),i}function me(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_e(t,e,"get"))}function ge(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function fe(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,_e(t,e,"set"),i),i}function _e(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var be=new WeakMap,ye=new WeakMap,ke=new WeakSet,Me=new WeakSet,Se=new WeakSet,We=new WeakSet,Te=new WeakSet,xe=new WeakSet,$e=new WeakSet,De=new WeakSet,Pe=new WeakSet;class Ce{constructor(){ue(this,Pe),ue(this,De),ue(this,$e),ue(this,xe),ue(this,Te),ue(this,We),ue(this,Se),ue(this,Me),ue(this,ke),pe(this,be,{writable:!0,value:48}),pe(this,ye,{writable:!0,value:void 0}),fe(this,ye,document.querySelector("#na-svg defs")),ge(this,Pe,Fe).call(this)}}function Ie(t){const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${me(this,be)} ${.75*me(this,be)}`),e}function Le(t){const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(me(this,be))),e.setAttribute("height",String(me(this,be))),e.setAttribute("href",X.eM[t].replace('"',"").replace('"',"")),e}function Ee(t){const e=document.createElementNS("http://www.w3.org/2000/svg","circle");return e.setAttribute("cx",String(me(this,be)/2)),e.setAttribute("cy",String(me(this,be)/2)),e.setAttribute("r","16"),e.setAttribute("class",t),e}function Ze(){return ge(this,Se,Ee).call(this,"circle-highlight-yellow")}function Ne(){return ge(this,Se,Ee).call(this,"circle-highlight")}function Ae(){const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",X.Om),t.setAttribute("fill-opacity","0.7"),t}function je(t,e){const i=e.cloneNode(!0);i.id=`${t}r`,i.append(ge(this,Te,Ne).call(this)),me(this,ye).append(i)}function ze(t,e){const i=e.cloneNode(!0);i.id=`${t}c`,i.append(ge(this,We,Ze).call(this)),me(this,ye).append(i)}function Be(t,e){const i=e.cloneNode(!0),a=i.cloneNode(!0);i.id=`${t}a`,i.append(ve(Ce,Ce,Ae).call(Ce)),me(this,ye).append(i),a.id=`${t}ra`,a.append(ge(this,Te,Ne).call(this)),me(this,ye).append(a)}function Fe(){for(const t of ce.nU.map((t=>t.short))){const e=ge(this,ke,Ie).call(this,t);e.append(ge(this,Me,Le).call(this,t));const i=me(this,ye).appendChild(e);"FT"!==t&&ge(this,xe,je).call(this,t,i),"NT"!==t&&"FT"!==t&&(ge(this,$e,ze).call(this,t,i),ge(this,De,Be).call(this,t,i))}}var Re=i(7484),Ve=i.n(Re),Ge=(i(9517),i(285)),qe=i.n(Ge),He=i(4110),Oe=i.n(He),Ye=i(178),Ke=i.n(Ye),Ue=i(7846);function Xe(t,e){Qe(t,e),e.add(t)}function Je(t,e,i){Qe(t,e),e.set(t,i)}function Qe(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function ti(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ai(t,e,"get"))}function ei(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function ii(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ai(t,e,"set"),i),i}function ai(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(qe()),Ve().extend(Oe()),Ve().extend(Ke()),Ve().locale("en-gb");var si=new WeakMap,ni=new WeakMap,ri=new WeakMap,oi=new WeakSet,li=new WeakSet,hi=new WeakSet;class di{constructor(t){Xe(this,hi),Xe(this,li),Xe(this,oi),Je(this,si,{writable:!0,value:{}}),Je(this,ni,{writable:!0,value:void 0}),Je(this,ri,{writable:!0,value:o.jo}),ii(this,ni,t),ei(this,oi,ci).call(this),ei(this,hi,pi).call(this)}update(t){"pbZone"===t?ti(this,si).classed("d-none",!0):ti(this,si).classed("d-none",!1)}}function ci(){ii(this,si,(0,a.Z)("#ports").append("g").attr("data-ui-component","patrol-zone").attr("class","fill-yellow-dark"))}function ui(){const t=Ve().utc("2021-01-17").hour(l.WF);let e=Ve().utc().diff(t,"day");return"eu2"===ti(this,ni)&&(e+=4),e%=ot.length,ot[e]}function pi(){const t=ei(this,li,ui).call(this),e=1.6*t.radius,i=Math.round(t.radius/1.3),a=Math.round(ti(this,ri)*t.radius/100);ti(this,si).append("circle").attr("class","background-yellow").attr("cx",t.coordinates[0]).attr("cy",t.coordinates[1]).attr("r",t.radius),ti(this,si).append("image").attr("height",e).attr("width",e).attr("x",t.coordinates[0]).attr("y",t.coordinates[1]).attr("transform",`translate(${Math.floor(-e/2)},${Math.floor(-e/1.6)})`).attr("xlink:href",Ue).attr("alt","Patrol zone"),ti(this,si).append("text").attr("class","svg-text-center").attr("x",t.coordinates[0]).attr("y",t.coordinates[1]).attr("dy",i).attr("font-size",Math.round(1.6*a)).text(t.name),ti(this,si).append("text").attr("class","svg-text-center").attr("x",t.coordinates[0]).attr("y",t.coordinates[1]).attr("dy",i-1.6*a).attr("font-size",a).html(t.shallow?"Shallow water ships":(t.shipClass?`${(0,o.hg)(t.shipClass.min)} to ${(0,o.hg)(t.shipClass.max)} rate`:"All")+" ships")}var wi=i(3824),vi=i.n(wi),mi=i(4848),gi=i(5619),fi=i(6400),_i=i(4332),bi=i(5923);function yi(t,e){Mi(t,e),e.add(t)}function ki(t,e,i){Mi(t,e),e.set(t,i)}function Mi(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Si(t,e,i){return function(t,e){if(t!==e)throw new TypeError("Private static access of wrong provenance")}(t,e),i}function Wi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$i(t,e,"get"))}function Ti(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function xi(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,$i(t,e,"set"),i),i}function $i(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(qe()),Ve().extend(Oe()),Ve().extend(Ke()),Ve().locale("en-gb");const Di=gi.Z.bind(fi.h);var Pi=new WeakMap,Ci=new WeakMap,Ii=new WeakMap,Li=new WeakMap,Ei=new WeakMap,Zi=new WeakMap,Ni=new WeakMap,Ai=new WeakSet,ji=new WeakSet,zi=new WeakSet,Bi=new WeakSet,Fi=new WeakSet,Ri=new WeakMap,Vi=new WeakSet,Gi=new WeakSet,qi=new WeakSet,Hi=new WeakSet,Oi=new WeakSet;class Yi{constructor(t,e){this.map=e,yi(this,Oi),yi(this,Hi),yi(this,qi),yi(this,Gi),yi(this,Vi),yi(this,Fi),yi(this,Bi),yi(this,zi),yi(this,ji),yi(this,Ai),ki(this,Pi,{writable:!0,value:{}}),ki(this,Ci,{writable:!0,value:""}),ki(this,Ii,{writable:!0,value:void 0}),ki(this,Li,{writable:!0,value:{}}),ki(this,Ei,{writable:!0,value:{}}),ki(this,Zi,{writable:!0,value:o.w7}),ki(this,Ni,{writable:!0,value:void 0}),ki(this,Ri,{writable:!0,value:(t,e,i)=>{var a;const s="buy"===i?"alert-success":"alert-danger",n="buy"===i?`Buy here and sell in ${e}`:`Buy in ${e} and sell here`;return void 0===(null===(a=t.profit)||void 0===a?void 0:a[0])?Di``:Di`<div class="alert ${s} mt-2 mb-2 text-start" role="alert">
                  <div class="alert-heading"><span class="caps">${n}</span> (net value in reales)</div>
                  <p class="my-1"><em>By profit per item</em>: ${t.profit}</p>
                  <p class="my-1"><em>By profit per ton</em>: ${t.profitPerTon}</p>
              </div>`}}),xi(this,Ni,t),Ti(this,Ai,Ki).call(this)}getTradeItem(t){return Wi(this,Li).get(t)}get tradePort(){return Wi(this,Ei)}set tradePort(t){xi(this,Ei,t)}async loadData(){const t=await(0,X.qP)(`${Wi(this,Ni)}-items.json`);xi(this,Li,new Map(t.map((t=>[t.id,t]))))}update(t,e,i){xi(this,Ci,e);const a=t<.5?2*t:t,s=Wi(this,Zi)/a;Wi(this,Pi).selectAll("circle").data(i,(t=>String(t.id))).join((t=>t.append("circle").attr("fill",(t=>{const e=`${"FT"===t.nation||"NT"===t.nation||t.capturable?"":"c"}${t.countyCapital&&t.capturable?"r":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`})).attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])).on("click",((t,e)=>{Ti(this,Oi,ra).call(this,t,e)})).on("mouseleave",(()=>{Ti(this,Hi,na).call(this)})))).attr("r",s)}}function Ki(){xi(this,Pi,(0,a.Z)("#ports").append("g").attr("data-ui-component","port-icons").attr("class","click-circle"))}function Ui(t){return(null==t?void 0:t.map((t=>{var e;return(null===(e=Wi(this,Li).get(t))||void 0===e?void 0:e.name)??""})).sort(ce.I4).join(", "))??""}function Xi(t,e){return e.profit.profit-t.profit.profit}function Ji(t,e){return e.profit.profitPerTon-t.profit.profitPerTon}function Qi(t){var e;return Di`${null==t||null===(e=t.sort(Si(Yi,Yi,Xi)))||void 0===e?void 0:e.map(((e,i)=>Di`<span style="white-space: nowrap;">${e.name} (${(0,u.RK)(e.profit.profit)})</span
                        >${i===t.length-1?Di``:Di`, `}`))}`}function ta(t){var e;return Di`${null==t||null===(e=t.sort(Si(Yi,Yi,Ji)))||void 0===e?void 0:e.map(((e,i)=>Di`<span style="white-space: nowrap;"
                            >${e.name} (${(0,u.RK)(e.profit.profitPerTon)})</span
                        >${i===t.length-1?Di``:Di`, `}`))}`}function ea(t){var e;const i=Ve().utc(t.portBattle),a=Ve().utc(t.portBattle).local(),s=i===a?"":` (${a.format("H.mm")} local)`,n=Ve().utc(t.cooldownTime),r=Ve().utc(t.cooldownTime).local(),o=n===r?"":` (${r.format("H.mm")} local)`,l=(0,X.eA)(t.portBattleStartTime),h=i.isAfter(Ve().utc())?"s":"ed",d=t.portBattle?Di`<span
                      class="flag-icon-${t.attackerNation} flag-icon-small me-1"
                      role="img"
                      title="${(null===(e=(0,ce.$i)((null==t?void 0:t.attackerNation)??""))||void 0===e?void 0:e.sortName)??""}"
                  ></span
                  >${(0,bi.HL)(t.attackerClan)} attack${t.portBattle?Di`${h} ${i.fromNow()} at ${i.format("H.mm")}${s}`:Di`s: ${(0,u.sR)(t.attackHostility??0)} hostility`}`:Di``,c={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:""===t.county?"":t.county,region:""===t.region?"":t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?(0,bi.HL)(t.capturer):Di``,captureTime:t.captured?`${(0,ce.fm)(Ve().utc(t.captured).fromNow())}`:"",attack:t.attackHostility?d:Di``,isNPCAttacker:"NT"===t.attackerNation,pbTimeRange:t.capturable?l:"",brLimit:(0,u.yI)(t.brLimit),portPoints:t.capturable?(0,u.yI)(t.portPoints):"",taxIncome:(0,u.RK)(t.taxIncome),portTax:(0,u.sR)(t.portTax),netIncome:(0,u.RK)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:Ti(this,ji,Ui).call(this,t.dropsTrading),consumesTrading:Ti(this,ji,Ui).call(this,t.consumesTrading),producesNonTrading:Ti(this,ji,Ui).call(this,t.producesNonTrading),dropsNonTrading:Ti(this,ji,Ui).call(this,t.dropsNonTrading),tradePortName:this.tradePort.name,goodsToSellInTradePort:{profit:Ti(this,zi,Qi).call(this,t.goodsToSellInTradePort),profitPerTon:Ti(this,Bi,ta).call(this,t.goodsToSellInTradePort)},goodsToBuyInTradePort:{profit:Ti(this,zi,Qi).call(this,t.goodsToBuyInTradePort),profitPerTon:Ti(this,Bi,ta).call(this,t.goodsToBuyInTradePort)}};return c.dropsTrading.length>0&&c.dropsNonTrading.length>0&&(c.dropsNonTrading+=" ‒ "),t.cooldownTime&&(c.cooldownTime=Di`${n.fromNow()} at <em>approximately</em> ${n.format("H.mm")}${o}`),t.portBonus&&(c.portBonus=t.portBonus),c}function ia(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return Di`
            <div class="d-flex justify-content-between mb-4">
                <div class="d-flex">
                    <i class="flag-icon-${t.icon} flag-icon-large ${e}" role="img" />

                    <div class="text-start align-self-center compress mx-3">
                        <div class="large mb-1">${t.name}</div>
                        <div class="caps">${t.county}</div>
                        <div class="caps">${t.region}</div>
                    </div>
                </div>

                ${t.portBonus?Di`<div class="d-flex align-self-end me-1">${Di`${_i.y7.map((e=>{var i;return Di`${null!=t&&null!==(i=t.portBonus)&&void 0!==i&&i[e]?Di`<div class="me-1">
                          <i class="icon icon-light icon-${e}" role="img" aria-label="${e} bonus"></i>
                          <div class="x-large text-lighter text-center">${t.portBonus[e]}</div>
                      </div>`:Di``}`}))}`}</div>`:Di``}

                <div class="d-flex flex-column justify-content-end align-self-center">
                    <div class="ms-auto">
                        ${t.portPoints?Di`<span class="x-large text-lighter">${t.portPoints}</span>`:Di``}
                    </div>
                    <div class="ms-auto">
                        ${t.laborHoursDiscount?Di`<i
                                  class="icon icon-light icon-labour me-1"
                                  role="img"
                                  aria-label="Labour hour discount level ${t.laborHoursDiscount}"
                              ></i>`:Di``}
                        ${t.tradingCompany?Di`<i
                                  class="icon icon-light icon-trading me-1"
                                  role="img"
                                  aria-label="Trading company level ${t.tradingCompany}"
                              ></i>`:Di``}
                        ${t.availableForAll?Di`<i
                                  class="icon icon-light icon-open me-1"
                                  role="img"
                                  aria-label="Accessible to all"
                              ></i>`:Di``}
                        ${t.shallow?Di`<i class="icon icon-light icon-shallow" role="img" aria-label="Shallow"></i>`:Di`<i class="icon icon-light icon-deep" role="img" aria-label="Deep"></i>`}
                    </div>
                </div>
            </div>

            ${void 0===t.attack?Di`${t.cooldownTime?Di`<div class="alert alert-success mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:Di``}`:Di`<div class="alert mt-2 ${t.isNPCAttacker?"alert-warning":"alert-danger"}" role="alert">
                      ${t.attack}
                  </div>`}

            <div class="d-flex text-start mb-2 compress">
                ${t.capital||"FT"===t.icon?Di`<div>${t.portTax}<br /><span class="des top-0">Tax rate</span></div>`:Di`
                          <div class="me-3">
                              ${t.pbTimeRange}<br />
                              <span class="des top-0">Battle timer</span>
                          </div>
                          <div class="me-3">
                              ${t.brLimit}<br />
                              <span class="des top-0">Rating</span>
                          </div>
                          ${t.capturer?Di`<div class="me-3">
                                        ${t.capturer}<br />
                                        <span class="des top-0">Capturer</span>
                                    </div>
                                    <div class="me-5">
                                        ${t.captureTime}<br />
                                        <span class="des top-0">Capture</span>
                                    </div>`:Di``}

                          <div class="ms-auto me-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des top-0">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des top-0">Net income</span>
                          </div>
                      `}
            </div>

            ${"tradePorts"===Wi(this,Ci)?Di`${Wi(this,Ri).call(this,t.goodsToSellInTradePort,t.tradePortName,"buy")}${Wi(this,Ri).call(this,t.goodsToBuyInTradePort,t.tradePortName,"sell")}`:Di` ${t.producesNonTrading.length>0?Di`<p class="mb-2">
                            <span class="caps">Produces—</span
                            ><span class="non-trading">${t.producesNonTrading}</span>
                        </p>`:Di``}
                  ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?Di`<p class="mb-2">
                            <span class="caps">Drops—</span>
                            ${t.dropsNonTrading?Di`<span class="non-trading">${t.dropsNonTrading}</span>`:Di``}
                            ${t.dropsTrading}
                        </p> `:Di``}
                  ${t.consumesTrading.length>0?Di`<p class="mb-2"><span class="caps">Consumes—</span>${t.consumesTrading}</p>`:Di``}`}
        `}function aa(t){var e;return(null===(e=Wi(this,Li).get(t))||void 0===e?void 0:e.name)??""}function sa(t){let e="";const i=t.inventory.filter((t=>t.buyQuantity>0&&t.buyPrice>0)).sort(((t,e)=>Ti(this,Gi,aa).call(this,t.id).localeCompare(Ti(this,Gi,aa).call(this,e.id)))).map((t=>`${(0,u.yI)(t.buyQuantity)} ${Ti(this,Gi,aa).call(this,t.id)} @ ${(0,u.Pj)(t.buyPrice)}`)).join("<br>"),a=t.inventory.filter((t=>t.sellQuantity>0&&t.sellPrice>0)).sort(((t,e)=>Ti(this,Gi,aa).call(this,t.id).localeCompare(Ti(this,Gi,aa).call(this,e.id)))).map((t=>`${(0,u.yI)(t.sellQuantity)} ${Ti(this,Gi,aa).call(this,t.id)} @ ${(0,u.Pj)(t.sellPrice)}`)).join("<br>");return e+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,i.length>0&&(e+="<h6>Buy</h6>",e+=i),i.length>0&&a.length>0&&(e+="<p></p>"),a.length>0&&(e+="<h6>Sell</h6>",e+=a),e}function na(){void 0!==Wi(this,Ii)&&(Wi(this,Ii).dispose(),xi(this,Ii,void 0))}function ra(t,e){const i=t.currentTarget;Ti(this,Hi,na).call(this),xi(this,Ii,new(vi())(i,{html:!0,placement:"auto",trigger:"manual",title:(0,mi.ZP)(Ti(this,Vi,ia).call(this,Ti(this,Fi,ea).call(this,e))),sanitize:!1})),Wi(this,Ii).show(),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(Ti(this,qi,sa).call(this,e)))}function oa(t,e){ha(t,e),e.add(t)}function la(t,e,i){ha(t,e),e.set(t,i)}function ha(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function da(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ua(t,e,"set"),i),i}function ca(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ua(t,e,"get"))}function ua(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function pa(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var wa=new WeakMap,va=new WeakMap,ma=new WeakMap,ga=new WeakMap,fa=new WeakMap,_a=new WeakMap,ba=new WeakMap,ya=new WeakSet,ka=new WeakSet,Ma=new WeakSet,Sa=new WeakSet,Wa=new WeakSet;class Ta{constructor(){oa(this,Wa),oa(this,Sa),oa(this,Ma),oa(this,ka),oa(this,ya),la(this,wa,{writable:!0,value:{id:366,coord:{x:4396,y:2494}}}),la(this,va,{writable:!0,value:{}}),la(this,ma,{writable:!0,value:1}),la(this,ga,{writable:!0,value:void 0}),la(this,fa,{writable:!0,value:o.w7}),la(this,_a,{writable:!0,value:o.jo}),la(this,ba,{writable:!0,value:"all"}),pa(this,ya,xa).call(this)}get currentPort(){return ca(this,wa)}set currentPort(t){da(this,wa,t)}update(t,e,i){da(this,ga,t),da(this,ma,e),"initial"===ca(this,ga)?ca(this,va).classed("d-none",!0):pa(this,Wa,Ca).call(this,i)}}function xa(){da(this,va,(0,a.Z)("#ports").append("g").attr("data-ui-component","port-names").attr("class","fill-white"))}function $a(t,e){return"pbZone"===ca(this,ga)&&("all"===ca(this,ba)||"single"===ca(this,ba)&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.3*e*Math.cos((0,o.Ht)(t.angle))):t.coordinates[0]}function Da(t,e,i){const a=e+1.2*i;if("pbZone"!==ca(this,ga))return t.coordinates[1]+a;const s=t.angle>90&&t.angle<270?i:0;return"all"===ca(this,ba)||"single"===ca(this,ba)&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.3*e*Math.sin((0,o.Ht)(t.angle)))+s:t.coordinates[1]+a}function Pa(t){return"pbZone"===ca(this,ga)&&("all"===ca(this,ba)||"single"===ca(this,ba)&&t.id===this.currentPort.id)?t.angle>0&&t.angle<o.tz?"start":"end":"middle"}function Ca(t){const e=(0,o.qY)(ca(this,fa)/ca(this,ma)),i=(0,o.qY)(ca(this,_a)/ca(this,ma));ca(this,va).selectAll("text").data(t,(t=>String(t.id))).join((t=>t.append("text").text((t=>t.name)))).attr("x",(t=>pa(this,ka,$a).call(this,t,e))).attr("y",(t=>pa(this,Ma,Da).call(this,t,e,i))).style("text-anchor",(t=>pa(this,Sa,Pa).call(this,t))).style("dominant-baseline","auto"),ca(this,va).attr("font-size",`${i}px`).classed("d-none",!1)}function Ia(t,e){Ea(t,e),e.add(t)}function La(t,e,i){Ea(t,e),e.set(t,i)}function Ea(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Za(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Aa(t,e,"get"))}function Na(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Aa(t,e,"set"),i),i}function Aa(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function ja(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var za=new WeakMap,Ba=new WeakMap,Fa=new WeakSet,Ra=new WeakSet;class Va{constructor(){Ia(this,Ra),Ia(this,Fa),La(this,za,{writable:!0,value:{}}),La(this,Ba,{writable:!0,value:rt}),ja(this,Fa,Ga).call(this)}update(t,e,i){"initial"===t?(ja(this,Ra,qa).call(this,e,i),Za(this,za).classed("d-none",!1)):Za(this,za).classed("d-none",!0)}}function Ga(){Na(this,za,(0,a.Z)("#ports").append("g").attr("data-ui-component","region").attr("class","title"))}function qa(t,e){const i=Za(this,Ba).filter((i=>i.centroid[0]>=t[0]&&i.centroid[0]<=e[0]&&i.centroid[1]>=t[1]&&i.centroid[1]<=e[1]));Za(this,za).selectAll("text").data(i,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name))))}var Ha=i(2255);function Oa(t,e,i){Ya(t,e),e.set(t,i)}function Ya(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ka(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Xa(t,e,"get"))}function Ua(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Xa(t,e,"set"),i),i}function Xa(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ja=new WeakMap,Qa=new WeakMap,ts=new WeakMap,es=new WeakMap,is=new WeakMap,as=new WeakMap,ss=new WeakMap,ns=new WeakSet;class rs{constructor(){var t,e;Ya(t=this,e=ns),e.add(t),Oa(this,Ja,{writable:!0,value:{}}),Oa(this,Qa,{writable:!0,value:{}}),Oa(this,ts,{writable:!0,value:{}}),Oa(this,es,{writable:!0,value:{}}),Oa(this,is,{writable:!0,value:{}}),Oa(this,as,{writable:!0,value:{}}),Oa(this,ss,{writable:!0,value:{}}),function(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}(this,ns,os).call(this)}update(t){const e=Object.keys(t).length;let i=0,a=0;e&&(i=(0,Ha.Z)(t,(t=>t.taxIncome)),a=(0,Ha.Z)(t,(t=>t.netIncome))),Ka(this,as).text(`${e}`),Ka(this,ss).html(`${(0,u.Dw)(i)}`),Ka(this,is).html(`${(0,u.Dw)(a)}`)}show(){Ka(this,Ja).classed("hidden",!1)}}function os(){Ua(this,Ja,(0,a.Z)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary shadow port-summary-no-wind")),Ua(this,ts,Ka(this,Ja).append("div").attr("class","block")),Ua(this,as,Ka(this,ts).append("div")),Ka(this,ts).append("div").attr("class","overlay-des").html("selected<br>ports"),Ua(this,es,Ka(this,Ja).append("div").attr("class","block")),Ua(this,ss,Ka(this,es).append("div")),Ka(this,es).append("div").attr("class","overlay-des").html("tax<br>income"),Ua(this,Qa,Ka(this,Ja).append("div").attr("class","block")),Ua(this,is,Ka(this,Qa).append("div")),Ka(this,Qa).append("div").attr("class","overlay-des").html("net<br>income")}function ls(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function hs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,cs(t,e,"get"))}function ds(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,cs(t,e,"set"),i),i}function cs(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var us=new WeakMap,ps=new WeakMap,ws=new WeakMap,vs=new WeakMap,ms=new WeakMap,gs=new WeakMap,fs=new WeakMap,_s=new WeakMap,bs=new WeakMap,ys=new WeakMap,ks=new WeakMap,Ms=new WeakMap,Ss=new WeakMap,Ws=new WeakMap,Ts=new WeakMap,xs=new WeakMap,$s=new WeakMap,Ds=new WeakMap,Ps=new WeakMap,Cs=new WeakMap,Is=new WeakMap,Ls=new WeakMap,Es=new WeakMap;class Zs{constructor(t){var e,i,a;this.map=t,ls(this,us,{writable:!0,value:void 0}),ls(this,ps,{writable:!0,value:{}}),ls(this,ws,{writable:!0,value:{}}),ls(this,vs,{writable:!0,value:void 0}),ls(this,ms,{writable:!0,value:void 0}),ls(this,gs,{writable:!0,value:{}}),ls(this,fs,{writable:!0,value:void 0}),ls(this,_s,{writable:!0,value:void 0}),ls(this,bs,{writable:!0,value:void 0}),ls(this,ys,{writable:!0,value:void 0}),ls(this,ks,{writable:!0,value:0}),ls(this,Ms,{writable:!0,value:!1}),ls(this,Ss,{writable:!0,value:""}),ls(this,Ws,{writable:!0,value:!1}),ls(this,Ts,{writable:!0,value:void 0}),ls(this,xs,{writable:!0,value:{}}),ls(this,$s,{writable:!0,value:"initial"}),a=void 0,(i="portIcons")in(e=this)?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,ls(this,Ds,{writable:!0,value:"show-radius"}),ls(this,Ps,{writable:!0,value:void 0}),ls(this,Cs,{writable:!0,value:void 0}),ls(this,Is,{writable:!0,value:void 0}),ls(this,Ls,{writable:!0,value:void 0}),ls(this,Es,{writable:!0,value:void 0}),ds(this,Es,this.map.serverName),ds(this,ks,l.VJ),ds(this,Cs,this.map.f11),ds(this,Is,["attack","county","points","position","tax","net","off"]),ds(this,Ps,new h.Z({id:hs(this,Ds),values:hs(this,Is)})),ds(this,Ls,new z.Z(hs(this,Ds),hs(this,Is))),this.showRadius=this._getShowRadiusSetting()}async init(){await this._loadAndSetupData()}async _setupData(t){ds(this,fs,t.ports.map((e=>{const i=t.server.find((t=>t.id===e.id))??{},a=t.pb.find((t=>t.id===e.id))??{};return{...e,...i,...a}}))),ds(this,gs,hs(this,fs)),this._setupListener(),this._setupSvg(),ds(this,Ts,new rs),ds(this,ms,new Vt(hs(this,fs))),this.portIcons=new Yi(hs(this,Es),this.map),await this.portIcons.loadData(),ds(this,bs,new Ta),ds(this,us,new le),ds(this,ys,new Va),ds(this,vs,new di(hs(this,Es))),new Ce}async _loadData(){const t=[{fileName:`${hs(this,Es)}-ports.json`,name:"server"},{fileName:`${hs(this,Es)}-pb.json`,name:"pb"}],e={};return e.ports=(await i.e(462).then(i.t.bind(i,9131,19))).default,await(0,X.EZ)(t,e),e}async _loadAndSetupData(){const t=await this._loadData();await this._setupData(t)}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",(()=>{this._showRadiusSelected()}))}_getShowRadiusSetting(){let t=hs(this,Ps).get();return"position"===t&&([t]=hs(this,Is),hs(this,Ps).set(t)),hs(this,Ls).set(t),t}_showRadiusSelected(){this.showRadius=hs(this,Ls).get(),hs(this,Ps).set(this.showRadius),this.update()}_setupSvg(){ds(this,ps,(0,a.Z)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"))}portNamesUpdate(){hs(this,bs).update(this.zoomLevel,hs(this,ks),hs(this,_s))}update(t){ds(this,ks,t??hs(this,ks)),this._filterVisible(),this.portIcons.update(hs(this,ks),this.showRadius,hs(this,gs)),hs(this,ms).update(hs(this,ks),hs(this,_s),this.showRadius,this.portIcons.tradePort.id),this.portNamesUpdate(),hs(this,us).update(this.zoomLevel,hs(this,ws),hs(this,xs),this.showRadius),hs(this,ys).update(this.zoomLevel,hs(this,ws),hs(this,xs)),hs(this,vs).update(this.zoomLevel),hs(this,Ts).update(hs(this,gs))}_filterVisible(){"position"===this.showRadius?ds(this,_s,hs(this,gs)):ds(this,_s,hs(this,gs).filter((t=>t.coordinates[0]>=hs(this,ws)[0]&&t.coordinates[0]<=hs(this,xs)[0]&&t.coordinates[1]>=hs(this,ws)[1]&&t.coordinates[1]<=hs(this,xs)[1])))}setBounds(t){ds(this,ws,t[0]),ds(this,xs,t[1])}setShowRadiusSetting(t=hs(this,Is)[0]){this.showRadius=t,hs(this,Ls).set(this.showRadius),hs(this,Ps).set(this.showRadius)}clearMap(t){hs(this,Ts).show(),ds(this,gs,hs(this,fs)),this.setShowRadiusSetting(),this.update(t)}get currentPort(){return hs(this,bs).currentPort}set currentPort(t){hs(this,bs).currentPort=t}get portData(){return hs(this,gs)}set portData(t){ds(this,gs,t)}get portDataDefault(){return hs(this,fs)}get showRadius(){return hs(this,Ss)}set showRadius(t){ds(this,Ss,t)}get showTradePortPartners(){return hs(this,Ms)}set showTradePortPartners(t){ds(this,Ws,t)}get zoomLevel(){return hs(this,$s)}set zoomLevel(t){ds(this,$s,t)}}var Ns=i(5162),As=i(9875),js=i(7281),zs=i(9843),Bs=i(2938),Fs=i(9492);function Rs(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Vs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,qs(t,e,"get"))}function Gs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,qs(t,e,"set"),i),i}function qs(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Hs=new WeakMap,Os=new WeakMap,Ys=new WeakMap,Ks=new WeakMap;class Us extends zs.Z{constructor(t){super(t,"sm","Set"),Rs(this,Hs,{writable:!0,value:"ship-journey"}),Rs(this,Os,{writable:!0,value:{}}),Rs(this,Ys,{writable:!0,value:{}}),Rs(this,Ks,{writable:!0,value:{}})}async init(){this._injectModal();const{select:t,shipNameAndSpeed:e}=await(0,Fs.hY)();Gs(this,Os,t),Gs(this,Ys,e)}_injectModal(){const t=super.bodySel;Gs(this,Ks,new Bs.Z(t,this.baseId));const e=t.select("form"),i=`${Vs(this,Hs)}-select`,a=e.append("div").attr("class","mt-3").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}getWind(){return Vs(this,Ks).getWind()??0}_getShipId(){return Number(Vs(this,Os).getValues())}getShipName(){var t;const e=this._getShipId();return null===(t=Vs(this,Ys).get(e))||void 0===t?void 0:t.name}getSpeedDegrees(){var t;const e=this._getShipId();return null===(t=Vs(this,Ys).get(e))||void 0===t?void 0:t.speedDegrees}}function Xs(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Js(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,tn(t,e,"get"))}function Qs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,tn(t,e,"set"),i),i}function tn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var en=new WeakMap,an=new WeakMap,sn=new WeakMap,nn=new WeakMap,rn=new WeakMap,on=new WeakMap;class ln{constructor(t){Xs(this,en,{writable:!0,value:{}}),Xs(this,an,{writable:!0,value:{}}),Xs(this,sn,{writable:!0,value:{}}),Xs(this,nn,{writable:!0,value:{}}),Xs(this,rn,{writable:!0,value:{}}),Xs(this,on,{writable:!0,value:void 0}),Qs(this,on,t),this._setupSummary()}_setupSummary(){Qs(this,en,(0,a.Z)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary shadow-lg d-none")),Qs(this,an,Js(this,en).append("div").attr("class","block small")),Qs(this,sn,Js(this,an).append("div")),Js(this,an).append("div").attr("class","overlay-des").text("ship"),Qs(this,rn,Js(this,en).append("div").attr("class","block small")),Qs(this,nn,Js(this,rn).append("div")),Js(this,rn).append("div").attr("class","overlay-des").text("wind"),Js(this,en).append("div").attr("class","block").append("button").attr("id",Js(this,on)).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){Js(this,en).classed("d-none",!t),(0,a.Z)("#port-summary").classed("d-none",t)}_printSummaryShip(t){Js(this,sn).text(t)}_printSummaryWind(t){Js(this,nn).html(`From ${(0,j.Iy)(t)}`)}show(){this._displaySummary(!0)}hide(){this._displaySummary(!1)}setPosition(t,e){Js(this,en).style("top",`${t}px`).style("right",`${e}px`)}print({startWindDegrees:t,shipName:e}){this._printSummaryWind(t),this._printSummaryShip(e)}}var hn=i(8250),dn=i(7),cn=i(7422);function un(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function pn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,vn(t,e,"set"),i),i}function wn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,vn(t,e,"get"))}function vn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var mn=new WeakMap,gn=new WeakMap,fn=new WeakMap,_n=new WeakMap,bn=new WeakMap,yn=new WeakMap,kn=new WeakMap,Mn=new WeakMap,Sn=new WeakMap,Wn=new WeakMap;class Tn{constructor(t,e,i){un(this,mn,{writable:!0,value:0}),un(this,gn,{writable:!0,value:10}),un(this,fn,{writable:!0,value:void 0}),un(this,_n,{writable:!0,value:void 0}),un(this,bn,{writable:!0,value:20}),un(this,yn,{writable:!0,value:void 0}),un(this,kn,{writable:!0,value:6}),un(this,Mn,{writable:!0,value:1.3*wn(this,bn)}),un(this,Sn,{writable:!0,value:n.CR.translate(wn(this,bn),wn(this,bn))}),un(this,Wn,{writable:!0,value:void 0}),pn(this,_n,t),pn(this,Wn,e),pn(this,fn,i),pn(this,yn,1.4*wn(this,fn))}_correctTextBox(t,e,i){const s=(0,a.Z)(i),n=s.select("text"),r=t.label.split("|");n.text("").attr("dy",0).attr("transform",wn(this,Sn).toString()).style("font-size",`${wn(this,fn)}px`);for(const[t,e]of r.entries()){const i=n.append("tspan").html(e);t>0&&i.attr("x",0).attr("dy",wn(this,yn))}const o=n.node().getBBox(),l=t.label?o.width+2*wn(this,Mn):0,h=t.label?o.height+wn(this,Mn):0;s.select("rect").attr("width",l).attr("height",h).attr("class","svg-shadow");const d=s.select("circle").attr("r",0===e||e===wn(this,mn)?4*wn(this,gn):wn(this,gn)).attr("class","click-circle svg-shadow "+(0===e||e===wn(this,mn)?"drag-hidden":"drag-circle"));s.append((()=>d.remove().node()))}_correctJourney(){wn(this,_n).selectAll("#journey g.labels g.label").each(((t,e,i)=>{this._correctTextBox(t,e,i[e])})),wn(this,Wn)&&wn(this,Wn).style("stroke-width",`${wn(this,kn)}px`)}print(t){const e=(0,hn.Z)().padding(wn(this,bn)).value((t=>{const e=t.label.split("|"),i=e.reduce(((t,e,i,a)=>a[t].length>e.length?t:i),0);return e[i]})),i=(0,dn.Z)(),a=(0,cn.Z)(i).size(((t,e,i)=>{const a=t.label.split("|").length,s=i[e].querySelectorAll("text")[0].getBBox();return[s.width+2*wn(this,bn),s.height*a+2*wn(this,bn)]})).position((t=>t.position)).component(e);wn(this,_n).datum(t).call(a),pn(this,mn,t.length-1),this._correctJourney()}}function xn(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function $n(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Pn(t,e,"get"))}function Dn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Pn(t,e,"set"),i),i}function Pn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Cn=new WeakMap,In=new WeakMap,Ln=new WeakMap,En=new WeakMap,Zn=new WeakMap,Nn=new WeakMap,An=new WeakMap,jn=new WeakMap,zn=new WeakMap,Bn=new WeakMap,Fn=new WeakMap,Rn=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,qn=new WeakMap,Hn=new WeakMap,On=new WeakMap,Yn=new WeakMap,Kn=new WeakMap,Un=new WeakMap,Xn=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,tr=new WeakMap,er=new WeakMap,ir=new WeakMap,ar=new WeakMap;class sr{constructor(t){xn(this,Cn,{writable:!0,value:{}}),xn(this,In,{writable:!0,value:{}}),xn(this,Ln,{writable:!0,value:{}}),xn(this,En,{writable:!0,value:{}}),xn(this,Zn,{writable:!0,value:{}}),xn(this,Nn,{writable:!0,value:{}}),xn(this,An,{writable:!0,value:{}}),xn(this,jn,{writable:!0,value:void 0}),xn(this,zn,{writable:!0,value:void 0}),xn(this,Bn,{writable:!0,value:void 0}),xn(this,Fn,{writable:!0,value:"journey-arrow"}),xn(this,Rn,{writable:!0,value:5}),xn(this,Vn,{writable:!0,value:void 0}),xn(this,Gn,{writable:!0,value:"Make journey"}),xn(this,qn,{writable:!0,value:void 0}),xn(this,Hn,{writable:!0,value:90}),xn(this,On,{writable:!0,value:"None"}),xn(this,Yn,{writable:!0,value:19}),xn(this,Kn,{writable:!0,value:0}),xn(this,Un,{writable:!0,value:X.er/60}),xn(this,Xn,{writable:!0,value:15}),xn(this,Jn,{writable:!0,value:void 0}),xn(this,Qn,{writable:!0,value:void 0}),xn(this,tr,{writable:!0,value:void 0}),xn(this,er,{writable:!0,value:2}),xn(this,ir,{writable:!0,value:2}),xn(this,ar,{writable:!0,value:void 0}),Dn(this,Vn,(0,X.MF)($n(this,Gn))),Dn(this,tr,`menu-${$n(this,Vn)}`),Dn(this,qn,`compass-${$n(this,Vn)}`),Dn(this,Jn,`button-delete-leg-${$n(this,Vn)}`),Dn(this,Qn,(0,js.Z)().x((t=>t[0])).y((t=>t[1]))),Dn(this,ar,(0,c.Z)().domain((0,Ns.Z)(0,o.QF,$n(this,Xn)))),this._setupDrag(),this._setupSvg(),this._initJourneyData(),Dn(this,jn,new Tn($n(this,Nn),$n(this,Zn),t)),Dn(this,Bn,new ln($n(this,Jn))),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0===e?"":(0,X.gY)(e,"hour");a+=t+(""===t?"":" ")+(0===i?"":(0,X.gY)(i,"minute"))}return a}_setupDrag(){const t=t=>{this._removeLabels(),(0,a.Z)(t).classed("drag-active",!0)},e=(t,e,i)=>{const s=i.position[0]+Number(e.dx),n=i.position[1]+Number(e.dy);0===i.index&&$n(this,Cn).attr("x",s).attr("y",n),(0,a.Z)(t).attr("cx",e.x).attr("cy",e.y),i.position=[s,n],this._printLines()},i=t=>{(0,a.Z)(t).classed("drag-active",!1),this._printWholeJourney()};Dn(this,In,(0,As.Z)().on("start",(function(){t(this)})).on("drag",(function(t,i){e(this,t,i)})).on("end",(function(){i(this)})))}_setupSvg(){const t=$n(this,Rn),e=2*$n(this,Rn);Dn(this,Ln,(0,a.Z)("#ports").append("g").attr("id","journey").attr("class","svg-background-dark")),Dn(this,Zn,$n(this,Ln).append("path")),Dn(this,Nn,$n(this,Ln).append("g").attr("class","labels")),(0,a.Z)("#na-svg defs").append("marker").attr("id",$n(this,Fn)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-light").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){Dn(this,An,{shipName:$n(this,On),startWindDegrees:$n(this,Kn),currentWindDegrees:$n(this,Kn),totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]})}_resetJourneyData(){var t;$n(this,An).startWindDegrees=(null===(t=$n(this,zn))||void 0===t?void 0:t.getWind())??$n(this,Kn),$n(this,An).currentWindDegrees=$n(this,An).startWindDegrees,$n(this,An).totalDistance=0,$n(this,An).totalMinutes=0}async _menuClicked(){(0,r.KS)("Menu",$n(this,Gn)),$n(this,zn)?$n(this,zn).show():(Dn(this,zn,new Us($n(this,Gn))),await $n(this,zn).init(),$n(this,zn).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){document.querySelector(`#${$n(this,tr)}`).addEventListener("click",(()=>{this._menuClicked()})),document.querySelector(`#${$n(this,Jn)}`).addEventListener("click",(()=>{this._deleteLastLeg()}))}_useUserInput(){this._setShipName(),this._printWholeJourney(),this._printSummary()}_printCompass(){const t=$n(this,An).segments[0].position[0],e=$n(this,An).segments[0].position[1];Dn(this,Cn,$n(this,Ln).insert("svg","path").attr("id",$n(this,qn)).attr("class","fill-background-colour").attr("x",t).attr("y",e)),Dn(this,En,$n(this,Cn).append("g")),(0,j.$G)({element:$n(this,En),radius:$n(this,Hn)})}_removeCompass(){$n(this,Cn).remove()}_getSpeedAtDegrees(t){return Math.max($n(this,ar).call(this,t)??0,$n(this,er))}_calculateDistanceForSection(t,e){const i=(o.QF-t+e)%o.QF;return this._getSpeedAtDegrees(i)*$n(this,ir)*o.nX}_setShipSpeed(){var t;const e=(null===(t=$n(this,zn))||void 0===t?void 0:t.getSpeedDegrees())??Array.from({length:24},(()=>$n(this,Yn)/2));$n(this,ar).range(e)}_calculateMinutesForSegment(t,e,i){let a=i,s=e,n=0;for(this._setShipSpeed();a>0;){const e=this._calculateDistanceForSection(t,s);a>e?(a-=e,n+=1):(n+=a/e,a=0),s=(o.QF+s-$n(this,Un))%o.QF}return $n(this,An).currentWindDegrees=s,n}_setShipName(){const t=$n(this,zn).getShipName();$n(this,An).shipName=t||$n(this,On)}_removeLabels(){const t=$n(this,Ln).selectAll("#journey g.label");t.select("text").remove(),t.select("rect").remove()}_printSummary(){$n(this,Bn).print($n(this,An))}_printLines(){$n(this,Zn)&&$n(this,Zn).datum($n(this,An).segments.length>1?$n(this,An).segments.map((t=>t.position)):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("class","svg-shadow").attr("d",$n(this,Qn))}_getTextDirection(t,e,i){return`${(0,j.Iy)(t,!0)} ⁖ F11: ${(0,u.Hu)((0,o.IK)(i.x,i.y))} / ${(0,u.Hu)((0,o.pw)(i.x,i.y))}`}_getTextDistance(t,e,i){let a=`${Math.round(t)} k ${sr._getHumanisedDuration(e)}`;return i&&(a+=`⁖ total ${Math.round($n(this,An).totalDistance)} k ${sr._getHumanisedDuration($n(this,An).totalMinutes)}`),a}_calculateSegmentLabel(t){const e={x:$n(this,An).segments[t].position[0],y:$n(this,An).segments[t].position[1]},i={x:$n(this,An).segments[t-1].position[0],y:$n(this,An).segments[t-1].position[1]},a=(0,j.Fq)(e,i),s=(0,o.Sp)(e,i),n=(0,o.tT)(a),r=this._calculateMinutesForSegment(a,$n(this,An).currentWindDegrees,1e3*s);$n(this,An).totalDistance+=s,$n(this,An).totalMinutes+=r;const l=this._getTextDirection(n,a,e),h=this._getTextDistance(s,r,t>1);$n(this,An).segments[t].label=`${l}|${h}`}_setSegmentLabels(t){if(t)this._calculateSegmentLabel($n(this,An).segments.length-1);else for(const[t]of $n(this,An).segments.entries())t<$n(this,An).segments.length-1&&this._calculateSegmentLabel(t+1)}_print(t){this._printLines(),this._setSegmentLabels(t),$n(this,jn).print($n(this,An).segments),$n(this,Ln).selectAll("#journey g.labels g.label circle").call($n(this,In))}_printAdditionalSegment(){this._print(!0)}_printWholeJourney(){this._resetJourneyData(),this._print(!1)}_deleteLastLeg(){$n(this,An).segments.pop(),$n(this,An).segments.length>0?this._printWholeJourney():($n(this,Bn).hide(),$n(this,Ln).selectAll("#journey g.labels g.label").remove(),$n(this,Zn).remove(),this._removeCompass(),this._initJourneyData())}_initJourney(){$n(this,Bn).show(),this._printSummary(),this._printCompass()}setSummaryPosition(t,e){$n(this,Bn).setPosition(t,e)}plotCourse(t,e){$n(this,An).segments[0].position[0]>0?($n(this,An).segments.push({position:[t,e],label:"",index:$n(this,An).segments.length}),this._printAdditionalSegment()):($n(this,An).segments[0]={position:[t,e],label:"",index:0},this._initJourney())}}var nr=i(9157),rr=i(6411),or=i(1739),lr=i(9488);function hr(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function dr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ur(t,e,"get"))}function cr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ur(t,e,"set"),i),i}function ur(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(qe());var pr=new WeakMap,wr=new WeakMap,vr=new WeakMap,mr=new WeakMap,gr=new WeakMap,fr=new WeakMap,_r=new WeakMap,br=new WeakMap,yr=new WeakMap,kr=new WeakMap,Mr=new WeakMap,Sr=new WeakMap,Wr=new WeakMap,Tr=new WeakMap,xr=new WeakMap,$r=new WeakMap,Dr=new WeakMap,Pr=new WeakMap,Cr=new WeakMap,Ir=new WeakMap,Lr=new WeakMap,Er=new WeakMap,Zr=new WeakMap,Nr=new WeakMap,Ar=new WeakMap,jr=new WeakMap,zr=new WeakMap,Br=new WeakMap,Fr=new WeakMap,Rr=new WeakMap,Vr=new WeakMap,Gr=new WeakMap,qr=new WeakMap,Hr=new WeakMap,Or=new WeakMap,Yr=new WeakMap;class Kr{constructor(t,e,i){this.map=t,this.serverId=e,this.coord=i,hr(this,pr,{writable:!0,value:void 0}),hr(this,wr,{writable:!0,value:void 0}),hr(this,vr,{writable:!0,value:"Power map"}),hr(this,mr,{writable:!0,value:void 0}),hr(this,gr,{writable:!0,value:0}),hr(this,fr,{writable:!0,value:{}}),hr(this,_r,{writable:!0,value:{}}),hr(this,br,{writable:!0,value:0}),hr(this,yr,{writable:!0,value:-1}),hr(this,kr,{writable:!0,value:0}),hr(this,Mr,{writable:!0,value:0}),hr(this,Sr,{writable:!0,value:{}}),hr(this,Wr,{writable:!0,value:0}),hr(this,Tr,{writable:!0,value:{}}),hr(this,xr,{writable:!0,value:{}}),hr(this,$r,{writable:!0,value:{}}),hr(this,Dr,{writable:!0,value:0}),hr(this,Pr,{writable:!0,value:0}),hr(this,Cr,{writable:!0,value:{}}),hr(this,Ir,{writable:!0,value:{}}),hr(this,Lr,{writable:!0,value:0}),hr(this,Er,{writable:!0,value:new Map}),hr(this,Zr,{writable:!0,value:[]}),hr(this,Nr,{writable:!0,value:{}}),hr(this,Ar,{writable:!0,value:{}}),hr(this,jr,{writable:!0,value:{}}),hr(this,zr,{writable:!0,value:{}}),hr(this,Br,{writable:!0,value:0}),hr(this,Fr,{writable:!0,value:!1}),hr(this,Rr,{writable:!0,value:{}}),hr(this,Vr,{writable:!0,value:void 0}),hr(this,Gr,{writable:!0,value:void 0}),hr(this,qr,{writable:!0,value:void 0}),hr(this,Hr,{writable:!0,value:200}),hr(this,Or,{writable:!0,value:200}),hr(this,Yr,{writable:!0,value:2}),cr(this,pr,e),cr(this,Vr,t),cr(this,wr,`show-${(0,X.MF)(dr(this,vr))}`),cr(this,mr,`menu-${dr(this,wr)}`),cr(this,qr,i),cr(this,Gr,(0,et.Z)().domain(ce.nU.map((t=>t.id))).range(ce.nU.map((t=>t.colours[0])))),this._setupListener()}_setupData(t){cr(this,jr,t.power),cr(this,br,dr(this,jr).length-1),cr(this,Ir,(0,a.Z)("g#map"))}async _loadData(){const t=[{fileName:`${this.serverId}-power.json`,name:"power"}],e={};return cr(this,Ar,(await i.e(462).then(i.t.bind(i,9131,19))).default),await(0,X.EZ)(t,e),e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}async _menuClicked(){(0,r.KS)("Tools",dr(this,vr)),await this._loadAndSetupData(),(0,X.dM)(),this._mapElementsOff(),this._initialMapZoom(),this._initVoronoi(),this._initCanvas(),this._drawPowerMap()}_setupListener(){var t;null===(t=document.querySelector(`#${dr(this,mr)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showMapElements(t){dr(this,Ir).classed("d-none",!t),(0,a.Z)("main div.overlay").classed("d-none",!t)}_mapElementsOff(){this._showMapElements(!1)}_mapElementsOn(){this._showMapElements(!0)}_drawEnd(){(0,X.V4)(),this._mapElementsOn()}async _setPattern(){const t=Object.values(X.eM);try{const e=await(0,lr.Z)(t);for(const[t,i]of e.entries())dr(this,Zr)[t]=dr(this,fr).createPattern(i,"repeat")}catch(t){console.error("One or more images have failed to load :("),console.error(t.errored),console.info("But these loaded fine:"),console.info(t.loaded)}}_drawDate(t){const e=Ve()(t).format("D MMMM YYYY");dr(this,_r).text(e)}_drawMap(t,e,i){for(const[t,e]of i.entries())dr(this,fr).beginPath(),dr(this,Rr).renderCell(t,dr(this,fr)),dr(this,fr).fillStyle=dr(this,Zr)[e]??"#000",dr(this,fr).fill();this._drawDate(e)}async _drawLoop(){let t,e;for(;!dr(this,Fr)&&dr(this,yr)<dr(this,br);){cr(this,yr,dr(this,yr)+1),this._setRangeValue(),t=dr(this,jr)[dr(this,yr)][0],e=dr(this,jr)[dr(this,yr)][1];const i=(0,or.HT)((a=>{this._drawMap(dr(this,yr),t,e),(a>dr(this,Or)||dr(this,Fr))&&i.stop()}));this._drawNationLegend(e),await(0,ce._v)(1.1*dr(this,Or))}this._drawEnd()}_drawPowerMap(){this._drawLoop()}_initVoronoi(){const t=new Set([96,112,150,179,214,231,286,343,366]),e=dr(this,Ar).filter((e=>!t.has(e.id))).map((t=>t.coordinates)),i=rr.Z.from(e);cr(this,Lr,(0,Q.Z)(e,(t=>t[1]))??dr(this,qr).max);const a=[dr(this,qr).min,dr(this,qr).min,dr(this,qr).max,dr(this,Lr)];cr(this,Rr,i.voronoi(a))}_initLegend(t){cr(this,Sr,(0,a.Z)("#na-map div").append("div").style("position","relative").style("width",`${t.width}px`).style("top",`-${t.top}px`).style("left",`${t.left}px`).attr("class","d-flex flex-column")),this._initController(),this._initNationLegend(t)}_initNationLegend(t){cr(this,Dr,Math.floor(40*o.L9)),cr(this,Pr,Math.floor(o.L9)),cr(this,kr,Math.floor(5*o.L9));const{width:e}=t,i=75+2*dr(this,kr),a=ce.nU.length*i-2*dr(this,kr);cr(this,Br,Math.ceil(a/e)),cr(this,gr,Math.ceil(ce.nU.length/dr(this,Br))),cr(this,Mr,Math.ceil(e/dr(this,gr)-2*dr(this,kr)));const s=dr(this,Sr).append("div");cr(this,$r,s.append("div")),cr(this,xr,s.append("div"))}_getTopPosition(t){let e=-1===t?-dr(this,Dr):Math.floor(t/dr(this,gr))*(10*dr(this,Pr)+dr(this,Dr));return e+=16+dr(this,Wr),`${e}px`}_getLeftPosition(t){return`${-1===t?-dr(this,Mr):Math.floor(t%dr(this,gr)*(dr(this,kr)+dr(this,Mr)))}px`}_resetOldIndex(){cr(this,Er,new Map)}_drawNationLegend(t){const e=(0,nr.Q3)(t,(t=>t.length),(t=>t)).sort(((t,e)=>e[1]-t[1]||t[0]-e[0])),i=t.length;dr(this,$r).selectAll("svg.legend").data(e,((t,e)=>String(e).padStart(2,"0")+String(t[0]).padStart(2,"0"))).join((t=>{const e=t.append("svg").attr("class","legend").attr("width",dr(this,Mr)).attr("height",dr(this,Dr)+dr(this,Pr)).style("position","absolute").style("top",(t=>this._getTopPosition(dr(this,Er).get(t[0])??-1))).style("left",(t=>this._getLeftPosition(dr(this,Er).get(t[0])??-1))).transition().duration(dr(this,Or)).style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e))).selection();return e.append("rect").attr("class","nation-header").attr("width",dr(this,Mr)).attr("height",Math.floor(dr(this,Dr)/2)).style("fill",(t=>dr(this,Gr).call(this,t[0]))),e.append("text").attr("class","nation-name").attr("x",Math.floor(dr(this,kr)/2)).attr("y","25%").html((t=>{var e;return`${null===(e=(0,ce.dx)(t[0]))||void 0===e?void 0:e.sortName}`})).style("fill",(t=>(0,bi.IF)(dr(this,Gr).call(this,t[0])))),e.append("rect").attr("class","opacity-low").attr("y",Math.floor(dr(this,Dr)/2+dr(this,Pr))).attr("width","100%").attr("height",Math.floor(dr(this,Dr)/2)).style("fill",(t=>dr(this,Gr).call(this,t[0]))),e.append("rect").attr("class","value").attr("y",Math.floor(dr(this,Dr)/2+dr(this,Pr))).attr("height",Math.floor(dr(this,Dr)/2)).attr("width",(t=>dr(this,Mr)*(t[1]/i))).style("fill",(t=>dr(this,Gr).call(this,t[0]))),e.append("text").attr("class","value").attr("x",dr(this,Mr)-dr(this,kr)).attr("y","75%").style("text-anchor","end").html((t=>(0,u.Dw)(t[1],!0))),e}),(t=>(t.select("rect.value").attr("width",(t=>dr(this,Mr)*(t[1]/i))).style("fill",(t=>dr(this,Gr).call(this,t[0]))),t.select("text.value").html((t=>(0,u.Dw)(t[1],!0))),t))),dr(this,xr).selectAll("svg.index").data(e,((t,e)=>e)).join((t=>{const e=t.append("svg").attr("class","index").attr("width",dr(this,Mr)).attr("height",dr(this,Dr)+dr(this,Pr)).style("position","absolute").style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e)));return e.append("text").attr("x",dr(this,Mr)/2).attr("y",(dr(this,Dr)+dr(this,Pr))/2).attr("fill",X.L$).attr("opacity",0).attr("text-anchor","middle").attr("dominant-baseline","mathematical").attr("font-variant","normal").attr("font-size",`${dr(this,Dr)}px`).text(((t,e)=>e+1)).transition().duration(dr(this,Or)).attr("opacity",.3).selection(),e}),(t=>t),(t=>t.attr("opacity",.3).transition().duration(dr(this,Or)).attr("opacity",0).remove().selection())),this._resetOldIndex();for(const[t,i]of e.entries())dr(this,Er).set(i[0],t)}_getRangeValue(){return dr(this,zr).property("value")}_setRangeValue(){dr(this,zr).property("value",dr(this,yr))}_updateRangeValue(t=!1){cr(this,yr,Number.parseFloat(this._getRangeValue())),this._updateController(t)}_initRange(t){const e=`range-${dr(this,wr)}`,i=t.append("div").attr("class","row col-md-7 mb-0");cr(this,zr,i.append("div").attr("class","col-md-5").append("input").attr("id",e).attr("type","range").attr("class","form-range px-md-2").attr("style","height:100%").attr("min","0").attr("max",String(dr(this,br)))),i.append("div").attr("class","col-md-1"),cr(this,_r,i.append("label").attr("for",e).attr("class","col-md-6 col-form-label").attr("style","font-size:120%").attr("title","Date").text("Start"));let a=!1;dr(this,zr).on("change",(()=>{this._updateRangeValue()})).on("mousedown",(()=>{a=!0,cr(this,Fr,!0),this._togglePlayButton()})).on("mousemove",(()=>{a&&this._updateRangeValue(!0)})).on("mouseup",(()=>{a=!1}))}_getYear(t){return Ve()(dr(this,jr)[t][0]).year()}_togglePlayButton(){dr(this,Nr).classed("icon-pause",!dr(this,Fr)).classed("icon-play",dr(this,Fr))}_initialMapZoom(){dr(this,Vr).zoomAndPan(dr(this,qr).max/2,dr(this,qr).max/2,!0)}_updateController(t=!1){const e=dr(this,jr)[dr(this,yr)][0],i=dr(this,jr)[dr(this,yr)][1];this._setRangeValue(),this._drawDate(e),this._adjustControllerHeight(),cr(this,Fr,!0),this._togglePlayButton(),t||(this._resetOldIndex(),this._drawMap(dr(this,yr),e,i),this._drawNationLegend(i))}_initButtons(t){const e=`menu-${dr(this,wr)}`,i=(t,i)=>s.append("button").attr("type","button").attr("id",`${e}-${t}`).attr("class","btn btn-default icon-button p-0").attr("title",i).append("i").attr("class",`icon icon-large icon-${t}`),a=t.append("div").attr("class","btn-toolbar col-md-4").attr("role","toolbar");let s=a.append("div").attr("class","btn-group").attr("role","group");const n=i("start","Start"),r=i("back","Year back");s=a.append("div").attr("class","btn-group").attr("role","group"),cr(this,Nr,i("pause","Pause")),s=a.append("div").attr("class","btn-group me-3").attr("role","group");const o=i("forward","Year forward"),l=i("end","End");n.on("click",(()=>{cr(this,yr,0),this._updateController()})),r.on("click",(()=>{let t=dr(this,yr);const e=this._getYear(t);let i=e;for(;t>0&&i===e;t--)i=this._getYear(t);cr(this,yr,t+1),this._updateController()})),dr(this,Nr).on("click",(()=>{cr(this,Fr,!dr(this,Fr)),this._togglePlayButton(),dr(this,Fr)||this._drawLoop()})),o.on("click",(()=>{let t=dr(this,yr);const e=this._getYear(t);let i=e;for(;t<dr(this,br)&&i===e;t++)i=this._getYear(t);cr(this,yr,t-1),this._updateController()})),l.on("click",(()=>{cr(this,yr,dr(this,br)),this._updateController()})),s=a.append("div").attr("class","btn-group").attr("role","group");const h=i("slower","Slower"),d=i("normal","Normal speed"),c=i("faster","Faster");h.on("click",(()=>{cr(this,Or,dr(this,Or)*dr(this,Yr))})),d.on("click",(()=>{cr(this,Or,dr(this,Hr))})),c.on("click",(()=>{cr(this,Or,Math.max(10,dr(this,Or)/dr(this,Yr)))})),s=t.append("div").attr("class","btn-group col-md-1").attr("role","group");i("close","Close").on("click",(()=>{this._drawEnd(),dr(this,Cr).remove(),this._initialMapZoom()}))}_adjustControllerHeight(){cr(this,Wr,(0,X.Uy)(dr(this,Tr))),dr(this,Sr).selectAll("svg.legend").style("top",((t,e)=>this._getTopPosition(e))),dr(this,Sr).selectAll("svg.index").style("top",((t,e)=>this._getTopPosition(e)))}_initController(){const t=dr(this,Sr).append("div").style("background-color",X.L$).attr("class","p-2");cr(this,Tr,t.node());const e=t.append("form").append("div").attr("class","row input-group align-items-center"),i=new ResizeObserver((()=>{this._adjustControllerHeight()}));this._initRange(e),this._initButtons(e),cr(this,Wr,(0,X.Uy)(dr(this,Tr))),i.observe(dr(this,Tr))}_getTopAlignedTransform(t){var e;const{a:i,e:a}=(null===(e=t.transform.baseVal.consolidate())||void 0===e?void 0:e.matrix)||{};return i&&a?n.CR.scale(i).translate(a/i,0):{}}async _initCanvas(){const t=(0,a.Z)("#na-map svg g.map-tiles"),e=this._getTopAlignedTransform(dr(this,Ir).node()),i=this._getTopAlignedTransform(t.node());dr(this,Ir).attr("transform",e.toString()),t.attr("transform",i.toString());const s=(0,a.Z)("#na-map svg"),n=s.style("height"),r=s.style("width");cr(this,Cr,(0,a.Z)("#na-map").append("div").style("position","relative").style("top",`-${n}`).style("height","100%").style("opacity",.7));const o=dr(this,Cr).append("canvas").node();o.style.height=n,o.style.width=r,o.height=Math.floor(2*Number.parseFloat(n)),o.width=Math.floor(2*Number.parseFloat(r)),cr(this,fr,(0,X.kU)(o)),dr(this,fr).translate(2*e.x,2*e.y),dr(this,fr).scale(2*e.k,2*e.k);const l=(0,X.mx)(t.node()),h={top:Math.floor(this.map.height-dr(this,Lr)*e.k+e.y),left:e.x,width:l};this._initLegend(h),await this._setPattern()}}var Ur=i(6607),Xr=i.n(Ur),Jr=i(29);function Qr(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function to(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,io(t,e,"get"))}function eo(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,io(t,e,"set"),i),i}function io(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var ao=new WeakMap,so=new WeakMap,no=new WeakMap;class ro{constructor(t){Qr(this,ao,{writable:!0,value:{}}),Qr(this,so,{writable:!0,value:void 0}),Qr(this,no,{writable:!0,value:"port-select-pb-time"}),eo(this,so,t),this._setupSelect(),this._setupListener()}_getOptions(){return`${[...new Set(to(this,so).portData.filter((t=>t.capturable)).map((t=>t.portBattleStartTime)).sort(((t,e)=>t-e)))].map((t=>`<option value="${t}">${(0,X.Db)(t)}</option>`)).join("")}`}_setupSelect(){eo(this,ao,new Jr.Z(to(this,no),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},this._getOptions()))}_selected(){const t=String(to(this,ao).getValues());to(this,so).portData=to(this,so).portDataDefault.filter((e=>e.capturable&&e.portBattleStartTime===Number(t))),to(this,so).showRadius="",to(this,so).update()}_setupListener(){to(this,ao).select$.on("change",(async()=>{(0,r.KS)("Menu",to(this,no)),this._selected()}))}}function oo(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function lo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,co(t,e,"get"))}function ho(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,co(t,e,"set"),i),i}function co(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var uo=new WeakMap,po=new WeakMap,wo=new WeakMap,vo=new WeakMap;class mo{constructor(t){oo(this,uo,{writable:!0,value:"Show goods’ relations"}),oo(this,po,{writable:!0,value:void 0}),oo(this,wo,{writable:!0,value:void 0}),oo(this,vo,{writable:!0,value:{}}),ho(this,wo,t),ho(this,po,`port-select-${(0,X.MF)(lo(this,uo))}`),this._setupSelect(),this._setupListener()}_getOptions(){const t=new Map,e=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const a of lo(this,wo).portDataDefault)for(const s of e){const e=a[s];if(e)for(const a of e){var i;t.set(a,(null===(i=lo(this,wo).portIcons.getTradeItem(a))||void 0===i?void 0:i.name)??"")}}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){ho(this,vo,new Jr.Z(lo(this,po),void 0,{},""))}_setupListener(){lo(this,vo).select$.one("show.bs.select",(()=>{lo(this,vo).setOptions(this._getOptions()),lo(this,vo).reset()})),lo(this,vo).select$.on("change",(()=>{(0,r.KS)("Menu",lo(this,uo)),Jr.Z.resetAllExcept([lo(this,vo).select$]),this._selectSelected()}))}_selectSelected(){const t=Number(lo(this,vo).getValues()),e=JSON.parse(JSON.stringify(lo(this,wo).portDataDefault.filter((e=>{var i,a,s;return(null===(i=e.dropsTrading)||void 0===i?void 0:i.includes(t))||(null===(a=e.dropsNonTrading)||void 0===a?void 0:a.includes(t))||(null===(s=e.producesNonTrading)||void 0===s?void 0:s.includes(t))})))).map((t=>(t.isSource=!0,t))),i=JSON.parse(JSON.stringify(lo(this,wo).portDataDefault.filter((e=>{var i;return null===(i=e.consumesTrading)||void 0===i?void 0:i.includes(t)})))).map((t=>(t.isSource=!1,t)));lo(this,wo).setShowRadiusSetting("off"),lo(this,wo).portData=[...e,...i],lo(this,wo).showRadius="currentGood",lo(this,wo).update()}}function go(t,e,i){fo(t,e),e.set(t,i)}function fo(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function _o(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function bo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ko(t,e,"get"))}function yo(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ko(t,e,"set"),i),i}function ko(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Mo=new WeakMap,So=new WeakMap,Wo=new WeakMap,To=new WeakMap,xo=new WeakMap,$o=new WeakMap,Do=new WeakMap,Po=new WeakMap,Co=new WeakSet;class Io{constructor(t){var e,i;fo(e=this,i=Co),i.add(e),go(this,Mo,{writable:!0,value:"Show trade relations"}),go(this,So,{writable:!0,value:void 0}),go(this,Wo,{writable:!0,value:new Map}),go(this,To,{writable:!0,value:{}}),go(this,xo,{writable:!0,value:{}}),go(this,$o,{writable:!0,value:void 0}),go(this,Do,{writable:!0,value:void 0}),go(this,Po,{writable:!0,value:new ce.y0}),yo(this,Do,t),yo(this,$o,bo(this,Do).portData.length),yo(this,So,`port-select-${(0,X.MF)(bo(this,Mo))}`),this._setupSelect(),this._setupListener()}_getOptions(){return`${bo(this,Do).portDataDefault.map((t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}))).sort((0,ce.MR)(["name"])).map((t=>`<option data-icon="flag-icon-${t.nation} flag-icon-small" value="${t.coord.toString()}/${t.id}">${t.name}</option>`)).join("")}`}_setupSelect(){yo(this,To,new Jr.Z(bo(this,So),void 0,{},""))}_setupListener(){bo(this,To).select$.one("show.bs.select",(()=>{bo(this,To).setOptions(this._getOptions()),bo(this,To).reset()})),bo(this,To).select$.one("change",(async()=>{await this._loadData()})),bo(this,To).select$.on("change",(()=>{(0,r.KS)("Menu",bo(this,Mo)),Jr.Z.resetAllExcept([bo(this,To).select$]),this._selectSelected()}))}async _loadData(){const t=(await i.e(971).then(i.t.bind(i,6720,19))).default;yo(this,Wo,new Map(t.map((([t,e,i])=>[t*bo(this,$o)+e,i]))))}_setTradePortPartners(){yo(this,xo,bo(this,Do).portDataDefault.find((t=>t.id===bo(this,Do).portIcons.tradePort.id))??{}),bo(this,xo).id&&this._setTradeRelations()}_getSailingDistance(t,e){return t<e?bo(this,Wo).get(t*bo(this,$o)+e)??0:bo(this,Wo).get(e*bo(this,$o)+t)??0}_getBuyPrice(t){var e;return(null===(e=bo(this,Do).portIcons.getTradeItem(t))||void 0===e?void 0:e.buyPrice)??0}_getSellPrice(t){var e;return(null===(e=bo(this,Do).portIcons.getTradeItem(t))||void 0===e?void 0:e.sellPrice)??0}_getWeight(t){var e;return(null===(e=bo(this,Do).portIcons.getTradeItem(t))||void 0===e?void 0:e.weight)??0}_getDistanceFactor(t){var e;return(null===(e=bo(this,Do).portIcons.getTradeItem(t))||void 0===e?void 0:e.distanceFactor)??0}_getPortTax(t){var e;return(null===(e=bo(this,Do).portDataDefault.find((e=>e.id===t)))||void 0===e?void 0:e.portTax)??0}_getCoordinates(t){const e=bo(this,Do).portDataDefault.find((e=>e.id===t));return{x:(null==e?void 0:e.coordinates[0])??0,y:(null==e?void 0:e.coordinates[1])??0}}_getPlanarDistance(t,e){const i=this._getCoordinates(t),a=this._getCoordinates(e);return(0,o.Sp)(i,a)}_findClosestSourcePort(t,e){let i=Number.POSITIVE_INFINITY;const a=new Set(bo(this,Do).portDataDefault.filter((t=>{var i,a;return(null===(i=t.dropsTrading)||void 0===i?void 0:i.includes(e))??(null===(a=t.dropsNonTrading)||void 0===a?void 0:a.includes(e))})).map((t=>t.id)));for(const e of a)i=Math.min(i,this._getPlanarDistance(e,t.id));return i}_calculateSellProfit(t,e,i){const a=this._findClosestSourcePort(e,i),s=this._getPortTax(t.id),n=this._getPortTax(e.id);let r=this._getBuyPrice(i),o=this._getSellPrice(i)+a*r*this._getDistanceFactor(i)/1050;r*=1+s,o/=1+n;const l=Math.round(o-r);return{profit:l,profitPerTon:Math.round(l/this._getWeight(i))}}_getProfit(t,e,i){const a=[e.id,i];return bo(this,Po).has(a)||bo(this,Po).set(a,this._calculateSellProfit(t,e,i)),bo(this,Po).get(a)}_getGoodsToBuyInTradePort(t){var e,i;const a=new Set(null===(e=bo(this,xo).dropsTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.consumesTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=bo(this,Do).portIcons.getTradeItem(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(bo(this,xo),t,e)}})))??[]}_getGoodsToSellInTradePort(t){var e,i;const a=new Set(null===(e=bo(this,xo).consumesTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.dropsTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=bo(this,Do).portIcons.getTradeItem(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(t,bo(this,xo),e)}})))??[]}_setTradeRelations(){bo(this,Po).clear(),bo(this,Do).portData=bo(this,Do).portDataDefault.map((t=>(t.sailingDistanceToTradePort=this._getSailingDistance(t.id,bo(this,xo).id),t.goodsToBuyInTradePort=this._getGoodsToBuyInTradePort(t),t.buyInTradePort=t.goodsToBuyInTradePort.length>0,t.goodsToSellInTradePort=this._getGoodsToSellInTradePort(t),t.sellInTradePort=t.goodsToSellInTradePort.length>0,t))).filter((t=>t.id===bo(this,Do).portIcons.tradePort.id||t.sellInTradePort||t.buyInTradePort))}_selectSelected(){const t=String(bo(this,To).getValues()),[e,i]=t.split("/"),[a,s]=e.split(",");bo(this,Do).currentPort={id:Number(i),coord:{x:Number(a),y:Number(s)}},bo(this,Do).portIcons.tradePort={id:Number(i),name:_o(this,Co,Lo).call(this,Number(i))},this._setTradePortPartners(),bo(this,Do).showRadius="tradePorts",bo(this,Do).update()}}function Lo(t){var e;return(null===(e=bo(this,Do).portDataDefault.find((e=>e.id===t)))||void 0===e?void 0:e.name)??""}function Eo(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Zo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ao(t,e,"get"))}function No(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ao(t,e,"set"),i),i}function Ao(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var jo=new WeakMap,zo=new WeakMap,Bo=new WeakMap,Fo=new WeakMap,Ro=new WeakMap,Vo=new WeakMap;class Go{constructor(t){var e,i,a;Eo(this,jo,{writable:!0,value:{}}),Eo(this,zo,{writable:!0,value:{}}),Eo(this,Bo,{writable:!0,value:{}}),Eo(this,Fo,{writable:!0,value:void 0}),Eo(this,Ro,{writable:!0,value:"port-select-clan"}),Eo(this,Vo,{writable:!0,value:"port-select-nation"}),a=(t=!0)=>`${ce.nU.filter((e=>!(!t&&("FT"===e.short||"NT"===e.short)))).sort((0,ce.MR)(["name"])).map((t=>`<option value="${t.short}">${t.name}</option>`)).join("")}`,(i="_getNationOptions")in(e=this)?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,No(this,Fo,t),this._setupSelects(),this._setupListener()}_capsOn(){Zo(this,zo).classList.add("caps")}_capsOff(){Zo(this,zo).classList.remove("caps")}_setupNationSelect(){const t=this._getNationOptions(!0);No(this,Bo,new Jr.Z(Zo(this,Vo),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},t))}_getClanOptions(){const t=new Set;for(const e of Zo(this,Fo).portData.filter((t=>t.capturer)))t.add(e.capturer);return t.size>0?`${[...t].sort(ce.I4).map((t=>`<option value="${t}" class="caps">${t}</option>`)).join("")}`:""}_setupClanSelect(){var t,e;const i=this._getClanOptions();No(this,jo,new Jr.Z(Zo(this,Ro),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},i)),No(this,zo,null===(t=Zo(this,jo).select$.get(0))||void 0===t||null===(e=t.parentNode)||void 0===e?void 0:e.querySelector("button"))}_setupSelects(){this._setupNationSelect(),this._setupClanSelect()}_clanSelected(){const t=String(Zo(this,jo).getValues());this._capsOn(),t&&(Zo(this,Fo).portData=Zo(this,Fo).portDataDefault.filter((e=>e.capturer===t))),Zo(this,Fo).showRadius="",Zo(this,Fo).update()}_clanRefresh(){const t=this._getClanOptions();this._capsOff(),Zo(this,jo).setOptions(t),Zo(this,jo).reset(),""===t?Zo(this,jo).disable():Zo(this,jo).enable()}_nationSelected(){const t=String(Zo(this,Bo).getValues());(0,ce.mP)(t)&&(Zo(this,Fo).portData=Zo(this,Fo).portDataDefault.filter((e=>e.nation===t)),Zo(this,Fo).showRadius="",Zo(this,Fo).update())}_setupListener(){Zo(this,jo).select$.on("change",(async()=>{(0,r.KS)("Menu",Zo(this,Vo)),Jr.Z.resetAllExcept([Zo(this,jo).select$,Zo(this,Bo).select$]),this._clanSelected()})),Zo(this,Bo).select$.on("change",(async()=>{(0,r.KS)("Menu",Zo(this,Ro)),Jr.Z.resetAllExcept([Zo(this,jo).select$,Zo(this,Bo).select$]),this._nationSelected(),this._clanRefresh()}))}refreshSelect(){Zo(this,Bo).reset(),this._clanRefresh()}}function qo(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Ho(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Yo(t,e,"get"))}function Oo(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Yo(t,e,"set"),i),i}function Yo(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(qe()),Ve().extend(Xr()),Ve().extend(Ke()),Ve().locale("en-gb");var Ko=new WeakMap,Uo=new WeakMap;class Xo{constructor(t){qo(this,Ko,{writable:!0,value:void 0}),qo(this,Uo,{writable:!0,value:void 0}),Oo(this,Uo,t),new Io(t),new mo(t),Oo(this,Ko,new Go(t)),new ro(t),this._setupListener()}_setupListener(){var t,e,i,a,s,n,r,o;null===(t=document.querySelector("#menu-prop-deep"))||void 0===t||t.addEventListener("click",(()=>{Jr.Z.resetAll(),this._depthSelected("deep")})),null===(e=document.querySelector("#menu-prop-shallow"))||void 0===e||e.addEventListener("click",(()=>{Jr.Z.resetAll(),this._depthSelected("shallow")})),null===(i=document.querySelector("#menu-prop-all"))||void 0===i||i.addEventListener("click",(()=>{Jr.Z.resetAll(),this._allSelected()})),null===(a=document.querySelector("#menu-prop-non-capturable"))||void 0===a||a.addEventListener("click",(()=>{Jr.Z.resetAll(),this._nonCapSelected()})),null===(s=document.querySelector("#menu-prop-today"))||void 0===s||s.addEventListener("click",(()=>{Jr.Z.resetAll(),this._capturedToday()})),null===(n=document.querySelector("#menu-prop-yesterday"))||void 0===n||n.addEventListener("click",(()=>{Jr.Z.resetAll(),this._capturedYesterday()})),null===(r=document.querySelector("#menu-prop-this-week"))||void 0===r||r.addEventListener("click",(()=>{Jr.Z.resetAll(),this._capturedThisWeek()})),null===(o=document.querySelector("#menu-prop-last-week"))||void 0===o||o.addEventListener("click",(()=>{Jr.Z.resetAll(),this._capturedLastWeek()})),(0,X.ye)("selectPortNavbar")}_depthSelected(t){const e=Ho(this,Uo).portDataDefault.filter((e=>"shallow"===t?e.shallow:!e.shallow));Ho(this,Uo).portData=e,Ho(this,Uo).showRadius="",Ho(this,Uo).update()}_allSelected(){const t=Ho(this,Uo).portDataDefault.filter((t=>t.availableForAll));Ho(this,Uo).portData=t,Ho(this,Uo).showRadius="",Ho(this,Uo).update()}_nonCapSelected(){const t=Ho(this,Uo).portDataDefault.filter((t=>!t.capturable));Ho(this,Uo).portData=t,Ho(this,Uo).showRadius="",Ho(this,Uo).update()}_filterCaptured(t,e){const i=Ho(this,Uo).portDataDefault.filter((i=>Ve()(i.captured,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]")));Ho(this,Uo).portData=i,Ho(this,Uo).showRadius="",Ho(this,Uo).update()}_capturedToday(){const t=Ve().utc();let e=Ve()().utc().hour(l.WF).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,Ve().utc(e).add(1,"day"))}_capturedYesterday(){const t=Ve().utc();let e=Ve()().utc().hour(l.WF).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,Ve().utc(e).add(1,"day"))}_capturedThisWeek(){const t=Ve()().utc().startOf("week"),e=t.utc().hour(l.WF),i=Ve()(t).utc().add(7,"day").hour(l.WF);this._filterCaptured(e,i)}_capturedLastWeek(){const t=Ve()().utc().startOf("week"),e=Ve()(t).utc().subtract(7,"day").hour(l.WF),i=t.utc().hour(l.WF);this._filterCaptured(e,i)}clearMap(){Ho(this,Ko).refreshSelect()}}function Jo(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Qo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,el(t,e,"get"))}function tl(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,el(t,e,"set"),i),i}function el(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var il=new WeakMap,al=new WeakMap,sl=new WeakMap,nl=new WeakMap,rl=new WeakMap,ol=new WeakMap,ll=new WeakMap,hl=new WeakMap;class dl extends zs.Z{constructor(t){super(t,"sm"),Jo(this,il,{writable:!0,value:void 0}),Jo(this,al,{writable:!0,value:void 0}),Jo(this,sl,{writable:!0,value:void 0}),Jo(this,nl,{writable:!0,value:void 0}),Jo(this,rl,{writable:!0,value:void 0}),Jo(this,ol,{writable:!0,value:{}}),Jo(this,ll,{writable:!0,value:void 0}),Jo(this,hl,{writable:!0,value:void 0}),tl(this,al,`${this.baseId}-form`),tl(this,nl,`${this.baseId}-input-x`),tl(this,rl,`${this.baseId}-input-y`),tl(this,il,`${this.baseId}-copy-coord`),tl(this,sl,`${this.baseId}-submit`),this._init()}_init(){var t,e;this._injectModal(),tl(this,ll,document.querySelector(`#${Qo(this,nl)}`)),tl(this,hl,document.querySelector(`#${Qo(this,rl)}`)),null===(t=document.querySelector(`#${this.id}`))||void 0===t||t.addEventListener("keydown",(t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)})),null===(e=document.querySelector(`#${Qo(this,il)}`))||void 0===e||e.addEventListener("click",(t=>{this._copyCoordClicked(t)}))}_injectModal(){const t=super.bodySel;super.removeFooter();const e=t.append("form").attr("id",Qo(this,al)).attr("role","form");tl(this,ol,e.node());const i=e.append("div").attr("class","form-floating");i.append("input").attr("class","form-control").attr("id",Qo(this,nl)).attr("type","number").attr("required","").attr("placeholder","X coordinate in k").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),i.append("label").attr("for",Qo(this,nl)).text("X coordinate in k");const a=e.append("div").attr("class","form-floating");a.append("input").attr("class","form-control").attr("id",Qo(this,rl)).attr("type","number").attr("required","").attr("placeholder","Z coordinate in k").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),a.append("label").attr("for",Qo(this,rl)).text("Z coordinate in k"),e.append("div").attr("class","form-text mt-1 mb-3").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const s=e.append("div").classed("float-end",!0).attr("role","group");s.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",Qo(this,il)).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),s.append("button").attr("class","btn").attr("id",Qo(this,sl)).attr("title","Go to").attr("type","submit").text("Go to")}_getInputValue(t){return null!=t&&t.value?Number(t.value):Number.POSITIVE_INFINITY}getXCoord(){return this._getInputValue(Qo(this,ll))}getZCoord(){return this._getInputValue(Qo(this,hl))}_copyCoordClicked(t){(0,r.KS)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this.getXCoord(),i=this.getZCoord();(0,j.A1)(e,i,super.getModalNode())}showModal(){var t,e;super.show(),null===(t=Qo(this,ll))||void 0===t||t.focus(),null===(e=Qo(this,ll))||void 0===e||e.select()}get formSel(){return Qo(this,ol)}}function cl(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function ul(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,wl(t,e,"get"))}function pl(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,wl(t,e,"set"),i),i}function wl(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(qe()),Ve().extend(Ke());var vl=new WeakMap,ml=new WeakMap,gl=new WeakMap,fl=new WeakMap,_l=new WeakMap,bl=new WeakMap,yl=new WeakMap;class kl{constructor(t,e){cl(this,vl,{writable:!0,value:void 0}),cl(this,ml,{writable:!0,value:"Go to F11"}),cl(this,gl,{writable:!0,value:void 0}),cl(this,fl,{writable:!0,value:void 0}),cl(this,_l,{writable:!0,value:void 0}),cl(this,bl,{writable:!0,value:{}}),cl(this,yl,{writable:!0,value:void 0}),pl(this,fl,t),pl(this,gl,e),pl(this,vl,(0,X.MF)(ul(this,ml))),pl(this,_l,`menu-${ul(this,vl)}`),this._setupSvg(),this._setupListener()}_setupSvg(){pl(this,bl,(0,a.Z)("#map").append("g").attr("data-ui-component","f11"))}_menuClicked(){(0,r.KS)("Menu",ul(this,ml)),ul(this,yl)?ul(this,yl).showModal():(pl(this,yl,new dl(ul(this,ml))),ul(this,yl).formSel.addEventListener("submit",(t=>{ul(this,yl).hide(),t.preventDefault(),this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${ul(this,_l)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()})),window.addEventListener("keydown",(t=>{"F11"===t.code&&t.shiftKey&&this._menuClicked()}))}_useUserInput(){const t=-1e3*ul(this,yl).getXCoord(),e=-1e3*ul(this,yl).getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_printF11Coord(t,e,i,a){var s,n;let r=10;const o=ul(this,bl).append("g").attr("transform",`translate(${t},${e})`).attr("class","svg-background-dark fill-primary-light"),l=o.append("rect"),h=o.append("rect");o.append("circle").attr("r",r),r*=1.6;const d=o.append("text").attr("dx",-r+"px").attr("dy",-r/2-2+"px").attr("class","text-end").text((0,u.Hu)(i)),c=o.append("text").attr("dx",-r+"px").attr("dy",r/2+2+"px").attr("class","text-end").text((0,u.Hu)(a)),p=(null===(s=d.node())||void 0===s?void 0:s.getBBox())??{},w=(null===(n=c.node())||void 0===n?void 0:n.getBBox())??{},v=Ve()().utc(),m=Ve()(),g=o.append("text").attr("dx",`${r}px`).attr("dy",-r/2-2+"px").attr("class","f11-time").text(v.format("H.mm")),f=o.append("text").attr("dx",`${r}px`).attr("dy",r/2+2+"px").attr("class","f11-time").text(`(${m.format("H.mm")} local)`),_=g.node().getBBox()??{},b=f.node().getBBox()??{},y=p&&w?1.2*Math.round(p.height+w.height):0,k=p&&w?Math.round(Math.max(p.width,w.width)+5):0,M=1.2*Math.round(_.height+b.height),S=_&&b?Math.round(Math.max(_.width,b.width)+5):0,W=Math.max(y,M);l.attr("x",-k-r).attr("y",-W/2).attr("height",W).attr("width",k+r),h.attr("x",0).attr("y",-W/2).attr("height",W).attr("width",S+r)}_goToF11(t,e){const i=Math.floor((0,o._i)(t,e)),a=Math.floor((0,o.UY)(t,e));(0,o.vX)(i,ul(this,gl).min,ul(this,gl).max,!0)&&(0,o.vX)(a,ul(this,gl).min,ul(this,gl).max,!0)&&(this._printF11Coord(i,a,t,e),ul(this,fl).zoomAndPan(i,a))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&((0,r.KS)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=(0,o.IK)(t,e),a=(0,o.pw)(t,e);this._printF11Coord(t,e,i,a)}clearMap(){ul(this,bl).selectAll("*").remove()}}i(3863);var Ml=i(9089),Sl=i(7808);function Wl(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Tl(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$l(t,e,"get"))}function xl(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,$l(t,e,"set"),i),i}function $l(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Dl=new WeakMap,Pl=new WeakMap,Cl=new WeakMap,Il=new WeakMap,Ll=new WeakMap,El=new WeakMap;class Zl{constructor(t,e){Wl(this,Dl,{writable:!0,value:"Show good availability"}),Wl(this,Pl,{writable:!0,value:void 0}),Wl(this,Cl,{writable:!0,value:{}}),Wl(this,Il,{writable:!0,value:!1}),Wl(this,Ll,{writable:!0,value:void 0}),Wl(this,El,{writable:!0,value:void 0}),xl(this,El,t),xl(this,Ll,e),xl(this,Pl,`port-select-${(0,X.MF)(Tl(this,Dl))}`),this._setupSelect(),this._setupListener()}show(t){const e=Tl(this,Cl).select$.get(0)??{};t?(e.classList.remove("d-none"),e.parentNode.classList.remove("d-none"),Tl(this,Cl).setOptions(this._getOptions()),Tl(this,Cl).reset()):(e.classList.add("d-none"),e.parentNode.classList.add("d-none"))}_getOptions(){const t=new Map;for(const i of Tl(this,El).portDataDefault)if(i.inventory)for(const a of i.inventory){var e;t.set(a.id,(null===(e=Tl(this,El).portIcons.getTradeItem(a.id))||void 0===e?void 0:e.name)??"")}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){const t={dropupAuto:!1,liveSearch:!0,title:Tl(this,Dl),virtualScroll:!0};xl(this,Cl,new Jr.Z(Tl(this,Pl),void 0,t,""))}_setupListener(){Tl(this,Cl).select$.on("change",(()=>{(0,r.KS)("Menu",Tl(this,Dl)),Jr.Z.resetAllExcept([Tl(this,Cl).select$]),this._selectSelected()}))}_getPortList(t,e,i){var a;let s="";if(s+=`<h5>${(null===(a=Tl(this,El).portIcons.getTradeItem(t))||void 0===a?void 0:a.name)??""}</h5>`,e.size>0){s+="<h6>Buy</h6>";for(const[,t]of e)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,u.yI)(t.good.buyQuantity)} @ ${(0,u.Pj)(t.good.buyPrice)}<br>`}if(e&&i&&(s+="<p></p>"),i.size>0){s+="<h6>Sell</h6>";for(const[,t]of i)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,u.yI)(t.good.sellQuantity)} @ ${(0,u.Pj)(t.good.sellPrice)}<br>`}return s}_selectSelected(){const t=Number(Tl(this,Cl).getValues()),e=new Map,i=new Map;xl(this,Il,!0);const a=Tl(this,El).portDataDefault.filter((e=>e.inventory.some((e=>e.id===t)))).sort((0,ce.MR)(["name"])).map((a=>{const s=a.inventory.find((e=>e.id===t));return s&&(a.sellInTradePort=s.buyQuantity>0,a.sellInTradePort&&e.set(a.name,{name:a.name,nation:a.nation,good:s}),a.buyInTradePort=s.sellQuantity>0,a.buyInTradePort&&i.set(a.name,{name:a.name,nation:a.nation,good:s})),a}));Tl(this,El).setShowRadiusSetting("off"),Tl(this,El).portData=a,Tl(this,El).showRadius="tradePorts","portList"!==Tl(this,Ll).showTrades.listType&&(Tl(this,Ll).showTrades.listType="portList"),Tl(this,Ll).showTrades.update(this._getPortList(t,e,i)),Tl(this,El).update()}get isInventorySelected(){return Tl(this,Il)}}var Nl=i(5311);function Al(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function jl(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function zl(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Fl(t,e,"get"))}function Bl(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Fl(t,e,"set"),i),i}function Fl(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Rl=new WeakMap,Vl=new WeakMap,Gl=new WeakMap,ql=new WeakMap,Hl=new WeakMap;class Ol{constructor(t,e){jl(this,"show",void 0),Al(this,Rl,{writable:!0,value:{}}),Al(this,Vl,{writable:!0,value:{}}),Al(this,Gl,{writable:!0,value:void 0}),Al(this,ql,{writable:!0,value:void 0}),Al(this,Hl,{writable:!0,value:{}}),jl(this,"_serverName",void 0),jl(this,"_isDataLoaded",void 0),jl(this,"_minScale",void 0),jl(this,"_scale",void 0),jl(this,"_fontSize",void 0),jl(this,"_numTrades",void 0),jl(this,"_arrowX",void 0),jl(this,"_arrowY",void 0),jl(this,"_baseId",void 0),jl(this,"_nationSelectId",void 0),jl(this,"_listType",void 0),jl(this,"_showId",void 0),jl(this,"_showRadioValues",void 0),jl(this,"_showCookie",void 0),jl(this,"_showRadios",void 0),jl(this,"_profitId",void 0),jl(this,"_profitRadioValues",void 0),jl(this,"_profitCookie",void 0),jl(this,"_profitRadios",void 0),jl(this,"_profitValue",void 0),jl(this,"_profitText",void 0),jl(this,"_g",void 0),jl(this,"_labelG",void 0),jl(this,"_tradeDetailsDiv",void 0),jl(this,"_tradeDetailsHead",void 0),jl(this,"_nationSelector",void 0),jl(this,"_list",void 0),jl(this,"_linkDataDefault",void 0),jl(this,"_linkData",void 0),jl(this,"_portData",void 0),jl(this,"_nodeData",void 0),jl(this,"_linkDataFiltered",void 0),jl(this,"_portDataFiltered",void 0),jl(this,"_tradeItem",void 0),Bl(this,ql,t),Bl(this,Gl,e),this._serverName=zl(this,Gl).serverName,this._minScale=l.VJ,this._scale=this._minScale,this._fontSize=o.jo,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=`${this._baseId}-nation-select`,this._listType="tradeList",this._showId="show-trades",this._showRadioValues=["off","on"],this._showCookie=new h.Z({id:this._showId,values:this._showRadioValues}),this._showRadios=new z.Z(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new h.Z({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new z.Z(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(zl(this,Gl).extent),Bl(this,Rl,new Zl(t,e)),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),(0,a.Z)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=(0,a.Z)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const t=`${ce.nU.map((t=>`<option value="${t.short}" selected>${t.name}</option>`)).join("")}`,e=`${this._baseId}-card`;this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const i=this._tradeDetailsHead.append("label"),a=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",t),Nl(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:t=>`${t===ce.nU.length?"All":String(t)} nations selected`,title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-bs-toggle","collapse").attr("data-bs-target",`#${e}`).attr("aria-expanded","false").text("Info"),this._tradeDetailsHead.append("div").attr("id",e).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group ps-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,a=t.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),a.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(async()=>this._showSelected())),null===(e=document.querySelector(`#${this._profitId}`))||void 0===e||e.addEventListener("change",(()=>{this._profitValueSelected()})),this._nationSelector.addEventListener("change",(t=>{this._nationChanged(),t.preventDefault()}))}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map((t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]))),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map((t=>{let e=0;switch(this._profitValue){case"weight":e=Ol._getProfitPerWeight(t);break;case"distance":e=Ol._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error(`Wrong profit value ${this._profitValue}`)}return t.profit=e,t})).sort(((t,e)=>e.profit??0-(t.profit??0)))}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),zl(this,Rl).show(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){const t=await(0,X.qP)(`${this._serverName}-pb.json`),e=(await i.e(462).then(i.t.bind(i,9131,19))).default;this._portData=e.map((e=>{const i=t.find((t=>t.id===e.id));return{...e,...i}})),this._linkDataDefault=await(0,X.qP)(`${this._serverName}-trades.json`);const a=await(0,X.qP)(`${this._serverName}-items.json`);this._tradeItem=new Map(a.map((t=>[t.id,t.name])))}async _loadAndSetupData(){await this._loadData(),this._setupData()}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then((()=>{this._isDataLoaded=!0})),Ol._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(Ol._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.isShallow)??!0}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){const e=t.weightPerItem*t.quantity;let i="";return i+=Ol._addInfo(`${(0,u.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Ol._addDes("trade"),i+=Ol._addInfo(`${(0,u.Pj)(t.profit??0)}`)+Ol._addDes(this._profitText),i+=Ol._addInfo(`${(0,u.Dw)(e)} ${1===e?"ton":"tons"}`)+Ol._addDes("weight"),i+=Ol._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Ol._addDes(`from ${this._getDepth(t.source.id)}`),i+=Ol._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Ol._addDes(`to ${this._getDepth(t.target.id)}`),i+=Ol._addInfo(`${(0,u.Dw)(t.distance)}`)+Ol._addDes("sail distance"),i}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,a=Ol._getProfitPerDistance(t),s=Ol._getProfitPerWeight(t);let n="";return n+=Ol._startBlock("Trade"),n+=Ol._addInfo(`${(0,u.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Ol._addDes("good"),n+=Ol._addInfo(`${(0,u.Pj)(t.source.grossPrice)}`)+Ol._addDes("gross buy price"),n+=Ol._addInfo(`${(0,u.Pj)(t.target.grossPrice)}`)+Ol._addDes("gross sell price"),n+=Ol._addInfo(`${(0,u.Dw)(e)} ${1===e?"ton":"tons"}`)+Ol._addDes("weight"),n+=Ol._endBlock(),n+=Ol._startBlock("Profit"),n+=Ol._addInfo(`${(0,u.Pj)(t.profitTotal)}`)+Ol._addDes("total"),n+=Ol._addInfo(`${(0,u.Pj)(i)}`)+Ol._addDes("profit/item"),n+=Ol._addInfo(`${(0,u.Pj)(a)}`)+Ol._addDes("profit/distance"),n+=Ol._addInfo(`${(0,u.Pj)(s)}`)+Ol._addDes("profit/weight"),n+=Ol._endBlock(),n+=Ol._startBlock("Route"),n+=Ol._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Ol._addDes(`from ${this._getDepth(t.source.id)}`),n+=Ol._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Ol._addDes(`to ${this._getDepth(t.source.id)}`),n+=Ol._addInfo(`${(0,u.Dw)(t.distance)}`)+Ol._addDes("sail distance"),n+=Ol._endBlock(),n}_getSiblingLinks(t,e){return this._linkDataFiltered.filter((i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t)).map((t=>t.profit??0))}_getXCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.x)??0}_getYCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.y)??0}_updateGraph(){const t=(t,e)=>{const i=t.currentTarget;new(vi())(i,{html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-small"></div></div>',trigger:"manual",title:this._getTradeFullData(e),sanitize:!1}).show()},e=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},a={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},s=t?i.x:a.x,n=t?i.y:a.y,r=t?a.x:i.x,o=t?a.y:i.y;let l=Math.sqrt((r-s)**2+(o-n)**2);const h=t?0:1,d=this._getSiblingLinks(e.source.id,e.target.id);if(d.length>1){const t=(0,Sl.x)().domain(d).range([1,d.length]);l/=1+1/d.length*(t(e.profit??0)??-1)}return l=Math.round(l),`M${s},${n}A${l},${l} 0,0,${h} ${r},${o}`},i=zl(this,Rl).isInventorySelected?[]:this._linkDataFiltered,a=(0,Ml.Z)(this._linkDataFiltered,(t=>t.profit??0)),s=(0,c.Z)().range([5/this._scale,15/this._scale]).domain(a),n=2**Math.log2(Math.abs(this._minScale)+this._scale),r=(0,o.qY)(this._fontSize/n);this._g.selectAll(".trade-link").data(i,(t=>Ol._getId(t))).join((e=>e.append("path").attr("class","trade-link").attr("marker-start",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)")).attr("marker-end",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"")).attr("id",(t=>Ol._getId(t))).on("click",((e,i)=>{t(e,i)})).on("mouseleave",(t=>{(t=>{const e=t.currentTarget,i=vi().getInstance(e);i&&i.dispose()})(t)})))).attr("d",(t=>e(this._getXCoord(t.source.id)<this._getXCoord(t.target.id),t))).attr("stroke-width",(t=>`${s(t.profit??0)??0}px`)),this._labelG.attr("font-size",`${r}px`),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,(t=>Ol._getId(t))).join((t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",(t=>`#${Ol._getId(t)}`)).text((t=>`${(0,u.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)))).attr("dy",(t=>`-${s(t.profit??0)/1.8}px`))}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],Ol._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,Ol._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t??"")}_updatePortList(t){this._list.html(t??"")}_updateTradeList(){let t;const e=(e,i)=>{t=(0,a.Z)(`path#${Ol._getId(i)}`).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,(t=>Ol._getId(t))).join((t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i))).html((t=>this._getTradeLimitedData(t)))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter((t=>t.coordinates[0]>=zl(this,Vl)[0]&&t.coordinates[0]<=zl(this,Hl)[0]&&t.coordinates[1]>=zl(this,Vl)[1]&&t.coordinates[1]<=zl(this,Hl)[1])).map((t=>t.id)));this._linkDataFiltered=this._linkData.filter((e=>t.has(e.source.id)||t.has(e.target.id))).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter((t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id))).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set([...this._nationSelector.selectedOptions].map((t=>t.value)));this._portDataFiltered=new Set(this._portData.filter((e=>t.has(e.nation))).map((t=>t.id)))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t){Bl(this,Vl,t[0]),Bl(this,Hl,t[1])}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this._linkData=this.show?this._linkDataDefault:[],this.update()}}const Yl=t=>t*t,Kl=t=>Math.sqrt(Yl(t.x)+Yl(t.y)+Yl(t.z)),Ul=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,Xl=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),Jl=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),Ql=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),th=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});var eh=i(5311);function ih(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function ah(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,nh(t,e,"get"))}function sh(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,nh(t,e,"set"),i),i}function nh(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var rh=new WeakMap,oh=new WeakMap,lh=new WeakMap,hh=new WeakMap,dh=new WeakMap,ch=new WeakMap,uh=new WeakMap;class ph extends zs.Z{constructor(t,e){super(t,"md","Set"),ih(this,rh,{writable:!0,value:void 0}),ih(this,oh,{writable:!0,value:3}),ih(this,lh,{writable:!0,value:void 0}),ih(this,hh,{writable:!0,value:[]}),ih(this,dh,{writable:!0,value:[]}),ih(this,ch,{writable:!0,value:[]}),ih(this,uh,{writable:!0,value:[]}),sh(this,lh,e),sh(this,rh,Array.from({length:ah(this,oh)},((t,e)=>e))),this._init()}_init(){for(const t of ah(this,rh))ah(this,ch)[t]=`${super.baseId}-${t}-select`,ah(this,hh)[t]=`${super.baseId}-${t}-input`;this._injectModal(),this._setupSelects()}_injectModal(){const t=super.bodySel,e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of ah(this,rh)){const i=e.append("div").attr("class","row mb-4");i.append("div").attr("class","col-md-6").append("label").attr("class","col-form-label").append("select").attr("name",ah(this,ch)[t]).attr("id",ah(this,ch)[t]).attr("class","selectpicker");const a=i.append("div").attr("class","col-md-6 form-floating"),s=a.append("input").attr("id",ah(this,hh)[t]).attr("name",ah(this,hh)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3);a.append("label").attr("for",ah(this,hh)[t]).attr("class","ps-4").text("Distance in k"),ah(this,dh)[t]=s.node()}t.append("div").attr("class","form-text mt-3").text("Distances from in-game trader tool.")}_setupSelects(){const t=`${ah(this,lh).map((t=>({id:t.id,name:t.name,nation:t.nation}))).sort((0,ce.MR)(["name"])).map((t=>`<option data-subtext="${t.nation}">${t.name}</option>`)).join("")}`;for(const e of ah(this,rh))ah(this,uh)[e]=document.querySelector(`#${ah(this,ch)[e]}`),ah(this,uh)[e]&&(ah(this,uh)[e].insertAdjacentHTML("beforeend",t),eh(ah(this,uh)[e]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0}))}get ids(){return ah(this,rh)}get numberOfInputs(){return ah(this,oh)}getPort(t){const e=ah(this,uh)[t];return e.selectedIndex?e.options[e.selectedIndex].text:""}getDistance(t){return Number(ah(this,dh)[t].value)}}var wh=i(2776),vh=i.n(wh);function mh(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function gh(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_h(t,e,"get"))}function fh(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,_h(t,e,"set"),i),i}function _h(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var bh=new WeakMap,yh=new WeakMap,kh=new WeakMap,Mh=new WeakMap,Sh=new WeakMap;class Wh{constructor(t,e){mh(this,bh,{writable:!0,value:void 0}),mh(this,yh,{writable:!0,value:void 0}),mh(this,kh,{writable:!0,value:1e4}),mh(this,Mh,{writable:!0,value:{}}),mh(this,Sh,{writable:!0,value:{}}),fh(this,bh,t),fh(this,yh,e),fh(this,Sh,(0,a.Z)("#toast-column")),this._set(),this._show()}_set(){fh(this,Mh,gh(this,Sh).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=gh(this,Mh).append("div").attr("class","toast-header");t.append("img").attr("class","rounded me-2").attr("height","48px").attr("width","48px").attr("src",X.vU).attr("alt","logo"),t.append("em").attr("class","me-auto").html(gh(this,bh)),t.append("button").attr("type","button").attr("class","btn-close").attr("data-bs-dismiss","toast").attr("aria-label","Close"),gh(this,Mh).append("div").attr("class","toast-body").html(gh(this,yh))}_show(){const t=gh(this,Mh).node();new(vh())(t,{delay:gh(this,kh)}).show()}}function Th(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function xh(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Dh(t,e,"get"))}function $h(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Dh(t,e,"set"),i),i}function Dh(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ph=new WeakMap,Ch=new WeakMap,Ih=new WeakMap,Lh=new WeakMap,Eh=new WeakMap,Zh=new WeakMap;class Nh{constructor(t){Th(this,Ph,{writable:!0,value:void 0}),Th(this,Ch,{writable:!0,value:"Get position"}),Th(this,Ih,{writable:!0,value:void 0}),Th(this,Lh,{writable:!0,value:1.04}),Th(this,Eh,{writable:!0,value:void 0}),Th(this,Zh,{writable:!0,value:void 0}),$h(this,Zh,t),$h(this,Ph,(0,X.MF)(xh(this,Ch))),$h(this,Ih,`menu-${xh(this,Ph)}`),this._setupListener()}_menuClicked(){(0,r.KS)("Menu",xh(this,Ch)),xh(this,Eh)?xh(this,Eh).show():($h(this,Eh,new ph(xh(this,Ch),xh(this,Zh).portDataDefault)),xh(this,Eh).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${xh(this,Ih)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showAndGoToPosition(){const t=xh(this,Zh).portData.map((t=>({x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance??0}))),e=((t,e,i,a=!1)=>{const s=Ql(Xl(e,t),Kl(Xl(e,t))),n=Ul(s,Xl(i,t));let r=Xl(Xl(i,t),th(s,n));const o=Ql(r,Kl(r)),l=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(s,o),h=Kl(Xl(e,t)),d=Ul(o,Xl(i,t)),c=(Yl(t.r)-Yl(e.r)+Yl(h))/(2*h),u=(Yl(t.r)-Yl(i.r)+Yl(n)+Yl(d))/(2*d)-n/d*c;let p=Yl(t.r)-Yl(c)-Yl(u);Math.abs(p)<1e-10&&(p=0);const w=Math.sqrt(p);if(Number.isNaN(w))return;r=Jl(t,Jl(th(s,c),th(o,u)));const v=Jl(r,th(l,w)),m=Xl(r,th(l,w));return 0===w||a?r:[v,m]})(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),xh(this,Zh).map.f11.printCoord(e.x,e.y),xh(this,Zh).map.zoomAndPan(e.x,e.y);const t=Math.round((0,o.IK)(e.x,e.y)/-1e3),i=Math.round((0,o.pw)(e.x,e.y)/-1e3);(0,j.A1)(t,i,xh(this,Eh).getModalNode()),new Wh(xh(this,Ch),"Coordinates copied to clipboard.")}else new Wh(xh(this,Ch),"No intersection found.")}_useUserInput(){const t=new Map;for(const e of xh(this,Eh).ids){const i=xh(this,Eh).getPort(e),a=xh(this,Eh).getDistance(e);a&&""!==i&&t.set(i,a*xh(this,Lh)*X.ZE)}t.size===xh(this,Eh).numberOfInputs?(xh(this,Zh).setShowRadiusSetting("position"),xh(this,Zh).portData=xh(this,Zh).portDataDefault.filter((e=>t.has(e.name))).map((e=>(e.distance=t.get(e.name),e))),xh(this,Zh).update(),this._showAndGoToPosition()):new Wh(xh(this,Ch),"Not enough data.")}}function Ah(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function jh(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Bh(t,e,"get"))}function zh(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Bh(t,e,"set"),i),i}function Bh(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Fh=new WeakMap,Rh=new WeakMap,Vh=new WeakMap;class Gh extends zs.Z{constructor(t){super(t,"sm","Set"),Ah(this,Fh,{writable:!0,value:void 0}),Ah(this,Rh,{writable:!0,value:void 0}),Ah(this,Vh,{writable:!0,value:{}}),zh(this,Fh,`input-group-${this.baseId}`),zh(this,Rh,`input-${this.baseId}`),this._init()}_init(){this._injectModal()}_injectModal(){const t=super.bodySel;zh(this,Vh,new Bs.Z(t,this.baseId))}getTime(){return document.querySelector(`#${jh(this,Rh)}`).value.trim()}getWind(){return jh(this,Vh).getWind()}}function qh(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Hh(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Yh(t,e,"get"))}function Oh(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Yh(t,e,"set"),i),i}function Yh(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}Ve().extend(Ke());var Kh=new WeakMap,Uh=new WeakMap,Xh=new WeakMap;class Jh{constructor(t){qh(this,Kh,{writable:!0,value:void 0}),qh(this,Uh,{writable:!0,value:void 0}),qh(this,Xh,{writable:!0,value:void 0}),Oh(this,Kh,t),Oh(this,Xh,new h.Z({id:`${Hh(this,Kh)}-degrees`,expire:this._getExpire()})),Oh(this,Uh,new h.Z({id:`${Hh(this,Kh)}-time`}))}_getExpire(){return(0,ce.Vk)()}_getNow(){return Ve()().utc().unix()}get(){const t=Hh(this,Xh).get(),e=Hh(this,Uh).get();if(t&&e){const i=Number(t),a=Number(e),s=Math.round(this._getNow()-a);return 360+Math.floor(i-X.er*s)%360}return this.remove(),Number.NaN}set(t){Hh(this,Xh).set(String(t)),Hh(this,Uh).set(String(this._getNow()))}remove(){Hh(this,Xh).remove(),Hh(this,Uh).remove()}}function Qh(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function td(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,id(t,e,"get"))}function ed(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,id(t,e,"set"),i),i}function id(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var ad=new WeakMap,sd=new WeakMap,nd=new WeakMap,rd=new WeakMap,od=new WeakMap,ld=new WeakMap,hd=new WeakMap,dd=new WeakMap,cd=new WeakMap,ud=new WeakMap,pd=new WeakMap,wd=new WeakMap,vd=new WeakMap,md=new WeakMap,gd=new WeakMap,fd=new WeakMap,_d=new WeakMap,bd=new WeakMap,yd=new WeakMap,kd=new WeakMap,Md=new WeakMap;class Sd{constructor(){Qh(this,ad,{writable:!0,value:void 0}),Qh(this,sd,{writable:!0,value:void 0}),Qh(this,nd,{writable:!0,value:{}}),Qh(this,rd,{writable:!0,value:void 0}),Qh(this,od,{writable:!0,value:(0,a.Z)("#port-summary")}),Qh(this,ld,{writable:!0,value:void 0}),Qh(this,hd,{writable:!0,value:"In-game wind"}),Qh(this,dd,{writable:!0,value:void 0}),Qh(this,cd,{writable:!0,value:void 0}),Qh(this,ud,{writable:!0,value:void 0}),Qh(this,pd,{writable:!0,value:void 0}),Qh(this,wd,{writable:!0,value:void 0}),Qh(this,vd,{writable:!0,value:void 0}),Qh(this,md,{writable:!0,value:void 0}),Qh(this,gd,{writable:!0,value:void 0}),Qh(this,fd,{writable:!0,value:"wind-arrow"}),Qh(this,_d,{writable:!0,value:4}),Qh(this,bd,{writable:!0,value:void 0}),Qh(this,yd,{writable:!0,value:void 0}),Qh(this,kd,{writable:!0,value:void 0}),Qh(this,Md,{writable:!0,value:void 0}),ed(this,ld,(0,X.MF)(td(this,hd))),ed(this,Md,`menu-${td(this,ld)}`),ed(this,kd,(0,js.Z)().x((t=>t[0])).y((t=>t[1]))),ed(this,yd,40),ed(this,bd,new Jh(td(this,ld))),ed(this,cd,td(this,bd).get()),this._setupArrow(),this._setupListener(),Number.isNaN(td(this,cd))?new Wh("Hint","Get the wind direction:<br>Use <em>In-game wind</em> under <em>Map tools</em>."):this._initShowCurrentWind()}_menuClicked(){(0,r.KS)("Menu",td(this,hd)),td(this,sd)?td(this,sd).show():(ed(this,sd,new Gh(td(this,hd))),td(this,sd).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupArrow(){const t=td(this,_d),e=2*td(this,_d);(0,a.Z)("#na-svg defs").append("marker").attr("id",td(this,fd)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-text").attr("d",`M0,-${t}L${e},0L0,${t}`)}_setupListener(){var t;null===(t=document.querySelector(`#${td(this,Md)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_windChange(){ed(this,cd,360+(td(this,cd)-X.er*td(this,yd))%360),this._updateWindDirection()}_useUserInput(){ed(this,cd,td(this,sd).getWind()),td(this,rd)?this._updateWindDirection():this._initShowCurrentWind()}_toggle(t){td(this,od).classed("port-summary-no-wind",!t).classed("port-summary-wind",t)}_show(){this._toggle(!0)}_hide(){this._toggle(!1)}_setupSvg(){this._show(),ed(this,ad,td(this,od).insert("div",":first-child").attr("id",td(this,ld)).attr("class","block p-0 pe-2")),ed(this,nd,td(this,ad).append("svg").attr("class","small svg-background-light stroke-thick"))}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),ed(this,pd,window.setInterval((()=>{this._windChange()}),1e3*td(this,yd)))}_updateWindDirection(){const t=(0,o.Ht)(td(this,cd)),e=td(this,wd)*Math.cos(t),i=td(this,wd)*Math.sin(t),a=[[Math.round(td(this,md)+e),Math.round(td(this,gd)+i)],[Math.round(td(this,md)-e),Math.round(td(this,gd)-i)]];td(this,rd)&&(td(this,rd).datum(a).attr("d",td(this,kd)),td(this,bd).set(td(this,cd)))}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:e,top:i}=t.getBoundingClientRect(),a=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top")),s=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"));return Math.floor(e-i-a-s)}return 0}_initPrintCompassRose(){ed(this,ud,this._getHeight()),ed(this,gd,td(this,ud)/2),ed(this,vd,td(this,ud)),ed(this,md,td(this,vd)/2),ed(this,dd,Math.min(td(this,ud),td(this,vd))/2),ed(this,wd,.6*td(this,dd)),td(this,nd).attr("height",td(this,ud)).attr("width",td(this,vd));const t=td(this,nd).append("svg").attr("ui-component","compass").attr("class","fill-background-light").attr("x",td(this,md)).attr("y",td(this,gd));(0,j.ec)({element:t,radius:td(this,dd)}),ed(this,rd,td(this,nd).append("path").attr("class","svg-stroke-thick").attr("marker-end","url(#wind-arrow)"))}clearMap(){window.clearInterval(td(this,pd)),this._hide(),td(this,ad)&&td(this,ad).remove(),ed(this,rd,void 0),td(this,bd).remove()}}function Wd(t,e){xd(t,e),e.add(t)}function Td(t,e,i){xd(t,e),e.set(t,i)}function xd(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function $d(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Cd(t,e,"get"))}function Dd(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function Pd(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Cd(t,e,"set"),i),i}function Cd(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Id=new WeakMap,Ld=new WeakMap,Ed=new WeakMap,Zd=new WeakMap,Nd=new WeakMap,Ad=new WeakMap,jd=new WeakMap,zd=new WeakMap,Bd=new WeakSet,Fd=new WeakSet;class Rd{constructor(t,e){Wd(this,Fd),Wd(this,Bd),Td(this,Id,{writable:!0,value:0}),Td(this,Ld,{writable:!0,value:0}),Td(this,Ed,{writable:!0,value:0}),Td(this,Zd,{writable:!0,value:0}),Td(this,Nd,{writable:!0,value:void 0}),Td(this,Ad,{writable:!0,value:{}}),Td(this,jd,{writable:!0,value:{}}),Td(this,zd,{writable:!0,value:[0,0]}),Pd(this,Id,t[0][0]),Pd(this,Ld,t[1][0]),Pd(this,Ed,t[0][1]),Pd(this,Zd,t[1][1]),Pd(this,Nd,e),Dd(this,Bd,Vd).call(this)}get viewport(){return $d(this,jd)}static getMapScale(t){return 2**(Math.log2(t)-l.rg)}drawMap(t){const e=Math.log2(t.k)<=l.rg?0:l.rg-Math.log2(t.k),i=l.i9*t.k,a={tiles:[]},s=Math.log2(i/l.i9),n=Math.round(Math.max(s+e,0)),r=2**(s-n)*l.i9,o=t.x-i/2,h=t.y-i/2,d=Math.max(0,Math.floor(($d(this,Id)-o)/r)),c=Math.min(Number(1<<n),Math.ceil(($d(this,Ld)-o)/r)),u=Math.max(0,Math.floor(($d(this,Ed)-h)/r)),p=Math.min(Number(1<<n),Math.ceil(($d(this,Zd)-h)/r));for(let t=u;t<p;++t)for(let e=d;e<c;++e)a.tiles.push([e,t,n]);if(a.translate=[o/r,h/r],a.scale=r,a.tiles.length>0){const t=2**(n+Math.abs(e)),i=$d(this,Nd).max/t*2**Math.abs(e);Pd(this,jd,[[d*i,u*i],[c*i,p*i]]),Pd(this,zd,[a.translate[0]*a.scale,a.translate[1]*a.scale]),Dd(this,Fd,Gd).call(this,a)}}getMapTransform(t){const e=Rd.getMapScale(t.k);return n.CR.scale(e).translate($d(this,zd)[0]/e,$d(this,zd)[1]/e)}}function Vd(){const t=(0,a.Z)("#na-map svg");Pd(this,Ad,t.insert("g","#map").attr("class","map-tiles"))}function Gd(t){const{translate:[e,i],scale:a,tiles:s}=t;$d(this,Ad).attr("transform",`translate(${e*a},${i*a}) scale(${a})`).selectAll("image").data(s,(t=>t)).join((t=>t.append("image").attr("xlink:href",(([t,e,i])=>`images/map/${i}/${e}/${t}.webp`)).attr("x",(([t])=>t)).attr("y",(([,t])=>t)).attr("width",1).attr("height",1)))}function qd(t,e){Hd(t,e),e.add(t)}function Hd(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Od(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Kd(t,e,"get"))}function Yd(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Kd(t,e,"set"),i),i}function Kd(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}function Ud(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}var Xd=new WeakMap,Jd=new WeakSet,Qd=new WeakSet,tc=new WeakSet;class ec{constructor(){var t,e,i;qd(this,tc),qd(this,Qd),qd(this,Jd),i={writable:!0,value:void 0},Hd(t=this,e=Xd),e.set(t,i),Ud(this,Jd,ic).call(this)}}function ic(){var t;null===(t=document.querySelector("#about"))||void 0===t||t.addEventListener("click",(()=>{Ud(this,tc,sc).call(this)}))}function ac(){Yd(this,Xd,new zs.Z(`${X.xw} <span class="text-primary small">v${X.f4}</span>`,"lg"));Od(this,Xd).bodySel.html(`<p>${X.FB} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/">Game-Labs forum post</a> for further details. Feedback is very welcome.</p>\n                    <p>Designed by iB aka Felix Victor, <em>Bastards</em> clan ${(0,j.Mo)("(BASTD)")}</a>.</p>\n                    <div class="alert alert-secondary" role="alert"><h5 class="alert-heading">Did you know?</h5><p class="mb-0">My clan mate, Aquillas, wrote a most comprehensive <a href="https://drive.google.com/file/d/1PGysQwYg6aCQKq1dJQWtlc443IdO_drG/view">user guide</a>.</p></div>`)}function sc(){Od(this,Xd)?Od(this,Xd).show():Ud(this,Qd,ac).call(this)}function nc(t,e){lc(t,e),e.add(t)}function rc(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function oc(t,e,i){lc(t,e),e.set(t,i)}function lc(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function hc(t,e,i){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return i}function dc(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,uc(t,e,"get"))}function cc(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,uc(t,e,"set"),i),i}function uc(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var pc=new WeakMap,wc=new WeakMap,vc=new WeakMap,mc=new WeakMap,gc=new WeakMap,fc=new WeakMap,_c=new WeakMap,bc=new WeakMap,yc=new WeakMap,kc=new WeakMap,Mc=new WeakMap,Sc=new WeakMap,Wc=new WeakSet,Tc=new WeakSet;class xc{constructor(t,e){nc(this,Tc),nc(this,Wc),oc(this,pc,{writable:!0,value:l.VJ}),oc(this,wc,{writable:!0,value:{}}),oc(this,vc,{writable:!0,value:l.VJ}),oc(this,mc,{writable:!0,value:{}}),oc(this,gc,{writable:!0,value:!1}),oc(this,fc,{writable:!0,value:void 0}),oc(this,_c,{writable:!0,value:0}),oc(this,bc,{writable:!0,value:void 0}),oc(this,yc,{writable:!0,value:{}}),rc(this,"coord",void 0),rc(this,"f11",void 0),rc(this,"height",0),rc(this,"_doubleClickAction",void 0),rc(this,"_grid",void 0),rc(this,"_journey",void 0),rc(this,"_pbZone",void 0),rc(this,"_portSelect",void 0),rc(this,"_ports",void 0),rc(this,"_showGrid",void 0),rc(this,"_svg",void 0),rc(this,"_zoomLevel",void 0),rc(this,"_doubleClickActionCookie",void 0),rc(this,"_doubleClickActionId",void 0),rc(this,"_doubleClickActionRadios",void 0),rc(this,"_doubleClickActionValues",void 0),rc(this,"_searchParams",void 0),rc(this,"_showGridCookie",void 0),rc(this,"_showGridId",void 0),rc(this,"_showGridRadios",void 0),rc(this,"_showGridValues",void 0),oc(this,kc,{writable:!0,value:2}),oc(this,Mc,{writable:!0,value:.25}),oc(this,Sc,{writable:!0,value:1}),rc(this,"gridOverlay",void 0),rc(this,"rem",o.jo),rc(this,"serverName",void 0),rc(this,"showGrid",void 0),rc(this,"showTrades",void 0),rc(this,"width",0),rc(this,"xGridBackgroundHeight",void 0),rc(this,"yGridBackgroundWidth",void 0),this.serverName=t,this._searchParams=e,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:l.zb},this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new h.Z({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new z.Z(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new h.Z({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new z.Z(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupSvg(),this._setSvgSize(),this._setupListener()}static _stopProperty(t){t.defaultPrevented&&t.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this._ports=new Zs(this),await this._ports.init(),this._pbZone=new U(this._ports,this.serverName),this._grid=new N(this),this._portSelect=new Xo(this._ports),this.showTrades=new Ol(this._ports,this),await this.showTrades.showOrHide(),this.f11=new kl(this,this.coord),this._init(),this._journey=new sr(this.rem),cc(this,bc,new Sd),new Nh(this._ports),new Kr(this,this.serverName,this.coord),new ec}_setupListener(){var t,e,i,a,s,n;this._svg.on("dblclick.zoom",null).on("click",(t=>{xc._stopProperty(t)}),!0).on("dblclick",(t=>{this._doDoubleClickAction(t)})),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",(()=>{(0,r.KS)("Menu","Select port on property")})),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",(()=>{(0,r.KS)("Menu","Settings")})),null===(i=document.querySelector("#menu-download-pb-calc"))||void 0===i||i.addEventListener("click",(()=>{(0,r.KS)("Tools","Download pb calculator")})),null===(a=document.querySelector("#reset"))||void 0===a||a.addEventListener("click",(()=>{this._clearMap()})),null===(s=document.querySelector("#double-click-action"))||void 0===s||s.addEventListener("change",(()=>{this._doubleClickSelected()})),null===(n=document.querySelector("#show-grid"))||void 0===n||n.addEventListener("change",(()=>{this._showGridSelected()})),window.addEventListener("resize",(()=>{hc(this,Tc,Dc).call(this)}))}_setupSvg(){cc(this,yc,(0,n.sP)().scaleExtent([l.VJ,l.tu]).wheelDelta((t=>-dc(this,Sc)*Math.sign(t.deltaY))).on("zoom",(t=>{this._naZoomed(t)}))),this._svg=(0,a.Z)("#na-map").append("svg").attr("id","na-svg").attr("class","fill-empty stroke-empty bg-map").call(dc(this,yc)),this._svg.append("defs"),cc(this,mc,this._svg.append("g").attr("id","map"))}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),dc(this,bc).clearMap(),Jr.Z.resetAll()}_doDoubleClickAction(t){const[e,i]=(0,s.Z)(t,dc(this,mc).node());"f11"===this._doubleClickAction?this.f11.printCoord(e,i):this._journey.plotCourse(e,i),this.zoomAndPan(e,i)}_setZoomLevelAndData(t){const e=Rd.getMapScale(t.k);e!==dc(this,pc)&&(cc(this,pc,e),dc(this,pc)>dc(this,kc)?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):dc(this,pc)>dc(this,Mc)?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(dc(this,pc))}_naZoomed(t){const{transform:e}=t;dc(this,fc).drawMap(e),this._ports.setBounds(dc(this,fc).viewport),this._pbZone.setBounds(dc(this,fc).viewport),this.showTrades.setBounds(dc(this,fc).viewport);const i=dc(this,fc).getMapTransform(e);this._grid.transform(i),this.showTrades.transform(i),dc(this,mc).attr("transform",i.toString()),this._setZoomLevelAndData(e)}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){var t;this.zoomLevel="initial",cc(this,fc,new Rd(this.extent,this.coord)),hc(this,Wc,$c).call(this),this._checkF11Coord(),null===(t=document.querySelector("#navbar-left"))||void 0===t||t.classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight(),cc(this,wc,[[0,0],[this.width,this.height]])}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style",`height:${e}px`)}_getInitialMapScale(){let t=(0,o.XH)(Math.min(this.height,this.width)/l.i9);const e=this.height*this.width;if(e-(l.i9*t)**2>(l.i9*t*2)**2-e){const e=2;cc(this,gc,!0),t*=e}return t}_setTranslateExtent(t){let e=t;if(dc(this,gc)){const i=2,a=t.k/i,{x:s,y:r}=t;e=n.CR.translate(s,r).scale(a)}dc(this,yc).translateExtent([e.invert(dc(this,wc)[0]),e.invert(dc(this,wc)[1])])}_initialZoomAndPan(){const t=this.zoomAndPan(this.coord.max/2,this.coord.max/2,!0);this._setTranslateExtent(t)}zoomAndPan(t,e,i=!1){const a=i?dc(this,vc):32,s=n.CR.scale(a).translate(Math.floor((-t+this.coord.max/2+this.width/2)/a),Math.floor(-e+this.coord.max/2+this.height/2)/a);return this._svg.call(dc(this,yc).transform,s),s}goToPort(){0===this._ports.currentPort.id?this._initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y)}get extent(){return dc(this,wc)}}function $c(){this._setHeightWidth(),cc(this,vc,this._getInitialMapScale()),this._initialZoomAndPan(),this._setFlexOverlayHeight()}function Dc(){window.clearTimeout(dc(this,_c)),cc(this,_c,window.setTimeout((()=>{hc(this,Wc,$c).call(this)}),250))}},2938:(t,e,i)=>{i.d(e,{Z:()=>v});i(3223);var a=i(1198),s=i(393),n=i(5311);function r(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function o(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,h(t,e,"get"))}function l(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,h(t,e,"set"),i),i}function h(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var d=new WeakMap,c=new WeakMap,u=new WeakMap,p=new WeakMap,w=new WeakMap;class v{constructor(t,e){r(this,d,{writable:!0,value:void 0}),r(this,c,{writable:!0,value:void 0}),r(this,u,{writable:!0,value:void 0}),r(this,p,{writable:!0,value:{}}),r(this,w,{writable:!0,value:{}}),l(this,p,t),l(this,d,e),l(this,c,`form-${o(this,d)}`),l(this,u,`slider-${o(this,d)}`),this._inject(),l(this,w,n(`#${o(this,u)}`)),this._setup()}_setup(){window.sliderTooltip=t=>`${(0,a.nD)(String(t.value))}<br>${String(t.value)}°`,o(this,w).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/s.Tm.length,editableTooltip:!1,tooltipFormat:"sliderTooltip",create(){this.control.css("display","block")}})}_inject(){const t=o(this,p).append("form").attr("id",o(this,c)).append("div").attr("class","text-center");t.append("label").attr("for",o(this,u)).text("Current in-game wind"),t.append("div").attr("id",o(this,u)).attr("class","rslider d-inline-block")}_getInputValue(){return o(this,w).roundSlider("getValue")}getWind(){const t=(0,s.tT)(this._getInputValue());let e;return e=Number.isNaN(Number(t))?(0,s.Ri)(t):Number(t),e}}},7846:t=>{t.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' height='300' width='300' viewBox='0 0 512 512'%3e%3cpath fill='%23292109' fill-opacity='.7' d='m438 411.3-37.6-37.6c.1-.2.1-.2.1-.4 9.7-20.8 6.2-46.3-11-63.5L363 336.3l-80.5-80.5 96.6-96.6c24-24 37.5-56.6 37.5-90.5L256 229.3 95.4 68.7c0 34 13.5 66.5 37.5 90.5l96.6 96.6-80.5 80.5-26.5-26.5c-17.2 17.2-20.7 42.7-11 63.5.1.2.1.2.1.4L74 411.3c-7.3 7.3-7.3 19.2 0 26.5 7.3 7.3 19.2 7.3 26.5 0l37.6-37.6c.2.1.2.1.4.1 20.8 9.7 46.3 6.2 63.5-11l-26.5-26.5 80.5-80.5 80.5 80.5-26.5 26.6c17.2 17.2 42.7 20.7 63.5 11 .1-.1.2-.1.4-.1l37.6 37.6c7.3 7.3 19.2 7.3 26.5 0 7.3-7.4 7.3-19.3 0-26.6z'/%3e%3c/svg%3e"}}]);