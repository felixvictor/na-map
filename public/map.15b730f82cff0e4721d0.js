/*! For license information please see map.15b730f82cff0e4721d0.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[842],{5596:(t,e,i)=>{i.r(e),i.d(e,{NAMap:()=>Oo});var a=i(3838),s=i(3466),n=i(8457),r=i(2855),o=i(9022),l=i(393),h=i(9949),d=i(1198),c=i(3389),p=i(9843),u=i(4752),w=i(9937),v=i(7015);function m(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function g(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,f(t,e,"get"))}function _(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,f(t,e,"set"),i),i}function f(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var b=new WeakMap,y=new WeakMap,k=new WeakMap,M=new WeakMap,S=new WeakMap,x=new WeakMap,T=new WeakMap,W=new WeakMap,$=new WeakMap,D=new WeakMap,P=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap,N=new WeakMap,A=new WeakMap,Z=new WeakMap,E=new WeakMap,j=new WeakMap;class B{constructor(t){m(this,b,{writable:!0,value:void 0}),m(this,y,{writable:!0,value:!1}),m(this,k,{writable:!0,value:void 0}),m(this,M,{writable:!0,value:void 0}),m(this,S,{writable:!0,value:void 0}),m(this,x,{writable:!0,value:void 0}),m(this,T,{writable:!0,value:void 0}),m(this,W,{writable:!0,value:void 0}),m(this,$,{writable:!0,value:void 0}),m(this,D,{writable:!0,value:void 0}),m(this,P,{writable:!0,value:void 0}),m(this,C,{writable:!0,value:void 0}),m(this,I,{writable:!0,value:void 0}),m(this,L,{writable:!0,value:void 0}),m(this,N,{writable:!0,value:void 0}),m(this,A,{writable:!0,value:void 0}),m(this,Z,{writable:!0,value:void 0}),m(this,E,{writable:!0,value:void 0}),m(this,j,{writable:!0,value:void 0}),_(this,k,t),_(this,b,"on"===g(this,k).showGrid),_(this,M,g(this,k).coord.min),_(this,S,g(this,k).coord.max),_(this,x,g(this,k).height),_(this,T,g(this,k).width),_(this,W,g(this,k).rem),_(this,$,g(this,k).xGridBackgroundHeight),_(this,D,g(this,k).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){_(this,P,(0,w.Z)().clamp(!0).domain([(0,l.IK)(g(this,M),g(this,M)),(0,l.IK)(g(this,S),g(this,S))]).range([g(this,M),g(this,S)])),_(this,C,(0,w.Z)().clamp(!0).domain([(0,l.pw)(g(this,M),g(this,M)),(0,l.pw)(g(this,S),g(this,S))]).range([g(this,M),g(this,S)]))}_setupAxis(){const t=this._getTicks(65);_(this,I,(0,u.LL)(g(this,P)).tickFormat((t=>(0,v.Hu)(t))).tickValues(t).tickSize(g(this,S))),_(this,L,(0,u.Kh)(g(this,C)).tickFormat((t=>(0,v.Hu)(t))).tickValues(t).tickSize(g(this,S)));const e=(0,a.Z)("#map");_(this,A,e.insert("g","g.pb").attr("class","axis d-none")),_(this,E,g(this,A).append("g")),_(this,Z,e.insert("g","g.pb").attr("class","axis d-none")),_(this,j,g(this,Z).append("g")),this._displayAxis(void 0),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round((0,l.pw)(g(this,M),g(this,M))),i=Math.round((0,l.pw)(g(this,S),g(this,S))),a=(i-e)/(t-1),s=[];for(let t=a;t<i;t+=a)s.push(Math.round(t));s.push(i);const n=[...s].reverse().map((t=>-t));return n.push(0),[...n,...s]}_setupXAxis(){g(this,E).selectAll(".tick text").attr("dx","-0.3rem").attr("dy","2rem"),g(this,E).attr("font-family","inherit")}_setupYAxis(){g(this,j).attr("font-family","inherit"),g(this,j).selectAll(".tick text").attr("dx","3.5rem").attr("dy","-.5rem")}_displayAxis(t){const e=t?t.k:1,i=(0,l.qY)(g(this,W)/e),a=(0,l.qY)(1/e),s=t?t.y:0,n=s/e<g(this,T)?s/e:0,r=-g(this,S)-n,o=t?t.x:0,h=o/e<g(this,x)?o/e:0,d=-g(this,S)-h;g(this,E).attr("font-size",i).attr("stroke-width",a).call(g(this,I).tickPadding(r)),g(this,j).attr("font-size",i).attr("stroke-width",a).call(g(this,L).tickPadding(d))}get show(){return g(this,b)}set show(t){_(this,b,t)}get zoomLevel(){return g(this,N)}set zoomLevel(t){_(this,N,t)}update(){let t=!1;g(this,b)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),g(this,y)&&this.gridToggle(t)}transform(t){g(this,b)&&(this.testForInitialisation(),this._displayAxis(t))}gridToggle(t){g(this,k).gridOverlay.classList.toggle("overlay-grid",t),g(this,k).gridOverlay.classList.toggle("overlay-no-grid",!t),g(this,A).classed("d-none",!t),g(this,Z).classed("d-none",!t)}testForInitialisation(){g(this,y)||(this._setupSvg(),_(this,y,!0))}}var z=i(1460),F=i(4194);function R(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function V(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function G(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,H(t,e,"get"))}function q(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,H(t,e,"set"),i),i}function H(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var O=new WeakMap,Y=new WeakMap,K=new WeakMap,X=new WeakMap,U=new WeakMap;class Q{constructor(t,e){V(this,O,{writable:!0,value:12}),V(this,Y,{writable:!0,value:10}),R(this,"showPB",void 0),V(this,K,{writable:!0,value:void 0}),V(this,X,{writable:!0,value:{}}),V(this,U,{writable:!0,value:{}}),R(this,"_ports",void 0),R(this,"_showId",void 0),R(this,"_showValues",void 0),R(this,"_showCookie",void 0),R(this,"_showRadios",void 0),R(this,"_isDataLoaded",void 0),R(this,"_pbZonesDefault",void 0),R(this,"_defencesFiltered",void 0),R(this,"_pbZonesFiltered",void 0),R(this,"_raidZonesFiltered",void 0),R(this,"_g",void 0),this._ports=t,q(this,K,(0,z.Oy)(e)),this._showId="show-zones",this._showValues=["pb-all","pb-single","raid-all","raid-single","off"],this._showCookie=new c.Z({id:this._showId,values:this._showValues}),this._showRadios=new F.Z(this._showId,this._showValues),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","#ports").attr("class","pb")}async _loadData(){this._pbZonesDefault=(await i.e(268).then(i.t.bind(i,5912,19))).default}_setupListener(){var t;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(()=>{this._showPBZonesSelected()}))}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","pb-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],28)+(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.pbCircles.map((t=>(0,d.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.pbCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.pbCircles.map((t=>t[1])).join(","))).text((t=>t.pbCircles.map(((t,e)=>String.fromCodePoint(65+e))).join(""))),"PVP"===G(this,K)&&(e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.spawnPoints.map((t=>(0,d.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.spawnPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.spawnPoints.map((t=>t[1])).join(","))).text((t=>t.spawnPoints.map(((t,e)=>String.fromCodePoint(88+e))).join("")))),e}));this._g.selectAll("g.defence").data(this._defencesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","defence svg-text-center fill-white text-tiny");return e.selectAll("path.tower-range").data((t=>t.towers)).join((t=>t.append("path").attr("class","tower-range background-primary-light").attr("d",(t=>(0,d.GZ)(t[0],t[1],G(this,Y)))))),e.selectAll("path.fort-range").data((t=>t.forts)).join((t=>t.append("path").attr("class","fort-range background-red").attr("d",(t=>(0,d.GZ)(t[0],t[1],G(this,O)))))),e.append("path").attr("class","fort fill-red").attr("d",(t=>t.forts.map((t=>(0,d.yb)(t[0],t[1],3))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.forts.map((t=>t[0])).join(","))).attr("y",(t=>t.forts.map((t=>t[1])).join(","))).text((t=>t.forts.map(((t,e)=>`${e+1}`)).join(""))),e.append("path").attr("class","tower fill-dark").attr("d",(t=>t.towers.map((t=>(0,d.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.towers.map((t=>t[0])).join(","))).attr("y",(t=>t.towers.map((t=>t[1])).join(","))).text((t=>t.towers.map(((t,e)=>`${e+1}`)).join(""))),e})),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","raid-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],35))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.raidCircles.map((t=>(0,d.GZ)(t[0],t[1],4.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.raidCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.raidCircles.map((t=>t[1])).join(","))).text((t=>t.raidCircles.map(((t,e)=>String.fromCodePoint(65+e))).join(""))),e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.raidPoints.map((t=>(0,d.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.raidPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.raidPoints.map((t=>t[1])).join(","))).text((t=>t.raidPoints.map(((t,e)=>String.fromCodePoint(49+e))).join(""))),e}))}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}async _setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?(this._isDataLoaded||(await this._loadData(),this._isDataLoaded=!0),this._filterVisible()):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter((t=>t.position[0]>=G(this,X)[0]&&t.position[0]<=G(this,U)[0]&&t.position[1]>=G(this,X)[1]&&t.position[1]<=G(this,U)[1])).filter((t=>this._isPortIn(t)));this._defencesFiltered=t.map((t=>({id:t.id,forts:t.forts,towers:t.towers}))),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map((t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints}))),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map((t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints}))))}setBounds(t){q(this,X,t[0]),q(this,U,t[1])}async refresh(){await this._setData(),this._update()}}var J=i(3824),tt=i.n(J),et=i(8398),it=i(8776),at=i(2255),st=i(577),nt=i(8973),rt=i(5619),ot=i(6400),lt=i(4848),ht=i(7484),dt=i.n(ht),ct=(i(9517),i(285)),pt=i.n(ct),ut=i(4110),wt=i.n(ut),vt=i(178),mt=i.n(vt),gt=i(2157),_t=i(5923),ft=i(4332);const bt=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}],yt=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}],kt=[{name:"Hispaniola",coordinates:[4900,3635],radius:150,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"Tumbado",coordinates:[2400,3050],radius:150,shallow:!1},{name:"Léogane",coordinates:[5130,3770],radius:90,shallow:!1,shipClass:{min:7,max:4}},{name:"Tortuga",coordinates:[5435,3420],radius:100,shallow:!1,shipClass:{min:7,max:5}},{name:"Antilles",coordinates:[7555,4470],radius:140,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"La Mona",coordinates:[6180,4100],radius:170,shallow:!1,shipClass:{min:7,max:4}}];var Mt=i(7846);function St(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function xt(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Tt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$t(t,e,"get"))}function Wt(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,$t(t,e,"set"),i),i}function $t(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}dt().extend(pt()),dt().extend(wt()),dt().extend(mt()),dt().locale("en-gb");const Dt=rt.Z.bind(ot.h);var Pt=new WeakMap,Ct=new WeakMap,It=new WeakMap,Lt=new WeakMap,Nt=new WeakMap,At=new WeakMap,Zt=new WeakMap,Et=new WeakMap,jt=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ft=new WeakMap,Rt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,qt=new WeakMap,Ht=new WeakMap,Ot=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Ut=new WeakMap,Qt=new WeakMap,Jt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ae=new WeakMap,se=new WeakMap,ne=new WeakMap,re=new WeakMap,oe=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap,ce=new WeakMap,pe=new WeakMap,ue=new WeakMap,we=new WeakMap,ve=new WeakMap,me=new WeakMap,ge=new WeakMap,_e=new WeakMap,fe=new WeakMap,be=new WeakMap,ye=new WeakMap,ke=new WeakMap,Me=new WeakMap,Se=new WeakMap,xe=new WeakMap,Te=new WeakMap,We=new WeakMap,$e=new WeakMap,De=new WeakMap,Pe=new WeakMap,Ce=new WeakMap,Ie=new WeakMap,Le=new WeakMap,Ne=new WeakMap;class Ae{constructor(t){this.map=t,xt(this,Pt,{writable:!0,value:""}),xt(this,Ct,{writable:!0,value:{id:366,coord:{x:4396,y:2494}}}),xt(this,It,{writable:!0,value:{}}),xt(this,Lt,{writable:!0,value:void 0}),xt(this,Nt,{writable:!0,value:!1}),xt(this,At,{writable:!0,value:""}),xt(this,Zt,{writable:!0,value:!1}),xt(this,Et,{writable:!0,value:{}}),xt(this,jt,{writable:!0,value:0}),xt(this,Bt,{writable:!0,value:"initial"}),xt(this,zt,{writable:!0,value:void 0}),xt(this,Ft,{writable:!0,value:void 0}),xt(this,Rt,{writable:!0,value:void 0}),xt(this,Vt,{writable:!0,value:void 0}),xt(this,Gt,{writable:!0,value:void 0}),xt(this,qt,{writable:!0,value:void 0}),xt(this,Ht,{writable:!0,value:bt}),xt(this,Ot,{writable:!0,value:[]}),xt(this,Yt,{writable:!0,value:void 0}),xt(this,Kt,{writable:!0,value:void 0}),xt(this,Xt,{writable:!0,value:void 0}),xt(this,Ut,{writable:!0,value:void 0}),xt(this,Qt,{writable:!0,value:void 0}),xt(this,Jt,{writable:!0,value:void 0}),xt(this,te,{writable:!0,value:void 0}),xt(this,ee,{writable:!0,value:void 0}),xt(this,ie,{writable:!0,value:{}}),xt(this,ae,{writable:!0,value:void 0}),xt(this,se,{writable:!0,value:void 0}),xt(this,ne,{writable:!0,value:void 0}),xt(this,re,{writable:!0,value:void 0}),xt(this,oe,{writable:!0,value:void 0}),xt(this,le,{writable:!0,value:void 0}),xt(this,he,{writable:!0,value:void 0}),xt(this,de,{writable:!0,value:void 0}),xt(this,ce,{writable:!0,value:void 0}),xt(this,pe,{writable:!0,value:void 0}),xt(this,ue,{writable:!0,value:void 0}),xt(this,we,{writable:!0,value:void 0}),xt(this,ve,{writable:!0,value:void 0}),xt(this,me,{writable:!0,value:void 0}),xt(this,ge,{writable:!0,value:yt}),xt(this,_e,{writable:!0,value:[]}),xt(this,fe,{writable:!0,value:0}),xt(this,be,{writable:!0,value:void 0}),xt(this,ye,{writable:!0,value:{}}),xt(this,ke,{writable:!0,value:"show-radius"}),xt(this,Me,{writable:!0,value:l.w7}),xt(this,Se,{writable:!0,value:void 0}),xt(this,xe,{writable:!0,value:void 0}),xt(this,Te,{writable:!0,value:l.jo}),xt(this,We,{writable:!0,value:48}),xt(this,$e,{writable:!0,value:l.L9}),xt(this,De,{writable:!0,value:4*l.L9}),xt(this,Pe,{writable:!0,value:void 0}),xt(this,Ce,{writable:!0,value:void 0}),xt(this,Ie,{writable:!0,value:void 0}),xt(this,Le,{writable:!0,value:void 0}),xt(this,Ne,{writable:!0,value:"all"}),St(this,"_formatItems",(t=>(null==t?void 0:t.map((t=>{var e;return(null===(e=this.tradeItem.get(t))||void 0===e?void 0:e.name)??""})).sort(gt.I4).join(", "))??"")),St(this,"_sortByProfit",((t,e)=>e.profit.profit-t.profit.profit)),St(this,"_sortByProfitPerTon",((t,e)=>e.profit.profitPerTon-t.profit.profitPerTon)),St(this,"_formatProfits",(t=>{var e;return Dt`${null==t||null===(e=t.sort(this._sortByProfit))||void 0===e?void 0:e.map(((e,i)=>Dt`<span style="white-space: nowrap;">${e.name} (${(0,v.RK)(e.profit.profit)})</span
                        >${i===t.length-1?Dt``:Dt`, `}`))}`})),St(this,"_formatProfitsPerTon",(t=>{var e;return Dt`${null==t||null===(e=t.sort(this._sortByProfitPerTon))||void 0===e?void 0:e.map(((e,i)=>Dt`<span style="white-space: nowrap;"
                            >${e.name} (${(0,v.RK)(e.profit.profitPerTon)})</span
                        >${i===t.length-1?Dt``:Dt`, `}`))}`})),St(this,"_showProfits",((t,e,i)=>{var a;const s="buy"===i?"alert-success":"alert-danger",n="buy"===i?`Buy here and sell in ${e}`:`Buy in ${e} and sell here`;return void 0===(null===(a=t.profit)||void 0===a?void 0:a[0])?Dt``:Dt`<div class="alert ${s} mt-2 mb-2 text-start" role="alert">
                  <div class="alert-heading"><span class="caps">${n}</span> (net value in reales)</div>
                  <p class="my-1"><em>By profit per item</em>: ${t.profit}</p>
                  <p class="my-1"><em>By profit per ton</em>: ${t.profitPerTon}</p>
              </div>`})),Wt(this,Le,this.map.serverName),Wt(this,Pe,this.map.minMapScale),Wt(this,fe,Tt(this,Pe)),Wt(this,xe,this.map.f11),Wt(this,Ce,["attack","county","points","position","tax","net","off"]),Wt(this,Se,new c.Z({id:Tt(this,ke),values:Tt(this,Ce)})),Wt(this,Ie,new F.Z(Tt(this,ke),Tt(this,Ce))),this.showRadius=this._getShowRadiusSetting()}async init(){await this._loadAndSetupData()}_setupData(t){Wt(this,Lt,t.ports.map((e=>{const i=t.server.find((t=>t.id===e.id))??{},a=t.pb.find((t=>t.id===e.id))??{};return{...e,...i,...a}}))),Wt(this,It,Tt(this,Lt)),this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupPatrolZones(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:`${Tt(this,Le)}-ports.json`,name:"server"},{fileName:`${Tt(this,Le)}-pb.json`,name:"pb"}],e=await(0,o.qP)(`${Tt(this,Le)}-items.json`);this.tradeItem=new Map(e.map((t=>[t.id,t])));const a={};return a.ports=(await i.e(462).then(i.t.bind(i,9131,19))).default,await(0,o.EZ)(t,a),a}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){Wt(this,de,(0,w.Z)()),Wt(this,zt,(0,w.Z)().domain([0,1])),Wt(this,Rt,(0,w.Z)().domain([0,1]).range([o.Q0,o.gc]).interpolate(st.Z)),Wt(this,Ft,(0,nt.Z)().range(o.q4)),Wt(this,le,(0,et.Z)(this.portData,(t=>t.taxIncome))??0),Wt(this,ne,(0,it.Z)(this.portData,(t=>t.taxIncome))??0),Wt(this,qt,(0,w.Z)().domain([Tt(this,le),Tt(this,ne)]).range([o.Q0,o.fy]).interpolate(st.Z)),Wt(this,re,(0,et.Z)(this.portData,(t=>t.netIncome))??0),Wt(this,ae,(0,it.Z)(this.portData,(t=>t.netIncome))??0),Wt(this,Vt,(0,w.Z)().domain([Tt(this,re),0,Tt(this,ae)]).range([o.gc,o.Q0,o.fy]).interpolate(st.Z)),Wt(this,oe,(0,et.Z)(this.portData,(t=>t.portPoints))??0),Wt(this,se,(0,it.Z)(this.portData,(t=>t.portPoints))??0),Wt(this,Gt,(0,w.Z)().domain([Tt(this,oe),Tt(this,se)]).range([o.Q0,o.fy]).interpolate(st.Z))}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",(()=>{this._showRadiusSelected()}))}_getShowRadiusSetting(){let t=Tt(this,Se).get();return"position"===t&&([t]=Tt(this,Ce),Tt(this,Se).set(t)),Tt(this,Ie).set(t),t}_showRadiusSelected(){this.showRadius=Tt(this,Ie).get(),Tt(this,Se).set(this.showRadius),this.update()}_setupSvg(){Wt(this,Ut,(0,a.Z)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports")),Wt(this,te,Tt(this,Ut).append("g").attr("data-ui-component","region").attr("class","title")),Wt(this,Kt,Tt(this,Ut).append("g").attr("data-ui-component","county").attr("class","sub-title")),Wt(this,Qt,Tt(this,Ut).append("g").attr("data-ui-component","port-circles")),Wt(this,Xt,Tt(this,Ut).append("g").attr("data-ui-component","port-icons").attr("class","click-circle")),Wt(this,ee,Tt(this,Ut).append("g").attr("data-ui-component","port-names").attr("class","fill-white")),Wt(this,Jt,Tt(this,Ut).append("g").attr("data-ui-component","patrol-zone").attr("class","fill-yellow-dark"))}_setupCounties(){const t={x:this.map.coord.max/2,y:this.map.coord.max/2};Wt(this,Ht,Tt(this,Ht).sort(((e,i)=>{const a={x:e.centroid[0],y:e.centroid[1]},s={x:i.centroid[0],y:i.centroid[1]};return(0,l.UI)(t,a)-(0,l.UI)(t,s)}))),Tt(this,Ft).domain(Tt(this,Ht).map((t=>t.name)))}_setupPatrolZones(){const t=dt().utc("2021-01-17").hour(h.WF);let e=dt().utc().diff(t,"day");"eu2"===Tt(this,Le)&&(e+=4),e%=kt.length;const{radius:i,name:a,shallow:s,shipClass:n}=kt[e],r=1.6*i,[o,d]=kt[e].coordinates,c=Math.round(i/1.3),p=Math.round(Tt(this,Te)*i/100);Tt(this,Jt).append("circle").attr("class","background-yellow").attr("cx",o).attr("cy",d).attr("r",i),Tt(this,Jt).append("image").attr("height",r).attr("width",r).attr("x",o).attr("y",d).attr("transform",`translate(${Math.floor(-r/2)},${Math.floor(-r/1.6)})`).attr("xlink:href",Mt).attr("alt","Patrol zone"),Tt(this,Jt).append("text").attr("class","svg-text-center").attr("x",o).attr("y",d).attr("dy",c).attr("font-size",Math.round(1.6*p)).text(a),Tt(this,Jt).append("text").attr("class","svg-text-center").attr("x",o).attr("y",d).attr("dy",c-1.6*p).attr("font-size",p).html(s?"Shallow water ships":(n?`${(0,l.hg)(n.min)} to ${(0,l.hg)(n.max)} rate`:"All")+" ships")}_setupSummary(){Wt(this,Yt,(0,a.Z)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary shadow port-summary-no-wind")),Wt(this,pe,Tt(this,Yt).append("div").attr("class","block")),Wt(this,ve,Tt(this,pe).append("div")),Tt(this,pe).append("div").attr("class","overlay-des").html("selected<br>ports"),Wt(this,ue,Tt(this,Yt).append("div").attr("class","block")),Wt(this,me,Tt(this,ue).append("div")),Tt(this,ue).append("div").attr("class","overlay-des").html("tax<br>income"),Wt(this,ce,Tt(this,Yt).append("div").attr("class","block")),Wt(this,we,Tt(this,ce).append("div")),Tt(this,ce).append("div").attr("class","overlay-des").html("net<br>income")}_setupFlags(){const t=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${Tt(this,We)} ${.75*Tt(this,We)}`),e},e=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(Tt(this,We))),e.setAttribute("height",String(Tt(this,We))),e.setAttribute("href",o.eM[t].replace('"',"").replace('"',"")),e},i=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(Tt(this,We)/2)),t.setAttribute("cy",String(Tt(this,We)/2)),t.setAttribute("r","16"),t.setAttribute("class","circle-highlight-yellow"),t},a=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(Tt(this,We)/2)),t.setAttribute("cy",String(Tt(this,We)/2)),t.setAttribute("r","16"),t.setAttribute("class","circle-highlight"),t},s=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",o.Om),t.setAttribute("fill-opacity","0.7"),t},n=document.querySelector("#na-svg defs");for(const r of gt.nU.map((t=>t.short))){const o=t(r);o.append(e(r));const l=n.appendChild(o);if("FT"!==r){const t=l.cloneNode(!0);t.id=`${r}r`,t.append(a()),n.append(t)}if("NT"!==r&&"FT"!==r){const t=l.cloneNode(!0);t.id=`${r}c`,t.append(i()),n.append(t);const e=l.cloneNode(!0);e.id=`${r}a`,e.append(s()),n.append(e);const o=e.cloneNode(!0);o.id=`${r}ra`,o.append(a()),n.append(o)}}}_getPortName(t){var e;return t?(null===(e=Tt(this,Lt).find((e=>e.id===t)))||void 0===e?void 0:e.name)??"":""}_getText(t){var e;const i=dt().utc(t.portBattle),a=dt().utc(t.portBattle).local(),s=i===a?"":` (${a.format("H.mm")} local)`,n=dt().utc(t.cooldownTime),r=dt().utc(t.cooldownTime).local(),l=n===r?"":` (${r.format("H.mm")} local)`,h=(0,o.eA)(t.portBattleStartTime),d=i.isAfter(dt().utc())?"s":"ed",c=t.portBattle?Dt`<span
                      class="flag-icon-${t.attackerNation} flag-icon-small me-1"
                      role="img"
                      title="${(null===(e=(0,gt.$i)((null==t?void 0:t.attackerNation)??""))||void 0===e?void 0:e.sortName)??""}"
                  ></span
                  >${(0,_t.HL)(t.attackerClan)} attack${t.portBattle?Dt`${d} ${i.fromNow()} at ${i.format("H.mm")}${s}`:Dt`s: ${(0,v.sR)(t.attackHostility??0)} hostility`}`:Dt``,p={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:""===t.county?"":t.county,region:""===t.region?"":t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?(0,_t.HL)(t.capturer):Dt``,captureTime:t.captured?`${(0,gt.fm)(dt().utc(t.captured).fromNow())}`:"",attack:t.attackHostility?c:Dt``,isNPCAttacker:"NT"===t.attackerNation,pbTimeRange:t.capturable?h:"",brLimit:(0,v.yI)(t.brLimit),portPoints:t.capturable?(0,v.yI)(t.portPoints):"",taxIncome:(0,v.RK)(t.taxIncome),portTax:(0,v.sR)(t.portTax),netIncome:(0,v.RK)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:this._formatItems(t.dropsTrading),consumesTrading:this._formatItems(t.consumesTrading),producesNonTrading:this._formatItems(t.producesNonTrading),dropsNonTrading:this._formatItems(t.dropsNonTrading),tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:{profit:this._formatProfits(t.goodsToSellInTradePort),profitPerTon:this._formatProfitsPerTon(t.goodsToSellInTradePort)},goodsToBuyInTradePort:{profit:this._formatProfits(t.goodsToBuyInTradePort),profitPerTon:this._formatProfitsPerTon(t.goodsToBuyInTradePort)}};return p.dropsTrading.length>0&&p.dropsNonTrading.length>0&&(p.dropsNonTrading+=" ‒ "),t.cooldownTime&&(p.cooldownTime=Dt`${n.fromNow()} at <em>approximately</em> ${n.format("H.mm")}${l}`),t.portBonus&&(p.portBonus=t.portBonus),p}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return Dt`
            <div class="d-flex justify-content-between mb-4">
                <div class="d-flex">
                    <i class="flag-icon-${t.icon} flag-icon-large ${e}" role="img" />

                    <div class="text-start align-self-center compress mx-3">
                        <div class="large mb-1">${t.name}</div>
                        <div class="caps">${t.county}</div>
                        <div class="caps">${t.region}</div>
                    </div>
                </div>

                ${t.portBonus?Dt`<div class="d-flex align-self-end me-1">${Dt`${ft.y7.map((e=>{var i;return Dt`${null!=t&&null!==(i=t.portBonus)&&void 0!==i&&i[e]?Dt`<div class="me-1">
                          <i class="icon icon-light icon-${e}" role="img" aria-label="${e} bonus"></i>
                          <div class="x-large text-lighter text-center">${t.portBonus[e]}</div>
                      </div>`:Dt``}`}))}`}</div>`:Dt``}

                <div class="d-flex flex-column justify-content-end align-self-center">
                    <div class="ms-auto">
                        ${t.portPoints?Dt`<span class="x-large text-lighter">${t.portPoints}</span>`:Dt``}
                    </div>
                    <div class="ms-auto">
                        ${t.laborHoursDiscount?Dt`<i
                                  class="icon icon-light icon-labour me-1"
                                  role="img"
                                  aria-label="Labour hour discount level ${t.laborHoursDiscount}"
                              ></i>`:Dt``}
                        ${t.tradingCompany?Dt`<i
                                  class="icon icon-light icon-trading me-1"
                                  role="img"
                                  aria-label="Trading company level ${t.tradingCompany}"
                              ></i>`:Dt``}
                        ${t.availableForAll?Dt`<i
                                  class="icon icon-light icon-open me-1"
                                  role="img"
                                  aria-label="Accessible to all"
                              ></i>`:Dt``}
                        ${t.shallow?Dt`<i class="icon icon-light icon-shallow" role="img" aria-label="Shallow"></i>`:Dt`<i class="icon icon-light icon-deep" role="img" aria-label="Deep"></i>`}
                    </div>
                </div>
            </div>

            ${void 0===t.attack?Dt`${t.cooldownTime?Dt`<div class="alert alert-success mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:Dt``}`:Dt`<div class="alert mt-2 ${t.isNPCAttacker?"alert-warning":"alert-danger"}" role="alert">
                      ${t.attack}
                  </div>`}

            <div class="d-flex text-start mb-2 compress">
                ${t.capital||"FT"===t.icon?Dt`<div>${t.portTax}<br /><span class="des top-0">Tax rate</span></div>`:Dt`
                          <div class="me-3">
                              ${t.pbTimeRange}<br />
                              <span class="des top-0">Battle timer</span>
                          </div>
                          <div class="me-3">
                              ${t.brLimit}<br />
                              <span class="des top-0">Rating</span>
                          </div>
                          ${t.capturer?Dt` <div class="me-3">
                                        ${t.capturer}<br />
                                        <span class="des top-0">Capturer</span>
                                    </div>
                                    <div class="me-5">
                                        ${t.captureTime}<br />
                                        <span class="des top-0">Capture</span>
                                    </div>`:Dt``}

                          <div class="ms-auto me-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des top-0">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des top-0">Net income</span>
                          </div>
                      `}
            </div>

            ${"tradePorts"===this.showRadius?Dt`${this._showProfits(t.goodsToSellInTradePort,t.tradePort,"buy")}${this._showProfits(t.goodsToBuyInTradePort,t.tradePort,"sell")}`:Dt` ${t.producesNonTrading.length>0?Dt`<p class="mb-2">
                            <span class="caps">Produces—</span
                            ><span class="non-trading">${t.producesNonTrading}</span>
                        </p>`:Dt``}
                  ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?Dt`<p class="mb-2">
                            <span class="caps">Drops—</span>
                            ${t.dropsNonTrading?Dt`<span class="non-trading">${t.dropsNonTrading}</span>`:Dt``}
                            ${t.dropsTrading}
                        </p> `:Dt``}
                  ${t.consumesTrading.length>0?Dt`<p class="mb-2"><span class="caps">Consumes—</span>${t.consumesTrading}</p>`:Dt``}`}
        `}_getInventory(t){const e=t=>{var e;return(null===(e=this.tradeItem.get(t))||void 0===e?void 0:e.name)??""};let i="";const a=t.inventory.filter((t=>t.buyQuantity>0&&t.buyPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,v.yI)(t.buyQuantity)} ${e(t.id)} @ ${(0,v.Pj)(t.buyPrice)}`)).join("<br>"),s=t.inventory.filter((t=>t.sellQuantity>0&&t.sellPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,v.yI)(t.sellQuantity)} ${e(t.id)} @ ${(0,v.Pj)(t.sellPrice)}`)).join("<br>");return i+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,a.length>0&&(i+="<h6>Buy</h6>",i+=a),a.length>0&&s.length>0&&(i+="<p></p>"),s.length>0&&(i+="<h6>Sell</h6>",i+=s),i}_hideDetails(){void 0!==Tt(this,be)&&(Tt(this,be).dispose(),Wt(this,be,void 0))}_showDetails(t,e){const i=t.currentTarget;this._hideDetails(),Wt(this,be,new(tt())(i,{html:!0,placement:"auto",trigger:"manual",title:(0,lt.ZP)(this._tooltipData(this._getText(e))),sanitize:!1})),Tt(this,be).show(),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(this._getInventory(e)))}_updateIcons(){const t=Tt(this,fe)<.5?2*Tt(this,fe):Tt(this,fe),e=Tt(this,Me)/t,i=Tt(this,he);Tt(this,Xt).selectAll("circle").data(i,(t=>String(t.id))).join((t=>t.append("circle").attr("fill",(t=>{const e=`${"FT"===t.nation||"NT"===t.nation||t.capturable?"":"c"}${t.countyCapital&&t.capturable?"r":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`})).attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])).on("click",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",(()=>{this._hideDetails()})))).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getAttackMarker(t){let e="";return t.cooldownTime?e="cooldown":"NT"===t.attackerNation&&(e="raider"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=Tt(this,fe)<.5?2*Tt(this,fe):Tt(this,fe),e=Tt(this,Me)/t,i=(0,l.qY)(e*Tt(this,$e)),a=(0,l.qY)(e*Tt(this,De)),s=1e5;let n=Tt(this,he),r=()=>"",o=()=>0,h=()=>"";switch(this.showRadius){case"tax":n=Tt(this,he).filter((t=>t.capturable&&t.taxIncome>s)),Tt(this,de).domain([Tt(this,le),Tt(this,ne)]).range([i,a]),r=()=>"bubble",h=t=>Tt(this,qt).call(this,t.taxIncome)??"",o=t=>Tt(this,de).call(this,t.taxIncome)??0;break;case"net":n=Tt(this,he).filter((t=>t.capturable&&Math.abs(t.netIncome)>s)),Tt(this,de).domain([Tt(this,re),Tt(this,ae)]).range([i,a]),r=()=>"bubble",h=t=>Tt(this,Vt).call(this,t.netIncome)??"",o=t=>Tt(this,de).call(this,Math.abs(t.netIncome))??0;break;case"points":n=Tt(this,he).filter((t=>t.capturable&&t.portPoints>30)),Tt(this,de).domain([Tt(this,oe),Tt(this,se)]).range([i,a/2]),r=()=>"bubble",h=t=>Tt(this,Gt).call(this,t.portPoints)??"",o=t=>Tt(this,de).call(this,t.portPoints)??0;break;case"position":r=()=>"bubble here",o=t=>t.distance??0;break;case"attack":n=Tt(this,he).filter((t=>t.attackHostility||t.cooldownTime)),Tt(this,zt).range([i,a/1.5]),r=t=>`bubble ${this._getAttackMarker(t)}`,h=t=>"NT"===t.attackerNation?"":Tt(this,Rt).call(this,t.attackHostility??0)??"",o=t=>Tt(this,zt).call(this,t.attackHostility??(t.cooldownTime?.2:0))??0;break;default:if("currentGood"===this.circleType)r=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>a/2;else switch(this.showRadius){case"county":r=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",h=t=>t.capturable?Tt(this,Ft).call(this,t.county):"",o=t=>t.capturable?a/2:a/3;break;case"tradePorts":r=t=>`bubble ${this._getTradePortMarker(t)}`,o=t=>t.id===this.tradePortId?a:a/2;break;case"frontline":r=t=>`bubble ${this._getFrontlineMarker(t)}`,o=t=>t.ownPort?a/3:a/2,n=n.filter((t=>t.enemyPort??t.ownPort));break;case"currentGood":r=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>a/2;break;case"off":n=[]}}Tt(this,Qt).selectAll("circle").data(n,(t=>String(t.id))).join((t=>t.append("circle").attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])))).attr("class",(t=>r(t))).attr("r",(t=>o(t))).attr("fill",(t=>h(t)))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===Tt(this,Ne)||"single"===Tt(this,Ne)&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.3*e*Math.cos((0,l.Ht)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const a=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+a;const s=t.angle>90&&t.angle<270?i:0;return"all"===Tt(this,Ne)||"single"===Tt(this,Ne)&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.3*e*Math.sin((0,l.Ht)(t.angle)))+s:t.coordinates[1]+a}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===Tt(this,Ne)||"single"===Tt(this,Ne)&&t.id===this.currentPort.id)?t.angle>0&&t.angle<l.tz?"start":"end":"middle"}updateTexts(){if("initial"===this.zoomLevel)Tt(this,ee).classed("d-none",!0);else{const t=(0,l.qY)(Tt(this,Me)/Tt(this,fe)),e=(0,l.qY)(Tt(this,Te)/Tt(this,fe)),i=Tt(this,he);Tt(this,ee).selectAll("text").data(i,(t=>String(t.id))).join((t=>t.append("text").text((t=>t.name)))).attr("x",(e=>this._updateTextsX(e,t))).attr("y",(i=>this._updateTextsY(i,t,e))).style("text-anchor",(t=>this._updateTextsAnchor(t))).style("dominant-baseline","auto"),Tt(this,ee).attr("font-size",`${e}px`).classed("d-none",!1)}}_updateSummary(){const t=Object.keys(Tt(this,It)).length;let e=0,i=0;t&&(e=(0,at.Z)(Tt(this,It),(t=>t.taxIncome)),i=(0,at.Z)(Tt(this,It),(t=>t.netIncome))),Tt(this,ve).text(`${t}`),Tt(this,me).html(`${(0,v.Dw)(e)}`),Tt(this,we).html(`${(0,v.Dw)(i)}`)}_updateCounties(){if("portLabel"===this.zoomLevel){const t=Tt(this,Ot);Tt(this,Kt).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name))),(t=>t.attr("fill",(t=>"county"===this.showRadius?Tt(this,Ft).call(this,t.name):"")))),Tt(this,Kt).classed("d-none",!1)}else Tt(this,Kt).classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=Tt(this,_e);Tt(this,te).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name)))),Tt(this,te).classed("d-none",!1)}else Tt(this,te).classed("d-none",!0)}_updatePZ(){"pbZone"===this.zoomLevel?Tt(this,Jt).classed("d-none",!0):Tt(this,Jt).classed("d-none",!1)}update(t){Wt(this,fe,t??Tt(this,fe)),this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions(),this._updatePZ()}_filterVisible(){"position"===this.showRadius?Wt(this,he,Tt(this,It)):Wt(this,he,Tt(this,It).filter((t=>t.coordinates[0]>=Tt(this,ie)[0]&&t.coordinates[0]<=Tt(this,ye)[0]&&t.coordinates[1]>=Tt(this,ie)[1]&&t.coordinates[1]<=Tt(this,ye)[1]))),Wt(this,Ot,Tt(this,Ht).filter((t=>t.centroid[0]>=Tt(this,ie)[0]&&t.centroid[0]<=Tt(this,ye)[0]&&t.centroid[1]>=Tt(this,ie)[1]&&t.centroid[1]<=Tt(this,ye)[1]))),Wt(this,_e,Tt(this,ge).filter((t=>t.centroid[0]>=Tt(this,ie)[0]&&t.centroid[0]<=Tt(this,ye)[0]&&t.centroid[1]>=Tt(this,ie)[1]&&t.centroid[1]<=Tt(this,ye)[1])))}setBounds(t){Wt(this,ie,t[0]),Wt(this,ye,t[1])}_showSummary(){Tt(this,Yt).classed("hidden",!1)}setShowRadiusSetting(t=Tt(this,Ce)[0]){this.showRadius=t,Tt(this,Ie).set(this.showRadius),Tt(this,Se).set(this.showRadius)}clearMap(t){this._showSummary(),Wt(this,It,Tt(this,Lt)),this.circleType="",this.setShowRadiusSetting(),this.update(t)}get circleType(){return Tt(this,Pt)}set circleType(t){Wt(this,Pt,t)}get currentPort(){return Tt(this,Ct)}set currentPort(t){Wt(this,Ct,t)}get portData(){return Tt(this,It)}set portData(t){Wt(this,It,t)}get portDataDefault(){return Tt(this,Lt)}get showRadius(){return Tt(this,At)}set showRadius(t){Wt(this,At,t)}get tradeItem(){return Tt(this,Et)}set tradeItem(t){Wt(this,Et,t)}get showTradePortPartners(){return Tt(this,Nt)}set showTradePortPartners(t){Wt(this,Zt,t)}get tradePortId(){return Tt(this,jt)}set tradePortId(t){Wt(this,jt,t)}get zoomLevel(){return Tt(this,Bt)}set zoomLevel(t){Wt(this,Bt,t)}}var Ze=i(5162),Ee=i(9875),je=i(7281),Be=i(2938),ze=i(9492);function Fe(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Re(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ge(t,e,"get"))}function Ve(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ge(t,e,"set"),i),i}function Ge(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var qe=new WeakMap,He=new WeakMap,Oe=new WeakMap,Ye=new WeakMap;class Ke extends p.Z{constructor(t){super(t,"sm","Set"),Fe(this,qe,{writable:!0,value:"ship-journey"}),Fe(this,He,{writable:!0,value:{}}),Fe(this,Oe,{writable:!0,value:{}}),Fe(this,Ye,{writable:!0,value:{}})}async init(){this._injectModal();const{select:t,shipNameAndSpeed:e}=await(0,ze.hY)();Ve(this,He,t),Ve(this,Oe,e)}_injectModal(){const t=super.bodySel;Ve(this,Ye,new Be.Z(t,this.baseId));const e=t.select("form"),i=`${Re(this,qe)}-select`,a=e.append("div").attr("class","mt-3").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}getWind(){return Re(this,Ye).getWind()??0}_getShipId(){return Number(Re(this,He).getValues())}getShipName(){var t;const e=this._getShipId();return null===(t=Re(this,Oe).get(e))||void 0===t?void 0:t.name}getSpeedDegrees(){var t;const e=this._getShipId();return null===(t=Re(this,Oe).get(e))||void 0===t?void 0:t.speedDegrees}}function Xe(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Ue(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Je(t,e,"get"))}function Qe(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Je(t,e,"set"),i),i}function Je(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var ti=new WeakMap,ei=new WeakMap,ii=new WeakMap,ai=new WeakMap,si=new WeakMap,ni=new WeakMap;class ri{constructor(t){Xe(this,ti,{writable:!0,value:{}}),Xe(this,ei,{writable:!0,value:{}}),Xe(this,ii,{writable:!0,value:{}}),Xe(this,ai,{writable:!0,value:{}}),Xe(this,si,{writable:!0,value:{}}),Xe(this,ni,{writable:!0,value:void 0}),Qe(this,ni,t),this._setupSummary()}_setupSummary(){Qe(this,ti,(0,a.Z)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary shadow-lg d-none")),Qe(this,ei,Ue(this,ti).append("div").attr("class","block small")),Qe(this,ii,Ue(this,ei).append("div")),Ue(this,ei).append("div").attr("class","overlay-des").text("ship"),Qe(this,si,Ue(this,ti).append("div").attr("class","block small")),Qe(this,ai,Ue(this,si).append("div")),Ue(this,si).append("div").attr("class","overlay-des").text("wind"),Ue(this,ti).append("div").attr("class","block").append("button").attr("id",Ue(this,ni)).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){Ue(this,ti).classed("d-none",!t),(0,a.Z)("#port-summary").classed("d-none",t)}_printSummaryShip(t){Ue(this,ii).text(t)}_printSummaryWind(t){Ue(this,ai).html(`From ${(0,d.Iy)(t)}`)}show(){this._displaySummary(!0)}hide(){this._displaySummary(!1)}setPosition(t,e){Ue(this,ti).style("top",`${t}px`).style("right",`${e}px`)}print({startWindDegrees:t,shipName:e}){this._printSummaryWind(t),this._printSummaryShip(e)}}var oi=i(8250),li=i(7),hi=i(7422);function di(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function ci(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ui(t,e,"set"),i),i}function pi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ui(t,e,"get"))}function ui(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var wi=new WeakMap,vi=new WeakMap,mi=new WeakMap,gi=new WeakMap,_i=new WeakMap,fi=new WeakMap,bi=new WeakMap,yi=new WeakMap,ki=new WeakMap,Mi=new WeakMap;class Si{constructor(t,e,i){di(this,wi,{writable:!0,value:0}),di(this,vi,{writable:!0,value:10}),di(this,mi,{writable:!0,value:void 0}),di(this,gi,{writable:!0,value:void 0}),di(this,_i,{writable:!0,value:20}),di(this,fi,{writable:!0,value:void 0}),di(this,bi,{writable:!0,value:6}),di(this,yi,{writable:!0,value:1.3*pi(this,_i)}),di(this,ki,{writable:!0,value:n.CR.translate(pi(this,_i),pi(this,_i))}),di(this,Mi,{writable:!0,value:void 0}),ci(this,gi,t),ci(this,Mi,e),ci(this,mi,i),ci(this,fi,1.4*pi(this,mi))}_correctTextBox(t,e,i){const s=(0,a.Z)(i),n=s.select("text"),r=t.label.split("|");n.text("").attr("dy",0).attr("transform",pi(this,ki).toString()).style("font-size",`${pi(this,mi)}px`);for(const[t,e]of r.entries()){const i=n.append("tspan").html(e);t>0&&i.attr("x",0).attr("dy",pi(this,fi))}const o=n.node().getBBox(),l=t.label?o.width+2*pi(this,yi):0,h=t.label?o.height+pi(this,yi):0;s.select("rect").attr("width",l).attr("height",h).attr("class","svg-shadow");const d=s.select("circle").attr("r",0===e||e===pi(this,wi)?4*pi(this,vi):pi(this,vi)).attr("class","click-circle svg-shadow "+(0===e||e===pi(this,wi)?"drag-hidden":"drag-circle"));s.append((()=>d.remove().node()))}_correctJourney(){pi(this,gi).selectAll("#journey g.labels g.label").each(((t,e,i)=>{this._correctTextBox(t,e,i[e])})),pi(this,Mi)&&pi(this,Mi).style("stroke-width",`${pi(this,bi)}px`)}print(t){const e=(0,oi.Z)().padding(pi(this,_i)).value((t=>{const e=t.label.split("|"),i=e.reduce(((t,e,i,a)=>a[t].length>e.length?t:i),0);return e[i]})),i=(0,li.Z)(),a=(0,hi.Z)(i).size(((t,e,i)=>{const a=t.label.split("|").length,s=i[e].querySelectorAll("text")[0].getBBox();return[s.width+2*pi(this,_i),s.height*a+2*pi(this,_i)]})).position((t=>t.position)).component(e);pi(this,gi).datum(t).call(a),ci(this,wi,t.length-1),this._correctJourney()}}function xi(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Ti(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$i(t,e,"get"))}function Wi(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,$i(t,e,"set"),i),i}function $i(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Di=new WeakMap,Pi=new WeakMap,Ci=new WeakMap,Ii=new WeakMap,Li=new WeakMap,Ni=new WeakMap,Ai=new WeakMap,Zi=new WeakMap,Ei=new WeakMap,ji=new WeakMap,Bi=new WeakMap,zi=new WeakMap,Fi=new WeakMap,Ri=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,qi=new WeakMap,Hi=new WeakMap,Oi=new WeakMap,Yi=new WeakMap,Ki=new WeakMap,Xi=new WeakMap,Ui=new WeakMap,Qi=new WeakMap,Ji=new WeakMap,ta=new WeakMap,ea=new WeakMap;class ia{constructor(t){xi(this,Di,{writable:!0,value:{}}),xi(this,Pi,{writable:!0,value:{}}),xi(this,Ci,{writable:!0,value:{}}),xi(this,Ii,{writable:!0,value:{}}),xi(this,Li,{writable:!0,value:{}}),xi(this,Ni,{writable:!0,value:{}}),xi(this,Ai,{writable:!0,value:{}}),xi(this,Zi,{writable:!0,value:void 0}),xi(this,Ei,{writable:!0,value:void 0}),xi(this,ji,{writable:!0,value:void 0}),xi(this,Bi,{writable:!0,value:"journey-arrow"}),xi(this,zi,{writable:!0,value:5}),xi(this,Fi,{writable:!0,value:void 0}),xi(this,Ri,{writable:!0,value:"Make journey"}),xi(this,Vi,{writable:!0,value:void 0}),xi(this,Gi,{writable:!0,value:90}),xi(this,qi,{writable:!0,value:"None"}),xi(this,Hi,{writable:!0,value:19}),xi(this,Oi,{writable:!0,value:0}),xi(this,Yi,{writable:!0,value:o.er/60}),xi(this,Ki,{writable:!0,value:15}),xi(this,Xi,{writable:!0,value:void 0}),xi(this,Ui,{writable:!0,value:void 0}),xi(this,Qi,{writable:!0,value:void 0}),xi(this,Ji,{writable:!0,value:2}),xi(this,ta,{writable:!0,value:2}),xi(this,ea,{writable:!0,value:void 0}),Wi(this,Fi,(0,o.MF)(Ti(this,Ri))),Wi(this,Qi,`menu-${Ti(this,Fi)}`),Wi(this,Vi,`compass-${Ti(this,Fi)}`),Wi(this,Xi,`button-delete-leg-${Ti(this,Fi)}`),Wi(this,Ui,(0,je.Z)().x((t=>t[0])).y((t=>t[1]))),Wi(this,ea,(0,w.Z)().domain((0,Ze.Z)(0,l.QF,Ti(this,Ki)))),this._setupDrag(),this._setupSvg(),this._initJourneyData(),Wi(this,Zi,new Si(Ti(this,Ni),Ti(this,Li),t)),Wi(this,ji,new ri(Ti(this,Xi))),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0===e?"":(0,o.gY)(e,"hour");a+=t+(""===t?"":" ")+(0===i?"":(0,o.gY)(i,"minute"))}return a}_setupDrag(){const t=t=>{this._removeLabels(),(0,a.Z)(t).classed("drag-active",!0)},e=(t,e,i)=>{const s=i.position[0]+Number(e.dx),n=i.position[1]+Number(e.dy);0===i.index&&Ti(this,Di).attr("x",s).attr("y",n),(0,a.Z)(t).attr("cx",e.x).attr("cy",e.y),i.position=[s,n],this._printLines()},i=t=>{(0,a.Z)(t).classed("drag-active",!1),this._printWholeJourney()};Wi(this,Pi,(0,Ee.Z)().on("start",(function(){t(this)})).on("drag",(function(t,i){e(this,t,i)})).on("end",(function(){i(this)})))}_setupSvg(){const t=Ti(this,zi),e=2*Ti(this,zi);Wi(this,Ci,(0,a.Z)("#ports").append("g").attr("id","journey").attr("class","svg-background-dark")),Wi(this,Li,Ti(this,Ci).append("path")),Wi(this,Ni,Ti(this,Ci).append("g").attr("class","labels")),(0,a.Z)("#na-svg defs").append("marker").attr("id",Ti(this,Bi)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-light").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){Wi(this,Ai,{shipName:Ti(this,qi),startWindDegrees:Ti(this,Oi),currentWindDegrees:Ti(this,Oi),totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]})}_resetJourneyData(){var t;Ti(this,Ai).startWindDegrees=(null===(t=Ti(this,Ei))||void 0===t?void 0:t.getWind())??Ti(this,Oi),Ti(this,Ai).currentWindDegrees=Ti(this,Ai).startWindDegrees,Ti(this,Ai).totalDistance=0,Ti(this,Ai).totalMinutes=0}async _menuClicked(){(0,r.KS)("Menu",Ti(this,Ri)),Ti(this,Ei)?Ti(this,Ei).show():(Wi(this,Ei,new Ke(Ti(this,Ri))),await Ti(this,Ei).init(),Ti(this,Ei).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){document.querySelector(`#${Ti(this,Qi)}`).addEventListener("click",(()=>{this._menuClicked()})),document.querySelector(`#${Ti(this,Xi)}`).addEventListener("click",(()=>{this._deleteLastLeg()}))}_useUserInput(){this._setShipName(),this._printWholeJourney(),this._printSummary()}_printCompass(){const t=Ti(this,Ai).segments[0].position[0],e=Ti(this,Ai).segments[0].position[1];Wi(this,Di,Ti(this,Ci).insert("svg","path").attr("id",Ti(this,Vi)).attr("class","fill-background-colour").attr("x",t).attr("y",e)),Wi(this,Ii,Ti(this,Di).append("g")),(0,d.$G)({element:Ti(this,Ii),radius:Ti(this,Gi)})}_removeCompass(){Ti(this,Di).remove()}_getSpeedAtDegrees(t){return Math.max(Ti(this,ea).call(this,t)??0,Ti(this,Ji))}_calculateDistanceForSection(t,e){const i=(l.QF-t+e)%l.QF;return this._getSpeedAtDegrees(i)*Ti(this,ta)*l.nX}_setShipSpeed(){var t;const e=(null===(t=Ti(this,Ei))||void 0===t?void 0:t.getSpeedDegrees())??Array.from({length:24},(()=>Ti(this,Hi)/2));Ti(this,ea).range(e)}_calculateMinutesForSegment(t,e,i){let a=i,s=e,n=0;for(this._setShipSpeed();a>0;){const e=this._calculateDistanceForSection(t,s);a>e?(a-=e,n+=1):(n+=a/e,a=0),s=(l.QF+s-Ti(this,Yi))%l.QF}return Ti(this,Ai).currentWindDegrees=s,n}_setShipName(){const t=Ti(this,Ei).getShipName();Ti(this,Ai).shipName=t||Ti(this,qi)}_removeLabels(){const t=Ti(this,Ci).selectAll("#journey g.label");t.select("text").remove(),t.select("rect").remove()}_printSummary(){Ti(this,ji).print(Ti(this,Ai))}_printLines(){Ti(this,Li)&&Ti(this,Li).datum(Ti(this,Ai).segments.length>1?Ti(this,Ai).segments.map((t=>t.position)):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("class","svg-shadow").attr("d",Ti(this,Ui))}_getTextDirection(t,e,i){return`${(0,d.Iy)(t,!0)} ⁖ F11: ${(0,v.Hu)((0,l.IK)(i.x,i.y))} / ${(0,v.Hu)((0,l.pw)(i.x,i.y))}`}_getTextDistance(t,e,i){let a=`${Math.round(t)} k ${ia._getHumanisedDuration(e)}`;return i&&(a+=`⁖ total ${Math.round(Ti(this,Ai).totalDistance)} k ${ia._getHumanisedDuration(Ti(this,Ai).totalMinutes)}`),a}_calculateSegmentLabel(t){const e={x:Ti(this,Ai).segments[t].position[0],y:Ti(this,Ai).segments[t].position[1]},i={x:Ti(this,Ai).segments[t-1].position[0],y:Ti(this,Ai).segments[t-1].position[1]},a=(0,d.Fq)(e,i),s=(0,l.Sp)(e,i),n=(0,l.tT)(a),r=this._calculateMinutesForSegment(a,Ti(this,Ai).currentWindDegrees,1e3*s);Ti(this,Ai).totalDistance+=s,Ti(this,Ai).totalMinutes+=r;const o=this._getTextDirection(n,a,e),h=this._getTextDistance(s,r,t>1);Ti(this,Ai).segments[t].label=`${o}|${h}`}_setSegmentLabels(t){if(t)this._calculateSegmentLabel(Ti(this,Ai).segments.length-1);else for(const[t]of Ti(this,Ai).segments.entries())t<Ti(this,Ai).segments.length-1&&this._calculateSegmentLabel(t+1)}_print(t){this._printLines(),this._setSegmentLabels(t),Ti(this,Zi).print(Ti(this,Ai).segments),Ti(this,Ci).selectAll("#journey g.labels g.label circle").call(Ti(this,Pi))}_printAdditionalSegment(){this._print(!0)}_printWholeJourney(){this._resetJourneyData(),this._print(!1)}_deleteLastLeg(){Ti(this,Ai).segments.pop(),Ti(this,Ai).segments.length>0?this._printWholeJourney():(Ti(this,ji).hide(),Ti(this,Ci).selectAll("#journey g.labels g.label").remove(),Ti(this,Li).remove(),this._removeCompass(),this._initJourneyData())}_initJourney(){Ti(this,ji).show(),this._printSummary(),this._printCompass()}setSummaryPosition(t,e){Ti(this,ji).setPosition(t,e)}plotCourse(t,e){Ti(this,Ai).segments[0].position[0]>0?(Ti(this,Ai).segments.push({position:[t,e],label:"",index:Ti(this,Ai).segments.length}),this._printAdditionalSegment()):(Ti(this,Ai).segments[0]={position:[t,e],label:"",index:0},this._initJourney())}}var aa=i(9157),sa=i(6411),na=i(1739),ra=i(9488);function oa(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function la(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,da(t,e,"get"))}function ha(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,da(t,e,"set"),i),i}function da(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}dt().extend(pt());var ca=new WeakMap,pa=new WeakMap,ua=new WeakMap,wa=new WeakMap,va=new WeakMap,ma=new WeakMap,ga=new WeakMap,_a=new WeakMap,fa=new WeakMap,ba=new WeakMap,ya=new WeakMap,ka=new WeakMap,Ma=new WeakMap,Sa=new WeakMap,xa=new WeakMap,Ta=new WeakMap,Wa=new WeakMap,$a=new WeakMap,Da=new WeakMap,Pa=new WeakMap,Ca=new WeakMap,Ia=new WeakMap,La=new WeakMap,Na=new WeakMap,Aa=new WeakMap,Za=new WeakMap,Ea=new WeakMap,ja=new WeakMap,Ba=new WeakMap,za=new WeakMap,Fa=new WeakMap,Ra=new WeakMap,Va=new WeakMap,Ga=new WeakMap,qa=new WeakMap,Ha=new WeakMap;class Oa{constructor(t,e,i){this.map=t,this.serverId=e,this.coord=i,oa(this,ca,{writable:!0,value:void 0}),oa(this,pa,{writable:!0,value:void 0}),oa(this,ua,{writable:!0,value:"Power map"}),oa(this,wa,{writable:!0,value:void 0}),oa(this,va,{writable:!0,value:0}),oa(this,ma,{writable:!0,value:{}}),oa(this,ga,{writable:!0,value:{}}),oa(this,_a,{writable:!0,value:0}),oa(this,fa,{writable:!0,value:-1}),oa(this,ba,{writable:!0,value:0}),oa(this,ya,{writable:!0,value:0}),oa(this,ka,{writable:!0,value:{}}),oa(this,Ma,{writable:!0,value:0}),oa(this,Sa,{writable:!0,value:{}}),oa(this,xa,{writable:!0,value:{}}),oa(this,Ta,{writable:!0,value:{}}),oa(this,Wa,{writable:!0,value:0}),oa(this,$a,{writable:!0,value:0}),oa(this,Da,{writable:!0,value:{}}),oa(this,Pa,{writable:!0,value:{}}),oa(this,Ca,{writable:!0,value:0}),oa(this,Ia,{writable:!0,value:new Map}),oa(this,La,{writable:!0,value:[]}),oa(this,Na,{writable:!0,value:{}}),oa(this,Aa,{writable:!0,value:{}}),oa(this,Za,{writable:!0,value:{}}),oa(this,Ea,{writable:!0,value:{}}),oa(this,ja,{writable:!0,value:0}),oa(this,Ba,{writable:!0,value:!1}),oa(this,za,{writable:!0,value:{}}),oa(this,Fa,{writable:!0,value:void 0}),oa(this,Ra,{writable:!0,value:void 0}),oa(this,Va,{writable:!0,value:void 0}),oa(this,Ga,{writable:!0,value:200}),oa(this,qa,{writable:!0,value:200}),oa(this,Ha,{writable:!0,value:2}),ha(this,ca,e),ha(this,Fa,t),ha(this,pa,`show-${(0,o.MF)(la(this,ua))}`),ha(this,wa,`menu-${la(this,pa)}`),ha(this,Va,i),ha(this,Ra,(0,nt.Z)().domain(gt.nU.map((t=>t.id))).range(gt.nU.map((t=>t.colours[0])))),this._setupListener()}_setupData(t){ha(this,Za,t.power),ha(this,_a,la(this,Za).length-1),ha(this,Pa,(0,a.Z)("g#map"))}async _loadData(){const t=[{fileName:`${this.serverId}-power.json`,name:"power"}],e={};return ha(this,Aa,(await i.e(462).then(i.t.bind(i,9131,19))).default),await(0,o.EZ)(t,e),e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}async _menuClicked(){(0,r.KS)("Tools",la(this,ua)),await this._loadAndSetupData(),(0,o.dM)(),this._mapElementsOff(),this._initialMapZoom(),this._initVoronoi(),this._initCanvas(),this._drawPowerMap()}_setupListener(){var t;null===(t=document.querySelector(`#${la(this,wa)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showMapElements(t){la(this,Pa).classed("d-none",!t),(0,a.Z)("main div.overlay").classed("d-none",!t)}_mapElementsOff(){this._showMapElements(!1)}_mapElementsOn(){this._showMapElements(!0)}_drawEnd(){(0,o.V4)(),this._mapElementsOn()}async _setPattern(){const t=Object.values(o.eM);try{const e=await(0,ra.Z)(t);for(const[t,i]of e.entries())la(this,La)[t]=la(this,ma).createPattern(i,"repeat")}catch(t){console.error("One or more images have failed to load :("),console.error(t.errored),console.info("But these loaded fine:"),console.info(t.loaded)}}_drawDate(t){const e=dt()(t).format("D MMMM YYYY");la(this,ga).text(e)}_drawMap(t,e,i){for(const[t,e]of i.entries())la(this,ma).beginPath(),la(this,za).renderCell(t,la(this,ma)),la(this,ma).fillStyle=la(this,La)[e]??"#000",la(this,ma).fill();this._drawDate(e)}async _drawLoop(){let t,e;for(;!la(this,Ba)&&la(this,fa)<la(this,_a);){ha(this,fa,la(this,fa)+1),this._setRangeValue(),t=la(this,Za)[la(this,fa)][0],e=la(this,Za)[la(this,fa)][1];const i=(0,na.HT)((a=>{this._drawMap(la(this,fa),t,e),(a>la(this,qa)||la(this,Ba))&&i.stop()}));this._drawNationLegend(e),await(0,gt._v)(1.1*la(this,qa))}this._drawEnd()}_drawPowerMap(){this._drawLoop()}_initVoronoi(){const t=new Set([96,112,150,179,214,231,286,343,366]),e=la(this,Aa).filter((e=>!t.has(e.id))).map((t=>t.coordinates)),i=sa.Z.from(e);ha(this,Ca,(0,it.Z)(e,(t=>t[1]))??la(this,Va).max);const a=[la(this,Va).min,la(this,Va).min,la(this,Va).max,la(this,Ca)];ha(this,za,i.voronoi(a))}_initLegend(t){ha(this,ka,(0,a.Z)("#na-map div").append("div").style("position","relative").style("width",`${t.width}px`).style("top",`-${t.top}px`).style("left",`${t.left}px`).attr("class","d-flex flex-column")),this._initController(),this._initNationLegend(t)}_initNationLegend(t){ha(this,Wa,Math.floor(40*l.L9)),ha(this,$a,Math.floor(l.L9)),ha(this,ba,Math.floor(5*l.L9));const{width:e}=t,i=75+2*la(this,ba),a=gt.nU.length*i-2*la(this,ba);ha(this,ja,Math.ceil(a/e)),ha(this,va,Math.ceil(gt.nU.length/la(this,ja))),ha(this,ya,Math.ceil(e/la(this,va)-2*la(this,ba)));const s=la(this,ka).append("div");ha(this,Ta,s.append("div")),ha(this,xa,s.append("div"))}_getTopPosition(t){let e=-1===t?-la(this,Wa):Math.floor(t/la(this,va))*(10*la(this,$a)+la(this,Wa));return e+=16+la(this,Ma),`${e}px`}_getLeftPosition(t){return`${-1===t?-la(this,ya):Math.floor(t%la(this,va)*(la(this,ba)+la(this,ya)))}px`}_resetOldIndex(){ha(this,Ia,new Map)}_drawNationLegend(t){const e=(0,aa.Q3)(t,(t=>t.length),(t=>t)).sort(((t,e)=>e[1]-t[1]||t[0]-e[0])),i=t.length;la(this,Ta).selectAll("svg.legend").data(e,((t,e)=>String(e).padStart(2,"0")+String(t[0]).padStart(2,"0"))).join((t=>{const e=t.append("svg").attr("class","legend").attr("width",la(this,ya)).attr("height",la(this,Wa)+la(this,$a)).style("position","absolute").style("top",(t=>this._getTopPosition(la(this,Ia).get(t[0])??-1))).style("left",(t=>this._getLeftPosition(la(this,Ia).get(t[0])??-1))).transition().duration(la(this,qa)).style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e))).selection();return e.append("rect").attr("class","nation-header").attr("width",la(this,ya)).attr("height",Math.floor(la(this,Wa)/2)).style("fill",(t=>la(this,Ra).call(this,t[0]))),e.append("text").attr("class","nation-name").attr("x",Math.floor(la(this,ba)/2)).attr("y","25%").html((t=>{var e;return`${null===(e=(0,gt.dx)(t[0]))||void 0===e?void 0:e.sortName}`})).style("fill",(t=>(0,_t.IF)(la(this,Ra).call(this,t[0])))),e.append("rect").attr("class","opacity-low").attr("y",Math.floor(la(this,Wa)/2+la(this,$a))).attr("width","100%").attr("height",Math.floor(la(this,Wa)/2)).style("fill",(t=>la(this,Ra).call(this,t[0]))),e.append("rect").attr("class","value").attr("y",Math.floor(la(this,Wa)/2+la(this,$a))).attr("height",Math.floor(la(this,Wa)/2)).attr("width",(t=>la(this,ya)*(t[1]/i))).style("fill",(t=>la(this,Ra).call(this,t[0]))),e.append("text").attr("class","value").attr("x",la(this,ya)-la(this,ba)).attr("y","75%").style("text-anchor","end").html((t=>(0,v.Dw)(t[1],!0))),e}),(t=>(t.select("rect.value").attr("width",(t=>la(this,ya)*(t[1]/i))).style("fill",(t=>la(this,Ra).call(this,t[0]))),t.select("text.value").html((t=>(0,v.Dw)(t[1],!0))),t))),la(this,xa).selectAll("svg.index").data(e,((t,e)=>e)).join((t=>{const e=t.append("svg").attr("class","index").attr("width",la(this,ya)).attr("height",la(this,Wa)+la(this,$a)).style("position","absolute").style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e)));return e.append("text").attr("x",la(this,ya)/2).attr("y",(la(this,Wa)+la(this,$a))/2).attr("fill",o.L$).attr("opacity",0).attr("text-anchor","middle").attr("dominant-baseline","mathematical").attr("font-variant","normal").attr("font-size",`${la(this,Wa)}px`).text(((t,e)=>e+1)).transition().duration(la(this,qa)).attr("opacity",.3).selection(),e}),(t=>t),(t=>t.attr("opacity",.3).transition().duration(la(this,qa)).attr("opacity",0).remove().selection())),this._resetOldIndex();for(const[t,i]of e.entries())la(this,Ia).set(i[0],t)}_getRangeValue(){return la(this,Ea).property("value")}_setRangeValue(){la(this,Ea).property("value",la(this,fa))}_updateRangeValue(t=!1){ha(this,fa,Number.parseFloat(this._getRangeValue())),this._updateController(t)}_initRange(t){const e=`range-${la(this,pa)}`,i=t.append("div").attr("class","row col-md-7 mb-0");ha(this,Ea,i.append("div").attr("class","col-md-5").append("input").attr("id",e).attr("type","range").attr("class","form-range px-md-2").attr("style","height:100%").attr("min","0").attr("max",String(la(this,_a)))),i.append("div").attr("class","col-md-1"),ha(this,ga,i.append("label").attr("for",e).attr("class","col-md-6 col-form-label").attr("style","font-size:120%").attr("title","Date").text("Start"));let a=!1;la(this,Ea).on("change",(()=>{this._updateRangeValue()})).on("mousedown",(()=>{a=!0,ha(this,Ba,!0),this._togglePlayButton()})).on("mousemove",(()=>{a&&this._updateRangeValue(!0)})).on("mouseup",(()=>{a=!1}))}_getYear(t){return dt()(la(this,Za)[t][0]).year()}_togglePlayButton(){la(this,Na).classed("icon-pause",!la(this,Ba)).classed("icon-play",la(this,Ba))}_initialMapZoom(){la(this,Fa).zoomAndPan(la(this,Va).max/2,la(this,Va).max/2,!0)}_updateController(t=!1){const e=la(this,Za)[la(this,fa)][0],i=la(this,Za)[la(this,fa)][1];this._setRangeValue(),this._drawDate(e),this._adjustControllerHeight(),ha(this,Ba,!0),this._togglePlayButton(),t||(this._resetOldIndex(),this._drawMap(la(this,fa),e,i),this._drawNationLegend(i))}_initButtons(t){const e=`menu-${la(this,pa)}`,i=(t,i)=>s.append("button").attr("type","button").attr("id",`${e}-${t}`).attr("class","btn btn-default icon-button p-0").attr("title",i).append("i").attr("class",`icon icon-large icon-${t}`),a=t.append("div").attr("class","btn-toolbar col-md-4").attr("role","toolbar");let s=a.append("div").attr("class","btn-group").attr("role","group");const n=i("start","Start"),r=i("back","Year back");s=a.append("div").attr("class","btn-group").attr("role","group"),ha(this,Na,i("pause","Pause")),s=a.append("div").attr("class","btn-group me-3").attr("role","group");const o=i("forward","Year forward"),l=i("end","End");n.on("click",(()=>{ha(this,fa,0),this._updateController()})),r.on("click",(()=>{let t=la(this,fa);const e=this._getYear(t);let i=e;for(;t>0&&i===e;t--)i=this._getYear(t);ha(this,fa,t+1),this._updateController()})),la(this,Na).on("click",(()=>{ha(this,Ba,!la(this,Ba)),this._togglePlayButton(),la(this,Ba)||this._drawLoop()})),o.on("click",(()=>{let t=la(this,fa);const e=this._getYear(t);let i=e;for(;t<la(this,_a)&&i===e;t++)i=this._getYear(t);ha(this,fa,t-1),this._updateController()})),l.on("click",(()=>{ha(this,fa,la(this,_a)),this._updateController()})),s=a.append("div").attr("class","btn-group").attr("role","group");const h=i("slower","Slower"),d=i("normal","Normal speed"),c=i("faster","Faster");h.on("click",(()=>{ha(this,qa,la(this,qa)*la(this,Ha))})),d.on("click",(()=>{ha(this,qa,la(this,Ga))})),c.on("click",(()=>{ha(this,qa,Math.max(10,la(this,qa)/la(this,Ha)))})),s=t.append("div").attr("class","btn-group col-md-1").attr("role","group");i("close","Close").on("click",(()=>{this._drawEnd(),la(this,Da).remove(),this._initialMapZoom()}))}_adjustControllerHeight(){ha(this,Ma,(0,o.Uy)(la(this,Sa))),la(this,ka).selectAll("svg.legend").style("top",((t,e)=>this._getTopPosition(e))),la(this,ka).selectAll("svg.index").style("top",((t,e)=>this._getTopPosition(e)))}_initController(){const t=la(this,ka).append("div").style("background-color",o.L$).attr("class","p-2");ha(this,Sa,t.node());const e=t.append("form").append("div").attr("class","row input-group align-items-center"),i=new ResizeObserver((()=>{this._adjustControllerHeight()}));this._initRange(e),this._initButtons(e),ha(this,Ma,(0,o.Uy)(la(this,Sa))),i.observe(la(this,Sa))}_getTopAlignedTransform(t){var e;const{a:i,e:a}=(null===(e=t.transform.baseVal.consolidate())||void 0===e?void 0:e.matrix)||{};return i&&a?n.CR.scale(i).translate(a/i,0):{}}async _initCanvas(){const t=(0,a.Z)("#na-map svg g.map-tiles"),e=this._getTopAlignedTransform(la(this,Pa).node()),i=this._getTopAlignedTransform(t.node());la(this,Pa).attr("transform",e.toString()),t.attr("transform",i.toString());const s=(0,a.Z)("#na-map svg"),n=s.style("height"),r=s.style("width");ha(this,Da,(0,a.Z)("#na-map").append("div").style("position","relative").style("top",`-${n}`).style("height","100%").style("opacity",.7));const l=la(this,Da).append("canvas").node();l.style.height=n,l.style.width=r,l.height=Math.floor(2*Number.parseFloat(n)),l.width=Math.floor(2*Number.parseFloat(r)),ha(this,ma,(0,o.kU)(l)),la(this,ma).translate(2*e.x,2*e.y),la(this,ma).scale(2*e.k,2*e.k);const h=(0,o.mx)(t.node()),d={top:Math.floor(this.map.height-la(this,Ca)*e.k+e.y),left:e.x,width:h};this._initLegend(d),await this._setPattern()}}var Ya=i(6607),Ka=i.n(Ya),Xa=i(29);function Ua(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Qa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ts(t,e,"get"))}function Ja(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ts(t,e,"set"),i),i}function ts(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var es=new WeakMap,is=new WeakMap,as=new WeakMap;class ss{constructor(t){Ua(this,es,{writable:!0,value:{}}),Ua(this,is,{writable:!0,value:void 0}),Ua(this,as,{writable:!0,value:"port-select-pb-time"}),Ja(this,is,t),this._setupSelect(),this._setupListener()}_getOptions(){return`${[...new Set(Qa(this,is).portData.filter((t=>t.capturable)).map((t=>t.portBattleStartTime)).sort(((t,e)=>t-e)))].map((t=>`<option value="${t}">${(0,o.Db)(t)}</option>`)).join("")}`}_setupSelect(){Ja(this,es,new Xa.Z(Qa(this,as),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},this._getOptions()))}_selected(){const t=String(Qa(this,es).getValues());Qa(this,is).portData=Qa(this,is).portDataDefault.filter((e=>e.capturable&&e.portBattleStartTime===Number(t))),Qa(this,is).showRadius="",Qa(this,is).update()}_setupListener(){Qa(this,es).select$.on("change",(async()=>{(0,r.KS)("Menu",Qa(this,as)),this._selected()}))}}function ns(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function rs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ls(t,e,"get"))}function os(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ls(t,e,"set"),i),i}function ls(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var hs=new WeakMap,ds=new WeakMap,cs=new WeakMap,ps=new WeakMap;class us{constructor(t){ns(this,hs,{writable:!0,value:"Show goods’ relations"}),ns(this,ds,{writable:!0,value:void 0}),ns(this,cs,{writable:!0,value:void 0}),ns(this,ps,{writable:!0,value:{}}),os(this,cs,t),os(this,ds,`port-select-${(0,o.MF)(rs(this,hs))}`),this._setupSelect(),this._setupListener()}_getOptions(){const t=new Map,e=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const a of rs(this,cs).portDataDefault)for(const s of e){const e=a[s];if(e)for(const a of e){var i;t.set(a,(null===(i=rs(this,cs).tradeItem.get(a))||void 0===i?void 0:i.name)??"")}}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){os(this,ps,new Xa.Z(rs(this,ds),void 0,{},""))}_setupListener(){rs(this,ps).select$.one("show.bs.select",(()=>{rs(this,ps).setOptions(this._getOptions()),rs(this,ps).reset()})),rs(this,ps).select$.on("change",(()=>{(0,r.KS)("Menu",rs(this,hs)),this._selectSelected()}))}_selectSelected(){const t=Number(rs(this,ps).getValues()),e=JSON.parse(JSON.stringify(rs(this,cs).portDataDefault.filter((e=>{var i,a,s;return(null===(i=e.dropsTrading)||void 0===i?void 0:i.includes(t))||(null===(a=e.dropsNonTrading)||void 0===a?void 0:a.includes(t))||(null===(s=e.producesNonTrading)||void 0===s?void 0:s.includes(t))})))).map((t=>(t.isSource=!0,t))),i=JSON.parse(JSON.stringify(rs(this,cs).portDataDefault.filter((e=>{var i;return null===(i=e.consumesTrading)||void 0===i?void 0:i.includes(t)})))).map((t=>(t.isSource=!1,t)));rs(this,cs).setShowRadiusSetting("off"),rs(this,cs).portData=[...e,...i],rs(this,cs).showRadius="currentGood",rs(this,cs).update()}}function ws(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function vs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,gs(t,e,"get"))}function ms(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,gs(t,e,"set"),i),i}function gs(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var _s=new WeakMap,fs=new WeakMap,bs=new WeakMap,ys=new WeakMap,ks=new WeakMap,Ms=new WeakMap,Ss=new WeakMap,xs=new WeakMap;class Ts{constructor(t){ws(this,_s,{writable:!0,value:"Show trade relations"}),ws(this,fs,{writable:!0,value:void 0}),ws(this,bs,{writable:!0,value:new Map}),ws(this,ys,{writable:!0,value:{}}),ws(this,ks,{writable:!0,value:{}}),ws(this,Ms,{writable:!0,value:void 0}),ws(this,Ss,{writable:!0,value:void 0}),ws(this,xs,{writable:!0,value:new gt.y0}),ms(this,Ss,t),ms(this,Ms,vs(this,Ss).portData.length),ms(this,fs,`port-select-${(0,o.MF)(vs(this,_s))}`),this._setupSelect(),this._setupListener()}_getOptions(){return`${vs(this,Ss).portDataDefault.map((t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}))).sort((0,gt.MR)(["name"])).map((t=>`<option data-icon="flag-icon-${t.nation} flag-icon-small" value="${t.coord.toString()}/${t.id}">${t.name}</option>`)).join("")}`}_setupSelect(){ms(this,ys,new Xa.Z(vs(this,fs),void 0,{},""))}_setupListener(){vs(this,ys).select$.one("show.bs.select",(()=>{vs(this,ys).setOptions(this._getOptions()),vs(this,ys).reset()})),vs(this,ys).select$.one("change",(async()=>{await this._loadData()})),vs(this,ys).select$.on("change",(()=>{(0,r.KS)("Menu",vs(this,_s)),this._selectSelected()}))}async _loadData(){const t=(await i.e(971).then(i.t.bind(i,6720,19))).default;ms(this,bs,new Map(t.map((([t,e,i])=>[t*vs(this,Ms)+e,i]))))}_setTradePortPartners(){ms(this,ks,vs(this,Ss).portDataDefault.find((t=>t.id===vs(this,Ss).tradePortId))??[]),vs(this,ks)&&this._setTradeRelations()}_getSailingDistance(t,e){return t<e?vs(this,bs).get(t*vs(this,Ms)+e)??0:vs(this,bs).get(e*vs(this,Ms)+t)??0}_getBuyPrice(t){var e;return(null===(e=vs(this,Ss).tradeItem.get(t))||void 0===e?void 0:e.buyPrice)??0}_getSellPrice(t){var e;return(null===(e=vs(this,Ss).tradeItem.get(t))||void 0===e?void 0:e.sellPrice)??0}_getWeight(t){var e;return(null===(e=vs(this,Ss).tradeItem.get(t))||void 0===e?void 0:e.weight)??0}_getDistanceFactor(t){var e;return(null===(e=vs(this,Ss).tradeItem.get(t))||void 0===e?void 0:e.distanceFactor)??0}_getPortTax(t){var e;return(null===(e=vs(this,Ss).portDataDefault.find((e=>e.id===t)))||void 0===e?void 0:e.portTax)??0}_getCoordinates(t){const e=vs(this,Ss).portDataDefault.find((e=>e.id===t));return{x:(null==e?void 0:e.coordinates[0])??0,y:(null==e?void 0:e.coordinates[1])??0}}_getPlanarDistance(t,e){const i=this._getCoordinates(t),a=this._getCoordinates(e);return(0,l.Sp)(i,a)}_findClosestSourcePort(t,e){let i=Number.POSITIVE_INFINITY;const a=new Set(vs(this,Ss).portDataDefault.filter((t=>{var i,a;return(null===(i=t.dropsTrading)||void 0===i?void 0:i.includes(e))??(null===(a=t.dropsNonTrading)||void 0===a?void 0:a.includes(e))})).map((t=>t.id)));for(const e of a)i=Math.min(i,this._getPlanarDistance(e,t.id));return i}_calculateSellProfit(t,e,i){const a=this._findClosestSourcePort(e,i),s=this._getPortTax(t.id),n=this._getPortTax(e.id);let r=this._getBuyPrice(i),o=this._getSellPrice(i)+a*r*this._getDistanceFactor(i)/1050;r*=1+s,o/=1+n;const l=Math.round(o-r);return{profit:l,profitPerTon:Math.round(l/this._getWeight(i))}}_getProfit(t,e,i){const a=[e.id,i];return vs(this,xs).has(a)||vs(this,xs).set(a,this._calculateSellProfit(t,e,i)),vs(this,xs).get(a)}_getGoodsToBuyInTradePort(t){var e,i;const a=new Set(null===(e=vs(this,ks).dropsTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.consumesTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=vs(this,Ss).tradeItem.get(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(vs(this,ks),t,e)}})))??[]}_getGoodsToSellInTradePort(t){var e,i;const a=new Set(null===(e=vs(this,ks).consumesTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.dropsTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=vs(this,Ss).tradeItem.get(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(t,vs(this,ks),e)}})))??[]}_setTradeRelations(){vs(this,xs).clear(),vs(this,Ss).portData=vs(this,Ss).portDataDefault.map((t=>(t.sailingDistanceToTradePort=this._getSailingDistance(t.id,vs(this,ks).id),t.goodsToBuyInTradePort=this._getGoodsToBuyInTradePort(t),t.buyInTradePort=t.goodsToBuyInTradePort.length>0,t.goodsToSellInTradePort=this._getGoodsToSellInTradePort(t),t.sellInTradePort=t.goodsToSellInTradePort.length>0,t))).filter((t=>t.id===vs(this,Ss).tradePortId||t.sellInTradePort||t.buyInTradePort))}_selectSelected(){const t=String(vs(this,ys).getValues()),[e,i]=t.split("/"),[a,s]=e.split(",");vs(this,Ss).currentPort={id:Number(i),coord:{x:Number(a),y:Number(s)}},vs(this,Ss).tradePortId=Number(i),this._setTradePortPartners(),vs(this,Ss).showRadius="tradePorts",vs(this,Ss).update()}}function Ws(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function $s(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ps(t,e,"get"))}function Ds(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ps(t,e,"set"),i),i}function Ps(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Cs=new WeakMap,Is=new WeakMap,Ls=new WeakMap,Ns=new WeakMap,As=new WeakMap,Zs=new WeakMap;class Es{constructor(t){var e,i,a;Ws(this,Cs,{writable:!0,value:{}}),Ws(this,Is,{writable:!0,value:{}}),Ws(this,Ls,{writable:!0,value:{}}),Ws(this,Ns,{writable:!0,value:void 0}),Ws(this,As,{writable:!0,value:"port-select-clan"}),Ws(this,Zs,{writable:!0,value:"port-select-nation"}),a=(t=!0)=>`${gt.nU.filter((e=>!(!t&&("FT"===e.short||"NT"===e.short)))).sort((0,gt.MR)(["name"])).map((t=>`<option value="${t.short}">${t.name}</option>`)).join("")}`,(i="_getNationOptions")in(e=this)?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,Ds(this,Ns,t),this._setupSelects(),this._setupListener()}_capsOn(){$s(this,Is).classList.add("caps")}_capsOff(){$s(this,Is).classList.remove("caps")}_setupNationSelect(){const t=this._getNationOptions(!0);Ds(this,Ls,new Xa.Z($s(this,Zs),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},t))}_getClanOptions(){const t=new Set;for(const e of $s(this,Ns).portData.filter((t=>t.capturer)))t.add(e.capturer);return t.size>0?`${[...t].sort(gt.I4).map((t=>`<option value="${t}" class="caps">${t}</option>`)).join("")}`:""}_setupClanSelect(){var t;const e=this._getClanOptions();Ds(this,Cs,new Xa.Z($s(this,As),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},e)),Ds(this,Is,null===(t=$s(this,Cs).select$.get(0).parentNode)||void 0===t?void 0:t.querySelector("button"))}_setupSelects(){this._setupNationSelect(),this._setupClanSelect()}_clanSelected(){const t=String($s(this,Cs).getValues());this._capsOn(),t&&($s(this,Ns).portData=$s(this,Ns).portDataDefault.filter((e=>e.capturer===t))),$s(this,Ns).showRadius="",$s(this,Ns).update()}_clanRefresh(){const t=this._getClanOptions();this._capsOff(),$s(this,Cs).setOptions(t),$s(this,Cs).reset(),""===t?$s(this,Cs).disable():$s(this,Cs).enable()}_nationSelected(){const t=String($s(this,Ls).getValues());(0,gt.mP)(t)&&($s(this,Ns).portData=$s(this,Ns).portDataDefault.filter((e=>e.nation===t)),$s(this,Ns).showRadius="",$s(this,Ns).update())}_setupListener(){$s(this,Cs).select$.on("change",(async()=>{(0,r.KS)("Menu",$s(this,Zs)),this._clanSelected()})),$s(this,Ls).select$.on("change",(async()=>{(0,r.KS)("Menu",$s(this,As)),this._nationSelected(),this._clanRefresh()}))}refreshSelect(){$s(this,Ls).reset(),this._clanRefresh()}}function js(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Bs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Fs(t,e,"get"))}function zs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Fs(t,e,"set"),i),i}function Fs(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}dt().extend(pt()),dt().extend(Ka()),dt().extend(mt()),dt().locale("en-gb");var Rs=new WeakMap,Vs=new WeakMap;class Gs{constructor(t){js(this,Rs,{writable:!0,value:void 0}),js(this,Vs,{writable:!0,value:void 0}),zs(this,Vs,t),new Ts(t),new us(t),zs(this,Rs,new Es(t)),new ss(t),this._setupListener()}_setupListener(){var t,e,i,a,s,n,r,l;null===(t=document.querySelector("#menu-prop-deep"))||void 0===t||t.addEventListener("click",(()=>{this._depthSelected("deep")})),null===(e=document.querySelector("#menu-prop-shallow"))||void 0===e||e.addEventListener("click",(()=>{this._depthSelected("shallow")})),null===(i=document.querySelector("#menu-prop-all"))||void 0===i||i.addEventListener("click",(()=>{this._allSelected()})),null===(a=document.querySelector("#menu-prop-non-capturable"))||void 0===a||a.addEventListener("click",(()=>{this._nonCapSelected()})),null===(s=document.querySelector("#menu-prop-today"))||void 0===s||s.addEventListener("click",(()=>{this._capturedToday()})),null===(n=document.querySelector("#menu-prop-yesterday"))||void 0===n||n.addEventListener("click",(()=>{this._capturedYesterday()})),null===(r=document.querySelector("#menu-prop-this-week"))||void 0===r||r.addEventListener("click",(()=>{this._capturedThisWeek()})),null===(l=document.querySelector("#menu-prop-last-week"))||void 0===l||l.addEventListener("click",(()=>{this._capturedLastWeek()})),(0,o.ye)("selectPortNavbar")}_depthSelected(t){const e=Bs(this,Vs).portDataDefault.filter((e=>"shallow"===t?e.shallow:!e.shallow));Bs(this,Vs).portData=e,Bs(this,Vs).showRadius="",Bs(this,Vs).update()}_allSelected(){const t=Bs(this,Vs).portDataDefault.filter((t=>t.availableForAll));Bs(this,Vs).portData=t,Bs(this,Vs).showRadius="",Bs(this,Vs).update()}_nonCapSelected(){const t=Bs(this,Vs).portDataDefault.filter((t=>!t.capturable));Bs(this,Vs).portData=t,Bs(this,Vs).showRadius="",Bs(this,Vs).update()}_filterCaptured(t,e){const i=Bs(this,Vs).portDataDefault.filter((i=>dt()(i.captured,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]")));Bs(this,Vs).portData=i,Bs(this,Vs).showRadius="",Bs(this,Vs).update()}_capturedToday(){const t=dt().utc();let e=dt()().utc().hour(h.WF).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,dt().utc(e).add(1,"day"))}_capturedYesterday(){const t=dt().utc();let e=dt()().utc().hour(h.WF).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,dt().utc(e).add(1,"day"))}_capturedThisWeek(){const t=dt()().utc().startOf("week"),e=t.utc().hour(h.WF),i=dt()(t).utc().add(7,"day").hour(h.WF);this._filterCaptured(e,i)}_capturedLastWeek(){const t=dt()().utc().startOf("week"),e=dt()(t).utc().subtract(7,"day").hour(h.WF),i=t.utc().hour(h.WF);this._filterCaptured(e,i)}clearMap(){Bs(this,Rs).refreshSelect()}}function qs(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Hs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ys(t,e,"get"))}function Os(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ys(t,e,"set"),i),i}function Ys(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ks=new WeakMap,Xs=new WeakMap,Us=new WeakMap,Qs=new WeakMap,Js=new WeakMap,tn=new WeakMap,en=new WeakMap,an=new WeakMap;class sn extends p.Z{constructor(t){super(t,"sm"),qs(this,Ks,{writable:!0,value:void 0}),qs(this,Xs,{writable:!0,value:void 0}),qs(this,Us,{writable:!0,value:void 0}),qs(this,Qs,{writable:!0,value:void 0}),qs(this,Js,{writable:!0,value:void 0}),qs(this,tn,{writable:!0,value:{}}),qs(this,en,{writable:!0,value:void 0}),qs(this,an,{writable:!0,value:void 0}),Os(this,Xs,`${this.baseId}-form`),Os(this,Qs,`${this.baseId}-input-x`),Os(this,Js,`${this.baseId}-input-y`),Os(this,Ks,`${this.baseId}-copy-coord`),Os(this,Us,`${this.baseId}-submit`),this._init()}_init(){var t,e;this._injectModal(),Os(this,en,document.querySelector(`#${Hs(this,Qs)}`)),Os(this,an,document.querySelector(`#${Hs(this,Js)}`)),null===(t=document.querySelector(`#${this.id}`))||void 0===t||t.addEventListener("keydown",(t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)})),null===(e=document.querySelector(`#${Hs(this,Ks)}`))||void 0===e||e.addEventListener("click",(t=>{this._copyCoordClicked(t)}))}_injectModal(){const t=super.bodySel;super.removeFooter();const e=t.append("form").attr("id",Hs(this,Xs)).attr("role","form");Os(this,tn,e.node());const i=e.append("div").attr("class","form-floating");i.append("input").attr("class","form-control").attr("id",Hs(this,Qs)).attr("type","number").attr("required","").attr("placeholder","X coordinate in k").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),i.append("label").attr("for",Hs(this,Qs)).text("X coordinate in k");const a=e.append("div").attr("class","form-floating");a.append("input").attr("class","form-control").attr("id",Hs(this,Js)).attr("type","number").attr("required","").attr("placeholder","Z coordinate in k").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),a.append("label").attr("for",Hs(this,Js)).text("Z coordinate in k"),e.append("div").attr("class","form-text mt-1 mb-3").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const s=e.append("div").classed("float-end",!0).attr("role","group");s.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",Hs(this,Ks)).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),s.append("button").attr("class","btn").attr("id",Hs(this,Us)).attr("title","Go to").attr("type","submit").text("Go to")}_getInputValue(t){return null!=t&&t.value?Number(t.value):Number.POSITIVE_INFINITY}getXCoord(){return this._getInputValue(Hs(this,en))}getZCoord(){return this._getInputValue(Hs(this,an))}_copyCoordClicked(t){(0,r.KS)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this.getXCoord(),i=this.getZCoord();(0,d.A1)(e,i,super.getModalNode())}showModal(){var t,e;super.show(),null===(t=Hs(this,en))||void 0===t||t.focus(),null===(e=Hs(this,en))||void 0===e||e.select()}get formSel(){return Hs(this,tn)}}function nn(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function rn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ln(t,e,"get"))}function on(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ln(t,e,"set"),i),i}function ln(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}dt().extend(pt()),dt().extend(mt());var hn=new WeakMap,dn=new WeakMap,cn=new WeakMap,pn=new WeakMap,un=new WeakMap,wn=new WeakMap,vn=new WeakMap;class mn{constructor(t,e){nn(this,hn,{writable:!0,value:void 0}),nn(this,dn,{writable:!0,value:"Go to F11"}),nn(this,cn,{writable:!0,value:void 0}),nn(this,pn,{writable:!0,value:void 0}),nn(this,un,{writable:!0,value:void 0}),nn(this,wn,{writable:!0,value:{}}),nn(this,vn,{writable:!0,value:void 0}),on(this,pn,t),on(this,cn,e),on(this,hn,(0,o.MF)(rn(this,dn))),on(this,un,`menu-${rn(this,hn)}`),this._setupSvg(),this._setupListener()}_setupSvg(){on(this,wn,(0,a.Z)("#map").append("g").attr("data-ui-component","f11"))}_menuClicked(){(0,r.KS)("Menu",rn(this,dn)),rn(this,vn)?rn(this,vn).showModal():(on(this,vn,new sn(rn(this,dn))),rn(this,vn).formSel.addEventListener("submit",(t=>{rn(this,vn).hide(),t.preventDefault(),this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${rn(this,un)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()})),window.addEventListener("keydown",(t=>{"F11"===t.code&&t.shiftKey&&this._menuClicked()}))}_useUserInput(){const t=-1e3*rn(this,vn).getXCoord(),e=-1e3*rn(this,vn).getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_printF11Coord(t,e,i,a){var s,n;let r=10;const o=rn(this,wn).append("g").attr("transform",`translate(${t},${e})`).attr("class","svg-background-dark fill-primary-light"),l=o.append("rect"),h=o.append("rect");o.append("circle").attr("r",r),r*=1.6;const d=o.append("text").attr("dx",-r+"px").attr("dy",-r/2-2+"px").attr("class","text-end").text((0,v.Hu)(i)),c=o.append("text").attr("dx",-r+"px").attr("dy",r/2+2+"px").attr("class","text-end").text((0,v.Hu)(a)),p=(null===(s=d.node())||void 0===s?void 0:s.getBBox())??{},u=(null===(n=c.node())||void 0===n?void 0:n.getBBox())??{},w=dt()().utc(),m=dt()(),g=o.append("text").attr("dx",`${r}px`).attr("dy",-r/2-2+"px").attr("class","f11-time").text(w.format("H.mm")),_=o.append("text").attr("dx",`${r}px`).attr("dy",r/2+2+"px").attr("class","f11-time").text(`(${m.format("H.mm")} local)`),f=g.node().getBBox()??{},b=_.node().getBBox()??{},y=p&&u?1.2*Math.round(p.height+u.height):0,k=p&&u?Math.round(Math.max(p.width,u.width)+5):0,M=1.2*Math.round(f.height+b.height),S=f&&b?Math.round(Math.max(f.width,b.width)+5):0,x=Math.max(y,M);l.attr("x",-k-r).attr("y",-x/2).attr("height",x).attr("width",k+r),h.attr("x",0).attr("y",-x/2).attr("height",x).attr("width",S+r)}_goToF11(t,e){const i=Math.floor((0,l._i)(t,e)),a=Math.floor((0,l.UY)(t,e));(0,l.vX)(i,rn(this,cn).min,rn(this,cn).max,!0)&&(0,l.vX)(a,rn(this,cn).min,rn(this,cn).max,!0)&&(this._printF11Coord(i,a,t,e),rn(this,pn).zoomAndPan(i,a))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&((0,r.KS)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=(0,l.IK)(t,e),a=(0,l.pw)(t,e);this._printF11Coord(t,e,i,a)}clearMap(){rn(this,wn).selectAll("*").remove()}}i(3863);var gn=i(9089),_n=i(7808);function fn(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function bn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,kn(t,e,"get"))}function yn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,kn(t,e,"set"),i),i}function kn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Mn=new WeakMap,Sn=new WeakMap,xn=new WeakMap,Tn=new WeakMap,Wn=new WeakMap,$n=new WeakMap;class Dn{constructor(t,e){fn(this,Mn,{writable:!0,value:"Show good availability"}),fn(this,Sn,{writable:!0,value:void 0}),fn(this,xn,{writable:!0,value:{}}),fn(this,Tn,{writable:!0,value:!1}),fn(this,Wn,{writable:!0,value:void 0}),fn(this,$n,{writable:!0,value:void 0}),yn(this,$n,t),yn(this,Wn,e),yn(this,Sn,`port-select-${(0,o.MF)(bn(this,Mn))}`),this._setupSelect(),this._setupListener()}show(t){const e=bn(this,xn).select$.get(0);t?(e.classList.remove("d-none"),e.parentNode.classList.remove("d-none"),bn(this,xn).setOptions(this._getOptions()),bn(this,xn).reset()):(e.classList.add("d-none"),e.parentNode.classList.add("d-none"))}_getOptions(){const t=new Map;for(const i of bn(this,$n).portDataDefault)if(i.inventory)for(const a of i.inventory){var e;t.set(a.id,(null===(e=bn(this,$n).tradeItem.get(a.id))||void 0===e?void 0:e.name)??"")}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){const t={dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:bn(this,Mn),virtualScroll:!0};yn(this,xn,new Xa.Z(bn(this,Sn),void 0,t,""))}_setupListener(){bn(this,xn).select$.on("change",(()=>{(0,r.KS)("Menu",bn(this,Mn)),this._selectSelected()}))}_getPortList(t,e,i){var a;let s="";if(s+=`<h5>${(null===(a=bn(this,$n).tradeItem.get(t))||void 0===a?void 0:a.name)??""}</h5>`,e.size>0){s+="<h6>Buy</h6>";for(const[,t]of e)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,v.yI)(t.good.buyQuantity)} @ ${(0,v.Pj)(t.good.buyPrice)}<br>`}if(e&&i&&(s+="<p></p>"),i.size>0){s+="<h6>Sell</h6>";for(const[,t]of i)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,v.yI)(t.good.sellQuantity)} @ ${(0,v.Pj)(t.good.sellPrice)}<br>`}return s}_selectSelected(){const t=Number(bn(this,xn).getValues()),e=new Map,i=new Map;yn(this,Tn,!0);const a=bn(this,$n).portDataDefault.filter((e=>e.inventory.some((e=>e.id===t)))).sort((0,gt.MR)(["name"])).map((a=>{const s=a.inventory.find((e=>e.id===t));return s&&(a.sellInTradePort=s.buyQuantity>0,a.sellInTradePort&&e.set(a.name,{name:a.name,nation:a.nation,good:s}),a.buyInTradePort=s.sellQuantity>0,a.buyInTradePort&&i.set(a.name,{name:a.name,nation:a.nation,good:s})),a}));bn(this,$n).setShowRadiusSetting("off"),bn(this,$n).portData=a,bn(this,$n).showRadius="tradePorts","portList"!==bn(this,Wn).showTrades.listType&&(bn(this,Wn).showTrades.listType="portList"),bn(this,Wn).showTrades.update(this._getPortList(t,e,i)),bn(this,$n).update()}get isInventorySelected(){return bn(this,Tn)}}var Pn=i(5311);function Cn(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function In(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Ln(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,An(t,e,"get"))}function Nn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,An(t,e,"set"),i),i}function An(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Zn=new WeakMap,En=new WeakMap,jn=new WeakMap,Bn=new WeakMap,zn=new WeakMap;class Fn{constructor(t,e){In(this,"show",void 0),Cn(this,Zn,{writable:!0,value:{}}),Cn(this,En,{writable:!0,value:{}}),Cn(this,jn,{writable:!0,value:void 0}),Cn(this,Bn,{writable:!0,value:void 0}),Cn(this,zn,{writable:!0,value:{}}),In(this,"_serverName",void 0),In(this,"_isDataLoaded",void 0),In(this,"_minScale",void 0),In(this,"_scale",void 0),In(this,"_fontSize",void 0),In(this,"_numTrades",void 0),In(this,"_arrowX",void 0),In(this,"_arrowY",void 0),In(this,"_baseId",void 0),In(this,"_nationSelectId",void 0),In(this,"_listType",void 0),In(this,"_showId",void 0),In(this,"_showRadioValues",void 0),In(this,"_showCookie",void 0),In(this,"_showRadios",void 0),In(this,"_profitId",void 0),In(this,"_profitRadioValues",void 0),In(this,"_profitCookie",void 0),In(this,"_profitRadios",void 0),In(this,"_profitValue",void 0),In(this,"_profitText",void 0),In(this,"_g",void 0),In(this,"_labelG",void 0),In(this,"_tradeDetailsDiv",void 0),In(this,"_tradeDetailsHead",void 0),In(this,"_nationSelector",void 0),In(this,"_list",void 0),In(this,"_linkDataDefault",void 0),In(this,"_linkData",void 0),In(this,"_portData",void 0),In(this,"_nodeData",void 0),In(this,"_linkDataFiltered",void 0),In(this,"_portDataFiltered",void 0),In(this,"_tradeItem",void 0),Nn(this,Bn,t),Nn(this,jn,e),this._serverName=Ln(this,jn).serverName,this._minScale=Ln(this,jn).minMapScale,this._scale=this._minScale,this._fontSize=l.jo,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=`${this._baseId}-nation-select`,this._listType="tradeList",this._showId="show-trades",this._showRadioValues=["off","on"],this._showCookie=new c.Z({id:this._showId,values:this._showRadioValues}),this._showRadios=new F.Z(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new c.Z({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new F.Z(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(Ln(this,jn).extent),Nn(this,Zn,new Dn(t,e)),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),(0,a.Z)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=(0,a.Z)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const t=`${gt.nU.map((t=>`<option value="${t.short}" selected>${t.name}</option>`)).join("")}`,e=`${this._baseId}-card`;this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const i=this._tradeDetailsHead.append("label"),a=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",t),Pn(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:t=>`${t===gt.nU.length?"All":String(t)} nations selected`,title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-bs-toggle","collapse").attr("data-bs-target",`#${e}`).attr("aria-expanded","false").text("Info"),this._tradeDetailsHead.append("div").attr("id",e).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group ps-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,a=t.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),a.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(async()=>this._showSelected())),null===(e=document.querySelector(`#${this._profitId}`))||void 0===e||e.addEventListener("change",(()=>{this._profitValueSelected()})),this._nationSelector.addEventListener("change",(t=>{this._nationChanged(),t.preventDefault()}))}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map((t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]))),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map((t=>{let e=0;switch(this._profitValue){case"weight":e=Fn._getProfitPerWeight(t);break;case"distance":e=Fn._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error(`Wrong profit value ${this._profitValue}`)}return t.profit=e,t})).sort(((t,e)=>e.profit??0-(t.profit??0)))}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),Ln(this,Zn).show(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){const t=await(0,o.qP)(`${this._serverName}-pb.json`),e=(await i.e(462).then(i.t.bind(i,9131,19))).default;this._portData=e.map((e=>{const i=t.find((t=>t.id===e.id));return{...e,...i}})),this._linkDataDefault=await(0,o.qP)(`${this._serverName}-trades.json`);const a=await(0,o.qP)(`${this._serverName}-items.json`);this._tradeItem=new Map(a.map((t=>[t.id,t.name])))}async _loadAndSetupData(){await this._loadData(),this._setupData()}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then((()=>{this._isDataLoaded=!0})),Fn._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(Fn._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.isShallow)??!0}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){const e=t.weightPerItem*t.quantity;let i="";return i+=Fn._addInfo(`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Fn._addDes("trade"),i+=Fn._addInfo(`${(0,v.Pj)(t.profit??0)}`)+Fn._addDes(this._profitText),i+=Fn._addInfo(`${(0,v.Dw)(e)} ${1===e?"ton":"tons"}`)+Fn._addDes("weight"),i+=Fn._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Fn._addDes(`from ${this._getDepth(t.source.id)}`),i+=Fn._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Fn._addDes(`to ${this._getDepth(t.target.id)}`),i+=Fn._addInfo(`${(0,v.Dw)(t.distance)}`)+Fn._addDes("sail distance"),i}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,a=Fn._getProfitPerDistance(t),s=Fn._getProfitPerWeight(t);let n="";return n+=Fn._startBlock("Trade"),n+=Fn._addInfo(`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Fn._addDes("good"),n+=Fn._addInfo(`${(0,v.Pj)(t.source.grossPrice)}`)+Fn._addDes("gross buy price"),n+=Fn._addInfo(`${(0,v.Pj)(t.target.grossPrice)}`)+Fn._addDes("gross sell price"),n+=Fn._addInfo(`${(0,v.Dw)(e)} ${1===e?"ton":"tons"}`)+Fn._addDes("weight"),n+=Fn._endBlock(),n+=Fn._startBlock("Profit"),n+=Fn._addInfo(`${(0,v.Pj)(t.profitTotal)}`)+Fn._addDes("total"),n+=Fn._addInfo(`${(0,v.Pj)(i)}`)+Fn._addDes("profit/item"),n+=Fn._addInfo(`${(0,v.Pj)(a)}`)+Fn._addDes("profit/distance"),n+=Fn._addInfo(`${(0,v.Pj)(s)}`)+Fn._addDes("profit/weight"),n+=Fn._endBlock(),n+=Fn._startBlock("Route"),n+=Fn._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Fn._addDes(`from ${this._getDepth(t.source.id)}`),n+=Fn._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Fn._addDes(`to ${this._getDepth(t.source.id)}`),n+=Fn._addInfo(`${(0,v.Dw)(t.distance)}`)+Fn._addDes("sail distance"),n+=Fn._endBlock(),n}_getSiblingLinks(t,e){return this._linkDataFiltered.filter((i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t)).map((t=>t.profit??0))}_getXCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.x)??0}_getYCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.y)??0}_updateGraph(){const t=(t,e)=>{const i=t.currentTarget;new(tt())(i,{html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-small"></div></div>',trigger:"manual",title:this._getTradeFullData(e),sanitize:!1}).show()},e=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},a={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},s=t?i.x:a.x,n=t?i.y:a.y,r=t?a.x:i.x,o=t?a.y:i.y;let l=Math.sqrt((r-s)**2+(o-n)**2);const h=t?0:1,d=this._getSiblingLinks(e.source.id,e.target.id);if(d.length>1){const t=(0,_n.x)().domain(d).range([1,d.length]);l/=1+1/d.length*(t(e.profit??0)??-1)}return l=Math.round(l),`M${s},${n}A${l},${l} 0,0,${h} ${r},${o}`},i=Ln(this,Zn).isInventorySelected?[]:this._linkDataFiltered,a=(0,gn.Z)(this._linkDataFiltered,(t=>t.profit??0)),s=(0,w.Z)().range([5/this._scale,15/this._scale]).domain(a),n=2**Math.log2(Math.abs(this._minScale)+this._scale),r=(0,l.qY)(this._fontSize/n);this._g.selectAll(".trade-link").data(i,(t=>Fn._getId(t))).join((e=>e.append("path").attr("class","trade-link").attr("marker-start",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)")).attr("marker-end",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"")).attr("id",(t=>Fn._getId(t))).on("click",((e,i)=>{t(e,i)})).on("mouseleave",(t=>{(t=>{const e=t.currentTarget,i=tt().getInstance(e);i&&i.dispose()})(t)})))).attr("d",(t=>e(this._getXCoord(t.source.id)<this._getXCoord(t.target.id),t))).attr("stroke-width",(t=>`${s(t.profit??0)??0}px`)),this._labelG.attr("font-size",`${r}px`),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,(t=>Fn._getId(t))).join((t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",(t=>`#${Fn._getId(t)}`)).text((t=>`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)))).attr("dy",(t=>`-${s(t.profit??0)/1.8}px`))}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],Fn._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,Fn._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t??"")}_updatePortList(t){this._list.html(t??"")}_updateTradeList(){let t;const e=(e,i)=>{t=(0,a.Z)(`path#${Fn._getId(i)}`).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,(t=>Fn._getId(t))).join((t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i))).html((t=>this._getTradeLimitedData(t)))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter((t=>t.coordinates[0]>=Ln(this,En)[0]&&t.coordinates[0]<=Ln(this,zn)[0]&&t.coordinates[1]>=Ln(this,En)[1]&&t.coordinates[1]<=Ln(this,zn)[1])).map((t=>t.id)));this._linkDataFiltered=this._linkData.filter((e=>t.has(e.source.id)||t.has(e.target.id))).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter((t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id))).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set([...this._nationSelector.selectedOptions].map((t=>t.value)));this._portDataFiltered=new Set(this._portData.filter((e=>t.has(e.nation))).map((t=>t.id)))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t){Nn(this,En,t[0]),Nn(this,zn,t[1])}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this._linkData=this.show?this._linkDataDefault:[],this.update()}}const Rn=t=>t*t,Vn=t=>Math.sqrt(Rn(t.x)+Rn(t.y)+Rn(t.z)),Gn=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,qn=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),Hn=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),On=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),Yn=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});var Kn=i(5311);function Xn(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Un(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Jn(t,e,"get"))}function Qn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Jn(t,e,"set"),i),i}function Jn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var tr=new WeakMap,er=new WeakMap,ir=new WeakMap,ar=new WeakMap,sr=new WeakMap,nr=new WeakMap,rr=new WeakMap;class or extends p.Z{constructor(t,e){super(t,"md","Set"),Xn(this,tr,{writable:!0,value:void 0}),Xn(this,er,{writable:!0,value:3}),Xn(this,ir,{writable:!0,value:void 0}),Xn(this,ar,{writable:!0,value:[]}),Xn(this,sr,{writable:!0,value:[]}),Xn(this,nr,{writable:!0,value:[]}),Xn(this,rr,{writable:!0,value:[]}),Qn(this,ir,e),Qn(this,tr,Array.from({length:Un(this,er)},((t,e)=>e))),this._init()}_init(){for(const t of Un(this,tr))Un(this,nr)[t]=`${super.baseId}-${t}-select`,Un(this,ar)[t]=`${super.baseId}-${t}-input`;this._injectModal(),this._setupSelects()}_injectModal(){const t=super.bodySel,e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of Un(this,tr)){const i=e.append("div").attr("class","row mb-4");i.append("div").attr("class","col-md-6").append("label").attr("class","col-form-label").append("select").attr("name",Un(this,nr)[t]).attr("id",Un(this,nr)[t]).attr("class","selectpicker");const a=i.append("div").attr("class","col-md-6 form-floating"),s=a.append("input").attr("id",Un(this,ar)[t]).attr("name",Un(this,ar)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3);a.append("label").attr("for",Un(this,ar)[t]).attr("class","ps-4").text("Distance in k"),Un(this,sr)[t]=s.node()}t.append("div").attr("class","form-text mt-3").text("Distances from in-game trader tool.")}_setupSelects(){const t=`${Un(this,ir).map((t=>({id:t.id,name:t.name,nation:t.nation}))).sort((0,gt.MR)(["name"])).map((t=>`<option data-subtext="${t.nation}">${t.name}</option>`)).join("")}`;for(const e of Un(this,tr))Un(this,rr)[e]=document.querySelector(`#${Un(this,nr)[e]}`),Un(this,rr)[e]&&(Un(this,rr)[e].insertAdjacentHTML("beforeend",t),Kn(Un(this,rr)[e]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0}))}get ids(){return Un(this,tr)}get numberOfInputs(){return Un(this,er)}getPort(t){const e=Un(this,rr)[t];return e.selectedIndex?e.options[e.selectedIndex].text:""}getDistance(t){return Number(Un(this,sr)[t].value)}}var lr=i(2776),hr=i.n(lr);function dr(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function cr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ur(t,e,"get"))}function pr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ur(t,e,"set"),i),i}function ur(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var wr=new WeakMap,vr=new WeakMap,mr=new WeakMap,gr=new WeakMap,_r=new WeakMap;class fr{constructor(t,e){dr(this,wr,{writable:!0,value:void 0}),dr(this,vr,{writable:!0,value:void 0}),dr(this,mr,{writable:!0,value:1e4}),dr(this,gr,{writable:!0,value:{}}),dr(this,_r,{writable:!0,value:{}}),pr(this,wr,t),pr(this,vr,e),pr(this,_r,(0,a.Z)("#toast-column")),this._set(),this._show()}_set(){pr(this,gr,cr(this,_r).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=cr(this,gr).append("div").attr("class","toast-header");t.append("img").attr("class","rounded me-2").attr("height","48px").attr("width","48px").attr("src",o.vU).attr("alt","logo"),t.append("em").attr("class","me-auto").html(cr(this,wr)),t.append("button").attr("type","button").attr("class","btn-close").attr("data-bs-dismiss","toast").attr("aria-label","Close"),cr(this,gr).append("div").attr("class","toast-body").html(cr(this,vr))}_show(){const t=cr(this,gr).node();new(hr())(t,{delay:cr(this,mr)}).show()}}function br(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function yr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Mr(t,e,"get"))}function kr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Mr(t,e,"set"),i),i}function Mr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Sr=new WeakMap,xr=new WeakMap,Tr=new WeakMap,Wr=new WeakMap,$r=new WeakMap,Dr=new WeakMap;class Pr{constructor(t){br(this,Sr,{writable:!0,value:void 0}),br(this,xr,{writable:!0,value:"Get position"}),br(this,Tr,{writable:!0,value:void 0}),br(this,Wr,{writable:!0,value:1.04}),br(this,$r,{writable:!0,value:void 0}),br(this,Dr,{writable:!0,value:void 0}),kr(this,Dr,t),kr(this,Sr,(0,o.MF)(yr(this,xr))),kr(this,Tr,`menu-${yr(this,Sr)}`),this._setupListener()}_menuClicked(){(0,r.KS)("Menu",yr(this,xr)),yr(this,$r)?yr(this,$r).show():(kr(this,$r,new or(yr(this,xr),yr(this,Dr).portDataDefault)),yr(this,$r).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${yr(this,Tr)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showAndGoToPosition(){const t=yr(this,Dr).portData.map((t=>({x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance??0}))),e=((t,e,i,a=!1)=>{const s=On(qn(e,t),Vn(qn(e,t))),n=Gn(s,qn(i,t));let r=qn(qn(i,t),Yn(s,n));const o=On(r,Vn(r)),l=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(s,o),h=Vn(qn(e,t)),d=Gn(o,qn(i,t)),c=(Rn(t.r)-Rn(e.r)+Rn(h))/(2*h),p=(Rn(t.r)-Rn(i.r)+Rn(n)+Rn(d))/(2*d)-n/d*c;let u=Rn(t.r)-Rn(c)-Rn(p);Math.abs(u)<1e-10&&(u=0);const w=Math.sqrt(u);if(Number.isNaN(w))return;r=Hn(t,Hn(Yn(s,c),Yn(o,p)));const v=Hn(r,Yn(l,w)),m=qn(r,Yn(l,w));return 0===w||a?r:[v,m]})(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),yr(this,Dr).map.f11.printCoord(e.x,e.y),yr(this,Dr).map.zoomAndPan(e.x,e.y);const t=Math.round((0,l.IK)(e.x,e.y)/-1e3),i=Math.round((0,l.pw)(e.x,e.y)/-1e3);(0,d.A1)(t,i,yr(this,$r).getModalNode()),new fr(yr(this,xr),"Coordinates copied to clipboard.")}else new fr(yr(this,xr),"No intersection found.")}_useUserInput(){const t=new Map;for(const e of yr(this,$r).ids){const i=yr(this,$r).getPort(e),a=yr(this,$r).getDistance(e);a&&""!==i&&t.set(i,a*yr(this,Wr)*o.ZE)}t.size===yr(this,$r).numberOfInputs?(yr(this,Dr).setShowRadiusSetting("position"),yr(this,Dr).portData=yr(this,Dr).portDataDefault.filter((e=>t.has(e.name))).map((e=>(e.distance=t.get(e.name),e))),yr(this,Dr).update(),this._showAndGoToPosition()):new fr(yr(this,xr),"Not enough data.")}}function Cr(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Ir(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Nr(t,e,"get"))}function Lr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Nr(t,e,"set"),i),i}function Nr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ar=new WeakMap,Zr=new WeakMap,Er=new WeakMap;class jr extends p.Z{constructor(t){super(t,"sm","Set"),Cr(this,Ar,{writable:!0,value:void 0}),Cr(this,Zr,{writable:!0,value:void 0}),Cr(this,Er,{writable:!0,value:{}}),Lr(this,Ar,`input-group-${this.baseId}`),Lr(this,Zr,`input-${this.baseId}`),this._init()}_init(){this._injectModal()}_injectModal(){const t=super.bodySel;Lr(this,Er,new Be.Z(t,this.baseId))}getTime(){return document.querySelector(`#${Ir(this,Zr)}`).value.trim()}getWind(){return Ir(this,Er).getWind()}}function Br(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function zr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Rr(t,e,"get"))}function Fr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Rr(t,e,"set"),i),i}function Rr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}dt().extend(mt());var Vr=new WeakMap,Gr=new WeakMap,qr=new WeakMap;class Hr{constructor(t){Br(this,Vr,{writable:!0,value:void 0}),Br(this,Gr,{writable:!0,value:void 0}),Br(this,qr,{writable:!0,value:void 0}),Fr(this,Vr,t),Fr(this,qr,new c.Z({id:`${zr(this,Vr)}-degrees`,expire:this._getExpire()})),Fr(this,Gr,new c.Z({id:`${zr(this,Vr)}-time`}))}_getExpire(){return(0,gt.Vk)()}_getNow(){return dt()().utc().unix()}get(){const t=zr(this,qr).get(),e=zr(this,Gr).get();if(t&&e){const i=Number(t),a=Number(e),s=Math.round(this._getNow()-a);return 360+Math.floor(i-o.er*s)%360}return this.remove(),Number.NaN}set(t){zr(this,qr).set(String(t)),zr(this,Gr).set(String(this._getNow()))}remove(){zr(this,qr).remove(),zr(this,Gr).remove()}}function Or(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function Yr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Xr(t,e,"get"))}function Kr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Xr(t,e,"set"),i),i}function Xr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ur=new WeakMap,Qr=new WeakMap,Jr=new WeakMap,to=new WeakMap,eo=new WeakMap,io=new WeakMap,ao=new WeakMap,so=new WeakMap,no=new WeakMap,ro=new WeakMap,oo=new WeakMap,lo=new WeakMap,ho=new WeakMap,co=new WeakMap,po=new WeakMap,uo=new WeakMap,wo=new WeakMap,vo=new WeakMap,mo=new WeakMap,go=new WeakMap,_o=new WeakMap;class fo{constructor(){Or(this,Ur,{writable:!0,value:void 0}),Or(this,Qr,{writable:!0,value:void 0}),Or(this,Jr,{writable:!0,value:{}}),Or(this,to,{writable:!0,value:void 0}),Or(this,eo,{writable:!0,value:(0,a.Z)("#port-summary")}),Or(this,io,{writable:!0,value:void 0}),Or(this,ao,{writable:!0,value:"In-game wind"}),Or(this,so,{writable:!0,value:void 0}),Or(this,no,{writable:!0,value:void 0}),Or(this,ro,{writable:!0,value:void 0}),Or(this,oo,{writable:!0,value:void 0}),Or(this,lo,{writable:!0,value:void 0}),Or(this,ho,{writable:!0,value:void 0}),Or(this,co,{writable:!0,value:void 0}),Or(this,po,{writable:!0,value:void 0}),Or(this,uo,{writable:!0,value:"wind-arrow"}),Or(this,wo,{writable:!0,value:4}),Or(this,vo,{writable:!0,value:void 0}),Or(this,mo,{writable:!0,value:void 0}),Or(this,go,{writable:!0,value:void 0}),Or(this,_o,{writable:!0,value:void 0}),Kr(this,io,(0,o.MF)(Yr(this,ao))),Kr(this,_o,`menu-${Yr(this,io)}`),Kr(this,go,(0,je.Z)().x((t=>t[0])).y((t=>t[1]))),Kr(this,mo,40),Kr(this,vo,new Hr(Yr(this,io))),Kr(this,no,Yr(this,vo).get()),this._setupArrow(),this._setupListener(),Number.isNaN(Yr(this,no))?new fr("Hint","Get the wind direction:<br>Use <em>In-game wind</em> under <em>Map tools</em>."):this._initShowCurrentWind()}_menuClicked(){(0,r.KS)("Menu",Yr(this,ao)),Yr(this,Qr)?Yr(this,Qr).show():(Kr(this,Qr,new jr(Yr(this,ao))),Yr(this,Qr).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupArrow(){const t=Yr(this,wo),e=2*Yr(this,wo);(0,a.Z)("#na-svg defs").append("marker").attr("id",Yr(this,uo)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-text").attr("d",`M0,-${t}L${e},0L0,${t}`)}_setupListener(){var t;null===(t=document.querySelector(`#${Yr(this,_o)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_windChange(){Kr(this,no,360+(Yr(this,no)-o.er*Yr(this,mo))%360),this._updateWindDirection()}_useUserInput(){Kr(this,no,Yr(this,Qr).getWind()),Yr(this,to)?this._updateWindDirection():this._initShowCurrentWind()}_toggle(t){Yr(this,eo).classed("port-summary-no-wind",!t).classed("port-summary-wind",t)}_show(){this._toggle(!0)}_hide(){this._toggle(!1)}_setupSvg(){this._show(),Kr(this,Ur,Yr(this,eo).insert("div",":first-child").attr("id",Yr(this,io)).attr("class","block p-0 pe-2")),Kr(this,Jr,Yr(this,Ur).append("svg").attr("class","small svg-background-light stroke-thick"))}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),Kr(this,oo,window.setInterval((()=>{this._windChange()}),1e3*Yr(this,mo)))}_updateWindDirection(){const t=(0,l.Ht)(Yr(this,no)),e=Yr(this,lo)*Math.cos(t),i=Yr(this,lo)*Math.sin(t),a=[[Math.round(Yr(this,co)+e),Math.round(Yr(this,po)+i)],[Math.round(Yr(this,co)-e),Math.round(Yr(this,po)-i)]];Yr(this,to)&&(Yr(this,to).datum(a).attr("d",Yr(this,go)),Yr(this,vo).set(Yr(this,no)))}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:e,top:i}=t.getBoundingClientRect(),a=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top")),s=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"));return Math.floor(e-i-a-s)}return 0}_initPrintCompassRose(){Kr(this,ro,this._getHeight()),Kr(this,po,Yr(this,ro)/2),Kr(this,ho,Yr(this,ro)),Kr(this,co,Yr(this,ho)/2),Kr(this,so,Math.min(Yr(this,ro),Yr(this,ho))/2),Kr(this,lo,.6*Yr(this,so)),Yr(this,Jr).attr("height",Yr(this,ro)).attr("width",Yr(this,ho));const t=Yr(this,Jr).append("svg").attr("ui-component","compass").attr("class","fill-background-light").attr("x",Yr(this,co)).attr("y",Yr(this,po));(0,d.ec)({element:t,radius:Yr(this,so)}),Kr(this,to,Yr(this,Jr).append("path").attr("class","svg-stroke-thick").attr("marker-end","url(#wind-arrow)"))}clearMap(){window.clearInterval(Yr(this,oo)),this._hide(),Yr(this,Ur)&&Yr(this,Ur).remove(),Kr(this,to,void 0),Yr(this,vo).remove()}}var bo=i(5311);function yo(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function ko(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Mo(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,xo(t,e,"get"))}function So(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,xo(t,e,"set"),i),i}function xo(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var To=new WeakMap,Wo=new WeakMap,$o=new WeakMap,Do=new WeakMap,Po=new WeakMap,Co=new WeakMap,Io=new WeakMap,Lo=new WeakMap,No=new WeakMap,Ao=new WeakMap,Zo=new WeakMap,Eo=new WeakMap,jo=new WeakMap,Bo=new WeakMap,zo=new WeakMap,Fo=new WeakMap,Ro=new WeakMap,Vo=new WeakMap,Go=new WeakMap,qo=new WeakMap,Ho=new WeakMap;class Oo{constructor(t,e){ko(this,"coord",void 0),ko(this,"f11",void 0),ko(this,"gridOverlay",void 0),ko(this,"height",0),yo(this,To,{writable:!0,value:5}),ko(this,"minMapScale",1),yo(this,Wo,{writable:!0,value:256}),yo(this,$o,{writable:!0,value:this.minMapScale}),yo(this,Do,{writable:!0,value:this.minMapScale}),yo(this,Po,{writable:!0,value:!1}),yo(this,Co,{writable:!0,value:256}),yo(this,Io,{writable:!0,value:1}),yo(this,Lo,{writable:!0,value:.25}),yo(this,No,{writable:!0,value:2}),yo(this,Ao,{writable:!0,value:{}}),yo(this,Zo,{writable:!0,value:[0,0]}),yo(this,Eo,{writable:!0,value:{}}),yo(this,jo,{writable:!0,value:{}}),yo(this,Bo,{writable:!0,value:0}),yo(this,zo,{writable:!0,value:0}),yo(this,Fo,{writable:!0,value:0}),yo(this,Ro,{writable:!0,value:0}),yo(this,Vo,{writable:!0,value:{}}),yo(this,Go,{writable:!0,value:{}}),yo(this,qo,{writable:!0,value:void 0}),yo(this,Ho,{writable:!0,value:void 0}),ko(this,"rem",l.jo),ko(this,"serverName",void 0),ko(this,"showGrid",void 0),ko(this,"showTrades",void 0),ko(this,"width",0),ko(this,"xGridBackgroundHeight",void 0),ko(this,"yGridBackgroundWidth",void 0),ko(this,"_doubleClickAction",void 0),ko(this,"_grid",void 0),ko(this,"_journey",void 0),ko(this,"_pbZone",void 0),ko(this,"_ports",void 0),ko(this,"_portSelect",void 0),ko(this,"_showGrid",void 0),ko(this,"_svg",void 0),ko(this,"_zoomLevel",void 0),ko(this,"_doubleClickActionCookie",void 0),ko(this,"_doubleClickActionId",void 0),ko(this,"_doubleClickActionRadios",void 0),ko(this,"_doubleClickActionValues",void 0),ko(this,"_searchParams",void 0),ko(this,"_showGridCookie",void 0),ko(this,"_showGridId",void 0),ko(this,"_showGridRadios",void 0),ko(this,"_showGridValues",void 0),this.serverName=t,this._searchParams=e,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:h.zb},this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new c.Z({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new F.Z(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new c.Z({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new F.Z(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupSvg(),this._setSvgSize(),this._setupTiler(),this._setupListener()}static _stopProperty(t){t.defaultPrevented&&t.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this._ports=new Ae(this),await this._ports.init(),this._pbZone=new Q(this._ports,this.serverName),this._grid=new B(this),this._portSelect=new Gs(this._ports),this.showTrades=new Fn(this._ports,this),await this.showTrades.showOrHide(),this.f11=new mn(this,this.coord),this._init(),this._journey=new ia(this.rem),So(this,qo,new fo),new Pr(this._ports),new Oa(this,this.serverName,this.coord)}_setupListener(){var t,e,i,a,s,n,o;this._svg.on("dblclick.zoom",null).on("click",(t=>{Oo._stopProperty(t)}),!0).on("dblclick",(t=>{this._doDoubleClickAction(t)})),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",(()=>{(0,r.KS)("Menu","Select port on property")})),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",(()=>{(0,r.KS)("Menu","Settings")})),null===(i=document.querySelector("#menu-download-pb-calc"))||void 0===i||i.addEventListener("click",(()=>{(0,r.KS)("Tools","Download pb calculator")})),null===(a=document.querySelector("#reset"))||void 0===a||a.addEventListener("click",(()=>{this._clearMap()})),null===(s=document.querySelector("#about"))||void 0===s||s.addEventListener("click",(()=>{this._showAbout()})),null===(n=document.querySelector("#double-click-action"))||void 0===n||n.addEventListener("change",(()=>{this._doubleClickSelected()})),null===(o=document.querySelector("#show-grid"))||void 0===o||o.addEventListener("change",(()=>{this._showGridSelected()}))}_setupSvg(){So(this,jo,(0,n.sP)().scaleExtent([this.minMapScale,Mo(this,Wo)]).wheelDelta((t=>-Mo(this,Io)*Math.sign(t.deltaY))).on("zoom",(t=>{this._naZoomed(t)}))),this._svg=(0,a.Z)("#na-map").append("svg").attr("id","na-svg").attr("class","fill-empty stroke-empty bg-map").call(Mo(this,jo)),this._svg.append("defs"),So(this,Vo,this._svg.append("g").attr("class","map-tiles")),So(this,Go,this._svg.append("g").attr("id","map"))}_setupTiler(){So(this,Bo,Mo(this,Ao)[0][0]),So(this,zo,Mo(this,Ao)[1][0]),So(this,Fo,Mo(this,Ao)[0][1]),So(this,Ro,Mo(this,Ao)[1][1])}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_drawMap(t){const e=Math.log2(t.k)<=Mo(this,To)?0:Mo(this,To)-Math.log2(t.k),i=Mo(this,Co)*t.k,a={tiles:[]},s=Math.log2(i/Mo(this,Co)),n=Math.round(Math.max(s+e,0)),r=2**(s-n)*Mo(this,Co),o=t.x-i/2,l=t.y-i/2,h=Math.max(0,Math.floor((Mo(this,Bo)-o)/r)),d=Math.min(Number(1<<n),Math.ceil((Mo(this,zo)-o)/r)),c=Math.max(0,Math.floor((Mo(this,Fo)-l)/r)),p=Math.min(Number(1<<n),Math.ceil((Mo(this,Ro)-l)/r));for(let t=c;t<p;++t)for(let e=h;e<d;++e)a.tiles.push([e,t,n]);if(a.translate=[o/r,l/r],a.scale=r,a.tiles.length>0){const t=2**(n+Math.abs(e)),i=this.coord.max/t*2**Math.abs(e);So(this,Eo,[[h*i,c*i],[d*i,p*i]]),So(this,Zo,[a.translate[0]*a.scale,a.translate[1]*a.scale]),this._updateMap(a)}}_updateMap(t){const{translate:[e,i],scale:a,tiles:s}=t;Mo(this,Vo).attr("transform",`translate(${e*a},${i*a}) scale(${a})`).selectAll("image").data(s,(t=>t)).join((t=>t.append("image").attr("xlink:href",(([t,e,i])=>`images/map/${i}/${e}/${t}.webp`)).attr("x",(([t])=>t)).attr("y",(([,t])=>t)).attr("width",1).attr("height",1)))}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),Mo(this,qo).clearMap(),bo(".selectpicker").val("default").selectpicker("refresh")}_initModal(){So(this,Ho,new p.Z(`${o.xw} <span class="text-primary small">v${o.f4}</span>`,"lg"));Mo(this,Ho).bodySel.html(`<p>${o.FB} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/">Game-Labs forum post</a> for further details. Feedback is very welcome.</p>\n                    <p>Designed by iB aka Felix Victor, <em>Bastards</em> clan ${(0,d.Mo)("(BASTD)")}</a>.</p>\n                    <div class="alert alert-secondary" role="alert"><h5 class="alert-heading">Did you know?</h5><p class="mb-0">My clan mate, Aquillas, wrote a most comprehensive <a href="https://drive.google.com/file/d/1PGysQwYg6aCQKq1dJQWtlc443IdO_drG/view">user guide</a>.</p></div>`)}_showAbout(){Mo(this,Ho)?Mo(this,Ho).show():this._initModal()}_doDoubleClickAction(t){const[e,i]=(0,s.Z)(t,Mo(this,Go).node());"f11"===this._doubleClickAction?this.f11.printCoord(e,i):this._journey.plotCourse(e,i),this.zoomAndPan(e,i)}_setZoomLevelAndData(t){const e=this._getMapScale(t.k);e!==Mo(this,$o)&&(So(this,$o,e),Mo(this,$o)>Mo(this,No)?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):Mo(this,$o)>Mo(this,Lo)?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(Mo(this,$o))}_getMapScale(t){return 2**(Math.log2(t)-Mo(this,To))}_getMapTransform(t){const e=this._getMapScale(t.k);return n.CR.scale(e).translate(Mo(this,Zo)[0]/e,Mo(this,Zo)[1]/e)}_naZoomed(t){const{transform:e}=t;this._drawMap(e),this._ports.setBounds(Mo(this,Eo)),this._pbZone.setBounds(Mo(this,Eo)),this.showTrades.setBounds(Mo(this,Eo));const i=this._getMapTransform(e);this._grid.transform(i),this.showTrades.transform(i),Mo(this,Go).attr("transform",i.toString()),this._setZoomLevelAndData(e)}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){var t;this.zoomLevel="initial",So(this,Do,this._getInitialMapScale()),this._initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight(),null===(t=document.querySelector("#navbar-left"))||void 0===t||t.classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight(),So(this,Ao,[[0,0],[this.width,this.height]])}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style",`height:${e}px`)}_getInitialMapScale(){let t=(0,l.XH)(Math.min(this.height,this.width)/Mo(this,Co));const e=this.height*this.width;if(e-(Mo(this,Co)*t)**2>(Mo(this,Co)*t*2)**2-e){const e=2;So(this,Po,!0),t*=e}return t}_setTranslateExtent(t){let e=t;if(Mo(this,Po)){const i=2,a=t.k/i,{x:s,y:r}=t;e=n.CR.translate(s,r).scale(a)}Mo(this,jo).translateExtent([e.invert(Mo(this,Ao)[0]),e.invert(Mo(this,Ao)[1])])}_initialZoomAndPan(){const t=this.zoomAndPan(this.coord.max/2,this.coord.max/2,!0);this._setTranslateExtent(t)}zoomAndPan(t,e,i=!1){const a=i?Mo(this,Do):32,s=n.CR.scale(a).translate(Math.floor((-t+this.coord.max/2+this.width/2)/a),Math.floor(-e+this.coord.max/2+this.height/2)/a);return this._svg.call(Mo(this,jo).transform,s),s}goToPort(){0===this._ports.currentPort.id?this._initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y)}get extent(){return Mo(this,Ao)}}},2938:(t,e,i)=>{i.d(e,{Z:()=>v});i(3223);var a=i(1198),s=i(393),n=i(5311);function r(t,e,i){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,i)}function o(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,h(t,e,"get"))}function l(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,h(t,e,"set"),i),i}function h(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var d=new WeakMap,c=new WeakMap,p=new WeakMap,u=new WeakMap,w=new WeakMap;class v{constructor(t,e){r(this,d,{writable:!0,value:void 0}),r(this,c,{writable:!0,value:void 0}),r(this,p,{writable:!0,value:void 0}),r(this,u,{writable:!0,value:{}}),r(this,w,{writable:!0,value:{}}),l(this,u,t),l(this,d,e),l(this,c,`form-${o(this,d)}`),l(this,p,`slider-${o(this,d)}`),this._inject(),l(this,w,n(`#${o(this,p)}`)),this._setup()}_setup(){window.sliderTooltip=t=>`${(0,a.nD)(String(t.value))}<br>${String(t.value)}°`,o(this,w).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/s.Tm.length,editableTooltip:!1,tooltipFormat:"sliderTooltip",create(){this.control.css("display","block")}})}_inject(){const t=o(this,u).append("form").attr("id",o(this,c)).append("div").attr("class","text-center");t.append("label").attr("for",o(this,p)).text("Current in-game wind"),t.append("div").attr("id",o(this,p)).attr("class","rslider d-inline-block")}_getInputValue(){return o(this,w).roundSlider("getValue")}getWind(){const t=(0,s.tT)(this._getInputValue());let e;return e=Number.isNaN(Number(t))?(0,s.Ri)(t):Number(t),e}}},7846:t=>{t.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' height='300' width='300' viewBox='0 0 512 512'%3e%3cpath fill='%23292109' fill-opacity='.7' d='m438 411.3-37.6-37.6c.1-.2.1-.2.1-.4 9.7-20.8 6.2-46.3-11-63.5L363 336.3l-80.5-80.5 96.6-96.6c24-24 37.5-56.6 37.5-90.5L256 229.3 95.4 68.7c0 34 13.5 66.5 37.5 90.5l96.6 96.6-80.5 80.5-26.5-26.5c-17.2 17.2-20.7 42.7-11 63.5.1.2.1.2.1.4L74 411.3c-7.3 7.3-7.3 19.2 0 26.5 7.3 7.3 19.2 7.3 26.5 0l37.6-37.6c.2.1.2.1.4.1 20.8 9.7 46.3 6.2 63.5-11l-26.5-26.5 80.5-80.5 80.5 80.5-26.5 26.6c17.2 17.2 42.7 20.7 63.5 11 .1-.1.2-.1.4-.1l37.6 37.6c7.3 7.3 19.2 7.3 26.5 0 7.3-7.4 7.3-19.3 0-26.6z'/%3e%3c/svg%3e"}}]);