(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(t,e,s){"use strict";function a(t){const e=["th","st","nd","rd"],s=t%100;return t+(e[(s-20)%10]||e[s]||e[0])}function i(t){return 0===Object.getOwnPropertyNames(t).length&&t.constructor===Object}function r(t){return 200<=t.status&&300>t.status?Promise.resolve(t):Promise.reject(new Error(t.statusText))}function o(t,e,s=!0){if(2>e)return[t];const a=t.length,i=[];let r,o=0;if(0==a%e)for(r=d(a/e);o<a;)i.push(t.slice(o,o+=r));else if(s)for(;o<a;)r=Math.ceil((a-o)/e--),i.push(t.slice(o,o+=r));else{for(0==a%(r=d(a/(e-=1)))&&(r-=1);o<r*e;)i.push(t.slice(o,o+=r));i.push(t.slice(r*e))}return i}var n=Math.PI,d=Math.floor,h=Math.round;s.d(e,"k",function(){return u}),s.d(e,"l",function(){return _}),s.d(e,"j",function(){return g}),s.d(e,"m",function(){return b}),s.d(e,"o",function(){return f}),s.d(e,"n",function(){return y}),s.d(e,"p",function(){return S}),s.d(e,"r",function(){return a}),s.d(e,"w",function(){return w}),s.d(e,"s",function(){return i}),s.d(e,"e",function(){return D}),s.d(e,"f",function(){return v}),s.d(e,"g",function(){return $}),s.d(e,"a",function(){return j}),s.d(e,"h",function(){return C}),s.d(e,"v",function(){return x}),s.d(e,"i",function(){return k}),s.d(e,"t",function(){return O}),s.d(e,"c",function(){return r}),s.d(e,"q",function(){return T}),s.d(e,"u",function(){return P}),s.d(e,"b",function(){return I}),s.d(e,"d",function(){return o});var c=s(39),l=(s.n(c),s(10));const p=Object(l.b)({decimal:".",thousands:" ",grouping:[3],currency:[""," gold"],percent:" %"}),m=Object(l.c)(",.0",1e3),u=(t,e=2)=>p.format(`,.${e}~r`)(t).replace("-","− "),_=(t,e=2)=>p.format(`.${e}f`)(t).replace("-","− ").replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),g=t=>m(-1*t).replace("-","− "),b=t=>p.format(",d")(t).replace("-","− "),f=t=>p.format(",.2s")(t).replace(".0","").replace("-","− "),y=t=>p.format(".1%")(t).replace(".0","").replace("-","− "),S=t=>p.format("+.1%")(t).replace(".0","").replace("-","− ").replace("+","＋ "),w=t=>h(1e3*t)/1e3,D=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"],v=t=>{const e=360/D.length;return D.indexOf(t)*e},$=t=>{const e=d(t/22.5+.5);return D[e%16]},j=(t,e,s,a)=>{const i=Math.min.apply(Math,[e,s]),r=Math.max.apply(Math,[e,s]);return a?t>=i&&t<=r:t>i&&t<r},C=t=>n/180*(t-90),x=(t,e)=>{let s=Math.atan2(e.y-t.y,e.x-t.x),a=(t=>180*t/n)(s-=n/2);return 0>a&&(a+=360),a},k=(t,e)=>Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2),O=t=>2**h(Math.log2(t)),T=t=>t.json(),P=t=>{console.error("Request failed --\x3e",t)},I=t=>t.charAt(0).toUpperCase()+t.slice(1)},,,function(t,e,s){"use strict";(function(t){function a(t,e){const s={x:f(t.x,t.y),y:y(t.x,t.y)},a={x:f(e.x,e.y),y:y(e.x,e.y)};return Object(n.i)(s,a)/(2.63*v)}function i(t,e,s="lg",a="Close"){const i=Object(o.select)("#modal-section").append("section").attr("id",t).attr("class","modal").attr("data-keyboard","false").attr("data-backdrop","static").attr("tabindex","-1").attr("role","dialog").append("div").attr("class",`modal-dialog${"lg"===s||"sm"===s?` modal-${s}`:""}`).attr("role","document").append("div").attr("class","modal-content");i.append("header").attr("class","modal-header").append("h3").html(e),i.append("div").attr("class","modal-body"),i.append("footer").attr("class","modal-footer").append("button").text(a).attr("type","button").attr("class","btn btn-secondary").attr("data-dismiss","modal")}function r(e){t(`#${e} .dropdown-menu .bootstrap-select .dropdown-toggle`).on("click",e=>{const s=t(e.currentTarget);return s.next(".dropdown-menu").toggleClass("show"),s.parent("li").toggleClass("show"),s.parents("li.nav-item.dropdown.show").on("hidden.bs.dropdown",e=>{t(e.currentTarget).find(".dropdown-menu.show").not(".inner").removeClass("show")}),!1}),t(`#${e} div.dropdown.bootstrap-select`).on("hidden",e=>{t(e.currentTarget).find(".dropdown-menu.show").not(".inner").removeClass("show")})}s.d(e,"e",function(){return g}),s.d(e,"f",function(){return b}),s.d(e,"g",function(){return f}),s.d(e,"h",function(){return y}),s.d(e,"n",function(){return S}),s.d(e,"j",function(){return w}),s.d(e,"i",function(){return D}),s.d(e,"o",function(){return v}),s.d(e,"k",function(){return a}),s.d(e,"m",function(){return i}),s.d(e,"l",function(){return r}),s.d(e,"a",function(){return $}),s.d(e,"b",function(){return j}),s.d(e,"c",function(){return C}),s.d(e,"d",function(){return x});var o=s(0),n=s(1);const d=-.00499866779363828,h=-2.1464254980645e-7,c=4096.88635151897,l=4096.90282787469,p=-200.053302087577,m=-.00859027897636011,u=819630.836437126,_=-819563.745651571,g=(t,e)=>d*t+h*e+c,b=(t,e)=>h*t-d*e+l,f=(t,e)=>p*t+m*e+u,y=(t,e)=>m*t-p*e+_,S=[{id:0,short:"NT",name:"Neutral",sortName:"Neutral"},{id:1,short:"PR",name:"Pirates",sortName:"Pirates"},{id:2,short:"ES",name:"España",sortName:"España"},{id:3,short:"FR",name:"France",sortName:"France"},{id:4,short:"GB",name:"Great Britain",sortName:"Great Britain"},{id:5,short:"VP",name:"Verenigde Provinciën",sortName:"Verenigde Provinciën"},{id:6,short:"DK",name:"Danmark-Norge",sortName:"Danmark-Norge"},{id:7,short:"SE",name:"Sverige",sortName:"Sverige"},{id:8,short:"US",name:"United States",sortName:"United States"},{id:9,short:"FT",name:"Free Town",sortName:"Free Town"},{id:10,short:"RU",name:"Russian Empire",sortName:"Russian Empire"},{id:11,short:"DE",name:"Kingdom of Prussia",sortName:"Prussia"},{id:12,short:"PL",name:"Commonwealth of Poland",sortName:"Poland"}],w=16,D=16,v=390,$="Yet another map with in-game map, F11 coordinates, resources, ship and wood comparison. Port data is updated constantly from twitter and daily after maintenance.",j="Naval Action map",C="7",x=5}).call(this,s(11))},,,function(t,e,s){"use strict";function a(){window.dataLayer.push(arguments)}function i(t,e){void 0!==window.google_tag_manager&&window.google_tag_manager.dataLayer.gtmLoad&&a("event","click",{event_category:t,event_label:e})}function r(t,e){void 0!==window.google_tag_manager&&window.google_tag_manager.dataLayer.gtmLoad&&a("config",n,{page_title:t,page_path:e})}function o(){a("js",new Date),a("config",n)}s.d(e,"b",function(){return i}),s.d(e,"c",function(){return r}),s.d(e,"a",function(){return o});const n="UA-109520372-1";window.dataLayer=window.dataLayer||[]},,,,function(t){t.exports=jQuery},,,,,,,,,,,,,,,,,,,,,function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return p});var a=s(16),i=(s.n(a),s(2)),r=s(0),o=s(1),n=s(7),d=s(4);class h{constructor(t,e){this._id=t,this._woodCompare=e,this._select=`#${this._woodCompare._baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(r.select)(this._select).select("g")}_setupMainDiv(){Object(r.select)(`${this._select} div`).remove(),Object(r.select)(this._select).append("div")}}class c extends h{constructor(t,e,s){super(t,s),this._woodData=e,this._woodCompare=s,this._printText()}_getProperty(t,e){const s=this._woodData[e].properties.filter(e=>e.modifier===t).map(t=>t.amount)[0];return void 0===s?0:s/100}_getPropertySum(t){return this._getProperty(t,"frame")+this._getProperty(t,"trim")}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';return e+="<tr>",e+="<tr><th><em>Property</em></th><th><em>Change in %</em></th></tr></thead><tbody>",t.properties.forEach((t,s)=>{if(e+=`<tr><td>${s}</td><td>${Object(o.k)(100*t)}`,e+='<span class="rate">',0<t){const a=t/this._woodCompare._minMaxProperty.get(s).max*100*50;e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${a}%;"></span>`}else if(0>t){const a=t/this._woodCompare._minMaxProperty.get(s).min*100*50;e+=`<span class="bar neutral" style="width:${50-a}%;"></span>`,e+=`<span class="bar neg diff" style="width:${a}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}),e+="</tbody></table>"}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name};e.properties=new Map,this._woodCompare._properties.forEach(t=>{e.properties.set(t,this._getPropertySum(t))}),t(`${this._select}`).find("div").append(this._getText(e))}}class l extends h{constructor(t,e,s,a){super(t,a),this._baseData=e,this._compareData=s,this._woodCompare=a,this._printTextComparison()}_getBaseProperty(t,e){const s=this._baseData[e].properties.filter(e=>e.modifier===t).map(t=>t.amount)[0];return void 0===s?0:s/100}_getBasePropertySum(t){return this._getBaseProperty(t,"frame")+this._getBaseProperty(t,"trim")}_getCompareProperty(t,e){const s=this._compareData[e].properties.filter(e=>e.modifier===t).map(t=>t.amount)[0];return void 0===s?0:s/100}_getComparePropertySum(t){return this._getCompareProperty(t,"frame")+this._getCompareProperty(t,"trim")}_getText(t){function e(t,e,s=1){const a=parseFloat((100*(t-e)).toFixed(s));return 0>a?`${Object(o.k)(100*t)} <span class="badge badge-light">${Object(o.k)(a)}</span>`:0<a?`${Object(o.k)(100*t)} <span class="badge badge-light">+ ${Object(o.k)(a)}</span>`:Object(o.k)(100*t)}const s=50;let a=0,i=0,r=0,n="",d='<table class="table table-sm table-striped small wood mt-4"><thead>';return d+="<tr>",d+="<tr><th><em>Property</em></th><th><em>Change in %</em></th></tr></thead><tbody>",t.properties.forEach((t,o)=>{d+=`<tr><td>${o}</td><td>${e(t.compare,t.base)}`,d+='<span class="rate">',0<=t.compare?(0<=t.base?t.compare>t.base?(a=t.base,i=t.compare-t.base,n="pos"):(a=t.compare,i=t.base-t.compare,n="neg"):(a=0,i=t.compare,n="pos"),d+='<span class="bar neutral" style="width:50%;"></span>',d+=`<span class="bar pos diff" style="width:${a/this._woodCompare._minMaxProperty.get(o).max*100*s}%;"></span>`,d+=`<span class="bar ${n}" style="width:${i/this._woodCompare._minMaxProperty.get(o).max*100*s}%;"></span>`):0>t.compare?(0>t.base?t.compare>=t.base?(a=t.compare,i=t.base-t.compare,r=-t.base,n="pos"):(a=t.base,i=t.compare-t.base,r=-t.compare,n="neg"):(a=0,i=t.compare,r=-t.compare,n="neg"),d+=`<span class="bar neutral" style="width:${s+r/this._woodCompare._minMaxProperty.get(o).min*100*s}%;"></span>`,d+=`<span class="bar ${n}" style="width:${i/this._woodCompare._minMaxProperty.get(o).min*100*s}%;"></span>`,d+=`<span class="bar neg diff" style="width:${a/this._woodCompare._minMaxProperty.get(o).min*100*s}%;"></span>`):d+='<span class="bar neutral"></span>',d+="</span></td></tr>"}),d+="</tbody></table>"}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name};e.properties=new Map,this._woodCompare._properties.forEach(t=>{e.properties.set(t,{base:this._getBasePropertySum(t),compare:this._getComparePropertySum(t)})}),t(`${this._select}`).find("div").append(this._getText(e))}}class p{constructor(t,e){this._woodData=t,this._baseFunction=e,this._baseName="Compare woods",this._baseId=`${this._baseFunction}-compare`,this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,"wood"===this._baseFunction?(this._defaultWood={frame:"Fir",trim:"Crew Space"},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this._baseFunction?(this._defaultWood={frame:"Oak",trim:"Oak"},this._columnsCompare=[]):(this._defaultWood={frame:"Oak",trim:"Oak"},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base"),this._woodsSelected=[],this._instances=[],this._properties=["Thickness","Hull strength","Side armour","Mast thickness","Ship speed","Acceleration","Rudder speed","Turn speed","Crew","Crew protection","Grog morale bonus","Fire resistance","Leak resistance"],this._options={},this._minMaxProperty=new Map,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(n.b)("Tools",this._baseName),t.stopPropagation(),this._woodCompareSelected()})}_woodCompareSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_setupData(){this._frameSelectData=this._woodData.frame.sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0),this._trimSelectData=this._woodData.trim.sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0),this._setOption(this._frameSelectData.map(t=>`<option value="${t.name}">${t.name}</option>`),this._trimSelectData.map(t=>`<option value="${t.name}">${t.name}</option>`)),this._properties.forEach(t=>{const e=[...this._woodData.frame.map(e=>e.properties.filter(e=>e.modifier===t).map(t=>t.amount)[0])],s=[...this._woodData.trim.map(e=>e.properties.filter(e=>e.modifier===t).map(t=>t.amount)[0])],a=Object(i.min)(e)||0,r=Object(i.max)(e)||0,o=Object(i.min)(s)||0,n=Object(i.max)(s)||0;this._addMinMaxProperty(t,{min:0<=a+o?0:a+o,max:r+n})})}_injectModal(){Object(d.m)(this._modalId,this._baseName);const t=Object(r.select)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");this._columns.forEach(e=>{const s=t.append("div").attr("class",`col-md-3 ml-auto pt-2 ${"Base"===e?"columnA":"columnC"}`);["frame","trim"].forEach(t=>{const a=`${this._baseFunction}-${t}-${e}-select`;s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a)}),s.append("div").attr("id",`${this._baseFunction}-${e}`)})}_initModal(){this._setupData(),this._injectModal(),this._columns.forEach(e=>{["frame","trim"].forEach(s=>{const a=t(`#${this._baseFunction}-${s}-${e}-select`);this._setupWoodSelects(e,s,a),this._setupSelectListener(e,s,a)})})}_setWoodsSelected(t,e,s){void 0===this._woodsSelected[t]&&(this._woodsSelected[t]={}),this._woodsSelected[t][e]=s}_setupWoodSelects(t,e,s){this._setWoodsSelected(t,e,this._defaultWood[e]),s.append(this._options[e]),("wood"!==this._baseFunction||"Base"!==t&&"wood"===this._baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(e,s){const a="frame"===s?"trim":"frame";this._getWoodSelected(e)[a]===this._defaultWood[a]&&t(`#${this._baseFunction}-${a}-${e}-select`).val(this._defaultWood[a]).selectpicker("refresh")}enableSelects(e){["frame","trim"].forEach(s=>{t(`#${this._baseFunction}-${s}-${e}-select`).removeAttr("disabled").selectpicker("refresh")})}_woodSelected(t,e,s){const a=s.val();this._setWoodsSelected(t,e,a),this._setOtherSelect(t,e),"Base"===t?(this._addInstance(t,new c("Base",this._getWoodData("Base"),this)),this._columnsCompare.forEach(t=>{"wood"===this._baseFunction&&this.enableSelects(t),void 0!==this._instances[t]&&this._addInstance(t,new l(t,this._getWoodData("Base"),this._getWoodData(t),this))})):this._addInstance(t,new l(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,s){s.addClass("selectpicker").on("change",()=>this._woodSelected(t,e,s)).selectpicker({noneSelectedText:`Select ${e}`}).val("default").selectpicker("refresh")}_getWoodTypeData(t,e){return this._woodData[t].filter(t=>t.name===e)[0]}_getWoodData(t){return{frame:this._getWoodTypeData("frame",this._getWoodSelected(t).frame),trim:this._getWoodTypeData("trim",this._getWoodSelected(t).trim)}}_getWoodSelected(t){return this._woodsSelected[t]}_addMinMaxProperty(t,e){this._minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this._instances[t]=e}}}).call(this,s(11))},,,,,,,,,,,function(t,e,s){"use strict";var a=Math.sin,i=Math.cos,r=Math.PI,o=Math.min,n=Math.floor,d=Math.round;(function(t){s.d(e,"a",function(){return O});var h=s(54),c=(s.n(h),s(16)),l=(s.n(c),s(2)),p=s(17),m=s(5),u=s(9),_=s(0),g=s(12),b=s(1),f=s(7),y=s(32),S=s(4);const w=24,D=2*r/w,v=500,$=400,j=4;class C{constructor(t,e){this._id=t,this._shipData=e,this._select=`#ship-compare-${this._id}`,this._setupSvg(),this._g=Object(_.select)(this._select).select("g"),this._setCompass()}_setupSvg(){const t=Object(_.select)(this.select);Object(_.select)(`${this.select} svg`).remove(),t.append("svg").attr("width",this.shipData.svgWidth).attr("height",this.shipData.svgHeight).attr("class","profile").attr("fill","none").append("g").attr("transform",`translate(${this.shipData.svgWidth/2}, ${this.shipData.svgHeight/2})`),Object(_.select)(`${this.select} div`).remove(),t.append("div").classed("block",!0)}_setCompass(){const t=Array(w/2);t.fill(1,0);const e=Object(g.f)().sort(null).value(1)(t),s=Object(g.a)().outerRadius(this.shipData.radiusScaleAbsolute(12)).innerRadius(this.shipData.innerRadius);this.g.selectAll(".compass-arc").data(e).enter().append("g").attr("class","compass-arc").append("path").attr("d",s),this.g.append("line").attr("x1",0).attr("y1",-160).attr("x2",0).attr("y2",-79).attr("marker-end","url(#course-arrow)")}static pd(t){let e=`<span class="badge badge-light">${t[0]} / `;return e+=t[1]?`${t[1]}`:"–",e+=" pd</span>"}static getCannonsPerDeck(t,e){let s=`${e[0]} ${C.pd(t[0])}`,a="";for(let i=1;4>i;i+=1)e[i]?s=`${e[i]} ${C.pd(t[i])} <br>${s}`:a=`${a}<br>`;return[s,a]}static getText(t){function e(t){return`<div class="row small ${(a+=1)%2?"light":""}"><div class="col-3">${t}</div>`}function s(e,s,a=6){let i="",r="";if("cannonsPerDeck"===e){var o=t[e];i=o[0],r=`<br>${r=o[1]}`}else i=""===e?"":t[e];return`<div class="col-${a}">${i}<br><span class="des">${s}</span>${r}</div>`}let a=0,i="";return i+=e(t.shipRating),i+='<div class="col-9"><div class="row no-gutters">',i+=s("battleRating","Battle rating"),i+=s("guns","Cannons"),i+=s("upgradeXP","Knowledge XP"),i+=s("waterlineHeight","Water line"),i+="</div></div></div>",i+=e(t.decks),i+='<div class="col-9"><div class="row no-gutters">',i+=s("cannonsPerDeck","Gun decks"),i+=s("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=e("Broadside (pd)"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("cannonBroadside","Cannons"),i+=s("carroBroadside","Carronades"),i+="</div></div></div>",i+=e("Chasers"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("gunsFront","Bow"),i+=s("gunsBack","Stern"),i+="</div></div></div>",i+=e("Speed"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("maxSpeed","Maximum"),i+=s("",""),i+=s("acceleration","Acceleration"),i+=s("deceleration","Deceleration"),i+=s("maxTurningSpeed","Turn speed"),i+=s("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=e('Armour <span class="badge badge-light">Thickness</span>'),i+='<div class="col-9"><div class="row no-gutters">',i+=s("sideArmor","Sides"),i+=s("structure","Hull"),i+=s("frontArmor","Bow"),i+=s("backArmor","Stern"),i+=s("pump","Pump"),i+=s("rudder","Rudder"),i+="</div></div></div>",i+=e('Masts <span class="badge badge-light">Thickness</span>'),i+='<div class="col-9"><div class="row no-gutters">',i+=s("sails","Sails"),i+=s("mastBottomArmor","Bottom"),i+=s("mastMiddleArmor","Middle"),i+=s("mastTopArmor","Top"),i+="</div></div></div>",i+=e("Crew"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("minCrew","Minimum",4),i+=s("sailingCrew","Sailing",4),i+=s("maxCrew","Maximum",4),i+="</div></div></div>",i+=e("Resistance"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("fireResistance","Fire",3),i+=s("leakResistance","Leaks",3),i+=s("crewProtection","Crew Protection",6),i+="</div></div></div>",i+=e("Repairs needed"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("hullRepair","Hull",4),i+=s("rigRepair","Rig",4),i+=s("rumRepair","Rum",4),i+="</div></div></div>",i+=e("Repair time"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("sidesRepair","Sides",4),i+=s("structureRepair","Hull",4),i+=s("bowRepair","Bow",4),i+=s("sternRepair","Stern",4),i+=s("sailsRepair","Sails",4),i+=s("rudderRepair","Rudder",4),i+="</div></div></div>",i+=e("Hold"),i+='<div class="col-9"><div class="row no-gutters">',i+=s("maxWeight","Tons"),i+=s("holdSize","Cargo slots"),i+="</div></div></div>",i+="</div>"}get id(){return this._id}get shipData(){return this._shipData}get select(){return this._select}get g(){return this._g}}class x extends C{constructor(t,e,s){super(t,s),this._shipData=e,this._shipCompareData=s,this._setBackground(),this._setBackgroundGradient(),this._drawProfile(),this._printText()}_setBackground(){const t=Object(g.a)().outerRadius(t=>this.shipCompareData.radiusScaleAbsolute(t)+2).innerRadius(t=>this.shipCompareData.radiusScaleAbsolute(t)+1).startAngle(-r/2).endAngle(r/2),e=[12,8,4,0],s=["12 knots","8 knots","4 knots","0 knots"];this.g.selectAll(".circle").data(e).enter().append("circle").attr("class","knots-circle").attr("r",t=>this.shipCompareData.radiusScaleAbsolute(t)),this.g.selectAll(".label").data(e).enter().append("path").attr("d",t).attr("id",(t,e)=>`tick${e}`),this.g.selectAll(".label").data(e).enter().append("text").attr("class","knots-text").append("textPath").attr("href",(t,e)=>`#tick${e}`).text((t,e)=>s[e]).attr("startOffset","16%")}_setBackgroundGradient(){const t=Object(u.scaleLinear)().domain([this.shipData.speed.min,this.shipData.speed.max]).range([0,this.shipCompareData.svgWidth]),e=t.domain();e[2]=e[1]-e[0];const s=[];for(let t=0;t<30;t+=1)s.push(t*e[2]/29+e[0]);this.g.append("defs").append("radialGradient").attr("id","gradient").attr("cx",.5).attr("cy",.25).attr("r",.5).selectAll("stop").data(Object(l.range)(30)).enter().append("stop").attr("offset",(e,a)=>t(s[a])/this.shipCompareData.svgWidth).attr("stop-color",(t,e)=>this.shipCompareData.colorScale(s[e]))}_drawProfile(){const t=Object(g.f)().sort(null).value(1)(this.shipData.speedDegrees),e=g.d,s=Object(g.g)().angle((t,e)=>e*D).radius(t=>this.shipCompareData.radiusScaleAbsolute(t.data)).curve(e),r=this.g.append("path").classed("base",!0),o=this.g.append("g").classed("markers",!0);r.attr("d",s(t)),o.selectAll("circle").data(t).enter().append("circle").attr("r",5).attr("cy",(t,e)=>i(e*D)*-this.shipCompareData.radiusScaleAbsolute(t.data)).attr("cx",(t,e)=>a(e*D)*this.shipCompareData.radiusScaleAbsolute(t.data)).attr("fill",t=>this.shipCompareData.colorScale(t.data)).append("title").text(t=>`${d(10*t.data)/10} knots`)}_printText(){const e=C.getCannonsPerDeck(this.shipData.deckClassLimit,this.shipData.gunsPerDeck),s={shipRating:`${Object(b.r)(this.shipData.class)} rate`,battleRating:this.shipData.battleRating,guns:this.shipData.guns,decks:`${this.shipData.decks} deck${1<this.shipData.decks?"s":""}`,additionalRow:`${4>this.shipData.decks?"<br> ":""}`,cannonsPerDeck:e,cannonBroadside:Object(b.m)(this.shipData.broadside.cannons),carroBroadside:Object(b.m)(this.shipData.broadside.carronades),gunsFront:this.shipData.gunsPerDeck[4],limitFront:this.shipData.deckClassLimit[4],gunsBack:this.shipData.gunsPerDeck[5],limitBack:this.shipData.deckClassLimit[5],firezoneHorizontalWidth:this.shipData.ship.firezoneHorizontalWidth,waterlineHeight:Object(b.k)(this.shipData.ship.waterlineHeight),maxSpeed:Object(b.k)(this.shipData.speed.max,3),acceleration:Object(b.k)(this.shipData.ship.acceleration),deceleration:Object(b.k)(this.shipData.ship.deceleration),maxTurningSpeed:Object(b.k)(this.shipData.rudder.turnSpeed),halfturnTime:Object(b.k)(this.shipData.rudder.halfturnTime),sideArmor:`${Object(b.m)(this.shipData.sides.armour)} <span class="badge badge-light">${Object(b.m)(this.shipData.sides.thickness)}</span>`,frontArmor:`${Object(b.m)(this.shipData.bow.armour)} <span class="badge badge-light">${Object(b.m)(this.shipData.bow.thickness)}</span>`,pump:Object(b.m)(this.shipData.pump.armour),sails:Object(b.m)(this.shipData.sails.armour),structure:Object(b.m)(this.shipData.structure.armour),backArmor:`${Object(b.m)(this.shipData.stern.armour)} <span class="badge badge-light">${Object(b.m)(this.shipData.stern.thickness)}</span>`,rudder:`${Object(b.m)(this.shipData.rudder.armour)} <span class="badge badge-light">${Object(b.m)(this.shipData.rudder.thickness)}</span>`,minCrew:Object(b.m)(this.shipData.crew.min),maxCrew:Object(b.m)(this.shipData.crew.max),sailingCrew:Object(b.m)(this.shipData.crew.sailing),maxWeight:Object(b.m)(this.shipData.maxWeight),holdSize:Object(b.m)(this.shipData.holdSize),upgradeXP:Object(b.m)(this.shipData.upgradeXP),sternRepair:Object(b.m)(this.shipData.repairTime.stern),bowRepair:Object(b.m)(this.shipData.repairTime.bow),sidesRepair:Object(b.m)(this.shipData.repairTime.sides),rudderRepair:Object(b.m)(this.shipData.repairTime.rudder),sailsRepair:Object(b.m)(this.shipData.repairTime.sails),structureRepair:Object(b.m)(this.shipData.repairTime.structure),hullRepair:`${Object(b.m)(this.shipData.sides.armour/v)}`,rigRepair:`${Object(b.m)(this.shipData.sails.armour/$)}`,rumRepair:`${Object(b.m)(this.shipData.crew.max/j)}`,fireResistance:Object(b.m)(this.shipData.resistance.fire),leakResistance:Object(b.m)(this.shipData.resistance.leaks),crewProtection:Object(b.m)(this.shipData.resistance.crew),mastBottomArmor:`${Object(b.m)(this.shipData.mast.bottomArmour)} <span class="badge badge-light">${Object(b.m)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(b.m)(this.shipData.mast.middleArmour)} <span class="badge badge-light">${Object(b.m)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(b.m)(this.shipData.mast.topArmour)} <span class="badge badge-light">${Object(b.m)(this.shipData.mast.topThickness)}</span>`};s.gunsFront?s.gunsFront+=` ${C.pd(s.limitFront)}`:s.gunsFront="–",s.gunsBack?s.gunsBack+=` ${C.pd(s.limitBack)}`:s.gunsBack="–",t(`${this.select}`).find("div").append(C.getText(s))}get shipData(){return this._shipData}get shipCompareData(){return this._shipCompareData}}class k extends C{constructor(t,e,s,a){super(t,a),this._shipBaseData=e,this._shipCompareData=s,this._shipCompare=a,this._drawDifferenceProfile(),this._injectTextComparison()}_drawDifferenceProfile(){const t=Object(g.f)().sort(null).value(1),e=t(this.shipCompareData.speedDegrees),s=t(this.shipBaseData.speedDegrees),r=g.d,o=Object(g.g)().angle((t,e)=>e*D).radius(t=>this.shipCompare.radiusScaleAbsolute(t.data)).curve(r),n=this.g.append("path"),h=this.g.append("path"),c=this.g.append("g").attr("class","markers"),l=[];this.shipCompareData.speedDegrees.forEach((t,e)=>{l.push(Object(b.w)(t-this.shipBaseData.speedDegrees[e]))});const p=this._shipCompare._minSpeed,_=this._shipCompare._maxSpeed,f=Object(u.scaleLinear)().domain([p,-1,0,1,_]).range(["#782129","#a62e39","#fbf8f5","#419f57","#2a6739"]).interpolate(m.c);n.attr("d",o(e)).classed("comp",!0),c.selectAll("circle").data(e).enter().append("circle").attr("r",5).attr("cy",(t,e)=>i(e*D)*-this.shipCompare.radiusScaleAbsolute(t.data)).attr("cx",(t,e)=>a(e*D)*this.shipCompare.radiusScaleAbsolute(t.data)).attr("fill",(t,e)=>f(l[e])).append("title").text(t=>`${d(10*t.data)/10} knots`),h.attr("d",o(s)).classed("base",!0)}_injectTextComparison(){function e(t,e,s=0){const a=parseFloat((t-e).toFixed(s));return 0>a?`<span class="badge badge-danger">${Object(b.k)(Math.abs(a))}</span>`:0<a?`<span class="badge badge-success">${Object(b.k)(a)}</span>`:""}const s={shipRating:`${Object(b.r)(this.shipCompareData.class)} rate`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this.shipBaseData.battleRating)}`,guns:`${this.shipCompareData.guns} ${e(this.shipCompareData.guns,this.shipBaseData.guns)}`,decks:`${this.shipCompareData.decks} deck${1<this.shipCompareData.decks?"s":""} ${e(this.shipCompareData.decks,this.shipBaseData.decks)}`,additionalRow:`${4>this.shipCompareData.decks?"<br> ":""}`,cannonsPerDeck:C.getCannonsPerDeck(this.shipCompareData.deckClassLimit,this.shipCompareData.gunsPerDeck),cannonBroadside:`${this.shipCompareData.broadside.cannons} ${e(this.shipCompareData.broadside.cannons,this.shipBaseData.broadside.cannons)}`,carroBroadside:`${this.shipCompareData.broadside.carronades} ${e(this.shipCompareData.broadside.carronades,this.shipBaseData.broadside.carronades)}`,gunsFront:this.shipCompareData.gunsPerDeck[4],limitFront:this.shipCompareData.deckClassLimit[4],gunsBack:this.shipCompareData.gunsPerDeck[5],limitBack:this.shipCompareData.deckClassLimit[5],minSpeed:`${Object(b.k)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this.shipBaseData.speed.min,2)}`,maxSpeed:`${Object(b.k)(this.shipCompareData.speed.max,3)} ${e(this.shipCompareData.speed.max,this.shipBaseData.speed.max,2)}`,maxTurningSpeed:`${Object(b.k)(this.shipCompareData.rudder.turnSpeed)} ${e(this.shipCompareData.rudder.turnSpeed,this.shipBaseData.rudder.turnSpeed,2)}`,firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this.shipBaseData.ship.firezoneHorizontalWidth)}`,waterlineHeight:`${Object(b.k)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this.shipBaseData.ship.waterlineHeight,2)}`,acceleration:`${Object(b.k)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this.shipBaseData.ship.acceleration,2)}`,deceleration:`${Object(b.k)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this.shipBaseData.ship.deceleration,2)}`,halfturnTime:`${Object(b.k)(this.shipCompareData.rudder.halfturnTime)} ${e(this.shipCompareData.rudder.halfturnTime,this.shipBaseData.rudder.halfturnTime)}`,sideArmor:`${Object(b.m)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this.shipBaseData.sides.armour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this.shipBaseData.sides.thickness)}`,frontArmor:`${Object(b.m)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this.shipBaseData.bow.armour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this.shipBaseData.bow.thickness)}`,backArmor:`${Object(b.m)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this.shipBaseData.stern.armour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this.shipBaseData.stern.thickness)}`,pump:`${Object(b.m)(this.shipCompareData.pump.armour)} ${e(this.shipCompareData.pump.armour,this.shipBaseData.pump.armour)}`,sails:`${Object(b.m)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this.shipBaseData.sails.armour)}`,structure:`${Object(b.m)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this.shipBaseData.structure.armour)}`,rudder:`${Object(b.m)(this.shipCompareData.rudder.armour)} ${e(this.shipCompareData.rudder.armour,this.shipBaseData.rudder.armour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.rudder.thickness)}</span>${e(this.shipCompareData.rudder.thickness,this.shipBaseData.rudder.thickness)}`,minCrew:`${Object(b.m)(this.shipCompareData.crew.min)} ${e(this.shipCompareData.crew.min,this.shipBaseData.crew.min)}`,maxCrew:`${Object(b.m)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this.shipBaseData.crew.max)}`,sailingCrew:`${Object(b.m)(this.shipCompareData.crew.sailing)} ${e(this.shipCompareData.crew.sailing,this.shipBaseData.crew.sailing)}`,maxWeight:`${Object(b.m)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this.shipBaseData.maxWeight)}`,holdSize:`${Object(b.m)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this.shipBaseData.holdSize)}`,upgradeXP:`${Object(b.m)(this.shipCompareData.upgradeXP)} ${e(this.shipCompareData.upgradeXP,this.shipBaseData.upgradeXP)}`,sternRepair:`${Object(b.m)(this.shipCompareData.repairTime.stern)} ${e(this.shipCompareData.repairTime.stern,this.shipBaseData.repairTime.stern)}`,bowRepair:`${Object(b.m)(this.shipCompareData.repairTime.bow)} ${e(this.shipCompareData.repairTime.bow,this.shipBaseData.repairTime.bow)}`,sidesRepair:`${Object(b.m)(this.shipCompareData.repairTime.sides)} ${e(this.shipCompareData.repairTime.sides,this.shipBaseData.repairTime.sides)}`,rudderRepair:`${Object(b.m)(this.shipCompareData.repairTime.rudder)} ${e(this.shipCompareData.repairTime.rudder,this.shipBaseData.repairTime.rudder)}`,sailsRepair:`${Object(b.m)(this.shipCompareData.repairTime.sails)} ${e(this.shipCompareData.repairTime.sails,this.shipBaseData.repairTime.sails)}`,structureRepair:`${Object(b.m)(this.shipCompareData.repairTime.structure)} ${e(this.shipCompareData.repairTime.structure,this.shipBaseData.repairTime.structure)}`,hullRepair:`${Object(b.m)(this.shipCompareData.sides.armour/v)} ${e(this.shipCompareData.sides.armour/v,this.shipBaseData.sides.armour/v)}`,rigRepair:`${Object(b.m)(this.shipCompareData.sails.armour/$)} ${e(this.shipCompareData.sails.armour/$,this.shipBaseData.sails.armour/$)}`,rumRepair:`${Object(b.m)(this.shipCompareData.crew.max/j)} ${e(this.shipCompareData.crew.max/j,this.shipBaseData.crew.max/j)}`,fireResistance:`${Object(b.m)(this.shipCompareData.resistance.fire)} ${e(this.shipCompareData.resistance.fire,this.shipBaseData.resistance.fire)}`,leakResistance:`${Object(b.m)(this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this.shipBaseData.resistance.leaks)}`,crewProtection:`${Object(b.m)(this.shipCompareData.resistance.crew)} ${e(this.shipCompareData.resistance.crew,this.shipBaseData.resistance.crew)}`,mastBottomArmor:`${Object(b.m)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this.shipBaseData.mast.bottomArmour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this.shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(b.m)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this.shipBaseData.mast.middleArmour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this.shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(b.m)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this.shipBaseData.mast.topArmour)} <span class="badge badge-light">${Object(b.m)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this.shipBaseData.mast.topThickness)}`};s.gunsFront?s.gunsFront+=` ${C.pd(s.limitFront)}`:s.gunsFront="–",s.gunsBack?s.gunsBack+=` ${C.pd(s.limitBack)}`:s.gunsBack="–",t(`${this.select}`).find("div").append(C.getText(s))}get shipBaseData(){return this._shipBaseData}get shipCompareData(){return this._shipCompareData}get shipCompare(){return this._shipCompare}}class O{constructor(t,e,s="ship-compare"){this._shipData=t,this._baseId=s,this._baseName="Compare ships",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._columnsCompare="ship-compare"===this._baseId?["C1","C2"]:[],this._columns=this._columnsCompare.slice(),this._columns.unshift("Base"),this._ships={Base:{},C1:{},C2:{}};const a=1.2*Object(l.min)(this._shipData,t=>t.speed.min);this._minSpeed=a,this._maxSpeed=15.5,this._colorScale=Object(u.scaleLinear)().domain([this._minSpeed,0,12,this._maxSpeed]).range(["#a62e39","#fbf8f5","#419f57","#58bb6f"]).interpolate(m.c),this._woodChanges=new Map([["Hull strength",["structure.armour"]],["Side armour",["bow.armour","sides.armour","sails.armour","structure.armour","stern.armour"]],["Thickness",["sides.thickness","bow.thickness","stern.thickness"]],["Ship speed",["speed.max"]],["Acceleration",["ship.acceleration"]],["Turn speed",["rudder.turnSpeed"]],["Rudder speed",["rudder.halfturnTime"]],["Fire resistance",["resistance.fire"]],["Leak resistance",["resistance.leaks"]],["Crew protection",["resistance.crew"]],["Crew",["crew.max"]]]),this._woodId="ship-journey"===this._baseId?"wood-journey":"wood-ship",this._woodCompare=new y.a(e,this._woodId),"ship-journey"===this._baseId?(this._initData(),this._initWoodSelect()):this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(f.b)("Tools",this._baseName),t.stopPropagation(),this._shipCompareSelected()})}_setGraphicsParameters(){this.svgWidth=parseInt(t(`#${this._modalId} .columnA`).width(),10),this.svgHeight=this.svgWidth,this.outerRadius=n(o(this.svgWidth,this.svgHeight)/2),this.innerRadius=n(.3*this.outerRadius),this.radiusScaleAbsolute=Object(u.scaleLinear)().domain([this.minSpeed,0,this.maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_shipCompareSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show"),this._setGraphicsParameters()}_setupData(){this.shipSelectData=Object(p.b)().key(t=>t.class).sortKeys(l.ascending).entries(this._shipData.map(t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns})).sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0))}_injectModal(){Object(S.m)(this._modalId,this._baseName);const t=Object(_.select)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");this._columns.forEach(e=>{const s=t.append("div").attr("class",`col-md-4 ml-auto pt-2 ${"Base"===e?"columnA":"columnC"}`),a=`${this._baseId}-${e}-select`;s.append("label").append("select").attr("name",a).attr("id",a),["frame","trim"].forEach(t=>{const a=`${this._woodId}-${t}-${e}-select`;s.append("label").append("select").attr("name",a).attr("id",a)}),s.append("div").attr("id",`${this._baseId}-${e}`).attr("class",`${"Base"===e?"ship-base":"ship-compare"}`)})}_initData(){this._setupData(),this.woodCompare._setupData()}_initWoodSelect(){this._columns.forEach(e=>{this._setupShipSelect(e),["frame","trim"].forEach(s=>{const a=t(`#${this._woodId}-${s}-${e}-select`);this.woodCompare._setupWoodSelects(e,s,a)}),this._setupSelectListener(e)})}_initModal(){this._initData(),this._injectModal(),this._initWoodSelect()}_getOptions(){return this.shipSelectData.map(t=>`<optgroup label="${Object(b.r)(t.key)} rate">${t.values.map(t=>`<option data-subtext="${t.battleRating}" value="${t.id}">${t.name} (${t.guns})`).join("</option>")}`).join("</optgroup>")}_setupShipSelect(e){const s=t(`#${this._baseId}-${e}-select`),a=this._getOptions();s.append(a),"Base"!==e&&s.attr("disabled","disabled")}_getShipData(t,e){let s=this._shipData.filter(e=>e.id===t)[0];return s=this._addWoodData(s,e)}_addWoodData(t,e){const s=JSON.parse(JSON.stringify(t));if(s.resistance={},s.resistance.fire=0,s.resistance.leaks=0,s.resistance.crew=0,void 0!==this.woodCompare._instances[e]){let t="_woodData";"Base"!==e&&(t="_compareData");const a=new Map;["frame","trim"].forEach(s=>{this.woodCompare._instances[e][t][s].properties.forEach(t=>{this._woodChanges.has(t.modifier)&&a.set(t.modifier,a.has(t.modifier)?a.get(t.modifier)+t.amount:t.amount)})}),a.forEach((t,e)=>{this._woodChanges.get(e).forEach(t=>{const i=t.split("."),r=1+a.get(e)/100;1<i.length?s[i[0]][i[1]]?s[i[0]][i[1]]*=r:s[i[0]][i[1]]=a.get(e):s[i[0]]?s[i[0]]*=r:s[i[0]]=a.get(e)})}),s.speedDegrees=s.speedDegrees.map(t=>{const e=1+a.get("Ship speed")/100;return Math.max(o(t*e,this._maxSpeed),this._minSpeed)})}return s}_refreshShips(e,s){const a=this._getShipData(e,s);"ship-journey"===this._baseId?this._singleShipData=a:"Base"===s?(this._setShip(s,new x(s,a,this)),this._columnsCompare.forEach(e=>{t(`#${this._baseId}-${e}-select`).removeAttr("disabled").selectpicker("refresh"),Object(b.s)(this.ships[e])||this._setShip(e,new k(e,a,this.ships[e]._shipCompareData,this))})):this._setShip(s,new k(s,this.ships.Base._shipData,a,this))}_enableCompareSelects(){this._columnsCompare.forEach(e=>{t(`#${this._baseId}-${e}-select`).removeAttr("disabled").selectpicker("refresh")})}_setupSelectListener(e){const s=t(`#${this._baseId}-${e}-select`);s.addClass("selectpicker").on("changed.bs.select",t=>{t.preventDefault();const a=+s.val();this._refreshShips(a,e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(e)}).selectpicker({noneSelectedText:"Select ship"}).val("default").selectpicker("refresh"),["frame","trim"].forEach(a=>{const i=t(`#${this._woodId}-${a}-${e}-select`);i.addClass("selectpicker").on("changed.bs.select",()=>{this.woodCompare._woodSelected(e,a,i);const t=+s.val();this._refreshShips(t,e)}).selectpicker({noneSelectedText:`Select ${a}`}).val("default").selectpicker("refresh")})}get woodCompare(){return this._woodCompare}_setShip(t,e){this._ships[t]=e}get ships(){return this._ships}get minSpeed(){return this._minSpeed}get maxSpeed(){return this._maxSpeed}get colorScale(){return this._colorScale}set svgWidth(t){this._svgWidth=t}get svgWidth(){return this._svgWidth}set svgHeight(t){this._svgHeight=t}get svgHeight(){return this._svgHeight}set outerRadius(t){this._outerRadius=t}get outerRadius(){return this._outerRadius}set innerRadius(t){this._innerRadius=t}get innerRadius(){return this._innerRadius}set radiusScaleAbsolute(t){this._radiusScaleAbsolute=t}get radiusScaleAbsolute(){return this._radiusScaleAbsolute}}}).call(this,s(11))},,,,,,,,,,,,,function(t){t.exports=Popper},,,,,,,,,,,,,,,,,,,,function(t,e,s){"use strict";var a=Math.ceil,i=Math.log2,r=Math.max,o=Math.min,n=Math.floor,d=Math.round;(function(t){s.d(e,"a",function(){return M});var h=s(16),c=(s.n(h),s(2)),l=s(0),p=s(19),m=s(35),u=s(13),_=s.n(u),g=s(4),b=s(1),f=s(77),y=s(78),S=s(79),w=s(80),D=s(81),v=s(82),$=s(83),j=s(84),C=s(85),x=s(87),k=s(90),O=s(91),T=s(43),P=s(92),I=s(93),B=s(32),L=s(94),N=s(7);class M{constructor(t){this._serverName=t,this._dataSource=[{fileName:`${t}.json`,name:"ports"},{fileName:`${t}-pb.json`,name:"pb"},{fileName:"pb.json",name:"pbZones"},{fileName:"ships.json",name:"ships"},{fileName:"cannons.json",name:"cannons"},{fileName:"woods.json",name:"woods"},{fileName:"modules.json",name:"modules"},{fileName:"recipes.json",name:"recipes"},{fileName:"buildings.json",name:"buildings"},{fileName:"ownership.json",name:"ownership"},{fileName:"nations.json",name:"nations"}],this.rem=g.j,this._navbarBrandPaddingLeft=n(1.618*this.rem),this.xGridBackgroundHeight=n(3*this.rem),this.yGridBackgroundWidth=n(4*this.rem),this.coord={min:0,max:8192},this._currentTranslate={},this._navbarSelector=document.querySelector(".navbar"),this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionCookieName="na-map--double-click",this._doubleClickActionDefault="compass",this._doubleClickAction=this._getDoubleClickAction(),this._showLayerCookieName="na-map--show-layer",this._showLayerDefault="grid",this._showLayer=this._getShowLayer(),this._setupSvg(),this._setSvgSize(),this._setupListener(),this._setupProps(),this._readData()}_getDoubleClickAction(){let t=_.a.get(this._doubleClickActionCookieName);return t=void 0===t?this._doubleClickActionDefault:t}_getShowLayer(){let t=_.a.get(this._showLayerCookieName);return t=void 0===t?this._showLayerDefault:t}_setupData(t){function e(t){return t.filter(t=>a.includes(t.id)).map(t=>({type:"Feature",id:t.id,geometry:t.geometry}))}const s=Object(m.a)(t.ports,t.ports.objects.ports),a=s.features.filter(t=>!t.properties.nonCapturable).map(t=>t.id);this._f11=new S.a(this,this.coord),this._ports=new x.a(s.features,t.pb,this);let i=Object(m.a)(t.pbZones,t.pbZones.objects.pbCircles);i=e(i.features);let r=Object(m.a)(t.pbZones,t.pbZones.objects.forts);r=e(r.features);let o=Object(m.a)(t.pbZones,t.pbZones.objects.towers);o=e(o.features);let n=Object(m.a)(t.pbZones,t.pbZones.objects.joinCircles);n=e(n.features),this._pbZone=new j.a(i,r,o,n,this._ports);const d=JSON.parse(JSON.stringify(t.woods));this._woodCompare=new B.a(d,"wood"),this._woodList=new L.a(d);const h=JSON.parse(JSON.stringify(t.ships.shipData));this._shipCompare=new T.a(h,d);const c=JSON.parse(JSON.stringify(t.cannons));this._cannonList=new y.a(c);const l=JSON.parse(JSON.stringify(t.ownership)),p=JSON.parse(JSON.stringify(t.nations));this._ownershipList=new C.a(l,p);const u=JSON.parse(JSON.stringify(t.modules));this._moduleList=new $.a(u);const _=JSON.parse(JSON.stringify(t.recipes.recipe));this._recipeList=new O.a(_,u);const g=JSON.parse(JSON.stringify(t.recipes.ingredient));this._ingredientList=new D.a(g,u);const b=JSON.parse(JSON.stringify(t.buildings));this._buildingList=new f.a(b),this._journey=new v.a(h,d,this.rem),this._teleport=new P.a(this.coord,this._ports),this._portSelect=new k.a(this._ports,this._pbZone),this._windPrediction=new I.a,this._grid=new w.a(this),this._init()}_readData(){const t=[],e={};this._dataSource.forEach((e,s)=>{t[s]=fetch(e.fileName).then(b.c).then(b.q)}),Promise.all(t).then(t=>{t.forEach((s,a)=>{e[this._dataSource[a].name]=t[a]}),this._setupData(e)}).catch(b.u)}_setupListener(){this.svg.on("dblclick.zoom",null).on("click",function(){l.event.defaultPrevented&&l.event.stopPropagation()},!0).on("dblclick",(t,e,s)=>this._doDoubleClickAction(s[e])),t("#reset").on("click",()=>{this._clearMap()}),t("#propertyDropdown").on("click",()=>{Object(N.b)("Menu","Select port on property")}),t("#settingsDropdown").on("click",()=>{Object(N.b)("Menu","Settings")}),t("#button-download-pb-calc").on("click",()=>{Object(N.b)("Tools","Download pb calculator")}),t("#doubleClick-action").change(()=>this._doubleClickSelected()),t("#show-layer").change(()=>this._showLayerSelected()),t("#about").on("click",()=>{this._showAbout()})}_setupSvg(){this.svg=Object(l.select)("#na-map").append("svg").attr("id","na-svg"),this.svg.append("defs"),this._gMap=this.svg.append("g").classed("map",!0)}_setupProps(){t(`#doubleClick-action-${this._doubleClickAction}`).prop("checked",!0),t(`#show-layer-${this._showLayer}`).prop("checked",!0)}_storeDoubleClickActionSetting(){this._doubleClickAction===this._doubleClickActionDefault?_.a.remove(this._doubleClickActionCookieName):_.a.set(this._doubleClickActionCookieName,this._doubleClickAction)}_doubleClickSelected(){this._doubleClickAction=t("input[name='doubleClickAction']:checked").val(),this._storeDoubleClickActionSetting(),this._clearMap()}_storeShowLayerSetting(){this._showLayer===this._showLayerDefault?_.a.remove(this._showLayerCookieName):_.a.set(this._showLayerCookieName,this._showLayer)}_showLayerSelected(){this._showLayer=t("input[name='showLayer']:checked").val(),this._storeShowLayerSetting(),this._refreshLayer()}_refreshLayer(){const t="grid"===this._showLayer,e="teleport"===this._showLayer;this._grid.show=t,this._grid.update(),this._teleport.show=e,this._teleport.setData(),this._teleport.update()}_displayMap(t){const e=i(this._tileSize),s=i(this.coord.max)-e,h=this.width,l=this.height,p=n(this.coord.max*t.k<this.width?this.width-2*t.x:this.coord.max*t.k),m=n(this.coord.max*t.k<this.height?this.height-2*t.y:this.coord.max*t.k),u=i(t.k),_=o(s,a(i(r(p,m)))-e),g=d(10*_-10*u-10*s)/10,b=this._wheelDelta**g,f=t.x,y=t.y,S=this.coord.max*t.k<this.width?t.x:0,w=this.coord.max*t.k<this.height?t.y:0,D=Object(c.range)(r(0,n((0-f)/this._tileSize/b)),r(0,o(a((h-f-S)/this._tileSize/b),2**_))),v=[];Object(c.range)(r(0,n((0-y)/this._tileSize/b)),r(0,o(a((l-y-w)/this._tileSize/b),2**_))).forEach(t=>{D.forEach(e=>{v.push([e,t,_])})}),v.translate=[f,y],v.scale=b,this._updateMap(v)}_updateMap(t){const e=p.b.translate(d(t.translate[0]),d(t.translate[1])).scale(d(1e3*t.scale)/1e3),s=this._gMap.attr("transform",e).selectAll("image").data(t,t=>t);s.exit().remove(),s.enter().append("image").attr("xlink:href",t=>`images/map/${t[2]}/${t[1]}/${t[0]}.jpg`).attr("x",t=>t[0]*this._tileSize).attr("y",t=>t[1]*this._tileSize).attr("width",this._tileSize).attr("height",this._tileSize)}_clearMap(){this._windPrediction.clearMap(),this._journey.clearMap(),this._f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){const e="modal-about";document.getElementById(e)||function(t){Object(g.m)(t,`${g.b} <span class="text-primary small">v${g.c}</span>`,""),Object(l.select)(`#${t} .modal-body`).html(`<p>${g.a} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan <a href="https://bccnavalaction.freeforums.net/">British Captains’ Club (BCC)</a>.</p>`)}(e),t(`#${e}`).modal("show")}_doDoubleClickAction(t){const e=Object(l.mouse)(t),s=Object(p.c)(t),a=e[0],i=e[1],r=s.k,o=(a-s.x)/r,n=(i-s.y)/r;"f11"===this._doubleClickAction?this._f11.printCoord(o,n):this._journey.plotCourse(o,n),this.zoomAndPan(o,n,1)}_updateCurrent(){this._pbZone.refresh(),this._grid.update(),this._teleport.setData(),this._teleport.update(),this._ports.update(this._currentScale)}_setZoomLevelAndData(){l.event.transform.k!==this._currentScale&&(this._currentScale=l.event.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this._zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this._zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this._zoomLevel&&(this.zoomLevel="initial"),this._updateCurrent())}_naZoomed(){this._setZoomLevelAndData(),this._currentTranslate.x=d(l.event.transform.x),this._currentTranslate.y=d(l.event.transform.y);const t=p.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(b.w)(l.event.transform.k));this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._teleport.transform(t),this._journey.transform(t),this._pbZone.transform(t),this._f11.transform(t)}_initialZoomAndPan(){this.svg.call(this._zoom.scaleTo,this._minScale)}_init(){this.zoomLevel="initial",this._initialZoomAndPan(),this._refreshLayer(),this._ports.clearMap(this._minScale),this._f11.checkF11Coord()}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t,this._teleport.zoomLevel=t}resize(){const t=p.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setSvgSize(),this._displayMap(t),this._grid.update()}_getDimensions(){return document.getElementById("na-map").getBoundingClientRect()}_getWidth(){const t=this._getDimensions().width;return n(t)}_getHeight(){const t=this._getDimensions().top,e=document.documentElement.clientHeight-this.rem;return n(e-t)}_setSvgSize(){this.width=this._getWidth(),this.height=this._getHeight(),this._minScale=Object(b.t)(o(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this._minScale,this._zoomLevel="initial",this._zoom=Object(p.a)().wheelDelta(()=>-this._wheelDelta*Math.sign(l.event.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this._minScale,this.coord.min-this.xGridBackgroundHeight*this._minScale],[this.coord.max,this.coord.max]]).scaleExtent([this._minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this.svg.attr("width",this.width).attr("height",this.height).call(this._zoom)}zoomAndPan(t,e,s){const a=p.b.scale(s).translate(d(-t+this.width/2/s),d(-e+this.height/2/s));this.svg.call(this._zoom.transform,a)}goToPort(){"0"===this._ports.currentPort.id?this._initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)}}}).call(this,s(11))},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return d});var a=s(16),i=(s.n(a),s(0)),r=s(1),o=s(7),n=s(4);class d{constructor(t){this._buildingData=t,this._baseName="List buildings",this._baseId="building-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(o.b)("Tools",this._baseName),t.stopPropagation(),this._buildingListSelected()})}_injectModal(){Object(n.m)(this._modalId,this._baseName);const t=`${this._baseId}-select`,e=Object(i.select)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_getOptions(){return`${this._buildingData.map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}`}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._buildingSelected(t)).selectpicker({noneSelectedText:"Select building"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_getBuildingData(t){return this._buildingData.filter(e=>e.name===t)[0]}_getProductText(t){let e="";return Array.isArray(t.resource)?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.resource.map(t=>t.name).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.resource.name}</h5>`,t.resource.price&&(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.resource.price} reals per unit</td></tr>`,void 0!==t.batch&&(e+=`<tr><td>Batch of ${t.batch.amount} units at ${t.batch.price} reals</td></tr>`),e+="</tbody></table>")),e}_getRequirementText(t){let e="";return e+='<table class="table table-sm"><thead>',t.levels[0].materials.length?(e+="<tr><th>Level</th><th>Level build materials</th></tr>",e+="</thead><tbody>",t.levels.forEach((t,s)=>{e+=`<tr><td>${s}</td><td class="text-left">`,e+=t.materials.map(t=>`${Object(r.m)(t.amount)} ${t.item}`).join("<br>"),e+="</td></tr>"})):(e+="<tr><th>Level</th><th>Production (units)</th><th>Labour cost (%)</th><th>Storage (units)</th><th>Level build price (reals)</th></tr>",e+="</thead><tbody>",t.levels.forEach((t,s)=>{e+=`<tr><td>${s}</td><td>${Object(r.m)(t.production)}</td><td>${Object(r.m)(-100*t.labourDiscount)}</td><td>${Object(r.m)(t.maxStorage)}</td><td>${Object(r.m)(t.price)}</td></tr>`})),e+="</tbody></table>"}_getText(t){const e=this._getBuildingData(t);let s='<div class="row no-gutters card-deck">';return s+='<div class="card col-4"><div class="card-header">Product</div>',s+='<div class="card-body product">',s+=this._getProductText(e),s+="</div></div>",s+='<div class="card col-8"><div class="card-header">Requirements</div>',s+='<div class="card-body px-0 requirements">',s+=this._getRequirementText(e),s+="</div></div>",s+="</div>"}_buildingSelected(e){const s=t(e.currentTarget).find(":selected").val();Object(i.select)(`#${this._baseId} div`).remove(),Object(i.select)(`#${this._baseId}`).append("div").classed("buildings mt-4",!0),Object(i.select)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Number.isNaN;(function(t){s.d(e,"a",function(){return u});var i=s(68),r=(s.n(i),s(16)),o=(s.n(r),s(69)),n=(s.n(o),s(39)),d=(s.n(n),s(0)),h=s(33),c=s.n(h),l=s(4),p=s(1),m=s(7);String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};class u{constructor(t){this._cannonData=t,this._baseName="List cannons",this._baseId="cannon-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._groups=["damage","dispersion","generic","crew"],this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(m.b)("Tools",this._baseName),t.stopPropagation(),this._cannonListSelected()})}_injectModal(){Object(l.m)(this._modalId,this._baseName);const t=Object(d.select)(`#${this._modalId} .modal-body`);["medium","long","carronade"].forEach(e=>{t.append("h5").text(Object(p.b)(e)),t.append("div").attr("id",`${e}-list`).attr("class","modules")})}_initTablesort(){const t=t=>t.replace(/[^\-?0-9.]/g,""),e=(t,e)=>{let s=parseFloat(t),i=parseFloat(e);return(s=a(s)?0:s)-(i=a(i)?0:i)};c.a.extend("number",t=>t.match(/^[-+]?[£\x24Û¢´€]?\d+\s*([,.]\d{0,2})/)||t.match(/^[-+]?\d+\s*([,.]\d{0,2})?[£\x24Û¢´€]/)||t.match(/^[-+]?(\d)*-?([,.])?-?(\d)+([E,e][-+][\d]+)?%?$/),(s,a)=>{const i=t(s),r=t(a);return e(r,i)})}_initModal(){this._initTablesort(),this._injectModal(),["medium","long","carronade"].forEach(t=>{this._injectList(t)})}_cannonListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_injectList(e){t(`#${e}-list`).append(this._getList(e));const s=document.getElementById(`table-${e}-list`);new c.a(s)}_getModifiers(t){const e=new Set;return this._cannonData[t].forEach(t=>{this._groups.forEach(s=>{Object.entries(t[s]).forEach(([t])=>{e.add(`${s} ${t}`)})})}),Array.from(e).sort()}_getList(t){const e=this._getModifiers(t);let s="";return s+=`<table id="table-${t}-list" class="table table-sm small tablesort"><thead><tr><th data-sort-default>Pounds</th>`,e.forEach(t=>{const e=Object(p.b)(t.replace("generic ","").replace("damage basic","damage").replace("damage penetration","penetration"));s+=`<th>${e}</th>`}),s+="</tr></thead><tbody>",this._cannonData[t].forEach(t=>{const a=t.name.replace(" (","<br>(").replaceAll(" "," ");s+=`<tr><td class="text-right" data-sort="${parseInt(t.name,10)}">${a}</td>`,e.forEach(e=>{this._groups.forEach(a=>{Object.entries(t[a]).forEach(([t,i])=>{`${a} ${t}`===e&&(s+=`<td class="text-right" data-sort="${i||0}">${i?Object(p.l)(i):""}</td>`)})})}),s+="</tr>"}),s+="</tbody></table>"}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Number.isNaN;(function(t){s.d(e,"a",function(){return d});var i=s(0),r=s(1),o=s(4),n=s(7);class d{constructor(t,e){this._map=t,this._coord=e,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(i.select)("#na-svg").insert("g").classed("f11",!0)}_setupListener(){t("#f11").submit(t=>{Object(n.b)("Menu","Move to F11"),this._f11Submitted(),t.preventDefault()}),t("#copy-coord").click(()=>{Object(n.b)("Menu","Copy F11 coordinates"),this._copyCoordClicked()})}static getXCoord(){return+t("#x-coord").val()}static getZCoord(){return+t("#z-coord").val()}_f11Submitted(){const t=-1e3*d.getXCoord(),e=-1e3*d.getZCoord();this._goToF11(t,e)}static _copyF11ToClipboard(e){const s=t("<input>");t("body").append(s),s.val(e).select(),document.execCommand("copy"),s.remove()}_copyCoordClicked(){const t=d.getXCoord(),e=d.getZCoord();if(!a(t)&&!a(e)){const s=new URL(window.location);s.searchParams.set("x",t),s.searchParams.set("z",e),this.constructor._copyF11ToClipboard(s)}}_printF11Coord(t,e,s,a){const i=this._g.append("g").attr("transform",`translate(${t},${e})`);i.append("circle").attr("r",10),i.append("text").attr("dx","-.6em").attr("dy","-.5em").text(Object(r.j)(s)),i.append("text").attr("dx","-.6em").attr("dy",".5em").text(Object(r.j)(a))}_goToF11(t,e){const s=+t,a=+e,i=Object(o.e)(s,a),n=Object(o.f)(s,a);Object(r.a)(i,this._coord.min,this._coord.max,!0)&&Object(r.a)(n,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(i,n,s,a),this._map.zoomAndPan(i,n,1))}checkF11Coord(){const t=new URL(document.location).searchParams;if(t.has("x")&&t.has("z")){const e=-1e3*+t.get("x"),s=-1e3*+t.get("z");Object(n.b)("Menu","Paste F11 coordinates"),this._goToF11(e,s)}else history.pushState("","",window.location.pathname)}printCoord(t,e){const s=Object(o.g)(t,e),a=Object(o.h)(t,e);this._printF11Coord(t,e,s,a)}transform(t){this._g.attr("transform",t)}clearMap(){this._g.selectAll("*").remove()}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Math.round;s.d(e,"a",function(){return h});var i=s(18),r=s(0),o=s(9),n=s(1),d=s(4);class h{constructor(t){this._map=t,this._isShown=!0,this._minCoord=this._map.coord.min,this._maxCoord=this._map.coord.max,this._height=this._map.height,this._width=this._map.width,this._defaultFontSize=this._map.rem,this._textPadding=this._defaultFontSize/2,this._xBackgroundHeight=this._map.xGridBackgroundHeight,this._yBackgroundWidth=this._map.yGridBackgroundWidth,this._setupSvg()}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){this._xScale=Object(o.scaleLinear)().clamp(!0).domain([Object(d.g)(this._minCoord,this._minCoord),Object(d.g)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord]),this._yScale=Object(o.scaleLinear)().clamp(!0).domain([Object(d.h)(this._minCoord,this._minCoord),Object(d.h)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord])}_setupAxis(){const t=this._getTicks(65);this._xAxis=Object(i.a)(this._xScale).tickFormat(n.j).tickValues(t).tickSize(this._maxCoord),this._yAxis=Object(i.c)(this._yScale).tickFormat(n.j).tickValues(t).tickSize(this._maxCoord),this._gAxis=this._map.svg.append("g").classed("axis d-none",!0),this._gXAxis=this._gAxis.append("g").classed("axis-x",!0),this._gYAxis=this._gAxis.append("g").classed("axis-y",!0),this._setupBackground(),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=a(Object(d.h)(this._minCoord,this._minCoord)),s=a(Object(d.h)(this._maxCoord,this._maxCoord)),i=(s-e)/(t-1),r=[];for(let t=i;t<s;t+=i)r.push(a(t));r.push(s);const o=r.slice(0).reverse().map(t=>-t);return o.push(0),o.concat(r)}_setupXAxis(){this._gXAxis.selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),this._gXAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){this._gYAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null),this._gYAxis.selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){this._displayXAxis(),this._displayYAxis()}_displayXAxis(){const t=r.event?r.event.transform.k:1,e=r.event?r.event.transform.y:0,s=e/t<this._width?e/t:0;this._gXAxis.call(this._xAxis.tickPadding(-this._maxCoord-s)),this._gXAxis.attr("font-size",Object(n.w)(this._defaultFontSize/t)).attr("stroke-width",Object(n.w)(1/t)),this._gXAxis.select(".domain").remove()}_displayYAxis(){const t=r.event?r.event.transform.k:1,e=r.event?r.event.transform.x:0,s=e/t<this._height?e/t:0;this._gYAxis.call(this._yAxis.tickPadding(-this._maxCoord-s)),this._gYAxis.attr("font-size",Object(n.w)(this._defaultFontSize/t)).attr("stroke-width",Object(n.w)(1/t)),this._gYAxis.select(".domain").remove()}_setupBackground(){this._gBackground=this._map.svg.insert("g","g.axis").classed("grid-background d-none",!0),this._gBackground.append("rect").attr("height",this._xBackgroundHeight).attr("width",this._width),this._gBackground.append("rect").attr("height",this._height).attr("width",this._yBackgroundWidth)}set show(t){this._isShown=t}set zoomLevel(t){this._zoomLevel=t}update(){let t=!1,e=0;this._isShown&&"initial"!==this._zoomLevel&&(t=!0,e=this._xBackgroundHeight),this._gAxis.classed("d-none",!t),this._gBackground.classed("d-none",!t),Object(r.select)("#port-summary").style("margin-top",`${e}px`),Object(r.select)("#journey-summary").style("margin-top",`${e}px`)}transform(t){this._gAxis.attr("transform",t),this._displayAxis()}}},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return d});var a=s(16),i=(s.n(a),s(0)),r=s(1),o=s(7),n=s(4);class d{constructor(t,e){this._ingredientData=t,this._moduleData=e,this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(o.b)("Tools",this._baseName),t.stopPropagation(),this._ingredientListSelected()})}_injectModal(){Object(n.m)(this._modalId,this._baseName),Object(i.select)(`#${this._modalId} .modal-body`).append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_getProperties(t){let e="",s="",a="";return this._moduleData.forEach(e=>{e[1].filter(e=>e.name===t).forEach(t=>{s=e[0],a=`<tr><td>${t.properties.map(t=>{const e=t.absolute?t.amount:Object(r.p)(t.amount/100);return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`})}),e=`<h6 class='text-muted text-left'>${s}</h6>`,e+=`<table class='table table-sm'><tbody>${a}</tbody></table>`}_getRows(){return this._ingredientData.map(t=>`<tr><td>${t.name}</td><td>${t.recipe.map(t=>`<a data-toggle="tooltip" data-html="true" title="${this._getProperties(t)}">${t}</a>`).join("<br>")}</td></tr>`)}_getText(){const t=this._getRows(),e=Object(r.d)(t,2);let s="";return Array.from(Array(e.length).keys()).forEach(t=>{s+=`<div class="col-md-${Math.floor(12/e.length)}">`,s+='<table class="table table-sm"><thead>',s+="<tr><th>Ingredient</th><th>Recipe</th></tr></thead><tbody>",s+=e[t].join(""),s+="</tbody></table></div>"}),s}_injectList(){Object(i.select)(`#${this._baseId} div`).remove(),Object(i.select)(`#${this._baseId}`).append("div").classed("row ingredients",!0),Object(i.select)(`#${this._baseId} div`).html(this._getText()),t('[data-toggle="tooltip"]').tooltip()}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Math.max,i=Math.round;(function(t){s.d(e,"a",function(){return $});var r=s(54),o=(s.n(r),s(16)),n=(s.n(o),s(44)),d=(s.n(n),s(2)),h=s(24),c=s(9),l=s(0),p=s(12),m=s(19),u=s(8),_=s.n(u),g=s(55),b=(s.n(g),s(71)),f=(s.n(b),s(72)),y=(s.n(f),s(1)),S=s(7),w=s(43),D=s(32),v=s(4);class ${constructor(t,e,s){this._shipData=t,this._woodData=e,this._fontSize=s,this._compassSize=100,this._line=Object(p.e)().x(t=>t[0]).y(t=>t[1]),this._drag=Object(h.a)().on("start",(t,e,s)=>{this._removeLabels(),Object(l.select)(s[e]).classed("drag-active",!0)}).on("drag",(t,e,s)=>{0===e&&this._compass.attr("x",t.position[0]+l.event.dx).attr("y",t.position[1]+l.event.dy),Object(l.select)(s[e]).attr("cx",l.event.x).attr("cy",l.event.y),t.position=[t.position[0]+l.event.dx,t.position[1]+l.event.dy],this._printLines()}).on("end",(t,e,s)=>{Object(l.select)(s[e]).classed("drag-active",!1),this._printJourney()}),this._labelPadding=20,this._minutesForFullCircle=48,this._fullCircle=360,this._degreesPerMinute=this._fullCircle/this._minutesForFullCircle,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(c.scaleLinear)().domain(Object(d.range)(0,this._fullCircle,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._shipId="ship-journey",this._woodId="wood-journey",this._setupSummary(),this._setupSvg(),this._initJourney(),this._setupListener()}_setupSvg(){this._g=Object(l.select)("#na-svg").insert("g","g.pb").classed("coord",!0),Object(l.select)("#na-svg defs").append("marker").attr("id","course-arrow").attr("viewBox","0 -5 10 10").attr("refX",8).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("class","course-head")}_initJourney(){this._journey={shipName:this._defaultShipName,woodNames:"",startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segment:[{position:[null,null],label:""}]}}_resetJourney(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(t){Object(S.b)("Menu","Journey"),t.stopPropagation(),this._journeySelected()}_setupListener(){document.getElementById("journeyNavbar").addEventListener("click",t=>this._navbarClick(t)),document.getElementById(this._buttonId).addEventListener("click",()=>this._deleteLastLeg())}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const s=e.call(this);return this.container.append(this.tooltip),s},window.tooltip=(t=>Object(y.g)(t.value)),t("#journey-wind-direction").roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/y.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t("#journey-wind-direction").roundSlider("getValue")}})}_injectModal(){Object(v.m)(this._modalId,this._baseName,"sm");const t=Object(l.select)(`#${this._modalId} .modal-body`).append("form").append("div").attr("class","form-group"),e=t.append("div").classed("alert alert-primary",!0).attr("role","alert");e.append("label").attr("for","journey-wind-direction").text("Current in-game wind"),e.append("div").attr("id","journey-wind-direction").attr("class","rslider");const s=`${this._shipId}-Base-select`,a=t.append("div").classed("alert alert-primary",!0).attr("role","alert").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",s).text("Ship and woods (optional)"),a.append("select").attr("name",s).attr("id",s),["frame","trim"].forEach(t=>{const e=`${this._woodId}-${t}-Base-select`;a.append("label").attr("for",e),a.append("select").attr("name",e).attr("id",e)})}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new w.a(this._shipData,this._woodData,this._shipId),this._woodCompare=new D.a(this._woodData,this._woodId)}_useUserInput(){this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").on("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segment[0].position[0],e=this._journey.segment[0].position[1];this._compass=this._g.append("image").classed("compass",!0).attr("x",t).attr("y",e).attr("transform",`translate(${-this._compassSize/2},${-this._compassSize/2})`).attr("height",this._compassSize).attr("width",this._compassSize).attr("xlink:href","icons/compass.svg"),this._gJourneyPath=this._g.append("path")}_getSpeedAtDegrees(t){return a(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const s=(this._fullCircle-t+e)%this._fullCircle;return this._getSpeedAtDegrees(s)*this._owSpeedFactor*v.o}_getStartWind(){const e=t("#journey-wind-direction").roundSlider("getValue");let s;return s=t("#journey-wind-direction").length?+e:0}_setShipSpeed(){let t=[];t=this._journey.shipName===this._defaultShipName?Array.from(Array(24).fill(this._defaultShipSpeed/2)):this._shipCompare._singleShipData.speedDegrees,this._speedScale.range(t)}_calculateMinutesForSegment(t,e,s){let a=s,i=e,r=0;for(this._setShipSpeed();0<a;){const e=this._calculateDistanceForSection(t,i);a>e?(a-=e,r+=1):(r+=a/e,a=0),i=(this._fullCircle+i-this._degreesPerMinute)%this._fullCircle}return this._journey.currentWindDegrees=i,r}_setShipName(){void 0!==this._shipCompare&&void 0!==this._shipCompare._singleShipData&&void 0!==this._shipCompare._singleShipData.name?(this._journey.shipName=`${this._shipCompare._singleShipData.name}`,this._journey.woodNames=`${this._shipCompare._woodCompare._woodsSelected.Base.frame}/${this._shipCompare._woodCompare._woodsSelected.Base.trim}`):(this._journey.shipName=this._defaultShipName,this._journey.woodNames="")}_removeLabels(){const t=this._g.selectAll("g.coord g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(m.c)(Object(l.select)("#na-svg").node()),e=a(1,t.k),s=this._fontSize/e,i=this._compassSize/e,r=m.b.translate(20/e,20/e),o=this._labelPadding/e;this._g.selectAll("g.coord g.label").each((t,a,i)=>{const n=Object(l.select)(i[a]),d=n.select("text"),h=t.label.split("|");d.text("").attr("dy",0).attr("transform",r).style("font-size",`${s}px`),h.forEach((t,e)=>{const a=d.append("tspan").text(t);0<e&&a.attr("x",0).attr("dy",1.3*s)});const c=d.node().getBBox(),p=t.label?c.width+2*o:0,m=t.label?c.height+o:0;n.select("rect").attr("width",p).attr("height",m);const u=n.select("circle").attr("r",10/e).attr("class","");n.append(()=>u.remove().node()),(0===a||a===i.length-1)&&u.attr("r",20).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",`${5/e}px`),this._compass&&this._compass.attr("transform",`translate(${-i/2},${-i/2})`).attr("height",i).attr("width",i)}_printLabels(){const t=Object(n.layoutTextLabel)().padding(this._labelPadding).value(t=>{const e=t.label.split("|");return e[e.reduce((t,e,s,a)=>a[t].length>e.length?t:s,0)]}),e=Object(n.layoutAnnealing)(),s=Object(n.layoutLabel)(e).size((t,e,s)=>{const a=t.label.split("|").length,i=s[e].getElementsByTagName("text")[0].getBBox();return[i.width+2*this._labelPadding,i.height*a+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segment.map(t=>t)).call(s)}_setupSummary(){this._divJourneySummary=Object(l.select)("main").append("div").attr("id","journey-summary").classed("journey-summary overlay d-none",!0);const t=this._divJourneySummary.append("div").classed("d-flex justify-content-around align-items-end",!0);this._journeySummaryShip=t.append("div").classed("block",!0),this._journeySummaryTextWoods=this._journeySummaryShip.append("div"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").classed("des",!0).text("selected ship"),this._journeySummaryWind=t.append("div").classed("block",!0),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").classed("des",!0).text("wind direction"),t.append("button").attr("id",this._buttonId).classed("btn btn-primary btn-sm",!0).attr("role","button").text("Delete last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(l.select)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextWoods.text(this._journey.woodNames),this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.text(`From ${Object(y.g)(this._journey.startWindDegrees)}`)}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(1<this._journey.segment.length?this._journey.segment.map(t=>t.position):[[null,null]]).attr("marker-end","url(#course-arrow)").attr("d",this._line)}_getTextDirection(t,e,s){return`${t} (${i(e)}°) ☆ F11: ${Object(y.j)(Object(v.g)(s.x,s.y))} / ${Object(y.j)(Object(v.h)(s.x,s.y))}`}_getTextDistance(t,e,s){_.a.locale("en-gb");const a=_.a.duration(e,"minutes").humanize(!0);let r=`${i(t)}k ${a}`;if(s){const t=_.a.duration(this._journey.totalMinutes,"minutes").humanize(!0);r+=` ☆ total ${i(this._journey.totalDistance)}k ${t}`}return r}_setSegmentLabel(t=this._journey.segment.length-1){const e={x:this._journey.segment[t].position[0],y:this._journey.segment[t].position[1]},s={x:this._journey.segment[t-1].position[0],y:this._journey.segment[t-1].position[1]},a=Object(y.v)(e,s),i=Object(v.k)(e,s),r=Object(y.g)(a),o=this._calculateMinutesForSegment(a,this._journey.currentWindDegrees,1e3*i);this._journey.totalDistance+=i,this._journey.totalMinutes+=o;const n=this._getTextDirection(r,a,e),d=this._getTextDistance(i,o,1<t);this._journey.segment[t].label=`${n}|${d}`}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourney(),this._journey.segment.forEach((t,e)=>{e<this._journey.segment.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segment.pop(),this._journey.segment.length?this._printJourney():this.clearMap()}setSummaryPosition(t,e){this._divJourneySummary.style("top",`${t}px`).style("right",`${e}px`)}plotCourse(t,e){this._journey.segment[0].position[0]?(this._journey.segment.push({position:[t,e],label:""}),this._printSegment()):(this.clearMap(),this._journey.segment[0]={position:[t,e],label:""},this._resetJourney(),this._showSummary(),this._printSummary(),this._printCompass())}transform(t){this._g.attr("transform",t),this._correctJourney()}clearMap(){this._initJourney(),this._hideSummary(),this._g.selectAll("*").remove()}}}).call(this,s(11))},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return d});var a=s(16),i=(s.n(a),s(0)),r=s(1),o=s(7),n=s(4);class d{constructor(t){this._moduleData=t,this._baseName="List modules",this._baseId="module-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(o.b)("Tools",this._baseName),t.stopPropagation(),this._moduleListSelected()})}_injectModal(){Object(n.m)(this._modalId,this._baseName);const t=`${this._baseId}-select`,e=Object(i.select)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_getOptions(){return`${this._moduleData.map(t=>`<option value="${t[0]}"">${t[0]}</option>;`).join("")}`}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._moduleSelected(t)).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_getRows(t){function e(t){return"U"===t?"":` ${s.get(t)}`}const s=new Map([["L",`${Object(r.r)(1)} – ${Object(r.r)(3)}`],["M",`${Object(r.r)(4)} – ${Object(r.r)(5)}`],["S",`${Object(r.r)(6)} – ${Object(r.r)(7)}`]]);let a="";const i=[];return this._moduleData.forEach(s=>{s[0]===t&&s[1].forEach((t,o)=>{function n(e){return e<s[1].length&&t.name===s[1][e].name&&JSON.stringify(t.properties)===JSON.stringify(s[1][e].properties)}a=e(t.moduleLevel),n(o+1)&&(s[1][o+1].hasSamePropertiesAsPrevious=!0,a+=`<br>${e(s[1][o+1].moduleLevel)}`),n(o+2)&&(s[1][o+2].hasSamePropertiesAsPrevious=!0,a=""),void 0!==t.hasSamePropertiesAsPrevious&&t.hasSamePropertiesAsPrevious||i.push(`<tr><td><span class="name">${t.name}</span><br>${a}</td><td>${t.properties.map(t=>{const e=t.absolute?t.amount:Object(r.p)(t.amount/100);return`${t.modifier} ${e}`}).join("<br>")}</td></tr>`)})}),i}_getText(t){const e=this._getRows(t),s=Object(r.d)(e,3);let a="";return Array.from(Array(s.length).keys()).forEach(t=>{a+=`<div class="col-md-${Math.floor(12/s.length)}">`,a+='<table class="table table-sm small"><thead>',a+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",a+=s[t].join(""),a+="</tbody></table></div>"}),a}_moduleSelected(e){const s=t(e.currentTarget).find(":selected").val();Object(i.select)(`#${this._baseId} div`).remove(),Object(i.select)(`#${this._baseId}`).append("div").classed("row modules mt-4",!0),Object(i.select)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s(11))},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return n});var a=s(34),i=s(0),r=s(13),o=s.n(r);class n{constructor(t,e,s,a,i){this._ports=i,this._pbCircleDataDefault=t,this._pbCircleData=t,this._fortDataDefault=e,this._fortData=e,this._towerDataDefault=s,this._towerData=s,this._joinCircleDataDefault=a,this._joinCircleData=a,this._showPBCookieName="na-map--show-pb",this._showPBDefault="all",this._showPB=this._getShowPBSetting(),this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(i.select)("#na-svg").insert("g","g.ports").classed("pb",!0),this._gJoinCirclesInner=this._g.append("path").classed("join-circle",!0),this._gJoinCirclesOuter=this._g.append("path").classed("join-circle",!0),this._gPBCircles=this._g.append("path").classed("pb-circle",!0),this._gTowers=this._g.append("path").classed("tower",!0),this._gForts=this._g.append("path").classed("fort",!0)}_setupListener(){t("#show-pb").change(()=>this._showPBZonesSelected())}_getShowPBSetting(){let e=o.a.get(this._showPBCookieName);return e=void 0===e?this._showPBDefault:e,t(`#show-pb-${e}`).prop("checked",!0),e}_storeShowPBSetting(){this._showPB===this._showPBDefault?o.a.remove(this._showPBCookieName):o.a.set(this._showPBCookieName,this._showPB)}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this._showPB=t("input[name='showPB']:checked").val(),this._storeShowPBSetting(),this._refreshPBZones()}_update(){this._gPBCircles.datum(this._pbCircleData).attr("d",Object(a.a)().pointRadius(3.5)),this._gTowers.datum(this._towerData).attr("d",Object(a.a)().pointRadius(1.5)),this._gForts.datum(this._fortData).attr("d",Object(a.a)().pointRadius(2)),this._gJoinCirclesInner.datum(this._joinCircleData).attr("d",Object(a.a)().pointRadius(14)),this._gJoinCirclesOuter.datum(this._joinCircleData).attr("d",Object(a.a)().pointRadius(28))}_isPortIn(t){return"all"===this._showPB||"single"===this._showPB&&t.id===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"noShow"!==this._showPB?(this._pbCircleData={type:"FeatureCollection",features:this._pbCircleDataDefault.filter(t=>this._isPortIn(t))},this._fortData={type:"FeatureCollection",features:this._fortDataDefault.filter(t=>this._isPortIn(t))},this._towerData={type:"FeatureCollection",features:this._towerDataDefault.filter(t=>this._isPortIn(t))},this._joinCircleData={type:"FeatureCollection",features:this._joinCircleDataDefault.filter(t=>this._isPortIn(t))}):(this._pbCircleData={},this._fortData={},this._towerData={},this._joinCircleData={})}refresh(){this._setData(),this._update()}transform(t){this._g.attr("transform",t)}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Math.floor;(function(t){s.d(e,"a",function(){return g});var i=s(16),r=(s.n(i),s(69)),o=(s.n(r),s(39)),n=(s.n(o),s(86)),d=(s.n(n),s(2)),h=s(18),c=s(9),l=s(0),p=s(12),m=s(95),u=s(7),_=s(4);String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)};class g{constructor(t,e){this._ownershipData=t,this._nationData=e,this._baseName="Port ownership",this._baseId="ownership-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._colourScale=Object(c.scaleOrdinal)().range(["#72823a","#825fc8","#78b642","#cd47a3","#50b187","#d34253","#628bcc","#cb9f3d","#cc88c9","#ca5b2b","#b55576","#c27b58"]),this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(u.b)("Tools",this._baseName),t.stopPropagation(),this._ownershipListSelected()})}_injectModal(){Object(_.m)(this._modalId,this._baseName);const t=`${this._baseId}-select`,e=Object(l.select)(`#${this._modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t);const s=e.append("div").attr("id",`${this._baseId}`);this._div=s.append("div"),this._svg=s.append("svg").attr("class","area")}_getOptions(){return`${this._ownershipData.map(t=>`<option value="${t.region}">${t.region}</option>;`).join("")}`}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._regionSelected(t)).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let e=!1;document.getElementById(this._modalId)||(e=!0,this._initModal()),t(`#${this._modalId}`).on("shown.bs.modal",()=>{e&&(this._injectArea(),e=!1)}).modal("show")}static getHeight(){return a(.75*top.innerHeight)}_getWidth(){return a(document.getElementById(this._baseId).offsetWidth)}_injectArea(){const t=t=>new Date(t.date),e=this._getWidth(),s=Math.min(1e3,g.getHeight()),a=32,i=32,r=32,o=_.n.filter(t=>9!==t.id).map(t=>t.short),l=this._nationData;l.keys=o;const m=Object(p.h)().offset(p.i).keys(l.keys)(l),u=()=>{const o=Object(c.scaleLinear)().domain(Object(d.extent)(l,e=>t(e))).range([r,e-a]),n=Object(c.scaleLinear)().domain([Object(d.min)(m[0],t=>t[0]),Object(d.max)(m[m.length-1],t=>t[1])]).range([s-i,0]);return Object(p.b)().x(e=>o(t(e.data))).y0(t=>n(t[0])).y1(t=>n(t[1])).curve(p.c)};this._svg.attr("width",e).attr("height",s),(()=>{const t=u(),e=new Map(_.n.map(t=>[t.short,t.name]));this._colourScale.domain(l.keys),this._svg.selectAll("path").data(m).enter().append("path").attr("fill",t=>this._colourScale(t.key)).attr("stroke",t=>this._colourScale(t.key)).attr("d",t),this._svg.selectAll(".area-label").data(m).enter().append("text").attr("class","area-label").text(t=>e.get(t.key)).attr("transform",Object(n.areaLabel)(t))})(),this._svg.append("g").call(o=>{const n=Object(c.scaleTime)().domain(Object(d.extent)(l,e=>t(e))).range([r,e-a]);o.attr("transform",`translate(0,${s-i})`).call(Object(h.a)(n).ticks(e/80).tickSizeOuter(0))})}_injectChart(t){Object(m.a)().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(e){const s=t(e.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const a=this._ownershipData.filter(t=>t.region===s).map(t=>t.data)[0];this._injectChart(a)}}}).call(this,s(11))},,function(t,e,s){"use strict";var a=Math.abs,i=Math.log2,r=Math.round;(function(t){s.d(e,"a",function(){return f});var o=s(16),n=(s.n(o),s(2)),d=s(9),h=s(0),c=s(13),l=s.n(c),p=s(8),m=s.n(p),u=s(55),_=(s.n(u),s(4)),g=s(1),b=s(88);class f{constructor(t,e,s){this._portDataDefault=t,this._portData=t,this._pbData=e,this._map=s,this._serverName=this._map._serverName,this._minScale=this._map._minScale,this._scale=this._minScale,this.f11=this._map._f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this._triangulatePosition=new b.a(this),this._currentPort={id:"366",coord:{x:4396,y:2494}},this._zoomLevel="initial",this._showPBZones="all",this._highlightId=null,this._highlightDuration=200,this._iconSize=48,this._fontSize=_.j,this._circleSize=_.i,this._showRadius="attack",this._taxIncomeRadius=Object(d.scaleLinear)(),this._netIncomeRadius=Object(d.scaleLinear)(),this._attackRadius=Object(d.scaleLinear)().domain([0,1]),this._colourScale=Object(d.scaleLinear)().domain([0,.1,.5,1]).range(["#eaeded","#8b989c","#6b7478","#a62e39"]),this._minRadiusFactor=1,this._maxRadiusFactor=6,this._showRadiusCookieName="na-map--show-radius",this._showRadiusDefault="attack",this._showRadius=this._getShowRadiusSetting(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags()}_setupListener(){t("#show-radius").change(()=>this._showRadiusSelected())}_getShowRadiusSetting(){let e=l.a.get(this._showRadiusCookieName);return e=void 0===e?this._showRadiusDefault:e,t(`#show-radius-${e}`).prop("checked",!0),e}_storeShowRadiusSetting(){this._showRadius===this._showRadiusDefault?l.a.remove(this._showRadiusCookieName):l.a.set(this._showRadiusCookieName,this._showRadius)}_showRadiusSelected(){this._showRadius=t("input[name='showRadius']:checked").val(),this._storeShowRadiusSetting(),this.update()}_setupSvg(){this._gPort=Object(h.select)("#na-svg").insert("g","g.f11").classed("ports",!0),this._gRegion=this._gPort.append("g").classed("region",!0),this._gCounty=this._gPort.append("g").classed("county",!0),this._gPortCircle=this._gPort.append("g").classed("port-circles",!0),this._gIcon=this._gPort.append("g").classed("port",!0),this._gText=this._gPort.append("g").classed("port-names",!0)}_setupCounties(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Cuidad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}]}_setupRegions(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3300,3100],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]}_setupSummary(){this._divPortSummary=Object(h.select)("main").append("div").attr("id","port-summary").attr("class","port-summary overlay");const t=this._divPortSummary.append("div").attr("class","d-flex justify-content-around align-items-end");this._portSummaryNumPorts=t.append("div").classed("block",!0),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").classed("des",!0).text("selected ports"),this._portSummaryTaxIncome=t.append("div").classed("block",!0),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").classed("des",!0).text("tax income"),this._portSummaryNetIncome=t.append("div").classed("block",!0),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").classed("des",!0).text("net income")}_setupFlags(){const t=Object(h.select)("#na-svg defs");_.n.map(t=>t.short).forEach(e=>{const s=t.append("pattern").attr("id",e).attr("width","133%").attr("height","100%").attr("viewBox",`6 6 ${this._iconSize} ${.75*this._iconSize}`);s.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",`icons/${e}.svg`),s.append("rect").attr("height",this._iconSize).attr("width",this._iconSize).attr("class","nation");const a=t.append("pattern").attr("id",`${e}a`).attr("width","133%").attr("height","100%").attr("viewBox",`6 6 ${this._iconSize} ${.75*this._iconSize}`);a.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",`icons/${e}.svg`),a.append("rect").attr("height",this._iconSize).attr("width",this._iconSize).attr("class","all")});const e=t.append("filter").attr("id","drop-shadow").attr("width","200%").attr("height","200%");e.append("feGaussianBlur").attr("in","SourceAlpha").attr("stdDeviation",5).attr("result","blur"),e.append("feOffset").attr("dx",2).attr("dy",4).attr("result","offsetblur1"),e.append("feOffset").attr("dx",3).attr("dy",6).attr("result","offsetblur2").attr("in","blur"),e.append("feComponentTransfer").attr("result","shadow1").attr("in","offsetblur1").append("feFuncA").attr("type","linear").attr("slope","0.1"),e.append("feComponentTransfer").attr("result","shadow2").attr("in","offsetblur2").append("feFuncA").attr("type","linear").attr("slope","0.1"),e.append("feComposite").attr("in2","offsetblur1").attr("operator","in");const s=e.append("feMerge");s.append("feMergeNode").attr("in","shadow1"),s.append("feMergeNode").attr("in","shadow2"),s.append("feMergeNode").attr("in","SourceGraphic")}_getPortName(t){return this._portDataDefault.filter(e=>e.id===t).map(t=>t.properties.name)[0]}_getText(t,e){m.a.locale("en-gb");const s=this._pbData.ports.filter(e=>e.id===t)[0],a=m.a.utc(s.portBattle).local(),i=m.a.utc(s.portBattle),r={name:e.name,icon:s.nation,availableForAll:e.availableForAll?"(accessible to all nations)":"",depth:e.shallow?"Shallow":"Deep",county:(""===e.county?"":`${e.county} / `)+e.region,countyCapital:e.countyCapital?" (county capital)":"",nonCapturable:e.nonCapturable,captured:s.capturer?` captured by ${s.capturer} ${m.a.utc(s.lastPortBattle).fromNow()}`:"",lastPortBattle:s.lastPortBattle,attack:s.attackHostility?`${s.attackerClan} (${s.attackerNation}) attack${s.portBattle.length?`${i.isAfter(m.a.utc())?"s":"ed"} ${i.fromNow()} at ${i.format("H.mm")}${i===a?"":` (${a.format("H.mm")} local)`}`:`s: ${Object(g.n)(s.attackHostility)} hostility`}`:"",pbTimeRange:e.nonCapturable?"":e.portBattleStartTime?`${(e.portBattleStartTime+10)%24}.00 – ${(e.portBattleStartTime+13)%24}.00`:"11.00 – 8.00",brLimit:Object(g.m)(e.brLimit),conquestMarksPension:e.conquestMarksPension,taxIncome:Object(g.o)(e.taxIncome),portTax:Object(g.n)(e.portTax),netIncome:Object(g.o)(e.netIncome),tradingCompany:e.tradingCompany?`, trading company level ${e.tradingCompany}`:"",laborHoursDiscount:e.laborHoursDiscount?`, labor hours discount level ${e.laborHoursDiscount}`:"",producesTrading:e.producesTrading.join(", "),dropsTrading:e.dropsTrading.join(", "),producesNonTrading:e.producesNonTrading.join(", "),dropsNonTrading:e.dropsNonTrading.join(", "),consumesTrading:e.consumesTrading.join(", "),consumesNonTrading:e.consumesNonTrading.join(", "),tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:e.goodsToSellInTradePort?e.goodsToSellInTradePort.join(", "):"",goodsToBuyInTradePort:e.goodsToBuyInTradePort?e.goodsToBuyInTradePort.join(", "):""};switch(e.portBattleType){case"Large":r.pbType="1<sup>st</sup>";break;case"Medium":r.pbType="4<sup>th</sup>";break;default:r.pbType="6<sup>th</sup>"}return r}_showDetails(e,s,a){const i=Object(h.select)(a[s]),r=function(t){let e=`<table><tbody<tr><td><i class="flag-icon ${t.icon}"></i></td>`;return e+=`<td><span class="port-name">${t.name}</span>`,e+=` ${t.county} ${t.availableForAll}`,e+="</td></tr></tbody></table>",t.attack.length&&(e+=`<div class="alert alert-danger mt-2" role="alert">${t.attack}</div>`),e+=`<p>${t.depth} water port ${t.countyCapital}${t.captured}<br>`,t.nonCapturable?(e+="Not capturable",e+=`<br>${t.portTax} tax`):(e+=`Port battle ${t.pbTimeRange}, ${t.brLimit} BR, `,e+=`${t.pbType} rate AI, `,e+=`${t.conquestMarksPension} conquest point`,e+=1<t.conquestMarksPension?"s":"",e+=`<br>Tax income ${t.taxIncome} (${t.portTax}), net income ${t.netIncome}`,e+=t.tradingCompany,e+=t.laborHoursDiscount),e+="</p>",e+="<table class='table table-sm'>",(t.producesTrading.length||t.producesNonTrading.length)&&(e+=`<tr><td>Produces${t.producesNonTrading.length?" ":""}</td><td>`,t.producesNonTrading.length&&(e+=`<span class="non-trading">${t.producesNonTrading}</span>`,t.producesTrading.length&&(e+="<br>")),t.producesTrading.length&&(e+=`${t.producesTrading}`),e+="</td></tr>"),(t.dropsTrading.length||t.dropsNonTrading.length)&&(e+=`<tr><td>Drops${t.dropsNonTrading.length?" ":""}</td><td>`,t.dropsNonTrading.length&&(e+=`<span class="non-trading">${t.dropsNonTrading}</span>`,t.dropsTrading.length&&(e+="<br>")),t.dropsTrading.length&&(e+=`${t.dropsTrading}`),e+="</td></tr>"),(t.consumesTrading.length||t.consumesNonTrading.length)&&(e+=`<tr><td>Consumes${t.consumesNonTrading.length?" ":""}</td><td>`,t.consumesNonTrading.length&&(e+=`<span class="non-trading">${t.consumesNonTrading}</span>`,t.consumesTrading.length&&(e+="<br>")),t.consumesTrading.length&&(e+=`${t.consumesTrading}`),e+="</td></tr>"),t.goodsToSellInTradePort.length&&(e+=`<tr><td>Sell in ${t.tradePort}</td><td>${t.goodsToSellInTradePort}</td></tr>`),t.goodsToBuyInTradePort.length&&(e+=`<tr><td>Buy in ${t.tradePort}</td><td>${t.goodsToBuyInTradePort}</td></tr>`),e+="</table>"}(this._getText(e.id,e.properties));i.attr("data-toggle","tooltip"),t(i._groups[0]).tooltip({delay:{show:this._highlightDuration,hide:this._highlightDuration},html:!0,placement:"auto",title:r,trigger:"manual"}).tooltip("show")}_updateIcons(){const e=2**i(a(this._minScale)+this._scale),s=Object(g.w)(this._circleSize/e),r=this._portData.filter(t=>this._pbData.ports.some(e=>t.id===e.id)).map(t=>(t.properties.nation=this._pbData.ports.filter(e=>t.id===e.id).map(t=>t.nation)[0],t)),o=this._gIcon.selectAll("circle").data(r,t=>t.id);o.exit().remove();const n=o.enter().append("circle").attr("fill",t=>`url(#${t.properties.availableForAll?`${t.properties.nation}a`:t.properties.nation})`).attr("cx",t=>t.geometry.coordinates[0]).attr("cy",t=>t.geometry.coordinates[1]).on("click",(t,e,s)=>this._showDetails(t,e,s)).on("mouseout",function(e,s,a){t(Object(h.select)(a[s])._groups[0]).tooltip("hide")});o.merge(n).attr("r",t=>t.id===this._highlightId?2*s:s)}_updatePortCircles(){const t=t=>{let e="";return t.id===this.tradePortId?e="here":t.properties.sellInTradePort&&t.properties.buyInTradePort?e="both":t.properties.sellInTradePort?e="pos":t.properties.buyInTradePort&&(e="neg"),e},e=2**i(a(this._minScale)+this._scale),s=Object(g.w)(this._circleSize/e*this._minRadiusFactor);let r=Object(g.w)(this._circleSize/e*this._maxRadiusFactor),o={},d=0;if("tax"===this._showRadius||"net"===this._showRadius)o=this._portData.filter(t=>!t.properties.nonCapturable);else if(this.showTradePortPartners)o=this._portData;else if("position"===this._showRadius)o=this._portData;else if("attack"===this._showRadius){const t=this._pbData.ports.filter(t=>t.attackHostility).map(t=>({id:t.id,attackHostility:t.attackHostility}));o=this._portData.filter(e=>t.some(t=>e.id===t.id)).map(e=>(e.properties.attackHostility=t.filter(t=>e.id===t.id).map(t=>t.attackHostility)[0],e))}else if("green"===this._showRadius){d=Object(g.w)(Object(_.k)({x:Object(_.e)(-63400,18800),y:Object(_.f)(-63400,18800)},{x:Object(_.e)(-79696,10642),y:Object(_.f)(-79696,10642)}))*_.d;const t=this._pbData.ports.filter(t=>"FT"!==t.nation).map(t=>t.id);o=this._portData.filter(e=>t.some(t=>e.id===t)&&e.properties.nonCapturable)}else this.showCurrentGood&&(o=this._portData,r/=2);const h=this._gPortCircle.selectAll("circle").data(o,t=>t.id);h.exit().remove();const c=h.enter().append("circle").attr("cx",t=>t.geometry.coordinates[0]).attr("cy",t=>t.geometry.coordinates[1]),l=h.merge(c);if("tax"===this._showRadius){const t=Object(n.min)(o,t=>t.properties.taxIncome),e=Object(n.max)(o,t=>t.properties.taxIncome);this._taxIncomeRadius.domain([t,e]),this._taxIncomeRadius.range([s,r]),l.attr("class","bubble pos").attr("r",t=>this._taxIncomeRadius(a(t.properties.taxIncome)))}else if("net"===this._showRadius){const t=Object(n.min)(o,t=>t.properties.netIncome),e=Object(n.max)(o,t=>t.properties.netIncome);this._netIncomeRadius.domain([t,e]).range([s,r]),l.attr("class",t=>`bubble ${0>t.properties.netIncome?"neg":"pos"}`).attr("r",t=>this._netIncomeRadius(a(t.properties.netIncome)))}else this.showTradePortPartners?l.attr("class",e=>`bubble ${t(e)}`).attr("r",t=>t.id===this.tradePortId?r:r/2):"attack"===this._showRadius?(this._attackRadius.range([s,r]),l.attr("class","bubble").attr("fill",t=>this._colourScale(t.properties.attackHostility)).attr("r",t=>this._attackRadius(t.properties.attackHostility))):"position"===this._showRadius?l.attr("class","position").attr("r",t=>t.properties.distance):"green"===this._showRadius?l.attr("class","bubble pos").attr("r",d):this.showCurrentGood&&l.attr("class",t=>`bubble ${t.properties.isSource?"pos":"neg"}`).attr("r",r)}_updateTextsX(t,e){return"pbZone"===this._zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.geometry.coordinates[0]+r(1.2*e*Math.cos(Object(g.h)(t.properties.angle))):t.geometry.coordinates[0]}_updateTextsY(t,e,s){const a=e+1.2*s;if("pbZone"!==this._zoomLevel)return t.id===this._highlightId?t.geometry.coordinates[1]+(2*e+2*s):t.geometry.coordinates[1]+a;const i=90<t.properties.angle&&270>t.properties.angle?s:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.geometry.coordinates[1]+r(1.2*e*Math.sin(Object(g.h)(t.properties.angle)))+i:t.geometry.coordinates[1]+a}_updateTextsAnchor(t){return"pbZone"===this._zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.properties.textAnchor:"middle"}updateTexts(){if("initial"===this._zoomLevel)this._gText.attr("display","none");else{this._gText.attr("display","inherit");const t=2**i(a(this._minScale)+this._scale),e=Object(g.w)(this._circleSize/t),s=2**i(.9*(a(this._minScale)+this._scale)),r=Object(g.w)(this._fontSize/s),o=this._gText.selectAll("text").data(this._portData,t=>t.id);o.exit().remove();const n=o.enter().append("text").text(t=>t.properties.name);o.merge(n).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,r)).attr("font-size",t=>t.id===this._highlightId?`${2*r}px`:`${r}px`).attr("text-anchor",t=>this._updateTextsAnchor(t))}}_updateSummary(){const t=Object.keys(this._portData).length;let e=0,s=0;t&&(e=this._portData.map(t=>t.properties.taxIncome).reduce((t,e)=>t+e),s=this._portData.map(t=>t.properties.netIncome).reduce((t,e)=>t+e)),this._portSummaryTextNumPorts.text(`${t}`),this._portSummaryTextTaxIncome.text(`${Object(g.o)(e)}`),this._portSummaryTextNetIncome.text(`${Object(g.o)(s)}`)}_updateCounties(){if("portLabel"!==this._zoomLevel)this._gCounty.attr("display","none");else{this._gCounty.attr("display","inherit");const t=this._countyPolygon,e=this._gCounty.selectAll("text").data(t);e.exit().remove(),e.enter().append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)}}_updateRegions(){if("initial"!==this._zoomLevel)this._gRegion.attr("display","none");else{this._gRegion.attr("display","inherit");const t=this._regionPolygon,e=this._gRegion.selectAll("text").data(t);e.exit().remove(),e.enter().append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)}}update(t=null){this._scale=t||this._scale,this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()}set highlightId(t){this._highlightId=t}set portDataDefault(t){this._portDataDefault=t}get portDataDefault(){return this._portDataDefault}set portData(t){this._portData=t}get portData(){return this._portData}set pbData(t){this._pbData=t}get pbData(){return this._pbData}set showRadiusSetting(e){this._showRadius=e,t(`#show-radius-${e}`).prop("checked",!0),this._storeShowRadiusSetting()}set currentPort(t){this._currentPort=t}get currentPort(){return this._currentPort}set zoomLevel(t){this._zoomLevel=t}get zoomLevel(){return this._zoomLevel}_showSummary(){this._divPortSummary.classed("hidden",!1)}hideSummary(){this._divPortSummary.classed("hidden",!0)}transform(t){this._gPort.attr("transform",t)}clearMap(t){"position"===this._showRadius&&(this._showRadius="off"),this._showSummary(),this._portData=this._portDataDefault,this.showCurrentGood=!1,this.showTradePortPartners=!1,this.update(t)}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Math.atan2,i=Math.floor;(function(t){s.d(e,"a",function(){return l});var r=s(16),o=(s.n(r),s(2),s(9),s(12)),n=s(0),d=s(89),h=s(7),c=s(4);class l{constructor(t){this._ports=t,this._inputs=4,this._baseName="Get position",this._baseId="get-position",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._initData(),this._setupListener()}_initData(){}_navbarClick(t){Object(h.b)("Menu","Get position"),t.stopPropagation(),this._positionSelected()}_setupListener(){document.getElementById("positionNavbar").addEventListener("click",t=>this._navbarClick(t))}_injectModal(){Object(c.m)(this._modalId,this._baseName,"","Go");const t=Object(n.select)(`#${this._modalId} .modal-body`);t.append("div").classed("alert alert-primary",!0).attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),s=e.append("datalist").attr("id","defaultDistances");[5,10,15,20,30,50,100,200].forEach(t=>{s.append("option").attr("value",t)}),Array.from(Array(this._inputs).keys()).forEach(t=>{const s=`${this._baseId}-${t}-select`,a=`${this._baseId}-${t}-input`,i=e.append("div").classed("form-row",!0);i.append("div").classed("col-md-6",!0).append("label").append("select").attr("name",s).attr("id",s),i.append("div").classed("col-md-6",!0).append("input").attr("id",a).attr("name",a).attr("type","number").classed("form-control",!0).attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)})}_setupSelects(){const e=JSON.parse(JSON.stringify({noneSelectedText:"",dropupAuto:!1}));e.liveSearch=!0,e.liveSearchPlaceholder="Search ...",e.liveSearchNormalize=!0,e.noneSelectedText="Select port";const s=`${this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.geometry.coordinates[0],t.geometry.coordinates[1]],name:t.properties.name,nation:this._ports.pbData.ports.filter(e=>e.id===t.id).map(t=>t.nation)})).sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0).map(t=>`<option data-subtext="${t.nation}" value="${t.coord}" data-id="${t.id}">${t.name}</option>`).join("")}`;Array.from(Array(this._inputs).keys()).forEach(a=>{const i=`${this._baseId}-${a}-select`,r=document.getElementById(i),o=t(`#${i}`);r.insertAdjacentHTML("beforeend",s),o.selectpicker(e).val("default").selectpicker("refresh")})}_initModal(){this._injectModal(),this._setupSelects()}_useUserInput(){const e=new Map;Array.from(Array(this._inputs).keys()).forEach(s=>{const a=`${this._baseId}-${s}-select`,i=t(`#${a}`),r=`${this._baseId}-${s}-input`,o=t(`#${r}`),n=i.find(":selected")[0]?i.find(":selected")[0].text:"",d=+o.val();d&&""!==n&&e.set(n,1.05*d*c.d)}),2<=e.size?(this._ports.showRadiusSetting="position",this._ports.portData=this._ports.portDataDefault.filter(t=>e.has(t.properties.name)).map(t=>(t.properties.distance=e.get(t.properties.name),t)),this._ports.update(),(()=>{const t=Object(n.select)("g.ports").append("g").classed("position",!0),e=t=>{const e=[];return t.arcs.forEach(t=>{const s=t.p1,r=t.p2,o=t.circle,n=a(s.x-o.x,s.y-o.y),d=a(r.x-o.x,r.y-o.y);let h=d-n;0>h&&(h+=2*Math.PI);const c=h/32;Array.from(Array(32).keys()).forEach(t=>{const s=d-c*t,a={x:o.x+o.radius*Math.sin(s),y:o.y+o.radius*Math.cos(s)};e.push([i(a.x),i(a.y)])})}),e},s=s=>{const a=e(s),i=Object(o.e)().curve(o.c);t.append("path").attr("d",i(a))},r=(()=>{const t=this._ports.portData.map(t=>({x:t.geometry.coordinates[0],y:t.geometry.coordinates[1],radius:t.properties.distance})),e={};return Object(d.a)(t,e),e})();if(r.innerPoints.length){s(r);const t=Object(n.select)("g.ports path").node().getBBox(),e={x:t.x+t.width/2,y:t.y+t.height/2};this._ports._map._f11.printCoord(e.x,e.y),this._ports._map.zoomAndPan(e.x,e.y,1)}else console.error("Get position: no intersection found.")})()):console.error("Get position: not enough data.")}_positionSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").on("hidden.bs.modal",()=>{this._useUserInput()})}}}).call(this,s(11))},,function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return m});var a=s(130),i=(s.n(a),s(54)),r=(s.n(i),s(16)),o=(s.n(r),s(132)),n=(s.n(o),s(8)),d=s.n(n),h=s(73),c=(s.n(h),s(74)),l=(s.n(c),s(7)),p=s(4);class m{constructor(e,s){this._ports=e,this._pbZone=s,this._dateFormat="D MMM",this._timeFormat="HH.00",this._portNamesId="port-names-select",this._portNamesSelector=document.getElementById(this._portNamesId),this._portNames$=t(`#${this._portNamesId}`),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.getElementById(this._buyGoodsId),this._buyGoods$=t(`#${this._buyGoodsId}`),this._propNationId="prop-nation-select",this._propNationSelector=document.getElementById(this._propNationId),this._propNation$=t(`#${this._propNationId}`),this._propClanId="prop-clan-select",this._propClanSelector=document.getElementById(this._propClanId),this._propClan$=t(`#${this._propClanId}`),this._propCMId="prop-cm-select",this._propCMSelector=document.getElementById(this._propCMId),this._propCM$=t(`#${this._propCMId}`),this._setupSelects(),this._setupListener()}_setupSelects(){this._setupPortSelect(),this._setupGoodSelect(),this._setupNationSelect(),this._setupClanSelect(),this._setupCMSelect()}_resetOtherSelects(t){[this._portNames$,this._buyGoods$,this._propNation$,this._propClan$,this._propCM$].forEach(e=>{e===t||e===this._propClan$&&t===this._propNation$||e===this._propNation$&&t===this._propClan$||e.val("default").selectpicker("refresh")})}_setupListener(){this._portNamesSelector.classList.add("selectpicker"),this._buyGoodsSelector.classList.add("selectpicker"),this._propNationSelector.classList.add("selectpicker"),this._propClanSelector.classList.add("selectpicker"),this._propCMSelector.classList.add("selectpicker");const e={noneSelectedText:"",dropupAuto:!1},s=JSON.parse(JSON.stringify(e));s.liveSearch=!0,s.liveSearchPlaceholder="Search ...",s.liveSearchNormalize=!0,s.noneSelectedText="Select single port",this._portNamesSelector.addEventListener("change",t=>{Object(l.b)("Menu","Move to port"),this._resetOtherSelects(this._portNames$),this._portSelected(t)}),this._portNames$.selectpicker(s),s.noneSelectedText="Select good",this._buyGoodsSelector.addEventListener("change",t=>{Object(l.b)("Menu","Select good"),this._resetOtherSelects(this._buyGoods$),this._goodSelected(t)}),this._buyGoods$.selectpicker(s),e.noneSelectedText="Select nation",this._propNationSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propNation$),this._nationSelected(t)}),this._propNation$.selectpicker(e),e.noneSelectedText="Select clan",this._propClanSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propClan$),this._clanSelected(t)}),this._propClan$.selectpicker(e),e.noneSelectedText="Select",this._propCMSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propCM$),this._CMSelected(t)}),this._propCM$.selectpicker(e),document.getElementById("menu-prop-deep").addEventListener("click",()=>this._depthSelected("deep")),document.getElementById("menu-prop-shallow").addEventListener("click",()=>this._depthSelected("shallow")),document.getElementById("menu-prop-all").addEventListener("click",()=>this._allSelected()),document.getElementById("menu-prop-green").addEventListener("click",()=>this._greenZoneSelected()),document.getElementById("menu-prop-large").addEventListener("click",()=>this._portSizeSelected("Large")),document.getElementById("menu-prop-medium").addEventListener("click",()=>this._portSizeSelected("Medium")),document.getElementById("menu-prop-small").addEventListener("click",()=>this._portSizeSelected("Small")),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"far fa-clock",date:"far fa-calendar",up:"fas fa-arrow-up",down:"fas fa-arrow-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"far fa-calendar-check",clear:"fas fa-trash",close:"fas fa-times"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),t("#prop-pb-range").submit(e=>{this._capturePBRange(),t("#propertyDropdown").dropdown("toggle"),e.preventDefault()}),document.getElementById("menu-prop-today").addEventListener("click",()=>this._capturedToday()),document.getElementById("menu-prop-yesterday").addEventListener("click",()=>this._capturedYesterday()),document.getElementById("menu-prop-this-week").addEventListener("click",()=>this._capturedThisWeek()),document.getElementById("menu-prop-last-week").addEventListener("click",()=>this._capturedLastWeek());const a=t("#prop-from"),i=t("#prop-to");a.datetimepicker({format:this._dateFormat}),i.datetimepicker({format:this._dateFormat,useCurrent:!1}),a.on("change.datetimepicker",t=>i.datetimepicker("minDate",t.date)),i.on("change.datetimepicker",t=>a.datetimepicker("maxDate",t.date)),t("#prop-range").submit(e=>{this._captureRange(),t("#propertyDropdown").dropdown("toggle"),e.preventDefault()}),Object(p.l)("selectPortNavbar"),t(".selectpicker").val("default").selectpicker("refresh")}_setupPortSelect(){const t=`${this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.geometry.coordinates[0],t.geometry.coordinates[1]],name:t.properties.name,nation:this._ports.pbData.ports.filter(e=>e.id===t.id).map(t=>t.nation)})).sort((t,e)=>t.name<e.name?-1:t.name>e.name?1:0).map(t=>`<option data-subtext="${t.nation}" value="${t.coord}" data-id="${t.id}">${t.name}</option>`).join("")}`;this._portNamesSelector.insertAdjacentHTML("beforeend",t)}_setupGoodSelect(){function t(){}const e=new Set;t.prototype.add=(t=>{t.forEach(t=>{e.add(t)})});const s=new t;this._ports.portDataDefault.forEach(t=>{s.add(t.properties.consumesTrading),s.add(t.properties.consumesNonTrading),s.add(t.properties.dropsTrading),s.add(t.properties.dropsNonTrading),s.add(t.properties.producesTrading),s.add(t.properties.producesNonTrading)});const a=`${Array.from(e).sort().map(t=>`<option>${t}</option>`).join("")}`;this._buyGoodsSelector.insertAdjacentHTML("beforeend",a)}_setupNationSelect(){const t=`${p.n.sort((t,e)=>t.sortName<e.sortName?-1:t.sortName>e.sortName?1:0).map(t=>`<option value="${t.short}">${t.name}</option>`).join("")}`;this._propNationSelector.insertAdjacentHTML("beforeend",t)}_setupClanSelect(){this._propClanSelector.innerHTML="";const t=new Set,e=new Set;this._ports.portData.forEach(t=>e.add(t.id)),this._ports.pbData.ports.filter(t=>t.capturer&&e.has(t.id)).forEach(e=>t.add(e.capturer));const s=`${Array.from(t).sort().map(t=>`<option value="${t}">${t}</option>`).join("")}`;s?(this._propClanSelector.insertAdjacentHTML("beforeend",s),this._propClanSelector.disabled=!1,this._propClan$.val("default").selectpicker("refresh")):(this._propClanSelector.disabled=!0,this._propClan$.append("<option></option>").selectpicker("refresh"))}_setupCMSelect(){const e=new Set;this._ports.portData.forEach(t=>e.add(t.properties.conquestMarksPension)),e.forEach(e=>{this._propCM$.append("beforeend",t("<option>",{value:e,text:e}))})}_setTradePortPartners(){function t(){}function e(){}const s=[],a=[];t.prototype.add=(t=>{t.forEach(t=>{s.push(t)})}),e.prototype.add=(t=>{t.forEach(t=>{a.push(t)})});const i=new t,r=new e;this._ports.portDataDefault.filter(t=>t.id===this._ports.tradePortId).forEach(t=>{r.add(t.properties.dropsTrading),r.add(t.properties.producesTrading),i.add(t.properties.consumesTrading)}),this._ports.portData=this._ports.portDataDefault.map(t=>(t.properties.goodsToSellInTradePort=[],t.properties.sellInTradePort=!1,t.properties.goodsToBuyInTradePort=[],t.properties.buyInTradePort=!1,["dropsTrading","producesTrading"].forEach(e=>{t.properties[e].forEach(e=>{s.includes(e)&&(t.properties.goodsToSellInTradePort.push(e),t.properties.sellInTradePort=!0)})}),["consumesTrading"].forEach(e=>{t.properties[e].forEach(e=>{a.includes(e)&&(t.properties.goodsToBuyInTradePort.push(e),t.properties.buyInTradePort=!0)})}),t)).filter(t=>t.id===this._ports.tradePortId||t.properties.sellInTradePort||t.properties.buyInTradePort)}_portSelected(e){const s=t(e.currentTarget).find(":selected"),a=s.val().split(","),i=s.data("id").toString();this._ports.currentPort={id:i,coord:{x:+a[0],y:+a[1]}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone._showPBZones&&this._pbZone.refresh(),this._ports.showTradePortPartners=!0,this._ports.showCurrentGood=!1,this._ports.update()}_goodSelected(e){const s=t(e.currentTarget).find(":selected")[0].text,a=this._ports.portDataDefault.filter(t=>t.properties.dropsTrading.includes(s)||t.properties.dropsNonTrading.includes(s)||t.properties.producesTrading.includes(s)||t.properties.producesNonTrading.includes(s)).map(t=>(t.properties.isSource=!0,t)),i=this._ports.portDataDefault.filter(t=>t.properties.consumesTrading.includes(s)||t.properties.consumesNonTrading.includes(s)).map(t=>(t.properties.isSource=!1,t));this._ports.showRadiusSetting="off",this._ports.portData=a.concat(i),this._ports.showCurrentGood=!0,this._ports.showTradePortPartners=!1,this._ports.update()}_nationSelected(e){const s=new Set;this._nation=t(e.currentTarget).val(),t("#propertyDropdown").dropdown("toggle"),this._ports.pbData.ports.filter(t=>t.nation===this._nation).forEach(t=>s.add(t.id)),this._ports.portData=this._ports.portDataDefault.filter(t=>s.has(t.id)),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update(),this._setupClanSelect()}_clanSelected(e){const s=new Set,a=t(e.currentTarget).val();t("#propertyDropdown").dropdown("toggle"),0===a?this._nation&&this._ports.pbData.ports.filter(t=>t.nation===this._nation).forEach(t=>s.add(t.id)):this._ports.pbData.ports.filter(t=>a===t.capturer).forEach(t=>s.add(t.id)),this._ports.portData=this._ports.portDataDefault.filter(t=>s.has(t.id)),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.properties.shallow:!e.properties.shallow);this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.properties.availableForAll);this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_greenZoneSelected(){const t=this._ports.portDataDefault.filter(t=>t.properties.nonCapturable&&"FT"!==t.properties.nation);this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_portSizeSelected(t){const e=this._ports.portDataDefault.filter(e=>t===e.properties.portBattleType);this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_capturePBRange(){const e=[8,9,10],s=24-(e.length+1),a=new Set,i=d()(t("#prop-pb-from-input").val(),this._timeFormat).hour();let r=d()(t("#prop-pb-to-input").val(),this._timeFormat).hour();if(!(e.includes(i)&&e.includes(r)&&i<=r)){a.add(0),r<i&&(r+=24);for(let t=i-2;t<=r-3;t+=1)a.add((t-10)%s)}const o=this._ports.portDataDefault.filter(t=>!t.properties.nonCapturable&&"FT"!==t.properties.nation&&a.has(t.properties.portBattleStartTime));this._ports.portData=o,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_filterCaptured(t,e){const s=new Set;this._ports.pbData.ports.filter(s=>d()(s.lastPortBattle).isBetween(t,e,null,"(]")).forEach(t=>s.add(t.id));const a=this._ports.portDataDefault.filter(t=>s.has(t.id));this._ports.portData=a,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_capturedToday(){const t=d.a.utc();let e=d()().utc().hour(11).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,d.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=d.a.utc();let e=d()().utc().hour(11).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,d.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=d()().utc().startOf("week"),e=t.hour(11),s=d()(t).add(7,"day").hour(11);this._filterCaptured(e,s)}_capturedLastWeek(){const t=d()().utc().startOf("week"),e=d()(t).subtract(7,"day").hour(11),s=t.hour(11);this._filterCaptured(e,s)}_captureRange(){const e=d()(t("#prop-from-input").val(),this._dateFormat).hour(11),s=d()(t("#prop-to-input").val(),this._dateFormat).add(1,"day").hour(11);this._filterCaptured(e,s)}_CMSelected(){const e=parseInt(this._propCM$.val(),10);let s;s=0===e?this._ports.portDataDefault:this._ports.portDataDefault.filter(t=>e===t.properties.conquestMarksPension),t("#propertyDropdown").dropdown("toggle"),this._ports.portData=s,this._ports.showTradePortPartners=!1,this._ports.update()}clearMap(){this._setupClanSelect()}}}).call(this,s(11))},function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return h});var a=s(16),i=(s.n(a),s(39)),r=(s.n(i),s(0)),o=s(1),n=s(7),d=s(4);class h{constructor(t,e){this._recipeData=t.map(t=>(t.name=t.name.replace(" Blueprint",""),t)),this._moduleData=e,this._baseName="List recipes",this._baseId="recipe-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(n.b)("Tools",this._baseName),t.stopPropagation(),this._recipeListSelected()})}_injectModal(){Object(d.m)(this._modalId,this._baseName);const t=`${this._baseId}-select`,e=Object(r.select)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",`${this._baseId}`).attr("class","container-fluid")}_getOptions(){return`${this._recipeData.map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}`}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._recipeSelected(t)).selectpicker({noneSelectedText:"Select recipe"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_getRecipeData(t){return this._recipeData.filter(e=>e.name===t)[0]}_getRequirementText(t){let e='<table class="table table-sm"><tbody>';return t.laborPrice&&(e+=`<tr><td>${t.laborPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${t.goldPrice} gold</td></tr>`),t.itemRequirements.length&&(e+=`<tr><td>${t.itemRequirements.map(t=>`${t.amount} ${t.name}`).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>"}_getModuleText(t){let e="",s="",a="";return this._moduleData.forEach(e=>{e[1].filter(e=>e.name===t).forEach(t=>{s=e[0],a=`<tr><td>${t.properties.map(t=>{const e=t.absolute?t.amount:Object(o.p)(t.amount/100);return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`})}),e=`<h6 class="card-subtitle mb-2 text-muted">${s}</h6>`,e+=`<table class="table table-sm"><tbody>${a}</tbody></table>`}_getText(t){const e=this._getRecipeData(t),s=e.module?e.module:e.name;let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-4"><div class="card-header">Recipe</div>',a+='<div class="card-body"><h5 class="card-title">Requirements</h5>',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card col-4"><div class="card-header">Resulting module</div>',a+='<div class="card-body"><h5 class="card-title">Properties</h5>',a+=this._getModuleText(s),a+="</div></div>",a+="</div></div>"}_recipeSelected(e){const s=t(e.currentTarget).find(":selected").val();Object(r.select)(`#${this._baseId} div`).remove(),Object(r.select)(`#${this._baseId}`).append("div").classed("recipes mt-4",!0),Object(r.select)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s(11))},function(t,e,s){"use strict";s.d(e,"a",function(){return r});var a=s(0),i=s(96);class r{constructor(t,e){this._ports=e,this._show=!1,this._voronoiCoord=[[t.min-1,t.min-1],[t.max+1,t.max+1]],this._teleportPorts=this._getPortData(),this._voronoiDiagram=this._getVoronoiDiagram(),this._data={},this._highlightId=null,this._g=Object(a.select)("#na-svg").insert("g","g.ports").classed("voronoi",!0)}_getPortData(){return this._ports.portDataDefault.filter(t=>!t.properties.shallow).map(t=>({id:t.id,coord:{x:t.geometry.coordinates[0],y:t.geometry.coordinates[1]}}))}_getVoronoiDiagram(){return Object(i.a)().extent(this._voronoiCoord).x(t=>t.coord.x).y(t=>t.coord.y)(this._teleportPorts)}_mouseover(t){this._highlightId=t.data.id,this.update(),this._ports.highlightId=this._highlightId,this._ports.update()}update(){const t=this._g.selectAll("path").data(this._data,t=>t.data.id);t.exit().remove();const e=t.enter().append("path").attr("d",t=>t?`M${t.join("L")}Z`:null).on("mouseover",t=>this._mouseover(t));t.merge(e).classed("highlight-voronoi",t=>t.data.id===this._highlightId)}set show(t){this._show=t}set zoomLevel(t){this._zoomLevel=t}setData(){this._data=this._show&&"pbZone"!==this._zoomLevel?this._voronoiDiagram.polygons():{},this._highlightId=null,this._ports.highlightId=this._highlightId}transform(t){this._g.attr("transform",t)}}},function(t,e,s){"use strict";var a=Math.max,i=Math.round;(function(t){s.d(e,"a",function(){return g});var r=s(0),o=s(12),n=s(8),d=s.n(n),h=s(55),c=(s.n(h),s(71)),l=(s.n(c),s(72)),p=(s.n(l),s(73)),m=(s.n(p),s(74)),u=(s.n(m),s(1)),_=s(7);class g{constructor(){this._compassSize=100,this._height=300,this._width=300,this._line=Object(o.e)(),this._setupSvg(),this.constructor._setupArrow(),this.constructor._setupForm(),this._setupListener()}_setupSvg(){this._svg=Object(r.select)("body").append("div").attr("id","wind").append("svg").style("position","absolute").classed("coord",!0)}static _setupArrow(){Object(r.select)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",4).attr("markerHeight",4).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").classed("wind-head",!0)}static _setupForm(){d.a.locale("en-gb"),t("#wind-time").datetimepicker({defaultDate:d.a.utc(),format:"LT"});const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const s=e.call(this);return this.container.append(this.tooltip),s},window.tooltip=(t=>Object(u.g)(t.value)),t("#direction").roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/u.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_setupListener(){t("#windPrediction").submit(e=>{const s=t("#direction").roundSlider("option","value"),a=t("#wind-time-input").val().trim();Object(_.b)("Menu","Wind prediction"),this._predictWind(s,a),t("#predictDropdown").dropdown("toggle"),e.preventDefault()})}_predictWind(t,e){d.a.locale("en-gb");const s="H.mm";let a;const i=/(\d+)[\s:.](\d+)/.exec(e),r=parseInt(i[1],10),o=parseInt(i[2],10);a=Number.isNaN(+t)?Object(u.f)(t):+t;const n=d()().utc().seconds(0).milliseconds(0),h=d()(n).hour(r).minutes(o);h.isBefore(n)&&h.add(1,"day");const c=360+(a-.125*h.diff(n,"seconds"))%360;this._printPredictedWind(c,h.format(s),Object(u.g)(t),n.format(s))}_printCompass(t){const e=this._width/2,s=this._height/3,a=Math.PI/180*(t-90),r=1.3*this._compassSize,o=r*Math.cos(a),n=r*Math.sin(a),d=[[i(e+o/2),i(s+n/2)],[i(e-o/2),i(s-n/2)]];this._svg.attr("height",this._height).attr("width",this._width),this._svg.append("image").classed("compass",!0).attr("x",e-this._compassSize/2).attr("y",s-this._compassSize/2).attr("height",this._compassSize).attr("width",this._compassSize).attr("xlink:href","icons/compass.svg"),this._svg.append("path").datum(d).attr("d",this._line).classed("wind",!0).attr("marker-end","url(#wind-arrow)")}_printText(t,e,s,i){const r=Object(u.g)(t),o=parseInt(window.getComputedStyle(document.getElementById("wind")).getPropertyValue("line-height"),10),n=this._svg.append("svg"),d=n.append("text").attr("x","50%").attr("y","33%").attr("class","wind-text").text(`From ${r} at ${e}`),h=n.append("text").attr("x","50%").attr("y","66%").attr("class","wind-text-current").text(`Currently at ${i} from ${s}`),c=d.node().getBoundingClientRect(),l=h.node().getBoundingClientRect(),p=2*a(c.height,l.height)+o,m=a(c.width,l.width)+o;n.attr("x",(this._width-m)/2).attr("y","60%").attr("height",p).attr("width",m)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,e,s,a){this.clearMap(),this._printCompass(t),this._printText(t,e,s,a),this._addBackground()}setPosition(t,e){this._svg.style("left",`${e}px`).style("top",`${t}px`)}clearMap(){this._svg.selectAll("*").remove()}}}).call(this,s(11))},function(t,e,s){"use strict";var a=Number.isNaN;(function(t){s.d(e,"a",function(){return m});var i=s(16),r=(s.n(i),s(68)),o=(s.n(r),s(39)),n=(s.n(o),s(0)),d=s(33),h=s.n(d),c=s(4),l=s(1),p=s(7);class m{constructor(t){this._woodData=t,this._baseName="List woods",this._baseId="wood-list",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupListener()}_setupListener(){t(`#${this._buttonId}`).on("click",t=>{Object(p.b)("Tools",this._baseName),t.stopPropagation(),this._woodListSelected()})}_injectModal(){Object(c.m)(this._modalId,this._baseName);const t=Object(n.select)(`#${this._modalId} .modal-body`);t.append("h5").text("Frames"),t.append("div").attr("id","frame-list").attr("class","modules"),t.append("h5").text("Trims"),t.append("div").attr("id","trim-list").attr("class","modules")}_initTablesort(){const t=t=>t.replace(/[^\-?0-9.]/g,""),e=(t,e)=>{let s=parseFloat(t),i=parseFloat(e);return(s=a(s)?0:s)-(i=a(i)?0:i)};h.a.extend("number",t=>t.match(/^[-+]?[£\x24Û¢´€]?\d+\s*([,.]\d{0,2})/)||t.match(/^[-+]?\d+\s*([,.]\d{0,2})?[£\x24Û¢´€]/)||t.match(/^[-+]?(\d)*-?([,.])?-?(\d)+([E,e][-+][\d]+)?%?$/),(s,a)=>{const i=t(s),r=t(a);return e(r,i)})}_initModal(){this._initTablesort(),this._injectModal(),this._injectList("frame"),this._injectList("trim")}_woodListSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show")}_injectList(e){t(`#${e}-list`).append(this._getList(e));const s=document.getElementById(`table-${e}-list`);new h.a(s)}_getModifiers(t){const e=new Set;return this._woodData[t].forEach(t=>{t.properties.forEach(t=>{"Ship material"!==t.modifier&&"Boarding morale"!==t.modifier&&e.add(t.modifier)})}),Array.from(e).sort()}_getList(t){const e=this._getModifiers(t);let s="";return s+=`<table id="table-${t}-list" class="table table-sm small tablesort"><thead><tr><th data-sort-default>Wood</thdata-sort-default>`,e.forEach(t=>{s+=`<th>${t}</th>`}),s+="</tr></thead><tbody>",this._woodData[t].forEach(t=>{s+=`<tr><td>${t.name}</td>`,e.forEach(e=>{const a=t.properties.filter(t=>t.modifier===e).map(t=>t.amount)[0];s+=`<td class="text-right" data-sort="${a||0}">${a?Object(l.l)(a):""}</td>`}),s+="</tr>"}),s+="</tbody></table>"}}}).call(this,s(11))},,,function(t,e,s){t.exports=s(98)},function(t,e,s){"use strict";s.r(e),function(t){var e=s(36),a=(s.n(e),s(99)),i=(s.n(a),s(100)),r=(s.n(i),s(101)),o=(s.n(r),s(102)),n=(s.n(o),s(103)),d=(s.n(n),s(75)),h=s(40),c=s(25),l=s(13),p=s.n(l),m=s(7),u=s(104),_=(s.n(u),s(76));!function(){function e(){(i=t("input[name='serverName']:checked").val())===a?p.a.remove(s):p.a.set(s,i),document.location.reload()}const s="na-map--server-name",a="eu1";let i=function(){let e=p.a.get(s);return t(`#server-name-${e=void 0===e?a:e}`).prop("checked",!0),e}();d.a.library.add(h.a,h.b,h.c,h.d,c.a,c.b,c.c,c.d,c.e,c.f,c.g),Object(m.a)(),Object(m.c)("Homepage","/"),p.a.defaults={expires:365},t("#server-name").change(()=>e()),t(".dropdown-submenu > a").on("click",e=>{const s=t(e.currentTarget);t(".dropdown-submenu .dropdown-menu").removeClass("show"),s.next(".dropdown-menu").addClass("show"),e.stopPropagation()}),t(".dropdown").on("hidden.bs.dropdown",()=>{t(".dropdown-menu.show").not(".inner").removeClass("show")});const r=new _.a(i);window.onresize=(()=>{r.resize()})}()}.call(this,s(11))},,,,,,function(){}],[[97,1,2]]]);