/*! For license information please see game-tools~map.b72f5ace7422a45cda1a.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{iSiJ:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return A}));s("kypl"),s("SJSz"),s("RsBt"),s("ZEAQ"),s("FdtR"),s("9UJh"),s("y89P"),s("aZFp"),s("MTDe"),s("U00V"),s("9DLp"),s("3XUK"),s("Peo2"),s("/1Gu");var a=s("ED/D"),i=s("qKAC"),r=s("SYoz"),o=s("BfWa"),p=s("Tj8s"),n=s("8RCj"),h=s("OQCi"),d=s("PVJp"),c=s("XGRO"),l=s("bTsO"),m=s("u1QP"),u=s("qbdS"),_=s("mIOj"),g=s("f4w0"),b=s("Av7d"),f=s("0lY5"),D=s("pFgi"),C=s("t1jV"),S=s.n(C);function w(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}const v=2*Math.PI/24,x=b.J/b.K;class j{constructor(e,t){this._id=e,this._shipCompare=t,this._ticksSpeed=[12,8,4,0],this._ticksSpeedLabels=["12 knots","8 knots","4 knots","0 knots"],this._select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}_setupSvg(){const e=Object(d.a)(this.select);Object(d.a)(this.select+" svg").remove(),this._svg=e.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this.mainG=this._svg.append("g").attr("transform","translate("+this._shipCompare.svgWidth/2+","+this._shipCompare.svgHeight/2+")"),Object(d.a)(this.select+" div").remove(),e.append("div").attr("class","block-small")}_setCompass(){const e=new Array(12);e.fill(1,0);const t=Object(l.a)().sort(null).value(1)(e),s=Object(m.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this.mainG.append("g").attr("class","compass-arc").selectAll("path").data(t).join(e=>e.append("path").attr("d",s)),this.mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this._ticksSpeed).join(e=>e.append("circle").attr("r",e=>this._shipCompare.radiusSpeedScale(e)))}static pd(e){let t='<span class="badge badge-white">'+e[0]+" / ";return e[1]?t+=""+e[1]:t+="–",t+=" lb</span>",t}static getCannonsPerDeck(e,t){let s=t[0]+" "+j.pd(e[0]),a="";for(let i=1;i<4;i+=1)t[i]?s=t[i]+" "+j.pd(e[i])+" <br>"+s:a+="<br>";return[s,a]}static displaySecondBlock(){return'<div class="col-9"><div class="row no-gutters">'}static getText(e){let t=0;function s(e){return t+=1,'<div class="row row-small '+(t%2?"row-light":"")+'"><div class="col-3">'+e+"</div>"}function a(t,s,a=6){let i="",r="";return"cannonsPerDeck"===t?([i,r]=e[t],r="<br>"+r):i=""===t?"":e[t],'<div class="col-'+a+'">'+i+'<br><span class="des">'+s+"</span>"+r+"</div>"}let i="";return i+=s(e.shipRating),i+=j.displaySecondBlock(),i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("waterlineHeight","Water line"),i+="</div></div></div>",i+=s(e.decks),i+=j.displaySecondBlock(),i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (lb)"),i+=j.displaySecondBlock(),i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+=j.displaySecondBlock(),i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+=j.displaySecondBlock(),i+=a("maxSpeed","Maximum"),i+=a("",""),i+=a("acceleration","Acceleration"),i+=a("deceleration","Deceleration"),i+=a("maxTurningSpeed","Turn speed"),i+=a("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=s('Hit points <span class="badge badge-white">Thickness</span>'),i+=j.displaySecondBlock(),i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+=a("pump","Pump"),i+=a("rudder","Rudder"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+=j.displaySecondBlock(),i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+=j.displaySecondBlock(),i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+="</div></div></div>",i+=s("Resistance"),i+=j.displaySecondBlock(),i+=a("fireResistance","Fire",4),i+=a("leakResistance","Leak",4),i+=a("splinterResistance","Splinter",4),i+="</div></div></div>",i+=s('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=j.displaySecondBlock(),i+=a("hullRepairsNeeded","Hull",4),i+=a("rigRepairsNeeded","Rig",4),i+=a("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=s("Repair"),i+=j.displaySecondBlock(),i+=a("hullRepairAmount","Hull %",4),i+=a("rigRepairAmount","Rig %",4),i+=a("repairTime","Time (sec)",4),i+="</div></div></div>",i+=s("Hold"),i+=j.displaySecondBlock(),i+=a("maxWeight","Tons"),i+=a("holdSize","Cargo slots"),i+="</div></div></div>",i+="</div>",i}get id(){return this._id}get shipData(){return this._shipData}get select(){return this._select}}class y extends j{constructor(e,t,s){super(e,s),this._shipData=t,this._shipCompare=s,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const e=Object(m.a)().outerRadius(e=>this._shipCompare.radiusSpeedScale(e)+2).innerRadius(e=>this._shipCompare.radiusSpeedScale(e)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this.mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this._ticksSpeed).join(t=>t.append("path").attr("d",e).attr("id",(e,t)=>"tick"+t)),this.mainG.append("g").attr("class","speed-text").selectAll("text").data(this._ticksSpeed).join(e=>e.append("text").append("textPath").attr("href",(e,t)=>"#tick"+t).text((e,t)=>this._ticksSpeedLabels[t]).attr("startOffset","10%"))}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(f.r)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(f.h)(e)}_updateCompareWindProfiles(){for(const e of this._shipCompare._columnsCompare)Object(f.F)(this._shipCompare._selectedShips[e])||this._shipCompare._selectedShips[e].updateWindProfileRotation()}_setupDrag(){const e=this._shipData.speedDegrees.length,t=360/e,s=new Array(e+1).fill().map((e,s)=>s*t);this._speedScale=Object(h.a)().domain(s).range([].concat(w(this._shipData.speedDegrees),[this._shipData.speedDegrees[0]])).clamp(!0);this._drag=Object(p.a)().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=c.c;e.rotate=this._getHeadingInDegrees(Object(f.K)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>"rotate("+e.rotate+")"),e.compassText.attr("transform",e=>"rotate("+-e.rotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.rotate)),"ship"===e.type?this._shipRotate=e.rotate:"windProfile"===e.type&&(this._shipCompare.windProfileRotate=e.rotate),this._speedText.attr("transform","rotate("+-this._shipRotate+")").text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===e.type&&this._updateCompareWindProfiles()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this.mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this._shipData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this.mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",S.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>"rotate("+-e.initRotate+")").text(e=>this._getSpeed(e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>"rotate("+e.initRotate+")")}_drawWindProfile(){const e=Object(l.a)().sort(null).value(1)(this._shipData.speedDegrees),t=u.a,s=Object(_.a)().angle((e,t)=>t*v).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(t);this._shipCompare.windProfileRotate=0;const a=this._shipCompare.svgHeight/2-20,i={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-a,type:"windProfile"},r=this.mainG.append("g").datum(i).attr("class","wind-profile");r.append("path").attr("d",e=>String(Object(f.n)(e.compassTextX,e.compassTextY,20))+Object(f.o)(e.compassTextX,e.compassTextY,-e.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));r.append("path").attr("class","base-profile").attr("d",s(e)),r.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(e).join(e=>e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*v)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*v)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).attr("fill",e=>this._shipCompare.colorScale(e.data)).append("title").text(e=>Math.round(10*e.data)/10+" knots")),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>"rotate("+e.initRotate+")")}_printText(){var t;const s=j.getCannonsPerDeck(this._shipData.deckClassLimit,this._shipData.gunsPerDeck),a=Math.round(this._shipData.sides.armour*this._shipData.repairAmount.armour/b.y),i=Math.round(this._shipData.sails.armour*this._shipData.repairAmount.sails/b.I),r=Math.round(this._shipData.crew.max*x),o={shipRating:Object(f.D)(this._shipData.class)+" rate",battleRating:this._shipData.battleRating,guns:this._shipData.guns,decks:this._shipData.decks+" deck"+(this._shipData.decks>1?"s":""),additionalRow:this._shipData.decks<4?"<br> ":"",cannonsPerDeck:s,cannonBroadside:Object(f.v)(this._shipData.broadside.cannons),carroBroadside:Object(f.v)(this._shipData.broadside.carronades),gunsFront:this._shipData.gunsPerDeck[4],limitFront:this._shipData.deckClassLimit[4],gunsBack:this._shipData.gunsPerDeck[5],limitBack:this._shipData.deckClassLimit[5],firezoneHorizontalWidth:this._shipData.ship.firezoneHorizontalWidth,waterlineHeight:Object(f.r)(this._shipData.ship.waterlineHeight),maxSpeed:Object(f.r)(this._shipData.speed.max,4),acceleration:Object(f.r)(this._shipData.ship.acceleration),deceleration:Object(f.r)(this._shipData.ship.deceleration),maxTurningSpeed:Object(f.r)(this._shipData.rudder.turnSpeed,4),halfturnTime:Object(f.r)(this._shipData.rudder.halfturnTime,4),sideArmor:Object(f.v)(this._shipData.sides.armour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.sides.thickness)+"</span>",frontArmor:Object(f.v)(this._shipData.bow.armour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.bow.thickness)+"</span>",pump:Object(f.v)(this._shipData.pump.armour),sails:Object(f.v)(this._shipData.sails.armour),structure:Object(f.v)(this._shipData.structure.armour),backArmor:Object(f.v)(this._shipData.stern.armour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.stern.thickness)+"</span>",rudder:Object(f.v)(this._shipData.rudder.armour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.rudder.thickness)+"</span>",minCrew:Object(f.v)(this._shipData.crew.min),maxCrew:Object(f.v)(this._shipData.crew.max),sailingCrew:Object(f.v)(null!==(t=this._shipData.crew.sailing)&&void 0!==t?t:0),maxWeight:Object(f.v)(this._shipData.maxWeight),holdSize:Object(f.v)(this._shipData.holdSize),upgradeXP:Object(f.v)(this._shipData.upgradeXP),sternRepair:""+Object(f.v)(this._shipData.repairTime.stern),bowRepair:""+Object(f.v)(this._shipData.repairTime.bow),hullRepairAmount:""+Object(f.v)(100*(this._shipData.repairAmount.armour+this._shipData.repairAmount.armourPerk)),rigRepairAmount:""+Object(f.v)(100*(this._shipData.repairAmount.sails+this._shipData.repairAmount.sailsPerk)),repairTime:""+Object(f.v)(this._shipData.repairTime.sides),hullRepairsNeeded:Object(f.v)(a)+' <span class="badge badge-white">'+Object(f.v)(5*a)+"</span>",rigRepairsNeeded:Object(f.v)(i)+' <span class="badge badge-white">'+Object(f.v)(5*i)+"</span>",rumRepairsNeeded:Object(f.v)(r)+' <span class="badge badge-white">'+Object(f.v)(5*r)+"</span>",fireResistance:Object(f.x)(this._shipData.resistance.fire,0),leakResistance:Object(f.x)(this._shipData.resistance.leaks,0),splinterResistance:Object(f.x)(this._shipData.resistance.splinter,0),mastBottomArmor:Object(f.v)(this._shipData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.mast.bottomThickness)+"</span>",mastMiddleArmor:Object(f.v)(this._shipData.mast.middleArmour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.mast.middleThickness)+"</span>",mastTopArmor:Object(f.v)(this._shipData.mast.topArmour)+' <span class="badge badge-white">'+Object(f.v)(this._shipData.mast.topThickness)+"</span>"};o.gunsFront?o.gunsFront+=" "+j.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+j.pd(o.limitBack):o.gunsBack="–",e(""+this.select).find("div").append(j.getText(o))}}class k extends j{constructor(e,t,s,a){super(e,a),this._shipBaseData=t,this._shipCompareData=s,this._shipCompare=a,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(e,t){const s=Math.min(e,this._shipCompare.colourScaleSpeedDiff.domain()[0]),a=Math.max(t,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([s,0,a])}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return Object(f.r)(this._speedScale(Math.abs(e)))}_getHeadingInCompass(e){return Object(f.h)(e)}_updateSpeedText(){this._speedText.attr("transform","rotate("+-this._shipRotate+")").text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const e=this._shipCompareData.speedDegrees.length,t=360/e,s=new Array(e+1).fill().map((e,s)=>s*t);this._speedScale=Object(h.a)().domain(s).range([].concat(w(this._shipCompareData.speedDegrees),[this._shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=Object(p.a)().on("start",e=>{e.this.classed("drag-active",!0)}).on("drag",e=>{const{x:t,y:s}=c.c;e.rotate=this._getHeadingInDegrees(Object(f.K)({x:e.initX,y:e.initY},{x:t,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",e=>"rotate("+e.rotate+")"),e.compassText.attr("transform",e=>"rotate("+-e.rotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.rotate)),this._shipRotate=e.rotate,this._updateSpeedText()})()}).on("end",e=>{e.this.classed("drag-active",!1)}).container(()=>this.mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this._shipCompareData,t=this._shipCompare.shipMassScale(e),s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this.mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",e=>e.initX).attr("y1",a-20).attr("x2",e=>e.initX).attr("y2",e=>e.initY),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",S.a),r.append("circle").attr("cx",e=>e.compassTextX).attr("cy",e=>e.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",e=>e.compassTextX).attr("y",e=>e.compassTextY).attr("transform",e=>"rotate("+-e.initRotate+","+e.compassTextX+","+e.compassTextY+")").text(e=>this._getHeadingInCompass(e.initRotate));this._speedText=r.append("text").attr("x",e=>e.speedTextX).attr("y",e=>e.speedTextY).attr("transform",e=>"rotate("+-e.initRotate+")").text(e=>this._getSpeed(this._shipCompare.windProfileRotate-e.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",e=>"rotate("+e.initRotate+")")}_drawDifferenceProfile(){this._pie=Object(l.a)().sort(null).value(1);const e=this._pie(this._shipBaseData.speedDegrees);this._arcsComp=this._pie(this._shipCompareData.speedDegrees),this._speedDiff=this._shipCompareData.speedDegrees.map((e,t)=>Object(f.L)(e-this._shipBaseData.speedDegrees[t])),this._minSpeedDiff=Object(a.a)(this._speedDiff),this._maxSpeedDiff=Object(i.a)(this._speedDiff);const t=u.a,s=Object(_.a)().angle((e,t)=>t*v).radius(e=>this._shipCompare.radiusSpeedScale(e.data)).curve(t),r=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-r,type:"windProfile"},this._gWindProfile=this.mainG.append("g").attr("class","wind-profile").attr("transform","rotate("+this._windProfile.initRotate+")"),this._gWindProfile.append("path").attr("class","base-profile").attr("d",s(e)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",s(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform","rotate("+this._shipCompare.windProfileRotate+")"),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(e=>{e.append("circle").attr("r",5).attr("cy",(e,t)=>Math.cos(t*v)*-this._shipCompare.radiusSpeedScale(e.data)).attr("cx",(e,t)=>Math.sin(t*v)*this._shipCompare.radiusSpeedScale(e.data)).attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t])).append("title").text((e,t)=>Math.round(10*e.data)/10+" ("+Object(f.A)(this._speedDiff[t],1)+") knots")}).select("circle").attr("fill",(e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t]))}_injectTextComparison(){function t(e,t,s=0,a=!1){let i=parseFloat((e-t).toFixed(s));return a&&(i*=100),i<0?'<span class="badge badge-danger">'+Object(f.r)(Math.abs(i))+"</span>":i>0?'<span class="badge badge-success">'+Object(f.r)(i)+"</span>":""}const s=Math.round(this.shipBaseData.sides.armour*this.shipBaseData.repairAmount.armour/b.y),a=Math.round(this.shipBaseData.sails.armour*this.shipBaseData.repairAmount.sails/b.I),i=Math.round(this.shipBaseData.crew.max*x),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/b.y),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/b.I),p=Math.round(this.shipCompareData.crew.max*x),n={shipRating:Object(f.D)(this.shipCompareData.class)+" rate",battleRating:this.shipCompareData.battleRating+" "+t(this.shipCompareData.battleRating,this.shipBaseData.battleRating),guns:this.shipCompareData.guns+" "+t(this.shipCompareData.guns,this.shipBaseData.guns),decks:this.shipCompareData.decks+" "+t(this.shipCompareData.decks,this.shipBaseData.decks)+" deck"+(this.shipCompareData.decks>1?"s":""),additionalRow:this.shipCompareData.decks<4?"<br> ":"",cannonsPerDeck:j.getCannonsPerDeck(this.shipCompareData.deckClassLimit,this.shipCompareData.gunsPerDeck),cannonBroadside:this.shipCompareData.broadside.cannons+" "+t(this.shipCompareData.broadside.cannons,this.shipBaseData.broadside.cannons),carroBroadside:this.shipCompareData.broadside.carronades+" "+t(this.shipCompareData.broadside.carronades,this.shipBaseData.broadside.carronades),gunsFront:this.shipCompareData.gunsPerDeck[4],limitFront:this.shipCompareData.deckClassLimit[4],gunsBack:this.shipCompareData.gunsPerDeck[5],limitBack:this.shipCompareData.deckClassLimit[5],minSpeed:Object(f.r)(this.shipCompareData.speed.min)+" "+t(this.shipCompareData.speed.min,this.shipBaseData.speed.min,2),maxSpeed:Object(f.r)(this.shipCompareData.speed.max,4)+" "+t(this.shipCompareData.speed.max,this.shipBaseData.speed.max,2),maxTurningSpeed:Object(f.r)(this.shipCompareData.rudder.turnSpeed,4)+" "+t(this.shipCompareData.rudder.turnSpeed,this.shipBaseData.rudder.turnSpeed,2),firezoneHorizontalWidth:this.shipCompareData.ship.firezoneHorizontalWidth+" "+t(this.shipCompareData.ship.firezoneHorizontalWidth,this.shipBaseData.ship.firezoneHorizontalWidth),waterlineHeight:Object(f.r)(this.shipCompareData.ship.waterlineHeight)+" "+t(this.shipCompareData.ship.waterlineHeight,this.shipBaseData.ship.waterlineHeight,2),acceleration:Object(f.r)(this.shipCompareData.ship.acceleration)+" "+t(this.shipCompareData.ship.acceleration,this.shipBaseData.ship.acceleration,2),deceleration:Object(f.r)(this.shipCompareData.ship.deceleration)+" "+t(this.shipCompareData.ship.deceleration,this.shipBaseData.ship.deceleration,2),halfturnTime:Object(f.r)(this.shipCompareData.rudder.halfturnTime,4)+" "+t(this.shipCompareData.rudder.halfturnTime,this.shipBaseData.rudder.halfturnTime,2),sideArmor:Object(f.v)(this.shipCompareData.sides.armour)+" "+t(this.shipCompareData.sides.armour,this.shipBaseData.sides.armour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.sides.thickness)+"</span>"+t(this.shipCompareData.sides.thickness,this.shipBaseData.sides.thickness),frontArmor:Object(f.v)(this.shipCompareData.bow.armour)+" "+t(this.shipCompareData.bow.armour,this.shipBaseData.bow.armour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.bow.thickness)+"</span>"+t(this.shipCompareData.bow.thickness,this.shipBaseData.bow.thickness),backArmor:Object(f.v)(this.shipCompareData.stern.armour)+" "+t(this.shipCompareData.stern.armour,this.shipBaseData.stern.armour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.stern.thickness)+"</span>"+t(this.shipCompareData.stern.thickness,this.shipBaseData.stern.thickness),pump:Object(f.v)(this.shipCompareData.pump.armour)+" "+t(this.shipCompareData.pump.armour,this.shipBaseData.pump.armour),sails:Object(f.v)(this.shipCompareData.sails.armour)+" "+t(this.shipCompareData.sails.armour,this.shipBaseData.sails.armour),structure:Object(f.v)(this.shipCompareData.structure.armour)+" "+t(this.shipCompareData.structure.armour,this.shipBaseData.structure.armour),rudder:Object(f.v)(this.shipCompareData.rudder.armour)+" "+t(this.shipCompareData.rudder.armour,this.shipBaseData.rudder.armour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.rudder.thickness)+"</span>"+t(this.shipCompareData.rudder.thickness,this.shipBaseData.rudder.thickness),minCrew:Object(f.v)(this.shipCompareData.crew.min)+" "+t(this.shipCompareData.crew.min,this.shipBaseData.crew.min),maxCrew:Object(f.v)(this.shipCompareData.crew.max)+" "+t(this.shipCompareData.crew.max,this.shipBaseData.crew.max),sailingCrew:Object(f.v)(this.shipCompareData.crew.sailing)+" "+t(this.shipCompareData.crew.sailing,this.shipBaseData.crew.sailing),maxWeight:Object(f.v)(this.shipCompareData.maxWeight)+" "+t(this.shipCompareData.maxWeight,this.shipBaseData.maxWeight),holdSize:Object(f.v)(this.shipCompareData.holdSize)+" "+t(this.shipCompareData.holdSize,this.shipBaseData.holdSize),upgradeXP:Object(f.v)(this.shipCompareData.upgradeXP)+" "+t(this.shipBaseData.upgradeXP,this.shipCompareData.upgradeXP),hullRepairAmount:Object(f.v)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))+" "+t(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this.shipBaseData.repairAmount.armour+this.shipBaseData.repairAmount.armourPerk,3,!0),rigRepairAmount:Object(f.v)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))+" "+t(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this.shipBaseData.repairAmount.sails+this.shipBaseData.repairAmount.sailsPerk,3,!0),repairTime:Object(f.v)(this.shipCompareData.repairTime.sides)+" "+t(this.shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides),hullRepairsNeeded:Object(f.v)(r)+" "+t(r,s)+' <span class="badge badge-white">'+Object(f.v)(5*r)+"</span>",rigRepairsNeeded:Object(f.v)(o)+" "+t(o,a)+' <span class="badge badge-white">'+Object(f.v)(5*o)+"</span>",rumRepairsNeeded:Object(f.v)(p)+" "+t(p,i)+' <span class="badge badge-white">'+Object(f.v)(5*p)+"</span>",fireResistance:Object(f.x)(this.shipCompareData.resistance.fire,0)+" "+t(this.shipCompareData.resistance.fire,this.shipBaseData.resistance.fire,2,!0),leakResistance:Object(f.x)(this.shipCompareData.resistance.leaks,0)+" "+t(this.shipCompareData.resistance.leaks,this.shipBaseData.resistance.leaks,2,!0),splinterResistance:Object(f.x)(this.shipCompareData.resistance.splinter,0)+" "+t(this.shipCompareData.resistance.splinter,this.shipBaseData.resistance.splinter,2,!0),mastBottomArmor:Object(f.v)(this.shipCompareData.mast.bottomArmour)+" "+t(this.shipCompareData.mast.bottomArmour,this.shipBaseData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.mast.bottomThickness)+"</span>"+t(this.shipCompareData.mast.bottomThickness,this.shipBaseData.mast.bottomThickness),mastMiddleArmor:Object(f.v)(this.shipCompareData.mast.middleArmour)+" "+t(this.shipCompareData.mast.middleArmour,this.shipBaseData.mast.middleArmour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.mast.middleThickness)+"</span>"+t(this.shipCompareData.mast.middleThickness,this.shipBaseData.mast.middleThickness),mastTopArmor:Object(f.v)(this.shipCompareData.mast.topArmour)+" "+t(this.shipCompareData.mast.topArmour,this.shipBaseData.mast.topArmour)+' <span class="badge badge-white">'+Object(f.v)(this.shipCompareData.mast.topThickness)+"</span>"+t(this.shipCompareData.mast.topThickness,this.shipBaseData.mast.topThickness)};n.gunsFront?n.gunsFront+=" "+j.pd(n.limitFront):n.gunsFront="–",n.gunsBack?n.gunsBack+=" "+j.pd(n.limitBack):n.gunsBack="–",e(""+this.select).find("div").append(j.getText(n))}get shipBaseData(){return this._shipBaseData}get shipCompareData(){return this._shipCompareData}get shipCompare(){return this._shipCompare}}class A{constructor(e="ship-compare"){this._baseId=e,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this.colourScaleSpeedDiff=Object(h.a)().range([b.j,b.l,b.f]).interpolate(n.a),this._shipIds=[],this._selectedUpgradeIdsPerType=[],this._selectedUpgradeIdsList=[],this._selectShip$={},this._selectWood$={},this._selectModule$={},this._modal$=null,this._modifierAmount=new Map,"ship-compare"===this._baseId?this._columnsCompare=["C1","C2"]:this._columnsCompare=[],this._columns=this._columnsCompare.slice(),this._columns.unshift("Base"),this._selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}_setupArrow(){const e=document.getElementById("journey-arrow").cloneNode(!0);if(e.id="wind-profile-arrow-head",e.hasChildNodes())for(const t of e.childNodes)t.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").appendChild(e)}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}_setupData(){this._moduleAndWoodChanges=new Map([["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Armour repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder repair time",{properties:["repairTime.rudder"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sail repair amount",{properties:["repairAmount.sails"],isBaseValueAbsolute:!0}],["Sail repair time",{properties:["repairTime.sails"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Side armour repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Speed decrease",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}],["Water repair time",{properties:["repairTime.pump"],isBaseValueAbsolute:!0}]]),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],cap:{amount:.4,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:.4,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:.4,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:.3,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:.3,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:16,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const e=1.2*Object(a.a)(this._shipData,e=>e.speed.min),t=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=e,this._maxSpeed=t,this._colorScale=Object(h.a)().domain([this._minSpeed,0,this._maxSpeed]).range([b.j,b.l,b.f]).interpolate(n.a);const s=Object(a.a)(this._shipData,e=>e.shipMass),r=Object(i.a)(this._shipData,e=>e.shipMass);this.shipMassScale=Object(h.a)().domain([s,r]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await s.e(5).then(s.t.bind(null,"25zZ",3))).default,this._shipData=(await s.e(12).then(s.t.bind(null,"dU1q",3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new D.a(this._woodId),await this.woodCompare.woodInit())}catch(e){Object(f.J)(e)}}_setupListener(){let e=!0;document.getElementById(this._buttonId).addEventListener("click",async t=>{e&&(e=!1,await this._loadAndSetupData()),Object(g.b)("Tools",this._baseName),t.stopPropagation(),this._shipCompareSelected()})}_setGraphicsParameters(){this.svgWidth=parseInt(e("#"+this._modalId+" .column-base").width(),10),this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(h.a)().domain([this.minSpeed,0,this.maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_shipCompareSelected(){this._modal$||(this._initModal(),this._modal$=e("#"+this._modalId),this._modal$.on("keydown",e=>{"KeyC"===e.code&&e.ctrlKey&&this._copyDataClicked(e)}),document.getElementById(this._copyButtonId).addEventListener("click",e=>{this._copyDataClicked(e)})),this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];for(const t of this._columns)if(void 0!==this._shipIds[t]){e.push(this._shipIds[t]);for(const s of["frame","trim"])e.push(Number(this._selectWood$[t][s].val()))}return e}_copyDataClicked(e){Object(g.b)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length){const e=new URL(window.location);e.searchParams.set("v",encodeURIComponent(b.d)),e.searchParams.set("cmp",b.w.encode(t));for(const t of this._columns){const s=this._columns.indexOf(t);if(this._selectedUpgradeIdsPerType[t])for(const a of w(this._moduleTypes)){const i=w(this._moduleTypes).indexOf(a),r=this._selectedUpgradeIdsPerType[t][a];if(r&&r.length){const t=""+s+i;e.searchParams.set(t,b.w.encode(r))}}}Object(f.g)(e.href)}}_setupShipData(){this.shipSelectData=Object(o.b)().key(e=>e.class).sortKeys(r.a).entries(this._shipData.map(e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns})).sort(Object(f.M)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(e=>e[1].filter(e=>e.properties.some(e=>this._moduleAndWoodChanges.has(e.modifier))).map(e=>[e.id,e]))),this._moduleTypes=new Set(w(this._moduleProperties).map(e=>e[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(b.C)(this._modalId,this._baseName);const e=Object(d.a)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row");for(const t of this._columns){const s=e.append("div").attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),a=this._getShipSelectId(t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker");for(const e of["frame","trim"]){const a=this._getWoodSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}for(const e of this._moduleTypes){const a=this._getModuleSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}s.append("div").attr("id",this._baseId+"-"+t).attr("class","Base"===t?"ship-base":"ship-compare")}Object(d.a)("#"+this._modalId+" .modal-footer").insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const t of this._columns){if(this._setupShipSelect(t),"ship-journey"!==this._baseId){this._selectWood$[t]={};for(const s of["frame","trim"])this._selectWood$[t][s]=e("#"+this._getWoodSelectId(s,t)),this.woodCompare._setupWoodSelects(t,s,this._selectWood$[t][s])}this._setupSelectListener(t)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this.shipSelectData.map(e=>'<optgroup label="'+Object(f.D)(e.key,!1)+' rate">'+e.values.map(e=>'<option data-subtext="'+e.battleRating+'" value="'+e.id+'">'+e.name+" ("+e.guns+")").join("</option>")).join("</optgroup>")}_setupShipSelect(t){this._selectShip$[t]=e("#"+this._getShipSelectId(t));const s=this._getShipOptions();this._selectShip$[t].append(s),"Base"!==t&&this._selectShip$[t].attr("disabled","disabled")}static _getModuleLevel(e){return e<=3?"L":e<=5?"M":"S"}_getUpgradesOptions(e,t){const s=Object(o.b)().key(e=>e[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(r.a).sortValues((e,t)=>e[1].name.localeCompare(t[1].name)).entries(w(this._moduleProperties).filter(s=>s[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===e&&("U"===s[1].moduleLevel||s[1].moduleLevel===A._getModuleLevel(t))));let a="";const i=["Permanent","Ship trim"];return a=s.length>1?s.map(t=>'<optgroup label="'+t.key+'" data-max-options="'+(i.includes(e.replace(/[\sA-Za-z]+\s–\s/,""))?1:5)+'">'+t.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>")).join("</optgroup>"):s.map(e=>""+e.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>")),a}_fillModuleSelect(e,t){const s=this._getUpgradesOptions(t,(()=>this._shipData.find(t=>t.id===this._shipIds[e]).class)());this._selectModule$[e][t].find("option").remove(),this._selectModule$[e][t].append(s)}_resetModuleSelects(e){for(const t of this._moduleTypes)this._fillModuleSelect(e,t),this._selectModule$[e][t].selectpicker("refresh")}_getModuleFromName(e){let t={};return this._moduleDataDefault.some(s=>(t=s[1].find(t=>t.name===e),Boolean(t))),t}static _getModifierFromModule(e){return'<p class="mb-0">'+e.map(e=>{let t;return t=e.isPercentage?Object(f.C)(e.amount/100):e.amount<1&&e.amount>0?Object(f.w)(e.amount):Object(f.B)(e.amount),e.modifier+" "+t}).join("<br>")+"</p>"}_setupModulesSelect(t){if(!this._selectModule$[t]){this._selectModule$[t]={};for(const s of this._moduleTypes)this._selectModule$[t][s]=e("#"+this._getModuleSelectId(s,t)),this._selectModule$[t][s].on("changed.bs.select",()=>{this._modulesSelected(t),this._refreshShips(t)}).on("show.bs.select",t=>{e(t.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",t=>{const s=e(t.currentTarget);for(const t of s.data("selectpicker").selectpicker.current.elements)if(!t.classList.contains("dropdown-divider")&&!t.classList.contains("dropdown-header")){const s=this._getModuleFromName(t.innerText);e(t).attr("data-original-title",A._getModifierFromModule(s.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:e=>e+" "+s.toLowerCase()+"s selected",deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:s.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+s,width:"150px"})}this._resetModuleSelects(t)}_getShipData(e){const t=this._shipData.find(t=>t.id===this._shipIds[e]);let s=t;return s.repairAmount={armour:b.x,armourPerk:0,sails:b.H,sailsPerk:0},s.repairTime={sides:b.G,default:b.G},s.resistance={fire:0,leaks:0,splinter:0},s=this._addModulesAndWoodData(t,s,e),s}static _adjustAbsolute(e,t){return e?e+t:t}static _adjustPercentage(e,t,s){return s?e?e*(1+t):t:e?e+t:t}_adjustValue(e,t,s){let a=e;if(this._modifierAmount.get(t).absolute){const{absolute:e}=this._modifierAmount.get(t);a=A._adjustAbsolute(a,e)}if(this._modifierAmount.get(t).percentage){const e=this._modifierAmount.get(t).percentage/100;a=A._adjustPercentage(a,e,s)}return Math.trunc(100*a)/100}_setModifier(e){let t=e.isPercentage?0:e.amount,s=e.isPercentage?e.amount:0;this._modifierAmount.has(e.modifier)&&(t+=this._modifierAmount.get(e.modifier).absolute,s+=this._modifierAmount.get(e.modifier).percentage),this._modifierAmount.set(e.modifier,{absolute:t,percentage:s})}_showCappingAdvice(e,t){const s=this._baseId+"-"+e+"-capping";let a=document.getElementById(s);if(!a){a=document.createElement("p"),a.id=s,a.className="alert alert-warning",document.getElementById(this._baseId+"-"+e).firstChild.after(a)}a.innerHTML=w(t).join(", ")+" capped"}_removeCappingAdvice(e){const t=this._baseId+"-"+e+"-capping",s=document.getElementById(t);s&&s.remove()}_addModulesAndWoodData(e,t,s){const a=JSON.parse(JSON.stringify(t)),i=()=>{a.speedDegrees=a.speedDegrees.map(e=>{const t=1+this._modifierAmount.get("Max speed").percentage/100,s=e>0?e*t:e/t;return Math.max(Math.min(s,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const e of this._selectedUpgradeIdsList[s]){const t=this._moduleProperties.get(e);for(const e of t.properties)this._moduleAndWoodChanges.has(e.modifier)&&this._setModifier(e)}if(this.woodCompare._instances[s]){let e="_woodData";"Base"!==s&&(e="_compareData");for(const t of["frame","trim"])for(const a of this.woodCompare._instances[s][e][t].properties)this._moduleAndWoodChanges.has(a.modifier)&&this._setModifier(a)}})(),(()=>{for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodChanges.get(e).properties)for(const t of this._moduleAndWoodChanges.get(e).properties){const s=t.split(".");s.length>1?a[s[0]][s[1]]=this._adjustValue(a[s[0]][s[1]],e,this._moduleAndWoodChanges.get(e).isBaseValueAbsolute):a[s[0]]=this._adjustValue(a[s[0]],e,this._moduleAndWoodChanges.get(e).isBaseValueAbsolute)}})(),(()=>{const t={isCapped:!1,modifiers:new Set},i=(e,s,a,{amount:i,isPercentage:r})=>{const o=Math.min(s,r?a*(1+i):i);return s!==o&&(t.isCapped=!0,t.modifiers.add(e)),o};for(const[,t]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(t)){const{cap:s}=this._moduleAndWoodCaps.get(t);for(const r of this._moduleAndWoodCaps.get(t).properties){const o=r.split(".");o.length>1?a[o[0]][o[1]]&&(a[o[0]][o[1]]=i(t,a[o[0]][o[1]],e[o[0]][o[1]],s)):a[o[0]]&&(a[o[0]]=i(t,a[o[0]],e[o[0]],s))}}t.isCapped?this._showCappingAdvice(s,t.modifiers):this._removeCappingAdvice(s)})(),this._modifierAmount.has("Max speed")&&i(),a}_updateDifferenceProfileNeeded(e){"Base"===e||Object(f.F)(this._selectedShips[e])||this._selectedShips[e].updateDifferenceProfile()}_updateSailingProfile(e){this._updateDifferenceProfileNeeded(e);for(const t of this._columnsCompare)t!==e&&this._updateDifferenceProfileNeeded(t)}_refreshShips(e){if("ship-journey"===this._baseId)this._singleShipData=this._shipData.find(t=>t.id===this._shipIds[e]);else{this._modulesSelected(e);const t=this._getShipData(e);if("Base"===e){this._setSelectedShip(e,new y(e,t,this));for(const e of this._columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),Object(f.F)(this.selectedShips[e])||this._setSelectedShip(e,new k(e,t,this.selectedShips[e]._shipCompareData,this))}else this._setSelectedShip(e,new k(e,this.selectedShips.Base._shipData,t,this));this._updateSailingProfile(e)}}_enableCompareSelects(){for(const e of this._columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={};for(const t of this._moduleTypes)this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map(Number):this._selectedUpgradeIdsPerType[e][t]=""===this._selectedUpgradeIdsPerType[e][t]?[]:[Number(this._selectedUpgradeIdsPerType[e][t])],this._selectedUpgradeIdsPerType[e][t].length&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))}_setupSelectListener(e){if(this._selectShip$[e].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(e),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(e)}),"ship-journey"!==this._baseId)for(const t of["frame","trim"])this._selectWood$[e][t].on("changed.bs.select",()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)}).selectpicker({title:"Wood "+t,width:"150px"})}static _setSelect(e,t){t&&e.val(t),e.selectpicker("render")}_setShipAndWoodsSelects(e){let t=0;this._columns.some(s=>{if(!this._shipData.find(s=>s.id===e[t]))return!1;if(this._shipIds[s]=e[t],t+=1,A._setSelect(this._selectShip$[s],this._shipIds[s]),"Base"===s&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(s),this._setupModulesSelect(s),e[t])for(const a of["frame","trim"])A._setSelect(this._selectWood$[s][a],e[t]),t+=1,this.woodCompare._woodSelected(s,a,this._selectWood$[s][a]);else t+=2;return this._refreshShips(s),t>=e.length})}_setModuleSelects(e){for(const t of this._columns){const s=this._columns.indexOf(t);let a=!1;for(const i of w(this._moduleTypes)){const r=w(this._moduleTypes).indexOf(i);if(e.has(""+s+r)){const o=b.w.decode(e.get(""+s+r));this._selectedUpgradeIdsPerType[t]||(this._selectedUpgradeIdsPerType[t]={}),this._selectedUpgradeIdsList[t]||(this._selectedUpgradeIdsList[t]=[]),this._selectedUpgradeIdsPerType[t][i]=o.map(Number),A._setSelect(this._selectModule$[t][i],this._selectedUpgradeIdsPerType[t][i]),this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][i]),a=!0}}a&&this._refreshShips(t)}}async initFromClipboard(e){await this._loadAndSetupData();const t=b.w.decode(e.get("cmp"));t.length&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(t),this._setModuleSelects(e))}_getShipSelectId(e){return this._baseId+"-"+e+"-select"}_getWoodSelectId(e,t){return this._woodId+"-"+e+"-"+t+"-select"}_getModuleSelectId(e,t){return this._moduleId+"-"+e.replace(/\s/,"")+"-"+t+"-select"}set woodCompare(e){this._woodCompare=e}get woodCompare(){return this._woodCompare}_setSelectedShip(e,t){this._selectedShips[e]=t}get selectedShips(){return this._selectedShips}get minSpeed(){return this._minSpeed}get maxSpeed(){return this._maxSpeed}get colorScale(){return this._colorScale}set svgWidth(e){this._svgWidth=e}get svgWidth(){return this._svgWidth}set svgHeight(e){this._svgHeight=e}get svgHeight(){return this._svgHeight}set outerRadius(e){this._outerRadius=e}get outerRadius(){return this._outerRadius}set innerRadius(e){this._innerRadius=e}get innerRadius(){return this._innerRadius}set radiusSpeedScale(e){this._radiusSpeedScale=e}get radiusSpeedScale(){return this._radiusSpeedScale}}}).call(this,s("xeH2"))},pFgi:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return m}));s("kypl"),s("SJSz"),s("RsBt"),s("ZEAQ"),s("FdtR"),s("9UJh"),s("U00V"),s("3XUK"),s("Peo2");var a=s("ED/D"),i=s("qKAC"),r=s("PVJp"),o=s("f4w0"),p=s("Av7d"),n=s("0lY5");function h(e){return function(e){if(Array.isArray(e)){for(var t=0,s=new Array(e.length);t<e.length;t++)s[t]=e[t];return s}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}class d{constructor(e,t){this._id=e,this._woodCompare=t,this._select="#"+this._woodCompare._baseFunction+"-"+this._id,this._setupMainDiv(),this._g=Object(r.a)(this._select).select("g")}_setupMainDiv(){Object(r.a)(this._select+" div").remove(),Object(r.a)(this._select).append("div")}}class c extends d{constructor(e,t,s){super(e,s),this._woodData=t,this._woodCompare=s,this._printText()}_getProperty(e,t){const s=this._woodData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),s=this._getProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';t+="<tr>",t+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[s,a]of e.properties){if(t+="<tr><td>"+s+"</td><td>"+(a.isPercentage?Object(n.x)(a.amount/100):Object(n.r)(a.amount)),t+='<span class="rate">',a.amount>0){t+='<span class="bar neutral" style="width:50%;"></span>',t+='<span class="bar pos diff" style="width:'+a.amount/this._woodCompare._minMaxProperty.get(s).max*50+'%;"></span>'}else if(a.amount<0){const e=a.amount/this._woodCompare._minMaxProperty.get(s).min*50;t+='<span class="bar neutral" style="width:'+(50-e)+'%;"></span>',t+='<span class="bar neg diff" style="width:'+e+'%;"></span>'}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}return t+="</tbody></table>",t}_printText(){const t={frame:this._woodData.frame.id,trim:this._woodData.trim.id};t.properties=new Map;for(const e of this._woodCompare.propertyNames){const s=this._getPropertySum(e);t.properties.set(e,{amount:s.amount,isPercentage:s.isPercentage})}e(""+this._select).find("div").append(this._getText(t))}}class l extends d{constructor(e,t,s,a){super(e,a),this._baseData=t,this._compareData=s,this._woodCompare=a,this._printTextComparison()}_getBaseProperty(e,t){const s=this._baseData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),s=this._getBaseProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(e,t){const s=this._compareData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),s=this._getCompareProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:t.isPercentage&&s.isPercentage}}static _getDiff(e,t,s,a=1){const i=parseFloat((e-t).toFixed(a));return(s?Object(n.x)(e/100,a):Object(n.r)(e))+' <span class="badge badge-white">'+Object(n.A)(i)+"</span>"}_getText(e){let t=0,s=0,a=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,p]of e.properties)r+="<tr><td>"+o+"</td><td>"+l._getDiff(p.compare,p.base,p.isPercentage),r+='<span class="rate">',p.compare>=0?(p.base>=0?p.compare>p.base?(t=p.base,s=p.compare-p.base,i="pos"):(t=p.compare,s=p.base-p.compare,i="neg"):(t=0,s=p.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+='<span class="bar pos diff" style="width:'+t/this._woodCompare._minMaxProperty.get(o).max*50+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/this._woodCompare._minMaxProperty.get(o).max*50+'%;"></span>'):p.compare<0?(p.base<0?p.compare>=p.base?(t=p.compare,s=p.base-p.compare,a=-p.base,i="pos"):(t=p.base,s=p.compare-p.base,a=-p.compare,i="neg"):(t=0,s=p.compare,a=-p.compare,i="neg"),r+='<span class="bar neutral" style="width:'+(50+a/this._woodCompare._minMaxProperty.get(o).min*50)+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/this._woodCompare._minMaxProperty.get(o).min*50+'%;"></span>',r+='<span class="bar neg diff" style="width:'+t/this._woodCompare._minMaxProperty.get(o).min*50+'%;"></span>'):r+='<span class="bar neutral"></span>',r+="</span></td></tr>";return r+="</tbody></table>",r}_printTextComparison(){const t={frame:this._compareData.frame.name,trim:this._compareData.trim.name};t.properties=new Map;for(const e of this._woodCompare.propertyNames){const s=this._getBasePropertySum(e),a=this._getComparePropertySum(e);t.properties.set(e,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}e(""+this._select).find("div").append(this._getText(t))}}class m{constructor(e){this._baseFunction=e,this._baseName="Compare woods",this._baseId=this._baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._woodsSelected=[],this._instances=[],this._options={},this._minMaxProperty=new Map,"wood"===this._baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}_findWoodId(e,t){return this._woodData[e].find(e=>e.name===t).id}_setupData(){this.propertyNames=new Set([].concat(h(this._woodData.frame.flatMap(e=>e.properties.map(e=>e.modifier))),h(this._woodData.trim.flatMap(e=>e.properties.map(e=>e.modifier)))).sort()),"wood"===this._baseFunction?(this._defaultWood={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this._baseFunction?(this._defaultWood={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWood={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await s.e(13).then(s.t.bind(null,"wWIj",3))).default,this._setupData()}catch(e){Object(n.J)(e)}}_setupListener(){let e=!0;document.getElementById(this._buttonId).addEventListener("click",async t=>{e&&(e=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),t.stopPropagation(),this._woodCompareSelected()})}_woodCompareSelected(){document.getElementById(this._modalId)||this._initModal(),e("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(n.M)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(n.M)(["name"])),this._setOption(this._frameSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>"),this._trimSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>"));for(const o of this.propertyNames){var e,t,s,r;const p=h(this._woodData.frame.map(e=>{var t;return null==(t=e.properties.find(e=>e.modifier===o))?void 0:t.amount})),n=h(this._woodData.trim.map(e=>{var t;return null==(t=e.properties.find(e=>e.modifier===o))?void 0:t.amount})),d=null!==(e=Object(a.a)(p))&&void 0!==e?e:0,c=null!==(t=Object(i.a)(p))&&void 0!==t?t:0,l=null!==(s=Object(a.a)(n))&&void 0!==s?s:0,m=null!==(r=Object(i.a)(n))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:d+l>=0?0:d+l,max:c+m})}}_injectModal(){Object(p.C)(this._modalId,this._baseName);const e=Object(r.a)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const t of this._columns){const s=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));for(const e of["frame","trim"]){const a=this._baseFunction+"-"+e+"-"+t+"-select";s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}s.append("div").attr("id",this._baseFunction+"-"+t)}}_initModal(){this._initData(),this._injectModal();for(const t of this._columns)for(const s of["frame","trim"]){const a=e("#"+this._baseFunction+"-"+s+"-"+t+"-select");this._setupWoodSelects(t,s,a),this._setupSelectListener(t,s,a)}}_setWoodsSelected(e,t,s){this._woodsSelected[e]||(this._woodsSelected[e]={}),this._woodsSelected[e][t]=s}_setupWoodSelects(e,t,s){this._setWoodsSelected(e,t,this._defaultWood[t]),s.append(this._options[t]),("wood"!==this._baseFunction||"Base"!==e&&"wood"===this._baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(t,s){const a="frame"===s?"trim":"frame";this._woodsSelected[t][a]===this._defaultWood[a]&&e("#"+this._baseFunction+"-"+a+"-"+t+"-select").val(this._defaultWood[a]).selectpicker("refresh")}enableSelects(t){for(const s of["frame","trim"])e("#"+this._baseFunction+"-"+s+"-"+t+"-select").removeAttr("disabled").selectpicker("refresh")}_woodSelected(e,t,s){const a=Number(s.val());if(this._setWoodsSelected(e,t,a),this._setOtherSelect(e,t),"Base"===e){this._addInstance(e,new c("Base",this._getWoodData("Base"),this));for(const e of this._columnsCompare)"wood"===this._baseFunction&&this.enableSelects(e),this._instances[e]&&this._addInstance(e,new l(e,this._getWoodData("Base"),this._getWoodData(e),this))}else this._addInstance(e,new l(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,s){s.on("change",()=>this._woodSelected(e,t,s)).selectpicker({title:"Select "+t})}_getWoodData(e){return{frame:this.getWoodTypeData("frame",this._woodsSelected[e].frame),trim:this.getWoodTypeData("trim",this._woodsSelected[e].trim)}}_addMinMaxProperty(e,t){this._minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this._instances[e]=t}getWoodTypeData(e,t){return this._woodData[e].find(e=>e.id===t)}}}).call(this,s("xeH2"))},t1jV:function(e,t){e.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"}}]);