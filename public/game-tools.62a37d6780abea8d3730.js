/*! For license information please see game-tools.62a37d6780abea8d3730.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{101:function(t,e,a){a.d(e,"a",(function(){return d}));var s=a(78),i=a(279),r=a(263),o=a(5);function n(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class d{constructor(t,e){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=t,this._shipCompare=e,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map((t=>t+" knots")),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(t){let e=`<span class="badge badge-white">${t.maxCannonLb} / `;return t.maxCarroLb?e+=""+t.maxCarroLb:e+="–",e+=" lb</span>",e}static getCannonsPerDeck(t){let e=`${t.gunsPerDeck[0].amount} ${d.pd(t.gunsPerDeck[0])}`,a="";for(let s=1;s<4;s+=1)t.gunsPerDeck[s].amount?e=`${t.gunsPerDeck[s].amount} ${d.pd(t.gunsPerDeck[s])} <br>${e}`:a+="<br>";return[e,a]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(t){let e=0;function a(t){return e+=1,`<div class="row row-small ${e%2?"row-light":""}"><div class="col-compress col-3">${t}</div>`}function s(e,a,s=6){let i,r="";return"cannonsPerDeck"===e?([i,r]=t[e],r="<br>"+r):i=""===e?"":String(t[e]),`<div class="col-compress col-${s}">${i}<br><span class="des">${a}</span>${r}</div>`}let i="";return i+=a(t.shipRating),i+=d.displaySecondBlock(),i+=s("battleRating","Battle rating"),i+=s("guns","Cannons"),i+=s("upgradeXP","Knowledge XP"),i+=s("rollAngle","Roll angle"),i+="</div></div></div>",i+=a(t.decks),i+=d.displaySecondBlock(),i+=s("cannonsPerDeck","Gun decks"),i+=s("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=a("Broadside (lb)"),i+=d.displaySecondBlock(),i+=s("cannonBroadside","Cannons"),i+=s("carroBroadside","Carronades"),i+="</div></div></div>",i+=a("Chasers"),i+=d.displaySecondBlock(),i+=s("gunsFront","Bow"),i+=s("gunsBack","Stern"),i+="</div></div></div>",i+=a("Speed"),i+=d.displaySecondBlock(),i+=s("maxSpeed","Maximum"),i+=s("halfturnTime","Rudder half time"),i+=s("acceleration","Acceleration"),i+=s("deceleration","Deceleration"),i+=s("turnSpeed","Turn speed"),i+=s("turnAcceleration","Turn acceleration"),i+="</div></div></div>",i+=a('Hit points <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=s("sideArmor","Sides"),i+=s("structure","Hull"),i+=s("frontArmor","Bow"),i+=s("backArmor","Stern"),i+="</div></div></div>",i+=a('Masts <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=s("sails","Sails"),i+=s("mastBottomArmor","Bottom"),i+=s("mastMiddleArmor","Middle"),i+=s("mastTopArmor","Top"),i+="</div></div></div>",i+=a("Crew"),i+=d.displaySecondBlock(),i+=s("minCrew","Minimum",4),i+=s("sailingCrew","Sailing",4),i+=s("maxCrew","Maximum",4),i+=s("cannonCrew","Cannon",4),i+=s("carroCrew","Carronades",4),i+="</div></div></div>",i+=a("Gunnery"),i+=d.displaySecondBlock(),i+=s("reload","Reload %",4),i+=s("dispersionHorizontal","Horizontal dispersion %",4),i+=s("dispersionVertical","Vertical dispersion %",4),i+=s("penetration","Ball penetration %",4),i+=s("traverseUpDown","Up/down traverse %",4),i+=s("traverseSide","Side traverse %",4),i+="</div></div></div>",i+=a("Boarding"),i+=d.displaySecondBlock(),i+=s("morale","Morale",4),i+=s("attack","Attack",4),i+=s("defense","Defense",4),i+=s("musketsCrew","Crew with muskets",4),i+=s("musketsAccuracy","Musket accuracy %",4),i+=s("cannonsAccuracy","Cannon accuracy %",4),i+=s("prepPerRound","Preparation per round",4),i+=s("prepInitial","Initial preparation",4),i+=s("disengageTime","Rounds to disengage",4),i+="</div></div></div>",i+=a("Resistance"),i+=d.displaySecondBlock(),i+=s("leakResistance","Leak %"),i+=s("splinterResistance","Splinter %"),i+="</div></div></div>",i+=a('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=d.displaySecondBlock(),i+=s("hullRepairsNeeded","Hull",4),i+=s("rigRepairsNeeded","Rig",4),i+=s("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=a("Repair"),i+=d.displaySecondBlock(),i+=s("hullRepairAmount","Hull %",4),i+=s("rigRepairAmount","Rig %",4),i+=s("repairTime","Time (sec)",4),i+="</div></div></div>",i+=a("Hold"),i+=d.displaySecondBlock(),i+=s("holdSize","Cargo slots"),i+=s("maxWeight","Tons"),i+="</div></div></div>",i+=a("Weight"),i+=d.displaySecondBlock(),i+=s("cannonWeight","Cannons",4),i+=s("carroWeight","Carronades",4),i+=s("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const t=Object(s.a)(this.select);Object(s.a)(this.select+" svg").remove(),this._svg=t.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),Object(s.a)(this.select+" div").remove(),t.append("div")}_setCompass(){var t;const e=new Array(o.n/2);e.fill(1,0);const a=Object(i.a)().sort(null).value(1)(e),s=Object(r.a)().outerRadius(null!==(t=this._shipCompare.radiusSpeedScale(12))&&void 0!==t?t:0).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(a).join((t=>t.append("path").attr("d",s))),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join((t=>t.append("circle").attr("r",(t=>{var e;return null!==(e=this._shipCompare.radiusSpeedScale(t))&&void 0!==e?e:0}))))}}},106:function(t,e,a){(function(t){a.d(e,"a",(function(){return y}));var s=a(276),i=a(99),r=a(263),o=a(279),n=a(275),d=a(281),l=a(7),c=a(5),h=a(86),p=a(23),u=a(88),m=a(101),b=a(93),_=a(117),f=a.n(_);function g(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class y extends m.a{constructor(t,e,a){super(t,a),w(this,"shipData",void 0),w(this,"_speedScale",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),this.shipData=e,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const t=Object(r.a)().outerRadius((t=>{var e;return(null!==(e=this._shipCompare.radiusSpeedScale(t))&&void 0!==e?e:0)+2})).innerRadius((t=>{var e;return(null!==(e=this._shipCompare.radiusSpeedScale(t))&&void 0!==e?e:0)+1})).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join((e=>e.append("path").attr("d",t).attr("id",((t,e)=>"tick"+e)))),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join((t=>t.append("text").append("textPath").attr("href",((t,e)=>"#tick"+e)).text(((t,e)=>this.ticksSpeedLabels[e])).attr("startOffset","10%")))}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){var e;return Object(h.b)(null!==(e=this._speedScale(Math.abs(t)))&&void 0!==e?e:0)}_getHeadingInCompass(t){return Object(p.m)(t)}_updateCompareWindProfiles(){for(const t of this._shipCompare.columnsCompare)Object(l.e)(this._shipCompare.selectedShips[t])||this._shipCompare.selectedShips[t].updateWindProfileRotation()}_setupDrag(){const t=this.shipData.speedDegrees.length,e=360/t,a=g(new Array(t+1)).map(((t,a)=>a*e));this._speedScale=Object(i.a)().domain(a).range([].concat(g(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);const r=(t,e)=>{const{x:a,y:s}=t;e.rotate=this._getHeadingInDegrees(Object(u.m)({x:e.initX,y:e.initY},{x:a,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",(t=>`rotate(${t.rotate})`)),e.compassText.attr("transform",(t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`)).text((t=>this._getHeadingInCompass(t.rotate))),"ship"===e.type?this._shipRotate=e.rotate:"windProfile"===e.type&&(this._shipCompare.windProfileRotate=e.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===e.type&&this._updateCompareWindProfiles()};this._drag=Object(s.a)().on("drag",((t,e)=>r(t,e))).container((()=>this._mainG.node()))}_setupShipOutline(){var t;this._shipRotate=0;const{shipMass:e}=this.shipData,a=null!==(t=this._shipCompare.shipMassScale(e))&&void 0!==t?t:0,s=a,i=this._shipCompare.svgHeight/2-40,r={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:i,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(r).attr("class","ship-outline");o.append("line").attr("x1",(t=>t.initX)).attr("y1",i-20).attr("x2",(t=>t.initX)).attr("y2",(t=>t.initY)),o.append("image").attr("height",a).attr("width",s).attr("x",-a/2).attr("y",-s/2).attr("xlink:href",f.a),o.append("circle").attr("cx",(t=>t.compassTextX)).attr("cy",(t=>t.compassTextY)).attr("r",20).call(this._drag);const n=o.append("text").attr("x",(t=>t.compassTextX)).attr("y",(t=>t.compassTextY)).attr("transform",(t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`)).text((t=>this._getHeadingInCompass(t.initRotate)));this._speedText=o.append("text").attr("x",(t=>t.speedTextX)).attr("y",(t=>t.speedTextY)).attr("transform",(t=>`rotate(${-t.initRotate})`)).text((t=>this._getSpeed(t.initRotate))),r.this=o,r.compassText=n,o.datum(r).attr("transform",(t=>`rotate(${t.initRotate-90})`)),o.transition().duration(1e3).delay(500).attr("transform",(t=>`rotate(${t.initRotate})`))}_drawWindProfile(){const t=Object(o.a)().sort(null).value(1)(this.shipData.speedDegrees),e=n.a,a=Object(d.a)().angle(((t,e)=>e*c.q)).radius((t=>{var e;return null!==(e=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==e?e:0})).curve(e);this._shipCompare.windProfileRotate=0;const s=this._shipCompare.svgHeight/2-20,i={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-s,type:"windProfile"},r=this._mainG.append("g").datum(i).attr("class","wind-profile");r.append("path").attr("d",(t=>String(Object(u.g)(t.compassTextX,t.compassTextY,20))+Object(u.h)(t.compassTextX,t.compassTextY,-t.compassTextY/2))).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),r.append("circle").attr("cx",(t=>t.compassTextX)).attr("cy",(t=>t.compassTextY)).attr("r",20);const l=r.append("text").attr("x",(t=>t.compassTextX)).attr("y",(t=>t.compassTextY)).attr("transform",(t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`)).text((t=>this._getHeadingInCompass(t.initRotate)));r.append("path").attr("class","base-profile").attr("d",a(t)),r.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(t).join((t=>t.append("circle").attr("r",5).attr("cy",((t,e)=>{var a;return Math.cos(e*c.q)*-(null!==(a=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==a?a:0)})).attr("cx",((t,e)=>{var a;return Math.sin(e*c.q)*(null!==(a=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==a?a:0)})).attr("fill",(t=>{var e;return null!==(e=this._shipCompare.colorScale(t.data))&&void 0!==e?e:0})).attr("fill",(t=>{var e;return null!==(e=this._shipCompare.colorScale(t.data))&&void 0!==e?e:0})).append("title").text((t=>Math.round(10*t.data)/10+" knots")))),i.this=r,i.compassText=l,r.datum(i).attr("transform",(t=>`rotate(${t.initRotate+90})`)),r.transition().duration(1e3).delay(500).attr("transform",(t=>`rotate(${t.initRotate})`))}_printText(){var e;const a=m.a.getCannonsPerDeck(this.shipData.guns),s=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/b.h),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/b.m),r=Math.round(this.shipData.crew.max*b.n),o={attack:Object(h.k)(this.shipData.boarding.attack,2),cannonsAccuracy:Object(h.l)(100*this.shipData.boarding.cannonsAccuracy),defense:Object(h.k)(this.shipData.boarding.defense,2),disengageTime:Object(h.d)(this.shipData.boarding.disengageTime),morale:Object(h.d)(this.shipData.boarding.morale),musketsAccuracy:Object(h.l)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:Object(h.d)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:Object(h.d)(this.shipData.boarding.prepPerRound),prepInitial:Object(h.d)(this.shipData.boarding.prepInitial),reload:Object(h.l)(100*this.shipData.gunnery.reload),penetration:Object(h.l)(100*this.shipData.gunnery.penetration),dispersionHorizontal:Object(h.l)(100*this.shipData.gunnery.dispersionHorizontal),dispersionVertical:Object(h.l)(100*this.shipData.gunnery.dispersionVertical),traverseUpDown:Object(h.l)(100*this.shipData.gunnery.traverseUpDown),traverseSide:Object(h.l)(100*this.shipData.gunnery.traverseSide),acceleration:Object(h.b)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${Object(h.d)(this.shipData.stern.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:""+Object(h.d)(this.shipData.repairTime.bow),cannonBroadside:Object(h.d)(this.shipData.guns.broadside.cannons),cannonsPerDeck:a,carroBroadside:Object(h.d)(this.shipData.guns.broadside.carronades),deceleration:Object(h.b)(this.shipData.ship.deceleration),decks:Object(c.o)(this.shipData.guns.decks,"deck"),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${Object(h.d)(this.shipData.bow.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:Object(h.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(h.d)(this.shipData.holdSize),hullRepairAmount:""+Object(h.d)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:`${Object(h.d)(s)} <span class="badge badge-white">${Object(h.d)(s*b.k)}</span>`,leakResistance:Object(h.l)(100*this.shipData.resistance.leaks),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(h.d)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(h.d)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(h.d)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.mast.topThickness)}</span>`,maxCrew:Object(h.d)(this.shipData.crew.max),maxSpeed:Object(h.b)(this.shipData.speed.max,3),maxWeight:Object(h.d)(this.shipData.maxWeight),minCrew:Object(h.d)(this.shipData.crew.min),cannonCrew:Object(h.d)(this.shipData.crew.cannons),carroCrew:Object(h.d)(this.shipData.crew.carronades),pump:Object(h.d)(this.shipData.pump.armour),repairTime:""+Object(h.d)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(h.d)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:`${Object(h.d)(i)} <span class="badge badge-white">${Object(h.d)(i*b.k)}</span>`,rollAngle:Object(h.d)(this.shipData.ship.rollAngle),rudder:`${Object(h.d)(this.shipData.rudder.armour)} <span class="badge badge-white">${Object(h.d)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${Object(h.d)(r)} <span class="badge badge-white">${Object(h.d)(r*b.k)}</span>`,sailingCrew:Object(h.d)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:Object(h.d)(this.shipData.sails.armour),shipRating:Object(p.q)(this.shipData.class)+" rate",sideArmor:`${Object(h.d)(this.shipData.sides.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipData.sides.thickness)}</span>`,splinterResistance:Object(h.l)(100*this.shipData.resistance.splinter),sternRepair:""+Object(h.d)(this.shipData.repairTime.stern),structure:Object(h.d)(this.shipData.structure.armour),turnAcceleration:Object(h.b)(this.shipData.ship.turnAcceleration,4),turnSpeed:Object(h.b)(this.shipData.ship.turnSpeed,3),upgradeXP:Object(h.d)(this.shipData.upgradeXP),waterlineHeight:Object(h.b)(this.shipData.ship.waterlineHeight),cannonWeight:Object(h.d)(this.shipData.guns.weight.cannons),carroWeight:Object(h.d)(this.shipData.guns.weight.carronades)};o.repairWeight=Object(h.d)((s+i+.1*r)*b.k),o.gunsFront?o.gunsFront+=" "+m.a.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+m.a.pd(o.limitBack):o.gunsBack="–",t(""+this.select).find("div").append(m.a.getText(o))}}}).call(this,a(22))},107:function(t,e,a){(function(t){a.d(e,"a",(function(){return y}));var s=a(127),i=a(140),r=a(276),o=a(99),n=a(279),d=a(275),l=a(281),c=a(86),h=a(23),p=a(88),u=a(117),m=a.n(u),b=a(101),_=a(5),f=a(93);function g(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return v(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return v(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class y extends b.a{constructor(t,e,a,s){super(t,s),w(this,"shipCompareData",void 0),w(this,"_shipBaseData",void 0),w(this,"_speedScale",void 0),w(this,"_speedDiff",void 0),w(this,"_minSpeedDiff",void 0),w(this,"_maxSpeedDiff",void 0),w(this,"_shipRotate",void 0),w(this,"_speedText",void 0),w(this,"_drag",void 0),w(this,"_windProfile",void 0),w(this,"_gWindProfile",void 0),w(this,"_arcsComp",void 0),this._shipBaseData=e,this.shipCompareData=a,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(t,e){const a=Math.min(t,this._shipCompare.colourScaleSpeedDiff.domain()[0]),s=Math.max(e,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([a,0,s])}_getHeadingInDegrees(t,e){let a=t-e-180;return a<0&&(a+=360),a}_getSpeed(t){var e;return Object(c.b)(null!==(e=this._speedScale(Math.abs(t)))&&void 0!==e?e:0)}_getHeadingInCompass(t){return Object(h.m)(t)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const t=this.shipCompareData.speedDegrees.length,e=360/t,a=g(new Array(t+1)).map(((t,a)=>a*e));this._speedScale=Object(o.a)().domain(a).range([].concat(g(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);const s=(t,e)=>{const{x:a,y:s}=t;e.rotate=this._getHeadingInDegrees(Object(p.m)({x:e.initX,y:e.initY},{x:a,y:s}),e.correctionValueDegrees),(()=>{e.this.attr("transform",(t=>`rotate(${t.rotate})`)),e.compassText.attr("transform",(t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`)).text((t=>this._getHeadingInCompass(t.rotate))),this._shipRotate=e.rotate,this._updateSpeedText()})()};this._drag=Object(r.a)().on("drag",((t,e)=>s(t,e))).container((()=>this._mainG.node()))}_setupShipOutline(){var t;this._shipRotate=0;const{shipMass:e}=this.shipCompareData,a=null!==(t=this._shipCompare.shipMassScale(e))&&void 0!==t?t:0,s=a,i=this._shipCompare.svgHeight/2-40,r={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:i,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(r).attr("class","ship-outline");o.append("line").attr("x1",(t=>t.initX)).attr("y1",i-20).attr("x2",(t=>t.initX)).attr("y2",(t=>t.initY)),o.append("image").attr("height",a).attr("width",s).attr("x",-a/2).attr("y",-s/2).attr("xlink:href",m.a),o.append("circle").attr("cx",(t=>t.compassTextX)).attr("cy",(t=>t.compassTextY)).attr("r",20).call(this._drag);const n=o.append("text").attr("x",(t=>t.compassTextX)).attr("y",(t=>t.compassTextY)).attr("transform",(t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`)).text((t=>this._getHeadingInCompass(t.initRotate)));this._speedText=o.append("text").attr("x",(t=>t.speedTextX)).attr("y",(t=>t.speedTextY)).attr("transform",(t=>`rotate(${-t.initRotate})`)).text((t=>this._getSpeed(this._shipCompare.windProfileRotate-t.initRotate))),r.this=o,r.compassText=n,o.datum(r).attr("transform",(t=>`rotate(${t.initRotate-90})`)),o.transition().duration(1e3).delay(500).attr("transform",(t=>`rotate(${t.initRotate})`))}_drawDifferenceProfile(){var t,e;const a=Object(n.a)().sort(null).value(1),r=a(this._shipBaseData.speedDegrees);this._arcsComp=a(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map(((t,e)=>Object(h.u)(t-this._shipBaseData.speedDegrees[e]))),this._minSpeedDiff=null!==(t=Object(s.a)(this._speedDiff))&&void 0!==t?t:0,this._maxSpeedDiff=null!==(e=Object(i.a)(this._speedDiff))&&void 0!==e?e:0;const o=d.a,c=Object(l.a)().angle(((t,e)=>e*_.q)).radius((t=>{var e;return null!==(e=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==e?e:0})).curve(o),p=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-p,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",c(r)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",c(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join((t=>t.append("circle").attr("r",5).attr("cy",((t,e)=>{var a;return Math.cos(e*_.q)*-(null!==(a=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==a?a:0)})).attr("cx",((t,e)=>{var a;return Math.sin(e*_.q)*(null!==(a=this._shipCompare.radiusSpeedScale(t.data))&&void 0!==a?a:0)})).attr("fill",((t,e)=>{var a;return null!==(a=this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))&&void 0!==a?a:0})).append("title").text(((t,e)=>`${Math.round(10*t.data)/10} (${Object(c.k)(this._speedDiff[e],1)}) knots`)))).select("circle").attr("fill",((t,e)=>{var a;return null!==(a=this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))&&void 0!==a?a:_.i}))}_injectTextComparison(){function e(t,e,a=0,s=!1){if(t===e)return"";let i,r,o="badge-danger";return s?(i=100*Number.parseFloat((e-t).toFixed(a)),r=Object(c.b)(Math.abs(i))):0===t||0===e?(i=e-t,r=Object(c.b)(Math.abs(i))):(i=1-t/e,r=Object(c.g)(Math.abs(i),0)),i<0&&(o="badge-success"),`<span class="badge ${o}">${r}</span>`}const a=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.h),s=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.m),i=Math.round(this._shipBaseData.crew.max*f.n),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.h),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.m),n=Math.round(this.shipCompareData.crew.max*f.n),d={morale:`${Object(c.d)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${Object(c.l)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${Object(c.d)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${Object(c.k)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${Object(c.k)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${Object(c.d)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${Object(c.d)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${Object(c.d)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${Object(c.l)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,reload:`${Object(c.l)(100*this.shipCompareData.gunnery.reload)} ${e(this._shipBaseData.gunnery.reload,this.shipCompareData.gunnery.reload,3,!0)}`,penetration:`${Object(c.l)(100*this.shipCompareData.gunnery.penetration)} ${e(this.shipCompareData.gunnery.penetration,this._shipBaseData.gunnery.penetration,3,!0)}`,dispersionHorizontal:`${Object(c.l)(100*this.shipCompareData.gunnery.dispersionHorizontal)} ${e(this._shipBaseData.gunnery.dispersionHorizontal,this.shipCompareData.gunnery.dispersionHorizontal,3,!0)}`,dispersionVertical:`${Object(c.l)(100*this.shipCompareData.gunnery.dispersionVertical)} ${e(this._shipBaseData.gunnery.dispersionVertical,this.shipCompareData.gunnery.dispersionVertical,3,!0)}`,traverseUpDown:`${Object(c.l)(100*this.shipCompareData.gunnery.traverseUpDown)} ${e(this.shipCompareData.gunnery.traverseUpDown,this._shipBaseData.gunnery.traverseUpDown,3,!0)}`,traverseSide:`${Object(c.l)(100*this.shipCompareData.gunnery.traverseSide)} ${e(this.shipCompareData.gunnery.traverseSide,this._shipBaseData.gunnery.traverseSide,3,!0)}`,acceleration:`${Object(c.b)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${Object(c.d)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:b.a.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${Object(c.b)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${Object(c.d)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${Object(c.b)(this.shipCompareData.ship.turnAcceleration)} ${e(this.shipCompareData.ship.turnAcceleration,this._shipBaseData.ship.turnAcceleration,2)}`,turnSpeed:`${Object(c.b)(this.shipCompareData.ship.turnSpeed,3)} ${e(this.shipCompareData.ship.turnSpeed,this._shipBaseData.ship.turnSpeed,2)}`,decks:Object(_.o)(this.shipCompareData.guns.decks,"deck"),firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${Object(c.d)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${Object(c.b)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${Object(c.d)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${Object(c.d)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${Object(c.d)(r)} <span class="badge badge-white">${Object(c.d)(r*f.k)}</span>`,leakResistance:`${Object(c.l)(100*this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(c.d)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(c.d)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(c.d)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${Object(c.d)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${Object(c.b)(this.shipCompareData.speed.max,3)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxWeight:`${Object(c.d)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:Object(c.d)(this.shipCompareData.crew.min),cannonCrew:`${Object(c.d)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${Object(c.d)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${Object(c.b)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${Object(c.d)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${Object(c.d)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${Object(c.d)(o)} <span class="badge badge-white">${Object(c.d)(o*f.k)}</span>`,rumRepairsNeeded:`${Object(c.d)(n)} <span class="badge badge-white">${Object(c.d)(n*f.k)}</span>`,sailingCrew:""+Object(c.d)(this.shipCompareData.crew.sailing),sails:`${Object(c.d)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:Object(h.q)(this.shipCompareData.class)+" rate",sideArmor:`${Object(c.d)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${Object(c.d)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${Object(c.l)(100*this.shipCompareData.resistance.splinter)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${Object(c.d)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${Object(c.d)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${Object(c.b)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${Object(c.d)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${Object(c.d)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${Object(c.d)((r+o+.1*n)*f.k)} ${e((a+s+.1*i)*f.k,(r+o+.1*n)*f.k)}`,d.gunsFront?d.gunsFront+=" "+b.a.pd(d.limitFront):d.gunsFront="–",d.gunsBack?d.gunsBack+=" "+b.a.pd(d.limitBack):d.gunsBack="–",t(""+this.select).find("div").append(b.a.getText(d))}}}).call(this,a(22))},117:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},118:function(t,e,a){(function(t){a.d(e,"a",(function(){return T}));a(44),a(84),a(87);var s=a(127),i=a(140),r=a(108),o=a(278),n=a(99),d=a(78),l=a(100),c=a.n(l),h=a(104),p=a.n(h),u=a(105),m=a.n(u),b=a(18),_=a(5),f=a(7),g=a(86),v=a(93),w=a(23),y=a(90),S=a(88),D=a(130),j=a(106),$=a(107);function O(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return C(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return C(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function I(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function k(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function A(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}c.a.extend(p.a),c.a.extend(m.a);var x=new WeakMap,M=new WeakMap;class T{constructor(t="ship-compare"){I(this,"colorScale",void 0),I(this,"colourScaleSpeedDiff",void 0),I(this,"columnsCompare",void 0),I(this,"innerRadius",void 0),I(this,"outerRadius",void 0),I(this,"radiusSpeedScale",void 0),I(this,"selectedShips",void 0),I(this,"singleShipData",void 0),I(this,"shipMassScale",void 0),I(this,"svgHeight",void 0),I(this,"svgWidth",void 0),I(this,"windProfileRotate",0),I(this,"woodCompare",void 0),x.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),I(this,"_maxSpeed",void 0),I(this,"_minSpeed",void 0),I(this,"_modal$",{}),I(this,"_modifierAmount",new Map),I(this,"_moduleAndWoodCaps",void 0),I(this,"_moduleAndWoodChanges",void 0),I(this,"_moduleDataDefault",void 0),I(this,"_moduleProperties",void 0),I(this,"_moduleTypes",void 0),I(this,"_selectedUpgradeIdsList",{}),I(this,"_selectedUpgradeIdsPerType",{}),I(this,"_selectModule$",{}),I(this,"_selectShip$",{}),I(this,"_selectWood$",{}),I(this,"_shipData",void 0),I(this,"_shipIds",{}),I(this,"_shipSelectData",void 0),I(this,"_baseId",void 0),I(this,"_baseName",void 0),I(this,"_buttonId",void 0),I(this,"_columns",void 0),I(this,"_copyButtonId",void 0),I(this,"_cloneLeftButtonId",void 0),I(this,"_cloneRightButtonId",void 0),I(this,"_imageButtonId",void 0),I(this,"_modalId",void 0),I(this,"_moduleId",void 0),I(this,"_woodId",void 0),this._baseId=t,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._cloneLeftButtonId="button-clone-left-"+this._baseId,this._cloneRightButtonId="button-clone-right-"+this._baseId,this._imageButtonId="button-image-"+this._baseId,this.colourScaleSpeedDiff=Object(n.a)().range([_.h,_.i,_.f]).interpolate(o.a),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(t){return t<=3?"L":t<=5?"M":"S"}static _adjustAbsolute(t,e){return t?t+e:e}static _adjustPercentage(t,e,a){return a?t?t*(1+e):e:t?t+e:e}static _getModifierFromModule(t){return`<p class="mb-0">${t.map((t=>{let e;return e=t.isPercentage?Object(g.m)(t.amount/100):t.amount<1&&t.amount>0?Object(g.f)(t.amount,1):Object(g.k)(t.amount,2),`${t.modifier} ${e}`})).join("<br>")}</p>`}static _setSelect(t,e){let a;a=Array.isArray(e)?e.map((t=>String(t))):String(e),a&&t.val(a),t.selectpicker("render")}static _saveCanvasAsImage(t){const e=`na-map ship compare ${c.a.utc().format("YYYY-MM-DD HH-mm-ss")}.png`,a=document.createElement("a");a.href=t,a.download=e,document.body.append(a),a.click(),a.remove()}_getShipId(t){return this._shipIds[t]}_setShip(t,e){this._shipIds[t]=e,T._setSelect(this._selectShip$[t],e),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects()}_cloneShipData(t,e){const a=this._getShipId(t);return a&&this._setShip(e,a),void 0!==a}_getWoodId(t,e){return Number(this._selectWood$[t][e].val())}_setWood(t,e,a){T._setSelect(this._selectWood$[t][e],a),this.woodCompare._woodSelected(t,e,this._selectWood$[t][e])}_cloneWoodData(t,e){if(this.woodCompare.enableSelects(e),""!==this._selectWood$[t].frame.val())for(const a of f.j){const s=this._getWoodId(t,a);this._setWood(e,a,s)}}_getModuleIds(t,e){return this._selectedUpgradeIdsPerType[t][e]}_setModules(t,e,a){var s;this._selectedUpgradeIdsPerType[t]||(this._selectedUpgradeIdsPerType[t]={}),this._selectedUpgradeIdsList[t]||(this._selectedUpgradeIdsList[t]=[]),this._selectedUpgradeIdsPerType[t][e]=a.map((t=>Number(t))),T._setSelect(this._selectModule$[t][e],this._selectedUpgradeIdsPerType[t][e]),(s=this._selectedUpgradeIdsList[t]).push.apply(s,O(this._selectedUpgradeIdsPerType[t][e]))}_cloneModuleData(t,e){if(this._setupModulesSelect(e),this._selectedUpgradeIdsPerType[t])for(const a of O(this._moduleTypes)){const s=this._getModuleIds(t,a);this._setModules(e,a,s)}}_cloneShipToLeft(t){const e=this._columns.findIndex((e=>e===t)),a=this._columns[e-1];this._cloneShipData(t,a)&&(this._cloneWoodData(t,a),this._cloneModuleData(t,a),this._refreshShips(a))}_cloneShipToRight(t){const e=this._columns.findIndex((e=>e===t)),a=this._columns[e+1];this._cloneShipData(t,a)&&(this._cloneWoodData(t,a),this._cloneModuleData(t,a),this._refreshShips(a))}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(t){var e;await this._loadAndSetupData();const a=v.f.decode(null!==(e=t.get("cmp"))&&void 0!==e?e:"");a.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(a),this._setModuleSelects(t))}_setupArrow(){const t=document.querySelector("#journey-arrow");if(t){const e=t.cloneNode(!0);if(e.id="wind-profile-arrow-head",e.hasChildNodes())for(const t of e.childNodes)t.classList.replace("journey-arrow-head","wind-profile-arrow-head");const a=document.querySelector("#na-map svg defs");a&&a.append(e)}}_setupData(){var t,e,a;this._moduleAndWoodChanges=new Map([["Cannon horizontal dispersion",{properties:["gunnery.dispersionHorizontal"],isBaseValueAbsolute:!0}],["Cannon vertical dispersion",{properties:["gunnery.dispersionVertical"],isBaseValueAbsolute:!0}],["Cannon reload time",{properties:["gunnery.reload"],isBaseValueAbsolute:!0}],["Cannon ball penetration",{properties:["gunnery.penetration"],isBaseValueAbsolute:!0}],["Cannon side traverse",{properties:["gunnery.traverseSide"],isBaseValueAbsolute:!0}],["Cannon up/down traverse",{properties:["gunnery.traverseUpDown"],isBaseValueAbsolute:!0}],["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Turn speed",{properties:["ship.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),A(this,x,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:1,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:18,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const r=1.2*(null!==(t=Object(s.a)(this._shipData,(t=>t.speed.min)))&&void 0!==t?t:0),d=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=r,this._maxSpeed=d,this.colorScale=Object(n.a)().domain([this._minSpeed,0,this._maxSpeed]).range([_.h,_.i,_.f]).interpolate(o.a);const l=null!==(e=Object(s.a)(this._shipData,(t=>t.shipMass)))&&void 0!==e?e:0,c=null!==(a=Object(i.a)(this._shipData,(t=>t.shipMass)))&&void 0!==a?a:0;this.shipMassScale=Object(n.a)().domain([l,c]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await a.e(7).then(a.t.bind(null,121,3))).default,this._shipData=(await a.e(12).then(a.t.bind(null,150,3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new D.a(this._woodId),await this.woodCompare.woodInit())}catch(t){Object(f.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(b.b)("Tools",this._baseName),this._shipCompareSelected()}))}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=t(`#${this._modalId} .column-base`).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(n.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(t){var e,a;return null!==(e=null===(a=this._shipData.find((e=>e.id===t)))||void 0===a?void 0:a.name)&&void 0!==e?e:""}_getSelectedData(t){const e={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[t]){e.ship=this._getShipName(this._shipIds[t]);for(const a of f.j)e.wood.push(this.woodCompare.getWoodName(a,Number(this._selectWood$[t][a].val())));if(this._selectedUpgradeIdsPerType[t])for(const i of O(this._moduleTypes)){const r=[];for(const e of this._selectedUpgradeIdsPerType[t][i]){var a,s;r.push(null!==(a=null===(s=this._moduleProperties.get(e))||void 0===s?void 0:s.name.replace(" Bonus",""))&&void 0!==a?a:"")}e.moduleData.set(i,r.join(", "))}}return e}_printSelectedData(t,e,a){const s=t.querySelectorAll(`#${this._baseId}-${a.toLowerCase()} label`),i=s[0].parentNode,r=s[0].offsetHeight;for(const t of s)t.remove();const o=Object(d.a)(i).insert("div",":first-child").style("height",5*r+"px");e.ship&&o.append("div").style("margin-bottom","5px").style("line-height","1.1").text(e.ship),""!==e.wood[0]&&o.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(e.wood.join(" | "));for(const[t,a]of e.moduleData)""!==a&&o.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${t}</em>: ${a}`)}_replaceSelectsWithText(t){for(const e of this._columns){const a=this._getSelectedData(e);this._printSelectedData(t,a,e)}}_setMakeImageSpinner(){k(this,M).select("i").remove(),k(this,M).attr("class","btn btn-primary").property("disabled",!0),k(this,M).append("span").attr("class","spinner-border spinner-border-sm").attr("role","status").attr("aria-hidden","true"),k(this,M).append("span").attr("class","sr-only").text("Loading...")}_unsetMakeImageSpinner(){k(this,M).selectAll("span").remove(),k(this,M).attr("class","btn btn-outline-secondary icon-outline-button").property("disabled",!1),k(this,M).append("i").attr("class","icon icon-image")}async _makeImage(t){t.preventDefault(),this._setMakeImageSpinner();const e=await a.e(20).then(a.t.bind(null,172,7)),s=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(s){const t=await e.default(s,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:t=>t.classList.contains("central")||t.classList.contains("overlay")||t.classList.contains("navbar"),logging:!0,onclone:t=>{this._replaceSelectsWithText(t)},x:0,y:0});T._saveCanvasAsImage(t.toDataURL())}this._unsetMakeImageSpinner()}_shipCompareSelected(){var e,a,s;Object(f.e)(this._modal$)&&(this._initModal(),this._modal$=t("#"+this._modalId),null===(e=document.querySelector("#"+this._modalId))||void 0===e||e.addEventListener("keydown",(t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyDataClicked(t)})),null===(a=document.querySelector("#"+this._copyButtonId))||void 0===a||a.addEventListener("click",(t=>{this._copyDataClicked(t)})),null===(s=document.querySelector("#"+this._imageButtonId))||void 0===s||s.addEventListener("click",(async t=>{Object(b.b)("Menu","Ship compare image"),await this._makeImage(t)})));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const t=[];for(const e of this._columns){const a=this._getShipId(e);if(a){t.push(a);for(const a of f.j){const s=this._getWoodId(e,a);t.push(s)}}}return t}_copyDataClicked(t){Object(b.b)("Menu","Copy ship compare"),t.preventDefault();const e=this._getShipAndWoodIds();if(e.length>0){const t=new URL(window.location.href);t.searchParams.set("v",encodeURIComponent(_.d)),t.searchParams.set("cmp",v.f.encode(e));for(const e of this._columns){const a=this._columns.indexOf(e);if(this._selectedUpgradeIdsPerType[e])for(const s of O(this._moduleTypes)){const i=this._getModuleIds(e,s),r=O(this._moduleTypes).indexOf(s);if(null==i?void 0:i.length){const e=`${a}${r}`;t.searchParams.set(e,v.f.encode(i))}}}Object(S.c)(t.href,this._modal$)}}_setupShipData(){this._shipSelectData=O(Object(r.a)(this._shipData,(t=>t.class))).map((([t,e])=>({key:t,values:e.map((t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns.total}))).sort(Object(y.b)(["name"]))}))).sort(Object(y.b)(["key"]))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap((t=>t[1].filter((t=>t.properties.some((t=>this._moduleAndWoodChanges.has(t.modifier))))).map((t=>[t.id,t]))))),this._moduleTypes=new Set(O(this._moduleProperties).map((t=>t[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,""))))}_injectModal(){Object(_.m)({id:this._modalId,title:this._baseName});const t=Object(d.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const e of this._columns){const a=t.append("div").attr("id",`${this._baseId}-${e.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp")),s=this._getShipSelectId(e),i=a.append("div").attr("class","input-group justify-content-between mb-1");e!==this._columns[0]&&i.append("div").attr("class","input-group-prepend").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneLeftButtonId}-${e}`).attr("title","Clone ship to left").attr("type","button").append("i").attr("class","icon icon-clone-left"),i.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker"),e!==this.columnsCompare[this.columnsCompare.length-1]&&i.append("div").attr("class","input-group-append").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneRightButtonId}-${e}`).attr("title","Clone ship to right").attr("type","button").append("i").attr("class","icon icon-clone-right");const r=a.append("div").attr("class","input-group justify-content-between mb-1");for(const t of f.j){const a=this._getWoodSelectId(t,e);r.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}const o=a.append("div").attr("class","input-group justify-content-between");for(const t of this._moduleTypes){const a=this._getModuleSelectId(t,e);o.append("label").attr("class","mb-1").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}a.append("div").attr("id",`${this._baseId}-${e}`).attr("class",("Base"===e?"ship-base":"ship-compare")+" compress")}const e=Object(d.a)(`#${this._modalId} .modal-footer`);e.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").attr("class","icon icon-copy"),A(this,M,e.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._imageButtonId).attr("title","Make image").attr("type","button")),k(this,M).append("i").attr("class","icon icon-image")}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const a of f.j)this._selectWood$[e][a]=t("#"+this._getWoodSelectId(a,e)),this.woodCompare._setupWoodSelects(e,a,this._selectWood$[e][a])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initCloneListeners(){for(const a of this._columns){var t,e;if(a!==this._columns[0])null===(t=document.querySelector(`#${this._cloneLeftButtonId}-${a}`))||void 0===t||t.addEventListener("click",(()=>{this._cloneShipToLeft(a)}));if(a!==this.columnsCompare[this.columnsCompare.length-1])null===(e=document.querySelector(`#${this._cloneRightButtonId}-${a}`))||void 0===e||e.addEventListener("click",(()=>{this._cloneShipToRight(a)}))}}_initModal(){this._initData(),this._injectModal(),this._initSelects(),this._initCloneListeners()}_getShipOptions(){return this._shipSelectData.map((t=>`<optgroup label="${Object(w.q)(Number(t.key),!1)} rate">${t.values.map((t=>`<option data-subtext="${t.battleRating} ${Object(v.i)(t.name)?"Imported":""}" value="${t.id}">${Object(v.o)(t.name)} (${t.guns})`)).join("</option>")}`)).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=t("#"+this._getShipSelectId(e));const a=this._getShipOptions();this._selectShip$[e].append(a),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(t,e){const a=O(this._moduleProperties).filter((a=>a[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===t&&("U"===a[1].moduleLevel||a[1].moduleLevel===T._getModuleLevel(e)))),s=O(Object(r.a)(a,(t=>t[1].type.replace(/[\sA-Za-z]+\s–\s/,"")))).map((([t,e])=>({key:t,values:e.sort(((t,e)=>t[1].name.localeCompare(e[1].name)))}))).sort(Object(y.b)(["key"]));let i;const o=new Set(["Permanent","Ship trim"]);return i=s.length>1?s.map((e=>`<optgroup label="${e.key}" data-max-options="${o.has(t.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${e.values.map((t=>`<option value="${t[0]}">${t[1].name}`)).join("</option>")}`)).join("</optgroup>"):s.map((t=>""+t.values.map((t=>`<option value="${t[0]}">${t[1].name}`)).join("</option>"))).join(""),i}_fillModuleSelect(t,e){const a=this._getUpgradesOptions(e,(()=>this._shipData.find((e=>e.id===this._shipIds[t])).class)());this._selectModule$[t][e].find("option").remove(),this._selectModule$[t][e].append(a)}_resetModuleSelects(t){for(const e of this._moduleTypes)this._fillModuleSelect(t,e),this._selectModule$[t][e].selectpicker("refresh")}_getModuleFromName(t){let e={};return this._moduleDataDefault.some((a=>(e=a[1].find((e=>e.name===t)),Boolean(e)))),e}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const a of this._moduleTypes){const s=new Map;this._selectModule$[e][a]=t("#"+this._getModuleSelectId(a,e)),this._selectModule$[e][a].on("changed.bs.select",(()=>{this._modulesSelected(e),this._refreshShips(e)})).on("show.bs.select",(e=>{const a=t(e.currentTarget);a.parent().find("button.bs-select-all").remove();for(const e of a.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const a=this._getModuleFromName(e.textContent);t(e).attr("data-original-title",T._getModifierFromModule(a.properties)).tooltip({boundary:"viewport",html:!0}).on("show.bs.tooltip",(()=>{s.set(a.id,t(e))})).on("hide.bs.tooltip",(()=>{s.set(a.id,null)}))}})).selectpicker({actionsBox:!0,countSelectedText:t=>`${t} ${a.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:a.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+a,width:"150px"}).on("hide.bs.select",(()=>{for(const[,t]of s)t&&t.tooltip("hide");s.clear()}))}}this._resetModuleSelects(e)}_getShipData(t){const e=this._shipData.find((e=>e.id===this._shipIds[t]));e.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:e.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:e.boarding.prepInitial,prepPerRound:e.boarding.prepPerRound};let a=e;return a.repairAmount={armour:v.g,armourPerk:0,sails:v.l,sailsPerk:0},a.repairTime={sides:v.j,default:v.j},a.resistance={leaks:0,splinter:0},a.gunnery={dispersionHorizontal:0,dispersionVertical:0,penetration:0,reload:0,traverseUpDown:0,traverseSide:0},a=this._addModulesAndWoodData(e,a,t),a}_roundPropertyValue(t,e,a=!1){return Number.isInteger(t)&&!a?Math.round(e):Math.trunc(100*e)/100}_adjustValue(t,e,a){var s,i;let r=t;if(0!==(null===(s=this._modifierAmount.get(e))||void 0===s?void 0:s.percentage)){const t=this._modifierAmount.get(e).percentage/100;r=T._adjustPercentage(r,t,a)}if(0!==(null===(i=this._modifierAmount.get(e))||void 0===i?void 0:i.absolute)){const{absolute:t}=this._modifierAmount.get(e);r=T._adjustAbsolute(r,t)}const o=k(this,x).has(e)||a||0===t;return this._roundPropertyValue(t,r,o)}_setModifier(t){let e=t.isPercentage?0:t.amount,a=t.isPercentage?t.amount:0;var s,i,r,o;this._modifierAmount.has(t.modifier)&&(e+=null!==(s=null===(i=this._modifierAmount.get(t.modifier))||void 0===i?void 0:i.absolute)&&void 0!==s?s:0,a+=null!==(r=null===(o=this._modifierAmount.get(t.modifier))||void 0===o?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(t.modifier,{absolute:e,percentage:a})}_showCappingAdvice(t,e){const a=`${this._baseId}-${t}-capping`;let s=document.querySelector("#"+a);if(!s){var i;s=document.createElement("p"),s.id=a,s.className="alert alert-warning";const e=document.querySelector(`#${this._baseId}-${t}`);null==e||null===(i=e.firstChild)||void 0===i||i.after(s)}s.innerHTML=O(e).join(", ")+" capped"}_removeCappingAdvice(t){const e=`${this._baseId}-${t}-capping`,a=document.querySelector("#"+e);a&&a.remove()}_addModulesAndWoodData(t,e,a){const s=JSON.parse(JSON.stringify(e)),i=()=>{s.speedDegrees=s.speedDegrees.map((t=>{const e=1+this._modifierAmount.get("Max speed").percentage/100,a=t>0?t*e:t/e;return Math.max(Math.min(a,this._maxSpeed),this._minSpeed)}))};return this._modifierAmount=new Map,(()=>{for(const t of this._selectedUpgradeIdsList[a]){const e=this._moduleProperties.get(t);for(const t of e.properties)this._moduleAndWoodChanges.has(t.modifier)&&this._setModifier(t)}if(this.woodCompare.instances[a]){let t="_woodData";"Base"!==a&&(t="_compareData");for(const e of f.j)for(const s of this.woodCompare.instances[a][t][e].properties)this._moduleAndWoodChanges.has(s.modifier)&&this._setModifier(s)}})(),(()=>{for(const[e]of this._modifierAmount.entries()){var t;if(null===(t=this._moduleAndWoodChanges.get(e))||void 0===t?void 0:t.properties){const{properties:t,isBaseValueAbsolute:a}=this._moduleAndWoodChanges.get(e);for(const i of t){const t=i.split(".");t.length>1?s[t[0]][t[1]]=this._adjustValue(s[t[0]][t[1]],e,a):s[t[0]]=this._adjustValue(s[t[0]],e,a)}}}})(),(()=>{const e={isCapped:!1,modifiers:new Set},i=(t,a,s,{amount:i,isPercentage:r})=>{const o=Math.min(a,r?this._roundPropertyValue(s,s*(1+i)):i);return a>o&&(e.isCapped=!0,e.modifiers.add(t)),o};for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(e)){const{cap:a}=this._moduleAndWoodCaps.get(e);for(const r of this._moduleAndWoodCaps.get(e).properties){const o=r.split(".");o.length>1?s[o[0]][o[1]]&&(s[o[0]][o[1]]=i(e,s[o[0]][o[1]],t[o[0]][o[1]],a)):s[o[0]]&&(s[o[0]]=i(e,s[o[0]],t[o[0]],a))}}e.isCapped?this._showCappingAdvice(a,e.modifiers):this._removeCappingAdvice(a)})(),this._modifierAmount.has("Max speed")&&i(),s}_updateDifferenceProfileNeeded(t){"Base"===t||Object(f.e)(this.selectedShips[t])||this.selectedShips[t].updateDifferenceProfile()}_updateSailingProfile(t){this._updateDifferenceProfileNeeded(t);for(const e of this.columnsCompare)e!==t&&this._updateDifferenceProfileNeeded(e)}_refreshShips(t){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find((e=>e.id===this._shipIds[t]));else{this._modulesSelected(t);const e=this._getShipData(t);if("Base"===t){this._setSelectedShip(t,new j.a(t,e,this));for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh"),Object(f.e)(this.selectedShips[t])||this._setSelectedShip(t,new $.a(t,e,this.selectedShips[t].shipCompareData,this))}else this._setSelectedShip(t,new $.a(t,this.selectedShips.Base.shipData,e,this));this._updateSailingProfile(t)}}_enableCompareSelects(){for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(t){this._selectedUpgradeIdsList[t]=[],this._selectedUpgradeIdsPerType[t]={};for(const e of this._moduleTypes)this._selectedUpgradeIdsPerType[t][e]=this._selectModule$[t][e].val(),Array.isArray(this._selectedUpgradeIdsPerType[t][e])?this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e].map((t=>Number(t))):this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e]?[Number(this._selectedUpgradeIdsPerType[t][e])]:[],this._selectedUpgradeIdsPerType[t][e].length>0&&(this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][e]))}_setupSelectListener(t){if(this._selectShip$[t].selectpicker({title:"Ship"}).on("changed.bs.select",(()=>{this._shipIds[t]=Number(this._selectShip$[t].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(t),this._refreshShips(t),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(t)})),"ship-journey"!==this._baseId)for(const e of f.j)this._selectWood$[t][e].on("changed.bs.select",(()=>{this.woodCompare._woodSelected(t,e,this._selectWood$[t][e]),this._refreshShips(t)})).selectpicker({title:"Wood "+e,width:"150px"})}_setShipAndWoodsSelects(t){let e=0;this._columns.some((a=>{if(!this._shipData.find((a=>a.id===t[e])))return!1;if(this._setShip(a,t[e]),e+=1,this.woodCompare.enableSelects(a),this._setupModulesSelect(a),t[e])for(const s of f.j)this._setWood(a,s,t[e]),e+=1;else e+=2;return this._refreshShips(a),e>=t.length}))}_setModuleSelects(t){for(const e of this._columns){const a=this._columns.indexOf(e);let s=!1;for(const i of O(this._moduleTypes)){const r=O(this._moduleTypes).indexOf(i);if(t.has(`${a}${r}`)){const o=v.f.decode(t.get(`${a}${r}`));this._setModules(e,i,o),s=!0}}s&&this._refreshShips(e)}}_getShipSelectId(t){return`${this._baseId}-${t}-select`}_getWoodSelectId(t,e){return`${this._woodId}-${t}-${e}-select`}_getModuleSelectId(t,e){return`${this._moduleId}-${t.replace(/\s/,"")}-${e}-select`}_setSelectedShip(t,e){this.selectedShips[t]=e}}}).call(this,a(22))},126:function(t,e,a){a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));const s=["loot","chests","items"],i=["crew","gunnery","hull","mast","sailing"]},130:function(t,e,a){(function(t){a.d(e,"a",(function(){return f}));a(84),a(87),a(95);var s=a(127),i=a(140),r=a(78),o=a(18),n=a(5),d=a(86),l=a(7),c=a(90);function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class m{constructor(t,e){u(this,"select",void 0),u(this,"_woodCompare",void 0),u(this,"_id",void 0),u(this,"_g",void 0),this._id=t,this._woodCompare=e,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(r.a)(this.select).select("g")}_setupMainDiv(){Object(r.a)(this.select+" div").remove(),Object(r.a)(this.select).append("div")}}class b extends m{constructor(t,e,a){super(t,a),u(this,"_woodData",void 0),this._woodData=e,this._printText()}_getProperty(t,e){const a=this._woodData[e].properties.find((e=>e.modifier===t));let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getPropertySum(t){const e=this._getProperty(t,"frame"),a=this._getProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';e+="<tr>",e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,n]of t.properties){if(e+=`<tr><td>${o}</td><td>${n.isPercentage?Object(d.g)(n.amount/100):Object(d.b)(n.amount)}`,e+='<span class="rate">',n.amount>0){var a,s;e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${n.amount/(null!==(a=null===(s=this._woodCompare.minMaxProperty.get(o))||void 0===s?void 0:s.max)&&void 0!==a?a:1)*50}%;"></span>`}else if(n.amount<0){var i,r;const t=n.amount/(null!==(i=null===(r=this._woodCompare.minMaxProperty.get(o))||void 0===r?void 0:r.min)&&void 0!==i?i:1)*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getPropertySum(t);e.properties.set(t,{amount:a.amount,isPercentage:a.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class _ extends m{constructor(t,e,a,s){super(t,s),u(this,"_baseData",void 0),u(this,"_compareData",void 0),this._baseData=e,this._compareData=a,this._printTextComparison()}static _getDiff(t,e,a,s=1){const i=Number.parseFloat((t-e).toFixed(s));return`${a?Object(d.g)(t/100,s):Object(d.b)(t)} <span class="badge badge-white">${Object(d.k)(i)}</span>`}_getBaseProperty(t,e){const a=this._baseData[e].properties.find((e=>e.modifier===t));let s=0,i=!1;return(null==a?void 0:a.amount)&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getBasePropertySum(t){const e=this._getBaseProperty(t,"frame"),a=this._getBaseProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:a.isPercentage}}_getCompareProperty(t,e){const a=this._compareData[e].properties.find((e=>e.modifier===t));let s=0,i=!1;return(null==a?void 0:a.amount)&&(s=a.amount,i=a.isPercentage),{amount:s,isPercentage:i}}_getComparePropertySum(t){const e=this._getCompareProperty(t,"frame"),a=this._getCompareProperty(t,"trim");return{amount:e.amount+a.amount,isPercentage:e.isPercentage&&a.isPercentage}}_getText(t){const e=50;let a=0,s=0,i=0,r="",o='<table class="table table-sm table-striped small wood mt-4"><thead>';o+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[g,v]of t.properties){var n,d,l,c;if(o+=`<tr><td>${g}</td><td>${_._getDiff(v.compare,v.base,v.isPercentage)}`,o+='<span class="rate">',v.compare>=0)v.base>=0?v.compare>v.base?(a=v.base,s=v.compare-v.base,r="pos"):(a=v.compare,s=v.base-v.compare,r="neg"):(a=0,s=v.compare,r="pos"),o+='<span class="bar neutral" style="width:50%;"></span>',o+=`<span class="bar pos diff" style="width:${a/(null!==(n=null===(d=this._woodCompare.minMaxProperty.get(g))||void 0===d?void 0:d.max)&&void 0!==n?n:1)*e}%;"></span>`,o+=`<span class="bar ${r}" style="width:${s/(null!==(l=null===(c=this._woodCompare.minMaxProperty.get(g))||void 0===c?void 0:c.max)&&void 0!==l?l:1)*e}%;"></span>`;else if(v.compare<0){var h,p,u,m,b,f;v.base<0?v.compare>=v.base?(a=v.compare,s=v.base-v.compare,i=-v.base,r="pos"):(a=v.base,s=v.compare-v.base,i=-v.compare,r="neg"):(a=0,s=v.compare,i=-v.compare,r="neg"),o+=`<span class="bar neutral" style="width:${e+i/(null!==(h=null===(p=this._woodCompare.minMaxProperty.get(g))||void 0===p?void 0:p.min)&&void 0!==h?h:1)*e}%;"></span>`,o+=`<span class="bar ${r}" style="width:${s/(null!==(u=null===(m=this._woodCompare.minMaxProperty.get(g))||void 0===m?void 0:m.min)&&void 0!==u?u:1)*e}%;"></span>`,o+=`<span class="bar neg diff" style="width:${a/(null!==(b=null===(f=this._woodCompare.minMaxProperty.get(g))||void 0===f?void 0:f.min)&&void 0!==b?b:1)*e}%;"></span>`}else o+='<span class="bar neutral"></span>';o+="</span></td></tr>"}return o+="</tbody></table>",o}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getBasePropertySum(t),s=this._getComparePropertySum(t);e.properties.set(t,{base:a.amount,compare:s.amount,isPercentage:a.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class f{constructor(t){u(this,"baseFunction",void 0),u(this,"instances",{}),u(this,"minMaxProperty",new Map),u(this,"propertyNames",void 0),u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_woodData",void 0),u(this,"_columnsCompare",void 0),u(this,"_defaultWoodId",{}),u(this,"_columns",void 0),u(this,"_frameSelectData",void 0),u(this,"_trimSelectData",void 0),u(this,"_options",{}),u(this,"_woodIdsSelected",{}),this.baseFunction=t,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find((t=>t.id===e)))||void 0===s?void 0:s.name)&&void 0!==a?a:""}_findWoodId(t,e){var a,s;return null!==(a=null===(s=this._woodData[t].find((t=>t.name===e)))||void 0===s?void 0:s.id)&&void 0!==a?a:0}_setupData(){this.propertyNames=new Set([].concat(h(this._woodData.frame.flatMap((t=>t.properties.map((t=>t.modifier))))),h(this._woodData.trim.flatMap((t=>t.properties.map((t=>t.modifier)))))).sort(c.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await a.e(13).then(a.t.bind(null,133,3))).default,this._setupData()}catch(t){Object(l.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),this._woodCompareSelected()}))}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(c.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(c.b)(["name"])),this._setOption(this._frameSelectData.map((t=>`<option value="${t.id}">${t.name}</option>`)).toString(),this._trimSelectData.map((t=>`<option value="${t.id}">${t.name}</option>`)).toString());for(const o of this.propertyNames){var t,e,a,r;const n=h(this._woodData.frame.map((t=>{var e,a;return null!==(e=null===(a=t.properties.find((t=>t.modifier===o)))||void 0===a?void 0:a.amount)&&void 0!==e?e:0}))),d=h(this._woodData.trim.map((t=>{var e,a;return null!==(e=null===(a=t.properties.find((t=>t.modifier===o)))||void 0===a?void 0:a.amount)&&void 0!==e?e:0}))),l=null!==(t=Object(s.a)(n))&&void 0!==t?t:0,c=null!==(e=Object(i.a)(n))&&void 0!==e?e:0,p=null!==(a=Object(s.a)(d))&&void 0!==a?a:0,u=null!==(r=Object(i.a)(d))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:l+p>=0?0:l+p,max:c+u})}}_injectModal(){Object(n.m)({id:this._modalId,title:this._baseName});const t=Object(r.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const e of this._columns){const a=t.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp"));for(const t of l.j){const s=`${this.baseFunction}-${t}-${e}-select`;a.append("label").attr("for",s),a.append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}a.append("div").attr("id",`${this.baseFunction}-${e}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const a of l.j){const s=t(`#${this.baseFunction}-${a}-${e}-select`);this._setupWoodSelects(e,a,s),this._setupSelectListener(e,a,s)}}_setWoodsSelected(t,e,a){this._woodIdsSelected[t]||(this._woodIdsSelected[t]={}),this._woodIdsSelected[t][e]=a}_setupWoodSelects(t,e,a){this._setWoodsSelected(t,e,this._defaultWoodId[e]),a.append(this._options[e]),("wood"!==this.baseFunction||"Base"!==t&&"wood"===this.baseFunction)&&a.attr("disabled","disabled")}_setOtherSelect(e,a){const s="frame"===a?"trim":"frame";this._woodIdsSelected[e][s]===this._defaultWoodId[s]&&t(`#${this.baseFunction}-${s}-${e}-select`).val(this._defaultWoodId[s]).selectpicker("refresh")}enableSelects(e){for(const a of l.j)t(`#${this.baseFunction}-${a}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(t,e,a){const s=Number(a.val());if(this._setWoodsSelected(t,e,s),this._setOtherSelect(t,e),"Base"===t){this._addInstance(t,new b("Base",this._getWoodData("Base"),this));for(const t of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(t),this.instances[t]&&this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}else this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,a){a.on("change",(()=>this._woodSelected(t,e,a))).selectpicker({title:"Select "+e})}_getWoodData(t){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[t].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[t].trim)}}_addMinMaxProperty(t,e){this.minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this.instances[t]=e}getWoodTypeData(t,e){var a;return null!==(a=this._woodData[t].find((t=>t.id===e)))&&void 0!==a?a:{}}}}).call(this,a(22))},145:function(t,e,a){a(101),a(106),a(107);var s=a(118);a.d(e,"a",(function(){return s.a}))},215:function(t,e,a){(function(t){a.d(e,"a",(function(){return h}));a(84),a(87);var s=a(78),i=(a(95),a(18)),r=a(5),o=a(7),n=a(86),d=a(93),l=a(90);function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class h{constructor(){c(this,"_baseName",void 0),c(this,"_baseId",void 0),c(this,"_buttonId",void 0),c(this,"_modalId",void 0),c(this,"_buildingData",void 0),this._baseName="List buildings",this._baseId="building-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._buildingData=[],this._setupListener()}async _loadAndSetupData(){try{this._buildingData=(await a.e(3).then(a.t.bind(null,234,3))).default}catch(t){Object(o.g)(t)}}_setupListener(){let t=!0;document.querySelector("#"+this._buttonId).addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._buildingListSelected()}))}_injectModal(){Object(r.m)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return""+this._buildingData.sort(Object(l.b)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){const e=t(`#${this._baseId}-select`);e.addClass("selectpicker").on("change",(t=>this._buildingSelected(t))).selectpicker({noneSelectedText:"Select building"}),e.val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getBuildingData(t){return this._buildingData.find((e=>e.name===t))}_getProductText(t){let e="";return t.result&&(t.result.length>1?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.result.map((t=>t.name)).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.result[0].name}</h5>`,t.result[0].price&&(e+='<table class="table table-sm card-table"><tbody>',e+=`<tr><td>${Object(d.e)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm card-table"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td class="text-left">`,e+=a.materials.map((t=>`${Object(n.d)(t.amount)} ${t.item}`)).join("<br>"),e+="</td>",e+=`<td>${Object(n.d)(a.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour cost (%)</th><th>Storage</th><th>Build price (reales)</th></tr>",e+="</thead><tbody>";for(const a of t.levels){e+=`<tr><td>${t.levels.indexOf(a)+1}</td><td>${Object(n.d)(a.production)}</td><td>${Object(n.d)(-100*a.labourDiscount)}</td><td>${Object(n.d)(a.maxStorage)}</td><td>${Object(n.d)(a.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-5"><div class="card-header">Product</div>',a+='<div class="card-body product">',a+=this._getProductText(e),a+="</div></div>",a+='<div class="card col-7"><div class="card-header">Requirements</div>',a+='<div class="card-body px-0 requirements">',a+=this._getRequirementText(e),a+="</div></div>",a+="</div>",a}_buildingSelected(e){const a=String(t(e.currentTarget).find(":selected").val());Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("buildings mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a(22))},216:function(t,e,a){(function(t){a.d(e,"a",(function(){return h}));a(44),a(84),a(217),a(87);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86);function d(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function c(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class h{constructor(){c(this,"_rows",{}),c(this,"_sortAscending",{}),c(this,"_sortIndex",{}),c(this,"_switchesSel",{}),c(this,"_tables",{}),c(this,"_groupOrder",["name","damage","penetration","generic","family"]),c(this,"_cannonData",{}),c(this,"_cannonDataDefault",{}),c(this,"_baseName",void 0),c(this,"_baseId",void 0),c(this,"_buttonId",void 0),c(this,"_checkboxId",void 0),c(this,"_modalId",void 0),c(this,"_header",void 0),this._baseName="List cannons",this._baseId="cannon-list",this._buttonId="button-"+this._baseId,this._checkboxId="checkbox-"+this._baseId,this._modalId="modal-"+this._baseId,this._header={group:new Map,element:new Set},this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(4).then(a.t.bind(null,235,3))).default;this._setupData(t)}catch(t){Object(r.g)(t)}}_getFormattedName(t){let e=t;const a=t.split(" "),s="c"+a[0].padStart(3,"0"),i=a[1]?a[1][1]:"0";return a.length>1&&(e=`${a[0]} <em>${a[1]}</em>`),{value:`${s}${i}`,formattedValue:e}}_setupData(t){const e=Object.entries(t.long[0]).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,a]of e)if("name"===t)this._header.group.set("",1),this._header.element.add("Lb");else if("family"!==t){this._header.group.set(Object(r.c)(t),Object.entries(a).length);for(const t of Object.keys(a))this._header.element.add(Object(r.c)(t))}for(const e of r.b)this._cannonDataDefault[e]=t[e].map((t=>{const e=[],a=Object.entries(t).sort(((t,e)=>this._groupOrder.indexOf(t[0])-this._groupOrder.indexOf(e[0])));for(const[t,i]of a)if("name"===t)e.push(this._getFormattedName(i));else if("family"!==t)for(const[,t]of Object.entries(i)){var s;e.push({value:t.value,formattedValue:0===t.value?"":Object(n.c)(t.value,null!==(s=t.digits)&&void 0!==s?s:0)})}return{family:t.family,data:e}}))}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._cannonListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const s=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t[e].value.localeCompare(a[e].value)*s:(t[e].value-a[e].value)*s))}_addNavPills(t){const e=t.append("ul").attr("class","nav nav-pills").attr("role","tablist");for(const[t,a]of r.b.entries())e.append("li").attr("class","nav-item").attr("role","presentation").append("a").attr("class","nav-link"+(0===t?" active":"")).attr("id",`tab-${this._baseId}-${a}`).attr("href",`#tab-content-${this._baseId}-${a}`).attr("data-toggle","tab").attr("role","tab").attr("aria-controls",`${this._baseId}-${a}`).attr("aria-selected",""+(0===t?"true":"false")).text(Object(r.c)(a))}_injectSwitches(t,e){const a=t.append("div").attr("class","mb-3");for(const t of r.a[e]){const s=a.append("div").attr("class","custom-control custom-switch custom-control-inline");s.append("input").attr("id",`${this._checkboxId}-${e}-${t}`).attr("name",`${this._checkboxId}-${e}`).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),s.append("label").attr("for",`${this._checkboxId}-${e}-${t}`).attr("class","custom-control-label").text(Object(r.c)(t))}this._switchesSel[e]=d(document.querySelectorAll(`input[name=${this._checkboxId}-${e}]`));for(const t of this._switchesSel[e])t.addEventListener("change",(t=>{t.preventDefault(),this._cannonFamilySelected(e)}))}_injectTableStructure(t,e){this._sortAscending[e]=!0,this._tables[e]=t.append("table").attr("class","table table-sm small na-table");const a=this._tables[e].append("thead");a.append("tr").attr("class","thead-group").selectAll("th").data(d(this._header.group)).join("th").classed("border-bottom-0",((t,e)=>0===e)).classed("text-center",((t,e)=>0!==e)).attr("colspan",(t=>""+t[1])).attr("scope","col").text((t=>t[0])),a.append("tr").selectAll("th").data(d(this._header.element)).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",((t,e)=>0===e)).classed("text-right",((t,e)=>0!==e)).text((t=>t.data)).on("click",((t,a)=>{this._sortRows(e,a.index)})),this._tables[e].append("tbody")}_insertTabContent(t,e,a){this._sortAscending[e]=!0;const s=t.append("div").attr("class","tab-pane fade"+(0===a?" show active":"")).attr("id",`tab-content-${this._baseId}-${e}`).attr("href",`#tab-content-${this._baseId}-${e}`).attr("role","tabpanel").attr("aria-labelledby",`${this._baseId}-${e}-tab`).append("div").attr("id",e+"-list");this._injectSwitches(s,e),this._injectTableStructure(s,e)}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=Object(s.a)(`#${this._modalId} .modal-body`);this._addNavPills(t);const e=t.append("div").attr("class","tab-content pt-2");for(const[t,a]of r.b.entries())this._sortIndex[a]=0,this._insertTabContent(e,a,t),this._cannonFamilySelected(a)}_initModal(){this._injectModal()}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._cannonData[t],(t=>t[0].formattedValue)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t.formattedValue))))}_cannonFamilySelected(t){const e=new Set;for(const a of this._switchesSel[t])if(a.checked){const s=a.id.replace(`${this._checkboxId}-${t}-`,"");e.add(s)}this._cannonData[t]=this._cannonDataDefault[t].filter((t=>e.has(t.family))).map((t=>t.data)),this._updateTable(t),this._sortRows(t,this._sortIndex[t],!1)}_cannonListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}}}).call(this,a(22))},218:function(t,e,a){(function(t){a.d(e,"a",(function(){return u}));a(84),a(87),a(125);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(90),l=a(88);function c(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class u{constructor(){p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_moduleData",{}),p(this,"_ingredientData",{}),this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(7).then(a.t.bind(null,121,3))).default,this._ingredientData=(await a.e(10).then(a.t.bind(null,173,3))).default.ingredient}catch(t){Object(r.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._ingredientListSelected()}))}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName});Object(s.a)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getProperties(t){let e,a="",s="";for(const e of this._moduleData){const i=e[1].sort(Object(d.b)(["name"])).filter((e=>e.name===t));for(const t of i)a=e[0],s=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?Object(n.m)(t.amount/100):Object(n.l)(t.amount);return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return e=`<h6 class='text-muted text-left'>${a}</h6>`,e+=`<table class='table table-sm'><tbody>${s}</tbody></table>`,s?e:""}_getRows(){return this._ingredientData.map((t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map((t=>{const e=this._getProperties(t);return e?`<a data-toggle="tooltip" title="${e}">${t}</a>`:t})).join("<br>")}</td></tr>`))}_getText(){const t=this._getRows(),e=Object(l.a)(t,2);let a="";for(const t of c(new Array(e.length).keys()))a+=`<div class="col-md-${Math.floor(12/e.length)}">`,a+='<table class="table table-sm na-table"><thead>',a+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",a+=e[t].join(""),a+="</tbody></table></div>";return a}_injectList(){Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("row",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText()),t('[data-toggle="tooltip"]').tooltip({html:!0,placement:"auto",sanitize:!1})}}}).call(this,a(22))},219:function(t,e,a){(function(t){a.d(e,"a",(function(){return k}));a(84),a(87),a(95);var s=a(111),i=a(110),r=a(18),o=a(7),n=a(86),d=a(93),l=a(90),c=a(126);function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function m(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}const b=i.a.bind(s.a);var _=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakMap,S=new WeakMap,D=new WeakMap,j=new WeakMap,$=new WeakMap,O=new WeakMap,C=new WeakMap,I=new WeakMap;class k{constructor(){_.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:c.a}),y.set(this,{writable:!0,value:""}),S.set(this,{writable:!0,value:{}}),D.set(this,{writable:!0,value:{}}),j.set(this,{writable:!0,value:0}),$.set(this,{writable:!0,value:void 0}),O.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),m(this,_,"List loot and chests"),m(this,f,"loot-list"),m(this,g,"button-"+u(this,f)),m(this,v,"modal-"+u(this,f));for(const t of u(this,w))u(this,S)[t]=`${u(this,f)}-${t}-select`;this._setupListener()}static _printAmount(t){return t.min===t.max?Object(n.d)(t.min):`${Object(n.d)(t.min)} to ${Object(n.d)(t.max)}`}static _printChance(t){return Object(n.d)(100*(1-t))}async _loadAndSetupData(){try{const t=(await a.e(6).then(a.t.bind(null,236,3))).default;m(this,C,t.loot),m(this,I,t.chests)}catch(t){Object(o.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+u(this,g)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",u(this,_)),this._sourceListSelected()}))}_getLootOptions(){return b`
            ${u(this,C).sort(Object(l.b)(["name"])).map((t=>b`<option value="${t.id}">${t.name}</option>`))}
        `}_getChestsOptions(){return b`
            ${u(this,I).sort(Object(l.b)(["name"])).map((t=>b`<option value="${t.id}">${t.name}</option>`))}
        `}_getItemsOptions(){const t=new Map,e=(e,a,s)=>{const i=new Map([[e.id,{id:e.id,name:e.name,chance:s,amount:a.amount}]]);t.set(a.id,{name:a.name,sources:t.has(a.id)?new Map([].concat(h(t.get(a.id).sources),h(i))):i})};for(const t of u(this,C)){const{items:a}=t;for(const s of a)e(t,s,s.chance)}for(const t of u(this,I))for(const a of t.itemGroup){const{items:s}=a;for(const i of s)e(t,i,a.chance)}return m(this,O,new Map(h(t.entries()).sort(((t,e)=>t[1].name.localeCompare(e[1].name))))),b`${h(u(this,O)).map((t=>b`<option value="${t[0]}">${t[1].name}</option>`))}`}_getOptions(t){let e=b``;return"items"===t&&(e=this._getItemsOptions()),"chests"===t&&(e=this._getChestsOptions()),"loot"===t&&(e=this._getLootOptions()),e}_getModalBody(){return b`
            ${u(this,w).map((t=>b`
                        <label>
                            <select id="${u(this,S)[t]}" class="selectpicker">
                                ${this._getOptions(t)}
                            </select>
                        </label>
                    `))}
            <div id="${u(this,f)}"></div>
        `}_getModalFooter(){return b` <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> `}_injectModal(){Object(s.b)(Object(d.c)({id:u(this,v),title:u(this,_),size:"modal-md",body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"))}_setupSelectListeners(){for(const t of u(this,w))u(this,D)[t].on("change",(()=>{m(this,y,t),this._itemSelected()})).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select "+t,virtualScroll:!0})}_initModal(){this._injectModal(),m(this,$,document.querySelector("#"+u(this,f)));for(const e of u(this,w))u(this,D)[e]=t("#"+u(this,S)[e]);this._setupSelectListeners()}_sourceListSelected(){document.querySelector("#"+u(this,v))||this._initModal(),t("#"+u(this,v)).modal("show")}_getLootItemsText(t,e=!0){return b`
            <table class="table table-sm small na-table no-sort">
                <thead>
                    <tr>
                        <th scope="col">Item</th>
                        ${e?b`<th scope="col" class="text-right">Chance (0 − 100)</th>`:""}
                        <th scope="col" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map((t=>b`
                                <tr>
                                    <td>${t.name}</td>
                                    ${e?b` <td class="text-right">
                                              ${k._printChance(t.chance)}
                                          </td>`:""}
                                    <td class="text-right">${k._printAmount(t.amount)}</td>
                                </tr>
                            `))}
                </tbody>
            </table>
        `}_getSourceText(){const t=h(u(this,O).get(u(this,j)).sources).map((t=>t[1])).sort(Object(l.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getChestsText(){const t=u(this,I).find((t=>t.id===u(this,j)));return b`
            <p>Weight ${Object(n.d)(t.weight)} tons<br />Lifetime ${Object(n.d)(t.lifetime)} hours</p>
            ${t.itemGroup.map((t=>b` <h5>Group chance: ${k._printChance(t.chance)}</h5>
                    ${this._getLootItemsText(t.items.sort(Object(l.b)(["name"])),!1)}`))}
        `}_getLootText(){const t=u(this,C).find((t=>t.id===u(this,j))).items.sort(Object(l.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getText(){return"items"===u(this,y)?this._getSourceText():"chests"===u(this,y)?this._getChestsText():this._getLootText()}_getTable(){return b` <div class="mt-4">${this._getText()}</div> `}_resetOtherSelects(){const t=u(this,w).filter((t=>t!==u(this,y)));for(const e of t)u(this,D)[e].val("default").selectpicker("refresh")}_itemSelected(){const t=u(this,D)[u(this,y)].find(":selected");m(this,j,Number(t.val())),this._resetOtherSelects(),Object(s.b)(this._getTable(),u(this,$))}}}).call(this,a(22))},220:function(t,e,a){(function(t){a.d(e,"a",(function(){return m}));a(84),a(87),a(95);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(23),l=a(90),c=a(88);function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function u(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class m{constructor(){u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_moduleData",{}),this._baseName="List modules",this._baseId="module-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(7).then(a.t.bind(null,121,3))).default}catch(t){Object(r.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._moduleListSelected()}))}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId)}_getOptions(){return""+this._moduleData.map((t=>`<option value="${t[0]}"">${t[0]}</option>;`)).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._moduleSelected(t))).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRows(t){const e=new Map([["L",`${Object(d.q)(1)} – ${Object(d.q)(3)}`],["M",`${Object(d.q)(4)} – ${Object(d.q)(5)}`],["S",`${Object(d.q)(6)} – ${Object(d.q)(7)}`]]),a=t=>{var a;return"U"===t?"":""+(null!==(a=e.get(t))&&void 0!==a?a:"")},s=(t,e)=>void 0!==e&&t.name===e.name&&JSON.stringify(t.properties)===JSON.stringify(e.properties);let i="";const r=[];for(const e of this._moduleData)e[0]===t&&e[1].sort(Object(l.b)(["name"])).forEach(((t,o)=>{i=a(t.moduleLevel),s(t,e[1][o+1])&&(e[1][o+1].hasSamePropertiesAsPrevious=!0,i+="<br>"+a(e[1][o+1].moduleLevel)),s(t,e[1][o+2])&&(e[1][o+2].hasSamePropertiesAsPrevious=!0,i=""),void 0!==t.hasSamePropertiesAsPrevious&&t.hasSamePropertiesAsPrevious||r.push(`<tr><td><span class="name">${t.name}<br>${i}</span></td><td>${t.properties.map((t=>{let e;return e=t.isPercentage?Object(n.m)(t.amount/100):t.amount<1&&t.amount>0?Object(n.f)(t.amount,1):Object(n.l)(t.amount),`${t.modifier} ${e}`})).join("<br>")}</td></tr>`)}));return r}_getText(t){const e=this._getRows(t),a=Object(c.a)(e,3);let s="";for(const t of h(new Array(a.length).keys()))s+=`<div class="col-md-${Math.floor(12/a.length)}">`,s+='<table class="table table-sm small na-table"><thead>',s+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",s+=a[t].join(""),s+="</tbody></table></div>";return s}_moduleSelected(e){const a=t(e.currentTarget).find(":selected").val();Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("row mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a(22))},221:function(t,e,a){(function(t){a.d(e,"a",(function(){return k}));a(84),a(87);var s=a(78),i=a(100),r=a.n(i),o=(a(162),a(104)),n=a.n(o),d=a(163),l=a.n(d),c=a(105),h=a.n(c),p=a(18),u=a(7),m=a(5),b=a(88);function _(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function f(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}r.a.extend(n.a),r.a.extend(l.a),r.a.extend(h.a),r.a.locale("en-gb");var g=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakMap,S=new WeakMap,D=new WeakMap,j=new WeakMap,$=new WeakMap,O=new WeakMap,C=new WeakMap,I=new WeakMap;class k{constructor(t){g.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:{}}),O.set(this,{writable:!0,value:!0}),C.set(this,{writable:!0,value:0}),I.set(this,{writable:!0,value:{}}),f(this,w,t),f(this,y,"List of port battles"),f(this,S,"pb-list"),f(this,D,"button-"+_(this,S)),f(this,g,"table-"+_(this,S)),f(this,j,"modal-"+_(this,S)),this._setupListener()}async _loadAndSetupData(){try{const t=await(await fetch(`data/${_(this,w)}-pb.json`)).json();f(this,v,t.filter((t=>1===t.attackHostility)).map((t=>{var e,a,s,i;const o=r.a.utc(t.portBattle).local(),n=r.a.utc(t.portBattle),d=n===o?"":` (${o.format("H.mm")} local)`,l=null===(e=Object(u.d)(t.nation))||void 0===e?void 0:e.name,c=t.capturer?`${null!=l?l:""} (${Object(b.d)(t.capturer)})`:null!=l?l:"";return{sort:null!==(a=t.portBattle)&&void 0!==a?a:"",data:[`${Object(u.c)(n.fromNow())} at ${n.format("H.mm")} ${d}`,t.name,`${null!==(s=null==t?void 0:t.attackerNation)&&void 0!==s?s:""} (${Object(b.d)(null!==(i=null==t?void 0:t.attackerClan)&&void 0!==i?i:"")})`,c]}})))}catch(t){Object(u.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+_(this,D)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(p.b)("Tools",_(this,y)),this._pbListSelected()}))}_sortRows(t,e=!0){e&&_(this,C)===t&&f(this,O,!_(this,O)),f(this,C,t);const a=_(this,O)?1:-1;_(this,$).sort(((e,s)=>0===t?e.sort.localeCompare(s.sort)*a:e.data[t].localeCompare(s.data[t])*a))}_initTable(){_(this,I).append("thead").append("tr").selectAll("th").data(["Time","Port","Attacker","Defender"]).join("th").datum(((t,e)=>({data:t,index:e}))).attr("role","columnheader").text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),_(this,I).append("tbody")}_injectModal(){Object(m.m)({id:_(this,j),title:_(this,y),size:"modal-lg"});const t=Object(s.a)(`#${_(this,j)} .modal-body`);f(this,I,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){f(this,$,_(this,I).select("tbody").selectAll("tr").data(_(this,v),(t=>t.sort)).join((t=>t.append("tr")))),_(this,$).selectAll("td").data((t=>t.data)).join((t=>t.append("td").html((t=>t))))}_pbListSelected(){document.querySelector("#"+_(this,j))||this._initModal(),t("#"+_(this,j)).modal("show")}}}).call(this,a(22))},222:function(t,e,a){(function(t){a.d(e,"a",(function(){return O}));a(84),a(87);var s=a(165),i=a(78),r=a(18),o=a(7),n=a(5),d=a(126);function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function h(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function p(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}var u=new WeakMap,m=new WeakMap,b=new WeakMap,_=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakMap,S=new WeakMap,D=new WeakMap,j=new WeakMap,$=new WeakMap;class O{constructor(t){u.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:{}}),v.set(this,{writable:!0,value:{}}),w.set(this,{writable:!0,value:{}}),y.set(this,{writable:!0,value:{}}),S.set(this,{writable:!0,value:{}}),D.set(this,{writable:!0,value:!0}),j.set(this,{writable:!0,value:0}),$.set(this,{writable:!0,value:{}}),p(this,f,t),p(this,m,"List port bonuses"),p(this,u,"port-bonus-list"),p(this,b,"button-"+h(this,u)),p(this,_,"modal-"+h(this,u)),this._setupListener()}async _loadData(){try{p(this,g,await(await fetch(`data/${h(this,f)}-ports.json`)).json()),p(this,w,await(await fetch(`data/${h(this,f)}-pb.json`)).json()),p(this,v,(await a.e(9).then(a.t.bind(null,149,3))).default)}catch(t){Object(o.g)(t)}}_setupData(){const t=[0,1,3,7,15],e={};for(const t of d.b)e[t]=0;const a=new Map(h(this,v).map((t=>[t.id,{name:t.name,points:t.portPoints}]))),i=new Map(h(this,w).map((t=>[t.id,t.nation])));p(this,y,h(this,g).filter((t=>t.portBonus)).map((r=>{var n,d,l,c,h,p,u;return{id:r.id,name:null!==(n=null===(d=a.get(r.id))||void 0===d?void 0:d.name)&&void 0!==n?n:"",nation:null!==(l=null===(c=Object(o.d)(null!==(h=i.get(r.id))&&void 0!==h?h:""))||void 0===c?void 0:c.name)&&void 0!==l?l:"",portBonusLevel:Object.values({...e,...r.portBonus}),points:null!==(p=null===(u=a.get(r.id))||void 0===u?void 0:u.points)&&void 0!==p?p:0,pointsInvested:Object(s.a)(Object.values(r.portBonus).map((e=>t[e])))}})))}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+h(this,b)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",h(this,m)),this._listSelected()}))}_sortRows(t,e=!0){e&&h(this,j)===t&&p(this,D,!h(this,D)),p(this,j,t);const a=h(this,D)?1:-1;h(this,S).sort(((e,s)=>0===t?e.name.localeCompare(s.name)*a:1===t?e.nation.localeCompare(s.nation)*a:7===t?(e.points-s.points)*a:8===t?(e.pointsInvested-s.pointsInvested)*a:(e.portBonusLevel[t-2]-s.portBonusLevel[t-2])*a))}_initTable(){p(this,D,!0),h(this,$).append("thead").append("tr").selectAll("th").data(["Port","Nation"].concat(l(d.b),["Port points","Points invested"])).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>e>1)).attr("role","columnheader").style("width",((t,e)=>e>2?"3rem":"")).text((t=>Object(o.c)(t.data))).on("click",((t,e)=>{this._sortRows(e.index)})),h(this,$).append("tbody")}_injectModal(){Object(n.m)({id:h(this,_),title:h(this,m),size:"modal-lg"});const t=Object(i.a)(`#${h(this,_)} .modal-body`);p(this,$,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){p(this,S,h(this,$).select("tbody").selectAll("tr").data(h(this,y),(t=>t.id)).join((t=>t.append("tr")))),h(this,S).selectAll("td").data((t=>[t.name,t.nation].concat(l(t.portBonusLevel),[t.points,t.pointsInvested]))).join((t=>t.append("td").classed("text-right",((t,e)=>e>1)).text((t=>0===t?"":String(t)))))}_listSelected(){document.querySelector("#"+h(this,_))||this._initModal(),t("#"+h(this,_)).modal("show")}}}).call(this,a(22))},223:function(t,e,a){(function(t){a.d(e,"a",(function(){return D}));a(84),a(87),a(95);var s=a(224),i=a(141),r=a(127),o=a(140),n=a(277),d=a(122),l=a(152),c=a(99),h=a(78),p=a(282),u=a(225),m=a(273),b=a(274),_=a(18),f=a(7),g=a(5),v=a(93);function w(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function y(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}var S=new WeakMap;class D{constructor(t){S.set(this,{writable:!0,value:void 0}),w(this,"_baseName",void 0),w(this,"_baseId",void 0),w(this,"_buttonId",void 0),w(this,"_modalId",void 0),w(this,"_ownershipData",{}),w(this,"_nationData",{}),w(this,"_colourScale",void 0),w(this,"_mainDiv",void 0),w(this,"_div",void 0),w(this,"_svg",void 0),function(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}}(this,S,t),this._baseName="Port ownership",this._baseId="ownership-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._colourScale=Object(d.a)().range(g.g),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){var t;return null!==(t=Math.floor(this._mainDiv.node().offsetWidth))&&void 0!==t?t:0}async _loadAndSetupData(){try{this._nationData=await(await fetch(`data/${y(this,S)}-nation.json`)).json(),this._ownershipData=await(await fetch(`data/${y(this,S)}-ownership.json`)).json()}catch(t){Object(f.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._ownershipListSelected()}))}_injectModal(){Object(g.m)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(h.a)(`#${this._modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t),this._mainDiv=e.append("div").attr("id",""+this._baseId),this._div=this._mainDiv.append("div"),this._svg=this._mainDiv.append("svg").attr("class","area")}_getOptions(){return""+this._ownershipData.map((t=>`<option value="${t.region}">${t.region}</option>;`)).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._regionSelected(t))).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let e=!1;document.querySelector("#"+this._modalId)||(e=!0,this._initModal()),t("#"+this._modalId).on("shown.bs.modal",(()=>{e&&(this._injectArea(),e=!1)})).modal("show")}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,D.getHeight()),a=32,d=32,h=32,_=f.f.filter((t=>9!==t.id)).map((t=>t.short)),g=this._nationData;g.keys=_;const w=Object(p.a)().offset(u.a).keys(_)(g);this._svg.attr("width",t).attr("height",e),(()=>{const n=(()=>{const s=Object(c.a)().domain(Object(i.a)(g,(t=>new Date(t.date)))).range([h,t-a]),n=Object(c.a)().domain([Object(r.a)(w[0],(t=>t[0])),Object(o.a)(w[w.length-1],(t=>t[1]))]).range([e-d,0]);return Object(m.a)().x((t=>s(new Date(t.data.date)))).y0((t=>n(t[0]))).y1((t=>n(t[1]))).curve(b.a)})(),l=new Map(f.f.map((t=>[t.short,t.name])));this._colourScale.domain(_),this._svg.selectAll("path").data(w).join((t=>t.append("path").attr("fill",(t=>this._colourScale(t.key))).attr("stroke",(t=>this._colourScale(t.key))).attr("d",n))),this._svg.selectAll(".area-label").data(w).join((t=>t.append("text").attr("class","area-label").text((t=>l.get(t.key))).attr("fill",(t=>Object(v.d)(this._colourScale(t.key)))).attr("transform",Object(s.areaLabel)(n))))})(),this._svg.append("g").call((s=>{const r=Object(l.b)().domain(Object(i.a)(g,(t=>new Date(t.date)))).range([h,t-a]);s.attr("transform",`translate(0,${e-d})`).call(Object(n.a)(r).ticks(t/80).tickSizeOuter(0)),s.attr("font-size",".8rem").attr("font-family","")}))}async _injectChart(t){(await a.e(23).then(a.bind(null,241))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(e){const a=t(e.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const s=this._ownershipData.filter((t=>t.region===a)).map((t=>t.data))[0];this._injectChart(s)}}}).call(this,a(22))},226:function(t,e,a){(function(t){a.d(e,"a",(function(){return m}));a(44),a(84),a(87),a(95);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(93),l=a(23),c=a(90),h=a(27);function p(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const u=(t,e,a)=>`${Object(l.q)(e)} – ${Object(l.q)(a)}`;class m{constructor(t){p(this,"_serverType",void 0),p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_moduleData",[]),p(this,"_recipeData",[]),p(this,"_recipes",void 0),this._serverType=h.b.find((e=>e.id===t)).type,this._baseName="List admiralty items and recipes",this._baseId="recipe-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await a.e(7).then(a.t.bind(null,121,3))).default,this._recipeData=(await a.e(10).then(a.t.bind(null,173,3))).default.recipe,this._recipes=new Map(this._recipeData.flatMap((t=>t.recipes.map((t=>[t.id,t])))))}catch(t){Object(r.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._recipeListSelected()}))}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(s.a)(`#${this._modalId} .modal-body`);e.append("select").attr("name",t).attr("id",t),e.append("label").attr("for",t).attr("class","text-muted pl-2").text("Items listed here may not be available in the game (yet)."),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return this._recipeData.map((t=>`<optgroup label="${t.group}">${t.recipes.filter((t=>"Any"===t.serverType||t.serverType===this._serverType)).sort(Object(c.b)(["name"])).map((t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,u)}`)).join("</option>")}`)).join("</optgroup>")}_setupSelect(){const e=t(`#${this._baseId}-select`),a=this._getOptions();e.append(a)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",(t=>this._recipeSelected(t))).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRecipeData(t){return this._recipes.get(t)}_getRequirementText(t){let e='<table class="table table-sm card-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${Object(d.e)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`<tr><td>${t.itemRequirements.map((t=>`${t.amount} ${t.name}`)).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",a="",s="";for(const e of this._moduleData){const i=e[1].filter((e=>e.id===t.result.id));for(const t of i)[a]=e,s=`<tr><td>${t.properties.map((t=>{const e=t.isPercentage?Object(n.m)(t.amount/100):t.amount;return`${t.modifier} ${e}`})).join("</td></tr><tr><td>")}</td></tr>`}return s?(e+=`<h6 class="card-subtitle mb-2 text-muted">${a}</h6>`,e+=`<table class="table table-sm card-table na-table"><tbody>${s}</tbody></table>`):e+=`<p>${Object(n.d)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let a='<div class="row no-gutters card-deck">';return a+='<div class="card col-6"><div class="card-header">Item</div>',a+='<div class="card-body">',a+=this._getRequirementText(e),a+="</div></div>",a+='<div class="card col-6"><div class="card-header">Result</div>',a+='<div class="card-body">',a+=this._getPropertiesText(e),a+="</div></div>",a+="</div></div>",a}_recipeSelected(e){const a=Number(t(e.currentTarget).find(":selected").val());Object(s.a)(`#${this._baseId} div`).remove(),Object(s.a)("#"+this._baseId).append("div").classed("mt-4",!0),Object(s.a)(`#${this._baseId} div`).html(this._getText(a))}}}).call(this,a(22))},227:function(t,e,a){(function(t){a.d(e,"a",(function(){return D}));a(84),a(87);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(93),l=a(90);function c(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function p(t,e){var a=e.get(t);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(t):a.value}function u(t,e,a){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}var m=new WeakMap,b=new WeakMap,_=new WeakMap,f=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,y=new WeakMap,S=new WeakMap;class D{constructor(){m.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:{}}),v.set(this,{writable:!0,value:{}}),w.set(this,{writable:!0,value:!0}),y.set(this,{writable:!0,value:0}),S.set(this,{writable:!0,value:{}}),u(this,m,"List ships"),u(this,b,"ship-list"),u(this,_,"button-"+p(this,b)),u(this,f,"modal-"+p(this,b)),this._setupListener()}async _loadAndSetupData(){try{const t=(await a.e(12).then(a.t.bind(null,150,3))).default.sort(Object(l.b)(["class","-battleRating","name"]));u(this,g,t.map((t=>[[t.class,String(t.class)],[t.name,Object(d.a)(t.name)],[t.guns.total,String(t.guns.total)],[t.battleRating,Object(n.d)(t.battleRating)],[t.crew.max,Object(n.d)(t.crew.max)],[t.ship.maxSpeed,Object(n.c)(t.ship.maxSpeed)],[t.ship.turnSpeed,Object(n.c)(t.ship.turnSpeed)],[t.guns.broadside.cannons,Object(n.d)(t.guns.broadside.cannons)],[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4].amount?String(t.guns.gunsPerDeck[4].amount):""],[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5].amount?String(t.guns.gunsPerDeck[5].amount):""],[t.sides.armour,`${Object(n.d)(t.sides.armour)} (${t.sides.thickness})`]])))}catch(t){Object(r.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+p(this,_)))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",p(this,m)),this._shipListSelected()}))}_sortRows(t,e=!0){e&&p(this,y)===t&&u(this,w,!p(this,w)),u(this,y,t);const a=p(this,w)?1:-1;p(this,v).sort(((e,s)=>1===t?e[t][0].localeCompare(s[t][0])*a:(e[t][0]-s[t][0])*a))}_initTable(){const t={group:new Map([["dummy1",5],["Speed",2],["dummy2",1],["Chasers",2],["dummy3",1]]),element:new Set(["Class","Name","Guns","Battle rating","Crew","Maximum","Turn","Broadside","Bow","Stern","Sides"])},e=p(this,S).append("thead");e.append("tr").attr("class","thead-group").selectAll("th").data(c(t.group)).join("th").classed("border-bottom-0",(t=>t[0].startsWith("dummy"))).classed("text-center",!0).attr("colspan",(t=>t[1])).attr("scope","col").text((t=>t[0].startsWith("dummy")?"":t[0])),e.append("tr").selectAll("th").data(c(t.element)).join("th").datum(((t,e)=>({data:t,index:e}))).classed("border-top-0",!0).classed("text-right",((t,e)=>1!==e)).text((t=>t.data)).on("click",((t,e)=>{this._sortRows(e.index)})),p(this,S).append("tbody")}_injectModal(){Object(o.m)({id:p(this,f),title:p(this,m),size:"modal-lg"});const t=Object(s.a)(`#${p(this,f)} .modal-body`);u(this,S,t.append("table").attr("class","table table-sm small na-table")),this._initTable(),this._updateTable(),this._sortRows(0,!1)}_initModal(){this._injectModal()}_updateTable(){u(this,v,p(this,S).select("tbody").selectAll("tr").data(p(this,g),(t=>t[1][0])).join((t=>t.append("tr")))),p(this,v).selectAll("td").data((t=>t)).join((t=>t.append("td").classed("text-right",((t,e)=>1!==e)).html((t=>t[1]))))}_shipListSelected(){document.querySelector("#"+p(this,f))||this._initModal(),t("#"+p(this,f)).modal("show")}}}).call(this,a(22))},228:function(t,e,a){(function(t){a.d(e,"a",(function(){return h}));a(84),a(87),a(95);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(90);function l(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}const c=["Resources","Extra","Materials"];class h{constructor(){l(this,"_baseName",void 0),l(this,"_baseId",void 0),l(this,"_buttonId",void 0),l(this,"_modalId",void 0),l(this,"_init",!0),l(this,"_blueprintData",{}),l(this,"_woodData",{}),l(this,"_extractionCosts",{}),l(this,"_craftingCosts",{}),l(this,"_blueprint",void 0),l(this,"_woodOptions",{}),l(this,"_defaultWood",void 0),l(this,"_woodsSelected",{}),l(this,"_blueprintList",void 0),l(this,"_currentBlueprint",{}),l(this,"_tables",{}),this._baseName="List ship blueprint",this._baseId="ship-blueprint-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._defaultWood={frame:"Fir",trim:"Crew Space"},this._setupListener()}async _loadAndSetupData(){try{this._blueprintData=(await a.e(11).then(a.t.bind(null,239,3))).default,this._woodData=(await a.e(13).then(a.t.bind(null,133,3))).default;const t=(await a.e(11).then(a.t.bind(null,240,3))).default;this._extractionCosts=new Map(t.standard.map((t=>{var e;return[t.name,{reales:t.reales,labour:null!==(e=null==t?void 0:t.labour)&&void 0!==e?e:0}]}))),this._craftingCosts=new Map(t.seasoned.map((t=>[t.name,{reales:t.reales,labour:t.labour,doubloon:t.doubloon,tool:t.tool}])))}catch(t){Object(r.g)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._listSelected()}))}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName,size:"modal-lg"});const t=this._baseId+"-ship-select",e=Object(s.a)(`#${this._modalId} .modal-body`);let a=e.append("div").classed("row no-gutters mb-2",!0);a.append("label").attr("for",t),a.append("select").attr("name",t).attr("id",t),a=e.append("div").classed("row no-gutters",!0);for(const t of r.j){const e=`${this._baseId}-${t}-select`;a.append("label").attr("for",e),a.append("select").attr("name",e).attr("id",e).classed("pr-2",!0)}this._blueprintList=e.append("div").attr("id",""+this._baseId).classed("blueprint mt-4",!0)}_getShipOptions(){return""+this._blueprintData.sort(Object(d.b)(["name"])).map((t=>`<option value="${t.name}">${t.name}</option>;`)).join("")}_setupShipSelect(){const e=t(`#${this._baseId}-ship-select`),a=this._getShipOptions();e.append(a)}_setupWoodOptions(){const t=this._woodData.frame.sort(Object(d.b)(["name"])),e=this._woodData.trim.filter((t=>"Light"!==t.name)).sort(Object(d.b)(["name"]));this._woodOptions={frame:t.map((t=>`<option value="${t.name}">${t.name}</option>`)).join(""),trim:e.map((t=>`<option value="${t.name}">${t.name}</option>`)).join("")}}_setupWoodSelect(t,e){this._setupWoodOptions(),this._woodsSelected[t]=this._defaultWood[t],e.append(this._woodOptions[t]),e.attr("disabled","disabled")}_setupSelects(){this._setupShipSelect();for(const e of r.j){const a=t(`#${this._baseId}-${e}-select`);this._setupWoodSelect(e,a)}}_setupShipSelectListener(){t(`#${this._baseId}-ship-select`).addClass("selectpicker").on("change",(t=>this._blueprintSelected(t))).selectpicker({noneSelectedText:"Select blueprint",width:"fit"}).val("default").selectpicker("refresh")}_setupWoodSelectListener(t,e){e.addClass("selectpicker").on("change",(()=>this._woodSelected(t,e))).selectpicker({noneSelectedText:"Select "+t,width:"fit"}).val("default").selectpicker("refresh")}_setupSelectListener(){this._setupShipSelectListener();for(const e of r.j){const a=t(`#${this._baseId}-${e}-select`);this._setupWoodSelectListener(e,a)}}_initModal(){this._injectModal(),this._setupSelects(),this._setupSelectListener()}_setWoodSelect(e){t(`#${this._baseId}-${e}-select`).removeAttr("disabled").val(this._defaultWood[e]).selectpicker("refresh")}_woodSelected(t,e){this._woodsSelected[t]=e.val(),this._updateText()}_listSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join((t=>t.append("tr"))).selectAll("td").data((t=>t)).join((t=>t.append("td"))).html((t=>t))}_updateText(){let t=this._currentBlueprint.resources.map((t=>[t.name,t.amount])),e=!1,a=!1,s=0,i=0;if("Crew Space"===this._woodsSelected.trim){const e=this._currentBlueprint.wood.find((t=>"Crew Space"===t.name)).amount,a=t.findIndex((t=>"Hemp"===t[0]));t[a][1]=t[a][1]+e}else if(i=this._currentBlueprint.wood.find((t=>"Planking"===t.name)).amount,this._woodsSelected.trim===this._woodsSelected.frame)s+=i;else{const e=t.findIndex((t=>t[0]===this._woodsSelected.trim));e>=0?t[e][1]=t[e][1]+i:(a=!0,t.push([this._woodsSelected.trim,i]))}s+=this._currentBlueprint.wood.find((t=>"Frame"===t.name)).amount;const o=t.findIndex((t=>t[0]===this._woodsSelected.frame));if(o>=0?t[o][1]=t[o][1]+s:(e=!0,t.push([this._woodsSelected.frame,s])),e&&a){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let d=[];this._currentBlueprint.price&&d.push(["Reales",this._currentBlueprint.price]),d.push(["Provisions",this._currentBlueprint.provisions]),this._currentBlueprint.permit&&d.push(["Permit",this._currentBlueprint.permit]),d.push(["Craft level",this._currentBlueprint.craftLevel],["Shipyard level",this._currentBlueprint.shipyardLevel],["Labour hours",this._currentBlueprint.labourHours],["Craft experience",this._currentBlueprint.craftXP]);const l=[];let c=0,h=0;const p=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.reales)&&void 0!==e?e:0)*t[1]},u=t=>{var e,a;return(null!==(e=null===(a=this._extractionCosts.get(t[0]))||void 0===a?void 0:a.labour)&&void 0!==e?e:0)*t[1]},m=t=>{for(const e of t.filter((t=>this._extractionCosts.has(t[0]))))c+=p(e),h+=u(e)};m(t),m(d),c&&l.push(["Reales",Object(n.d)(c)],["Labour hours",Object(n.d)(h)]);let b=0,_=0,f=0,g=0;for(const t of r.j){const e=this._craftingCosts.get(this._woodsSelected[t]);var v,w,y,S;if(e)b+=(null!==(v=e.reales)&&void 0!==v?v:0)*s,_+=(null!==(w=e.labour)&&void 0!==w?w:0)*s,f+=(null!==(y=e.doubloon)&&void 0!==y?y:0)*s,g+=(null!==(S=e.tool)&&void 0!==S?S:0)*s}b&&l.push(["(S) reales",Object(n.d)(b)]),_&&l.push(["(S) labour hours",Object(n.d)(_)]),f&&l.push(["(S) doubloons",Object(n.d)(f)]),g&&l.push(["(S) tools",Object(n.d)(g)]),t=t.map((t=>[t[0],Object(n.d)(t[1])])),d=d.map((t=>[t[0],Object(n.d)(t[1])])),this._updateTable(this._tables.Resources,t),this._updateTable(this._tables.Extra,d),this._updateTable(this._tables.Materials,l)}_blueprintSelected(e){if(this._init){this._init=!1;for(const t of r.j)this._setWoodSelect(t);const t=this._blueprintList.append("div").classed("card-deck",!0),e=e=>{const a=t.append("div").classed("card",!0);a.append("div").classed("card-header",!0).text(e);const s=a.append("div").classed("card-body",!0);this._tables[e]=s.append("table").classed("table table-sm card-table",!0),this._tables[e].append("thead"),this._tables[e].append("tbody")};for(const t of c)e(t)}this._blueprint=t(e.currentTarget).find(":selected").val(),this._currentBlueprint=this._getBlueprintData(this._blueprint),this._updateText()}_getBlueprintData(t){return this._blueprintData.find((e=>e.name===t))}}}).call(this,a(22))},229:function(t,e,a){(function(t){a.d(e,"a",(function(){return p}));a(44),a(84),a(87);var s=a(78),i=a(18),r=a(7),o=a(5),n=a(86),d=a(90);function l(t){return function(t){if(Array.isArray(t))return c(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return c(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function h(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}class p{constructor(){h(this,"_modifiers",{}),h(this,"_rows",{}),h(this,"_sortAscending",{}),h(this,"_sortIndex",{}),h(this,"_switchesSel",void 0),h(this,"_tables",{}),h(this,"_woodData",{}),h(this,"_woodDataDefault",{}),h(this,"_baseId",void 0),h(this,"_baseName",void 0),h(this,"_buttonId",void 0),h(this,"_checkboxId",void 0),h(this,"_modalId",void 0),h(this,"_modifiersNotUsed",new Set(["Ship material","Boarding morale"])),this._baseName="List woods",this._baseId="wood-list",this._buttonId="button-"+this._baseId,this._checkboxId="checkbox-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}_getModifiers(t){const e=new Set;return this._woodDataDefault[t].forEach((t=>{t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).forEach((t=>{e.add(t.modifier)}))})),l(e).sort(d.a)}async _loadData(){try{this._woodDataDefault=(await a.e(13).then(a.t.bind(null,133,3))).default}catch(t){Object(r.g)(t)}}_setupData(){for(const t of r.j)this._modifiers[t]=new Set(this._getModifiers(t)),this._woodDataDefault[t].forEach((e=>{const a=new Set(e.properties.map((t=>t.modifier)));for(const s of this._modifiers[t])a.has(s)||e.properties.push({modifier:s,amount:0,isPercentage:!1});e.properties.sort(((t,e)=>t.modifier.localeCompare(e.modifier)))}));this._woodData={...this._woodDataDefault}}async _loadAndSetupData(){await this._loadData(),this._setupData()}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._woodListSelected()}))}_sortRows(t,e,a=!0){a&&this._sortIndex[t]===e&&(this._sortAscending[t]=!this._sortAscending[t]),this._sortIndex[t]=e;const s=this._sortAscending[t]?1:-1;this._rows[t].sort(((t,a)=>0===e?t.name.localeCompare(a.name)*s:(t.properties[e-1].amount-a.properties[e-1].amount)*s))}_initTable(t){this._sortAscending[t]=!0,this._tables[t].append("thead").append("tr").selectAll("th").data(["Wood"].concat(l(this._modifiers[t]))).join("th").datum(((t,e)=>({data:t,index:e}))).classed("text-right",((t,e)=>0!==e)).attr("role","columnheader").text((t=>t.data)).on("click",((e,a)=>{this._sortRows(t,a.index)})),this._tables[t].append("tbody")}_injectModal(){Object(o.m)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=Object(s.a)(`#${this._modalId} .modal-body`),e=t.append("div").attr("class","mb-3");for(const t of r.i){const a=e.append("div").attr("class","custom-control custom-switch custom-control-inline");a.append("input").attr("id",`${this._checkboxId}-${t}`).attr("name",""+this._checkboxId).attr("class","custom-control-input").attr("type","checkbox").property("checked",!0),a.append("label").attr("for",`${this._checkboxId}-${t}`).attr("class","custom-control-label").text(Object(r.c)(t))}this._switchesSel=l(document.querySelectorAll(`input[name=${this._checkboxId}]`));for(const t of this._switchesSel)t.addEventListener("change",(t=>{t.preventDefault(),this._woodFamilySelected()}));for(const e of r.j)t.append("h5").text(Object(r.c)(e+"s")),this._tables[e]=t.append("table").attr("class","table table-sm small na-table"),this._initTable(e),this._updateTable(e),this._sortRows(e,0,!1)}_initModal(){this._injectModal()}_getFormattedAmount(t){let e;return e="Repair amount"===t.modifier&&t.amount?Object(n.f)(t.amount,1):t.amount?Object(n.c)(t.amount):"",e}_updateTable(t){this._rows[t]=this._tables[t].select("tbody").selectAll("tr").data(this._woodData[t],(t=>t.id)).join((t=>t.append("tr"))),this._rows[t].selectAll("td").data((t=>[t.name].concat(l(t.properties.filter((t=>!this._modifiersNotUsed.has(t.modifier))).map((t=>this._getFormattedAmount(t))))))).join((t=>t.append("td").classed("text-right",((t,e)=>0!==e)).html((t=>t))))}_woodFamilySelected(){const t=new Set;for(const e of this._switchesSel)if(e.checked){const a=e.id.replace(this._checkboxId+"-","");t.add(a)}for(const e of r.j)this._woodData[e]=this._woodDataDefault[e].filter((e=>t.has(e.family))),this._updateTable(e),this._sortRows(e,this._sortIndex[e],!1)}_woodListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}}}).call(this,a(22))},82:function(t,e,a){a.r(e),a.d(e,"init",(function(){return v}));var s=a(18),i=a(5),r=a(145),o=a(130),n=a(215),d=a(216),l=a(218),c=a(219),h=a(220),p=a(221),u=a(222),m=a(223),b=a(226),_=a(227),f=a(228),g=a(229);const v=(t,e)=>{const a=new r.a("ship-compare");(()=>{if(e.has("cmp")&&e.has("v")){const t=e.get("v");t&&t.split(".")[0]===i.d.split(".")[0]&&(Object(s.b)("Menu","Paste ship compare"),a.initFromClipboard(e))}})(),new o.a("wood"),new g.a,new n.a,new d.a,new l.a,new c.a,new h.a,new p.a(t),new u.a(t),new m.a(t),new b.a(t),new _.a,new f.a}},86:function(t,e,a){a.d(e,"e",(function(){return n})),a.d(e,"b",(function(){return l})),a.d(e,"k",(function(){return c})),a.d(e,"c",(function(){return h})),a.d(e,"a",(function(){return p})),a.d(e,"d",(function(){return u})),a.d(e,"l",(function(){return m})),a.d(e,"f",(function(){return b})),a.d(e,"i",(function(){return f})),a.d(e,"j",(function(){return g})),a.d(e,"h",(function(){return v})),a.d(e,"g",(function(){return w})),a.d(e,"m",(function(){return y}));a(44);var s=a(243),i=a(110),r=a(111);const o=i.a.bind(r.a),n=Object(s.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reales"],percent:" %",minus:"− "}),d=n.formatPrefix(",.0",1e3),l=(t,e=2)=>n.format(`,.${e}~r`)(t),c=(t,e=2)=>n.format(`+,.${e}~r`)(t).replace("+","+ "),h=(t,e=2)=>n.format(`.${e}f`)(t).replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),p=t=>d(-1*t).replace("k"," k"),u=t=>n.format(",d")(t),m=t=>n.format("+,d")(t).replace("+","+ "),b=(t,e=0)=>n.format(`,.${e}%`)(t).replace("%","pp"),_='<span class="caps">m</span>',f=t=>n.format(",.2s")(t).replace(".0","").replace("k"," k").replace("m"," m").replace("M"," "+_),g=t=>{const e=f(t);return e.endsWith(_)?o`${e.replace(_,"")}<span class="caps">m</span>`:o`${e}`},v=t=>n.format("$,.2s")(t).replace(".0","").replace("M",' <span class="caps">m</span>').replace("k"," k"),w=(t,e=1)=>n.format(`.${e}%`)(t).replace(".0",""),y=t=>n.format("+.1%")(t).replace(".0","").replace("+","＋ ")},88:function(t,e,a){(function(t){a.d(e,"e",(function(){return d})),a.d(e,"f",(function(){return l})),a.d(e,"j",(function(){return c})),a.d(e,"m",(function(){return h})),a.d(e,"a",(function(){return p})),a.d(e,"k",(function(){return u})),a.d(e,"l",(function(){return m})),a.d(e,"d",(function(){return b})),a.d(e,"c",(function(){return _})),a.d(e,"b",(function(){return f})),a.d(e,"g",(function(){return g})),a.d(e,"i",(function(){return v})),a.d(e,"h",(function(){return w}));var s=a(137),i=a(5),r=a(23);function o(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return n(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return n(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}const d=(t,e=!1)=>{let a;return a=Number.isNaN(Number(t))?t:Object(r.m)(Number(t)),`<${e?"tspan":"span"} class="caps">${a}</${e?"tspan":"span"}>`},l=(t,e=!1)=>{let a,s;return Number.isNaN(Number(t))?(a=t,s=Object(r.c)(a)%r.j):(s=Number(t),a=Object(r.m)(s)),`<${e?"tspan":"span"} class="caps">${a}</${e?"tspan":"span"}> (${s}°)`},c=e=>{const a=Object(r.m)(t("#"+e).roundSlider("getValue"));let s;return s=Number.isNaN(Number(a))?Object(r.c)(a):Number(a),s},h=(t,e)=>{let a=Math.atan2(e.y-t.y,e.x-t.x);a-=Math.PI/2;let s=Object(r.t)(a);return s<0&&(s+=r.j),s},p=(t,e,a=!0)=>{if(e<2)return[t];const s=t.length,i=[];let r,o=0;if(s%e==0)for(r=Math.floor(s/e);o<s;)i.push(t.slice(o,o+=r));else if(a)for(;o<s;)r=Math.ceil((s-o)/e--),i.push(t.slice(o,o+=r));else{for(e-=1,r=Math.floor(s/e),s%r==0&&(r-=1);o<r*e;)i.push(t.slice(o,o+=r));i.push(t.slice(r*e))}return i},u=({element:t,radius:e})=>{const a=i.n,n=r.j/a,d=Math.round(.8*e),l=o(new Array(a)).map(((t,e)=>Object(r.m)(e*n))),c=Object(s.a)().range([0-n/2,r.j-n/2]).domain(l).align(0);t.append("circle").attr("r",d).style("stroke-width","3px");const h=t.append("text"),p=t.selectAll("g").data(l).join((t=>t.append("g").attr("transform",(t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2-r.l)})translate(${d},0)`}))));p.filter(((t,e)=>e%3!=0)).append("line").attr("x2",9),p.filter(((t,e)=>e%3==0)).append("text").attr("transform",(t=>{var e,a,s,i,r;let o,n=Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2);h.text(t);const d=null!==(a=null===(s=h.node())||void 0===s?void 0:s.getBBox().height)&&void 0!==a?a:0,l=null!==(i=null===(r=h.node())||void 0===r?void 0:r.getBBox().width)&&void 0!==i?i:0;return n>=0&&n<=45||315===n?(n=90,o="0,-"+d/2):90===n?(n=0,o=l/2+3+",0"):270===n?(n=180,o=`-${l/2+3},0`):(n=-90,o="0,"+(d/2+3+2)),`rotate(${n})translate(${o})`})).text((t=>t)),h.remove()},m=({element:t,radius:e})=>{const a=i.n,n=r.j/a,d=Math.round(.8*e),l=o(new Array(a)).map(((t,e)=>Object(r.m)(e*n))),c=Object(s.a)().range([0-n/2,r.j-n/2]).domain(l).align(0);t.append("circle").attr("r",d).style("stroke-width","1.5px");t.selectAll("line").data(l).join((t=>t.append("line").attr("x2",((t,e)=>e%3==0?e%6==0?6:4:2)).attr("transform",(t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2)})translate(${d},0)`}))))},b=t=>`<span class="caps">${t}</span>`,_=(t,e)=>{navigator.clipboard||((t,e)=>{var a,s;if(!(null===(a=(s=document).queryCommandSupported)||void 0===a?void 0:a.call(s,"copy")))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const a=document.createElement("input");a.type="text",a.value=t,a.style.position="absolute",a.style.left="-1000px",a.style.top="-1000px",e.append(a),a.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{a.remove()}}})(t,e),(async t=>{navigator.clipboard.writeText(t).then((()=>!0)).catch((e=>(console.error(`Cannot copy ${t} to clipboard`,e),!1)))})(t)},f=(t,e,a)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const s=new URL(window.location.href);s.searchParams.set("x",String(t)),s.searchParams.set("z",String(e)),_(s.href,a)}},g=(t,e,a)=>`M${t-a},${e}a${a},${a} 0 10${2*a},0a${a},${a} 0 10${2*-a},0`,v=(t,e,a)=>`M${t-a/2},${e-a/2}h${a}v${a}h${-a}z`,w=(t,e,a)=>`M${t},${e}v${a}`}).call(this,a(22))},90:function(t,e,a){a.d(e,"a",(function(){return s})),a.d(e,"b",(function(){return i}));a(44);const s=(t,e)=>t&&e?t.localeCompare(e):0,i=t=>(e,a)=>{let s=0;return t.some((t=>{let i=1;return String(t).startsWith("-")&&(i=-1,t=String(t).slice(1)),s=Number.isNaN(Number(e[t]))&&Number.isNaN(Number(a[t]))?String(e[t]).localeCompare(String(a[t]))*i:(Number(e[t])-Number(a[t]))*i,0!==s})),s}},93:function(t,e,a){a.d(e,"g",(function(){return c})),a.d(e,"h",(function(){return h})),a.d(e,"j",(function(){return p})),a.d(e,"l",(function(){return u})),a.d(e,"m",(function(){return m})),a.d(e,"n",(function(){return f})),a.d(e,"k",(function(){return g})),a.d(e,"f",(function(){return v})),a.d(e,"i",(function(){return y})),a.d(e,"o",(function(){return S})),a.d(e,"a",(function(){return D})),a.d(e,"c",(function(){return j})),a.d(e,"e",(function(){return $})),a.d(e,"d",(function(){return O})),a.d(e,"b",(function(){return C}));a(44);var s=a(283),i=a(164),r=a.n(i),o=a(110),n=a(111),d=a(5);a(86);const l=o.a.bind(n.a),c=Number(.2),h=Number(300),p=Number(90),u=Number(.25),m=Number(300),b=Number(.25),_=Number(1),f=Number(b)/Number(_),g=5,v=new r.a("My salt: Yet another Naval Action map"),w=" (i)",y=t=>t.includes(w),S=t=>t.replace(w,""),D=t=>S(t)+(y(t)?' <span class="caps small">imported</span>':""),j=({id:t,title:e,size:a="modal-xl",body:s,footer:i})=>l`
        <div id="${t}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${t}" aria-hidden="true">
            <div class="modal-dialog ${a}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${t}" class="modal-title">${e}</h5>
                    </div>
                    <div class="modal-body">${s()}</div>
                    <div class="modal-footer">${i()}</div>
                </div>
            </div>
        </div>
    `,$=t=>`${t} real${Number(t)>1?"s":""}`,O=t=>{var e,a;const{r:i,g:r,b:o}=Object(s.b)(t);return(299*i+587*r+114*o)/1e3>=128?null!==(e=null===(a=Object(s.a)(d.i))||void 0===a?void 0:a.darker(5).toString())&&void 0!==e?e:"#111":d.i},C=t=>l`<span class="caps">${t}</span>`}}]);