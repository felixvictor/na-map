(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+42d":function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},"/foq":function(t,e,s){t.exports=s.p+"icons/PRa.svg"},"0siz":function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},"1qWw":function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return l});s("W1QL");var i=s("aBO9"),a=s("nUlG"),o=s("Q7Au"),r=s("f4w0"),n=s("Av7d"),d=s("0lY5"),h=s("4PeS");class l{constructor(t){this._ports=t,this._inputs=4,this._baseName="Get position",this._baseId="get-position",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._setupSvg(),this._setupListener()}_setupSvg(){this._gPosition=Object(a.select)("g.ports").append("g")}_navbarClick(t){Object(r.b)("Menu","Get position"),t.stopPropagation(),this._positionSelected()}_setupListener(){document.getElementById(`${this._buttonId}`).addEventListener("click",t=>this._navbarClick(t))}_injectModal(){Object(n.x)(this._modalId,this._baseName,"","Go");const t=Object(a.select)(`#${this._modalId} .modal-body`);t.append("div").classed("alert alert-primary",!0).attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),s=e.append("datalist").attr("id","defaultDistances");[5,10,15,20,30,50,100,200].forEach(t=>{s.append("option").attr("value",t)}),Array.from(Array(this._inputs).keys()).forEach(t=>{const s=`${this._baseId}-${t}-select`,i=`${this._baseId}-${t}-input`,a=e.append("div").classed("form-row",!0);a.append("div").classed("col-md-6",!0).append("label").append("select").attr("name",s).attr("id",s),a.append("div").classed("col-md-6",!0).append("input").attr("id",i).attr("name",i).attr("type","number").classed("form-control",!0).attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)})}_setupSelects(){const e=JSON.parse(JSON.stringify({noneSelectedText:"",dropupAuto:!1}));e.liveSearch=!0,e.liveSearchPlaceholder="Search ...",e.liveSearchNormalize=!0,e.noneSelectedText="Select port";const s=`${this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(d.E)(["name"])).map(t=>`<option data-subtext="${t.nation}" value="${t.coord}" data-id="${t.id}">${t.name}</option>`).join("")}`;Array.from(Array(this._inputs).keys()).forEach(i=>{const a=`${this._baseId}-${i}-select`,o=document.getElementById(a),r=t(`#${a}`);o.insertAdjacentHTML("beforeend",s),r.selectpicker(e).val("default").selectpicker("refresh")})}_initModal(){this._injectModal(),this._setupSelects()}_useUserInput(){const e=()=>{const t=t=>{const e=(t=>{const e=[];return t.arcs.forEach(t=>{const s=t.p1,i=t.p2,a=t.circle,o=Math.atan2(s.x-a.x,s.y-a.y),r=Math.atan2(i.x-a.x,i.y-a.y);let n=r-o;n<0&&(n+=2*Math.PI);const d=n/32;Array.from(Array(32).keys()).forEach(t=>{const s=r-d*t,i={x:a.x+a.radius*Math.sin(s),y:a.y+a.radius*Math.cos(s)};e.push([Math.floor(i.x),Math.floor(i.y)])})}),e})(t),s=Object(i.e)().curve(i.c);this._gPosition.append("path").attr("class","position-path").attr("d",s(e))},e=(()=>{const t=this._ports.portData.map(t=>({x:t.coordinates[0],y:t.coordinates[1],radius:t.distance})),e={};return Object(o.a)(t,e),e})();if(e.innerPoints.length){t(e);const s=this._gPosition.select("path").node().getBBox(),i={x:s.x+s.width/2,y:s.y+s.height/2};this._ports._map._f11.printCoord(i.x,i.y),this._ports._map.zoomAndPan(i.x,i.y,1)}else new h.a("Get position","No intersection found.")},s=new Map;Array.from(Array(this._inputs).keys()).forEach(e=>{const i=`${this._baseId}-${e}-select`,a=t(`#${i}`),o=`${this._baseId}-${e}-input`,r=t(`#${o}`),d=a.find(":selected")[0]?a.find(":selected")[0].text:"",h=+r.val();h&&""!==d&&s.set(d,1.05*h*n.e)}),s.size>=2?(this._ports.setShowRadiusSetting="position",this._ports.portData=this._ports.portDataDefault.filter(t=>s.has(t.name)).map(t=>(t.distance=s.get(t.name),t)),this._ports.update(),e()):new h.a("Get position","Not enough data.")}_positionSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}clearMap(){this._gPosition.selectAll("*").remove()}}}).call(this,s("xeH2"))},"28Wg":function(t,e,s){t.exports=s.p+"icons/USa.svg"},"4PeS":function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return o});var i=s("nUlG"),a=(s("3XUK"),s("9q+R"),s("Av7d"));class o{constructor(e,s){this._title=e,this._text=s,this._setupDiv(),this._set(e,s),t(this._toast.node()).toast({autohide:!1}).toast("show"),window.setTimeout(this._remove.bind(this),1e4)}_setupDiv(){this._mainDiv=Object(i.select)("#toast-section")}_set(){this._toast=this._mainDiv.append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true");const t=this._toast.append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",a.v).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(this._title),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),this._toast.append("div").attr("class","toast-body").html(this._text)}_remove(){this._toast.remove()}}}).call(this,s("xeH2"))},"62GW":function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return l});s("MYxt");var i=s("nUlG"),a=s("aBO9"),o=s("TiKg"),r=s.n(o),n=(s("YmdP"),s("W/Hz"),s("8sDi"),s("cRa1"),s("+NlM"),s("kCRU"),s("0lY5")),d=s("f4w0"),h=s("Av7d");class l{constructor(){this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._timeGroupId=`input-group-${this._baseId}`,this._timeInputId=`input-${this._baseId}`,this._setupSvg(),this._setupArrow(),this._setupListener()}_setupSvg(){this._svg=Object(i.select)("#wind svg")}_setupArrow(){const t=this._windArrowWidth,e=2*this._windArrowWidth;Object(i.select)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d",`M0,-${t}L${e},0L0,${t}`).classed("wind-head",!0)}_navbarClick(t){Object(d.b)("Menu",this._baseName),t.stopPropagation(),this._windSelected()}_setupListener(){document.getElementById(`${this._buttonId}`).addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const s=e.call(this);return this.container.append(this.tooltip),s},window.tooltip=(t=>`${Object(n.j)(t.value)}<br>${t.value}°`),t(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/n.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t(`#${this._sliderId}`).roundSlider("getValue")}})}_injectModal(){r.a.locale("en-gb"),Object(h.x)(this._modalId,this._baseName,"sm");const e=Object(i.select)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId),s=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);s.append("label").attr("for",this._sliderId).text("Current in-game wind"),s.append("div").attr("id",this._sliderId).attr("class","rslider");const a=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);a.append("label").attr("for",this._timeInputId).text("Predict time (server time)");const o=a.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest");o.append("input").classed("form-control datetimepicker-input",!0).attr("type","text").attr("id",this._timeInputId).attr("data-target",`#${this._timeGroupId}`).attr("aria-label",this._timeGroupId).attr("required",""),o.append("div").classed("input-group-append",!0).attr("data-target",`#${this._timeGroupId}`).attr("data-toggle","datetimepicker").append("span").classed("input-group-text",!0).append("i").classed("far fa-clock",!0),t(`#${this._timeGroupId}`).datetimepicker({defaultDate:r.a.utc(),format:"LT"})}_initModal(){this._injectModal(),this._setupWindInput()}_windSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_useUserInput(){const e=Object(n.w)(this._sliderId),s=t(`#${this._timeInputId}`).val().trim();this._predictWind(e,s)}_predictWind(t,e){r.a.locale("en-gb");let s;const i=/(\d+)[\s:.](\d+)/.exec(e),a=parseInt(i[1],10),o=parseInt(i[2],10);s=Number.isNaN(Number(t))?Object(n.f)(t):+t;const d=r()().utc().seconds(0).milliseconds(0),l=r()(d).hour(a).minutes(o);l.isBefore(d)&&l.add(1,"day");const c=l.diff(d,"seconds"),p=360+(s-h.q*c)%360;this._printPredictedWind(p,l.format("H.mm"),Object(n.g)(t),d.format("H.mm"))}_printCompass(t){const e=Object(a.e)(),s=Math.min(this._height/1.4,this._width/1.4)/2,i=this._width/2,o=this._height/2.8,r=Object(n.h)(t),d=.6*s,h=d*Math.cos(r),l=d*Math.sin(r),c=[[Math.round(i+h),Math.round(o+l)],[Math.round(i-h),Math.round(o-l)]];this._svg.attr("height",this._height).attr("width",this._width);const p=this._svg.append("svg").attr("class","compass").classed("compass",!0).attr("x",i).attr("y",o);Object(n.z)({elem:p,radius:s}),this._svg.append("path").datum(c).attr("d",e).classed("wind",!0).attr("marker-end","url(#wind-arrow)")}_printText(t,e,s,i){const a=Object(n.g)(t),o=parseInt(window.getComputedStyle(document.getElementById("wind")).getPropertyValue("line-height"),10),r=this._svg.append("svg"),d=r.append("text").attr("x","50%").attr("y","33%").attr("class","wind-text").html(`From ${Object(n.k)(a,!0)} at ${e}`),h=r.append("text").attr("x","50%").attr("y","66%").attr("class","wind-text-current").html(`Currently at ${i} from ${Object(n.k)(s,!0)}`),l=d.node().getBoundingClientRect(),c=h.node().getBoundingClientRect(),p=2*Math.max(l.height,c.height)+o,_=Math.max(l.width,c.width)+o;r.attr("x",(this._width-_)/2).attr("y","72%").attr("height",p).attr("width",_)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,e,s,i){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,s,i),this._addBackground()}setPosition(t,e){this._svg.style("margin-left",`${e}px`).style("margin-top",`${t}px`)}clearMap(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)}}}).call(this,s("xeH2"))},"7chY":function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},"8gAj":function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return f});s("asZ9"),s("W1QL");var i=s("x8q/"),a=s("/Cyf"),o=s("IVJf"),r=s("wbYc"),n=s("nUlG"),d=s("aBO9"),h=s("NRFW"),l=s("TiKg"),c=s.n(l),p=(s("YmdP"),s("W/Hz"),s("8sDi"),s("0lY5")),_=s("f4w0"),u=s("Av7d"),m=s("iSiJ"),g=s("pFgi");class f{constructor(t,e,s){this._shipData=t,this._woodData=e,this._fontSize=s,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(d.e)().x(t=>t[0]).y(t=>t[1]),this._labelPadding=20,this._degreesPerMinute=u.q/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(r.b)().domain(Object(a.e)(0,u.r,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId=`button-${this._baseId}`,this._compassId=`compass-${this._baseId}`,this._deleteLastLegButtonId=`button-delete-leg-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._shipId="ship-journey",this._woodId="wood-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}_setupDrag(){this._drag=Object(o.a)().on("start",(t,e,s)=>{this._removeLabels(),Object(n.select)(s[e]).classed("drag-active",!0)}).on("drag",(t,e,s)=>{0===e&&this._compass.attr("x",t.position[0]+n.event.dx).attr("y",t.position[1]+n.event.dy),Object(n.select)(s[e]).attr("cx",n.event.x).attr("cy",n.event.y),t.position=[t.position[0]+n.event.dx,t.position[1]+n.event.dy],this._printLines()}).on("end",(t,e,s)=>{Object(n.select)(s[e]).classed("drag-active",!1),this._printJourney()})}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(n.select)("#na-svg").insert("g","g.pb").classed("coord",!0),Object(n.select)("#na-svg defs").append("marker").attr("id","course-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d",`M0,-${t}L${e},0L0,${t}`).classed("course-head",!0)}_initJourneyData(){this._journey={shipName:this._defaultShipName,woodNames:"",startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segment:[{position:[null,null],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(t){Object(_.b)("Menu","Journey"),t.stopPropagation(),this._journeySelected()}_setupListener(){document.getElementById(`${this._buttonId}`).addEventListener("mouseup",t=>this._navbarClick(t)),document.getElementById(this._deleteLastLegButtonId).addEventListener("mouseup",()=>this._deleteLastLeg())}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const s=e.call(this);return this.container.append(this.tooltip),s},window.tooltip=(t=>`${Object(p.j)(t.value)}<br>${t.value}°`),t(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/p.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t(`#${this._sliderId}`).roundSlider("getValue")}})}_injectModal(){Object(u.x)(this._modalId,this._baseName,"sm");const t=Object(n.select)(`#${this._modalId} .modal-body`).append("form").append("div").attr("class","form-group"),e=t.append("div").classed("alert alert-primary",!0).attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const s=`${this._shipId}-Base-select`,i=t.append("div").classed("alert alert-primary",!0).attr("role","alert").append("div").attr("class","d-flex flex-column");i.append("label").attr("for",s).text("Ship and woods (optional)"),i.append("select").attr("name",s).attr("id",s),["frame","trim"].forEach(t=>{const e=`${this._woodId}-${t}-Base-select`;i.append("label").attr("for",e),i.append("select").attr("name",e).attr("id",e)})}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new m.a(this._shipData,this._woodData,this._shipId),this._woodCompare=new g.a(this._woodData,this._woodId)}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segment[0].position[0],e=this._journey.segment[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e).call(this._drag),this._compassG=this._compass.append("g"),Object(p.z)({elem:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const s=(u.r-t+e)%u.r;return this._getSpeedAtDegrees(s)*this._owSpeedFactor*u.A}_getStartWind(){const e=t(`#${this._sliderId}`).roundSlider("getValue");let s;return s=t(`#${this._sliderId}`).length?+e:0}_setShipSpeed(){let t=[];t=this._journey.shipName===this._defaultShipName?Array.from(Array(24).fill(this._defaultShipSpeed/2)):this._shipCompare._singleShipData.speedDegrees,this._speedScale.range(t)}_calculateMinutesForSegment(t,e,s){let i=s,a=e,o=0;for(this._setShipSpeed();i>0;){const e=this._calculateDistanceForSection(t,a);i>e?(i-=e,o+=1):(o+=i/e,i=0),a=(u.r+a-this._degreesPerMinute)%u.r}return this._journey.currentWindDegrees=a,o}_setShipName(){void 0!==this._shipCompare&&void 0!==this._shipCompare._singleShipData&&void 0!==this._shipCompare._singleShipData.name?(this._journey.shipName=`${this._shipCompare._singleShipData.name}`,this._journey.woodNames=`${this._shipCompare._woodCompare._woodsSelected.Base.frame}/${this._shipCompare._woodCompare._woodsSelected.Base.trim}`):(this._journey.shipName=this._defaultShipName,this._journey.woodNames="")}_removeLabels(){const t=this._g.selectAll("g.coord g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(h.c)(Object(n.select)("#na-svg").node()),e=Math.max(1,t.k),s=this._fontSize/e,i=h.b.translate(20/e,20/e),a=this._labelPadding/e,o=10/e,r=5/e;this._g.selectAll("g.coord g.label").each((t,e,r)=>{const d=Object(n.select)(r[e]),h=d.select("text"),l=t.label.split("|"),c=1.3*s;h.text("").attr("dy",0).attr("transform",i).style("font-size",`${s}px`),l.forEach((t,e)=>{const s=h.append("tspan").html(t);e>0&&s.attr("x",0).attr("dy",c)});const p=h.node().getBBox(),_=t.label?p.width+2*a:0,u=t.label?p.height+a:0;d.select("rect").attr("width",_).attr("height",u);const m=d.select("circle").attr("r",o).attr("class","");d.append(()=>m.remove().node()),0===e&&m.attr("r",4*o).attr("class","drag-hidden"),e===r.length-1&&m.attr("r",o).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",`${r}px`),this._compassG&&this._compassG.attr("transform",`scale(${1/e})`)}_printLabels(){const t=Object(i.layoutTextLabel)().padding(this._labelPadding).value(t=>{const e=t.label.split("|"),s=e.reduce((t,e,s,i)=>i[t].length>e.length?t:s,0);return e[s]}),e=Object(i.layoutAnnealing)(),s=Object(i.layoutLabel)(e).size((t,e,s)=>{const i=t.label.split("|").length,a=s[e].getElementsByTagName("text")[0].getBBox();return[a.width+2*this._labelPadding,a.height*i+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segment.map(t=>t)).call(s)}_setupSummary(){this._divJourneySummary=Object(n.select)("main #summary-column").append("div").attr("id","journey-summary").classed("journey-summary overlay d-none",!0),this._journeySummaryShip=this._divJourneySummary.append("div").classed("block",!0),this._journeySummaryTextWoods=this._journeySummaryShip.append("div"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").classed("des",!0).text("selected ship"),this._journeySummaryWind=this._divJourneySummary.append("div").classed("block",!0),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").classed("des",!0).text("wind direction"),this._divJourneySummary.append("div").classed("block",!0).append("button").attr("id",this._deleteLastLegButtonId).classed("btn btn-primary btn-sm",!0).attr("role","button").text("Delete last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(n.select)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextWoods.text(this._journey.woodNames),this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html(`From ${Object(p.k)(this._journey.startWindDegrees)}`)}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segment.length>1?this._journey.segment.map(t=>t.position):[[null,null]]).attr("marker-end","url(#course-arrow)").attr("d",this._line)}_getTextDirection(t,e,s){return`${Object(p.k)(t,!0)} ⁖ F11: ${Object(p.m)(Object(u.m)(s.x,s.y))} / ${Object(p.m)(Object(u.n)(s.x,s.y))}`}_getTextDistance(t,e,s){function i(t){function e(t,e){return`${t} ${e+(1===t?"":"s")}`}c.a.locale("en-gb");const s=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0!==s?e(s,"hour"):"";a+=t+(""!==t?" ":"")+(0!==i?e(i,"minute"):"")}return a}let a=`${Math.round(t)} k ${i(e)}`;return s&&(a+=` ⁖ total ${Math.round(this._journey.totalDistance)} k ${i(this._journey.totalMinutes)}`),a}_setSegmentLabel(t){void 0===t&&(t=this._journey.segment.length-1);const e={x:this._journey.segment[t].position[0],y:this._journey.segment[t].position[1]},s={x:this._journey.segment[t-1].position[0],y:this._journey.segment[t-1].position[1]},i=Object(p.C)(e,s),a=Object(u.t)(e,s),o=Object(p.g)(i),r=this._calculateMinutesForSegment(i,this._journey.currentWindDegrees,1e3*a);this._journey.totalDistance+=a,this._journey.totalMinutes+=r;const n=this._getTextDirection(o,i,e),d=this._getTextDistance(a,r,t>1);this._journey.segment[t].label=`${n}|${d}`}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData(),this._journey.segment.forEach((t,e)=>{e<this._journey.segment.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segment.pop(),this._journey.segment.length?this._printJourney():(this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top",`${t}px`).style("right",`${e}px`)}plotCourse(t,e){this._journey.segment[0].position[0]?(this._journey.segment.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segment[0]={position:[t,e],label:""},this._initJourney())}transform(t){this._g.attr("transform",t),this._correctJourney()}}}).call(this,s("xeH2"))},"9c4Y":function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},BI2v:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},FmV8:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return u});s("Z8gF"),s("W1QL");var i=s("/Cyf"),a=s("yw3p"),o=s("wbYc"),r=s("nUlG"),n=(s("3XUK"),s("/1Gu"),s("TiKg")),d=s.n(n),h=(s("YmdP"),s("Av7d")),l=s("0lY5"),c=s("NO11"),p=s("iJ1D"),_=s("1qWw");class u{constructor(t,e){this._portDataDefault=t,this._portData=t,this._map=e,this._serverName=this._map._serverName,this._minScale=this._map._minScale,this._scale=this._minScale,this.f11=this._map._f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this._currentPort={id:"366",coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=h.p,this._circleSize=h.o,this._taxIncomeRadius=Object(o.b)(),this._netIncomeRadius=Object(o.b)(),this._attackRadius=Object(o.b)().domain([0,1]),this._colourScale=Object(o.b)().domain([0,.5,1]).range([h.z,h.h,h.i]).interpolate(a.c),this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","position","tax","net","green","off"],this._cookie=new c.a(this._baseId,this._radioButtonValues),this._radios=new p.a(this._baseId,this._radioButtonValues),this._showRadius=this._getShowRadiusSetting(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags(),this._trilateratePosition=new _.a(this)}_setupListener(){document.getElementById("show-radius").addEventListener("change",()=>this._showRadiusSelected())}_getShowRadiusSetting(){let t=this._cookie.get();"position"===t&&(t=this._radioButtonValues[0],this._cookie.set(t));return this._radios.set(t),t}_showRadiusSelected(){this._showRadius=this._radios.get(),this._cookie.set(this._showRadius),this.update()}_setupSvg(){this._gPort=Object(r.select)("#na-svg").insert("g","g.f11").classed("ports",!0),this._gRegion=this._gPort.append("g").classed("region",!0),this._gCounty=this._gPort.append("g").classed("county",!0),this._gPortCircle=this._gPort.append("g").classed("port-circles",!0),this._gIcon=this._gPort.append("g").classed("port",!0),this._gText=this._gPort.append("g").classed("port-names",!0)}_setupCounties(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Cuidad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}]}_setupRegions(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]}_setupSummary(){this._divPortSummary=Object(r.select)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary"),this._portSummaryNumPorts=this._divPortSummary.append("div").classed("block",!0),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").classed("des",!0).html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").classed("block",!0),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").classed("des",!0).html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").classed("block",!0),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").classed("des",!0).html("net<br>income")}_setupFlags(){this._nationIcons=(t=>{const e={};return t.keys().forEach(s=>{e[s.replace("./","").replace(".svg","")]=t(s)}),e})(s("vq93"));const t=Object(r.select)("#na-svg defs");h.y.map(t=>t.short).forEach(e=>{if(t.append("pattern").attr("id",e).attr("width","133%").attr("height","100%").attr("viewBox",`6 6 ${this._iconSize} ${.75*this._iconSize}`).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e].replace('"',"").replace('"',"")),"NT"!==e&&"FT"!==e){t.append("pattern").attr("id",`${e}a`).attr("width","133%").attr("height","100%").attr("viewBox",`6 6 ${this._iconSize} ${.75*this._iconSize}`).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[`${e}a`].replace('"',"").replace('"',""))}})}_getPortName(t){return t?this._portDataDefault.find(e=>e.id===t).name:""}_getText(t,e){d.a.locale("en-gb");const s=d.a.utc(e.portBattle).local(),i=d.a.utc(e.portBattle),a={name:e.name,icon:e.nation,availableForAll:e.availableForAll?"(accessible to all nations)":"",depth:e.shallow?"Shallow":"Deep",county:(""!==e.county?`${e.county} / `:"")+e.region,countyCapital:e.countyCapital?" (county capital)":"",nonCapturable:e.nonCapturable,captured:e.capturer?` captured by ${Object(l.i)(e.capturer)} ${d.a.utc(e.lastPortBattle).fromNow()}`:"",lastPortBattle:e.lastPortBattle,attack:e.attackHostility?`${Object(l.i)(e.attackerClan)} (${e.attackerNation}) attack${e.portBattle.length?`${i.isAfter(d.a.utc())?"s":"ed"} ${i.fromNow()} at ${i.format("H.mm")}${i!==s?` (${s.format("H.mm")} local)`:""}`:`s: ${Object(l.q)(e.attackHostility)} hostility`}`:"",pbTimeRange:e.nonCapturable?"":e.portBattleStartTime?`${(e.portBattleStartTime+10)%24}.00 – ${(e.portBattleStartTime+13)%24}.00`:"11.00 – 8.00",brLimit:Object(l.p)(e.brLimit),conquestMarksPension:e.conquestMarksPension,taxIncome:Object(l.s)(e.taxIncome),portTax:Object(l.q)(e.portTax),netIncome:Object(l.s)(e.netIncome),tradingCompany:e.tradingCompany?`, trading company level ${e.tradingCompany}`:"",laborHoursDiscount:e.laborHoursDiscount?`, labor hours discount level ${e.laborHoursDiscount}`:"",dropsTrading:e.dropsTrading?e.dropsTrading.join(", "):"",consumesTrading:e.consumesTrading?e.consumesTrading.join(", "):"",producesNonTrading:e.producesNonTrading?e.producesNonTrading.join(", "):"",dropsNonTrading:e.dropsNonTrading?e.dropsNonTrading.join(", "):"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:e.goodsToSellInTradePort?e.goodsToSellInTradePort.join(", "):"",goodsToBuyInTradePort:e.goodsToBuyInTradePort?e.goodsToBuyInTradePort.join(", "):""};switch(e.portBattleType){case"Large":a.pbType=Object(l.v)(1);break;case"Medium":a.pbType=Object(l.v)(4);break;default:a.pbType=Object(l.v)(6)}return a}_showDetails(e,s,i){t(Object(r.select)(i[s]).node()).tooltip({html:!0,placement:"auto",title:(t=>{let e='<div class="d-flex align-items-baseline mb-1">';return e+=`<img alt="${t.icon}" class="flag-icon align-self-stretch" src="${this._nationIcons[t.icon].replace('"',"").replace('"',"")}"/>`,e+=`<div class="port-name">${t.name}</div>`,e+=`<div class=""> ${t.county} ${t.availableForAll}</div>`,e+="</div>",t.attack.length&&(e+=`<div class="alert alert-danger mt-2" role="alert">${t.attack}</div>`),e+=`<p>${t.depth} water port ${t.countyCapital}${t.captured}<br>`,t.nonCapturable?(e+="Not capturable",e+=`<br>${t.portTax} tax`):(e+=`Port battle ${t.pbTimeRange}, ${t.brLimit} <span class="caps">BR</span>, `,e+=`${t.pbType} rate <span class="caps">AI</span>, `,e+=`${t.conquestMarksPension} conquest point`,e+=t.conquestMarksPension>1?"s":"",e+=`<br>Tax income ${t.taxIncome} (${t.portTax}), net income ${t.netIncome}`,e+=t.tradingCompany,e+=t.laborHoursDiscount),e+="</p>",e+="<table class='table table-sm'>",t.producesNonTrading.length&&(e+="<tr><td class='pl-0'>Produces </td><td>",e+=`<span class="non-trading">${t.producesNonTrading}</span>`,e+="</td></tr>"),(t.dropsTrading.length||t.dropsNonTrading.length)&&(e+=`<tr><td class='pl-0'>Drops ${t.dropsNonTrading.length?" ":""}</td><td>`,t.dropsNonTrading.length&&(e+=`<span class="non-trading">${t.dropsNonTrading}</span>`,t.dropsTrading.length&&(e+="<br>")),t.dropsTrading.length&&(e+=`${t.dropsTrading}`),e+="</td></tr>"),t.consumesTrading.length&&(e+="<tr><td class='pl-0'>Consumes </td><td>",e+=t.consumesTrading,e+="</td></tr>"),this.showTradePortPartners&&(t.goodsToSellInTradePort.length&&(e+=`<tr><td class='pl-0'>Sell in ${t.tradePort} </td><td>${t.goodsToSellInTradePort}</td></tr>`),t.goodsToBuyInTradePort.length&&(e+=`<tr><td class='pl-0'>Buy in ${t.tradePort} </td><td>${t.goodsToBuyInTradePort}</td></tr>`)),e+="</table>"})(this._getText(e.id,e)),trigger:"manual"}).tooltip("show"),this._map.showTrades.show&&("inventory"!==this._map.showTrades.listType&&(this._map.showTrades.listType="inventory"),this._map.showTrades.update((t=>{let e="";const s=t.inventory.filter(t=>t.buyQuantity>0).map(t=>`${Object(l.p)(t.buyQuantity)} ${t.name} @ ${Object(l.r)(t.buyPrice)}`).join("<br>"),i=t.inventory.filter(t=>t.sellQuantity>0).map(t=>`${Object(l.p)(t.sellQuantity)} ${t.name} @ ${Object(l.r)(t.sellPrice)}`).join("<br>");return e+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,s.length&&(e+="<h6>Buy</h6>",e+=s),s.length&&i.length&&(e+="<p></p>"),i.length&&(e+="<h6>Sell</h6>",e+=i),e})(e)))}_updateIcons(){const e=(e,s,i)=>{t(Object(r.select)(i[s]).node()).tooltip("dispose")},s=2**Math.log2(Math.abs(this._minScale)+this._scale),i=Object(l.D)(this._circleSize/s),a=this._portDataFiltered;this._gIcon.selectAll("circle").data(a,t=>t.id).join(t=>t.append("circle").attr("fill",t=>`url(#${t.nation}${t.availableForAll&&"NT"!==t.nation?"a":""})`).attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1]).on("click",(t,e,s)=>this._showDetails(t,e,s)).on("mouseleave",e)).attr("r",i)}_updatePortCircles(){const t=t=>{let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e},e=2**Math.log2(Math.abs(this._minScale)+this._scale),s=Object(l.D)(this._circleSize/e*this._minRadiusFactor),a=Object(l.D)(this._circleSize/e*this._maxRadiusFactor);let o=this._portDataFiltered,r=t=>t,n=t=>t,d=t=>t,c=!1;if("tax"===this._showRadius){o=this._portDataFiltered.filter(t=>!t.nonCapturable);const t=Object(i.d)(o,t=>t.taxIncome),e=Object(i.c)(o,t=>t.taxIncome);this._taxIncomeRadius.domain([t,e]),this._taxIncomeRadius.range([s,a]),r=(()=>"bubble pos"),n=(t=>this._taxIncomeRadius(Math.abs(t.taxIncome)))}else if("net"===this._showRadius){o=this._portDataFiltered.filter(t=>!t.nonCapturable);const t=Object(i.d)(o,t=>t.netIncome),e=Object(i.c)(o,t=>t.netIncome);this._netIncomeRadius.domain([t,e]).range([s,a]),r=(t=>`bubble ${t.netIncome<0?"neg":"pos"}`),n=(t=>this._netIncomeRadius(Math.abs(t.netIncome)))}else this.showTradePortPartners?(r=(e=>`bubble ${t(e)}`),n=(t=>t.id===this.tradePortId?a:a/2)):"position"===this._showRadius?(r=(()=>"position-circle"),n=(t=>t.distance)):"attack"===this._showRadius?(o=this._portDataFiltered.filter(t=>t.attackHostility),this._attackRadius.range([s,a]),r=(()=>"bubble"),d=(t=>this._colourScale(t.attackHostility)),c=!0,n=(t=>this._attackRadius(t.attackHostility))):"green"===this._showRadius?(o=this._portDataFiltered.filter(t=>t.nonCapturable&&"FT"!==t.nation),r=(()=>"bubble pos"),n=(()=>h.u)):this.showCurrentGood?(r=(t=>`bubble ${t.isSource?"pos":"neg"}`),n=(()=>a/2)):"off"===this._showRadius&&(o={});this._gPortCircle.selectAll("circle").data(o,t=>t.id).join(t=>t.append("circle").attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1])).attr("class",t=>r(t)).attr("r",t=>n(t)).attr("fill",t=>c?d(t):"")}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(l.h)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,s){const i=e+1.2*s;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+i;const a=t.angle>90&&t.angle<270?s:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(l.h)(t.angle)))+a:t.coordinates[1]+i}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.textAnchor:"middle"}updateTexts(){if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(l.D)(this._circleSize/t),s=2**Math.log2(.9*(Math.abs(this._minScale)+this._scale)),i=Object(l.D)(this._fontSize/s);this._gText.selectAll("text").data(this._portDataFiltered,t=>t.id).join(t=>t.append("text").text(t=>t.name)).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,i)).attr("text-anchor",t=>this._updateTextsAnchor(t)),this._gText.attr("font-size",`${i}px`).classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this._portData).length;let e=0,s=0;t&&(e=this._portData.map(t=>t.taxIncome).reduce((t,e)=>t+e),s=this._portData.map(t=>t.netIncome).reduce((t,e)=>t+e)),this._portSummaryTextNumPorts.text(`${t}`),this._portSummaryTextTaxIncome.text(`${Object(l.s)(e)}`),this._portSummaryTextNetIncome.text(`${Object(l.s)(s)}`)}_updateCounties(){if("portLabel"!==this.zoomLevel)this._gCounty.classed("d-none",!0);else{const t=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)),this._gCounty.classed("d-none",!1)}}_updateRegions(){if("initial"!==this.zoomLevel)this._gRegion.classed("d-none",!0);else{const t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`).text(t=>t.name)),this._gRegion.classed("d-none",!1)}}update(t){void 0===t&&(t=null),this._scale=t||this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()}_filterVisible(){"position"!==this._showRadius?this._portDataFiltered=this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]):this._portDataFiltered=this._portData,this._countyPolygonFiltered=this._countyPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1]),this._regionPolygonFiltered=this._regionPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1])}setBounds(t,e){this._lowerBound=t,this._upperBound=e}set portDataDefault(t){this._portDataDefault=t}get portDataDefault(){return this._portDataDefault}set portData(t){this._portData=t}get portData(){return this._portData}set currentPort(t){this._currentPort=t}get currentPort(){return this._currentPort}set zoomLevel(t){this._zoomLevel=t}get zoomLevel(){return this._zoomLevel}_showSummary(){this._divPortSummary.classed("hidden",!1)}setShowRadiusSetting(t){void 0===t&&(t=this._radioButtonValues[0]),this._showRadius=t,this._radios.set(this._showRadius),this._cookie.set(this._showRadius)}transform(t){this._gPort.attr("transform",t)}clearMap(t){if("position"===this._showRadius){var e=this._radioButtonValues;this._showRadius=e[0],this._radios.set(this._showRadius),this._cookie.set(this._showRadius)}this._trilateratePosition.clearMap(),this._showSummary(),this._portData=this._portDataDefault,this.showCurrentGood=!1,this.showTradePortPartners=!1,this.setShowRadiusSetting(),this.update(t)}}}).call(this,s("xeH2"))},JNxp:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return l});s("Z8gF"),s("W1QL");var i=s("/Cyf"),a=s("wbYc"),o=s("nUlG"),r=s("Av7d"),n=s("0lY5"),d=s("NO11"),h=s("iJ1D");class l{constructor(t,e,s,i,a,o){this._portSelect=t,this._portData=e,this._linkDataDefault=s,this._minScale=i,this._scale=this._minScale,this._fontSize=r.p,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=`${this._baseId}-nation-select`,this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new d.a(this._showId,this._showRadioValues),this._showRadios=new h.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new d.a(this._profitId,this._profitRadioValues),this._profitRadios=new h.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this._setupData(),this.setBounds(a,o),this.show&&this._portSelect.setupInventorySelect(this.show),this._showOrHide(),this._profitValue=this._getProfitValue(),this._filterPortsBySelectedNations(),this._sortLinkData()}_setupSvg(){this._g=Object(o.select)("#na-svg").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(o.select)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-head"),this._tradeDetailsDiv=Object(o.select)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const e=`${r.y.map(t=>`<option value="${t.short}" selected>${t.name}</option>`).join("")}`,s=`${this._baseId}-card`;this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const i=this._tradeDetailsHead.append("label"),a=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText(t){let e="";return`${e=t===r.y.length?"All":t} nations selected`},title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target",`#${s}`).text("Info"),this._tradeDetailsHead.append("div").attr("id",s).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by"),this._profitRadioValues.forEach(e=>{const s=`${this._profitId}-${e.replace(/ /g,"")}`,i=t.append("div").attr("class","custom-control custom-radio custom-control-inline");i.append("input").attr("id",s).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),i.append("label").attr("for",s).attr("class","custom-control-label").text(e)})}_setupListener(){document.getElementById(this._showId).addEventListener("change",()=>this._showSelected()),document.getElementById(this._profitId).addEventListener("change",()=>this._profitValueSelected()),this._nationSelector.addEventListener("change",t=>{this._nationChanged(),t.preventDefault()})}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._nodeData=new Map(this._portData.map(t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]))}_sortLinkData(){this._linkData=this._linkData.map(t=>{let e=0;switch(this._profitValue){case"weight":e=l._getProfitPerWeight(t);break;case"distance":e=l._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw Error(`Wrong profit value ${this._profitValue}`)}return t.profit=e,t}).sort((t,e)=>e.profit-t.profit)}_showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),this._showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}_showOrHide(){this.show?(l._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(l._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}static _getId(t){return`trade-${t.source.id}-${t.good.replace(/ /g,"")}-${t.target.id}`}_getTradeLimitedData(t){const e=t=>`<div><div>${t}</div>`,s=t=>`<div class="des">${t}</div></div>`,i=t=>t?"(shallow)":"(deep)",a=t.weightPerItem*t.quantity;let o="";return o+=e(`${Object(n.p)(t.quantity)} ${t.good}`)+s("trade"),o+=e(`${Object(n.r)(t.profit)}`)+s(this._profitText),o+=e(`${Object(n.s)(a)} ${1===a?"ton":"tons"}`)+s("weight"),o+=e(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+s(`from ${i(this._nodeData.get(t.source.id).isShallow)}`),o+=e(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+s(`to ${i(this._nodeData.get(t.source.id).isShallow)}`),o+=e(`${Object(n.s)(t.distance)} k`)+s("distance")}static _getProfitPerWeight(t){return 0!==t.weightPerItem?Math.round(t.profitTotal/(t.weightPerItem*t.quantity)):t.profitTotal}static _getProfitPerDistance(t){return t.profitTotal/t.distance}_getTradeFullData(t){const e=t=>`<div>${t}</div>`,s=t=>`<div class="des">${t}</div>`,i=t=>`<div class="block-block"><span>${t}</span>`,a=t=>t?"(shallow)":"(deep)",o=t.weightPerItem*t.quantity,r=t.target.grossPrice-t.source.grossPrice,d=l._getProfitPerDistance(t),h=l._getProfitPerWeight(t);let c="";return c+=i("Trade"),c+=e(`${Object(n.p)(t.quantity)} ${t.good}`)+s("good"),c+=e(`${Object(n.r)(t.source.grossPrice)}`)+s("gross buy price"),c+=e(`${Object(n.r)(t.target.grossPrice)}`)+s("gross sell price"),c+=e(`${Object(n.s)(o)} ${1===o?"ton":"tons"}`)+s("weight"),c+="</div>",c+=i("Profit"),c+=e(`${Object(n.r)(t.profitTotal)}`)+s("total"),c+=e(`${Object(n.r)(r)}`)+s("profit/item"),c+=e(`${Object(n.r)(d)}`)+s("profit/distance"),c+=e(`${Object(n.r)(h)}`)+s("profit/weight"),c+="</div>",c+=i("Route"),c+=e(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+s(`from ${a(this._nodeData.get(t.source.id).isShallow)}`),c+=e(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+s(`to ${a(this._nodeData.get(t.source.id).isShallow)}`),c+=e(`${Object(n.s)(t.distance)} k`)+s("distance"),c+="</div>"}_updateGraph(){const e=(e,s,i)=>{const a=Object(o.select)(i[s]),r=this._getTradeFullData(e);t(a.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:r,trigger:"manual"}).tooltip("show")},s=(e,s,i)=>{t(Object(o.select)(i[s]).node()).tooltip("dispose")},r=(t,e)=>{const s={x:this._nodeData.get(e.source.id).x,y:this._nodeData.get(e.source.id).y},i={x:this._nodeData.get(e.target.id).x,y:this._nodeData.get(e.target.id).y},o=t?s.x:i.x,r=t?s.y:i.y,n=t?i.x:s.x,d=t?i.y:s.y;let h=Math.sqrt((n-o)**2+(d-r)**2);const l=t?0:1,c=((t,e)=>this._linkDataFiltered.filter(s=>s.source.id===t&&s.target.id===e||s.source.id===e&&s.target.id===t).map(t=>t.profit))(e.source.id,e.target.id);if(c.length>1){const t=Object(a.d)().domain(c).range([1,c.length]);h/=1+1/c.length*(t(e.profit)-1)}return`M${o},${r}A${h=Math.round(h)},${h} 0,0,${l} ${n},${d}`},d=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,h=Object(a.b)().range([5/this._scale,15/this._scale]).domain(Object(i.b)(this._linkDataFiltered,t=>t.profit)),c=2**Math.log2(Math.abs(this._minScale)+this._scale),p=Object(n.D)(this._fontSize/c),_=this._g.transition().duration(500);this._g.selectAll(".trade-link").data(d,t=>l._getId(t)).join(t=>t.append("path").attr("class","trade-link").attr("marker-start",t=>this._nodeData.get(t.source.id).x<this._nodeData.get(t.target.id).x?"":"url(#trade-arrow)").attr("marker-end",t=>this._nodeData.get(t.source.id).x<this._nodeData.get(t.target.id).x?"url(#trade-arrow)":"").attr("id",t=>l._getId(t)).attr("opacity",0).on("click",e).on("mouseleave",s).call(t=>t.transition(_).attr("opacity",1)),t=>t.attr("opacity",1),t=>t.call(t=>t.transition(_).attr("opacity",0).remove())).attr("d",t=>r(this._nodeData.get(t.source.id).x<this._nodeData.get(t.target.id).x,t)).attr("stroke-width",t=>`${h(t.profit)}px`),this._labelG.attr("font-size",`${p}px`),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,t=>l._getId(t)).join(t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",t=>`#${l._getId(t)}`).text(t=>`${Object(n.p)(t.quantity)} ${t.good}`).attr("opacity",0).call(t=>t.transition(_).attr("opacity",1)),t=>t.attr("opacity",1),t=>t.call(t=>t.transition(_).attr("opacity",0).remove())).attr("dy",t=>`-${h(t.profit)/1.5}px`)}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],l._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,l._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}get listType(){return this._listType}_updateList(t){switch(void 0===t&&(t=null),this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t)}_updatePortList(t){this._list.html(t)}_updateTradeList(){let t;const e=e=>{(t=Object(o.select)(`path#${l._getId(e)}`).classed("highlight",!0)).dispatch("click")},s=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,t=>l._getId(t)).join(t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",s)).html(t=>this._getTradeLimitedData(t))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]).map(t=>t.id));this._linkDataFiltered=this._linkData.filter(e=>t.has(e.source.id)||t.has(e.target.id)).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter(t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id)).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set(Array.from(this._nationSelector.selectedOptions).map(t=>t.value));this._portDataFiltered=new Set(this._portData.filter(e=>t.has(e.nation)).map(t=>t.id))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw Error("Wrong profit value")}return t}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}update(t){void 0===t&&(t=null),this._filterTradesByVisiblePorts(),this._updateGraph(),this._updateList(t)}setBounds(t,e){this._lowerBound=t,this._upperBound=e}transform(t){this._g.attr("transform",t),this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}}).call(this,s("xeH2"))},K2vO:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},Q9mY:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d4cec4' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},R5TC:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},Rhp1:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},T2LJ:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},VPfe:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},YBSV:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},YOhT:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 486.86 480'%3E%3Cpath d='M410.06 46.63L279.78 218.06v2.74l207.08-27.43v93.26l-207.08-24.68v2.74l131.65 164.57-86.4 49.37-82.29-192H240L150.86 480l-78.17-49.37 130.29-167.32v-2.74l-203 26.06v-93.26l201.6 26.06v-2.74L72.69 49.37l83.66-48 85 190.63h2.75L327.77 0z' fill='%23d4cec4'/%3E%3C/svg%3E\""},cAXh:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return d});s("asZ9"),s("W1QL"),s("btHz");var i=s("TiKg"),a=s.n(i),o=(s("+NlM"),s("kCRU"),s("f4w0")),r=s("Av7d"),n=s("0lY5");class d{constructor(t,e,s){this._ports=t,this._pbZone=e,this._map=s,this._dateFormat="D MMM",this._timeFormat="HH.00",this._portNamesId="port-names-select",this._portNamesSelector=document.getElementById(this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.getElementById(this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.getElementById(this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.getElementById(this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.getElementById(this._propClanId),this._propCMId="prop-cm-select",this._propCMSelector=document.getElementById(this._propCMId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupPortSelect(),this._setupGoodSelect(),this._setupNationSelect(),this._setupClanSelect(),this._setupCMSelect()}_resetOtherSelects(e){[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._propNationSelector,this._propClanSelector,this._propCMSelector].forEach(s=>{s===e||s===this._propClanSelector&&e===this._propNationSelector||s===this._propNationSelector&&e===this._propClanSelector||t(s).val("default").selectpicker("refresh")})}_setupListener(){this._portNamesSelector.addEventListener("change",t=>{Object(o.b)("Menu","Port relations"),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()}),this._buyGoodsSelector.addEventListener("change",t=>{Object(o.b)("Menu","Good relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()}),this._inventorySelector.addEventListener("change",t=>{Object(o.b)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()}),this._propNationSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()}),this._propClanSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()}),this._propCMSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propCMSelector),this._CMSelected(),t.preventDefault()}),document.getElementById("menu-prop-deep").addEventListener("click",()=>this._depthSelected("deep")),document.getElementById("menu-prop-shallow").addEventListener("click",()=>this._depthSelected("shallow")),document.getElementById("menu-prop-all").addEventListener("click",()=>this._allSelected()),document.getElementById("menu-prop-green").addEventListener("click",()=>this._greenZoneSelected()),document.getElementById("menu-prop-large").addEventListener("click",()=>this._portSizeSelected("Large")),document.getElementById("menu-prop-medium").addEventListener("click",()=>this._portSizeSelected("Medium")),document.getElementById("menu-prop-small").addEventListener("click",()=>this._portSizeSelected("Small")),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"far fa-clock",date:"far fa-calendar",up:"fas fa-arrow-up",down:"fas fa-arrow-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"far fa-calendar-check",clear:"fas fa-trash",close:"fas fa-times"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),t("#prop-pb-range").submit(t=>{this._capturePBRange(),this._toggleMenuDropdown(),t.preventDefault()}),document.getElementById("menu-prop-today").addEventListener("click",()=>this._capturedToday()),document.getElementById("menu-prop-yesterday").addEventListener("click",()=>this._capturedYesterday()),document.getElementById("menu-prop-this-week").addEventListener("click",()=>this._capturedThisWeek()),document.getElementById("menu-prop-last-week").addEventListener("click",()=>this._capturedLastWeek());const e=t("#prop-from"),s=t("#prop-to");e.datetimepicker({format:this._dateFormat}),s.datetimepicker({format:this._dateFormat,useCurrent:!1}),e.on("change.datetimepicker",t=>s.datetimepicker("minDate",t.date)),s.on("change.datetimepicker",t=>e.datetimepicker("maxDate",t.date)),t("#prop-range").submit(t=>{this._captureRange(),this._toggleMenuDropdown(),t.preventDefault()}),Object(r.w)("selectPortNavbar")}_setupPortSelect(){const e=`${this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(n.E)(["name"])).map(t=>`<option data-subtext="${t.nation}" value="${t.coord}" data-id="${t.id}">${t.name}</option>`).join("")}`;this._portNamesSelector.insertAdjacentHTML("beforeend",e),this._portNamesSelector.classList.add("selectpicker"),t(this._portNamesSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show port relations",virtualScroll:!0}),this._portNamesSelector.classList.remove("d-none"),this._portNamesSelector.parentNode.classList.remove("d-none")}_setupGoodSelect(){const e=new Set;this._ports.portDataDefault.forEach(t=>{["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"].forEach(s=>{t[s]&&t[s].forEach(t=>e.add(t))})});const s=`${Array.from(e).sort().map(t=>`<option>${t}</option>`).join("")}`;this._buyGoodsSelector.insertAdjacentHTML("beforeend",s),this._buyGoodsSelector.classList.add("selectpicker"),t(this._buyGoodsSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good relations",virtualScroll:!0}),this._buyGoodsSelector.classList.remove("d-none"),this._buyGoodsSelector.parentNode.classList.remove("d-none")}setupInventorySelect(e){if(!this._inventorySelector.classList.contains("selectpicker")){const e=new Set;this._ports.portDataDefault.forEach(t=>{t.inventory&&t.inventory.forEach(t=>e.add(t.name))});const s=`${Array.from(e).sort().map(t=>`<option>${t}</option>`).join("")}`;this._inventorySelector.insertAdjacentHTML("beforeend",s),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))}_setupNationSelect(){const e=`${r.y.sort(Object(n.E)(["name"])).map(t=>`<option value="${t.short}">${t.name}</option>`).join("")}`;this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker()}_setupClanSelect(){const e=new Set;this._ports.portData.filter(t=>t.capturer).forEach(t=>e.add(t.capturer)),this._propClanSelector.innerHTML="";let s="";0!==e.size?(this._propClanSelector.disabled=!1,s=`${Array.from(e).sort().map(t=>`<option value="${t}" class="caps">${t}</option>`).join("")}`):this._propClanSelector.disabled=!0,this._propClanSelector.insertAdjacentHTML("beforeend",s),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker()}_setupCMSelect(){const e=new Set;this._ports.portData.forEach(t=>e.add(t.conquestMarksPension));const s=`${Array.from(e).sort().map(t=>`<option value="${t}">${t}</option>`).join("")}`;this._propCMSelector.insertAdjacentHTML("beforeend",s),this._propCMSelector.classList.add("selectpicker"),t(this._propCMSelector).selectpicker()}_setTradePortPartners(){let t=[],e=[];const s=this._ports.portDataDefault.find(t=>t.id===this._ports.tradePortId);s.consumesTrading&&(t=s.consumesTrading.map(t=>t)),s.dropsTrading&&(e=s.dropsTrading.map(t=>t)),this._ports.portData=JSON.parse(JSON.stringify(this._ports.portDataDefault)).map(s=>(s.goodsToSellInTradePort=[],s.sellInTradePort=!1,s.goodsToBuyInTradePort=[],s.buyInTradePort=!1,s.consumesTrading&&s.consumesTrading.forEach(t=>{e.includes(t)&&(s.goodsToBuyInTradePort.push(t),s.buyInTradePort=!0)}),s.dropsTrading&&s.dropsTrading.forEach(e=>{t.includes(e)&&(s.goodsToSellInTradePort.push(e),s.sellInTradePort=!0)}),s)).filter(t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort)}_toggleMenuDropdown(){t("#propertyDropdown").dropdown("toggle")}_portSelected(){const t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),s=+t.getAttribute("data-id");this._ports.currentPort={id:s,coord:{x:+e[0],y:+e[1]}},this._ports.tradePortId=s,this._setTradePortPartners(),this._pbZone._showPBZones&&this._pbZone.refresh(),this._ports.showTradePortPartners=!0,this._ports.showCurrentGood=!1,this._ports.update(),this._ports._map.initialZoomAndPan()}_goodSelected(){const t=this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value,e=JSON.parse(JSON.stringify(this._ports.portDataDefault).filter(e=>e.dropsTrading&&e.dropsTrading.some(e=>e===t)||e.dropsNonTrading&&e.dropsNonTrading.some(e=>e===t)||e.producesNonTrading&&e.producesNonTrading.some(e=>e===t))).map(t=>(t.isSource=!0,t)),s=JSON.parse(JSON.stringify(this._ports.portDataDefault).filter(e=>e.consumesTrading&&e.consumesTrading.some(e=>e===t))).map(t=>(t.isSource=!1,t));this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(s),this._ports.showCurrentGood=!0,this._ports.showTradePortPartners=!1,this._ports.update()}inventorySelected(){this.isInventorySelected=!0;const t=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,e=new Map,s=new Map,i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>e.inventory&&e.inventory.some(e=>e.name===t)))).sort(Object(n.E)(["name"])).map(i=>{const a=i.inventory.find(e=>e.name===t);return a.buyQuantity>0&&(i.sellInTradePort=a.buyQuantity>0,e.set(i.name,{name:i.name,nation:i.nation,good:a})),a.sellQuantity>0&&(i.buyInTradePort=a.sellQuantity>0,s.set(i.name,{name:i.name,nation:i.nation,good:a})),i});this._ports.setShowRadiusSetting("off"),this._ports.portData=i,this._ports.showTradePortPartners=!0,this._ports.showCurrentGood=!1,"portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{let i="";return i+=`<h5>${t}</h5>`,e.size&&(i+="<h6>Buy</h6>",e.forEach(t=>{i+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(n.p)(t.good.buyQuantity)} @ ${Object(n.r)(t.good.buyPrice)}<br>`})),e&&s&&(i+="<p></p>"),s.size&&(i+="<h6>Sell</h6>",s.forEach(t=>{i+=`${t.name} <span class="caps">${t.nation}</span>: ${Object(n.p)(t.good.sellQuantity)} @ ${Object(n.r)(t.good.sellPrice)}<br>`})),i})()),this._ports.update()}_nationSelected(){this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,this._toggleMenuDropdown(),this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}_clanSelected(){const t=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;this._toggleMenuDropdown(),0!==t?this._ports.portData=this._ports.portDataDefault.filter(e=>e.capturer===t):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation)),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.shallow:!e.shallow);this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.availableForAll);this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_greenZoneSelected(){const t=this._ports.portDataDefault.filter(t=>t.nonCapturable&&"FT"!==t.nation);this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_portSizeSelected(t){const e=this._ports.portDataDefault.filter(e=>t===e.portBattleType);this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_CMSelected(){const t=+this._propCMSelector.options[this._propCMSelector.selectedIndex].value;let e;e=0!==t?this._ports.portDataDefault.filter(e=>t===e.conquestMarksPension):this._ports.portDataDefault,this._toggleMenuDropdown(),this._ports.portData=e,this._ports.showTradePortPartners=!1,this._ports.update()}_capturePBRange(){const t=[8,9,10],e=24-(t.length+1),s=new Set,i=a()(document.getElementById("prop-pb-from-input").value,this._timeFormat).hour();let o=a()(document.getElementById("prop-pb-to-input").value,this._timeFormat).hour();if(!(t.includes(i)&&t.includes(o)&&i<=o)){s.add(0),o<i&&(o+=24);for(let t=i-2;t<=o-3;t+=1)s.add((t-10)%e)}const r=this._ports.portDataDefault.filter(t=>!t.nonCapturable&&"FT"!==t.nation&&s.has(t.portBattleStartTime));this._ports.portData=r,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_filterCaptured(t,e){const s=this._ports.portDataDefault.filter(s=>a()(s.lastPortBattle).isBetween(t,e,null,"(]"));this._ports.portData=s,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()}_capturedToday(){const t=a.a.utc();let e=a()().utc().hour(11).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=a.a.utc();let e=a()().utc().hour(11).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=a()().utc().startOf("week"),e=t.hour(11),s=a()(t).add(7,"day").hour(11);this._filterCaptured(e,s)}_capturedLastWeek(){const t=a()().utc().startOf("week"),e=a()(t).subtract(7,"day").hour(11),s=t.hour(11);this._filterCaptured(e,s)}_captureRange(){const t=document.getElementById("prop-from-input").value,e=document.getElementById("prop-to-input").value,s=a()(t,this._dateFormat).hour(11),i=a()(e,this._dateFormat).add(1,"day").hour(11);this._filterCaptured(s,i)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}}}).call(this,s("xeH2"))},cBlp:function(t,e,s){t.exports=s.p+"icons/PR.svg"},cCJq:function(t,e,s){"use strict";s.d(e,"a",function(){return d});var i=s("ntgT"),a=s("nUlG"),o=s("wbYc"),r=s("0lY5"),n=s("Av7d");class d{constructor(t){this._map=t,this._isShown="on"===this._map._showGrid,this._minCoord=this._map.coord.min,this._maxCoord=this._map.coord.max,this._height=this._map.height,this._width=this._map.width,this._defaultFontSize=this._map.rem,this._xBackgroundHeight=this._map.xGridBackgroundHeight,this._yBackgroundWidth=this._map.yGridBackgroundWidth,this._setupSvg()}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){this._xScale=Object(o.b)().clamp(!0).domain([Object(n.m)(this._minCoord,this._minCoord),Object(n.m)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord]),this._yScale=Object(o.b)().clamp(!0).domain([Object(n.n)(this._minCoord,this._minCoord),Object(n.n)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord])}_setupAxis(){const t=this._getTicks(65);this._xAxis=Object(i.a)(this._xScale).tickFormat(r.m).tickValues(t).tickSize(this._maxCoord),this._yAxis=Object(i.c)(this._yScale).tickFormat(r.m).tickValues(t).tickSize(this._maxCoord),this._divXAxis=Object(a.select)("#axis-x"),this._svgXAxis=Object(a.select)("#axis-x svg"),this._svgXAxis.attr("height",this._xBackgroundHeight).attr("width",this._width),this._svgXAxisRect=this._svgXAxis.append("rect").attr("height",this._xBackgroundHeight).attr("width",this._width),this._gXAxis=this._svgXAxis.append("g"),this._divYAxis=Object(a.select)("#axis-y"),this._svgYAxis=Object(a.select)("#axis-y svg"),this._svgYAxis.attr("height",this._height-this._xBackgroundHeight).attr("width",this._yBackgroundWidth),this._svgYAxisRect=this._svgYAxis.append("rect").attr("height",this._height-this._xBackgroundHeight).attr("width",this._yBackgroundWidth),this._gYAxis=this._svgYAxis.append("g"),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round(Object(n.n)(this._minCoord,this._minCoord)),s=Math.round(Object(n.n)(this._maxCoord,this._maxCoord)),i=(s-e)/(t-1),a=[];for(let t=i;t<s;t+=i)a.push(Math.round(t));a.push(s);const o=a.slice(0).reverse().map(t=>-t);return o.push(0),o.concat(a)}_setupXAxis(){this._gXAxis.selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),this._gXAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){this._gYAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null),this._gYAxis.selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){this._displayXAxis(),this._displayYAxis()}_displayXAxis(){const t=a.event?a.event.transform.k:1,e=a.event?a.event.transform.y:0,s=e/t<this._width?e/t:0,i=-this._maxCoord-s,o=Object(r.D)(this._defaultFontSize/t),n=Object(r.D)(1/t);this._gXAxis.attr("font-size",o).attr("stroke-width",n).call(this._xAxis.tickPadding(i)),this._gXAxis.select(".domain").remove()}_displayYAxis(){const t=a.event?a.event.transform.k:1,e=a.event?a.event.transform.x:0,s=e/t<this._height?e/t:0,i=-this._maxCoord-s,o=Object(r.D)(this._defaultFontSize/t),n=Object(r.D)(1/t);this._gYAxis.attr("font-size",o).attr("stroke-width",n).call(this._yAxis.tickPadding(i)),this._gYAxis.select(".domain").remove()}set show(t){this._isShown=t}get show(){return this._isShown}set zoomLevel(t){this._zoomLevel=t}get zoomLevel(){return this._zoomLevel}update(t){void 0===t&&(t=!1);let e=!1;this._isShown&&"initial"!==this.zoomLevel&&(e=!0),t&&(this._height=this._map.height,this._width=this._map.width,this._svgXAxis.attr("width",this._width),this._svgXAxisRect.attr("width",this._width),this._svgYAxis.attr("height",this._height-this._xBackgroundHeight),this._svgYAxisRect.attr("height",this._height-this._xBackgroundHeight)),this._divXAxis.classed("d-none",!e),this._divYAxis.classed("d-none",!e)}transform(t){this._gXAxis.attr("transform",t),this._gYAxis.attr("transform",t),this._displayAxis()}}},cRa1:function(t,e,s){},"e7/b":function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},eqiN:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return n});var i=s("/lKO"),a=s("nUlG"),o=s("2W1i"),r=s.n(o);class n{constructor(t,e,s,i,a){this._ports=a,this._pbCircleDataDefault=t,this._pbCircleData=t,this._fortDataDefault=e,this._fortData=e,this._towerDataDefault=s,this._towerData=s,this._joinCircleDataDefault=i,this._joinCircleData=i,this._showPBCookieName="na-map--show-pb",this._showPBDefault="all",this._showPB=this._getShowPBSetting(),this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(a.select)("#na-svg").insert("g","g.ports").classed("pb",!0),this._gJoinCirclesInner=this._g.append("path").classed("join-circle",!0),this._gJoinCirclesOuter=this._g.append("path").classed("join-circle",!0),this._gPBCircles=this._g.append("path").classed("pb-circle",!0),this._gTowers=this._g.append("path").classed("tower",!0),this._gForts=this._g.append("path").classed("fort",!0)}_setupListener(){t("#show-pb").change(()=>this._showPBZonesSelected())}_getShowPBSetting(){const e=r.a.get(this._showPBCookieName)||this._showPBDefault;return t(`#show-pb-${e}`).prop("checked",!0),e}_storeShowPBSetting(){this._showPB!==this._showPBDefault?r.a.set(this._showPBCookieName,this._showPB):r.a.remove(this._showPBCookieName)}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this._showPB=t("input[name='showPB']:checked").val(),this._storeShowPBSetting(),this._refreshPBZones()}_update(){this._gPBCircles.datum(this._pbCircleData).attr("d",Object(i.a)().pointRadius(3.5)),this._gTowers.datum(this._towerData).attr("d",Object(i.a)().pointRadius(1.5)),this._gForts.datum(this._fortData).attr("d",Object(i.a)().pointRadius(2)),this._gJoinCirclesInner.datum(this._joinCircleData).attr("d",Object(i.a)().pointRadius(14)),this._gJoinCirclesOuter.datum(this._joinCircleData).attr("d",Object(i.a)().pointRadius(28))}_isPortIn(t){return"all"===this._showPB||"single"===this._showPB&&t.id===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"noShow"!==this._showPB?(this._filterVisible(),this._pbCircleData={type:"FeatureCollection",features:this._pbCircleDataFiltered.filter(t=>this._isPortIn(t))},this._fortData={type:"FeatureCollection",features:this._fortDataFiltered.filter(t=>this._isPortIn(t))},this._towerData={type:"FeatureCollection",features:this._towerDataFiltered.filter(t=>this._isPortIn(t))},this._joinCircleData={type:"FeatureCollection",features:this._joinCircleDataFiltered.filter(t=>this._isPortIn(t))}):(this._pbCircleData={},this._fortData={},this._towerData={},this._joinCircleData={})}_filterVisible(){this._pbCircleDataFiltered=this._pbCircleDataDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]),this._fortDataFiltered=this._fortDataDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]),this._towerDataFiltered=this._towerDataDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]),this._joinCircleDataFiltered=this._joinCircleDataDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1])}setBounds(t,e){this._lowerBound=t,this._upperBound=e}refresh(){this._setData(),this._update()}transform(t){this._g.attr("transform",t)}}}).call(this,s("xeH2"))},hVUp:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},i7nG:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},j9j5:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return p});var i=s("nUlG"),a=s("aBO9"),o=s("TiKg"),r=s.n(o),n=(s("YmdP"),s("W/Hz"),s("8sDi"),s("cRa1"),s("2W1i")),d=s.n(n),h=s("0lY5"),l=s("f4w0"),c=s("Av7d");class p{constructor(){this._line=Object(a.e)(),this._windPath=null,this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._cookieDegrees=`na-map--${this._baseId}-degrees`,this._cookieTime=`na-map--${this._baseId}-time`,this._cookieExpire=this._getExpire(),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}_getHeight(){const t=document.querySelector("#port-summary .block"),e=t.getBoundingClientRect();return e.height-e.top-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))}_getCurrentWindCookie(){const t=d.a.get(this._cookieDegrees)||null;if(t){const e=d.a.get(this._cookieTime),s=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-c.q*s)%360}return t}_getExpire(){const t=r.a.utc();let e=r()().utc().hour(10).minute(0).second(0);return t.hour()>e.hour()&&(e=e.add(1,"day")),e.local().toDate()}_storeCurrentWindCookie(){d.a.set(this._cookieDegrees,this._currentWindDegrees,{expires:this._cookieExpire}),d.a.set(this._cookieTime,Date.now())}_setupSvg(){this._div=Object(i.select)("#port-summary").insert("div",":first-child").attr("id",this._baseId).classed("block",!0),this._svg=this._div.append("svg").classed("coord small",!0)}_navbarClick(t){Object(l.b)("Menu",this._baseName),t.stopPropagation(),this._windRoseSelected()}_setupListener(){document.getElementById(`${this._buttonId}`).addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const s=e.call(this);return this.container.append(this.tooltip),s},window.tooltip=(t=>`${Object(h.j)(t.value)}<br>${t.value}°`),t(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/h.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")},change(){this._currentWind=t(`#${this._sliderId}`).roundSlider("getValue")}})}_injectModal(){r.a.locale("en-gb"),Object(c.x)(this._modalId,this._baseName,"sm");const t=Object(i.select)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")}_initModal(){this._injectModal(),this._setupWindInput()}_windRoseSelected(){document.getElementById(this._modalId)||this._initModal(),t(`#${this._modalId}`).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_windChange(){this._currentWindDegrees=360+(this._currentWindDegrees-c.q*this._intervalSeconds)%360,this._updateWindDirection()}_useUserInput(){this._currentWindDegrees=Object(h.w)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval(()=>{this._windChange()},1e3*this._intervalSeconds)}_updateWindDirection(){const t=Object(h.h)(this._currentWindDegrees),e=this._length*Math.cos(t),s=this._length*Math.sin(t),i=[[Math.round(this._xCompass+e),Math.round(this._yCompass+s)],[Math.round(this._xCompass-e),Math.round(this._yCompass-s)]];this._windPath.datum(i).attr("d",this._line),this._storeCurrentWindCookie()}_initPrintCompassRose(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);const t=this._svg.append("svg").classed("compass",!0).attr("x",this._xCompass).attr("y",this._yCompass);Object(h.A)({elem:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").classed("wind",!0).attr("marker-end","url(#wind-arrow)")}clearMap(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=null,d.a.remove(this._cookieDegrees)}}}).call(this,s("xeH2"))},jtsq:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},ncpf:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},q1r0:function(t,e,s){"use strict";(function(t){s.d(e,"a",function(){return n});s("GjCE");var i=s("nUlG"),a=s("0lY5"),o=s("Av7d"),r=s("f4w0");class n{constructor(t,e){this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._xInputId=`input-x-${this._baseId}`,this._zInputId=`input-z-${this._baseId}`,this._copyButtonId=`copy-coord-${this._baseId}`,this._submitButtonId=`submit-${this._baseId}`,this._modal$=null,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(i.select)("#na-svg").append("g").classed("f11",!0)}_navbarClick(t){Object(r.b)("Menu","Go to F11"),t.stopPropagation(),this._f11Selected()}_setupListener(){document.getElementById(`${this._buttonId}`).addEventListener("click",t=>this._navbarClick(t)),window.onkeydown=(t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick(t)})}_injectModal(){Object(o.x)(this._modalId,this._baseName,"sm");const t=Object(i.select)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const s=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);s.append("label").attr("for",this._zInputId),s.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),s.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const a=t.append("div").classed("float-right btn-group",!0).attr("role","group");a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("far fa-copy",!0),a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to"),Object(i.select)(`#${this._modalId} .modal-footer`).remove()}_initModal(){this._injectModal()}_f11Selected(){this._modal$||(this._initModal(),this._modal$=t(`#${this._modalId}`),this._xInputSel=document.getElementById(this._xInputId),this._zInputSel=document.getElementById(this._zInputId),this._formSel.onsubmit=(t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()}),this._modal$.on("keydown",t=>{"KeyC"===t.code&&t.ctrlKey&&this._copyCoordClicked(t)}),document.getElementById(this._copyButtonId).addEventListener("click",t=>{this._copyCoordClicked(t)})),this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()}_getInputValue(t){const e=t.value;return""===e?1/0:+e}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){const e=t=>{if(!document.queryCommandSupported||!document.queryCommandSupported("copy"))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const e=document.createElement("input");e.type="text",e.value=t,e.style="position: absolute; left: -1000px; top: -1000px",this._modal$.append(e),e.select();try{return document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{e.remove()}}};Object(r.b)("Menu","Copy F11 coordinates"),t.preventDefault();const s=this._getXCoord(),i=this._getZCoord();if(Number.isFinite(s)&&Number.isFinite(i)){const t=new URL(window.location);t.searchParams.set("x",s),t.searchParams.set("z",i),(t=>navigator.permissions.query({name:"clipboard-write"}).then(e=>{if("granted"===e.state||"prompt"===e.state)return navigator.clipboard.writeText(t).then(()=>!0,()=>(console.error(`Cannot copy ${t} to clipboard`),!1))},()=>e(t)))(t.href)}}_printF11Coord(t,e,s,i){let o=10;const r=this._g.append("g").attr("transform",`translate(${t},${e})`),n=r.append("rect");r.append("circle").attr("r",o),o*=1.6;const d=r.append("text").attr("dx",`${-o}px`).attr("dy",`${-o/2}px`).text(Object(a.m)(s)),h=r.append("text").attr("dx",`${-o}px`).attr("dy",`${o/2}px`).text(Object(a.m)(i)),l=d.node().getBBox(),c=h.node().getBBox(),p=Math.round(l.height+c.height),_=Math.round(Math.max(l.width,c.width)+5);n.attr("x",-_-o).attr("y",-p/2).attr("height",p).attr("width",_+o)}_goToF11(t,e){const s=+t,i=+e,r=Math.floor(Object(o.k)(s,i)),n=Math.floor(Object(o.l)(s,i));Object(a.a)(r,this._coord.min,this._coord.max,!0)&&Object(a.a)(n,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(r,n,s,i),this._map.zoomAndPan(r,n,1))}checkF11Coord(){const t=new URL(document.location).searchParams;if(t.has("x")&&t.has("z")){const e=-1e3*+t.get("x"),s=-1e3*+t.get("z");Object(r.b)("Menu","Paste F11 coordinates"),this._goToF11(e,s)}else history.pushState("","",window.location.pathname)}printCoord(t,e){const s=Object(o.m)(t,e),i=Object(o.n)(t,e);this._printF11Coord(t,e,s,i)}transform(t){this._g.attr("transform",t)}clearMap(){this._g.selectAll("*").remove()}}}).call(this,s("xeH2"))},tUdp:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""},vHJc:function(t,e,s){t.exports=s.p+"icons/US.svg"},vi22:function(t,e,s){"use strict";s.r(e),function(t){s.d(e,"Map",function(){return w});s("4aJ6"),s("W1QL");var i=s("/Cyf"),a=s("nUlG"),o=s("NRFW"),r=s("fED9"),n=(s("3XUK"),s("hSFQ"),s("Peo2"),s("Av7d")),d=s("0lY5"),h=s("f4w0"),l=s("NO11"),c=s("iJ1D"),p=s("eqiN"),_=s("FmV8"),u=s("cAXh"),m=s("q1r0"),g=s("cCJq"),f=s("8gAj"),v=s("62GW"),b=s("j9j5"),y=s("JNxp");class w{constructor(t){this._serverName=t,this._dataDir="data",this._dataSources=[{fileName:"ports.json",name:"ports"},{fileName:`${t}-trades.json`,name:"trades"},{fileName:`${t}.json`,name:"server"},{fileName:`${t}-pb.json`,name:"pb"},{fileName:"pb.json",name:"pbZones"},{fileName:"ships.json",name:"ships"},{fileName:"woods.json",name:"woods"}],this.rem=n.p,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:8192},this._currentTranslate={},this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new l.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickActionRadios=new c.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["on","off"],this._showGridCookie=new l.a(this._showGridId,this._showGridValues),this._showGridRadios=new c.a(this._showGridId,this._showGridValues),this._showGrid=this._getShowGridValue();var e=document.getElementsByClassName("flex-overlay");this._flexOverlay=e[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener(),this._readData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}_setupData(t){const e=t.ports.filter(t=>!t.nonCapturable).map(t=>t.id),s=t=>t.filter(t=>e.includes(t.id)).map(t=>({type:"Feature",id:t.id,position:t.properties.position,geometry:t.geometry})),i=t.ports.map(e=>{const s=e,i=t.server.find(t=>t.id===s.id);s.portBattleStartTime=i.portBattleStartTime,s.portBattleType=i.portBattleType,s.nonCapturable=i.nonCapturable,s.conquestMarksPension=i.conquestMarksPension,s.portTax=i.portTax,s.taxIncome=i.taxIncome,s.netIncome=i.netIncome,s.tradingCompany=i.tradingCompany,s.laborHoursDiscount=i.laborHoursDiscount,s.dropsTrading=i.dropsTrading,s.consumesTrading=i.consumesTrading,s.producesNonTrading=i.producesNonTrading,s.dropsNonTrading=i.dropsNonTrading,s.inventory=i.inventory,["dropsTrading","consumesTrading","producesNonTrading","dropsNonTrading"].forEach(t=>{s[t]||delete s[t]});const a=t.pb.ports.find(t=>t.id===s.id);return s.nation=a.nation,s.capturer=a.capturer,s.lastPortBattle=a.lastPortBattle,s.attackHostility=a.attackHostility,s.attackerClan=a.attackerClan,s.attackerNation=a.attackerNation,s.portBattle=a.portBattle,s});this._f11=new m.a(this,this.coord),this._ports=new _.a(i,this);let a=Object(r.a)(t.pbZones,t.pbZones.objects.pbCircles);a=s(a.features);let o=Object(r.a)(t.pbZones,t.pbZones.objects.forts);o=s(o.features);let n=Object(r.a)(t.pbZones,t.pbZones.objects.towers);n=s(n.features);let d=Object(r.a)(t.pbZones,t.pbZones.objects.joinCircles);d=s(d.features),this._pbZone=new p.a(a,o,n,d,this._ports),this._grid=new g.a(this),this._woodData=JSON.parse(JSON.stringify(t.woods)),this._shipData=JSON.parse(JSON.stringify(t.ships)),this._journey=new f.a(this._shipData,this._woodData,this.rem),this._portSelect=new u.a(this._ports,this._pbZone,this),this.showTrades=new y.a(this._portSelect,i,t.trades,this._minScale,this.coord.min,this.coord.max),this._init(),this._windPrediction=new v.a,this._windRose=new b.a}_readData(){const t=[],e={};this._dataSources.forEach((e,s)=>{t[s]=fetch(`${this._dataDir}/${e.fileName}`).then(d.c).then(d.u)}),Promise.all(t).then(t=>{t.forEach((t,s)=>{e[this._dataSources[s].name]=t}),this._setupData(e)}).catch(d.B)}_setupListener(){this._svg.on("dblclick.zoom",null).on("click",function(){a.event.defaultPrevented&&a.event.stopPropagation()},!0).on("dblclick",(t,e,s)=>this._doDoubleClickAction(s[e])),document.getElementById("propertyDropdown").addEventListener("click",()=>{Object(h.b)("Menu","Select port on property")}),document.getElementById("settingsDropdown").addEventListener("click",()=>{Object(h.b)("Menu","Settings")}),document.getElementById("button-download-pb-calc").addEventListener("click",()=>{Object(h.b)("Tools","Download pb calculator")}),document.getElementById("reset").addEventListener("click",()=>{this._clearMap()}),document.getElementById("about").addEventListener("click",()=>{this._showAbout()}),document.getElementById("double-click-action").addEventListener("change",()=>this._doubleClickSelected()),document.getElementById("show-grid").addEventListener("change",()=>this._showGridSelected())}_setupScale(){this._minScale=Object(d.y)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this._minScale}_setupSvg(){this._zoom=Object(o.a)().wheelDelta(()=>-this._wheelDelta*Math.sign(a.event.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this._minScale,this.coord.min-this.xGridBackgroundHeight*this._minScale],[this.coord.max,this.coord.max]]).scaleExtent([this._minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this._svg=Object(a.select)("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").classed("map",!0)}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._profitValue),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._refreshLayer()}_refreshLayer(){this._grid.update()}_displayMap(t){const e=t.x,s=t.y,a=t.k,r=Math.log2(this._tileSize),n=Math.log2(this.coord.max)-r,h=this.coord.max*a,l=this.width,c=this.height,p=Math.floor(h<l?l-2*e:h),_=Math.floor(h<c?c-2*s:h),u=Math.log2(a),m=Math.min(n,Math.ceil(Math.log2(Math.max(p,_)))-r),g=Math.round(10*(m-u-n))/10,f=this._wheelDelta**g,v=this._tileSize*f,b=h<l?e:0,y=h<c?s:0,w=Object(i.e)(Math.max(0,Math.floor((0-e)/v)),Math.max(0,Math.min(Math.ceil((l-e-b)/v),2**m))),S=Object(i.e)(Math.max(0,Math.floor((0-s)/v)),Math.max(0,Math.min(Math.ceil((c-s-y)/v),2**m))),x=[];S.forEach(t=>{w.forEach(e=>{x.push({z:m,row:t,col:e,id:`${m.toString()}-${t.toString()}-${e.toString()}`})})}),x.transform=o.b.translate(e,s).scale(Object(d.D)(f)),this._updateMap(x)}_updateMap(t){this._gMap.attr("transform",t.transform).selectAll("image").data(t,t=>t.id).join(t=>t.append("image").attr("xlink:href",t=>`images/map/${t.z}/${t.row}/${t.col}.jpg`).attr("x",t=>t.col*this._tileSize).attr("y",t=>t.row*this._tileSize).attr("width",this._tileSize+1).attr("height",this._tileSize+1))}_clearMap(){this._windPrediction.clearMap(),this._windRose.clearMap(),this._f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){var e;t("#modal-about").length||(e="modal-about",Object(n.x)(e,`${n.c} <span class="text-primary small">v${n.d}</span>`,""),Object(a.select)(`#${e} .modal-body`).html(`<p>${n.a} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan <a href="https://bccnavalaction.freeforums.net/">British Captains’ Club ${Object(d.i)("(BCC)")}</a>.</p>`)),t("#modal-about").modal("show")}_doDoubleClickAction(t){const e=Object(a.mouse)(t),s=Object(o.c)(t),i=e[0],r=e[1],n=s.k,d=(i-s.x)/n,h=(r-s.y)/n;"f11"===this._doubleClickAction?this._f11.printCoord(d,h):this._journey.plotCourse(d,h),this.zoomAndPan(d,h,1)}_setZoomLevelAndData(){a.event.transform.k!==this._currentScale&&(this._currentScale=a.event.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)}_naZoomed(){this._currentTranslate.x=Math.floor(a.event.transform.x),this._currentTranslate.y=Math.floor(a.event.transform.y);const t=o.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(d.D)(a.event.transform.k)),e=t.invert([this.coord.min,this.coord.min]),s=t.invert([this.width,this.height]);this._ports.setBounds(e,s),this._pbZone.setBounds(e,s),this.showTrades.setBounds(e,s),this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._journey.transform(t),this._pbZone.transform(t),this._f11.transform(t),this.showTrades.transform(t),this._setZoomLevelAndData()}_init(){this.zoomLevel="initial",this.initialZoomAndPan(),this._f11.checkF11Coord(),this._setFlexOverlayHeight()}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}get zoomLevel(){return this._zoomLevel}resize(){const t=o.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update(!0)}_getDimensions(){return document.getElementsByClassName("flex-overlay")[0].getBoundingClientRect()}_getWidth(){return this._getDimensions().width}_getHeight(){const t=this._getDimensions().top;return document.documentElement.clientHeight-this.rem-t}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight()}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){const t=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);this._flexOverlay.setAttribute("style",`height:${t}px`)}initialZoomAndPan(){this._svg.call(this._zoom.scaleTo,this._minScale)}zoomAndPan(t,e,s){const i=o.b.scale(s).translate(Math.round(-t+this.width/2/s),Math.round(-e+this.height/2/s));this._svg.call(this._zoom.transform,i)}goToPort(){"0"!==this._ports.currentPort.id?this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2):this.initialZoomAndPan()}}}.call(this,s("xeH2"))},vq93:function(t,e,s){var i={"./DE.svg":"YBSV","./DEa.svg":"hVUp","./DK.svg":"jtsq","./DKa.svg":"Rhp1","./ES.svg":"+42d","./ESa.svg":"0siz","./FR.svg":"yQGq","./FRa.svg":"T2LJ","./FT.svg":"YOhT","./GB.svg":"BI2v","./GBa.svg":"R5TC","./NT.svg":"Q9mY","./PL.svg":"VPfe","./PLa.svg":"9c4Y","./PR.svg":"cBlp","./PRa.svg":"/foq","./RU.svg":"ncpf","./RUa.svg":"7chY","./SE.svg":"tUdp","./SEa.svg":"i7nG","./US.svg":"vHJc","./USa.svg":"28Wg","./VP.svg":"K2vO","./VPa.svg":"e7/b"};function a(t){var e=o(t);return s(e)}function o(t){if(!s.o(i,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return i[t]}a.keys=function(){return Object.keys(i)},a.resolve=o,t.exports=a,a.id="vq93"},yQGq:function(t,e){t.exports="\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E\""}}]);