/*! For license information please see game-tools.14c2fe79f69852998de0.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"1mfJ":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3E%3Cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3E%3C/svg%3E"},"8ZGG":function(t,e,s){s.d(e,"a",(function(){return a}));const a=["loot","chests","items"]},Bx8B:function(t,e,s){s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return i}));s("UxlC");const a=(t,e)=>t&&e?t.localeCompare(e):0,i=t=>(e,s)=>{let a=0;return t.some(t=>{let i=1;return String(t).startsWith("-")&&(i=-1,t=String(t).slice(1)),a=Number.isNaN(Number(e[t]))&&Number.isNaN(Number(s[t]))?String(e[t]).localeCompare(String(s[t]))*i:(Number(e[t])-Number(s[t]))*i,0!==a}),a}},D04b:function(t,e,s){(function(t){s.d(e,"a",(function(){return D}));s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("PuWf"),i=s("wz8V"),r=s("mrVq"),o=s("gj+k"),n=s("RhHs"),d=s("3xmg"),c=s("R0i0"),l=s("VIqg"),h=s("AKWm"),p=s("wIsI"),u=s("0T5i"),m=s("44y/"),b=s("jICm"),_=s("pOjD"),g=s("pxNS"),f=s("Q4du"),v=s("oggF");function S(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class D{constructor(){S(this,"_baseName",void 0),S(this,"_baseId",void 0),S(this,"_buttonId",void 0),S(this,"_modalId",void 0),S(this,"_ownershipData",{}),S(this,"_nationData",{}),S(this,"_colourScale",void 0),S(this,"_mainDiv",void 0),S(this,"_div",void 0),S(this,"_svg",void 0),this._baseName="Port ownership",this._baseId="ownership-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._colourScale=Object(d.a)().range(f.g),this._setupListener()}static getHeight(){return Math.floor(.75*top.innerHeight)}_getWidth(){var t;return null!==(t=Math.floor(this._mainDiv.node().offsetWidth))&&void 0!==t?t:0}async _loadAndSetupData(){try{this._nationData=(await s.e(9).then(s.t.bind(null,"igRa",3))).default,this._ownershipData=(await s.e(10).then(s.t.bind(null,"kH+C",3))).default}catch(t){Object(g.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._ownershipListSelected()})}_injectModal(){Object(f.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(h.a)(`#${this._modalId} .modal-body`);e.append("label").append("select").attr("name",t).attr("id",t),this._mainDiv=e.append("div").attr("id",""+this._baseId),this._div=this._mainDiv.append("div"),this._svg=this._mainDiv.append("svg").attr("class","area")}_getOptions(){return""+this._ownershipData.map(t=>`<option value="${t.region}">${t.region}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._regionSelected(t)).selectpicker({noneSelectedText:"Select region"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_ownershipListSelected(){let e=!1;document.querySelector("#"+this._modalId)||(e=!0,this._initModal()),t("#"+this._modalId).on("shown.bs.modal",()=>{e&&(this._injectArea(),e=!1)}).modal("show")}_injectArea(){const t=this._getWidth(),e=Math.min(1e3,D.getHeight()),s=32,d=32,h=32,_=g.d.filter(t=>9!==t.id).map(t=>t.short),f=this._nationData;f.keys=_;const S=Object(p.a)().offset(u.a).keys(_)(f);this._svg.attr("width",t).attr("height",e),(()=>{const n=(()=>{const a=Object(l.a)().domain(Object(i.a)(f,t=>new Date(t.date))).range([h,t-s]),n=Object(l.a)().domain([Object(r.a)(S[0],t=>t[0]),Object(o.a)(S[S.length-1],t=>t[1])]).range([e-d,0]);return Object(m.a)().x(t=>a(new Date(t.data.date))).y0(t=>n(t[0])).y1(t=>n(t[1])).curve(b.a)})(),c=new Map(g.d.map(t=>[t.short,t.name]));this._colourScale.domain(_),this._svg.selectAll("path").data(S).join(t=>t.append("path").attr("fill",t=>this._colourScale(t.key)).attr("stroke",t=>this._colourScale(t.key)).attr("d",n)),this._svg.selectAll(".area-label").data(S).join(t=>t.append("text").attr("class","area-label").text(t=>c.get(t.key)).attr("fill",t=>Object(v.d)(this._colourScale(t.key))).attr("transform",Object(a.areaLabel)(n)))})(),this._svg.append("g").call(a=>{const r=Object(c.b)().domain(Object(i.a)(f,t=>new Date(t.date))).range([h,t-s]);a.attr("transform",`translate(0,${e-d})`).call(Object(n.a)(r).ticks(t/80).tickSizeOuter(0)),a.attr("font-size",".8rem").attr("font-family","")})}async _injectChart(t){(await Promise.all([s.e(3),s.e(25)]).then(s.bind(null,"ZiDp"))).default().data(t).enableAnimations(!1).timeFormat("%-d %B %Y").zQualitative(!0).zColorScale(this._colourScale).width(this._getWidth())(this._div.node())}_regionSelected(e){const s=t(e.currentTarget).find(":selected").val();this._div.selectAll("*").remove();const a=this._ownershipData.filter(t=>t.region===s).map(t=>t.data)[0];this._injectChart(a)}}}).call(this,s("xeH2"))},"Jz/z":function(t,e,s){(function(t){s.d(e,"a",(function(){return h}));s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("AKWm"),i=s("pOjD"),r=s("pxNS"),o=s("Q4du"),n=s("Qs7V"),d=s("Bx8B");function c(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const l=["Resources","Extra","Materials"];class h{constructor(){c(this,"_baseName",void 0),c(this,"_baseId",void 0),c(this,"_buttonId",void 0),c(this,"_modalId",void 0),c(this,"_init",!0),c(this,"_blueprintData",{}),c(this,"_woodData",{}),c(this,"_extractionCosts",{}),c(this,"_craftingCosts",{}),c(this,"_blueprint",void 0),c(this,"_woodOptions",{}),c(this,"_defaultWood",void 0),c(this,"_woodsSelected",{}),c(this,"_blueprintList",void 0),c(this,"_currentBlueprint",{}),c(this,"_tables",{}),this._baseName="List ship blueprint",this._baseId="ship-blueprint-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._defaultWood={frame:"Fir",trim:"Crew Space"},this._setupListener()}async _loadAndSetupData(){try{this._blueprintData=(await s.e(14).then(s.t.bind(null,"lFc/",3))).default,this._woodData=(await s.e(16).then(s.t.bind(null,"xOpV",3))).default;const t=(await s.e(14).then(s.t.bind(null,"ZII7",3))).default;this._extractionCosts=new Map(t.standard.map(t=>[t.name,{real:t.real,labour:t.labour}])),this._craftingCosts=new Map(t.seasoned.map(t=>[t.name,{real:t.real,labour:t.labour,doubloon:t.doubloon,tool:t.tool}]))}catch(t){Object(r.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._listSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName,size:"modal-lg"});const t=this._baseId+"-ship-select",e=Object(a.a)(`#${this._modalId} .modal-body`);let s=e.append("div").classed("row no-gutters mb-2",!0);s.append("label").attr("for",t),s.append("select").attr("name",t).attr("id",t),s=e.append("div").classed("row no-gutters",!0);for(const t of r.g){const e=`${this._baseId}-${t}-select`;s.append("label").attr("for",e),s.append("select").attr("name",e).attr("id",e).classed("pr-2",!0)}this._blueprintList=e.append("div").attr("id",""+this._baseId).classed("blueprint mt-4",!0)}_getShipOptions(){return""+this._blueprintData.sort(Object(d.b)(["name"])).map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}_setupShipSelect(){const e=t(`#${this._baseId}-ship-select`),s=this._getShipOptions();e.append(s)}_setupWoodOptions(){const t=this._woodData.frame.sort(Object(d.b)(["name"])),e=this._woodData.trim.filter(t=>"Light"!==t.name).sort(Object(d.b)(["name"]));this._woodOptions={frame:t.map(t=>`<option value="${t.name}">${t.name}</option>`).join(""),trim:e.map(t=>`<option value="${t.name}">${t.name}</option>`).join("")}}_setupWoodSelect(t,e){this._setupWoodOptions(),this._woodsSelected[t]=this._defaultWood[t],e.append(this._woodOptions[t]),e.attr("disabled","disabled")}_setupSelects(){this._setupShipSelect();for(const e of r.g){const s=t(`#${this._baseId}-${e}-select`);this._setupWoodSelect(e,s)}}_setupShipSelectListener(){t(`#${this._baseId}-ship-select`).addClass("selectpicker").on("change",t=>this._blueprintSelected(t)).selectpicker({noneSelectedText:"Select blueprint",width:"fit"}).val("default").selectpicker("refresh")}_setupWoodSelectListener(t,e){e.addClass("selectpicker").on("change",()=>this._woodSelected(t,e)).selectpicker({noneSelectedText:"Select "+t,width:"fit"}).val("default").selectpicker("refresh")}_setupSelectListener(){this._setupShipSelectListener();for(const e of r.g){const s=t(`#${this._baseId}-${e}-select`);this._setupWoodSelectListener(e,s)}}_initModal(){this._injectModal(),this._setupSelects(),this._setupSelectListener()}_setWoodSelect(e){t(`#${this._baseId}-${e}-select`).removeAttr("disabled").val(this._defaultWood[e]).selectpicker("refresh")}_woodSelected(t,e){this._woodsSelected[t]=e.val(),this._updateText()}_listSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_updateTable(t,e){t.select("tbody").selectAll("tr").data(e).join(t=>t.append("tr")).selectAll("td").data(t=>t).join(t=>t.append("td")).html(t=>t)}_updateText(){let t=this._currentBlueprint.resources.map(t=>[t.name,t.amount]),e=!1,s=!1,a=0,i=0;if("Crew Space"===this._woodsSelected.trim){const e=this._currentBlueprint.wood.find(t=>"Crew Space"===t.name).amount,s=t.findIndex(t=>"Hemp"===t[0]);t[s][1]=t[s][1]+e}else if(i=this._currentBlueprint.wood.find(t=>"Planking"===t.name).amount,this._woodsSelected.trim===this._woodsSelected.frame)a+=i;else{const e=t.findIndex(t=>t[0]===this._woodsSelected.trim);e>=0?t[e][1]=t[e][1]+i:(s=!0,t.push([this._woodsSelected.trim,i]))}a+=this._currentBlueprint.wood.find(t=>"Frame"===t.name).amount;const r=t.findIndex(t=>t[0]===this._woodsSelected.frame);if(r>=0?t[r][1]=t[r][1]+a:(e=!0,t.push([this._woodsSelected.frame,a])),e&&s){const e=t.length-1;[t[e],t[e-1]]=[t[e-1],t[e]]}let o=[];this._currentBlueprint.price&&o.push(["Reals",this._currentBlueprint.price]),o.push(["Provisions",this._currentBlueprint.provisions]),this._currentBlueprint.permit&&o.push(["Permit",this._currentBlueprint.permit]),o.push(["Craft level",this._currentBlueprint.craftLevel],["Shipyard level",this._currentBlueprint.shipyardLevel],["Labour hours",this._currentBlueprint.labourHours],["Craft experience",this._currentBlueprint.craftXP]);const d=[];let c=0,l=0;const h=t=>this._extractionCosts.get(t[0]).real*t[1],p=t=>this._extractionCosts.get(t[0]).labour*t[1],u=t=>{for(const e of t.filter(t=>this._extractionCosts.has(t[0])))c+=h(e),l+=p(e)};u(t),u(o),c&&d.push(["Reals",Object(n.c)(c)],["Labour hours",Object(n.c)(l)]);let m=0,b=0,_=0,g=0;this._craftingCosts.has(this._woodsSelected.trim)&&(m+=this._craftingCosts.get(this._woodsSelected.trim).real*i,b+=this._craftingCosts.get(this._woodsSelected.trim).labour*i,_+=this._craftingCosts.get(this._woodsSelected.trim).doubloon*i,g+=this._craftingCosts.get(this._woodsSelected.trim).tool*i),this._craftingCosts.has(this._woodsSelected.frame)&&(m+=this._craftingCosts.get(this._woodsSelected.frame).real*a,b+=this._craftingCosts.get(this._woodsSelected.frame).labour*a,_+=this._craftingCosts.get(this._woodsSelected.frame).doubloon*a,g+=this._craftingCosts.get(this._woodsSelected.frame).tool*a),m&&d.push(["(S) reals",Object(n.c)(m)],["(S) labour hours",Object(n.c)(b)],["(S) doubloons",Object(n.c)(_)],["(S) tools",Object(n.c)(g)]),t=t.map(t=>[t[0],Object(n.c)(t[1])]),o=o.map(t=>[t[0],Object(n.c)(t[1])]),this._updateTable(this._tables.Resources,t),this._updateTable(this._tables.Extra,o),this._updateTable(this._tables.Materials,d)}_blueprintSelected(e){if(this._init){this._init=!1;for(const t of r.g)this._setWoodSelect(t);const t=this._blueprintList.append("div").classed("card-deck",!0),e=e=>{const s=t.append("div").classed("card",!0);s.append("div").classed("card-header",!0).text(e);const a=s.append("div").classed("card-body",!0);this._tables[e]=a.append("table").classed("table table-sm card-table",!0),this._tables[e].append("thead"),this._tables[e].append("tbody")};for(const t of l)e(t)}this._blueprint=t(e.currentTarget).find(":selected").val(),this._currentBlueprint=this._getBlueprintData(this._blueprint),this._updateText()}_getBlueprintData(t){return this._blueprintData.find(e=>e.name===t)}}}).call(this,s("xeH2"))},K5dq:function(t,e,s){(function(t){s.d(e,"a",(function(){return f}));s("WUlJ"),s("fCtr");var a=s("AKWm"),i=s("XXsb"),r=s.n(i),o=s("2mXy"),n=s("JQHs"),d=s("pOjD"),c=s("pxNS"),l=s("Q4du"),h=s("Qs7V"),p=s("oggF"),u=s("Bx8B");function m(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function _(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const g=n.a.bind(o.a);class f{constructor(){_(this,"_baseName",void 0),_(this,"_baseId",void 0),_(this,"_buttonId",void 0),_(this,"_modalId",void 0),_(this,"_woodData",{}),_(this,"_div",void 0),this._baseName="List woods",this._baseId="wood-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._woodData=(await s.e(16).then(s.t.bind(null,"xOpV",3))).default}catch(t){Object(c.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(d.b)("Tools",this._baseName),this._woodListSelected()})}_injectModal(){Object(l.n)({id:this._modalId,title:this._baseName,size:"modal-xl"});const t=Object(a.a)(`#${this._modalId} .modal-body`);this._div={};for(const e of c.g)t.append("h5").text(Object(c.b)(e+"s")),this._div[e]=t.append("div").attr("id",e+"-list")}_initModal(){Object(p.i)(),this._injectModal();for(const t of c.g)this._injectList(t)}_woodListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getModifiers(t){const e=new Set;return this._woodData[t].forEach(t=>{t.properties.forEach(t=>{"Ship material"!==t.modifier&&"Boarding morale"!==t.modifier&&e.add(t.modifier)})}),m(e).sort(u.a)}_getList(t){const e=this._getModifiers(t);return g`
            <table id="table-${this._baseId}-${t}-list" class="table table-sm small tablesort na-table">
                ${g` <thead>
                <tr>
                    <th data-sort-default>Wood</th>
                    ${e.map(t=>g`<th class="text-right">
                            ${(t=>{const e=t.split(" ",2),s=t.slice(e.join(" ").length);return g`${e[0]}<br />${e[1]} ${s}`})(t)}
                        </th>`)}
                </tr>
            </thead>`} ${(t=>g`<tbody>
                ${this._woodData[t].map(t=>g`
                            <tr>
                                <td>${t.name}</td>

                                ${e.map(e=>{var s,a;const i=null!==(s=null===(a=t.properties.find(t=>t.modifier===e))||void 0===a?void 0:a.amount)&&void 0!==s?s:0;let r;return r="Repair amount"===e&&i?Object(h.f)(i):i?Object(p.b)(i):"",g`<td class="text-right" data-sort="${null!=i?i:0}">
                                        ${r}
                                    </td>`})}
                            </tr>
                        `)}
            </tbody>`)(t)}
            </table>
        `}_injectList(t){Object(o.b)(this._getList(t),this._div[t].node());const e=document.querySelector(`#table-${this._baseId}-${t}-list`);new r.a(e)}}}).call(this,s("xeH2"))},KbbR:function(t,e,s){(function(t){s.d(e,"a",(function(){return u}));s("WUlJ"),s("fCtr"),s("ry7D");var a=s("AKWm"),i=s("pOjD"),r=s("pxNS"),o=s("Q4du"),n=s("Qs7V"),d=s("Bx8B"),c=s("dNoP");function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class u{constructor(){p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_moduleData",{}),p(this,"_ingredientData",{}),this._baseName="List recipe ingredients",this._baseId="ingredient-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await s.e(8).then(s.t.bind(null,"jhXC",3))).default,this._ingredientData=(await s.e(13).then(s.t.bind(null,"Oi4q",3))).default.ingredient}catch(t){Object(r.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._ingredientListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});Object(a.a)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_initModal(){this._injectModal(),this._injectList()}_ingredientListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getProperties(t){let e,s="",a="";for(const e of this._moduleData){const i=e[1].sort(Object(d.b)(["name"])).filter(e=>e.name===t);for(const t of i)s=e[0],a=`<tr><td>${t.properties.map(t=>{const e=t.isPercentage?Object(n.l)(t.amount/100):Object(n.k)(t.amount);return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`}return e=`<h6 class='text-muted text-left'>${s}</h6>`,e+=`<table class='table table-sm'><tbody>${a}</tbody></table>`,a?e:""}_getRows(){return this._ingredientData.map(t=>`<tr><td>${t.name}</td><td>${t.recipeNames.map(t=>{const e=this._getProperties(t);return e?`<a data-toggle="tooltip" title="${e}">${t}</a>`:t}).join("<br>")}</td></tr>`)}_getText(){const t=this._getRows(),e=Object(c.a)(t,2);let s="";for(const t of l(new Array(e.length).keys()))s+=`<div class="col-md-${Math.floor(12/e.length)}">`,s+='<table class="table table-sm na-table"><thead>',s+="<tr><th>Ingredient</th><th>Recipes</th></tr></thead><tbody>",s+=e[t].join(""),s+="</tbody></table></div>";return s}_injectList(){Object(a.a)(`#${this._baseId} div`).remove(),Object(a.a)("#"+this._baseId).append("div").classed("row",!0),Object(a.a)(`#${this._baseId} div`).html(this._getText()),t('[data-toggle="tooltip"]').tooltip({html:!0,placement:"auto",sanitize:!1})}}}).call(this,s("xeH2"))},MICP:function(t,e,s){(function(t){s.d(e,"a",(function(){return m}));s("UxlC"),s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("AKWm"),i=s("pOjD"),r=s("pxNS"),o=s("Q4du"),n=s("Qs7V"),d=s("oggF"),c=s("otg8"),l=s("Bx8B");function h(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const p=s("Bhad"),u=(t,e,s)=>`${Object(c.q)(e)} – ${Object(c.q)(s)}`;class m{constructor(t){h(this,"_serverType",void 0),h(this,"_baseName",void 0),h(this,"_baseId",void 0),h(this,"_buttonId",void 0),h(this,"_modalId",void 0),h(this,"_moduleData",[]),h(this,"_recipeData",[]),h(this,"_recipes",void 0),this._serverType=p.find(e=>e.id===t).type,this._baseName="List admiralty items and recipes",this._baseId="recipe-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await s.e(8).then(s.t.bind(null,"jhXC",3))).default,this._recipeData=(await s.e(13).then(s.t.bind(null,"Oi4q",3))).default.recipe,this._recipes=new Map(this._recipeData.flatMap(t=>t.recipes.map(t=>[t.id,t])))}catch(t){Object(r.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._recipeListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(a.a)(`#${this._modalId} .modal-body`);e.append("select").attr("name",t).attr("id",t),e.append("label").attr("for",t).attr("class","text-muted pl-2").text("Items listed here may not be available in the game (yet)."),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return this._recipeData.map(t=>`<optgroup label="${t.group}">${t.recipes.filter(t=>"Any"===t.serverType||t.serverType===this._serverType).sort(Object(l.b)(["name"])).map(t=>`<option value="${t.id}">${t.name.replace(/(\d)-(\d)(st|rd|th)/,u)}`).join("</option>")}`).join("</optgroup>")}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._recipeSelected(t)).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select item",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_recipeListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRecipeData(t){return this._recipes.get(t)}_getRequirementText(t){let e='<table class="table table-sm card-table"><tbody>';return t.labourPrice&&(e+=`<tr><td>${t.labourPrice} labour hours</td></tr>`),t.goldPrice&&(e+=`<tr><td>${Object(d.e)(t.goldPrice)}</td></tr>`),t.itemRequirements.length>0&&(e+=`<tr><td>${t.itemRequirements.map(t=>`${t.amount} ${t.name}`).join("</td></tr><tr><td>")}</td></tr>`),e+="</tbody></table>",e}_getPropertiesText(t){let e="",s="",a="";for(const e of this._moduleData){const i=e[1].filter(e=>e.id===t.result.id);for(const t of i)[s]=e,a=`<tr><td>${t.properties.map(t=>{const e=t.isPercentage?Object(n.l)(t.amount/100):t.amount;return`${t.modifier} ${e}`}).join("</td></tr><tr><td>")}</td></tr>`}return a?(e+=`<h6 class="card-subtitle mb-2 text-muted">${s}</h6>`,e+=`<table class="table table-sm card-table na-table"><tbody>${a}</tbody></table>`):e+=`<p>${Object(n.c)(t.result.amount)} ${t.result.name}</p>`,e}_getText(t){const e=this._getRecipeData(t);let s='<div class="row no-gutters card-deck">';return s+='<div class="card col-6"><div class="card-header">Item</div>',s+='<div class="card-body">',s+=this._getRequirementText(e),s+="</div></div>",s+='<div class="card col-6"><div class="card-header">Result</div>',s+='<div class="card-body">',s+=this._getPropertiesText(e),s+="</div></div>",s+="</div></div>",s}_recipeSelected(e){const s=Number(t(e.currentTarget).find(":selected").val());Object(a.a)(`#${this._baseId} div`).remove(),Object(a.a)("#"+this._baseId).append("div").classed("mt-4",!0),Object(a.a)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s("xeH2"))},Qs7V:function(t,e,s){s.d(e,"e",(function(){return i})),s.d(e,"b",(function(){return o})),s.d(e,"j",(function(){return n})),s.d(e,"a",(function(){return d})),s.d(e,"c",(function(){return c})),s.d(e,"d",(function(){return l})),s.d(e,"k",(function(){return h})),s.d(e,"f",(function(){return p})),s.d(e,"i",(function(){return u})),s.d(e,"h",(function(){return m})),s.d(e,"g",(function(){return b})),s.d(e,"l",(function(){return _}));s("UxlC");var a=s("sXBl");const i=Object(a.a)({decimal:".",thousands:" ",grouping:[3],currency:[""," reals"],percent:" %",minus:"− "}),r=i.formatPrefix(",.0",1e3),o=(t,e=2)=>i.format(`,.${e}~r`)(t),n=(t,e=2)=>i.format(`+,.${e}~r`)(t).replace("+","＋ "),d=t=>r(-1*t).replace("k"," k"),c=t=>i.format(",d")(t),l=t=>i.format(",d")(0===t?0:t-.5),h=t=>i.format("+,d")(t).replace("+","＋ "),p=t=>i.format(",.0%")(t).replace("%","pp"),u=t=>i.format(",.2s")(t).replace(".0","").replace("M"," ᴍ").replace("k"," k").replace("m"," m"),m=t=>i.format("$,.2s")(t).replace(".0","").replace("M"," ᴍ").replace("k"," k"),b=(t,e=1)=>i.format(`.${e}%`)(t).replace(".0",""),_=t=>i.format("+.1%")(t).replace(".0","").replace("+","＋ ")},TwRt:function(t,e,s){s.r(e),s.d(e,"init",(function(){return g}));var a=s("pOjD"),i=s("Q4du"),r=s("u3gz"),o=s("ck04"),n=s("q1Yc"),d=s("eA68"),c=s("KbbR"),l=s("VUH8"),h=s("VnNF"),p=s("D04b"),u=s("MICP"),m=s("hVxF"),b=s("Jz/z"),_=s("K5dq");s("yU80");const g=(t,e)=>{const s=new r.a("ship-compare");(()=>{if(e.has("cmp")&&e.has("v")){const t=e.get("v");t&&t.split(".")[0]===i.d.split(".")[0]&&(Object(a.b)("Menu","Paste ship compare"),s.initFromClipboard(e))}})(),new o.a("wood"),new _.a,new n.a,new d.a,new c.a,new l.a,new h.a,new p.a,new u.a(t),new m.a,new b.a}},VUH8:function(t,e,s){(function(t){s.d(e,"a",(function(){return _}));s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("2mXy"),i=s("JQHs"),r=s("pOjD"),o=s("pxNS"),n=s("Qs7V"),d=s("oggF"),c=s("Bx8B"),l=s("8ZGG");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function u(t,e){var s=e.get(t);if(!s)throw new TypeError("attempted to get private field on non-instance");return s.get?s.get.call(t):s.value}function m(t,e,s){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,s);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=s}return s}const b=i.a.bind(a.a);class _{constructor(){g.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:l.a}),w.set(this,{writable:!0,value:""}),y.set(this,{writable:!0,value:{}}),$.set(this,{writable:!0,value:{}}),j.set(this,{writable:!0,value:0}),O.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),m(this,g,"List loot and chests"),m(this,f,"loot-list"),m(this,v,"button-"+u(this,f)),m(this,S,"modal-"+u(this,f));for(const t of u(this,D))u(this,y)[t]=`${u(this,f)}-${t}-select`;this._setupListener()}static _printAmount(t){return t.min===t.max?Object(n.c)(t.min):`${Object(n.c)(t.min)} to ${Object(n.c)(t.max)}`}static _printChance(t){return Object(n.c)(100*(1-t))}async _loadAndSetupData(){try{const t=(await s.e(7).then(s.t.bind(null,"fg1m",3))).default;m(this,x,t.loot),m(this,I,t.chests)}catch(t){Object(o.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+u(this,v)))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(r.b)("Tools",u(this,g)),this._sourceListSelected()})}_getLootOptions(){return b`
            ${u(this,x).sort(Object(c.b)(["name"])).map(t=>b`<option value="${t.id}">${t.name}</option>`)}
        `}_getChestsOptions(){return b`
            ${u(this,I).sort(Object(c.b)(["name"])).map(t=>b`<option value="${t.id}">${t.name}</option>`)}
        `}_getItemsOptions(){const t=new Map,e=(e,s,a)=>{const i=new Map([[e.id,{id:e.id,name:e.name,chance:a,amount:s.amount}]]);t.set(s.id,{name:s.name,sources:t.has(s.id)?new Map([].concat(h(t.get(s.id).sources),h(i))):i})};for(const t of u(this,x)){const{items:s}=t;for(const a of s)e(t,a,a.chance)}for(const t of u(this,I))for(const s of t.itemGroup){const{items:a}=s;for(const i of a)e(t,i,s.chance)}return m(this,C,new Map(h(t.entries()).sort((t,e)=>t[1].name.localeCompare(e[1].name)))),b`${h(u(this,C)).map(t=>b`<option value="${t[0]}">${t[1].name}</option>`)}`}_getOptions(t){let e=b``;return"items"===t&&(e=this._getItemsOptions()),"chests"===t&&(e=this._getChestsOptions()),"loot"===t&&(e=this._getLootOptions()),e}_getModalBody(){return b`
            ${u(this,D).map(t=>b`
                        <label>
                            <select id="${u(this,y)[t]}" class="selectpicker">
                                ${this._getOptions(t)}
                            </select>
                        </label>
                    `)}
            <div id="${u(this,f)}"></div>
        `}_getModalFooter(){return b`
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
            </button>
        `}_injectModal(){Object(a.b)(Object(d.c)({id:u(this,S),title:u(this,g),size:"modal-md",body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"))}_setupSelectListeners(){for(const t of u(this,D))u(this,$)[t].on("change",()=>{m(this,w,t),this._itemSelected()}).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select "+t,virtualScroll:!0})}_initModal(){this._injectModal(),m(this,O,document.querySelector("#"+u(this,f)));for(const e of u(this,D))u(this,$)[e]=t("#"+u(this,y)[e]);this._setupSelectListeners()}_sourceListSelected(){document.querySelector("#"+u(this,S))||this._initModal(),t("#"+u(this,S)).modal("show")}_getLootItemsText(t,e=!0){return b`
            <table class="table table-sm small na-table no-sort">
                <thead>
                    <tr>
                        <th scope="col">Item</th>
                        ${e?b`<th scope="col" class="text-right">Chance (0 − 100)</th>`:""}
                        <th scope="col" class="text-right">Amount</th>
                    </tr>
                </thead>
                <tbody>
                    ${t.map(t=>b`
                                <tr>
                                    <td>${t.name}</td>
                                    ${e?b` <td class="text-right">
                                              ${_._printChance(t.chance)}
                                          </td>`:""}
                                    <td class="text-right">
                                        ${_._printAmount(t.amount)}
                                    </td>
                                </tr>
                            `)}
                </tbody>
            </table>
        `}_getSourceText(){const t=h(u(this,C).get(u(this,j)).sources).map(t=>t[1]).sort(Object(c.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getChestsText(){const t=u(this,I).find(t=>t.id===u(this,j));return b`
            <p>Weight ${Object(n.c)(t.weight)} tons<br />Lifetime ${Object(n.c)(t.lifetime)} hours</p>
            ${t.itemGroup.map(t=>b` <h5>Group chance: ${_._printChance(t.chance)}</h5>
                    ${this._getLootItemsText(t.items.sort(Object(c.b)(["name"])),!1)}`)}
        `}_getLootText(){const t=u(this,x).find(t=>t.id===u(this,j)).items.sort(Object(c.b)(["chance","name"]));return b`${this._getLootItemsText(t)}`}_getText(){return"items"===u(this,w)?this._getSourceText():"chests"===u(this,w)?this._getChestsText():this._getLootText()}_getTable(){return b`
            <div class="mt-4">
                ${this._getText()}
            </div>
        `}_resetOtherSelects(){const t=u(this,D).filter(t=>t!==u(this,w));for(const e of t)u(this,$)[e].val("default").selectpicker("refresh")}_itemSelected(){const t=u(this,$)[u(this,w)].find(":selected");m(this,j,Number(t.val())),this._resetOtherSelects(),Object(a.b)(this._getTable(),u(this,O))}}var g=new WeakMap,f=new WeakMap,v=new WeakMap,S=new WeakMap,D=new WeakMap,w=new WeakMap,y=new WeakMap,$=new WeakMap,j=new WeakMap,O=new WeakMap,C=new WeakMap,x=new WeakMap,I=new WeakMap}).call(this,s("xeH2"))},VnNF:function(t,e,s){(function(t){s.d(e,"a",(function(){return m}));s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("AKWm"),i=s("pOjD"),r=s("pxNS"),o=s("Q4du"),n=s("Qs7V"),d=s("otg8"),c=s("Bx8B"),l=s("dNoP");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function u(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class m{constructor(){u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_moduleData",{}),this._baseName="List modules",this._baseId="module-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{this._moduleData=(await s.e(8).then(s.t.bind(null,"jhXC",3))).default}catch(t){Object(r.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._moduleListSelected()})}_injectModal(){Object(o.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(a.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId)}_getOptions(){return""+this._moduleData.map(t=>`<option value="${t[0]}"">${t[0]}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){t(`#${this._baseId}-select`).addClass("selectpicker").on("change",t=>this._moduleSelected(t)).selectpicker({noneSelectedText:"Select module category"}).val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_moduleListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getRows(t){const e=new Map([["L",`${Object(d.q)(1)} – ${Object(d.q)(3)}`],["M",`${Object(d.q)(4)} – ${Object(d.q)(5)}`],["S",`${Object(d.q)(6)} – ${Object(d.q)(7)}`]]),s=t=>{var s;return"U"===t?"":""+(null!==(s=e.get(t))&&void 0!==s?s:"")};let a="";const i=[];for(const e of this._moduleData)e[0]===t&&e[1].sort(Object(c.b)(["name"])).forEach((t,r)=>{const o=s=>s<e[1].length&&t.name===e[1][s].name&&JSON.stringify(t.properties)===JSON.stringify(e[1][s].properties);a=s(t.moduleLevel),o(r+1)&&(e[1][r+1].hasSamePropertiesAsPrevious=!0,a+="<br>"+s(e[1][r+1].moduleLevel)),o(r+2)&&(e[1][r+2].hasSamePropertiesAsPrevious=!0,a=""),void 0!==t.hasSamePropertiesAsPrevious&&t.hasSamePropertiesAsPrevious||i.push(`<tr><td><span class="name">${t.name}<br>${a}</span></td><td>${t.properties.map(t=>{let e;return e=t.isPercentage?Object(n.l)(t.amount/100):t.amount<1&&t.amount>0?Object(n.f)(t.amount):Object(n.k)(t.amount),`${t.modifier} ${e}`}).join("<br>")}</td></tr>`)});return i}_getText(t){const e=this._getRows(t),s=Object(l.a)(e,3);let a="";for(const t of h(new Array(s.length).keys()))a+=`<div class="col-md-${Math.floor(12/s.length)}">`,a+='<table class="table table-sm small na-table"><thead>',a+="<tr><th>Module</th><th>Modifier</th></tr></thead><tbody>",a+=s[t].join(""),a+="</tbody></table></div>";return a}_moduleSelected(e){const s=t(e.currentTarget).find(":selected").val();Object(a.a)(`#${this._baseId} div`).remove(),Object(a.a)("#"+this._baseId).append("div").classed("row mt-4",!0),Object(a.a)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s("xeH2"))},Z5fe:function(t,e,s){s.d(e,"a",(function(){return d}));var a=s("AKWm"),i=s("iPFw"),r=s("ZQwz"),o=s("Q4du");function n(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class d{constructor(t,e){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=t,this._shipCompare=e,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map(t=>t+" knots"),this.select="#ship-compare-"+this._id,this._setupSvg(),this._setCompass()}static pd(t){let e=`<span class="badge badge-white">${t.maxCannonLb} / `;return t.maxCarroLb?e+=""+t.maxCarroLb:e+="–",e+=" lb</span>",e}static getCannonsPerDeck(t){let e=`${t.gunsPerDeck[0].amount} ${d.pd(t.gunsPerDeck[0])}`,s="";for(let a=1;a<4;a+=1)t.gunsPerDeck[a].amount?e=`${t.gunsPerDeck[a].amount} ${d.pd(t.gunsPerDeck[a])} <br>${e}`:s+="<br>";return[e,s]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(t){let e=0;function s(t){return e+=1,`<div class="row row-small ${e%2?"row-light":""}"><div class="col-compress col-3">${t}</div>`}function a(e,s,a=6){let i,r="";return"cannonsPerDeck"===e?([i,r]=t[e],r="<br>"+r):i=""===e?"":String(t[e]),`<div class="col-compress col-${a}">${i}<br><span class="des">${s}</span>${r}</div>`}let i="";return i+=s(t.shipRating),i+=d.displaySecondBlock(),i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("rollAngle","Roll angle"),i+="</div></div></div>",i+=s(t.decks),i+=d.displaySecondBlock(),i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (lb)"),i+=d.displaySecondBlock(),i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+=d.displaySecondBlock(),i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+=d.displaySecondBlock(),i+=a("maxSpeed","Maximum"),i+=a("deceleration","Deceleration"),i+=a("acceleration","Acceleration"),i+=a("turnAcceleration","Turn acceleration"),i+=a("maxTurningSpeed","Rudder turn speed"),i+=a("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=s('Hit points <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+=d.displaySecondBlock(),i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+=d.displaySecondBlock(),i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+=a("cannonCrew","Cannon",4),i+=a("carroCrew","Carronades",4),i+="</div></div></div>",i+=s("Boarding"),i+=d.displaySecondBlock(),i+=a("morale","Morale",4),i+=a("attack","Attack",4),i+=a("defense","Defense",4),i+=a("musketsCrew","Crew with muskets",4),i+=a("musketsAccuracy","Musket accuracy %",4),i+=a("cannonsAccuracy","Cannon accuracy %",4),i+=a("prepPerRound","Preparation per round",4),i+=a("prepInitial","Initial preparation",4),i+=a("disengageTime","Rounds to disengage",4),i+="</div></div></div>",i+=s("Resistance"),i+=d.displaySecondBlock(),i+=a("fireResistance","Fire",4),i+=a("leakResistance","Leak",4),i+=a("splinterResistance","Splinter",4),i+="</div></div></div>",i+=s('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=d.displaySecondBlock(),i+=a("hullRepairsNeeded","Hull",4),i+=a("rigRepairsNeeded","Rig",4),i+=a("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=s("Repair"),i+=d.displaySecondBlock(),i+=a("hullRepairAmount","Hull %",4),i+=a("rigRepairAmount","Rig %",4),i+=a("repairTime","Time (sec)",4),i+="</div></div></div>",i+=s("Hold"),i+=d.displaySecondBlock(),i+=a("holdSize","Cargo slots"),i+=a("maxWeight","Tons"),i+="</div></div></div>",i+=s("Weight"),i+=d.displaySecondBlock(),i+=a("cannonWeight","Cannons",4),i+=a("carroWeight","Carronades",4),i+=a("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const t=Object(a.a)(this.select);Object(a.a)(this.select+" svg").remove(),this._svg=t.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),Object(a.a)(this.select+" div").remove(),t.append("div")}_setCompass(){const t=new Array(o.o/2);t.fill(1,0);const e=Object(i.a)().sort(null).value(1)(t),s=Object(r.a)().outerRadius(this._shipCompare.radiusSpeedScale(12)).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(e).join(t=>t.append("path").attr("d",s)),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join(t=>t.append("circle").attr("r",t=>this._shipCompare.radiusSpeedScale(t)))}}},awzk:function(t,e,s){(function(t){s.d(e,"a",(function(){return w}));var a=s("ZQwz"),i=s("iPFw"),r=s("VkQ2"),o=s("TI0E"),n=s("Qs7V"),d=s("otg8"),c=s("VIqg"),l=s("AWXE"),h=s("dNoP"),p=s("AJ/N"),u=s("pxNS"),m=s("Q4du"),b=s("1mfJ"),_=s.n(b),g=s("Z5fe"),f=s("oggF");function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function D(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class w extends g.a{constructor(t,e,s){super(t,s),D(this,"shipData",void 0),D(this,"_speedScale",void 0),D(this,"_shipRotate",void 0),D(this,"_speedText",void 0),D(this,"_drag",void 0),this.shipData=e,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const t=Object(a.a)().outerRadius(t=>this._shipCompare.radiusSpeedScale(t)+2).innerRadius(t=>this._shipCompare.radiusSpeedScale(t)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join(e=>e.append("path").attr("d",t).attr("id",(t,e)=>"tick"+e)),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join(t=>t.append("text").append("textPath").attr("href",(t,e)=>"#tick"+e).text((t,e)=>this.ticksSpeedLabels[e]).attr("startOffset","10%"))}_getHeadingInDegrees(t,e){let s=t-e-180;return s<0&&(s+=360),s}_getSpeed(t){return Object(n.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(d.m)(t)}_updateCompareWindProfiles(){for(const t of this._shipCompare.columnsCompare)Object(u.c)(this._shipCompare.selectedShips[t])||this._shipCompare.selectedShips[t].updateWindProfileRotation()}_setupDrag(){const t=this.shipData.speedDegrees.length,e=360/t,s=new Array(t+1).fill(null).map((t,s)=>s*e);this._speedScale=Object(c.a)().domain(s).range([].concat(v(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);this._drag=p.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:s}=l.c;t.rotate=this._getHeadingInDegrees(Object(h.m)({x:t.initX,y:t.initY},{x:e,y:s}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipData,e=this._shipCompare.shipMassScale(t),s=e,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",t=>t.initX).attr("y1",a-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),r.append("image").attr("height",e).attr("width",s).attr("x",-e/2).attr("y",-s/2).attr("xlink:href",_.a),r.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=r.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(t.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",t=>`rotate(${t.initRotate})`)}_drawWindProfile(){const t=Object(i.a)().sort(null).value(1)(this.shipData.speedDegrees),e=r.a,s=Object(o.a)().angle((t,e)=>e*m.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(e);this._shipCompare.windProfileRotate=0;const a=this._shipCompare.svgHeight/2-20,n={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-a,type:"windProfile"},d=this._mainG.append("g").datum(n).attr("class","wind-profile");d.append("path").attr("d",t=>String(Object(h.g)(t.compassTextX,t.compassTextY,20))+Object(h.h)(t.compassTextX,t.compassTextY,-t.compassTextY/2)).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),d.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20);const c=d.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));d.append("path").attr("class","base-profile").attr("d",s(t)),d.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(t).join(t=>t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*m.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*m.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).attr("fill",t=>this._shipCompare.colorScale(t.data)).append("title").text(t=>Math.round(10*t.data)/10+" knots")),n.this=d,n.compassText=c,d.datum(n).attr("transform",t=>`rotate(${t.initRotate})`)}_printText(){var e;const s=g.a.getCannonsPerDeck(this.shipData.guns),a=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/f.h),i=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/f.n),r=Math.round(this.shipData.crew.max*f.o),o={attack:Object(n.j)(this.shipData.boarding.attack,2),cannonsAccuracy:Object(n.k)(100*this.shipData.boarding.cannonsAccuracy),defense:Object(n.j)(this.shipData.boarding.defense,2),disengageTime:Object(n.d)(this.shipData.boarding.disengageTime),morale:Object(n.d)(this.shipData.boarding.morale),musketsAccuracy:Object(n.k)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:Object(n.d)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:Object(n.d)(this.shipData.boarding.prepPerRound),prepInitial:Object(n.d)(this.shipData.boarding.prepInitial),acceleration:Object(n.b)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${Object(n.d)(this.shipData.stern.armour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:""+Object(n.d)(this.shipData.repairTime.bow),cannonBroadside:Object(n.d)(this.shipData.guns.broadside.cannons),cannonsPerDeck:s,carroBroadside:Object(n.d)(this.shipData.guns.broadside.carronades),deceleration:Object(n.b)(this.shipData.ship.deceleration),decks:Object(m.p)(this.shipData.guns.decks,"deck"),fireResistance:Object(n.g)(this.shipData.resistance.fire,0),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${Object(n.d)(this.shipData.bow.armour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:Object(n.b)(this.shipData.rudder.halfturnTime,4),holdSize:Object(n.d)(this.shipData.holdSize),hullRepairAmount:""+Object(n.d)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk)),hullRepairsNeeded:`${Object(n.d)(a)} <span class="badge badge-white">${Object(n.d)(a*f.l)}</span>`,leakResistance:Object(n.g)(this.shipData.resistance.leaks,0),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(n.d)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${Object(n.d)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${Object(n.d)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.mast.topThickness)}</span>`,maxCrew:Object(n.d)(this.shipData.crew.max),maxSpeed:Object(n.b)(this.shipData.speed.max,4),maxTurningSpeed:Object(n.b)(this.shipData.rudder.turnSpeed,4),maxWeight:Object(n.d)(this.shipData.maxWeight),minCrew:Object(n.d)(this.shipData.crew.min),cannonCrew:Object(n.d)(this.shipData.crew.cannons),carroCrew:Object(n.d)(this.shipData.crew.carronades),pump:Object(n.d)(this.shipData.pump.armour),repairTime:""+Object(n.d)(this.shipData.repairTime.sides),rigRepairAmount:""+Object(n.d)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk)),rigRepairsNeeded:`${Object(n.d)(i)} <span class="badge badge-white">${Object(n.d)(i*f.l)}</span>`,rollAngle:Object(n.d)(this.shipData.ship.rollAngle),rudder:`${Object(n.d)(this.shipData.rudder.armour)} <span class="badge badge-white">${Object(n.d)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${Object(n.d)(r)} <span class="badge badge-white">${Object(n.d)(r*f.l)}</span>`,sailingCrew:Object(n.d)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:Object(n.d)(this.shipData.sails.armour),shipRating:Object(d.q)(this.shipData.class)+" rate",sideArmor:`${Object(n.d)(this.shipData.sides.armour)}</br><span class="badge badge-white">${Object(n.d)(this.shipData.sides.thickness)}</span>`,splinterResistance:Object(n.g)(this.shipData.resistance.splinter,0),sternRepair:""+Object(n.d)(this.shipData.repairTime.stern),structure:Object(n.d)(this.shipData.structure.armour),turnAcceleration:Object(n.b)(this.shipData.ship.turnAcceleration,4),upgradeXP:Object(n.d)(this.shipData.upgradeXP),waterlineHeight:Object(n.b)(this.shipData.ship.waterlineHeight),cannonWeight:Object(n.d)(this.shipData.guns.weight.cannons),carroWeight:Object(n.d)(this.shipData.guns.weight.carronades)};o.repairWeight=Object(n.d)((a+i+.1*r)*f.l),o.gunsFront?o.gunsFront+=" "+g.a.pd(o.limitFront):o.gunsFront="–",o.gunsBack?o.gunsBack+=" "+g.a.pd(o.limitBack):o.gunsBack="–",t(""+this.select).find("div").append(g.a.getText(o))}}}).call(this,s("xeH2"))},ck04:function(t,e,s){(function(t){s.d(e,"a",(function(){return g}));s("WUlJ"),s("fCtr"),s("dbdZ");var a=s("mrVq"),i=s("gj+k"),r=s("AKWm"),o=s("pOjD"),n=s("Q4du"),d=s("Qs7V"),c=s("pxNS"),l=s("Bx8B");function h(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function u(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class m{constructor(t,e){u(this,"select",void 0),u(this,"_woodCompare",void 0),u(this,"_id",void 0),u(this,"_g",void 0),this._id=t,this._woodCompare=e,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=Object(r.a)(this.select).select("g")}_setupMainDiv(){Object(r.a)(this.select+" div").remove(),Object(r.a)(this.select).append("div")}}class b extends m{constructor(t,e,s){super(t,s),u(this,"_woodData",void 0),this._woodData=e,this._printText()}_getProperty(t,e){const s=this._woodData[e].properties.find(e=>e.modifier===t);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getPropertySum(t){const e=this._getProperty(t,"frame"),s=this._getProperty(t,"trim");return{amount:e.amount+s.amount,isPercentage:s.isPercentage}}_getText(t){let e='<table class="table table-sm table-striped small mt-4"><thead>';e+="<tr>",e+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,n]of t.properties){if(e+=`<tr><td>${o}</td><td>${n.isPercentage?Object(d.g)(n.amount/100):Object(d.b)(n.amount)}`,e+='<span class="rate">',n.amount>0){var s,a;e+='<span class="bar neutral" style="width:50%;"></span>',e+=`<span class="bar pos diff" style="width:${n.amount/(null!==(s=null===(a=this._woodCompare.minMaxProperty.get(o))||void 0===a?void 0:a.max)&&void 0!==s?s:1)*50}%;"></span>`}else if(n.amount<0){var i,r;const t=n.amount/(null!==(i=null===(r=this._woodCompare.minMaxProperty.get(o))||void 0===r?void 0:r.min)&&void 0!==i?i:1)*50;e+=`<span class="bar neutral" style="width:${50-t}%;"></span>`,e+=`<span class="bar neg diff" style="width:${t}%;"></span>`}else e+='<span class="bar neutral"></span>';e+="</span></td></tr>"}return e+="</tbody></table>",e}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const s=this._getPropertySum(t);e.properties.set(t,{amount:s.amount,isPercentage:s.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class _ extends m{constructor(t,e,s,a){super(t,a),u(this,"_baseData",void 0),u(this,"_compareData",void 0),this._baseData=e,this._compareData=s,this._printTextComparison()}static _getDiff(t,e,s,a=1){const i=Number.parseFloat((t-e).toFixed(a));return`${s?Object(d.g)(t/100,a):Object(d.b)(t)} <span class="badge badge-white">${Object(d.j)(i)}</span>`}_getBaseProperty(t,e){const s=this._baseData[e].properties.find(e=>e.modifier===t);let a=0,i=!1;return(null==s?void 0:s.amount)&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getBasePropertySum(t){const e=this._getBaseProperty(t,"frame"),s=this._getBaseProperty(t,"trim");return{amount:e.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(t,e){const s=this._compareData[e].properties.find(e=>e.modifier===t);let a=0,i=!1;return(null==s?void 0:s.amount)&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(t){const e=this._getCompareProperty(t,"frame"),s=this._getCompareProperty(t,"trim");return{amount:e.amount+s.amount,isPercentage:e.isPercentage&&s.isPercentage}}_getText(t){let e=0,s=0,a=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';r+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[g,f]of t.properties){var o,n,d,c;if(r+=`<tr><td>${g}</td><td>${_._getDiff(f.compare,f.base,f.isPercentage)}`,r+='<span class="rate">',f.compare>=0)f.base>=0?f.compare>f.base?(e=f.base,s=f.compare-f.base,i="pos"):(e=f.compare,s=f.base-f.compare,i="neg"):(e=0,s=f.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+=`<span class="bar pos diff" style="width:${e/(null!==(o=null===(n=this._woodCompare.minMaxProperty.get(g))||void 0===n?void 0:n.max)&&void 0!==o?o:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${s/(null!==(d=null===(c=this._woodCompare.minMaxProperty.get(g))||void 0===c?void 0:c.max)&&void 0!==d?d:1)*50}%;"></span>`;else if(f.compare<0){var l,h,p,u,m,b;f.base<0?f.compare>=f.base?(e=f.compare,s=f.base-f.compare,a=-f.base,i="pos"):(e=f.base,s=f.compare-f.base,a=-f.compare,i="neg"):(e=0,s=f.compare,a=-f.compare,i="neg"),r+=`<span class="bar neutral" style="width:${50+a/(null!==(l=null===(h=this._woodCompare.minMaxProperty.get(g))||void 0===h?void 0:h.min)&&void 0!==l?l:1)*50}%;"></span>`,r+=`<span class="bar ${i}" style="width:${s/(null!==(p=null===(u=this._woodCompare.minMaxProperty.get(g))||void 0===u?void 0:u.min)&&void 0!==p?p:1)*50}%;"></span>`,r+=`<span class="bar neg diff" style="width:${e/(null!==(m=null===(b=this._woodCompare.minMaxProperty.get(g))||void 0===b?void 0:b.min)&&void 0!==m?m:1)*50}%;"></span>`}else r+='<span class="bar neutral"></span>';r+="</span></td></tr>"}return r+="</tbody></table>",r}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const s=this._getBasePropertySum(t),a=this._getComparePropertySum(t);e.properties.set(t,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}t(""+this.select).find("div").append(this._getText(e))}}class g{constructor(t){u(this,"baseFunction",void 0),u(this,"instances",{}),u(this,"minMaxProperty",new Map),u(this,"propertyNames",void 0),u(this,"_baseName",void 0),u(this,"_baseId",void 0),u(this,"_buttonId",void 0),u(this,"_modalId",void 0),u(this,"_woodData",void 0),u(this,"_columnsCompare",void 0),u(this,"_defaultWoodId",{}),u(this,"_columns",void 0),u(this,"_frameSelectData",void 0),u(this,"_trimSelectData",void 0),u(this,"_options",{}),u(this,"_woodIdsSelected",{}),this.baseFunction=t,this._baseName="Compare woods",this._baseId=this.baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(t,e){var s,a;return null!==(s=null===(a=this._woodData[t].find(t=>t.id===e))||void 0===a?void 0:a.name)&&void 0!==s?s:""}_findWoodId(t,e){var s,a;return null!==(s=null===(a=this._woodData[t].find(t=>t.name===e))||void 0===a?void 0:a.id)&&void 0!==s?s:0}_setupData(){this.propertyNames=new Set([].concat(h(this._woodData.frame.flatMap(t=>t.properties.map(t=>t.modifier))),h(this._woodData.trim.flatMap(t=>t.properties.map(t=>t.modifier)))).sort(l.a)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){try{this._woodData=(await s.e(16).then(s.t.bind(null,"xOpV",3))).default,this._setupData()}catch(t){Object(c.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(o.b)("Tools",this._baseName),this._woodCompareSelected()})}_woodCompareSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort(Object(l.b)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(l.b)(["name"])),this._setOption(this._frameSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString(),this._trimSelectData.map(t=>`<option value="${t.id}">${t.name}</option>`).toString());for(const o of this.propertyNames){var t,e,s,r;const n=h(this._woodData.frame.map(t=>{var e,s;return null!==(e=null===(s=t.properties.find(t=>t.modifier===o))||void 0===s?void 0:s.amount)&&void 0!==e?e:0})),d=h(this._woodData.trim.map(t=>{var e,s;return null!==(e=null===(s=t.properties.find(t=>t.modifier===o))||void 0===s?void 0:s.amount)&&void 0!==e?e:0})),c=null!==(t=Object(a.a)(n))&&void 0!==t?t:0,l=null!==(e=Object(i.a)(n))&&void 0!==e?e:0,p=null!==(s=Object(a.a)(d))&&void 0!==s?s:0,u=null!==(r=Object(i.a)(d))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:c+p>=0?0:c+p,max:l+u})}}_injectModal(){Object(n.n)({id:this._modalId,title:this._baseName});const t=Object(r.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const e of this._columns){const s=t.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp"));for(const t of c.g){const a=`${this.baseFunction}-${t}-${e}-select`;s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}s.append("div").attr("id",`${this.baseFunction}-${e}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const s of c.g){const a=t(`#${this.baseFunction}-${s}-${e}-select`);this._setupWoodSelects(e,s,a),this._setupSelectListener(e,s,a)}}_setWoodsSelected(t,e,s){this._woodIdsSelected[t]||(this._woodIdsSelected[t]={}),this._woodIdsSelected[t][e]=s}_setupWoodSelects(t,e,s){this._setWoodsSelected(t,e,this._defaultWoodId[e]),s.append(this._options[e]),("wood"!==this.baseFunction||"Base"!==t&&"wood"===this.baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(e,s){const a="frame"===s?"trim":"frame";this._woodIdsSelected[e][a]===this._defaultWoodId[a]&&t(`#${this.baseFunction}-${a}-${e}-select`).val(this._defaultWoodId[a]).selectpicker("refresh")}enableSelects(e){for(const s of c.g)t(`#${this.baseFunction}-${s}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(t,e,s){const a=Number(s.val());if(this._setWoodsSelected(t,e,a),this._setOtherSelect(t,e),"Base"===t){this._addInstance(t,new b("Base",this._getWoodData("Base"),this));for(const t of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(t),this.instances[t]&&this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}else this._addInstance(t,new _(t,this._getWoodData("Base"),this._getWoodData(t),this))}_setupSelectListener(t,e,s){s.on("change",()=>this._woodSelected(t,e,s)).selectpicker({title:"Select "+e})}_getWoodData(t){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[t].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[t].trim)}}_addMinMaxProperty(t,e){this.minMaxProperty.set(t,e)}_setOption(t,e){this._options.frame=t,this._options.trim=e}_addInstance(t,e){this.instances[t]=e}getWoodTypeData(t,e){var s;return null!==(s=this._woodData[t].find(t=>t.id===e))&&void 0!==s?s:{}}}}).call(this,s("xeH2"))},dNoP:function(t,e,s){(function(t){s.d(e,"e",(function(){return o})),s.d(e,"f",(function(){return n})),s.d(e,"j",(function(){return d})),s.d(e,"m",(function(){return c})),s.d(e,"a",(function(){return l})),s.d(e,"k",(function(){return h})),s.d(e,"l",(function(){return p})),s.d(e,"d",(function(){return u})),s.d(e,"c",(function(){return m})),s.d(e,"b",(function(){return b})),s.d(e,"g",(function(){return _})),s.d(e,"i",(function(){return g})),s.d(e,"h",(function(){return f}));var a=s("sCaM"),i=s("Q4du"),r=s("otg8");const o=(t,e=!1)=>{let s;return s=Number.isNaN(Number(t))?t:Object(r.m)(Number(t)),`<${e?"tspan":"span"} class="caps">${s}</${e?"tspan":"span"}>`},n=(t,e=!1)=>{let s,a;return Number.isNaN(Number(t))?(s=t,a=Object(r.c)(s)%r.j):(a=Number(t),s=Object(r.m)(a)),`<${e?"tspan":"span"} class="caps">${s}</${e?"tspan":"span"}> (${a}°)`},d=e=>{const s=Object(r.m)(t("#"+e).roundSlider("getValue"));let a;return a=Number.isNaN(Number(s))?Object(r.c)(s):Number(s),a},c=(t,e)=>{let s=Math.atan2(e.y-t.y,e.x-t.x);s-=Math.PI/2;let a=Object(r.s)(s);return a<0&&(a+=r.j),a},l=(t,e,s=!0)=>{if(e<2)return[t];const a=t.length,i=[];let r,o=0;if(a%e==0)for(r=Math.floor(a/e);o<a;)i.push(t.slice(o,o+=r));else if(s)for(;o<a;)r=Math.ceil((a-o)/e--),i.push(t.slice(o,o+=r));else{for(e-=1,r=Math.floor(a/e),a%r==0&&(r-=1);o<r*e;)i.push(t.slice(o,o+=r));i.push(t.slice(r*e))}return i},h=({element:t,radius:e})=>{const s=i.o,o=r.j/s,n=Math.round(.8*e),d=new Array(s).fill(void 0).map((t,e)=>Object(r.m)(e*o)),c=Object(a.a)().range([0-o/2,r.j-o/2]).domain(d).align(0);t.append("circle").attr("r",n).style("stroke-width","3px");const l=t.append("text"),h=t.selectAll("g").data(d).join(t=>t.append("g").attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2-r.l)})translate(${n},0)`}));h.filter((t,e)=>e%3!=0).append("line").attr("x2",9),h.filter((t,e)=>e%3==0).append("text").attr("transform",t=>{var e,s,a,i,r;let o,n=Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2);l.text(t);const d=null!==(s=null===(a=l.node())||void 0===a?void 0:a.getBBox().height)&&void 0!==s?s:0,h=null!==(i=null===(r=l.node())||void 0===r?void 0:r.getBBox().width)&&void 0!==i?i:0;return n>=0&&n<=45||315===n?(n=90,o="0,-"+d/2):90===n?(n=0,o=h/2+3+",0"):270===n?(n=180,o=`-${h/2+3},0`):(n=-90,o="0,"+(d/2+3+2)),`rotate(${n})translate(${o})`}).text(t=>t),l.remove()},p=({element:t,radius:e})=>{const s=i.o,o=r.j/s,n=Math.round(.8*e),d=new Array(s).fill(void 0).map((t,e)=>Object(r.m)(e*o)),c=Object(a.a)().range([0-o/2,r.j-o/2]).domain(d).align(0);t.append("circle").attr("r",n).style("stroke-width","1.5px");t.selectAll("line").data(d).join(t=>t.append("line").attr("x2",(t,e)=>e%3==0?e%6==0?6:4:2).attr("transform",t=>{var e;return`rotate(${Math.round((null!==(e=c(t))&&void 0!==e?e:0)+c.bandwidth()/2)})translate(${n},0)`}))},u=t=>`<span class="caps">${t}</span>`,m=(t,e)=>{navigator.clipboard||((t,e)=>{var s,a;if(!(null===(s=(a=document).queryCommandSupported)||void 0===s?void 0:s.call(a,"copy")))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const s=document.createElement("input");s.type="text",s.value=t,s.style.position="absolute",s.style.left="-1000px",s.style.top="-1000px",e.append(s),s.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{s.remove()}}})(t,e),(async t=>{navigator.clipboard.writeText(t).then(()=>!0).catch(e=>(console.error(`Cannot copy ${t} to clipboard`,e),!1))})(t)},b=(t,e,s)=>{if(Number.isFinite(t)&&Number.isFinite(e)){const a=new URL(window.location.href);a.searchParams.set("x",String(t)),a.searchParams.set("z",String(e)),m(a.href,s)}},_=(t,e,s)=>`M${t},${e} m${-s},0 a${s},${s} 0,1,0 ${2*s},0 a${s},${s} 0,1,0 ${2*-s},0`,g=(t,e,s)=>`M${t-s/2},${e-s/2}h${s}v${s}h${-s}z`,f=(t,e,s)=>`M${t},${e}v${s}`}).call(this,s("xeH2"))},eA68:function(t,e,s){(function(t){s.d(e,"a",(function(){return m}));s("WUlJ"),s("sfzn"),s("fCtr");var a=s("2mXy"),i=s("JQHs"),r=s("XXsb"),o=s.n(r),n=s("pOjD"),d=s("pxNS"),c=s("oggF");function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const u=i.a.bind(a.a);class m{constructor(){p(this,"_cannonData",{}),p(this,"_baseName",void 0),p(this,"_baseId",void 0),p(this,"_buttonId",void 0),p(this,"_modalId",void 0),p(this,"_groups",void 0),this._groups=new Map,this._baseName="List cannons",this._baseId="cannon-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{const t=(await s.e(5).then(s.t.bind(null,"XG8V",3))).default;this._setupData(t)}catch(t){Object(d.e)(t)}}_setupData(t){for(const e of t.long)for(const[t,s]of Object.entries(e))"name"!==t&&this._groups.set(t,{values:s,count:Object.entries(s).length});const e=["name","damage","penetration","dispersion","traverse","generic"];for(const s of d.a)this._cannonData[s]=t[s].map(t=>Object.keys(t).sort((t,s)=>e.indexOf(t)-e.indexOf(s)).reduce((e,s)=>(e[s]=t[s],e),{}));this._groups=new Map(l(this._groups.entries()).sort((t,s)=>e.indexOf(t[0])-e.indexOf(s[0])))}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(n.b)("Tools",this._baseName),this._cannonListSelected()})}_getList(t){return u`
            <table id="table-${this._baseId}-${t}-list" class="table table-sm small tablesort na-table">
                <thead>
                    <tr class="thead-group">
                        <th scope="col" class="border-bottom-0"></th>
                        ${l(this._groups).map(t=>(t=>u`
            <th scope="col" class="text-center" colspan="${t[1].count}">
                ${Object(d.b)(t[0])}
            </th>
        `)(t))}
                    </tr>
                    <tr data-sort-method="thead">
                        <th scope="col" class="text-right border-top-0" data-sort-default>Lb</th>
                        ${l(this._groups).map(t=>(t=>u`
            ${Object.entries(t[1].values).map(t=>u`<th class="text-right">${Object(d.b)(t[0])}</th>`)}
        `)(t))}
                    </tr>
                </thead>
                <tbody>
                    ${this._cannonData[t].map(t=>u`
                            <tr>
                                ${(t=>{let e=t;const s=t.split(" "),a="c"+s[0].padStart(3,"0"),i=s[1]?s[1][1]:"0";return s.length>1&&(e=u`${s[0]} <em>${s[1]}</em>`),u`
                <td class="text-right" data-sort="${a}${i}">
                    ${e}
                </td>
            `})(t.name)}${(t=>u`
            ${Object.entries(t).map(t=>"name"===t[0]?u``:Object.entries(t[1]).map(t=>{var e,s;return u`
                            <td class="text-right" data-sort="${null!==(e=t[1].value)&&void 0!==e?e:0}">
                                ${t[1]?Object(c.b)(t[1].value,null!==(s=t[1].digits)&&void 0!==s?s:0):""}
                            </td>
                        `}))}
        `)(t)}
                            </tr>
                        `)}
                </tbody>
            </table>
        `}_getModalBody(){return u`
            <ul class="nav nav-pills" role="tablist">
                ${d.a.map((t,e)=>u`
                            <li class="nav-item">
                                <a
                                    class="nav-link${0===e?" active":""}"
                                    id="tab-${this._baseId}-${t}"
                                    data-toggle="tab"
                                    href="#tab-content-${this._baseId}-${t}"
                                    role="tab"
                                    aria-controls="home"
                                    aria-selected="true"
                                    >${Object(d.b)(t)}</a
                                >
                            </li>
                        `)}
            </ul>
            <div class="tab-content pt-2">
                ${d.a.map((t,e)=>u`
                            <div
                                class="tab-pane fade${0===e?" show active":""}"
                                id="tab-content-${this._baseId}-${t}"
                                role="tabpanel"
                                aria-labelledby="tab-${this._baseId}-${t}"
                            >
                                <div id="${t}-list">
                                    ${this._getList(t)}
                                </div>
                            </div>
                        `)}
            </div>
        `}_getModalFooter(){return u`
            <button type="button" class="btn btn-secondary" data-dismiss="modal">
                Close
            </button>
        `}_injectModal(){Object(a.b)(Object(c.c)({id:this._modalId,title:this._baseName,body:this._getModalBody.bind(this),footer:this._getModalFooter}),document.querySelector("#modal-section"));for(const t of d.a){const e=document.querySelector(`#table-${this._baseId}-${t}-list`);e&&new o.a(e)}}_initModal(){Object(c.i)(),this._injectModal()}_cannonListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}}}).call(this,s("xeH2"))},hVxF:function(t,e,s){(function(t){s.d(e,"a",(function(){return _}));s("WUlJ"),s("fCtr");var a=s("AKWm"),i=s("2mXy"),r=s("JQHs"),o=s("XXsb"),n=s.n(o),d=s("pOjD"),c=s("pxNS"),l=s("Q4du"),h=s("Qs7V"),p=s("oggF"),u=s("Bx8B");function m(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const b=r.a.bind(i.a);class _{constructor(){m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_shipListData",{}),m(this,"_mainDiv",void 0),this._baseName="List ships",this._baseId="ship-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._setupListener()}async _loadAndSetupData(){try{const t=(await s.e(15).then(s.t.bind(null,"pcjM",3))).default.sort(Object(u.b)(["class","-battleRating","name"]));this._shipListData=t.map(t=>({class:[t.class,t.class],name:[t.name,Object(p.a)(t.name)],guns:[t.guns.total,t.guns.total],battleRating:[t.battleRating,Object(h.c)(t.battleRating)],crew:[t.crew.max,Object(h.c)(t.crew.max)],maxSpeed:[t.ship.maxSpeed,Object(p.b)(t.ship.maxSpeed)],turnSpeed:[t.rudder.turnSpeed,Object(p.b)(t.rudder.turnSpeed)],broadside:[t.guns.broadside.cannons,Object(h.c)(t.guns.broadside.cannons)],bowChaser:[t.guns.gunsPerDeck[4].amount,t.guns.gunsPerDeck[4]?String(t.guns.gunsPerDeck[4].amount):""],sternChaser:[t.guns.gunsPerDeck[5].amount,t.guns.gunsPerDeck[5]?String(t.guns.gunsPerDeck[5].amount):""],sides:[t.sides.armour,`${Object(h.c)(t.sides.armour)} (${t.sides.thickness})`]}))}catch(t){Object(c.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(d.b)("Tools",this._baseName),this._shipListSelected()})}_injectModal(){Object(l.n)({id:this._modalId,title:this._baseName,size:"modal-lg"}),this._mainDiv=Object(a.a)(`#${this._modalId} .modal-body`).append("div").attr("id",""+this._baseId)}_initModal(){Object(p.i)(),this._injectModal(),this._injectList()}_shipListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getHead(){return b`
            <thead>
                <tr class="thead-group">
                    <th scope="col" class="border-bottom-0"></th>
                    <th scope="col" class="border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-center" colspan="2">Speed</th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                    <th scope="col" class="text-center" colspan="2">Chasers</th>
                    <th scope="col" class="text-right border-bottom-0"></th>
                </tr>

                <tr data-sort-method="thead">
                    <th scope="col" class="text-right border-top-0">Class</th>
                    <th scope="col" class="border-top-0">Name</th>
                    <th scope="col" class="text-right border-top-0">Guns</th>
                    <th scope="col" class="text-right border-top-0">Battle rating</th>
                    <th scope="col" class="text-right border-top-0">Crew</th>
                    <th scope="col" class="text-right">Maximum</th>
                    <th scope="col" class="text-right">Turn</th>
                    <th scope="col" class="text-right border-top-0">Broadside</th>
                    <th scope="col" class="text-right border-top-0">Bow</th>
                    <th scope="col" class="text-right">Stern</th>
                    <th scope="col" class="text-right border-top-0">Sides</th>
                </tr>
            </thead>
        `}_getBody(){return b`
            <tbody>
                ${this._shipListData.map(t=>b`<tr>
                        ${Object.entries(t).map(t=>b`<td class="${"name"===t[0]?"":"text-right"}" data-sort="${t[1][0]}">
                                    ${t[1][1]}
                                </td>`)}
                    </tr>`)}
            </tbody>
        `}_getList(){return b`
            <table id="table-${this._baseId}" class="table table-sm small tablesort na-table">
                ${this._getHead()} ${this._getBody()}
            </table>
        `}_injectList(){Object(i.b)(this._getList(),this._mainDiv.node());const t=document.querySelector("#table-"+this._baseId);new n.a(t)}}}).call(this,s("xeH2"))},iftE:function(t,e,s){(function(t){s.d(e,"a",(function(){return w}));var a=s("mrVq"),i=s("gj+k"),r=s("AJ/N"),o=s("VIqg"),n=s("AWXE"),d=s("iPFw"),c=s("VkQ2"),l=s("TI0E"),h=s("Qs7V"),p=s("otg8"),u=s("dNoP"),m=s("1mfJ"),b=s.n(m),_=s("Z5fe"),g=s("Q4du"),f=s("oggF");function v(t){return function(t){if(Array.isArray(t))return S(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return S(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return S(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function D(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class w extends _.a{constructor(t,e,s,a){super(t,a),D(this,"shipCompareData",void 0),D(this,"_shipBaseData",void 0),D(this,"_speedScale",void 0),D(this,"_speedDiff",void 0),D(this,"_minSpeedDiff",void 0),D(this,"_maxSpeedDiff",void 0),D(this,"_shipRotate",void 0),D(this,"_speedText",void 0),D(this,"_drag",void 0),D(this,"_windProfile",void 0),D(this,"_gWindProfile",void 0),D(this,"_arcsComp",void 0),this._shipBaseData=e,this.shipCompareData=s,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(t,e){const s=Math.min(t,this._shipCompare.colourScaleSpeedDiff.domain()[0]),a=Math.max(e,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([s,0,a])}_getHeadingInDegrees(t,e){let s=t-e-180;return s<0&&(s+=360),s}_getSpeed(t){return Object(h.b)(this._speedScale(Math.abs(t)))}_getHeadingInCompass(t){return Object(p.m)(t)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const t=this.shipCompareData.speedDegrees.length,e=360/t,s=new Array(t+1).fill(0).map((t,s)=>s*e);this._speedScale=Object(o.a)().domain(s).range([].concat(v(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);this._drag=r.a().on("start",t=>{t.this.classed("drag-active",!0)}).on("drag",t=>{const{x:e,y:s}=n.c;t.rotate=this._getHeadingInDegrees(Object(u.m)({x:t.initX,y:t.initY},{x:e,y:s}),t.correctionValueDegrees),(()=>{t.this.attr("transform",t=>`rotate(${t.rotate})`),t.compassText.attr("transform",t=>`rotate(${-t.rotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.rotate)),this._shipRotate=t.rotate,this._updateSpeedText()})()}).on("end",t=>{t.this.classed("drag-active",!1)}).container(()=>this._mainG.node())}_setupShipOutline(){this._shipRotate=0;const{shipMass:t}=this.shipCompareData,e=this._shipCompare.shipMassScale(t),s=e,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",t=>t.initX).attr("y1",a-20).attr("x2",t=>t.initX).attr("y2",t=>t.initY),r.append("image").attr("height",e).attr("width",s).attr("x",-e/2).attr("y",-s/2).attr("xlink:href",b.a),r.append("circle").attr("cx",t=>t.compassTextX).attr("cy",t=>t.compassTextY).attr("r",20).call(this._drag);const o=r.append("text").attr("x",t=>t.compassTextX).attr("y",t=>t.compassTextY).attr("transform",t=>`rotate(${-t.initRotate},${t.compassTextX},${t.compassTextY})`).text(t=>this._getHeadingInCompass(t.initRotate));this._speedText=r.append("text").attr("x",t=>t.speedTextX).attr("y",t=>t.speedTextY).attr("transform",t=>`rotate(${-t.initRotate})`).text(t=>this._getSpeed(this._shipCompare.windProfileRotate-t.initRotate)),i.this=r,i.compassText=o,r.datum(i).attr("transform",t=>`rotate(${t.initRotate})`)}_drawDifferenceProfile(){var t,e;const s=Object(d.a)().sort(null).value(1),r=s(this._shipBaseData.speedDegrees);this._arcsComp=s(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map((t,e)=>Object(p.t)(t-this._shipBaseData.speedDegrees[e])),this._minSpeedDiff=null!==(t=Object(a.a)(this._speedDiff))&&void 0!==t?t:0,this._maxSpeedDiff=null!==(e=Object(i.a)(this._speedDiff))&&void 0!==e?e:0;const o=c.a,n=Object(l.a)().angle((t,e)=>e*g.r).radius(t=>this._shipCompare.radiusSpeedScale(t.data)).curve(o),h=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-h,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(r)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join(t=>{t.append("circle").attr("r",5).attr("cy",(t,e)=>Math.cos(e*g.r)*-this._shipCompare.radiusSpeedScale(t.data)).attr("cx",(t,e)=>Math.sin(e*g.r)*this._shipCompare.radiusSpeedScale(t.data)).attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e])).append("title").text((t,e)=>`${Math.round(10*t.data)/10} (${Object(h.j)(this._speedDiff[e],1)}) knots`)}).select("circle").attr("fill",(t,e)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[e]))}_injectTextComparison(){function e(t,e,s=0,a=!1){if(t===e)return"";let i,r,o="badge-danger";return a?(i=100*Number.parseFloat((e-t).toFixed(s)),r=Object(h.b)(Math.abs(i))):0===t||0===e?(i=e-t,r=Object(h.b)(Math.abs(i))):(i=1-t/e,r=Object(h.g)(Math.abs(i),0)),i<0&&(o="badge-success"),`<span class="badge ${o}">${r}</span>`}const s=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.h),a=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.n),i=Math.round(this._shipBaseData.crew.max*f.o),r=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.h),o=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.n),n=Math.round(this.shipCompareData.crew.max*f.o),d={morale:`${Object(h.d)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${Object(h.k)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${Object(h.d)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${Object(h.j)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${Object(h.j)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${Object(h.d)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${Object(h.d)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${Object(h.d)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${Object(h.k)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,acceleration:`${Object(h.b)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${Object(h.d)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:_.a.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${Object(h.b)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${Object(h.d)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${Object(h.b)(this.shipCompareData.ship.turnAcceleration)} ${e(this._shipBaseData.ship.turnAcceleration,this.shipCompareData.ship.turnAcceleration,2)}`,decks:Object(g.p)(this.shipCompareData.guns.decks,"deck"),fireResistance:`${Object(h.g)(this.shipCompareData.resistance.fire,0)} ${e(this.shipCompareData.resistance.fire,this._shipBaseData.resistance.fire,2,!0)}`,firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${Object(h.d)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${Object(h.b)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${Object(h.d)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${Object(h.d)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${Object(h.d)(r)} <span class="badge badge-white">${Object(h.d)(r*f.l)}</span>`,leakResistance:`${Object(h.g)(this.shipCompareData.resistance.leaks,0)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${Object(h.d)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${Object(h.d)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${Object(h.d)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${Object(h.d)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${Object(h.b)(this.shipCompareData.speed.max,4)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxTurningSpeed:`${Object(h.b)(this.shipCompareData.rudder.turnSpeed,4)} ${e(this.shipCompareData.rudder.turnSpeed,this._shipBaseData.rudder.turnSpeed,2)}`,maxWeight:`${Object(h.d)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:Object(h.d)(this.shipCompareData.crew.min),cannonCrew:`${Object(h.d)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${Object(h.d)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${Object(h.b)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${Object(h.d)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${Object(h.d)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${Object(h.d)(o)} <span class="badge badge-white">${Object(h.d)(o*f.l)}</span>`,rumRepairsNeeded:`${Object(h.d)(n)} <span class="badge badge-white">${Object(h.d)(n*f.l)}</span>`,sailingCrew:""+Object(h.d)(this.shipCompareData.crew.sailing),sails:`${Object(h.d)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:Object(p.q)(this.shipCompareData.class)+" rate",sideArmor:`${Object(h.d)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${Object(h.d)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${Object(h.g)(this.shipCompareData.resistance.splinter,0)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${Object(h.d)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${Object(h.d)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${Object(h.b)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${Object(h.d)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${Object(h.d)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${Object(h.d)((r+o+.1*n)*f.l)} ${e((s+a+.1*i)*f.l,(r+o+.1*n)*f.l)}`,d.gunsFront?d.gunsFront+=" "+_.a.pd(d.limitFront):d.gunsFront="–",d.gunsBack?d.gunsBack+=" "+_.a.pd(d.limitBack):d.gunsBack="–",t(""+this.select).find("div").append(_.a.getText(d))}}}).call(this,s("xeH2"))},oggF:function(t,e,s){s.d(e,"g",(function(){return u})),s.d(e,"h",(function(){return m})),s.d(e,"k",(function(){return b})),s.d(e,"m",(function(){return _})),s.d(e,"n",(function(){return g})),s.d(e,"o",(function(){return S})),s.d(e,"l",(function(){return D})),s.d(e,"f",(function(){return w})),s.d(e,"j",(function(){return y})),s.d(e,"p",(function(){return $})),s.d(e,"a",(function(){return j})),s.d(e,"b",(function(){return O})),s.d(e,"c",(function(){return C})),s.d(e,"i",(function(){return I})),s.d(e,"e",(function(){return A})),s.d(e,"d",(function(){return k}));s("UxlC");var a=s("FmoU"),i=s("GjCO"),r=s.n(i),o=s("JQHs"),n=s("2mXy"),d=s("XXsb"),c=s.n(d),l=s("Q4du"),h=s("Qs7V");const p=o.a.bind(n.a),u=Number(.2),m=Number(300),b=Number(90),_=Number(.25),g=Number(300),f=Number(.25),v=Number(1),S=Number(f)/Number(v),D=5,w=new r.a("My salt: Yet another Naval Action map"),y=t=>t.includes(" (i)"),$=t=>t.replace(" (i)",""),j=t=>p`${$(t)} ${y(t)?p`<span class="caps small">imported</span>`:p``}`,O=(t,e=2)=>{const[s,a]=h.e.format(`.${e}f`)(t).split(".");let i=p`${a}`;return a&&(i="0"===a||"00"===a?p`<span class="hidden">.${a}</span>`:a.endsWith("0")?p`.${a.replace("0","")}<span class="hidden">0</span>`:p`.${a}`),p`${s}${i}`},C=({id:t,title:e,size:s="modal-xl",body:a,footer:i})=>p`
        <div id="${t}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${t}" aria-hidden="true">
            <div class="modal-dialog ${s}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${t}" class="modal-title">
                            ${e}
                        </h5>
                    </div>
                    <div class="modal-body">${a()}</div>
                    <div class="modal-footer">
                        ${i()}
                    </div>
                </div>
            </div>
        </div>
    `,x=t=>t.replace(/[^\d-.?]/g,""),I=()=>{c.a.extend("number",t=>{var e,s;return null!==(e=null!==(s=/^[+-]?[$¢£´Û€]?\d+\s*([,.]\d{0,2})/.exec(t))&&void 0!==s?s:/^[+-]?\d+\s*([,.]\d{0,2})?[$¢£´Û€]/.exec(t))&&void 0!==e?e:/^[+-]?(\d)*-?([,.])?-?(\d)+([,Ee][+-]\d+)?%?$/.exec(t)},(t,e)=>{const s=x(t);return((t,e)=>{let s=Number.parseFloat(t),a=Number.parseFloat(e);return s=Number.isNaN(s)?0:s,a=Number.isNaN(a)?0:a,s-a})(x(e),s)})},A=t=>`${t} real${Number(t)>1?"s":""}`,k=t=>{var e,s;const{r:i,g:r,b:o}=Object(a.d)(t);return(299*i+587*r+114*o)/1e3>=128?null!==(e=null===(s=Object(a.c)(l.j))||void 0===s?void 0:s.darker(5).toString())&&void 0!==e?e:"#111":l.j}},q1Yc:function(t,e,s){(function(t){s.d(e,"a",(function(){return h}));s("WUlJ"),s("fCtr");var a=s("AKWm"),i=(s("dbdZ"),s("pOjD")),r=s("Q4du"),o=s("pxNS"),n=s("Qs7V"),d=s("oggF"),c=s("Bx8B");function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}class h{constructor(){l(this,"_baseName",void 0),l(this,"_baseId",void 0),l(this,"_buttonId",void 0),l(this,"_modalId",void 0),l(this,"_buildingData",void 0),this._baseName="List buildings",this._baseId="building-list",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._buildingData=[],this._setupListener()}async _loadAndSetupData(){try{this._buildingData=(await s.e(4).then(s.t.bind(null,"7IKn",3))).default}catch(t){Object(o.e)(t)}}_setupListener(){let t=!0;document.querySelector("#"+this._buttonId).addEventListener("click",async()=>{t&&(t=!1,await this._loadAndSetupData()),Object(i.b)("Tools",this._baseName),this._buildingListSelected()})}_injectModal(){Object(r.n)({id:this._modalId,title:this._baseName});const t=this._baseId+"-select",e=Object(a.a)(`#${this._modalId} .modal-body`);e.append("label").attr("for",t),e.append("select").attr("name",t).attr("id",t),e.append("div").attr("id",""+this._baseId).attr("class","container-fluid")}_getOptions(){return""+this._buildingData.sort(Object(c.b)(["name"])).map(t=>`<option value="${t.name}">${t.name}</option>;`).join("")}_setupSelect(){const e=t(`#${this._baseId}-select`),s=this._getOptions();e.append(s)}_setupSelectListener(){const e=t(`#${this._baseId}-select`);e.addClass("selectpicker").on("change",t=>this._buildingSelected(t)).selectpicker({noneSelectedText:"Select building"}),e.val("default").selectpicker("refresh")}_initModal(){this._injectModal(),this._setupSelect(),this._setupSelectListener()}_buildingListSelected(){document.querySelector("#"+this._modalId)||this._initModal(),t("#"+this._modalId).modal("show")}_getBuildingData(t){return this._buildingData.filter(e=>e.name===t)[0]}_getProductText(t){let e="";return t.result&&(t.result.length>1?(e+='<table class="table table-sm"><tbody>',e+=`<tr><td>${t.result.map(t=>t.name).join("</td></tr><tr><td>")}</td></tr>`,e+="</tbody></table>"):(e+=`<h5 class="card-title">${t.result[0].name}</h5>`,t.result[0].price&&(e+='<table class="table table-sm card-table"><tbody>',e+=`<tr><td>${Object(d.e)(t.result[0].price)} per unit</td></tr>`,t.batch&&(e+=`<tr><td>${t.batch.labour} labour hour${t.batch.labour>1?"s":""} per unit</td></tr>`),e+="</tbody></table>"))),e}_getRequirementText(t){let e="";if(e+='<table class="table table-sm card-table"><thead>',t.levels[0].materials.length>0){e+="<tr><th>Level</th><th>Level build materials</th><th>Build price (reals)</th></tr>",e+="</thead><tbody>";for(const s of t.levels){e+=`<tr><td>${t.levels.indexOf(s)+1}</td><td class="text-left">`,e+=s.materials.map(t=>`${Object(n.c)(t.amount)} ${t.item}`).join("<br>"),e+="</td>",e+=`<td>${Object(n.c)(s.price)}</td>`,e+="</tr>"}}else{e+="<tr><th>Level</th><th>Production</th><th>Labour cost (%)</th><th>Storage</th><th>Build price (reals)</th></tr>",e+="</thead><tbody>";for(const s of t.levels){e+=`<tr><td>${t.levels.indexOf(s)+1}</td><td>${Object(n.c)(s.production)}</td><td>${Object(n.c)(-100*s.labourDiscount)}</td><td>${Object(n.c)(s.maxStorage)}</td><td>${Object(n.c)(s.price)}</td></tr>`}}return e+="</tbody></table>",e}_getText(t){const e=this._getBuildingData(t);let s='<div class="row no-gutters card-deck">';return s+='<div class="card col-5"><div class="card-header">Product</div>',s+='<div class="card-body product">',s+=this._getProductText(e),s+="</div></div>",s+='<div class="card col-7"><div class="card-header">Requirements</div>',s+='<div class="card-body px-0 requirements">',s+=this._getRequirementText(e),s+="</div></div>",s+="</div>",s}_buildingSelected(e){const s=String(t(e.currentTarget).find(":selected").val());Object(a.a)(`#${this._baseId} div`).remove(),Object(a.a)("#"+this._baseId).append("div").classed("buildings mt-4",!0),Object(a.a)(`#${this._baseId} div`).html(this._getText(s))}}}).call(this,s("xeH2"))},qE0g:function(t,e,s){(function(t){s.d(e,"a",(function(){return A}));s("UxlC"),s("WUlJ"),s("fCtr");var a=s("mrVq"),i=s("gj+k"),r=s("APuy"),o=s("bwSX"),n=s("Ws9M"),d=s("VIqg"),c=s("AKWm"),l=s("Wgwc"),h=s.n(l),p=s("+QaA"),u=s.n(p),m=s("Ds8A"),b=s.n(m),_=s("pOjD"),g=s("Q4du"),f=s("pxNS"),v=s("Qs7V"),S=s("oggF"),D=s("otg8"),w=s("Bx8B"),y=s("dNoP"),$=s("ck04"),j=s("awzk"),O=s("iftE");function C(t){return function(t){if(Array.isArray(t))return x(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return x(t,e);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return x(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function x(t,e){(null==e||e>t.length)&&(e=t.length);for(var s=0,a=new Array(e);s<e;s++)a[s]=t[s];return a}function I(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}h.a.extend(u.a),h.a.extend(b.a);class A{constructor(t="ship-compare"){I(this,"colorScale",void 0),I(this,"colourScaleSpeedDiff",void 0),I(this,"columnsCompare",void 0),I(this,"innerRadius",void 0),I(this,"outerRadius",void 0),I(this,"radiusSpeedScale",void 0),I(this,"selectedShips",void 0),I(this,"singleShipData",void 0),I(this,"shipMassScale",void 0),I(this,"svgHeight",void 0),I(this,"svgWidth",void 0),I(this,"windProfileRotate",0),I(this,"woodCompare",void 0),k.set(this,{writable:!0,value:void 0}),I(this,"_maxSpeed",void 0),I(this,"_minSpeed",void 0),I(this,"_modal$",{}),I(this,"_modifierAmount",new Map),I(this,"_moduleAndWoodCaps",void 0),I(this,"_moduleAndWoodChanges",void 0),I(this,"_moduleDataDefault",void 0),I(this,"_moduleProperties",void 0),I(this,"_moduleTypes",void 0),I(this,"_selectedUpgradeIdsList",{}),I(this,"_selectedUpgradeIdsPerType",{}),I(this,"_selectModule$",{}),I(this,"_selectShip$",{}),I(this,"_selectWood$",{}),I(this,"_shipData",void 0),I(this,"_shipIds",{}),I(this,"_shipSelectData",void 0),I(this,"_baseId",void 0),I(this,"_baseName",void 0),I(this,"_buttonId",void 0),I(this,"_columns",void 0),I(this,"_copyButtonId",void 0),I(this,"_imageButtonId",void 0),I(this,"_modalId",void 0),I(this,"_moduleId",void 0),I(this,"_woodId",void 0),this._baseId=t,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._imageButtonId="button-image-"+this._baseId,this.colourScaleSpeedDiff=Object(d.a)().range([g.i,g.j,g.f]).interpolate(n.a),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(t){return t<=3?"L":t<=5?"M":"S"}static _adjustAbsolute(t,e){return t?t+e:e}static _adjustPercentage(t,e,s){return s?t?t*(1+e):e:t?t+e:e}static _getModifierFromModule(t){return`<p class="mb-0">${t.map(t=>{let e;return e=t.isPercentage?Object(v.l)(t.amount/100):t.amount<1&&t.amount>0?Object(v.f)(t.amount):Object(v.j)(t.amount,2),`${t.modifier} ${e}`}).join("<br>")}</p>`}static _setSelect(t,e){let s;s=Array.isArray(e)?e.map(t=>String(t)):String(e),s&&t.val(s),t.selectpicker("render")}static _saveCanvasAsImage(t){const e=`na-map ship compare ${h.a.utc().format("YYYY-MM-DD HH-mm-ss")}.png`,s=document.createElement("a");s.href=t,s.download=e,document.body.append(s),s.click(),s.remove()}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(t){var e;await this._loadAndSetupData();const s=S.f.decode(null!==(e=t.get("cmp"))&&void 0!==e?e:"");s.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(s),this._setModuleSelects(t))}_setupArrow(){const t=document.querySelector("#journey-arrow").cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");document.querySelector("#na-map svg defs").append(t)}_setupData(){var t,e,s;this._moduleAndWoodChanges=new Map([["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Fire resistance",{properties:["resistance.fire"],isBaseValueAbsolute:!1}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Rudder turn rate",{properties:["rudder.turnSpeed"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),function(t,e,s){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,s);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=s}}(this,k,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:.5,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:17,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const r=1.2*(null!==(t=Object(a.a)(this._shipData,t=>t.speed.min))&&void 0!==t?t:0),o=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=r,this._maxSpeed=o,this.colorScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([g.i,g.j,g.f]).interpolate(n.a);const c=null!==(e=Object(a.a)(this._shipData,t=>t.shipMass))&&void 0!==e?e:0,l=null!==(s=Object(i.a)(this._shipData,t=>t.shipMass))&&void 0!==s?s:0;this.shipMassScale=Object(d.a)().domain([c,l]).range([100,150])}async _loadAndSetupData(){try{this._moduleDataDefault=(await s.e(8).then(s.t.bind(null,"jhXC",3))).default,this._shipData=(await s.e(15).then(s.t.bind(null,"pcjM",3))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new $.a(this._woodId),await this.woodCompare.woodInit())}catch(t){Object(f.e)(t)}}_setupListener(){var t;let e=!0;null===(t=document.querySelector("#"+this._buttonId))||void 0===t||t.addEventListener("click",async()=>{e&&(e=!1,await this._loadAndSetupData()),Object(_.b)("Tools",this._baseName),this._shipCompareSelected()})}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=t(`#${this._modalId} .column-base`).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=Object(d.a)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(t){var e,s;return null!==(e=null===(s=this._shipData.find(e=>e.id===t))||void 0===s?void 0:s.name)&&void 0!==e?e:""}_getSelectedData(t){const e={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[t]){e.ship=this._getShipName(this._shipIds[t]);for(const s of f.g)e.wood.push(this.woodCompare.getWoodName(s,Number(this._selectWood$[t][s].val())));if(this._selectedUpgradeIdsPerType[t])for(const i of C(this._moduleTypes)){const r=[];for(const e of this._selectedUpgradeIdsPerType[t][i]){var s,a;r.push(null!==(s=null===(a=this._moduleProperties.get(e))||void 0===a?void 0:a.name.replace(" Bonus",""))&&void 0!==s?s:"")}e.moduleData.set(i,r.join(", "))}}return e}_printSelectedData(t,e,s){const a=t.querySelectorAll(`#${this._baseId}-${s.toLowerCase()} label`),i=a[0].parentNode,r=a[0].offsetHeight;for(const t of a)t.remove();const o=Object(c.a)(i).insert("div",":first-child").style("height",5*r+"px");e.ship&&o.append("div").style("margin-bottom","5px").style("line-height","1.1").text(e.ship),""!==e.wood[0]&&o.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(e.wood.join(" | "));for(const[t,s]of e.moduleData)""!==s&&o.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${t}</em>: ${s}`)}_replaceSelectsWithText(t){for(const e of this._columns){const s=this._getSelectedData(e);this._printSelectedData(t,s,e)}}async _makeImage(t){Object(_.b)("Menu","Ship compare image"),t.preventDefault();const e=await s.e(23).then(s.t.bind(null,"wOnQ",7)),a=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(a){const t=await e.default(a,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:t=>t.classList.contains("central")||t.classList.contains("overlay")||t.classList.contains("navbar"),logging:!0,onclone:t=>{this._replaceSelectsWithText(t)},x:0,y:0});A._saveCanvasAsImage(t.toDataURL())}}_shipCompareSelected(){var e,s,a;Object(f.c)(this._modal$)&&(this._initModal(),this._modal$=t("#"+this._modalId),null===(e=document.querySelector("#"+this._modalId))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyDataClicked(t)}),null===(s=document.querySelector("#"+this._copyButtonId))||void 0===s||s.addEventListener("click",t=>{this._copyDataClicked(t)}),null===(a=document.querySelector("#"+this._imageButtonId))||void 0===a||a.addEventListener("click",async t=>{await this._makeImage(t)}));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const t=[];for(const e of this._columns)if(this._shipIds[e]){t.push(this._shipIds[e]);for(const s of f.g)t.push(Number(this._selectWood$[e][s].val()))}return t}_copyDataClicked(t){Object(_.b)("Menu","Copy ship compare"),t.preventDefault();const e=this._getShipAndWoodIds();if(e.length>0){const t=new URL(window.location.href);t.searchParams.set("v",encodeURIComponent(g.d)),t.searchParams.set("cmp",S.f.encode(e));for(const e of this._columns){const s=this._columns.indexOf(e);if(this._selectedUpgradeIdsPerType[e])for(const a of C(this._moduleTypes)){const i=C(this._moduleTypes).indexOf(a),r=this._selectedUpgradeIdsPerType[e][a];if(null==r?void 0:r.length){const e=`${s}${i}`;t.searchParams.set(e,S.f.encode(r))}}}Object(y.c)(t.href,this._modal$)}}_setupShipData(){this._shipSelectData=Object(o.b)().key(t=>String(t.class)).sortKeys(r.a).entries(this._shipData.map(t=>({id:t.id,name:t.name,class:t.class,battleRating:t.battleRating,guns:t.guns.total})).sort(Object(w.b)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap(t=>t[1].filter(t=>t.properties.some(t=>this._moduleAndWoodChanges.has(t.modifier))).map(t=>[t.id,t]))),this._moduleTypes=new Set(C(this._moduleProperties).map(t=>t[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,"")))}_injectModal(){Object(g.n)({id:this._modalId,title:this._baseName});const t=Object(c.a)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const e of this._columns){const s=t.append("div").attr("id",`${this._baseId}-${e.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===e?"column-base":"column-comp")),a=this._getShipSelectId(e);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker");for(const t of f.g){const a=this._getWoodSelectId(t,e);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}for(const t of this._moduleTypes){const a=this._getModuleSelectId(t,e);s.append("label").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}s.append("div").attr("id",`${this._baseId}-${e}`).attr("class",("Base"===e?"ship-base":"ship-compare")+" compress")}const e=Object(c.a)(`#${this._modalId} .modal-footer`);e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),e.insert("button","button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._imageButtonId).attr("title","Make image").attr("type","button").append("i").classed("icon icon-image",!0)}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const s of f.g)this._selectWood$[e][s]=t("#"+this._getWoodSelectId(s,e)),this.woodCompare._setupWoodSelects(e,s,this._selectWood$[e][s])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this._shipSelectData.map(t=>`<optgroup label="${Object(D.q)(Number(t.key),!1)} rate">${t.values.map(t=>`<option data-subtext="${t.battleRating} ${Object(S.j)(t.name)?"Imported":""}" value="${t.id}">${Object(S.p)(t.name)} (${t.guns})`).join("</option>")}`).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=t("#"+this._getShipSelectId(e));const s=this._getShipOptions();this._selectShip$[e].append(s),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(t,e){const s=Object(o.b)().key(t=>t[1].type.replace(/[\sA-Za-z]+\s–\s/,"")).sortKeys(r.a).sortValues((t,e)=>t[1].name.localeCompare(e[1].name)).entries(C(this._moduleProperties).filter(s=>s[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===t&&("U"===s[1].moduleLevel||s[1].moduleLevel===A._getModuleLevel(e))));let a;const i=new Set(["Permanent","Ship trim"]);return a=s.length>1?s.map(e=>`<optgroup label="${e.key}" data-max-options="${i.has(t.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${e.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")}`).join("</optgroup>"):s.map(t=>""+t.values.map(t=>`<option value="${t[0]}">${t[1].name}`).join("</option>")).join(""),a}_fillModuleSelect(t,e){const s=this._getUpgradesOptions(e,(()=>this._shipData.find(e=>e.id===this._shipIds[t]).class)());this._selectModule$[t][e].find("option").remove(),this._selectModule$[t][e].append(s)}_resetModuleSelects(t){for(const e of this._moduleTypes)this._fillModuleSelect(t,e),this._selectModule$[t][e].selectpicker("refresh")}_getModuleFromName(t){let e={};return this._moduleDataDefault.some(s=>(e=s[1].find(e=>e.name===t),Boolean(e))),e}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const s of this._moduleTypes)this._selectModule$[e][s]=t("#"+this._getModuleSelectId(s,e)),this._selectModule$[e][s].on("changed.bs.select",()=>{this._modulesSelected(e),this._refreshShips(e)}).on("show.bs.select",e=>{t(e.currentTarget).parent().find("button.bs-select-all").remove()}).on("show.bs.select",e=>{const s=t(e.currentTarget);for(const e of s.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const s=this._getModuleFromName(e.textContent);t(e).attr("data-original-title",A._getModifierFromModule(s.properties)).tooltip({boundary:"viewport",html:!0})}}).selectpicker({actionsBox:!0,countSelectedText:t=>`${t} ${s.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:s.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:""+s,width:"150px"})}this._resetModuleSelects(e)}_getShipData(t){const e=this._shipData.find(e=>e.id===this._shipIds[t]);e.crew.carronades=e.crew.cannons,e.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:e.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:e.boarding.prepInitial,prepPerRound:e.boarding.prepPerRound};let s=e;return s.repairAmount={armour:S.g,armourPerk:0,sails:S.m,sailsPerk:0},s.repairTime={sides:S.k,default:S.k},s.resistance={fire:0,leaks:0,splinter:0},s=this._addModulesAndWoodData(e,s,t),s}_roundPropertyValue(t,e,s=!1){return Number.isInteger(t)&&!s?Math.round(e):Math.trunc(100*e)/100}_adjustValue(t,e,s){var a,i;let r=t;if(null===(a=this._modifierAmount.get(e))||void 0===a?void 0:a.percentage){const t=this._modifierAmount.get(e).percentage/100;r=A._adjustPercentage(r,t,s)}if(null===(i=this._modifierAmount.get(e))||void 0===i?void 0:i.absolute){const{absolute:t}=this._modifierAmount.get(e);r=A._adjustAbsolute(r,t)}const o=!function(t,e){var s=e.get(t);if(!s)throw new TypeError("attempted to get private field on non-instance");return s.get?s.get.call(t):s.value}(this,k).has(e)&&!s;return this._roundPropertyValue(t,r,o)}_setModifier(t){let e=t.isPercentage?0:t.amount,s=t.isPercentage?t.amount:0;var a,i,r,o;this._modifierAmount.has(t.modifier)&&(e+=null!==(a=null===(i=this._modifierAmount.get(t.modifier))||void 0===i?void 0:i.absolute)&&void 0!==a?a:0,s+=null!==(r=null===(o=this._modifierAmount.get(t.modifier))||void 0===o?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(t.modifier,{absolute:e,percentage:s})}_showCappingAdvice(t,e){const s=`${this._baseId}-${t}-capping`;let a=document.querySelector("#"+s);if(!a){var i;a=document.createElement("p"),a.id=s,a.className="alert alert-warning";const e=document.querySelector(`#${this._baseId}-${t}`);null==e||null===(i=e.firstChild)||void 0===i||i.after(a)}a.innerHTML=C(e).join(", ")+" capped"}_removeCappingAdvice(t){const e=`${this._baseId}-${t}-capping`,s=document.querySelector("#"+e);s&&s.remove()}_addModulesAndWoodData(t,e,s){const a=JSON.parse(JSON.stringify(e)),i=()=>{a.speedDegrees=a.speedDegrees.map(t=>{const e=1+this._modifierAmount.get("Max speed").percentage/100,s=t>0?t*e:t/e;return Math.max(Math.min(s,this._maxSpeed),this._minSpeed)})};return this._modifierAmount=new Map,(()=>{for(const t of this._selectedUpgradeIdsList[s]){const e=this._moduleProperties.get(t);for(const t of e.properties)this._moduleAndWoodChanges.has(t.modifier)&&this._setModifier(t)}if(this.woodCompare.instances[s]){let t="_woodData";"Base"!==s&&(t="_compareData");for(const e of f.g)for(const a of this.woodCompare.instances[s][t][e].properties)this._moduleAndWoodChanges.has(a.modifier)&&this._setModifier(a)}})(),(()=>{for(const[e]of this._modifierAmount.entries()){var t;if(null===(t=this._moduleAndWoodChanges.get(e))||void 0===t?void 0:t.properties){const{properties:t,isBaseValueAbsolute:s}=this._moduleAndWoodChanges.get(e);for(const i of t){const t=i.split(".");t.length>1?a[t[0]][t[1]]=this._adjustValue(a[t[0]][t[1]],e,s):a[t[0]]=this._adjustValue(a[t[0]],e,s)}}}})(),(()=>{const e={isCapped:!1,modifiers:new Set},i=(t,s,a,{amount:i,isPercentage:r})=>{const o=Math.min(s,r?this._roundPropertyValue(a,a*(1+i)):i);return s>o&&(e.isCapped=!0,e.modifiers.add(t)),o};for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(e)){const{cap:s}=this._moduleAndWoodCaps.get(e);for(const r of this._moduleAndWoodCaps.get(e).properties){const o=r.split(".");o.length>1?a[o[0]][o[1]]&&(a[o[0]][o[1]]=i(e,a[o[0]][o[1]],t[o[0]][o[1]],s)):a[o[0]]&&(a[o[0]]=i(e,a[o[0]],t[o[0]],s))}}e.isCapped?this._showCappingAdvice(s,e.modifiers):this._removeCappingAdvice(s)})(),this._modifierAmount.has("Max speed")&&i(),a}_updateDifferenceProfileNeeded(t){"Base"===t||Object(f.c)(this.selectedShips[t])||this.selectedShips[t].updateDifferenceProfile()}_updateSailingProfile(t){this._updateDifferenceProfileNeeded(t);for(const e of this.columnsCompare)e!==t&&this._updateDifferenceProfileNeeded(e)}_refreshShips(t){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find(e=>e.id===this._shipIds[t]);else{this._modulesSelected(t);const e=this._getShipData(t);if("Base"===t){this._setSelectedShip(t,new j.a(t,e,this));for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh"),Object(f.c)(this.selectedShips[t])||this._setSelectedShip(t,new O.a(t,e,this.selectedShips[t].shipCompareData,this))}else this._setSelectedShip(t,new O.a(t,this.selectedShips.Base.shipData,e,this));this._updateSailingProfile(t)}}_enableCompareSelects(){for(const t of this.columnsCompare)this._selectShip$[t].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(t){this._selectedUpgradeIdsList[t]=[],this._selectedUpgradeIdsPerType[t]={};for(const e of this._moduleTypes)this._selectedUpgradeIdsPerType[t][e]=this._selectModule$[t][e].val(),Array.isArray(this._selectedUpgradeIdsPerType[t][e])?this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e].map(t=>Number(t)):this._selectedUpgradeIdsPerType[t][e]=this._selectedUpgradeIdsPerType[t][e]?[Number(this._selectedUpgradeIdsPerType[t][e])]:[],this._selectedUpgradeIdsPerType[t][e].length>0&&(this._selectedUpgradeIdsList[t]=this._selectedUpgradeIdsList[t].concat(this._selectedUpgradeIdsPerType[t][e]))}_setupSelectListener(t){if(this._selectShip$[t].selectpicker({title:"Ship"}).on("changed.bs.select",()=>{this._shipIds[t]=Number(this._selectShip$[t].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(t),this._refreshShips(t),"Base"===t&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(t)}),"ship-journey"!==this._baseId)for(const e of f.g)this._selectWood$[t][e].on("changed.bs.select",()=>{this.woodCompare._woodSelected(t,e,this._selectWood$[t][e]),this._refreshShips(t)}).selectpicker({title:"Wood "+e,width:"150px"})}_setShipAndWoodsSelects(t){let e=0;this._columns.some(s=>{if(!this._shipData.find(s=>s.id===t[e]))return!1;if(this._shipIds[s]=t[e],e+=1,A._setSelect(this._selectShip$[s],this._shipIds[s]),"Base"===s&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(s),this._setupModulesSelect(s),t[e])for(const a of f.g)A._setSelect(this._selectWood$[s][a],t[e]),e+=1,this.woodCompare._woodSelected(s,a,this._selectWood$[s][a]);else e+=2;return this._refreshShips(s),e>=t.length})}_setModuleSelects(t){for(const s of this._columns){const a=this._columns.indexOf(s);let i=!1;for(const r of C(this._moduleTypes)){const o=C(this._moduleTypes).indexOf(r);if(t.has(`${a}${o}`)){var e;const n=S.f.decode(t.get(`${a}${o}`));this._selectedUpgradeIdsPerType[s]||(this._selectedUpgradeIdsPerType[s]={}),this._selectedUpgradeIdsList[s]||(this._selectedUpgradeIdsList[s]=[]),this._selectedUpgradeIdsPerType[s][r]=n.map(t=>Number(t)),A._setSelect(this._selectModule$[s][r],this._selectedUpgradeIdsPerType[s][r]),(e=this._selectedUpgradeIdsList[s]).push.apply(e,C(this._selectedUpgradeIdsPerType[s][r])),i=!0}}i&&this._refreshShips(s)}}_getShipSelectId(t){return`${this._baseId}-${t}-select`}_getWoodSelectId(t,e){return`${this._woodId}-${t}-${e}-select`}_getModuleSelectId(t,e){return`${this._moduleId}-${t.replace(/\s/,"")}-${e}-select`}_setSelectedShip(t,e){this.selectedShips[t]=e}}var k=new WeakMap}).call(this,s("xeH2"))},u3gz:function(t,e,s){s("Z5fe"),s("awzk"),s("iftE");var a=s("qE0g");s.d(e,"a",(function(){return a.a}))},yU80:function(t,e,s){}}]);