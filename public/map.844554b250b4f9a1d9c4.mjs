/*! For license information please see map.844554b250b4f9a1d9c4.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[842],{5596:(t,e,i)=>{i.r(e),i.d(e,{NAMap:()=>Mo});var a=i(3838),s=i(2332),r=i(5892),n=i(2855),o=i(9022),l=i(393),h=i(9949),d=i(1198),c=i(3389),p=i(9843),u=i(4030),w=i(7442),v=i(7015);function m(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_(t,e,"get"))}function g(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,_(t,e,"set"),i),i}function _(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var f=new WeakMap,b=new WeakMap,y=new WeakMap,k=new WeakMap,M=new WeakMap,S=new WeakMap,x=new WeakMap,W=new WeakMap,T=new WeakMap,$=new WeakMap,D=new WeakMap,P=new WeakMap,C=new WeakMap,I=new WeakMap,L=new WeakMap,N=new WeakMap,A=new WeakMap,Z=new WeakMap,B=new WeakMap;class E{constructor(t){f.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:!1}),y.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),L.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),Z.set(this,{writable:!0,value:void 0}),B.set(this,{writable:!0,value:void 0}),g(this,y,t),g(this,f,"on"===m(this,y).showGrid),g(this,k,m(this,y).coord.min),g(this,M,m(this,y).coord.max),g(this,S,m(this,y).height),g(this,x,m(this,y).width),g(this,W,m(this,y).rem),g(this,T,m(this,y).xGridBackgroundHeight),g(this,$,m(this,y).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){g(this,D,(0,w.Z)().clamp(!0).domain([(0,l.IK)(m(this,k),m(this,k)),(0,l.IK)(m(this,M),m(this,M))]).range([m(this,k),m(this,M)])),g(this,P,(0,w.Z)().clamp(!0).domain([(0,l.pw)(m(this,k),m(this,k)),(0,l.pw)(m(this,M),m(this,M))]).range([m(this,k),m(this,M)]))}_setupAxis(){const t=this._getTicks(65);g(this,C,(0,u.LL)(m(this,D)).tickFormat((t=>(0,v.Hu)(t))).tickValues(t).tickSize(m(this,M))),g(this,I,(0,u.Kh)(m(this,P)).tickFormat((t=>(0,v.Hu)(t))).tickValues(t).tickSize(m(this,M)));const e=(0,a.Z)("#map");g(this,N,e.insert("g","g.pb").attr("class","axis d-none")),g(this,Z,m(this,N).append("g")),g(this,A,e.insert("g","g.pb").attr("class","axis d-none")),g(this,B,m(this,A).append("g")),this._displayAxis(void 0),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round((0,l.pw)(m(this,k),m(this,k))),i=Math.round((0,l.pw)(m(this,M),m(this,M))),a=(i-e)/(t-1),s=[];for(let t=a;t<i;t+=a)s.push(Math.round(t));s.push(i);const r=[...s].reverse().map((t=>-t));return r.push(0),[...r,...s]}_setupXAxis(){m(this,Z).selectAll(".tick text").attr("dx","-0.3rem").attr("dy","2rem"),m(this,Z).attr("font-family","inherit")}_setupYAxis(){m(this,B).attr("font-family","inherit"),m(this,B).selectAll(".tick text").attr("dx","3.5rem").attr("dy","-.5rem")}_displayAxis(t){const e=t?t.k:1,i=(0,l.qY)(m(this,W)/e),a=(0,l.qY)(1/e),s=t?t.y:0,r=s/e<m(this,x)?s/e:0,n=-m(this,M)-r,o=t?t.x:0,h=o/e<m(this,S)?o/e:0,d=-m(this,M)-h;m(this,Z).attr("font-size",i).attr("stroke-width",a).call(m(this,C).tickPadding(n)),m(this,B).attr("font-size",i).attr("stroke-width",a).call(m(this,I).tickPadding(d))}get show(){return m(this,f)}set show(t){g(this,f,t)}get zoomLevel(){return m(this,L)}set zoomLevel(t){g(this,L,t)}update(){let t=!1;m(this,f)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),m(this,b)&&this.gridToggle(t)}transform(t){m(this,f)&&(this.testForInitialisation(),this._displayAxis(t))}gridToggle(t){m(this,y).gridOverlay.classList.toggle("overlay-grid",t),m(this,y).gridOverlay.classList.toggle("overlay-no-grid",!t),m(this,N).classed("d-none",!t),m(this,A).classed("d-none",!t)}testForInitialisation(){m(this,b)||(this._setupSvg(),g(this,b,!0))}}var j=i(1460),F=i(4194);function R(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function z(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,G(t,e,"get"))}function V(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,G(t,e,"set"),i),i}function G(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var q=new WeakMap,H=new WeakMap,O=new WeakMap,Y=new WeakMap,K=new WeakMap;class X{constructor(t,e){q.set(this,{writable:!0,value:12}),H.set(this,{writable:!0,value:10}),R(this,"showPB",void 0),O.set(this,{writable:!0,value:void 0}),Y.set(this,{writable:!0,value:{}}),K.set(this,{writable:!0,value:{}}),R(this,"_ports",void 0),R(this,"_showId",void 0),R(this,"_showValues",void 0),R(this,"_showCookie",void 0),R(this,"_showRadios",void 0),R(this,"_isDataLoaded",void 0),R(this,"_pbZonesDefault",void 0),R(this,"_defencesFiltered",void 0),R(this,"_pbZonesFiltered",void 0),R(this,"_raidZonesFiltered",void 0),R(this,"_g",void 0),this._ports=t,V(this,O,(0,j.Oy)(e)),this._showId="show-zones",this._showValues=["pb-all","pb-single","raid-all","raid-single","off"],this._showCookie=new c.Z({id:this._showId,values:this._showValues}),this._showRadios=new F.Z(this._showId,this._showValues),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","#ports").attr("class","pb")}async _loadData(){this._pbZonesDefault=(await i.e(268).then(i.t.bind(i,5912,19))).default}_setupListener(){var t;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(()=>{this._showPBZonesSelected()}))}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","pb-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],28)+(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.pbCircles.map((t=>(0,d.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.pbCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.pbCircles.map((t=>t[1])).join(","))).text((t=>t.pbCircles.map(((t,e)=>String.fromCharCode(65+e))).join(""))),"PVP"===z(this,O)&&(e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.spawnPoints.map((t=>(0,d.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.spawnPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.spawnPoints.map((t=>t[1])).join(","))).text((t=>t.spawnPoints.map(((t,e)=>String.fromCharCode(88+e))).join("")))),e}));this._g.selectAll("g.defence").data(this._defencesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","defence svg-text-center fill-white text-tiny");return e.selectAll("path.tower-range").data((t=>t.towers)).join((t=>t.append("path").attr("class","tower-range background-primary-light").attr("d",(t=>(0,d.GZ)(t[0],t[1],z(this,H)))))),e.selectAll("path.fort-range").data((t=>t.forts)).join((t=>t.append("path").attr("class","fort-range background-red").attr("d",(t=>(0,d.GZ)(t[0],t[1],z(this,q)))))),e.append("path").attr("class","fort fill-red").attr("d",(t=>t.forts.map((t=>(0,d.yb)(t[0],t[1],3))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.forts.map((t=>t[0])).join(","))).attr("y",(t=>t.forts.map((t=>t[1])).join(","))).text((t=>t.forts.map(((t,e)=>`${e+1}`)).join(""))),e.append("path").attr("class","tower fill-dark").attr("d",(t=>t.towers.map((t=>(0,d.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.towers.map((t=>t[0])).join(","))).attr("y",(t=>t.towers.map((t=>t[1])).join(","))).text((t=>t.towers.map(((t,e)=>`${e+1}`)).join(""))),e})),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","raid-zones text-tiny");return e.append("path").attr("class","stroke-primary-light").attr("d",(t=>(0,d.GZ)(t.joinCircle[0],t.joinCircle[1],35))),e.append("path").attr("class","fill-primary-dark").attr("d",(t=>t.raidCircles.map((t=>(0,d.GZ)(t[0],t[1],4.5))).join(""))),e.append("text").attr("class","svg-text-center fill-white").attr("x",(t=>t.raidCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.raidCircles.map((t=>t[1])).join(","))).text((t=>t.raidCircles.map(((t,e)=>String.fromCharCode(65+e))).join(""))),e.append("path").attr("class","fill-primary-light").attr("d",(t=>t.raidPoints.map((t=>(0,d.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","svg-text-center fill-text").attr("x",(t=>t.raidPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.raidPoints.map((t=>t[1])).join(","))).text((t=>t.raidPoints.map(((t,e)=>String.fromCharCode(49+e))).join(""))),e}))}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}async _setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?(this._isDataLoaded||(await this._loadData(),this._isDataLoaded=!0),this._filterVisible()):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter((t=>t.position[0]>=z(this,Y)[0]&&t.position[0]<=z(this,K)[0]&&t.position[1]>=z(this,Y)[1]&&t.position[1]<=z(this,K)[1])).filter((t=>this._isPortIn(t)));this._defencesFiltered=t.map((t=>({id:t.id,forts:t.forts,towers:t.towers}))),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map((t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints}))),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map((t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints}))))}setBounds(t){V(this,Y,t[0]),V(this,K,t[1])}async refresh(){await this._setData(),this._update()}}var U=i(3824),J=i.n(U),Q=i(8398),tt=i(8776),et=i(2255),it=i(5430),at=i(8973),st=i(5619),rt=i(6400),nt=i(4848),ot=i(7484),lt=i.n(ot),ht=(i(9517),i(285)),dt=i.n(ht),ct=i(4110),pt=i.n(ct),ut=i(178),wt=i.n(ut),vt=i(2157),mt=i(5923),gt=i(4332);const _t=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}],ft=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}],bt=[{name:"Hispaniola",coordinates:[4900,3635],radius:150,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"Tumbado",coordinates:[2400,3050],radius:150,shallow:!1},{name:"Léogane",coordinates:[5130,3770],radius:90,shallow:!1,shipClass:{min:7,max:4}},{name:"Tortuga",coordinates:[5435,3420],radius:100,shallow:!1,shipClass:{min:7,max:5}},{name:"Antilles",coordinates:[7555,4470],radius:140,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"La Mona",coordinates:[6180,4100],radius:170,shallow:!1,shipClass:{min:7,max:4}}];var yt=i(7846);function kt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Mt(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,xt(t,e,"get"))}function St(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,xt(t,e,"set"),i),i}function xt(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}lt().extend(dt()),lt().extend(pt()),lt().extend(wt()),lt().locale("en-gb");const Wt=st.Z.bind(rt.h);var Tt=new WeakMap,$t=new WeakMap,Dt=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,It=new WeakMap,Lt=new WeakMap,Nt=new WeakMap,At=new WeakMap,Zt=new WeakMap,Bt=new WeakMap,Et=new WeakMap,jt=new WeakMap,Ft=new WeakMap,Rt=new WeakMap,zt=new WeakMap,Vt=new WeakMap,Gt=new WeakMap,qt=new WeakMap,Ht=new WeakMap,Ot=new WeakMap,Yt=new WeakMap,Kt=new WeakMap,Xt=new WeakMap,Ut=new WeakMap,Jt=new WeakMap,Qt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,ae=new WeakMap,se=new WeakMap,re=new WeakMap,ne=new WeakMap,oe=new WeakMap,le=new WeakMap,he=new WeakMap,de=new WeakMap,ce=new WeakMap,pe=new WeakMap,ue=new WeakMap,we=new WeakMap,ve=new WeakMap,me=new WeakMap,ge=new WeakMap,_e=new WeakMap,fe=new WeakMap,be=new WeakMap,ye=new WeakMap,ke=new WeakMap,Me=new WeakMap,Se=new WeakMap,xe=new WeakMap,We=new WeakMap,Te=new WeakMap,$e=new WeakMap,De=new WeakMap,Pe=new WeakMap,Ce=new WeakMap;class Ie{constructor(t){this.map=t,Tt.set(this,{writable:!0,value:""}),$t.set(this,{writable:!0,value:{id:366,coord:{x:4396,y:2494}}}),Dt.set(this,{writable:!0,value:{}}),Pt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:!1}),It.set(this,{writable:!0,value:""}),Lt.set(this,{writable:!0,value:!1}),Nt.set(this,{writable:!0,value:{}}),At.set(this,{writable:!0,value:0}),Zt.set(this,{writable:!0,value:"initial"}),Bt.set(this,{writable:!0,value:void 0}),Et.set(this,{writable:!0,value:void 0}),jt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:void 0}),Vt.set(this,{writable:!0,value:_t}),Gt.set(this,{writable:!0,value:[]}),qt.set(this,{writable:!0,value:void 0}),Ht.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),Yt.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:void 0}),Xt.set(this,{writable:!0,value:void 0}),Ut.set(this,{writable:!0,value:void 0}),Jt.set(this,{writable:!0,value:void 0}),Qt.set(this,{writable:!0,value:{}}),te.set(this,{writable:!0,value:void 0}),ee.set(this,{writable:!0,value:void 0}),ie.set(this,{writable:!0,value:void 0}),ae.set(this,{writable:!0,value:void 0}),se.set(this,{writable:!0,value:void 0}),re.set(this,{writable:!0,value:void 0}),ne.set(this,{writable:!0,value:void 0}),oe.set(this,{writable:!0,value:void 0}),le.set(this,{writable:!0,value:void 0}),he.set(this,{writable:!0,value:void 0}),de.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),ue.set(this,{writable:!0,value:void 0}),we.set(this,{writable:!0,value:ft}),ve.set(this,{writable:!0,value:[]}),me.set(this,{writable:!0,value:0}),ge.set(this,{writable:!0,value:void 0}),_e.set(this,{writable:!0,value:{}}),fe.set(this,{writable:!0,value:"show-radius"}),be.set(this,{writable:!0,value:l.w7}),ye.set(this,{writable:!0,value:void 0}),ke.set(this,{writable:!0,value:void 0}),Me.set(this,{writable:!0,value:l.jo}),Se.set(this,{writable:!0,value:48}),xe.set(this,{writable:!0,value:l.L9}),We.set(this,{writable:!0,value:4*l.L9}),Te.set(this,{writable:!0,value:void 0}),$e.set(this,{writable:!0,value:void 0}),De.set(this,{writable:!0,value:void 0}),Pe.set(this,{writable:!0,value:void 0}),Ce.set(this,{writable:!0,value:"all"}),kt(this,"_formatItems",(t=>(null==t?void 0:t.map((t=>{var e;return(null===(e=this.tradeItem.get(t))||void 0===e?void 0:e.name)??""})).sort(vt.I4).join(", "))??"")),kt(this,"_sortByProfit",((t,e)=>e.profit.profit-t.profit.profit)),kt(this,"_sortByProfitPerTon",((t,e)=>e.profit.profitPerTon-t.profit.profitPerTon)),kt(this,"_formatProfits",(t=>{var e;return Wt`${null==t||null===(e=t.sort(this._sortByProfit))||void 0===e?void 0:e.map(((e,i)=>Wt`<span style="white-space: nowrap;">${e.name} (${(0,v.RK)(e.profit.profit)})</span
                        >${i===t.length-1?Wt``:Wt`, `}`))}`})),kt(this,"_formatProfitsPerTon",(t=>{var e;return Wt`${null==t||null===(e=t.sort(this._sortByProfitPerTon))||void 0===e?void 0:e.map(((e,i)=>Wt`<span style="white-space: nowrap;"
                            >${e.name} (${(0,v.RK)(e.profit.profitPerTon)})</span
                        >${i===t.length-1?Wt``:Wt`, `}`))}`})),kt(this,"_showProfits",((t,e,i)=>{var a;const s="buy"===i?"alert-success":"alert-danger",r="buy"===i?`Buy here and sell in ${e}`:`Buy in ${e} and sell here`;return void 0===(null===(a=t.profit)||void 0===a?void 0:a[0])?Wt``:Wt`<div class="alert ${s} mt-2 mb-2 text-start" role="alert">
                  <div class="alert-heading"><span class="caps">${r}</span> (net value in reales)</div>
                  <p class="my-1"><em>By profit per item</em>: ${t.profit}</p>
                  <p class="my-1"><em>By profit per ton</em>: ${t.profitPerTon}</p>
              </div>`})),St(this,Pe,this.map.serverName),St(this,Te,this.map.minMapScale),St(this,me,Mt(this,Te)),St(this,ke,this.map.f11),St(this,$e,["attack","county","points","position","tax","net","off"]),St(this,ye,new c.Z({id:Mt(this,fe),values:Mt(this,$e)})),St(this,De,new F.Z(Mt(this,fe),Mt(this,$e))),this.showRadius=this._getShowRadiusSetting()}async init(){await this._loadAndSetupData()}_setupData(t){St(this,Pt,t.ports.map((e=>{const i=t.server.find((t=>t.id===e.id))??{},a=t.pb.find((t=>t.id===e.id))??{};return{...e,...i,...a}}))),St(this,Dt,Mt(this,Pt)),this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupPatrolZones(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:`${Mt(this,Pe)}-ports.json`,name:"server"},{fileName:`${Mt(this,Pe)}-pb.json`,name:"pb"}],e=await(0,o.qP)(`${Mt(this,Pe)}-items.json`);this.tradeItem=new Map(e.map((t=>[t.id,t])));const a={};return a.ports=(await i.e(462).then(i.t.bind(i,9131,19))).default,await(0,o.EZ)(t,a),a}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){St(this,oe,(0,w.Z)()),St(this,Bt,(0,w.Z)().domain([0,1])),St(this,jt,(0,w.Z)().domain([0,1]).range([o.Q0,o.gc]).interpolate(it.Z)),St(this,Et,(0,at.Z)().range(o.q4)),St(this,re,(0,Q.Z)(this.portData,(t=>t.taxIncome))??0),St(this,ie,(0,tt.Z)(this.portData,(t=>t.taxIncome))??0),St(this,zt,(0,w.Z)().domain([Mt(this,re),Mt(this,ie)]).range([o.Q0,o.fy]).interpolate(it.Z)),St(this,ae,(0,Q.Z)(this.portData,(t=>t.netIncome))??0),St(this,te,(0,tt.Z)(this.portData,(t=>t.netIncome))??0),St(this,Ft,(0,w.Z)().domain([Mt(this,ae),0,Mt(this,te)]).range([o.gc,o.Q0,o.fy]).interpolate(it.Z)),St(this,se,(0,Q.Z)(this.portData,(t=>t.portPoints))??0),St(this,ee,(0,tt.Z)(this.portData,(t=>t.portPoints))??0),St(this,Rt,(0,w.Z)().domain([Mt(this,se),Mt(this,ee)]).range([o.Q0,o.fy]).interpolate(it.Z))}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",(()=>{this._showRadiusSelected()}))}_getShowRadiusSetting(){let t=Mt(this,ye).get();return"position"===t&&([t]=Mt(this,$e),Mt(this,ye).set(t)),Mt(this,De).set(t),t}_showRadiusSelected(){this.showRadius=Mt(this,De).get(),Mt(this,ye).set(this.showRadius),this.update()}_setupSvg(){St(this,Yt,(0,a.Z)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports")),St(this,Ut,Mt(this,Yt).append("g").attr("data-ui-component","region").attr("class","title")),St(this,Ht,Mt(this,Yt).append("g").attr("data-ui-component","county").attr("class","sub-title")),St(this,Kt,Mt(this,Yt).append("g").attr("data-ui-component","port-circles")),St(this,Ot,Mt(this,Yt).append("g").attr("data-ui-component","port-icons").attr("class","click-circle")),St(this,Jt,Mt(this,Yt).append("g").attr("data-ui-component","port-names").attr("class","fill-white")),St(this,Xt,Mt(this,Yt).append("g").attr("data-ui-component","patrol-zone").attr("class","fill-yellow-dark"))}_setupCounties(){const t={x:this.map.coord.max/2,y:this.map.coord.max/2};St(this,Vt,Mt(this,Vt).sort(((e,i)=>{const a={x:e.centroid[0],y:e.centroid[1]},s={x:i.centroid[0],y:i.centroid[1]};return(0,l.UI)(t,a)-(0,l.UI)(t,s)}))),Mt(this,Et).domain(Mt(this,Vt).map((t=>t.name)))}_setupPatrolZones(){const t=lt().utc("2021-01-17").hour(h.WF);let e=lt().utc().diff(t,"day");"eu2"===Mt(this,Pe)&&(e+=4),e%=bt.length;const{radius:i,name:a,shallow:s,shipClass:r}=bt[e],n=1.6*i,[o,d]=bt[e].coordinates,c=Math.round(i/1.3),p=Math.round(Mt(this,Me)*i/100);Mt(this,Xt).append("circle").attr("class","background-yellow").attr("cx",o).attr("cy",d).attr("r",i),Mt(this,Xt).append("image").attr("height",n).attr("width",n).attr("x",o).attr("y",d).attr("transform",`translate(${Math.floor(-n/2)},${Math.floor(-n/1.6)})`).attr("xlink:href",yt).attr("alt","Patrol zone"),Mt(this,Xt).append("text").attr("class","svg-text-center").attr("x",o).attr("y",d).attr("dy",c).attr("font-size",Math.round(1.6*p)).text(a),Mt(this,Xt).append("text").attr("class","svg-text-center").attr("x",o).attr("y",d).attr("dy",c-1.6*p).attr("font-size",p).html(s?"Shallow water ships":(r?`${(0,l.hg)(r.min)} to ${(0,l.hg)(r.max)} rate`:"All")+" ships")}_setupSummary(){St(this,qt,(0,a.Z)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary shadow port-summary-no-wind")),St(this,he,Mt(this,qt).append("div").attr("class","block")),St(this,pe,Mt(this,he).append("div")),Mt(this,he).append("div").attr("class","overlay-des").html("selected<br>ports"),St(this,de,Mt(this,qt).append("div").attr("class","block")),St(this,ue,Mt(this,de).append("div")),Mt(this,de).append("div").attr("class","overlay-des").html("tax<br>income"),St(this,le,Mt(this,qt).append("div").attr("class","block")),St(this,ce,Mt(this,le).append("div")),Mt(this,le).append("div").attr("class","overlay-des").html("net<br>income")}_setupFlags(){const t=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${Mt(this,Se)} ${.75*Mt(this,Se)}`),e},e=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(Mt(this,Se))),e.setAttribute("height",String(Mt(this,Se))),e.setAttribute("href",o.eM[t].replace('"',"").replace('"',"")),e},i=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(Mt(this,Se)/2)),t.setAttribute("cy",String(Mt(this,Se)/2)),t.setAttribute("r","16"),t.setAttribute("class","circle-highlight-yellow"),t},a=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(Mt(this,Se)/2)),t.setAttribute("cy",String(Mt(this,Se)/2)),t.setAttribute("r","16"),t.setAttribute("class","circle-highlight"),t},s=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",o.Om),t.setAttribute("fill-opacity","0.7"),t},r=document.querySelector("#na-svg defs");for(const n of vt.nU.map((t=>t.short))){const o=t(n);o.append(e(n));const l=r.appendChild(o);if("FT"!==n){const t=l.cloneNode(!0);t.id=`${n}r`,t.append(a()),r.append(t)}if("NT"!==n&&"FT"!==n){const t=l.cloneNode(!0);t.id=`${n}c`,t.append(i()),r.append(t);const e=l.cloneNode(!0);e.id=`${n}a`,e.append(s()),r.append(e);const o=e.cloneNode(!0);o.id=`${n}ra`,o.append(a()),r.append(o)}}}_getPortName(t){var e;return t?(null===(e=Mt(this,Pt).find((e=>e.id===t)))||void 0===e?void 0:e.name)??"":""}_getText(t){var e;const i=lt().utc(t.portBattle),a=lt().utc(t.portBattle).local(),s=i===a?"":` (${a.format("H.mm")} local)`,r=lt().utc(t.cooldownTime),n=lt().utc(t.cooldownTime).local(),l=r===n?"":` (${n.format("H.mm")} local)`,h=(0,o.eA)(t.portBattleStartTime),d=i.isAfter(lt().utc())?"s":"ed",c=t.portBattle?Wt`<span
                      class="flag-icon-${t.attackerNation} flag-icon-small me-1"
                      role="img"
                      title="${(null===(e=(0,vt.$i)((null==t?void 0:t.attackerNation)??""))||void 0===e?void 0:e.sortName)??""}"
                  ></span
                  >${(0,mt.HL)(t.attackerClan)} attack${t.portBattle?Wt`${d} ${i.fromNow()} at ${i.format("H.mm")}${s}`:Wt`s: ${(0,v.sR)(t.attackHostility??0)} hostility`}`:Wt``,p={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:""===t.county?"":t.county,region:""===t.region?"":t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?(0,mt.HL)(t.capturer):Wt``,captureTime:t.captured?`${(0,vt.fm)(lt().utc(t.captured).fromNow())}`:"",attack:t.attackHostility?c:Wt``,isNPCAttacker:"NT"===t.attackerNation,pbTimeRange:t.capturable?h:"",brLimit:(0,v.yI)(t.brLimit),portPoints:t.capturable?(0,v.yI)(t.portPoints):"",taxIncome:(0,v.RK)(t.taxIncome),portTax:(0,v.sR)(t.portTax),netIncome:(0,v.RK)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:this._formatItems(t.dropsTrading),consumesTrading:this._formatItems(t.consumesTrading),producesNonTrading:this._formatItems(t.producesNonTrading),dropsNonTrading:this._formatItems(t.dropsNonTrading),tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:{profit:this._formatProfits(t.goodsToSellInTradePort),profitPerTon:this._formatProfitsPerTon(t.goodsToSellInTradePort)},goodsToBuyInTradePort:{profit:this._formatProfits(t.goodsToBuyInTradePort),profitPerTon:this._formatProfitsPerTon(t.goodsToBuyInTradePort)}};return p.dropsTrading.length>0&&p.dropsNonTrading.length>0&&(p.dropsNonTrading+=" ‒ "),t.cooldownTime&&(p.cooldownTime=Wt`${r.fromNow()} at <em>approximately</em> ${r.format("H.mm")}${l}`),t.portBonus&&(p.portBonus=t.portBonus),p}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return Wt`
            <div class="d-flex justify-content-between mb-4">
                <div class="d-flex">
                    <i class="flag-icon-${t.icon} flag-icon-large ${e}" role="img" />

                    <div class="text-start align-self-center compress mx-3">
                        <div class="large mb-1">${t.name}</div>
                        <div class="caps">${t.county}</div>
                        <div class="caps">${t.region}</div>
                    </div>
                </div>

                ${t.portBonus?Wt`<div class="d-flex align-self-end me-1">${Wt`${gt.y7.map((e=>{var i;return Wt`${null!=t&&null!==(i=t.portBonus)&&void 0!==i&&i[e]?Wt`<div class="me-1">
                          <i class="icon icon-light icon-${e}" role="img" aria-label="${e} bonus"></i>
                          <div class="x-large text-lighter text-center">${t.portBonus[e]}</div>
                      </div>`:Wt``}`}))}`}</div>`:Wt``}

                <div class="d-flex flex-column justify-content-end align-self-center">
                    <div class="ms-auto">
                        ${t.portPoints?Wt`<span class="x-large text-lighter">${t.portPoints}</span>`:Wt``}
                    </div>
                    <div class="ms-auto">
                        ${t.laborHoursDiscount?Wt`<i
                                  class="icon icon-light icon-labour me-1"
                                  role="img"
                                  aria-label="Labour hour discount level ${t.laborHoursDiscount}"
                              ></i>`:Wt``}
                        ${t.tradingCompany?Wt`<i
                                  class="icon icon-light icon-trading me-1"
                                  role="img"
                                  aria-label="Trading company level ${t.tradingCompany}"
                              ></i>`:Wt``}
                        ${t.availableForAll?Wt`<i
                                  class="icon icon-light icon-open me-1"
                                  role="img"
                                  aria-label="Accessible to all"
                              ></i>`:Wt``}
                        ${t.shallow?Wt`<i class="icon icon-light icon-shallow" role="img" aria-label="Shallow"></i>`:Wt`<i class="icon icon-light icon-deep" role="img" aria-label="Deep"></i>`}
                    </div>
                </div>
            </div>

            ${void 0===t.attack?Wt`${t.cooldownTime?Wt`<div class="alert alert-success mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:Wt``}`:Wt`<div class="alert mt-2 ${t.isNPCAttacker?"alert-warning":"alert-danger"}" role="alert">
                      ${t.attack}
                  </div>`}

            <div class="d-flex text-start mb-2 compress">
                ${t.capital||"FT"===t.icon?Wt`<div>${t.portTax}<br /><span class="des top-0">Tax rate</span></div>`:Wt`
                          <div class="me-3">
                              ${t.pbTimeRange}<br />
                              <span class="des top-0">Battle timer</span>
                          </div>
                          <div class="me-3">
                              ${t.brLimit}<br />
                              <span class="des top-0">Rating</span>
                          </div>
                          ${t.capturer?Wt` <div class="me-3">
                                        ${t.capturer}<br />
                                        <span class="des top-0">Capturer</span>
                                    </div>
                                    <div class="me-5">
                                        ${t.captureTime}<br />
                                        <span class="des top-0">Capture</span>
                                    </div>`:Wt``}

                          <div class="ms-auto me-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des top-0">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des top-0">Net income</span>
                          </div>
                      `}
            </div>

            ${"tradePorts"===this.showRadius?Wt`${this._showProfits(t.goodsToSellInTradePort,t.tradePort,"buy")}${this._showProfits(t.goodsToBuyInTradePort,t.tradePort,"sell")}`:Wt` ${t.producesNonTrading.length>0?Wt`<p class="mb-2">
                            <span class="caps">Produces—</span
                            ><span class="non-trading">${t.producesNonTrading}</span>
                        </p>`:Wt``}
                  ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?Wt`<p class="mb-2">
                            <span class="caps">Drops—</span>
                            ${t.dropsNonTrading?Wt`<span class="non-trading">${t.dropsNonTrading}</span>`:Wt``}
                            ${t.dropsTrading}
                        </p> `:Wt``}
                  ${t.consumesTrading.length>0?Wt`<p class="mb-2"><span class="caps">Consumes—</span>${t.consumesTrading}</p>`:Wt``}`}
        `}_getInventory(t){const e=t=>{var e;return(null===(e=this.tradeItem.get(t))||void 0===e?void 0:e.name)??""};let i="";const a=t.inventory.filter((t=>t.buyQuantity>0&&t.buyPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,v.yI)(t.buyQuantity)} ${e(t.id)} @ ${(0,v.Pj)(t.buyPrice)}`)).join("<br>"),s=t.inventory.filter((t=>t.sellQuantity>0&&t.sellPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,v.yI)(t.sellQuantity)} ${e(t.id)} @ ${(0,v.Pj)(t.sellPrice)}`)).join("<br>");return i+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,a.length>0&&(i+="<h6>Buy</h6>",i+=a),a.length>0&&s.length>0&&(i+="<p></p>"),s.length>0&&(i+="<h6>Sell</h6>",i+=s),i}_hideDetails(){void 0!==Mt(this,ge)&&(Mt(this,ge).dispose(),St(this,ge,void 0))}_showDetails(t,e){const i=t.currentTarget;this._hideDetails(),St(this,ge,new(J())(i,{html:!0,placement:"auto",trigger:"manual",title:(0,nt.ZP)(this._tooltipData(this._getText(e))),sanitize:!1})),Mt(this,ge).show(),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(this._getInventory(e)))}_updateIcons(){const t=Mt(this,me)<.5?2*Mt(this,me):Mt(this,me),e=Mt(this,be)/t,i=Mt(this,ne);Mt(this,Ot).selectAll("circle").data(i,(t=>String(t.id))).join((t=>t.append("circle").attr("fill",(t=>{const e=`${"FT"===t.nation||"NT"===t.nation||t.capturable?"":"c"}${t.countyCapital&&t.capturable?"r":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`})).attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])).on("click",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",(()=>{this._hideDetails()})))).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getAttackMarker(t){let e="";return t.cooldownTime?e="cooldown":"NT"===t.attackerNation&&(e="raider"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=Mt(this,me)<.5?2*Mt(this,me):Mt(this,me),e=Mt(this,be)/t,i=(0,l.qY)(e*Mt(this,xe)),a=(0,l.qY)(e*Mt(this,We)),s=1e5;let r=Mt(this,ne),n=()=>"",o=()=>0,h=()=>"";switch(this.showRadius){case"tax":r=Mt(this,ne).filter((t=>t.capturable&&t.taxIncome>s)),Mt(this,oe).domain([Mt(this,re),Mt(this,ie)]).range([i,a]),n=()=>"bubble",h=t=>Mt(this,zt).call(this,t.taxIncome)??"",o=t=>Mt(this,oe).call(this,t.taxIncome)??0;break;case"net":r=Mt(this,ne).filter((t=>t.capturable&&Math.abs(t.netIncome)>s)),Mt(this,oe).domain([Mt(this,ae),Mt(this,te)]).range([i,a]),n=()=>"bubble",h=t=>Mt(this,Ft).call(this,t.netIncome)??"",o=t=>Mt(this,oe).call(this,Math.abs(t.netIncome))??0;break;case"points":r=Mt(this,ne).filter((t=>t.capturable&&t.portPoints>30)),Mt(this,oe).domain([Mt(this,se),Mt(this,ee)]).range([i,a/2]),n=()=>"bubble",h=t=>Mt(this,Rt).call(this,t.portPoints)??"",o=t=>Mt(this,oe).call(this,t.portPoints)??0;break;case"position":n=()=>"bubble here",o=t=>t.distance??0;break;case"attack":r=Mt(this,ne).filter((t=>t.attackHostility||t.cooldownTime)),Mt(this,Bt).range([i,a/1.5]),n=t=>`bubble ${this._getAttackMarker(t)}`,h=t=>"NT"===t.attackerNation?"":Mt(this,jt).call(this,t.attackHostility??0)??"",o=t=>Mt(this,Bt).call(this,t.attackHostility??(t.cooldownTime?.2:0))??0;break;default:if("currentGood"===this.circleType)n=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>a/2;else switch(this.showRadius){case"county":n=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",h=t=>t.capturable?Mt(this,Et).call(this,t.county):"",o=t=>t.capturable?a/2:a/3;break;case"tradePorts":n=t=>`bubble ${this._getTradePortMarker(t)}`,o=t=>t.id===this.tradePortId?a:a/2;break;case"frontline":n=t=>`bubble ${this._getFrontlineMarker(t)}`,o=t=>t.ownPort?a/3:a/2,r=r.filter((t=>t.enemyPort??t.ownPort));break;case"currentGood":n=t=>"bubble "+(t.isSource?"pos":"neg"),o=()=>a/2;break;case"off":r=[]}}Mt(this,Kt).selectAll("circle").data(r,(t=>String(t.id))).join((t=>t.append("circle").attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])))).attr("class",(t=>n(t))).attr("r",(t=>o(t))).attr("fill",(t=>h(t)))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===Mt(this,Ce)||"single"===Mt(this,Ce)&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.3*e*Math.cos((0,l.Ht)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const a=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+a;const s=t.angle>90&&t.angle<270?i:0;return"all"===Mt(this,Ce)||"single"===Mt(this,Ce)&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.3*e*Math.sin((0,l.Ht)(t.angle)))+s:t.coordinates[1]+a}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===Mt(this,Ce)||"single"===Mt(this,Ce)&&t.id===this.currentPort.id)?t.angle>0&&t.angle<l.tz?"start":"end":"middle"}updateTexts(){if("initial"===this.zoomLevel)Mt(this,Jt).classed("d-none",!0);else{const t=(0,l.qY)(Mt(this,be)/Mt(this,me)),e=(0,l.qY)(Mt(this,Me)/Mt(this,me)),i=Mt(this,ne);Mt(this,Jt).selectAll("text").data(i,(t=>String(t.id))).join((t=>t.append("text").text((t=>t.name)))).attr("x",(e=>this._updateTextsX(e,t))).attr("y",(i=>this._updateTextsY(i,t,e))).style("text-anchor",(t=>this._updateTextsAnchor(t))).style("dominant-baseline","auto"),Mt(this,Jt).attr("font-size",`${e}px`).classed("d-none",!1)}}_updateSummary(){const t=Object.keys(Mt(this,Dt)).length;let e=0,i=0;t&&(e=(0,et.Z)(Mt(this,Dt),(t=>t.taxIncome)),i=(0,et.Z)(Mt(this,Dt),(t=>t.netIncome))),Mt(this,pe).text(`${t}`),Mt(this,ue).html(`${(0,v.Dw)(e)}`),Mt(this,ce).html(`${(0,v.Dw)(i)}`)}_updateCounties(){if("portLabel"===this.zoomLevel){const t=Mt(this,Gt);Mt(this,Ht).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name))),(t=>t.attr("fill",(t=>"county"===this.showRadius?Mt(this,Et).call(this,t.name):"")))),Mt(this,Ht).classed("d-none",!1)}else Mt(this,Ht).classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=Mt(this,ve);Mt(this,Ut).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("class","svg-text-center").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name)))),Mt(this,Ut).classed("d-none",!1)}else Mt(this,Ut).classed("d-none",!0)}_updatePZ(){"pbZone"===this.zoomLevel?Mt(this,Xt).classed("d-none",!0):Mt(this,Xt).classed("d-none",!1)}update(t){St(this,me,t??Mt(this,me)),this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions(),this._updatePZ()}_filterVisible(){"position"===this.showRadius?St(this,ne,Mt(this,Dt)):St(this,ne,Mt(this,Dt).filter((t=>t.coordinates[0]>=Mt(this,Qt)[0]&&t.coordinates[0]<=Mt(this,_e)[0]&&t.coordinates[1]>=Mt(this,Qt)[1]&&t.coordinates[1]<=Mt(this,_e)[1]))),St(this,Gt,Mt(this,Vt).filter((t=>t.centroid[0]>=Mt(this,Qt)[0]&&t.centroid[0]<=Mt(this,_e)[0]&&t.centroid[1]>=Mt(this,Qt)[1]&&t.centroid[1]<=Mt(this,_e)[1]))),St(this,ve,Mt(this,we).filter((t=>t.centroid[0]>=Mt(this,Qt)[0]&&t.centroid[0]<=Mt(this,_e)[0]&&t.centroid[1]>=Mt(this,Qt)[1]&&t.centroid[1]<=Mt(this,_e)[1])))}setBounds(t){St(this,Qt,t[0]),St(this,_e,t[1])}_showSummary(){Mt(this,qt).classed("hidden",!1)}setShowRadiusSetting(t=Mt(this,$e)[0]){this.showRadius=t,Mt(this,De).set(this.showRadius),Mt(this,ye).set(this.showRadius)}clearMap(t){this._showSummary(),St(this,Dt,Mt(this,Pt)),this.circleType="",this.setShowRadiusSetting(),this.update(t)}get circleType(){return Mt(this,Tt)}set circleType(t){St(this,Tt,t)}get currentPort(){return Mt(this,$t)}set currentPort(t){St(this,$t,t)}get portData(){return Mt(this,Dt)}set portData(t){St(this,Dt,t)}get portDataDefault(){return Mt(this,Pt)}get showRadius(){return Mt(this,It)}set showRadius(t){St(this,It,t)}get tradeItem(){return Mt(this,Nt)}set tradeItem(t){St(this,Nt,t)}get showTradePortPartners(){return Mt(this,Ct)}set showTradePortPartners(t){St(this,Lt,t)}get tradePortId(){return Mt(this,At)}set tradePortId(t){St(this,At,t)}get zoomLevel(){return Mt(this,Zt)}set zoomLevel(t){St(this,Zt,t)}}var Le=i(5162),Ne=i(172),Ae=i(7281),Ze=i(2938),Be=i(9492);function Ee(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Fe(t,e,"get"))}function je(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Fe(t,e,"set"),i),i}function Fe(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Re=new WeakMap,ze=new WeakMap,Ve=new WeakMap,Ge=new WeakMap;class qe extends p.Z{constructor(t){super(t,"sm","Set"),Re.set(this,{writable:!0,value:"ship-journey"}),ze.set(this,{writable:!0,value:{}}),Ve.set(this,{writable:!0,value:{}}),Ge.set(this,{writable:!0,value:{}})}async init(){this._injectModal();const{select:t,shipNameAndSpeed:e}=await(0,Be.hY)();je(this,ze,t),je(this,Ve,e)}_injectModal(){const t=super.bodySel;je(this,Ge,new Ze.Z(t,this.baseId));const e=t.select("form"),i=`${Ee(this,Re)}-select`,a=e.append("div").attr("class","mt-3").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}getWind(){return Ee(this,Ge).getWind()??0}_getShipId(){return Number(Ee(this,ze).getValues())}getShipName(){var t;const e=this._getShipId();return null===(t=Ee(this,Ve).get(e))||void 0===t?void 0:t.name}getSpeedDegrees(){var t;const e=this._getShipId();return null===(t=Ee(this,Ve).get(e))||void 0===t?void 0:t.speedDegrees}}function He(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ye(t,e,"get"))}function Oe(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ye(t,e,"set"),i),i}function Ye(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ke=new WeakMap,Xe=new WeakMap,Ue=new WeakMap,Je=new WeakMap,Qe=new WeakMap,ti=new WeakMap;class ei{constructor(t){Ke.set(this,{writable:!0,value:{}}),Xe.set(this,{writable:!0,value:{}}),Ue.set(this,{writable:!0,value:{}}),Je.set(this,{writable:!0,value:{}}),Qe.set(this,{writable:!0,value:{}}),ti.set(this,{writable:!0,value:void 0}),Oe(this,ti,t),this._setupSummary()}_setupSummary(){Oe(this,Ke,(0,a.Z)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary shadow-lg d-none")),Oe(this,Xe,He(this,Ke).append("div").attr("class","block small")),Oe(this,Ue,He(this,Xe).append("div")),He(this,Xe).append("div").attr("class","overlay-des").text("ship"),Oe(this,Qe,He(this,Ke).append("div").attr("class","block small")),Oe(this,Je,He(this,Qe).append("div")),He(this,Qe).append("div").attr("class","overlay-des").text("wind"),He(this,Ke).append("div").attr("class","block").append("button").attr("id",He(this,ti)).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){He(this,Ke).classed("d-none",!t),(0,a.Z)("#port-summary").classed("d-none",t)}_printSummaryShip(t){He(this,Ue).text(t)}_printSummaryWind(t){He(this,Je).html(`From ${(0,d.Iy)(t)}`)}show(){this._displaySummary(!0)}hide(){this._displaySummary(!1)}setPosition(t,e){He(this,Ke).style("top",`${t}px`).style("right",`${e}px`)}print({startWindDegrees:t,shipName:e}){this._printSummaryWind(t),this._printSummaryShip(e)}}var ii=i(8250),ai=i(7),si=i(4227);function ri(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,oi(t,e,"set"),i),i}function ni(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,oi(t,e,"get"))}function oi(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var li=new WeakMap,hi=new WeakMap,di=new WeakMap,ci=new WeakMap,pi=new WeakMap,ui=new WeakMap,wi=new WeakMap,vi=new WeakMap,mi=new WeakMap,gi=new WeakMap;class _i{constructor(t,e,i){li.set(this,{writable:!0,value:0}),hi.set(this,{writable:!0,value:10}),di.set(this,{writable:!0,value:void 0}),ci.set(this,{writable:!0,value:void 0}),pi.set(this,{writable:!0,value:20}),ui.set(this,{writable:!0,value:void 0}),wi.set(this,{writable:!0,value:6}),vi.set(this,{writable:!0,value:1.3*ni(this,pi)}),mi.set(this,{writable:!0,value:r.CR.translate(ni(this,pi),ni(this,pi))}),gi.set(this,{writable:!0,value:void 0}),ri(this,ci,t),ri(this,gi,e),ri(this,di,i),ri(this,ui,1.4*ni(this,di))}_correctTextBox(t,e,i){const s=(0,a.Z)(i),r=s.select("text"),n=t.label.split("|");r.text("").attr("dy",0).attr("transform",ni(this,mi).toString()).style("font-size",`${ni(this,di)}px`);for(const[t,e]of n.entries()){const i=r.append("tspan").html(e);t>0&&i.attr("x",0).attr("dy",ni(this,ui))}const o=r.node().getBBox(),l=t.label?o.width+2*ni(this,vi):0,h=t.label?o.height+ni(this,vi):0;s.select("rect").attr("width",l).attr("height",h).attr("class","svg-shadow");const d=s.select("circle").attr("r",0===e||e===ni(this,li)?4*ni(this,hi):ni(this,hi)).attr("class","click-circle svg-shadow "+(0===e||e===ni(this,li)?"drag-hidden":"drag-circle"));s.append((()=>d.remove().node()))}_correctJourney(){ni(this,ci).selectAll("#journey g.labels g.label").each(((t,e,i)=>{this._correctTextBox(t,e,i[e])})),ni(this,gi)&&ni(this,gi).style("stroke-width",`${ni(this,wi)}px`)}print(t){const e=(0,ii.Z)().padding(ni(this,pi)).value((t=>{const e=t.label.split("|"),i=e.reduce(((t,e,i,a)=>a[t].length>e.length?t:i),0);return e[i]})),i=(0,ai.Z)(),a=(0,si.Z)(i).size(((t,e,i)=>{const a=t.label.split("|").length,s=i[e].querySelectorAll("text")[0].getBBox();return[s.width+2*ni(this,pi),s.height*a+2*ni(this,pi)]})).position((t=>t.position)).component(e);ni(this,ci).datum(t).call(a),ri(this,li,t.length-1),this._correctJourney()}}function fi(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,yi(t,e,"get"))}function bi(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,yi(t,e,"set"),i),i}function yi(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var ki=new WeakMap,Mi=new WeakMap,Si=new WeakMap,xi=new WeakMap,Wi=new WeakMap,Ti=new WeakMap,$i=new WeakMap,Di=new WeakMap,Pi=new WeakMap,Ci=new WeakMap,Ii=new WeakMap,Li=new WeakMap,Ni=new WeakMap,Ai=new WeakMap,Zi=new WeakMap,Bi=new WeakMap,Ei=new WeakMap,ji=new WeakMap,Fi=new WeakMap,Ri=new WeakMap,zi=new WeakMap,Vi=new WeakMap,Gi=new WeakMap,qi=new WeakMap,Hi=new WeakMap,Oi=new WeakMap,Yi=new WeakMap;class Ki{constructor(t){ki.set(this,{writable:!0,value:{}}),Mi.set(this,{writable:!0,value:{}}),Si.set(this,{writable:!0,value:{}}),xi.set(this,{writable:!0,value:{}}),Wi.set(this,{writable:!0,value:{}}),Ti.set(this,{writable:!0,value:{}}),$i.set(this,{writable:!0,value:{}}),Di.set(this,{writable:!0,value:void 0}),Pi.set(this,{writable:!0,value:void 0}),Ci.set(this,{writable:!0,value:void 0}),Ii.set(this,{writable:!0,value:"journey-arrow"}),Li.set(this,{writable:!0,value:5}),Ni.set(this,{writable:!0,value:void 0}),Ai.set(this,{writable:!0,value:"Make journey"}),Zi.set(this,{writable:!0,value:void 0}),Bi.set(this,{writable:!0,value:90}),Ei.set(this,{writable:!0,value:"None"}),ji.set(this,{writable:!0,value:19}),Fi.set(this,{writable:!0,value:0}),Ri.set(this,{writable:!0,value:o.er/60}),zi.set(this,{writable:!0,value:15}),Vi.set(this,{writable:!0,value:void 0}),Gi.set(this,{writable:!0,value:void 0}),qi.set(this,{writable:!0,value:void 0}),Hi.set(this,{writable:!0,value:2}),Oi.set(this,{writable:!0,value:2}),Yi.set(this,{writable:!0,value:void 0}),bi(this,Ni,(0,o.MF)(fi(this,Ai))),bi(this,qi,`menu-${fi(this,Ni)}`),bi(this,Zi,`compass-${fi(this,Ni)}`),bi(this,Vi,`button-delete-leg-${fi(this,Ni)}`),bi(this,Gi,(0,Ae.Z)().x((t=>t[0])).y((t=>t[1]))),bi(this,Yi,(0,w.Z)().domain((0,Le.Z)(0,l.QF,fi(this,zi)))),this._setupDrag(),this._setupSvg(),this._initJourneyData(),bi(this,Di,new _i(fi(this,Ti),fi(this,Wi),t)),bi(this,Ci,new ei(fi(this,Vi))),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0===e?"":(0,o.gY)(e,"hour");a+=t+(""===t?"":" ")+(0===i?"":(0,o.gY)(i,"minute"))}return a}_setupDrag(){const t=t=>{this._removeLabels(),(0,a.Z)(t).classed("drag-active",!0)},e=(t,e,i)=>{const s=i.position[0]+Number(e.dx),r=i.position[1]+Number(e.dy);0===i.index&&fi(this,ki).attr("x",s).attr("y",r),(0,a.Z)(t).attr("cx",e.x).attr("cy",e.y),i.position=[s,r],this._printLines()},i=t=>{(0,a.Z)(t).classed("drag-active",!1),this._printWholeJourney()};bi(this,Mi,(0,Ne.Z)().on("start",(function(){t(this)})).on("drag",(function(t,i){e(this,t,i)})).on("end",(function(){i(this)})))}_setupSvg(){const t=fi(this,Li),e=2*fi(this,Li);bi(this,Si,(0,a.Z)("#ports").append("g").attr("id","journey").attr("class","svg-background-dark")),bi(this,Wi,fi(this,Si).append("path")),bi(this,Ti,fi(this,Si).append("g").attr("class","labels")),(0,a.Z)("#na-svg defs").append("marker").attr("id",fi(this,Ii)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-light").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){bi(this,$i,{shipName:fi(this,Ei),startWindDegrees:fi(this,Fi),currentWindDegrees:fi(this,Fi),totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]})}_resetJourneyData(){var t;fi(this,$i).startWindDegrees=(null===(t=fi(this,Pi))||void 0===t?void 0:t.getWind())??fi(this,Fi),fi(this,$i).currentWindDegrees=fi(this,$i).startWindDegrees,fi(this,$i).totalDistance=0,fi(this,$i).totalMinutes=0}async _menuClicked(){(0,n.KS)("Menu",fi(this,Ai)),fi(this,Pi)?fi(this,Pi).show():(bi(this,Pi,new qe(fi(this,Ai))),await fi(this,Pi).init(),fi(this,Pi).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){document.querySelector(`#${fi(this,qi)}`).addEventListener("click",(()=>{this._menuClicked()})),document.querySelector(`#${fi(this,Vi)}`).addEventListener("click",(()=>{this._deleteLastLeg()}))}_useUserInput(){this._setShipName(),this._printWholeJourney(),this._printSummary()}_printCompass(){const t=fi(this,$i).segments[0].position[0],e=fi(this,$i).segments[0].position[1];bi(this,ki,fi(this,Si).insert("svg","path").attr("id",fi(this,Zi)).attr("class","fill-background-colour").attr("x",t).attr("y",e)),bi(this,xi,fi(this,ki).append("g")),(0,d.$G)({element:fi(this,xi),radius:fi(this,Bi)})}_removeCompass(){fi(this,ki).remove()}_getSpeedAtDegrees(t){return Math.max(fi(this,Yi).call(this,t)??0,fi(this,Hi))}_calculateDistanceForSection(t,e){const i=(l.QF-t+e)%l.QF;return this._getSpeedAtDegrees(i)*fi(this,Oi)*l.nX}_setShipSpeed(){var t;const e=(null===(t=fi(this,Pi))||void 0===t?void 0:t.getSpeedDegrees())??Array.from({length:24},(()=>fi(this,ji)/2));fi(this,Yi).range(e)}_calculateMinutesForSegment(t,e,i){let a=i,s=e,r=0;for(this._setShipSpeed();a>0;){const e=this._calculateDistanceForSection(t,s);a>e?(a-=e,r+=1):(r+=a/e,a=0),s=(l.QF+s-fi(this,Ri))%l.QF}return fi(this,$i).currentWindDegrees=s,r}_setShipName(){const t=fi(this,Pi).getShipName();fi(this,$i).shipName=t||fi(this,Ei)}_removeLabels(){const t=fi(this,Si).selectAll("#journey g.label");t.select("text").remove(),t.select("rect").remove()}_printSummary(){fi(this,Ci).print(fi(this,$i))}_printLines(){fi(this,Wi)&&fi(this,Wi).datum(fi(this,$i).segments.length>1?fi(this,$i).segments.map((t=>t.position)):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("class","svg-shadow").attr("d",fi(this,Gi))}_getTextDirection(t,e,i){return`${(0,d.Iy)(t,!0)} ⁖ F11: ${(0,v.Hu)((0,l.IK)(i.x,i.y))} / ${(0,v.Hu)((0,l.pw)(i.x,i.y))}`}_getTextDistance(t,e,i){let a=`${Math.round(t)} k ${Ki._getHumanisedDuration(e)}`;return i&&(a+=`⁖ total ${Math.round(fi(this,$i).totalDistance)} k ${Ki._getHumanisedDuration(fi(this,$i).totalMinutes)}`),a}_calculateSegmentLabel(t){const e={x:fi(this,$i).segments[t].position[0],y:fi(this,$i).segments[t].position[1]},i={x:fi(this,$i).segments[t-1].position[0],y:fi(this,$i).segments[t-1].position[1]},a=(0,d.Fq)(e,i),s=(0,l.Sp)(e,i),r=(0,l.tT)(a),n=this._calculateMinutesForSegment(a,fi(this,$i).currentWindDegrees,1e3*s);fi(this,$i).totalDistance+=s,fi(this,$i).totalMinutes+=n;const o=this._getTextDirection(r,a,e),h=this._getTextDistance(s,n,t>1);fi(this,$i).segments[t].label=`${o}|${h}`}_setSegmentLabels(t){if(t)this._calculateSegmentLabel(fi(this,$i).segments.length-1);else for(const[t]of fi(this,$i).segments.entries())t<fi(this,$i).segments.length-1&&this._calculateSegmentLabel(t+1)}_print(t){this._printLines(),this._setSegmentLabels(t),fi(this,Di).print(fi(this,$i).segments),fi(this,Si).selectAll("#journey g.labels g.label circle").call(fi(this,Mi))}_printAdditionalSegment(){this._print(!0)}_printWholeJourney(){this._resetJourneyData(),this._print(!1)}_deleteLastLeg(){fi(this,$i).segments.pop(),fi(this,$i).segments.length>0?this._printWholeJourney():(fi(this,Ci).hide(),fi(this,Si).selectAll("#journey g.labels g.label").remove(),fi(this,Wi).remove(),this._removeCompass(),this._initJourneyData())}_initJourney(){fi(this,Ci).show(),this._printSummary(),this._printCompass()}setSummaryPosition(t,e){fi(this,Ci).setPosition(t,e)}plotCourse(t,e){fi(this,$i).segments[0].position[0]>0?(fi(this,$i).segments.push({position:[t,e],label:"",index:fi(this,$i).segments.length}),this._printAdditionalSegment()):(fi(this,$i).segments[0]={position:[t,e],label:"",index:0},this._initJourney())}}var Xi=i(2700),Ui=i(6651),Ji=i(1739),Qi=i(9488);function ta(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ia(t,e,"get"))}function ea(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ia(t,e,"set"),i),i}function ia(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}lt().extend(dt());var aa=new WeakMap,sa=new WeakMap,ra=new WeakMap,na=new WeakMap,oa=new WeakMap,la=new WeakMap,ha=new WeakMap,da=new WeakMap,ca=new WeakMap,pa=new WeakMap,ua=new WeakMap,wa=new WeakMap,va=new WeakMap,ma=new WeakMap,ga=new WeakMap,_a=new WeakMap,fa=new WeakMap,ba=new WeakMap,ya=new WeakMap,ka=new WeakMap,Ma=new WeakMap,Sa=new WeakMap,xa=new WeakMap,Wa=new WeakMap,Ta=new WeakMap,$a=new WeakMap,Da=new WeakMap,Pa=new WeakMap,Ca=new WeakMap,Ia=new WeakMap,La=new WeakMap,Na=new WeakMap,Aa=new WeakMap,Za=new WeakMap,Ba=new WeakMap,Ea=new WeakMap;class ja{constructor(t,e,i){this.map=t,this.serverId=e,this.coord=i,aa.set(this,{writable:!0,value:void 0}),sa.set(this,{writable:!0,value:void 0}),ra.set(this,{writable:!0,value:"Power map"}),na.set(this,{writable:!0,value:void 0}),oa.set(this,{writable:!0,value:0}),la.set(this,{writable:!0,value:{}}),ha.set(this,{writable:!0,value:{}}),da.set(this,{writable:!0,value:0}),ca.set(this,{writable:!0,value:-1}),pa.set(this,{writable:!0,value:0}),ua.set(this,{writable:!0,value:0}),wa.set(this,{writable:!0,value:{}}),va.set(this,{writable:!0,value:0}),ma.set(this,{writable:!0,value:{}}),ga.set(this,{writable:!0,value:{}}),_a.set(this,{writable:!0,value:{}}),fa.set(this,{writable:!0,value:0}),ba.set(this,{writable:!0,value:0}),ya.set(this,{writable:!0,value:{}}),ka.set(this,{writable:!0,value:{}}),Ma.set(this,{writable:!0,value:0}),Sa.set(this,{writable:!0,value:new Map}),xa.set(this,{writable:!0,value:[]}),Wa.set(this,{writable:!0,value:{}}),Ta.set(this,{writable:!0,value:{}}),$a.set(this,{writable:!0,value:{}}),Da.set(this,{writable:!0,value:{}}),Pa.set(this,{writable:!0,value:0}),Ca.set(this,{writable:!0,value:!1}),Ia.set(this,{writable:!0,value:{}}),La.set(this,{writable:!0,value:void 0}),Na.set(this,{writable:!0,value:void 0}),Aa.set(this,{writable:!0,value:void 0}),Za.set(this,{writable:!0,value:200}),Ba.set(this,{writable:!0,value:200}),Ea.set(this,{writable:!0,value:2}),ea(this,aa,e),ea(this,La,t),ea(this,sa,`show-${(0,o.MF)(ta(this,ra))}`),ea(this,na,`menu-${ta(this,sa)}`),ea(this,Aa,i),ea(this,Na,(0,at.Z)().domain(vt.nU.map((t=>t.id))).range(vt.nU.map((t=>t.colours[0])))),this._setupListener()}_setupData(t){ea(this,$a,t.power),ea(this,da,ta(this,$a).length-1),ea(this,ka,(0,a.Z)("g#map"))}async _loadData(){const t=[{fileName:`${this.serverId}-power.json`,name:"power"}],e={};return ea(this,Ta,(await i.e(462).then(i.t.bind(i,9131,19))).default),await(0,o.EZ)(t,e),e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}async _menuClicked(){(0,n.KS)("Tools",ta(this,ra)),await this._loadAndSetupData(),(0,o.dM)(),this._mapElementsOff(),this._initialMapZoom(),this._initVoronoi(),this._initCanvas(),this._drawPowerMap()}_setupListener(){var t;null===(t=document.querySelector(`#${ta(this,na)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showMapElements(t){ta(this,ka).classed("d-none",!t),(0,a.Z)("main div.overlay").classed("d-none",!t)}_mapElementsOff(){this._showMapElements(!1)}_mapElementsOn(){this._showMapElements(!0)}_drawEnd(){(0,o.V4)(),this._mapElementsOn()}async _setPattern(){const t=Object.values(o.eM);try{const e=await(0,Qi.Z)(t);for(const[t,i]of e.entries())ta(this,xa)[t]=ta(this,la).createPattern(i,"repeat")}catch(t){console.error("One or more images have failed to load :("),console.error(t.errored),console.info("But these loaded fine:"),console.info(t.loaded)}}_drawDate(t){const e=lt()(t).format("D MMMM YYYY");ta(this,ha).text(e)}_drawMap(t,e,i){for(const[t,e]of i.entries())ta(this,la).beginPath(),ta(this,Ia).renderCell(t,ta(this,la)),ta(this,la).fillStyle=ta(this,xa)[e]??"#000",ta(this,la).fill();this._drawDate(e)}async _drawLoop(){let t,e;for(;!ta(this,Ca)&&ta(this,ca)<ta(this,da);){ea(this,ca,ta(this,ca)+1),this._setRangeValue(),t=ta(this,$a)[ta(this,ca)][0],e=ta(this,$a)[ta(this,ca)][1];const i=(0,Ji.HT)((a=>{this._drawMap(ta(this,ca),t,e),(a>ta(this,Ba)||ta(this,Ca))&&i.stop()}));this._drawNationLegend(e),await(0,vt._v)(1.1*ta(this,Ba))}this._drawEnd()}_drawPowerMap(){this._drawLoop()}_initVoronoi(){const t=new Set([96,112,150,179,214,231,286,343,366]),e=ta(this,Ta).filter((e=>!t.has(e.id))).map((t=>t.coordinates)),i=Ui.Z.from(e);ea(this,Ma,(0,tt.Z)(e,(t=>t[1]))??ta(this,Aa).max);const a=[ta(this,Aa).min,ta(this,Aa).min,ta(this,Aa).max,ta(this,Ma)];ea(this,Ia,i.voronoi(a))}_initLegend(t){ea(this,wa,(0,a.Z)("#na-map div").append("div").style("position","relative").style("width",`${t.width}px`).style("top",`-${t.top}px`).style("left",`${t.left}px`).attr("class","d-flex flex-column")),this._initController(),this._initNationLegend(t)}_initNationLegend(t){ea(this,fa,Math.floor(40*l.L9)),ea(this,ba,Math.floor(l.L9)),ea(this,pa,Math.floor(5*l.L9));const{width:e}=t,i=75+2*ta(this,pa),a=vt.nU.length*i-2*ta(this,pa);ea(this,Pa,Math.ceil(a/e)),ea(this,oa,Math.ceil(vt.nU.length/ta(this,Pa))),ea(this,ua,Math.ceil(e/ta(this,oa)-2*ta(this,pa)));const s=ta(this,wa).append("div");ea(this,_a,s.append("div")),ea(this,ga,s.append("div"))}_getTopPosition(t){let e=-1===t?-ta(this,fa):Math.floor(t/ta(this,oa))*(10*ta(this,ba)+ta(this,fa));return e+=16+ta(this,va),`${e}px`}_getLeftPosition(t){return`${-1===t?-ta(this,ua):Math.floor(t%ta(this,oa)*(ta(this,pa)+ta(this,ua)))}px`}_resetOldIndex(){ea(this,Sa,new Map)}_drawNationLegend(t){const e=(0,Xi.Q3)(t,(t=>t.length),(t=>t)).sort(((t,e)=>e[1]-t[1]||t[0]-e[0])),i=t.length;ta(this,_a).selectAll("svg.legend").data(e,((t,e)=>String(e).padStart(2,"0")+String(t[0]).padStart(2,"0"))).join((t=>{const e=t.append("svg").attr("class","legend").attr("width",ta(this,ua)).attr("height",ta(this,fa)+ta(this,ba)).style("position","absolute").style("top",(t=>this._getTopPosition(ta(this,Sa).get(t[0])??-1))).style("left",(t=>this._getLeftPosition(ta(this,Sa).get(t[0])??-1))).transition().duration(ta(this,Ba)).style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e))).selection();return e.append("rect").attr("class","nation-header").attr("width",ta(this,ua)).attr("height",Math.floor(ta(this,fa)/2)).style("fill",(t=>ta(this,Na).call(this,t[0]))),e.append("text").attr("class","nation-name").attr("x",Math.floor(ta(this,pa)/2)).attr("y","25%").html((t=>`${(0,vt.dx)(t[0]).sortName}`)).style("fill",(t=>(0,mt.IF)(ta(this,Na).call(this,t[0])))),e.append("rect").attr("class","opacity-low").attr("y",Math.floor(ta(this,fa)/2+ta(this,ba))).attr("width","100%").attr("height",Math.floor(ta(this,fa)/2)).style("fill",(t=>ta(this,Na).call(this,t[0]))),e.append("rect").attr("class","value").attr("y",Math.floor(ta(this,fa)/2+ta(this,ba))).attr("height",Math.floor(ta(this,fa)/2)).attr("width",(t=>ta(this,ua)*(t[1]/i))).style("fill",(t=>ta(this,Na).call(this,t[0]))),e.append("text").attr("class","value").attr("x",ta(this,ua)-ta(this,pa)).attr("y","75%").style("text-anchor","end").html((t=>(0,v.Dw)(t[1],!0))),e}),(t=>(t.select("rect.value").attr("width",(t=>ta(this,ua)*(t[1]/i))).style("fill",(t=>ta(this,Na).call(this,t[0]))),t.select("text.value").html((t=>(0,v.Dw)(t[1],!0))),t))),ta(this,ga).selectAll("svg.index").data(e,((t,e)=>e)).join((t=>{const e=t.append("svg").attr("class","index").attr("width",ta(this,ua)).attr("height",ta(this,fa)+ta(this,ba)).style("position","absolute").style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e)));return e.append("text").attr("x",ta(this,ua)/2).attr("y",(ta(this,fa)+ta(this,ba))/2).attr("fill",o.L$).attr("opacity",0).attr("text-anchor","middle").attr("dominant-baseline","mathematical").attr("font-variant","normal").attr("font-size",`${ta(this,fa)}px`).text(((t,e)=>e+1)).transition().duration(ta(this,Ba)).attr("opacity",.3).selection(),e}),(t=>t),(t=>t.attr("opacity",.3).transition().duration(ta(this,Ba)).attr("opacity",0).remove().selection())),this._resetOldIndex();for(const[t,i]of e.entries())ta(this,Sa).set(i[0],t)}_getRangeValue(){return ta(this,Da).property("value")}_setRangeValue(){ta(this,Da).property("value",ta(this,ca))}_updateRangeValue(t=!1){ea(this,ca,Number.parseFloat(this._getRangeValue())),this._updateController(t)}_initRange(t){const e=`range-${ta(this,sa)}`,i=t.append("div").attr("class","row col-md-7 mb-0");ea(this,Da,i.append("div").attr("class","col-md-5").append("input").attr("id",e).attr("type","range").attr("class","form-range px-md-2").attr("style","height:100%").attr("min","0").attr("max",String(ta(this,da)))),i.append("div").attr("class","col-md-1"),ea(this,ha,i.append("label").attr("for",e).attr("class","col-md-6 col-form-label").attr("style","font-size:120%").attr("title","Date").text("Start"));let a=!1;ta(this,Da).on("change",(()=>{this._updateRangeValue()})).on("mousedown",(()=>{a=!0,ea(this,Ca,!0),this._togglePlayButton()})).on("mousemove",(()=>{a&&this._updateRangeValue(!0)})).on("mouseup",(()=>{a=!1}))}_getYear(t){return lt()(ta(this,$a)[t][0]).year()}_togglePlayButton(){ta(this,Wa).classed("icon-pause",!ta(this,Ca)).classed("icon-play",ta(this,Ca))}_initialMapZoom(){ta(this,La).zoomAndPan(ta(this,Aa).max/2,ta(this,Aa).max/2,!0)}_updateController(t=!1){const e=ta(this,$a)[ta(this,ca)][0],i=ta(this,$a)[ta(this,ca)][1];this._setRangeValue(),this._drawDate(e),this._adjustControllerHeight(),ea(this,Ca,!0),this._togglePlayButton(),t||(this._resetOldIndex(),this._drawMap(ta(this,ca),e,i),this._drawNationLegend(i))}_initButtons(t){const e=`menu-${ta(this,sa)}`,i=(t,i)=>s.append("button").attr("type","button").attr("id",`${e}-${t}`).attr("class","btn btn-default icon-button p-0").attr("title",i).append("i").attr("class",`icon icon-large icon-${t}`),a=t.append("div").attr("class","btn-toolbar col-md-4").attr("role","toolbar");let s=a.append("div").attr("class","btn-group").attr("role","group");const r=i("start","Start"),n=i("back","Year back");s=a.append("div").attr("class","btn-group").attr("role","group"),ea(this,Wa,i("pause","Pause")),s=a.append("div").attr("class","btn-group me-3").attr("role","group");const o=i("forward","Year forward"),l=i("end","End");r.on("click",(()=>{ea(this,ca,0),this._updateController()})),n.on("click",(()=>{let t=ta(this,ca);const e=this._getYear(t);let i=e;for(;t>0&&i===e;t--)i=this._getYear(t);ea(this,ca,t+1),this._updateController()})),ta(this,Wa).on("click",(()=>{ea(this,Ca,!ta(this,Ca)),this._togglePlayButton(),ta(this,Ca)||this._drawLoop()})),o.on("click",(()=>{let t=ta(this,ca);const e=this._getYear(t);let i=e;for(;t<ta(this,da)&&i===e;t++)i=this._getYear(t);ea(this,ca,t-1),this._updateController()})),l.on("click",(()=>{ea(this,ca,ta(this,da)),this._updateController()})),s=a.append("div").attr("class","btn-group").attr("role","group");const h=i("slower","Slower"),d=i("normal","Normal speed"),c=i("faster","Faster");h.on("click",(()=>{ea(this,Ba,ta(this,Ba)*ta(this,Ea))})),d.on("click",(()=>{ea(this,Ba,ta(this,Za))})),c.on("click",(()=>{ea(this,Ba,Math.max(10,ta(this,Ba)/ta(this,Ea)))})),s=t.append("div").attr("class","btn-group col-md-1").attr("role","group");i("close","Close").on("click",(()=>{this._drawEnd(),ta(this,ya).remove(),this._initialMapZoom()}))}_adjustControllerHeight(){ea(this,va,(0,o.Uy)(ta(this,ma))),ta(this,wa).selectAll("svg.legend").style("top",((t,e)=>this._getTopPosition(e))),ta(this,wa).selectAll("svg.index").style("top",((t,e)=>this._getTopPosition(e)))}_initController(){const t=ta(this,wa).append("div").style("background-color",o.L$).attr("class","p-2");ea(this,ma,t.node());const e=t.append("form").append("div").attr("class","row input-group align-items-center"),i=new ResizeObserver((()=>{this._adjustControllerHeight()}));this._initRange(e),this._initButtons(e),ea(this,va,(0,o.Uy)(ta(this,ma))),i.observe(ta(this,ma))}_getTopAlignedTransform(t){const{a:e,e:i}=t.transform.baseVal.consolidate().matrix;return r.CR.scale(e).translate(i/e,0)}async _initCanvas(){const t=(0,a.Z)("#na-map svg g.map-tiles"),e=this._getTopAlignedTransform(ta(this,ka).node()),i=this._getTopAlignedTransform(t.node());ta(this,ka).attr("transform",e.toString()),t.attr("transform",i.toString());const s=(0,a.Z)("#na-map svg"),r=s.style("height"),n=s.style("width");ea(this,ya,(0,a.Z)("#na-map").append("div").style("position","relative").style("top",`-${r}`).style("height","100%").style("opacity",.7));const l=ta(this,ya).append("canvas").node();l.style.height=r,l.style.width=n,l.height=Math.floor(2*Number.parseFloat(r)),l.width=Math.floor(2*Number.parseFloat(n)),ea(this,la,(0,o.kU)(l)),ta(this,la).translate(2*e.x,2*e.y),ta(this,la).scale(2*e.k,2*e.k);const h=(0,o.mx)(t.node()),d={top:Math.floor(this.map.height-ta(this,Ma)*e.k+e.y),left:e.x,width:h};this._initLegend(d),await this._setPattern()}}var Fa=i(6607),Ra=i.n(Fa),za=i(29);function Va(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,qa(t,e,"get"))}function Ga(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,qa(t,e,"set"),i),i}function qa(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ha=new WeakMap,Oa=new WeakMap,Ya=new WeakMap;class Ka{constructor(t){Ha.set(this,{writable:!0,value:{}}),Oa.set(this,{writable:!0,value:void 0}),Ya.set(this,{writable:!0,value:"port-select-pb-time"}),Ga(this,Oa,t),this._setupSelect(),this._setupListener()}_getOptions(){return`${[...new Set(Va(this,Oa).portData.filter((t=>t.capturable)).map((t=>t.portBattleStartTime)).sort(((t,e)=>t-e)))].map((t=>`<option value="${t}">${(0,o.Db)(t)}</option>`)).join("")}`}_setupSelect(){Ga(this,Ha,new za.Z(Va(this,Ya),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},this._getOptions()))}_selected(){const t=String(Va(this,Ha).getValues());Va(this,Oa).portData=Va(this,Oa).portDataDefault.filter((e=>e.capturable&&e.portBattleStartTime===Number(t))),Va(this,Oa).showRadius="",Va(this,Oa).update()}_setupListener(){Va(this,Ha).select$.on("change",(async()=>{(0,n.KS)("Menu",Va(this,Ya)),this._selected()}))}}function Xa(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ja(t,e,"get"))}function Ua(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ja(t,e,"set"),i),i}function Ja(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Qa=new WeakMap,ts=new WeakMap,es=new WeakMap,is=new WeakMap;class as{constructor(t){Qa.set(this,{writable:!0,value:"Show goods’ relations"}),ts.set(this,{writable:!0,value:void 0}),es.set(this,{writable:!0,value:void 0}),is.set(this,{writable:!0,value:{}}),Ua(this,es,t),Ua(this,ts,`port-select-${(0,o.MF)(Xa(this,Qa))}`),this._setupSelect(),this._setupListener()}_getOptions(){const t=new Map,e=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const a of Xa(this,es).portDataDefault)for(const s of e){const e=a[s];if(e)for(const a of e){var i;t.set(a,(null===(i=Xa(this,es).tradeItem.get(a))||void 0===i?void 0:i.name)??"")}}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){Ua(this,is,new za.Z(Xa(this,ts),void 0,{},""))}_setupListener(){Xa(this,is).select$.one("show.bs.select",(()=>{Xa(this,is).setOptions(this._getOptions()),Xa(this,is).reset()})),Xa(this,is).select$.on("change",(()=>{(0,n.KS)("Menu",Xa(this,Qa)),this._selectSelected()}))}_selectSelected(){const t=Number(Xa(this,is).getValues()),e=JSON.parse(JSON.stringify(Xa(this,es).portDataDefault.filter((e=>{var i,a,s;return(null===(i=e.dropsTrading)||void 0===i?void 0:i.includes(t))||(null===(a=e.dropsNonTrading)||void 0===a?void 0:a.includes(t))||(null===(s=e.producesNonTrading)||void 0===s?void 0:s.includes(t))})))).map((t=>(t.isSource=!0,t))),i=JSON.parse(JSON.stringify(Xa(this,es).portDataDefault.filter((e=>{var i;return null===(i=e.consumesTrading)||void 0===i?void 0:i.includes(t)})))).map((t=>(t.isSource=!1,t)));Xa(this,es).setShowRadiusSetting("off"),Xa(this,es).portData=[...e,...i],Xa(this,es).showRadius="currentGood",Xa(this,es).update()}}function ss(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,ns(t,e,"get"))}function rs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,ns(t,e,"set"),i),i}function ns(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var os=new WeakMap,ls=new WeakMap,hs=new WeakMap,ds=new WeakMap,cs=new WeakMap,ps=new WeakMap,us=new WeakMap,ws=new WeakMap;class vs{constructor(t){os.set(this,{writable:!0,value:"Show trade relations"}),ls.set(this,{writable:!0,value:void 0}),hs.set(this,{writable:!0,value:new Map}),ds.set(this,{writable:!0,value:{}}),cs.set(this,{writable:!0,value:{}}),ps.set(this,{writable:!0,value:void 0}),us.set(this,{writable:!0,value:void 0}),ws.set(this,{writable:!0,value:new vt.y0}),rs(this,us,t),rs(this,ps,ss(this,us).portData.length),rs(this,ls,`port-select-${(0,o.MF)(ss(this,os))}`),this._setupSelect(),this._setupListener()}_getOptions(){return`${ss(this,us).portDataDefault.map((t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}))).sort((0,vt.MR)(["name"])).map((t=>`<option data-icon="flag-icon-${t.nation} flag-icon-small" value="${t.coord.toString()}/${t.id}">${t.name}</option>`)).join("")}`}_setupSelect(){rs(this,ds,new za.Z(ss(this,ls),void 0,{},""))}_setupListener(){ss(this,ds).select$.one("show.bs.select",(()=>{ss(this,ds).setOptions(this._getOptions()),ss(this,ds).reset()})),ss(this,ds).select$.one("change",(async()=>{await this._loadData()})),ss(this,ds).select$.on("change",(()=>{(0,n.KS)("Menu",ss(this,os)),this._selectSelected()}))}async _loadData(){const t=(await i.e(971).then(i.t.bind(i,6720,19))).default;rs(this,hs,new Map(t.map((([t,e,i])=>[t*ss(this,ps)+e,i]))))}_setTradePortPartners(){rs(this,cs,ss(this,us).portDataDefault.find((t=>t.id===ss(this,us).tradePortId))??[]),ss(this,cs)&&this._setTradeRelations()}_getSailingDistance(t,e){return t<e?ss(this,hs).get(t*ss(this,ps)+e)??0:ss(this,hs).get(e*ss(this,ps)+t)??0}_getBuyPrice(t){var e;return(null===(e=ss(this,us).tradeItem.get(t))||void 0===e?void 0:e.buyPrice)??0}_getSellPrice(t){var e;return(null===(e=ss(this,us).tradeItem.get(t))||void 0===e?void 0:e.sellPrice)??0}_getWeight(t){var e;return(null===(e=ss(this,us).tradeItem.get(t))||void 0===e?void 0:e.weight)??0}_getDistanceFactor(t){var e;return(null===(e=ss(this,us).tradeItem.get(t))||void 0===e?void 0:e.distanceFactor)??0}_getPortTax(t){var e;return(null===(e=ss(this,us).portDataDefault.find((e=>e.id===t)))||void 0===e?void 0:e.portTax)??0}_getCoordinates(t){const e=ss(this,us).portDataDefault.find((e=>e.id===t));return{x:(null==e?void 0:e.coordinates[0])??0,y:(null==e?void 0:e.coordinates[1])??0}}_getPlanarDistance(t,e){const i=this._getCoordinates(t),a=this._getCoordinates(e);return(0,l.Sp)(i,a)}_findClosestSourcePort(t,e){let i=Number.POSITIVE_INFINITY;const a=new Set(ss(this,us).portDataDefault.filter((t=>{var i,a;return(null===(i=t.dropsTrading)||void 0===i?void 0:i.includes(e))??(null===(a=t.dropsNonTrading)||void 0===a?void 0:a.includes(e))})).map((t=>t.id)));for(const e of a)i=Math.min(i,this._getPlanarDistance(e,t.id));return i}_calculateSellProfit(t,e,i){const a=this._findClosestSourcePort(e,i),s=this._getPortTax(t.id),r=this._getPortTax(e.id);let n=this._getBuyPrice(i),o=this._getSellPrice(i)+a*n*this._getDistanceFactor(i)/1050;n*=1+s,o/=1+r;const l=Math.round(o-n);return{profit:l,profitPerTon:Math.round(l/this._getWeight(i))}}_getProfit(t,e,i){const a=[e.id,i];return ss(this,ws).has(a)||ss(this,ws).set(a,this._calculateSellProfit(t,e,i)),ss(this,ws).get(a)}_getGoodsToBuyInTradePort(t){var e,i;const a=new Set(null===(e=ss(this,cs).dropsTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.consumesTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=ss(this,us).tradeItem.get(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(ss(this,cs),t,e)}})))??[]}_getGoodsToSellInTradePort(t){var e,i;const a=new Set(null===(e=ss(this,cs).consumesTrading)||void 0===e?void 0:e.map((t=>t)))??[];return(null===(i=t.dropsTrading)||void 0===i?void 0:i.filter((t=>a.has(t))).map((e=>{var i;return{name:(null===(i=ss(this,us).tradeItem.get(e))||void 0===i?void 0:i.name)??"",profit:this._getProfit(t,ss(this,cs),e)}})))??[]}_setTradeRelations(){ss(this,ws).clear(),ss(this,us).portData=ss(this,us).portDataDefault.map((t=>(t.sailingDistanceToTradePort=this._getSailingDistance(t.id,ss(this,cs).id),t.goodsToBuyInTradePort=this._getGoodsToBuyInTradePort(t),t.buyInTradePort=t.goodsToBuyInTradePort.length>0,t.goodsToSellInTradePort=this._getGoodsToSellInTradePort(t),t.sellInTradePort=t.goodsToSellInTradePort.length>0,t))).filter((t=>t.id===ss(this,us).tradePortId||t.sellInTradePort||t.buyInTradePort))}_selectSelected(){const t=String(ss(this,ds).getValues()),[e,i]=t.split("/"),[a,s]=e.split(",");ss(this,us).currentPort={id:Number(i),coord:{x:Number(a),y:Number(s)}},ss(this,us).tradePortId=Number(i),this._setTradePortPartners(),ss(this,us).showRadius="tradePorts",ss(this,us).update()}}function ms(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,_s(t,e,"get"))}function gs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,_s(t,e,"set"),i),i}function _s(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var fs=new WeakMap,bs=new WeakMap,ys=new WeakMap,ks=new WeakMap,Ms=new WeakMap,Ss=new WeakMap;class xs{constructor(t){var e,i,a;fs.set(this,{writable:!0,value:{}}),bs.set(this,{writable:!0,value:{}}),ys.set(this,{writable:!0,value:{}}),ks.set(this,{writable:!0,value:void 0}),Ms.set(this,{writable:!0,value:"port-select-clan"}),Ss.set(this,{writable:!0,value:"port-select-nation"}),a=(t=!0)=>`${vt.nU.filter((e=>!(!t&&("FT"===e.short||"NT"===e.short)))).sort((0,vt.MR)(["name"])).map((t=>`<option value="${t.short}">${t.name}</option>`)).join("")}`,(i="_getNationOptions")in(e=this)?Object.defineProperty(e,i,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[i]=a,gs(this,ks,t),this._setupSelects(),this._setupListener()}_capsOn(){ms(this,bs).classList.add("caps")}_capsOff(){ms(this,bs).classList.remove("caps")}_setupNationSelect(){const t=this._getNationOptions(!0);gs(this,ys,new za.Z(ms(this,Ss),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},t))}_getClanOptions(){const t=new Set;for(const e of ms(this,ks).portData.filter((t=>t.capturer)))t.add(e.capturer);return t.size>0?`${[...t].sort(vt.I4).map((t=>`<option value="${t}" class="caps">${t}</option>`)).join("")}`:""}_setupClanSelect(){var t;const e=this._getClanOptions();gs(this,fs,new za.Z(ms(this,Ms),void 0,{dropupAuto:!1,liveSearch:!1,virtualScroll:!0},e)),gs(this,bs,null===(t=ms(this,fs).select$.get(0).parentNode)||void 0===t?void 0:t.querySelector("button"))}_setupSelects(){this._setupNationSelect(),this._setupClanSelect()}_clanSelected(){const t=String(ms(this,fs).getValues());this._capsOn(),t&&(ms(this,ks).portData=ms(this,ks).portDataDefault.filter((e=>e.capturer===t))),ms(this,ks).showRadius="",ms(this,ks).update()}_clanRefresh(){const t=this._getClanOptions();this._capsOff(),ms(this,fs).setOptions(t),ms(this,fs).reset(),""===t?ms(this,fs).disable():ms(this,fs).enable()}_nationSelected(){const t=String(ms(this,ys).getValues());(0,vt.mP)(t)&&(ms(this,ks).portData=ms(this,ks).portDataDefault.filter((e=>e.nation===t)),ms(this,ks).showRadius="",ms(this,ks).update())}_setupListener(){ms(this,fs).select$.on("change",(async()=>{(0,n.KS)("Menu",ms(this,Ss)),this._clanSelected()})),ms(this,ys).select$.on("change",(async()=>{(0,n.KS)("Menu",ms(this,Ms)),this._nationSelected(),this._clanRefresh()}))}refreshSelect(){ms(this,ys).reset(),this._clanRefresh()}}function Ws(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,$s(t,e,"get"))}function Ts(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,$s(t,e,"set"),i),i}function $s(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}lt().extend(dt()),lt().extend(Ra()),lt().extend(wt()),lt().locale("en-gb");var Ds=new WeakMap,Ps=new WeakMap;class Cs{constructor(t){Ds.set(this,{writable:!0,value:void 0}),Ps.set(this,{writable:!0,value:void 0}),Ts(this,Ps,t),new vs(t),new as(t),Ts(this,Ds,new xs(t)),new Ka(t),this._setupListener()}_setupListener(){var t,e,i,a,s,r,n,l;null===(t=document.querySelector("#menu-prop-deep"))||void 0===t||t.addEventListener("click",(()=>{this._depthSelected("deep")})),null===(e=document.querySelector("#menu-prop-shallow"))||void 0===e||e.addEventListener("click",(()=>{this._depthSelected("shallow")})),null===(i=document.querySelector("#menu-prop-all"))||void 0===i||i.addEventListener("click",(()=>{this._allSelected()})),null===(a=document.querySelector("#menu-prop-non-capturable"))||void 0===a||a.addEventListener("click",(()=>{this._nonCapSelected()})),null===(s=document.querySelector("#menu-prop-today"))||void 0===s||s.addEventListener("click",(()=>{this._capturedToday()})),null===(r=document.querySelector("#menu-prop-yesterday"))||void 0===r||r.addEventListener("click",(()=>{this._capturedYesterday()})),null===(n=document.querySelector("#menu-prop-this-week"))||void 0===n||n.addEventListener("click",(()=>{this._capturedThisWeek()})),null===(l=document.querySelector("#menu-prop-last-week"))||void 0===l||l.addEventListener("click",(()=>{this._capturedLastWeek()})),(0,o.ye)("selectPortNavbar")}_depthSelected(t){const e=Ws(this,Ps).portDataDefault.filter((e=>"shallow"===t?e.shallow:!e.shallow));Ws(this,Ps).portData=e,Ws(this,Ps).showRadius="",Ws(this,Ps).update()}_allSelected(){const t=Ws(this,Ps).portDataDefault.filter((t=>t.availableForAll));Ws(this,Ps).portData=t,Ws(this,Ps).showRadius="",Ws(this,Ps).update()}_nonCapSelected(){const t=Ws(this,Ps).portDataDefault.filter((t=>!t.capturable));Ws(this,Ps).portData=t,Ws(this,Ps).showRadius="",Ws(this,Ps).update()}_filterCaptured(t,e){const i=Ws(this,Ps).portDataDefault.filter((i=>lt()(i.captured,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]")));Ws(this,Ps).portData=i,Ws(this,Ps).showRadius="",Ws(this,Ps).update()}_capturedToday(){const t=lt().utc();let e=lt()().utc().hour(h.WF).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,lt().utc(e).add(1,"day"))}_capturedYesterday(){const t=lt().utc();let e=lt()().utc().hour(h.WF).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,lt().utc(e).add(1,"day"))}_capturedThisWeek(){const t=lt()().utc().startOf("week"),e=t.utc().hour(h.WF),i=lt()(t).utc().add(7,"day").hour(h.WF);this._filterCaptured(e,i)}_capturedLastWeek(){const t=lt()().utc().startOf("week"),e=lt()(t).utc().subtract(7,"day").hour(h.WF),i=t.utc().hour(h.WF);this._filterCaptured(e,i)}clearMap(){Ws(this,Ds).refreshSelect()}}function Is(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Ns(t,e,"get"))}function Ls(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Ns(t,e,"set"),i),i}function Ns(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var As=new WeakMap,Zs=new WeakMap,Bs=new WeakMap,Es=new WeakMap,js=new WeakMap,Fs=new WeakMap,Rs=new WeakMap,zs=new WeakMap;class Vs extends p.Z{constructor(t){super(t,"sm"),As.set(this,{writable:!0,value:void 0}),Zs.set(this,{writable:!0,value:void 0}),Bs.set(this,{writable:!0,value:void 0}),Es.set(this,{writable:!0,value:void 0}),js.set(this,{writable:!0,value:void 0}),Fs.set(this,{writable:!0,value:{}}),Rs.set(this,{writable:!0,value:void 0}),zs.set(this,{writable:!0,value:void 0}),Ls(this,Zs,`${this.baseId}-form`),Ls(this,Es,`${this.baseId}-input-x`),Ls(this,js,`${this.baseId}-input-y`),Ls(this,As,`${this.baseId}-copy-coord`),Ls(this,Bs,`${this.baseId}-submit`),this._init()}_init(){var t,e;this._injectModal(),Ls(this,Rs,document.querySelector(`#${Is(this,Es)}`)),Ls(this,zs,document.querySelector(`#${Is(this,js)}`)),null===(t=document.querySelector(`#${this.id}`))||void 0===t||t.addEventListener("keydown",(t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)})),null===(e=document.querySelector(`#${Is(this,As)}`))||void 0===e||e.addEventListener("click",(t=>{this._copyCoordClicked(t)}))}_injectModal(){const t=super.bodySel;super.removeFooter();const e=t.append("form").attr("id",Is(this,Zs)).attr("role","form");Ls(this,Fs,e.node());const i=e.append("div").attr("class","form-floating");i.append("input").attr("class","form-control").attr("id",Is(this,Es)).attr("type","number").attr("required","").attr("placeholder","X coordinate in k").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),i.append("label").attr("for",Is(this,Es)).text("X coordinate in k");const a=e.append("div").attr("class","form-floating");a.append("input").attr("class","form-control").attr("id",Is(this,js)).attr("type","number").attr("required","").attr("placeholder","Z coordinate in k").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),a.append("label").attr("for",Is(this,js)).text("Z coordinate in k"),e.append("div").attr("class","form-text mt-1 mb-3").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const s=e.append("div").classed("float-end",!0).attr("role","group");s.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",Is(this,As)).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),s.append("button").attr("class","btn").attr("id",Is(this,Bs)).attr("title","Go to").attr("type","submit").text("Go to")}_getInputValue(t){return null!=t&&t.value?Number(t.value):Number.POSITIVE_INFINITY}getXCoord(){return this._getInputValue(Is(this,Rs))}getZCoord(){return this._getInputValue(Is(this,zs))}_copyCoordClicked(t){(0,n.KS)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this.getXCoord(),i=this.getZCoord();(0,d.A1)(e,i,super.getModalNode())}showModal(){var t,e;super.show(),null===(t=Is(this,Rs))||void 0===t||t.focus(),null===(e=Is(this,Rs))||void 0===e||e.select()}get formSel(){return Is(this,Fs)}}function Gs(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Hs(t,e,"get"))}function qs(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Hs(t,e,"set"),i),i}function Hs(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}lt().extend(dt()),lt().extend(wt());var Os=new WeakMap,Ys=new WeakMap,Ks=new WeakMap,Xs=new WeakMap,Us=new WeakMap,Js=new WeakMap,Qs=new WeakMap;class tr{constructor(t,e){Os.set(this,{writable:!0,value:void 0}),Ys.set(this,{writable:!0,value:"Go to F11"}),Ks.set(this,{writable:!0,value:void 0}),Xs.set(this,{writable:!0,value:void 0}),Us.set(this,{writable:!0,value:void 0}),Js.set(this,{writable:!0,value:{}}),Qs.set(this,{writable:!0,value:void 0}),qs(this,Xs,t),qs(this,Ks,e),qs(this,Os,(0,o.MF)(Gs(this,Ys))),qs(this,Us,`menu-${Gs(this,Os)}`),this._setupSvg(),this._setupListener()}_setupSvg(){qs(this,Js,(0,a.Z)("#map").append("g").attr("data-ui-component","f11"))}_menuClicked(){(0,n.KS)("Menu",Gs(this,Ys)),Gs(this,Qs)?Gs(this,Qs).showModal():(qs(this,Qs,new Vs(Gs(this,Ys))),Gs(this,Qs).formSel.addEventListener("submit",(t=>{Gs(this,Qs).hide(),t.preventDefault(),this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${Gs(this,Us)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()})),window.addEventListener("keydown",(t=>{"F11"===t.code&&t.shiftKey&&this._menuClicked()}))}_useUserInput(){const t=-1e3*Gs(this,Qs).getXCoord(),e=-1e3*Gs(this,Qs).getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_printF11Coord(t,e,i,a){var s,r;let n=10;const o=Gs(this,Js).append("g").attr("transform",`translate(${t},${e})`).attr("class","svg-background-dark fill-primary-light"),l=o.append("rect"),h=o.append("rect");o.append("circle").attr("r",n),n*=1.6;const d=o.append("text").attr("dx",-n+"px").attr("dy",-n/2-2+"px").attr("class","text-end").text((0,v.Hu)(i)),c=o.append("text").attr("dx",-n+"px").attr("dy",n/2+2+"px").attr("class","text-end").text((0,v.Hu)(a)),p=(null===(s=d.node())||void 0===s?void 0:s.getBBox())??{},u=(null===(r=c.node())||void 0===r?void 0:r.getBBox())??{},w=lt()().utc(),m=lt()(),g=o.append("text").attr("dx",`${n}px`).attr("dy",-n/2-2+"px").attr("class","f11-time").text(w.format("H.mm")),_=o.append("text").attr("dx",`${n}px`).attr("dy",n/2+2+"px").attr("class","f11-time").text(`(${m.format("H.mm")} local)`),f=g.node().getBBox()??{},b=_.node().getBBox()??{},y=p&&u?1.2*Math.round(p.height+u.height):0,k=p&&u?Math.round(Math.max(p.width,u.width)+5):0,M=1.2*Math.round(f.height+b.height),S=f&&b?Math.round(Math.max(f.width,b.width)+5):0,x=Math.max(y,M);l.attr("x",-k-n).attr("y",-x/2).attr("height",x).attr("width",k+n),h.attr("x",0).attr("y",-x/2).attr("height",x).attr("width",S+n)}_goToF11(t,e){const i=Math.floor((0,l._i)(t,e)),a=Math.floor((0,l.UY)(t,e));(0,l.vX)(i,Gs(this,Ks).min,Gs(this,Ks).max,!0)&&(0,l.vX)(a,Gs(this,Ks).min,Gs(this,Ks).max,!0)&&(this._printF11Coord(i,a,t,e),Gs(this,Xs).zoomAndPan(i,a))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&((0,n.KS)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=(0,l.IK)(t,e),a=(0,l.pw)(t,e);this._printF11Coord(t,e,i,a)}clearMap(){Gs(this,Js).selectAll("*").remove()}}i(3863);var er=i(9089),ir=i(7808);function ar(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,rr(t,e,"get"))}function sr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,rr(t,e,"set"),i),i}function rr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var nr=new WeakMap,or=new WeakMap,lr=new WeakMap,hr=new WeakMap,dr=new WeakMap,cr=new WeakMap;class pr{constructor(t,e){nr.set(this,{writable:!0,value:"Show good availability"}),or.set(this,{writable:!0,value:void 0}),lr.set(this,{writable:!0,value:{}}),hr.set(this,{writable:!0,value:!1}),dr.set(this,{writable:!0,value:void 0}),cr.set(this,{writable:!0,value:void 0}),sr(this,cr,t),sr(this,dr,e),sr(this,or,`port-select-${(0,o.MF)(ar(this,nr))}`),this._setupSelect(),this._setupListener()}show(t){const e=ar(this,lr).select$.get(0);t?(e.classList.remove("d-none"),e.parentNode.classList.remove("d-none"),ar(this,lr).setOptions(this._getOptions()),ar(this,lr).reset()):(e.classList.add("d-none"),e.parentNode.classList.add("d-none"))}_getOptions(){const t=new Map;for(const i of ar(this,cr).portDataDefault)if(i.inventory)for(const a of i.inventory){var e;t.set(a.id,(null===(e=ar(this,cr).tradeItem.get(a.id))||void 0===e?void 0:e.name)??"")}return`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`}_setupSelect(){const t={dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:ar(this,nr),virtualScroll:!0};sr(this,lr,new za.Z(ar(this,or),void 0,t,""))}_setupListener(){ar(this,lr).select$.on("change",(()=>{(0,n.KS)("Menu",ar(this,nr)),this._selectSelected()}))}_getPortList(t,e,i){var a;let s="";if(console.log(t),s+=`<h5>${(null===(a=ar(this,cr).tradeItem.get(t))||void 0===a?void 0:a.name)??""}</h5>`,e.size>0){s+="<h6>Buy</h6>";for(const[,t]of e)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,v.yI)(t.good.buyQuantity)} @ ${(0,v.Pj)(t.good.buyPrice)}<br>`}if(e&&i&&(s+="<p></p>"),i.size>0){s+="<h6>Sell</h6>";for(const[,t]of i)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,v.yI)(t.good.sellQuantity)} @ ${(0,v.Pj)(t.good.sellPrice)}<br>`}return s}_selectSelected(){const t=Number(ar(this,lr).getValues()),e=new Map,i=new Map;sr(this,hr,!0);const a=ar(this,cr).portDataDefault.filter((e=>e.inventory.some((e=>e.id===t)))).sort((0,vt.MR)(["name"])).map((a=>{const s=a.inventory.find((e=>e.id===t));return s&&(a.sellInTradePort=s.buyQuantity>0,a.sellInTradePort&&e.set(a.name,{name:a.name,nation:a.nation,good:s}),a.buyInTradePort=s.sellQuantity>0,a.buyInTradePort&&i.set(a.name,{name:a.name,nation:a.nation,good:s})),a}));ar(this,cr).setShowRadiusSetting("off"),ar(this,cr).portData=a,ar(this,cr).showRadius="tradePorts","portList"!==ar(this,dr).showTrades.listType&&(ar(this,dr).showTrades.listType="portList"),ar(this,dr).showTrades.update(this._getPortList(t,e,i)),ar(this,cr).update()}get isInventorySelected(){return ar(this,hr)}}var ur=i(3609);function wr(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function vr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,gr(t,e,"get"))}function mr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,gr(t,e,"set"),i),i}function gr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var _r=new WeakMap,fr=new WeakMap,br=new WeakMap,yr=new WeakMap,kr=new WeakMap;class Mr{constructor(t,e){wr(this,"show",void 0),_r.set(this,{writable:!0,value:{}}),fr.set(this,{writable:!0,value:{}}),br.set(this,{writable:!0,value:void 0}),yr.set(this,{writable:!0,value:void 0}),kr.set(this,{writable:!0,value:{}}),wr(this,"_serverName",void 0),wr(this,"_isDataLoaded",void 0),wr(this,"_minScale",void 0),wr(this,"_scale",void 0),wr(this,"_fontSize",void 0),wr(this,"_numTrades",void 0),wr(this,"_arrowX",void 0),wr(this,"_arrowY",void 0),wr(this,"_baseId",void 0),wr(this,"_nationSelectId",void 0),wr(this,"_listType",void 0),wr(this,"_showId",void 0),wr(this,"_showRadioValues",void 0),wr(this,"_showCookie",void 0),wr(this,"_showRadios",void 0),wr(this,"_profitId",void 0),wr(this,"_profitRadioValues",void 0),wr(this,"_profitCookie",void 0),wr(this,"_profitRadios",void 0),wr(this,"_profitValue",void 0),wr(this,"_profitText",void 0),wr(this,"_g",void 0),wr(this,"_labelG",void 0),wr(this,"_tradeDetailsDiv",void 0),wr(this,"_tradeDetailsHead",void 0),wr(this,"_nationSelector",void 0),wr(this,"_list",void 0),wr(this,"_linkDataDefault",void 0),wr(this,"_linkData",void 0),wr(this,"_portData",void 0),wr(this,"_nodeData",void 0),wr(this,"_linkDataFiltered",void 0),wr(this,"_portDataFiltered",void 0),wr(this,"_tradeItem",void 0),mr(this,yr,t),mr(this,br,e),this._serverName=vr(this,br).serverName,this._minScale=vr(this,br).minMapScale,this._scale=this._minScale,this._fontSize=l.jo,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=`${this._baseId}-nation-select`,this._listType="tradeList",this._showId="show-trades",this._showRadioValues=["off","on"],this._showCookie=new c.Z({id:this._showId,values:this._showRadioValues}),this._showRadios=new F.Z(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new c.Z({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new F.Z(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(vr(this,br).extent),mr(this,_r,new pr(t,e)),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=(0,a.Z)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),(0,a.Z)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=(0,a.Z)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const t=`${vt.nU.map((t=>`<option value="${t.short}" selected>${t.name}</option>`)).join("")}`,e=`${this._baseId}-card`;this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const i=this._tradeDetailsHead.append("label"),a=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",t),ur(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:t=>`${t===vt.nU.length?"All":String(t)} nations selected`,title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-bs-toggle","collapse").attr("data-bs-target",`#${e}`).attr("aria-expanded","false").text("Info"),this._tradeDetailsHead.append("div").attr("id",e).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group ps-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,a=t.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),a.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector(`#${this._showId}`))||void 0===t||t.addEventListener("change",(async()=>this._showSelected())),null===(e=document.querySelector(`#${this._profitId}`))||void 0===e||e.addEventListener("change",(()=>{this._profitValueSelected()})),this._nationSelector.addEventListener("change",(t=>{this._nationChanged(),t.preventDefault()}))}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map((t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]))),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map((t=>{let e=0;switch(this._profitValue){case"weight":e=Mr._getProfitPerWeight(t);break;case"distance":e=Mr._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error(`Wrong profit value ${this._profitValue}`)}return t.profit=e,t})).sort(((t,e)=>e.profit??0-(t.profit??0)))}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),vr(this,_r).show(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){const t=await(0,o.qP)(`${this._serverName}-pb.json`),e=(await i.e(462).then(i.t.bind(i,9131,19))).default;this._portData=e.map((e=>{const i=t.find((t=>t.id===e.id));return{...e,...i}})),this._linkDataDefault=await(0,o.qP)(`${this._serverName}-trades.json`);const a=await(0,o.qP)(`${this._serverName}-items.json`);this._tradeItem=new Map(a.map((t=>[t.id,t.name])))}async _loadAndSetupData(){await this._loadData(),this._setupData()}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then((()=>{this._isDataLoaded=!0})),Mr._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(Mr._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.isShallow)??!0}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){const e=t.weightPerItem*t.quantity;let i="";return i+=Mr._addInfo(`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Mr._addDes("trade"),i+=Mr._addInfo(`${(0,v.Pj)(t.profit??0)}`)+Mr._addDes(this._profitText),i+=Mr._addInfo(`${(0,v.Dw)(e)} ${1===e?"ton":"tons"}`)+Mr._addDes("weight"),i+=Mr._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Mr._addDes(`from ${this._getDepth(t.source.id)}`),i+=Mr._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Mr._addDes(`to ${this._getDepth(t.target.id)}`),i+=Mr._addInfo(`${(0,v.Dw)(t.distance)}`)+Mr._addDes("sail distance"),i}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,a=Mr._getProfitPerDistance(t),s=Mr._getProfitPerWeight(t);let r="";return r+=Mr._startBlock("Trade"),r+=Mr._addInfo(`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Mr._addDes("good"),r+=Mr._addInfo(`${(0,v.Pj)(t.source.grossPrice)}`)+Mr._addDes("gross buy price"),r+=Mr._addInfo(`${(0,v.Pj)(t.target.grossPrice)}`)+Mr._addDes("gross sell price"),r+=Mr._addInfo(`${(0,v.Dw)(e)} ${1===e?"ton":"tons"}`)+Mr._addDes("weight"),r+=Mr._endBlock(),r+=Mr._startBlock("Profit"),r+=Mr._addInfo(`${(0,v.Pj)(t.profitTotal)}`)+Mr._addDes("total"),r+=Mr._addInfo(`${(0,v.Pj)(i)}`)+Mr._addDes("profit/item"),r+=Mr._addInfo(`${(0,v.Pj)(a)}`)+Mr._addDes("profit/distance"),r+=Mr._addInfo(`${(0,v.Pj)(s)}`)+Mr._addDes("profit/weight"),r+=Mr._endBlock(),r+=Mr._startBlock("Route"),r+=Mr._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Mr._addDes(`from ${this._getDepth(t.source.id)}`),r+=Mr._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Mr._addDes(`to ${this._getDepth(t.source.id)}`),r+=Mr._addInfo(`${(0,v.Dw)(t.distance)}`)+Mr._addDes("sail distance"),r+=Mr._endBlock(),r}_getSiblingLinks(t,e){return this._linkDataFiltered.filter((i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t)).map((t=>t.profit??0))}_getXCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.x)??0}_getYCoord(t){var e;return(null===(e=this._nodeData.get(t))||void 0===e?void 0:e.y)??0}_updateGraph(){const t=(t,e)=>{const i=t.currentTarget;new(J())(i,{html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-small"></div></div>',trigger:"manual",title:this._getTradeFullData(e),sanitize:!1}).show()},e=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},a={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},s=t?i.x:a.x,r=t?i.y:a.y,n=t?a.x:i.x,o=t?a.y:i.y;let l=Math.sqrt((n-s)**2+(o-r)**2);const h=t?0:1,d=this._getSiblingLinks(e.source.id,e.target.id);if(d.length>1){const t=(0,ir.x)().domain(d).range([1,d.length]);l/=1+1/d.length*(t(e.profit??0)??-1)}return l=Math.round(l),`M${s},${r}A${l},${l} 0,0,${h} ${n},${o}`},i=vr(this,_r).isInventorySelected?[]:this._linkDataFiltered,a=(0,er.Z)(this._linkDataFiltered,(t=>t.profit??0)),s=(0,w.Z)().range([5/this._scale,15/this._scale]).domain(a),r=2**Math.log2(Math.abs(this._minScale)+this._scale),n=(0,l.qY)(this._fontSize/r);this._g.selectAll(".trade-link").data(i,(t=>Mr._getId(t))).join((e=>e.append("path").attr("class","trade-link").attr("marker-start",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)")).attr("marker-end",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"")).attr("id",(t=>Mr._getId(t))).on("click",((e,i)=>{t(e,i)})).on("mouseleave",(t=>{(t=>{const e=t.currentTarget,i=J().getInstance(e);i&&i.dispose()})(t)})))).attr("d",(t=>e(this._getXCoord(t.source.id)<this._getXCoord(t.target.id),t))).attr("stroke-width",(t=>`${s(t.profit??0)??0}px`)),this._labelG.attr("font-size",`${n}px`),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,(t=>Mr._getId(t))).join((t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",(t=>`#${Mr._getId(t)}`)).text((t=>`${(0,v.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)))).attr("dy",(t=>`-${s(t.profit??0)/1.8}px`))}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],Mr._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,Mr._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t??"")}_updatePortList(t){this._list.html(t??"")}_updateTradeList(){let t;const e=(e,i)=>{t=(0,a.Z)(`path#${Mr._getId(i)}`).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,(t=>Mr._getId(t))).join((t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i))).html((t=>this._getTradeLimitedData(t)))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter((t=>t.coordinates[0]>=vr(this,fr)[0]&&t.coordinates[0]<=vr(this,kr)[0]&&t.coordinates[1]>=vr(this,fr)[1]&&t.coordinates[1]<=vr(this,kr)[1])).map((t=>t.id)));this._linkDataFiltered=this._linkData.filter((e=>t.has(e.source.id)||t.has(e.target.id))).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter((t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id))).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set([...this._nationSelector.selectedOptions].map((t=>t.value)));this._portDataFiltered=new Set(this._portData.filter((e=>t.has(e.nation))).map((t=>t.id)))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t){mr(this,fr,t[0]),mr(this,kr,t[1])}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this._linkData=this.show?this._linkDataDefault:[],this.update()}}const Sr=t=>t*t,xr=t=>Math.sqrt(Sr(t.x)+Sr(t.y)+Sr(t.z)),Wr=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,Tr=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),$r=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),Dr=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),Pr=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});var Cr=i(3609);function Ir(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Nr(t,e,"get"))}function Lr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Nr(t,e,"set"),i),i}function Nr(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Ar=new WeakMap,Zr=new WeakMap,Br=new WeakMap,Er=new WeakMap,jr=new WeakMap,Fr=new WeakMap,Rr=new WeakMap;class zr extends p.Z{constructor(t,e){super(t,"md","Set"),Ar.set(this,{writable:!0,value:void 0}),Zr.set(this,{writable:!0,value:3}),Br.set(this,{writable:!0,value:void 0}),Er.set(this,{writable:!0,value:[]}),jr.set(this,{writable:!0,value:[]}),Fr.set(this,{writable:!0,value:[]}),Rr.set(this,{writable:!0,value:[]}),Lr(this,Br,e),Lr(this,Ar,Array.from({length:Ir(this,Zr)},((t,e)=>e))),this._init()}_init(){for(const t of Ir(this,Ar))Ir(this,Fr)[t]=`${super.baseId}-${t}-select`,Ir(this,Er)[t]=`${super.baseId}-${t}-input`;this._injectModal(),this._setupSelects()}_injectModal(){const t=super.bodySel,e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of Ir(this,Ar)){const i=e.append("div").attr("class","row mb-4");i.append("div").attr("class","col-md-6").append("label").attr("class","col-form-label").append("select").attr("name",Ir(this,Fr)[t]).attr("id",Ir(this,Fr)[t]).attr("class","selectpicker");const a=i.append("div").attr("class","col-md-6 form-floating"),s=a.append("input").attr("id",Ir(this,Er)[t]).attr("name",Ir(this,Er)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3);a.append("label").attr("for",Ir(this,Er)[t]).attr("class","ps-4").text("Distance in k"),Ir(this,jr)[t]=s.node()}t.append("div").attr("class","form-text mt-3").text("Distances from in-game trader tool.")}_setupSelects(){const t=`${Ir(this,Br).map((t=>({id:t.id,name:t.name,nation:t.nation}))).sort((0,vt.MR)(["name"])).map((t=>`<option data-subtext="${t.nation}">${t.name}</option>`)).join("")}`;for(const e of Ir(this,Ar))Ir(this,Rr)[e]=document.querySelector(`#${Ir(this,Fr)[e]}`),Ir(this,Rr)[e]&&(Ir(this,Rr)[e].insertAdjacentHTML("beforeend",t),Cr(Ir(this,Rr)[e]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0}))}get ids(){return Ir(this,Ar)}get numberOfInputs(){return Ir(this,Zr)}getPort(t){const e=Ir(this,Rr)[t];return e.selectedIndex?e.options[e.selectedIndex].text:""}getDistance(t){return Number(Ir(this,jr)[t].value)}}var Vr=i(2776),Gr=i.n(Vr);function qr(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Or(t,e,"get"))}function Hr(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Or(t,e,"set"),i),i}function Or(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var Yr=new WeakMap,Kr=new WeakMap,Xr=new WeakMap,Ur=new WeakMap,Jr=new WeakMap;class Qr{constructor(t,e){Yr.set(this,{writable:!0,value:void 0}),Kr.set(this,{writable:!0,value:void 0}),Xr.set(this,{writable:!0,value:1e4}),Ur.set(this,{writable:!0,value:{}}),Jr.set(this,{writable:!0,value:{}}),Hr(this,Yr,t),Hr(this,Kr,e),Hr(this,Jr,(0,a.Z)("#toast-column")),this._set(),this._show()}_set(){Hr(this,Ur,qr(this,Jr).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=qr(this,Ur).append("div").attr("class","toast-header");t.append("img").attr("class","rounded me-2").attr("height","48px").attr("width","48px").attr("src",o.vU).attr("alt","logo"),t.append("em").attr("class","me-auto").html(qr(this,Yr)),t.append("button").attr("type","button").attr("class","btn-close").attr("data-bs-dismiss","toast").attr("aria-label","Close"),qr(this,Ur).append("div").attr("class","toast-body").html(qr(this,Kr))}_show(){const t=qr(this,Ur).node();new(Gr())(t,{delay:qr(this,Xr)}).show()}}function tn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,an(t,e,"get"))}function en(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,an(t,e,"set"),i),i}function an(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var sn=new WeakMap,rn=new WeakMap,nn=new WeakMap,on=new WeakMap,ln=new WeakMap,hn=new WeakMap;class dn{constructor(t){sn.set(this,{writable:!0,value:void 0}),rn.set(this,{writable:!0,value:"Get position"}),nn.set(this,{writable:!0,value:void 0}),on.set(this,{writable:!0,value:1.04}),ln.set(this,{writable:!0,value:void 0}),hn.set(this,{writable:!0,value:void 0}),en(this,hn,t),en(this,sn,(0,o.MF)(tn(this,rn))),en(this,nn,`menu-${tn(this,sn)}`),this._setupListener()}_menuClicked(){(0,n.KS)("Menu",tn(this,rn)),tn(this,ln)?tn(this,ln).show():(en(this,ln,new zr(tn(this,rn),tn(this,hn).portDataDefault)),tn(this,ln).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupListener(){var t;null===(t=document.querySelector(`#${tn(this,nn)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_showAndGoToPosition(){const t=tn(this,hn).portData.map((t=>({x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance??0}))),e=((t,e,i,a=!1)=>{const s=Dr(Tr(e,t),xr(Tr(e,t))),r=Wr(s,Tr(i,t));let n=Tr(Tr(i,t),Pr(s,r));const o=Dr(n,xr(n)),l=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(s,o),h=xr(Tr(e,t)),d=Wr(o,Tr(i,t)),c=(Sr(t.r)-Sr(e.r)+Sr(h))/(2*h),p=(Sr(t.r)-Sr(i.r)+Sr(r)+Sr(d))/(2*d)-r/d*c;let u=Sr(t.r)-Sr(c)-Sr(p);Math.abs(u)<1e-10&&(u=0);const w=Math.sqrt(u);if(Number.isNaN(w))return;n=$r(t,$r(Pr(s,c),Pr(o,p)));const v=$r(n,Pr(l,w)),m=Tr(n,Pr(l,w));return 0===w||a?n:[v,m]})(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),tn(this,hn).map.f11.printCoord(e.x,e.y),tn(this,hn).map.zoomAndPan(e.x,e.y);const t=Math.round((0,l.IK)(e.x,e.y)/-1e3),i=Math.round((0,l.pw)(e.x,e.y)/-1e3);(0,d.A1)(t,i,tn(this,ln).getModalNode()),new Qr(tn(this,rn),"Coordinates copied to clipboard.")}else new Qr(tn(this,rn),"No intersection found.")}_useUserInput(){const t=new Map;for(const e of tn(this,ln).ids){const i=tn(this,ln).getPort(e),a=tn(this,ln).getDistance(e);a&&""!==i&&t.set(i,a*tn(this,on)*o.ZE)}t.size===tn(this,ln).numberOfInputs?(tn(this,hn).setShowRadiusSetting("position"),tn(this,hn).portData=tn(this,hn).portDataDefault.filter((e=>t.has(e.name))).map((e=>(e.distance=t.get(e.name),e))),tn(this,hn).update(),this._showAndGoToPosition()):new Qr(tn(this,rn),"Not enough data.")}}function cn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,un(t,e,"get"))}function pn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,un(t,e,"set"),i),i}function un(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var wn=new WeakMap,vn=new WeakMap,mn=new WeakMap;class gn extends p.Z{constructor(t){super(t,"sm","Set"),wn.set(this,{writable:!0,value:void 0}),vn.set(this,{writable:!0,value:void 0}),mn.set(this,{writable:!0,value:{}}),pn(this,wn,`input-group-${this.baseId}`),pn(this,vn,`input-${this.baseId}`),this._init()}_init(){this._injectModal()}_injectModal(){const t=super.bodySel;pn(this,mn,new Ze.Z(t,this.baseId))}getTime(){return document.querySelector(`#${cn(this,vn)}`).value.trim()}getWind(){return cn(this,mn).getWind()}}function _n(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,bn(t,e,"get"))}function fn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,bn(t,e,"set"),i),i}function bn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}lt().extend(wt());var yn=new WeakMap,kn=new WeakMap,Mn=new WeakMap;class Sn{constructor(t){yn.set(this,{writable:!0,value:void 0}),kn.set(this,{writable:!0,value:void 0}),Mn.set(this,{writable:!0,value:void 0}),fn(this,yn,t),fn(this,Mn,new c.Z({id:`${_n(this,yn)}-degrees`,expire:this._getExpire()})),fn(this,kn,new c.Z({id:`${_n(this,yn)}-time`}))}_getExpire(){return(0,vt.Vk)()}_getNow(){return lt()().utc().unix()}get(){const t=_n(this,Mn).get(),e=_n(this,kn).get();if(t&&e){const i=Number(t),a=Number(e),s=Math.round(this._getNow()-a);return 360+Math.floor(i-o.er*s)%360}return this.remove(),Number.NaN}set(t){_n(this,Mn).set(String(t)),_n(this,kn).set(String(this._getNow()))}remove(){_n(this,Mn).remove(),_n(this,kn).remove()}}function xn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,Tn(t,e,"get"))}function Wn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,Tn(t,e,"set"),i),i}function Tn(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var $n=new WeakMap,Dn=new WeakMap,Pn=new WeakMap,Cn=new WeakMap,In=new WeakMap,Ln=new WeakMap,Nn=new WeakMap,An=new WeakMap,Zn=new WeakMap,Bn=new WeakMap,En=new WeakMap,jn=new WeakMap,Fn=new WeakMap,Rn=new WeakMap,zn=new WeakMap,Vn=new WeakMap,Gn=new WeakMap,qn=new WeakMap,Hn=new WeakMap,On=new WeakMap,Yn=new WeakMap;class Kn{constructor(){$n.set(this,{writable:!0,value:void 0}),Dn.set(this,{writable:!0,value:void 0}),Pn.set(this,{writable:!0,value:{}}),Cn.set(this,{writable:!0,value:void 0}),In.set(this,{writable:!0,value:(0,a.Z)("#port-summary")}),Ln.set(this,{writable:!0,value:void 0}),Nn.set(this,{writable:!0,value:"In-game wind"}),An.set(this,{writable:!0,value:void 0}),Zn.set(this,{writable:!0,value:void 0}),Bn.set(this,{writable:!0,value:void 0}),En.set(this,{writable:!0,value:void 0}),jn.set(this,{writable:!0,value:void 0}),Fn.set(this,{writable:!0,value:void 0}),Rn.set(this,{writable:!0,value:void 0}),zn.set(this,{writable:!0,value:void 0}),Vn.set(this,{writable:!0,value:"wind-arrow"}),Gn.set(this,{writable:!0,value:4}),qn.set(this,{writable:!0,value:void 0}),Hn.set(this,{writable:!0,value:void 0}),On.set(this,{writable:!0,value:void 0}),Yn.set(this,{writable:!0,value:void 0}),Wn(this,Ln,(0,o.MF)(xn(this,Nn))),Wn(this,Yn,`menu-${xn(this,Ln)}`),Wn(this,On,(0,Ae.Z)().x((t=>t[0])).y((t=>t[1]))),Wn(this,Hn,40),Wn(this,qn,new Sn(xn(this,Ln))),Wn(this,Zn,xn(this,qn).get()),this._setupArrow(),this._setupListener(),Number.isNaN(xn(this,Zn))?new Qr("Hint","Get the wind direction:<br>Use <em>In-game wind</em> under <em>Map tools</em>."):this._initShowCurrentWind()}_menuClicked(){(0,n.KS)("Menu",xn(this,Nn)),xn(this,Dn)?xn(this,Dn).show():(Wn(this,Dn,new gn(xn(this,Nn))),xn(this,Dn).getModalNode().addEventListener("hidden.bs.modal",(()=>{this._useUserInput()})))}_setupArrow(){const t=xn(this,Gn),e=2*xn(this,Gn);(0,a.Z)("#na-svg defs").append("marker").attr("id",xn(this,Vn)).attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","fill-contrast-text").attr("d",`M0,-${t}L${e},0L0,${t}`)}_setupListener(){var t;null===(t=document.querySelector(`#${xn(this,Yn)}`))||void 0===t||t.addEventListener("click",(()=>{this._menuClicked()}))}_windChange(){Wn(this,Zn,360+(xn(this,Zn)-o.er*xn(this,Hn))%360),this._updateWindDirection()}_useUserInput(){Wn(this,Zn,xn(this,Dn).getWind()),xn(this,Cn)?this._updateWindDirection():this._initShowCurrentWind()}_toggle(t){xn(this,In).classed("port-summary-no-wind",!t).classed("port-summary-wind",t)}_show(){this._toggle(!0)}_hide(){this._toggle(!1)}_setupSvg(){this._show(),Wn(this,$n,xn(this,In).insert("div",":first-child").attr("id",xn(this,Ln)).attr("class","block p-0 pe-2")),Wn(this,Pn,xn(this,$n).append("svg").attr("class","small svg-background-light stroke-thick"))}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),Wn(this,En,window.setInterval((()=>{this._windChange()}),1e3*xn(this,Hn)))}_updateWindDirection(){const t=(0,l.Ht)(xn(this,Zn)),e=xn(this,jn)*Math.cos(t),i=xn(this,jn)*Math.sin(t),a=[[Math.round(xn(this,Rn)+e),Math.round(xn(this,zn)+i)],[Math.round(xn(this,Rn)-e),Math.round(xn(this,zn)-i)]];xn(this,Cn)&&(xn(this,Cn).datum(a).attr("d",xn(this,On)),xn(this,qn).set(xn(this,Zn)))}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:e,top:i}=t.getBoundingClientRect(),a=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top")),s=Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"));return Math.floor(e-i-a-s)}return 0}_initPrintCompassRose(){Wn(this,Bn,this._getHeight()),Wn(this,zn,xn(this,Bn)/2),Wn(this,Fn,xn(this,Bn)),Wn(this,Rn,xn(this,Fn)/2),Wn(this,An,Math.min(xn(this,Bn),xn(this,Fn))/2),Wn(this,jn,.6*xn(this,An)),xn(this,Pn).attr("height",xn(this,Bn)).attr("width",xn(this,Fn));const t=xn(this,Pn).append("svg").attr("ui-component","compass").attr("class","fill-background-light").attr("x",xn(this,Rn)).attr("y",xn(this,zn));(0,d.ec)({element:t,radius:xn(this,An)}),Wn(this,Cn,xn(this,Pn).append("path").attr("class","svg-stroke-thick").attr("marker-end","url(#wind-arrow)"))}clearMap(){window.clearInterval(xn(this,En)),this._hide(),xn(this,$n)&&xn(this,$n).remove(),Wn(this,Cn,void 0),xn(this,qn).remove()}}var Xn=i(3609);function Un(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Jn(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,to(t,e,"get"))}function Qn(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,to(t,e,"set"),i),i}function to(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var eo=new WeakMap,io=new WeakMap,ao=new WeakMap,so=new WeakMap,ro=new WeakMap,no=new WeakMap,oo=new WeakMap,lo=new WeakMap,ho=new WeakMap,co=new WeakMap,po=new WeakMap,uo=new WeakMap,wo=new WeakMap,vo=new WeakMap,mo=new WeakMap,go=new WeakMap,_o=new WeakMap,fo=new WeakMap,bo=new WeakMap,yo=new WeakMap,ko=new WeakMap;class Mo{constructor(t,e){Un(this,"coord",void 0),Un(this,"f11",void 0),Un(this,"gridOverlay",void 0),Un(this,"height",0),eo.set(this,{writable:!0,value:5}),Un(this,"minMapScale",1),io.set(this,{writable:!0,value:256}),ao.set(this,{writable:!0,value:this.minMapScale}),so.set(this,{writable:!0,value:this.minMapScale}),ro.set(this,{writable:!0,value:!1}),no.set(this,{writable:!0,value:256}),oo.set(this,{writable:!0,value:1}),lo.set(this,{writable:!0,value:.25}),ho.set(this,{writable:!0,value:2}),co.set(this,{writable:!0,value:{}}),po.set(this,{writable:!0,value:[0,0]}),uo.set(this,{writable:!0,value:{}}),wo.set(this,{writable:!0,value:{}}),vo.set(this,{writable:!0,value:0}),mo.set(this,{writable:!0,value:0}),go.set(this,{writable:!0,value:0}),_o.set(this,{writable:!0,value:0}),fo.set(this,{writable:!0,value:{}}),bo.set(this,{writable:!0,value:{}}),yo.set(this,{writable:!0,value:void 0}),ko.set(this,{writable:!0,value:void 0}),Un(this,"rem",l.jo),Un(this,"serverName",void 0),Un(this,"showGrid",void 0),Un(this,"showTrades",void 0),Un(this,"width",0),Un(this,"xGridBackgroundHeight",void 0),Un(this,"yGridBackgroundWidth",void 0),Un(this,"_doubleClickAction",void 0),Un(this,"_grid",void 0),Un(this,"_journey",void 0),Un(this,"_pbZone",void 0),Un(this,"_ports",void 0),Un(this,"_portSelect",void 0),Un(this,"_showGrid",void 0),Un(this,"_svg",void 0),Un(this,"_zoomLevel",void 0),Un(this,"_doubleClickActionCookie",void 0),Un(this,"_doubleClickActionId",void 0),Un(this,"_doubleClickActionRadios",void 0),Un(this,"_doubleClickActionValues",void 0),Un(this,"_searchParams",void 0),Un(this,"_showGridCookie",void 0),Un(this,"_showGridId",void 0),Un(this,"_showGridRadios",void 0),Un(this,"_showGridValues",void 0),this.serverName=t,this._searchParams=e,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:h.zb},this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new c.Z({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new F.Z(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new c.Z({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new F.Z(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupSvg(),this._setSvgSize(),this._setupTiler(),this._setupListener()}static _stopProperty(t){t.defaultPrevented&&t.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this._ports=new Ie(this),await this._ports.init(),this._pbZone=new X(this._ports,this.serverName),this._grid=new E(this),this._portSelect=new Cs(this._ports),this.showTrades=new Mr(this._ports,this),await this.showTrades.showOrHide(),this.f11=new tr(this,this.coord),this._init(),this._journey=new Ki(this.rem),Qn(this,yo,new Kn),new dn(this._ports),new ja(this,this.serverName,this.coord)}_setupListener(){var t,e,i,a,s,r,o;this._svg.on("dblclick.zoom",null).on("click",(t=>{Mo._stopProperty(t)}),!0).on("dblclick",(t=>{this._doDoubleClickAction(t)})),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",(()=>{(0,n.KS)("Menu","Select port on property")})),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",(()=>{(0,n.KS)("Menu","Settings")})),null===(i=document.querySelector("#menu-download-pb-calc"))||void 0===i||i.addEventListener("click",(()=>{(0,n.KS)("Tools","Download pb calculator")})),null===(a=document.querySelector("#reset"))||void 0===a||a.addEventListener("click",(()=>{this._clearMap()})),null===(s=document.querySelector("#about"))||void 0===s||s.addEventListener("click",(()=>{this._showAbout()})),null===(r=document.querySelector("#double-click-action"))||void 0===r||r.addEventListener("change",(()=>{this._doubleClickSelected()})),null===(o=document.querySelector("#show-grid"))||void 0===o||o.addEventListener("change",(()=>{this._showGridSelected()}))}_setupSvg(){Qn(this,wo,(0,r.sP)().scaleExtent([this.minMapScale,Jn(this,io)]).wheelDelta((t=>-Jn(this,oo)*Math.sign(t.deltaY))).on("zoom",(t=>{this._naZoomed(t)}))),this._svg=(0,a.Z)("#na-map").append("svg").attr("id","na-svg").attr("class","fill-empty stroke-empty bg-map").call(Jn(this,wo)),this._svg.append("defs"),Qn(this,fo,this._svg.append("g").attr("class","map-tiles")),Qn(this,bo,this._svg.append("g").attr("id","map"))}_setupTiler(){Qn(this,vo,Jn(this,co)[0][0]),Qn(this,mo,Jn(this,co)[1][0]),Qn(this,go,Jn(this,co)[0][1]),Qn(this,_o,Jn(this,co)[1][1])}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_drawMap(t){const e=Math.log2(t.k)<=Jn(this,eo)?0:Jn(this,eo)-Math.log2(t.k),i=Jn(this,no)*t.k,a={tiles:[]},s=Math.log2(i/Jn(this,no)),r=Math.round(Math.max(s+e,0)),n=2**(s-r)*Jn(this,no),o=t.x-i/2,l=t.y-i/2,h=Math.max(0,Math.floor((Jn(this,vo)-o)/n)),d=Math.min(Number(1<<r),Math.ceil((Jn(this,mo)-o)/n)),c=Math.max(0,Math.floor((Jn(this,go)-l)/n)),p=Math.min(Number(1<<r),Math.ceil((Jn(this,_o)-l)/n));for(let t=c;t<p;++t)for(let e=h;e<d;++e)a.tiles.push([e,t,r]);if(a.translate=[o/n,l/n],a.scale=n,a.tiles.length>0){const t=2**(r+Math.abs(e)),i=this.coord.max/t*2**Math.abs(e);Qn(this,uo,[[h*i,c*i],[d*i,p*i]]),Qn(this,po,[a.translate[0]*a.scale,a.translate[1]*a.scale]),this._updateMap(a)}}_updateMap(t){const{translate:[e,i],scale:a,tiles:s}=t;Jn(this,fo).attr("transform",`translate(${e*a},${i*a}) scale(${a})`).selectAll("image").data(s,(t=>t)).join((t=>t.append("image").attr("xlink:href",(([t,e,i])=>`images/map/${i}/${e}/${t}.webp`)).attr("x",(([t])=>t)).attr("y",(([,t])=>t)).attr("width",1).attr("height",1)))}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),Jn(this,yo).clearMap(),Xn(".selectpicker").val("default").selectpicker("refresh")}_initModal(){Qn(this,ko,new p.Z(`${o.xw} <span class="text-primary small">v${o.f4}</span>`,"lg"));Jn(this,ko).bodySel.html(`<p>${o.FB} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/">Game-Labs forum post</a> for further details. Feedback is very welcome.</p>\n                    <p>Designed by iB aka Felix Victor, <em>Bastards</em> clan ${(0,d.Mo)("(BSTD)")}</a>.</p>\n                    <div class="alert alert-secondary" role="alert"><h5 class="alert-heading">Did you know?</h5><p class="mb-0">My clan mate, Aquillas, wrote a most comprehensive <a href="https://drive.google.com/file/d/1K6xCXtCUd68PPzvNjBxD5ffgE_69VEoc/view">user guide</a>.</p></div>`)}_showAbout(){Jn(this,ko)?Jn(this,ko).show():this._initModal()}_doDoubleClickAction(t){const[e,i]=(0,s.Z)(t,Jn(this,bo).node());"f11"===this._doubleClickAction?this.f11.printCoord(e,i):this._journey.plotCourse(e,i),this.zoomAndPan(e,i)}_setZoomLevelAndData(t){const e=this._getMapScale(t.k);e!==Jn(this,ao)&&(Qn(this,ao,e),Jn(this,ao)>Jn(this,ho)?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):Jn(this,ao)>Jn(this,lo)?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(Jn(this,ao))}_getMapScale(t){return 2**(Math.log2(t)-Jn(this,eo))}_getMapTransform(t){const e=this._getMapScale(t.k);return r.CR.scale(e).translate(Jn(this,po)[0]/e,Jn(this,po)[1]/e)}_naZoomed(t){const{transform:e}=t;this._drawMap(e),this._ports.setBounds(Jn(this,uo)),this._pbZone.setBounds(Jn(this,uo)),this.showTrades.setBounds(Jn(this,uo));const i=this._getMapTransform(e);this._grid.transform(i),this.showTrades.transform(i),Jn(this,bo).attr("transform",i.toString()),this._setZoomLevelAndData(e)}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){var t;this.zoomLevel="initial",Qn(this,so,this._getInitialMapScale()),this._initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight(),null===(t=document.querySelector("#navbar-left"))||void 0===t||t.classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight(),Qn(this,co,[[0,0],[this.width,this.height]])}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style",`height:${e}px`)}_getInitialMapScale(){let t=(0,l.XH)(Math.min(this.height,this.width)/Jn(this,no));const e=this.height*this.width;if(e-(Jn(this,no)*t)**2>(Jn(this,no)*t*2)**2-e){const e=2;Qn(this,ro,!0),t*=e}return t}_setTranslateExtent(t){let e=t;if(Jn(this,ro)){const i=2,a=t.k/i,{x:s,y:n}=t;e=r.CR.translate(s,n).scale(a)}Jn(this,wo).translateExtent([e.invert(Jn(this,co)[0]),e.invert(Jn(this,co)[1])])}_initialZoomAndPan(){const t=this.zoomAndPan(this.coord.max/2,this.coord.max/2,!0);this._setTranslateExtent(t)}zoomAndPan(t,e,i=!1){const a=i?Jn(this,so):32,s=r.CR.scale(a).translate(Math.floor((-t+this.coord.max/2+this.width/2)/a),Math.floor(-e+this.coord.max/2+this.height/2)/a);return this._svg.call(Jn(this,wo).transform,s),s}goToPort(){0===this._ports.currentPort.id?this._initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y)}get extent(){return Jn(this,co)}}},2938:(t,e,i)=>{i.d(e,{Z:()=>w});i(3223);var a=i(1198),s=i(393),r=i(3609);function n(t,e){return function(t,e){if(e.get)return e.get.call(t);return e.value}(t,l(t,e,"get"))}function o(t,e,i){return function(t,e,i){if(e.set)e.set.call(t,i);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=i}}(t,l(t,e,"set"),i),i}function l(t,e,i){if(!e.has(t))throw new TypeError("attempted to "+i+" private field on non-instance");return e.get(t)}var h=new WeakMap,d=new WeakMap,c=new WeakMap,p=new WeakMap,u=new WeakMap;class w{constructor(t,e){h.set(this,{writable:!0,value:void 0}),d.set(this,{writable:!0,value:void 0}),c.set(this,{writable:!0,value:void 0}),p.set(this,{writable:!0,value:{}}),u.set(this,{writable:!0,value:{}}),o(this,p,t),o(this,h,e),o(this,d,`form-${n(this,h)}`),o(this,c,`slider-${n(this,h)}`),this._inject(),o(this,u,r(`#${n(this,c)}`)),this._setup()}_setup(){window.sliderTooltip=t=>`${(0,a.nD)(String(t.value))}<br>${String(t.value)}°`,n(this,u).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/s.Tm.length,editableTooltip:!1,tooltipFormat:"sliderTooltip",create(){this.control.css("display","block")}})}_inject(){const t=n(this,p).append("form").attr("id",n(this,d)).append("div").attr("class","text-center");t.append("label").attr("for",n(this,c)).text("Current in-game wind"),t.append("div").attr("id",n(this,c)).attr("class","rslider d-inline-block")}_getInputValue(){return n(this,u).roundSlider("getValue")}getWind(){const t=(0,s.tT)(this._getInputValue());let e;return e=Number.isNaN(Number(t))?(0,s.Ri)(t):Number(t),e}}},7846:t=>{t.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' height='300' width='300' viewBox='0 0 512 512'%3e%3cpath fill='%23292109' fill-opacity='.7' d='m438 411.3-37.6-37.6c.1-.2.1-.2.1-.4 9.7-20.8 6.2-46.3-11-63.5L363 336.3l-80.5-80.5 96.6-96.6c24-24 37.5-56.6 37.5-90.5L256 229.3 95.4 68.7c0 34 13.5 66.5 37.5 90.5l96.6 96.6-80.5 80.5-26.5-26.5c-17.2 17.2-20.7 42.7-11 63.5.1.2.1.2.1.4L74 411.3c-7.3 7.3-7.3 19.2 0 26.5 7.3 7.3 19.2 7.3 26.5 0l37.6-37.6c.2.1.2.1.4.1 20.8 9.7 46.3 6.2 63.5-11l-26.5-26.5 80.5-80.5 80.5 80.5-26.5 26.6c17.2 17.2 42.7 20.7 63.5 11 .1-.1.2-.1.4-.1l37.6 37.6c7.3 7.3 19.2 7.3 26.5 0 7.3-7.4 7.3-19.3 0-26.6z'/%3e%3c/svg%3e"}}]);