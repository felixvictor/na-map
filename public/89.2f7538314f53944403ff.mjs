/*! For license information please see 89.2f7538314f53944403ff.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[89],{995:(e,t,s)=>{function a(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}s.d(t,{I:()=>i});class i{constructor(e,t){a(this,"serverId",void 0),a(this,"baseName",void 0),a(this,"baseId",void 0),a(this,"buttonId",void 0),a(this,"modalId",void 0),this.serverId=e,this.baseName=t,this.baseId=t.toLocaleLowerCase().replaceAll(" ","-"),this.buttonId=`button-${this.baseId}`,this.modalId=`modal-${this.baseId}`}}},27:(e,t,s)=>{s.d(t,{qn:()=>z});var a=s(4017),i=s(7228),r=s(233),o=s(9022);function n(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class p{constructor(e,t){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=e,this._shipCompare=t,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map((e=>`${e} knots`)),this.select=`#ship-compare-${this._id}`,this._setupSvg(),this._setCompass()}static pd(e){let t=`<span class="badge badge-white">${e.maxCannonLb} / `;return e.maxCarroLb?t+=`${e.maxCarroLb}`:t+="–",t+=" lb</span>",t}static getCannonsPerDeck(e){let t=`${e.gunsPerDeck[0].amount} ${p.pd(e.gunsPerDeck[0])}`,s="";for(let a=1;a<4;a+=1)e.gunsPerDeck[a].amount?t=`${e.gunsPerDeck[a].amount} ${p.pd(e.gunsPerDeck[a])} <br>${t}`:s=`${s}<br>`;return[t,s]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(e){let t=0;function s(e){return t+=1,`<div class="row row-small ${t%2?"row-light":""}"><div class="col-compress col-3">${e}</div>`}function a(t,s,a=6){let i,r="";return"cannonsPerDeck"===t?([i,r]=e[t],r=`<br>${r}`):i=""===t?"":String(e[t]),`<div class="col-compress col-${a}">${i}<br><span class="des">${s}</span>${r}</div>`}let i="";return i+=s(e.shipRating),i+=p.displaySecondBlock(),i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("rollAngle","Roll angle"),i+="</div></div></div>",i+=s(e.decks),i+=p.displaySecondBlock(),i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (lb)"),i+=p.displaySecondBlock(),i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+=p.displaySecondBlock(),i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+=p.displaySecondBlock(),i+=a("maxSpeed","Maximum"),i+=a("halfturnTime","Rudder half time"),i+=a("acceleration","Acceleration"),i+=a("deceleration","Deceleration"),i+=a("turnSpeed","Turn speed"),i+=a("turnAcceleration","Turn acceleration"),i+="</div></div></div>",i+=s('Hit points <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+=p.displaySecondBlock(),i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+=a("cannonCrew","Cannon",4),i+=a("carroCrew","Carronades",4),i+="</div></div></div>",i+=s("Gunnery"),i+=p.displaySecondBlock(),i+=a("reload","Reload %",4),i+=a("dispersionHorizontal","Horizontal dispersion %",4),i+=a("dispersionVertical","Vertical dispersion %",4),i+=a("penetration","Ball penetration %",4),i+=a("traverseUpDown","Up/down traverse %",4),i+=a("traverseSide","Side traverse %",4),i+="</div></div></div>",i+=s("Boarding"),i+=p.displaySecondBlock(),i+=a("morale","Morale",4),i+=a("attack","Attack",4),i+=a("defense","Defense",4),i+=a("musketsCrew","Crew with muskets",4),i+=a("musketsAccuracy","Musket accuracy %",4),i+=a("cannonsAccuracy","Cannon accuracy %",4),i+=a("prepPerRound","Preparation per round",4),i+=a("prepInitial","Initial preparation",4),i+=a("disengageTime","Rounds to disengage",4),i+="</div></div></div>",i+=s("Resistance"),i+=p.displaySecondBlock(),i+=a("leakResistance","Leak %"),i+=a("splinterResistance","Splinter %"),i+="</div></div></div>",i+=s('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=p.displaySecondBlock(),i+=a("hullRepairsNeeded","Hull",4),i+=a("rigRepairsNeeded","Rig",4),i+=a("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=s("Repair"),i+=p.displaySecondBlock(),i+=a("hullRepairAmount","Hull %",4),i+=a("rigRepairAmount","Rig %",4),i+=a("repairTime","Time (sec)",4),i+="</div></div></div>",i+=s("Hold"),i+=p.displaySecondBlock(),i+=a("holdSize","Cargo slots"),i+=a("maxWeight","Tons"),i+="</div></div></div>",i+=s("Weight"),i+=p.displaySecondBlock(),i+=a("cannonWeight","Cannons",4),i+=a("carroWeight","Carronades",4),i+=a("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const e=(0,a.Z)(this.select);(0,a.Z)(`${this.select} svg`).remove(),this._svg=e.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),(0,a.Z)(`${this.select} div`).remove(),e.append("div")}_setCompass(){const e=new Array(o.f7/2);e.fill(1,0);const t=(0,i.Z)().sort(null).value(1)(e),s=(0,r.Z)().outerRadius(this._shipCompare.radiusSpeedScale(12)??0).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(t).join((e=>e.append("path").attr("d",s))),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join((e=>e.append("circle").attr("r",(e=>this._shipCompare.radiusSpeedScale(e)??0))))}}var d=s(2601),h=s(289),l=s(4127),c=s(9930),m=(s(6321),s(2157)),u=s(7015),_=s(393),g=s(1198),f=s(5923),b=s(3129),D=s.n(b),$=s(3609);function y(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class C extends p{constructor(e,t,s){super(e,s),y(this,"shipData",void 0),y(this,"_speedScale",void 0),y(this,"_shipRotate",void 0),y(this,"_speedText",void 0),y(this,"_drag",void 0),this.shipData=t,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const e=(0,r.Z)().outerRadius((e=>(this._shipCompare.radiusSpeedScale(e)??0)+2)).innerRadius((e=>(this._shipCompare.radiusSpeedScale(e)??0)+1)).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join((t=>t.append("path").attr("d",e).attr("id",((e,t)=>`tick${t}`)))),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join((e=>e.append("text").append("textPath").attr("href",((e,t)=>`#tick${t}`)).text(((e,t)=>this.ticksSpeedLabels[t])).attr("startOffset","10%")))}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return(0,u.$1)(this._speedScale(Math.abs(e))??0)}_getHeadingInCompass(e){return(0,_.tT)(e)}_updateCompareWindProfiles(){for(const e of this._shipCompare.columnsCompare)(0,m.xb)(this._shipCompare.selectedShips[e])||this._shipCompare.selectedShips[e].updateWindProfileRotation()}_setupDrag(){const e=this.shipData.speedDegrees.length,t=360/e,s=[...new Array(e+1)].map(((e,s)=>s*t));this._speedScale=(0,h.Z)().domain(s).range([...this.shipData.speedDegrees,this.shipData.speedDegrees[0]]).clamp(!0);const a=(e,t)=>{const{x:s,y:a}=e;t.rotate=this._getHeadingInDegrees((0,g.Fq)({x:t.initX,y:t.initY},{x:s,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",(e=>`rotate(${e.rotate})`)),t.compassText.attr("transform",(e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.rotate))),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()};this._drag=(0,d.Z)().on("drag",((e,t)=>{a(e,t)})).container((()=>this._mainG.node()))}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipData,t=this._shipCompare.shipMassScale(e)??0,s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",(e=>e.initX)).attr("y1",a-20).attr("x2",(e=>e.initX)).attr("y2",(e=>e.initY)),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",D()),r.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20).call(this._drag);const o=r.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));this._speedText=r.append("text").attr("x",(e=>e.speedTextX)).attr("y",(e=>e.speedTextY)).attr("transform",(e=>`rotate(${-e.initRotate})`)).text((e=>this._getSpeed(e.initRotate))),i.this=r,i.compassText=o,r.datum(i).attr("transform",(e=>`rotate(${e.initRotate-90})`)),r.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_drawWindProfile(){const e=(0,i.Z)().sort(null).value(1)(this.shipData.speedDegrees),t=l.Z,s=(0,c.Z)().angle(((e,t)=>t*o.P)).radius((e=>this._shipCompare.radiusSpeedScale(e.data)??0)).curve(t);this._shipCompare.windProfileRotate=0;const a=this._shipCompare.svgHeight/2-20,r={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-a,type:"windProfile"},n=this._mainG.append("g").datum(r).attr("class","wind-profile");n.append("path").attr("d",(e=>String((0,g.GZ)(e.compassTextX,e.compassTextY,20))+(0,g.wo)(e.compassTextX,e.compassTextY,-e.compassTextY/2))).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),n.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20);const p=n.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));n.append("path").attr("class","base-profile").attr("d",s(e)),n.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(e).join((e=>e.append("circle").attr("r",5).attr("cy",((e,t)=>Math.cos(t*o.P)*-(this._shipCompare.radiusSpeedScale(e.data)??0))).attr("cx",((e,t)=>Math.sin(t*o.P)*(this._shipCompare.radiusSpeedScale(e.data)??0))).attr("fill",(e=>this._shipCompare.colorScale(e.data)??0)).attr("fill",(e=>this._shipCompare.colorScale(e.data)??0)).append("title").text((e=>Math.round(10*e.data)/10+" knots")))),r.this=n,r.compassText=p,n.datum(r).attr("transform",(e=>`rotate(${e.initRotate+90})`)),n.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_printText(){const e=p.getCannonsPerDeck(this.shipData.guns),t=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/f.q4),s=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/f.l9),a=Math.round(this.shipData.crew.max*f.C4),i={attack:(0,u.LQ)(this.shipData.boarding.attack,2),cannonsAccuracy:(0,u.IH)(100*this.shipData.boarding.cannonsAccuracy),defense:(0,u.LQ)(this.shipData.boarding.defense,2),disengageTime:(0,u.yI)(this.shipData.boarding.disengageTime),morale:(0,u.yI)(this.shipData.boarding.morale),musketsAccuracy:(0,u.IH)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:(0,u.yI)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:(0,u.yI)(this.shipData.boarding.prepPerRound),prepInitial:(0,u.yI)(this.shipData.boarding.prepInitial),reload:(0,u.IH)(100*this.shipData.gunnery.reload),penetration:(0,u.IH)(100*this.shipData.gunnery.penetration),dispersionHorizontal:(0,u.IH)(100*this.shipData.gunnery.dispersionHorizontal),dispersionVertical:(0,u.IH)(100*this.shipData.gunnery.dispersionVertical),traverseUpDown:(0,u.IH)(100*this.shipData.gunnery.traverseUpDown),traverseSide:(0,u.IH)(100*this.shipData.gunnery.traverseSide),acceleration:(0,u.$1)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${(0,u.yI)(this.shipData.stern.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:`${(0,u.yI)(this.shipData.repairTime.bow)}`,cannonBroadside:(0,u.yI)(this.shipData.guns.broadside.cannons),cannonsPerDeck:e,carroBroadside:(0,u.yI)(this.shipData.guns.broadside.carronades),deceleration:(0,u.$1)(this.shipData.ship.deceleration),decks:(0,o.gY)(this.shipData.guns.decks,"deck"),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${(0,u.yI)(this.shipData.bow.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:(0,u.$1)(this.shipData.rudder.halfturnTime,4),holdSize:(0,u.yI)(this.shipData.holdSize),hullRepairAmount:`${(0,u.yI)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk))}`,hullRepairsNeeded:`${(0,u.yI)(t)} <span class="badge badge-white">${(0,u.yI)(t*f.XI)}</span>`,leakResistance:(0,u.IH)(100*this.shipData.resistance.leaks),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${(0,u.yI)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${(0,u.yI)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${(0,u.yI)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.mast.topThickness)}</span>`,maxCrew:(0,u.yI)(this.shipData.crew.max),maxSpeed:(0,u.$1)(this.shipData.speed.max,3),maxWeight:(0,u.yI)(this.shipData.maxWeight),minCrew:(0,u.yI)(this.shipData.crew.min),cannonCrew:(0,u.yI)(this.shipData.crew.cannons),carroCrew:(0,u.yI)(this.shipData.crew.carronades),pump:(0,u.yI)(this.shipData.pump.armour),repairTime:`${(0,u.yI)(this.shipData.repairTime.sides)}`,rigRepairAmount:`${(0,u.yI)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk))}`,rigRepairsNeeded:`${(0,u.yI)(s)} <span class="badge badge-white">${(0,u.yI)(s*f.XI)}</span>`,rollAngle:(0,u.yI)(this.shipData.ship.rollAngle),rudder:`${(0,u.yI)(this.shipData.rudder.armour)} <span class="badge badge-white">${(0,u.yI)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${(0,u.yI)(a)} <span class="badge badge-white">${(0,u.yI)(a*f.XI)}</span>`,sailingCrew:(0,u.yI)(this.shipData.crew.sailing??0),sails:(0,u.yI)(this.shipData.sails.armour),shipRating:`${(0,_.hi)(this.shipData.class)} rate`,sideArmor:`${(0,u.yI)(this.shipData.sides.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipData.sides.thickness)}</span>`,splinterResistance:(0,u.IH)(100*this.shipData.resistance.splinter),sternRepair:`${(0,u.yI)(this.shipData.repairTime.stern)}`,structure:(0,u.yI)(this.shipData.structure.armour),turnAcceleration:(0,u.$1)(this.shipData.ship.turnAcceleration,4),turnSpeed:(0,u.$1)(this.shipData.ship.turnSpeed,3),upgradeXP:(0,u.yI)(this.shipData.upgradeXP),waterlineHeight:(0,u.$1)(this.shipData.ship.waterlineHeight),cannonWeight:(0,u.yI)(this.shipData.guns.weight.cannons),carroWeight:(0,u.yI)(this.shipData.guns.weight.carronades)};i.repairWeight=(0,u.yI)((t+s+.1*a)*f.XI),i.gunsFront?i.gunsFront+=` ${p.pd(i.limitFront)}`:i.gunsFront="–",i.gunsBack?i.gunsBack+=` ${p.pd(i.limitBack)}`:i.gunsBack="–",$(`${this.select}`).find("div").append(p.getText(i))}}var S=s(7622),w=s(8823),I=s(3609);function v(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class x extends p{constructor(e,t,s,a){super(e,a),v(this,"shipCompareData",void 0),v(this,"_shipBaseData",void 0),v(this,"_speedScale",void 0),v(this,"_speedDiff",void 0),v(this,"_minSpeedDiff",void 0),v(this,"_maxSpeedDiff",void 0),v(this,"_shipRotate",void 0),v(this,"_speedText",void 0),v(this,"_drag",void 0),v(this,"_windProfile",void 0),v(this,"_gWindProfile",void 0),v(this,"_arcsComp",void 0),this._shipBaseData=t,this.shipCompareData=s,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(e,t){const s=Math.min(e,this._shipCompare.colourScaleSpeedDiff.domain()[0]),a=Math.max(t,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([s,0,a])}_getHeadingInDegrees(e,t){let s=e-t-180;return s<0&&(s+=360),s}_getSpeed(e){return(0,u.$1)(this._speedScale(Math.abs(e))??0)}_getHeadingInCompass(e){return(0,_.tT)(e)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const e=this.shipCompareData.speedDegrees.length,t=360/e,s=[...new Array(e+1)].map(((e,s)=>s*t));this._speedScale=(0,h.Z)().domain(s).range([...this.shipCompareData.speedDegrees,this.shipCompareData.speedDegrees[0]]).clamp(!0);const a=(e,t)=>{const{x:s,y:a}=e;t.rotate=this._getHeadingInDegrees((0,g.Fq)({x:t.initX,y:t.initY},{x:s,y:a}),t.correctionValueDegrees),(()=>{t.this.attr("transform",(e=>`rotate(${e.rotate})`)),t.compassText.attr("transform",(e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.rotate))),this._shipRotate=t.rotate,this._updateSpeedText()})()};this._drag=(0,d.Z)().on("drag",((e,t)=>{a(e,t)})).container((()=>this._mainG.node()))}_setupShipOutline(){this._shipRotate=0;const{shipMass:e}=this.shipCompareData,t=this._shipCompare.shipMassScale(e)??0,s=t,a=this._shipCompare.svgHeight/2-40,i={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:a,speedTextX:0,speedTextY:0,type:"ship"},r=this._mainG.append("g").datum(i).attr("class","ship-outline");r.append("line").attr("x1",(e=>e.initX)).attr("y1",a-20).attr("x2",(e=>e.initX)).attr("y2",(e=>e.initY)),r.append("image").attr("height",t).attr("width",s).attr("x",-t/2).attr("y",-s/2).attr("xlink:href",D()),r.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20).call(this._drag);const o=r.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));this._speedText=r.append("text").attr("x",(e=>e.speedTextX)).attr("y",(e=>e.speedTextY)).attr("transform",(e=>`rotate(${-e.initRotate})`)).text((e=>this._getSpeed(this._shipCompare.windProfileRotate-e.initRotate))),i.this=r,i.compassText=o,r.datum(i).attr("transform",(e=>`rotate(${e.initRotate-90})`)),r.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_drawDifferenceProfile(){const e=(0,i.Z)().sort(null).value(1),t=e(this._shipBaseData.speedDegrees);this._arcsComp=e(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map(((e,t)=>(0,_.qY)(e-this._shipBaseData.speedDegrees[t]))),this._minSpeedDiff=(0,S.Z)(this._speedDiff)??0,this._maxSpeedDiff=(0,w.Z)(this._speedDiff)??0;const s=l.Z,a=(0,c.Z)().angle(((e,t)=>t*o.P)).radius((e=>this._shipCompare.radiusSpeedScale(e.data)??0)).curve(s),r=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-r,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",a(t)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",a(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join((e=>e.append("circle").attr("r",5).attr("cy",((e,t)=>Math.cos(t*o.P)*-(this._shipCompare.radiusSpeedScale(e.data)??0))).attr("cx",((e,t)=>Math.sin(t*o.P)*(this._shipCompare.radiusSpeedScale(e.data)??0))).attr("fill",((e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t])??0)).append("title").text(((e,t)=>`${Math.round(10*e.data)/10} (${(0,u.LQ)(this._speedDiff[t],1)}) knots`)))).select("circle").attr("fill",((e,t)=>this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t])??o.L$))}_injectTextComparison(){function e(e,t,s=0,a=!1){if(e===t)return"";let i,r,o="badge-danger";return a?(i=100*Number.parseFloat((t-e).toFixed(s)),r=(0,u.$1)(Math.abs(i))):0===e||0===t?(i=t-e,r=(0,u.$1)(Math.abs(i))):(i=1-e/t,r=(0,u.T3)(Math.abs(i),0)),i<0&&(o="badge-success"),`<span class="badge ${o}">${r}</span>`}const t=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.q4),s=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.l9),a=Math.round(this._shipBaseData.crew.max*f.C4),i=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.q4),r=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.l9),n=Math.round(this.shipCompareData.crew.max*f.C4),d={morale:`${(0,u.yI)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${(0,u.IH)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${(0,u.yI)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${(0,u.LQ)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${(0,u.LQ)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${(0,u.yI)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${(0,u.yI)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${(0,u.yI)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${(0,u.IH)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,reload:`${(0,u.IH)(100*this.shipCompareData.gunnery.reload)} ${e(this._shipBaseData.gunnery.reload,this.shipCompareData.gunnery.reload,3,!0)}`,penetration:`${(0,u.IH)(100*this.shipCompareData.gunnery.penetration)} ${e(this.shipCompareData.gunnery.penetration,this._shipBaseData.gunnery.penetration,3,!0)}`,dispersionHorizontal:`${(0,u.IH)(100*this.shipCompareData.gunnery.dispersionHorizontal)} ${e(this._shipBaseData.gunnery.dispersionHorizontal,this.shipCompareData.gunnery.dispersionHorizontal,3,!0)}`,dispersionVertical:`${(0,u.IH)(100*this.shipCompareData.gunnery.dispersionVertical)} ${e(this._shipBaseData.gunnery.dispersionVertical,this.shipCompareData.gunnery.dispersionVertical,3,!0)}`,traverseUpDown:`${(0,u.IH)(100*this.shipCompareData.gunnery.traverseUpDown)} ${e(this.shipCompareData.gunnery.traverseUpDown,this._shipBaseData.gunnery.traverseUpDown,3,!0)}`,traverseSide:`${(0,u.IH)(100*this.shipCompareData.gunnery.traverseSide)} ${e(this.shipCompareData.gunnery.traverseSide,this._shipBaseData.gunnery.traverseSide,3,!0)}`,acceleration:`${(0,u.$1)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${(0,u.yI)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:p.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${(0,u.$1)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${(0,u.yI)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${(0,u.$1)(this.shipCompareData.ship.turnAcceleration)} ${e(this.shipCompareData.ship.turnAcceleration,this._shipBaseData.ship.turnAcceleration,2)}`,turnSpeed:`${(0,u.$1)(this.shipCompareData.ship.turnSpeed,3)} ${e(this.shipCompareData.ship.turnSpeed,this._shipBaseData.ship.turnSpeed,2)}`,decks:(0,o.gY)(this.shipCompareData.guns.decks,"deck"),firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${(0,u.yI)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${(0,u.$1)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${(0,u.yI)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${(0,u.yI)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${(0,u.yI)(i)} <span class="badge badge-white">${(0,u.yI)(i*f.XI)}</span>`,leakResistance:`${(0,u.IH)(100*this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${(0,u.yI)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${(0,u.yI)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${(0,u.yI)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${(0,u.yI)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${(0,u.$1)(this.shipCompareData.speed.max,3)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxWeight:`${(0,u.yI)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:(0,u.yI)(this.shipCompareData.crew.min),cannonCrew:`${(0,u.yI)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${(0,u.yI)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${(0,u.$1)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${(0,u.yI)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${(0,u.yI)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${(0,u.yI)(r)} <span class="badge badge-white">${(0,u.yI)(r*f.XI)}</span>`,rumRepairsNeeded:`${(0,u.yI)(n)} <span class="badge badge-white">${(0,u.yI)(n*f.XI)}</span>`,sailingCrew:`${(0,u.yI)(this.shipCompareData.crew.sailing)}`,sails:`${(0,u.yI)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:`${(0,_.hi)(this.shipCompareData.class)} rate`,sideArmor:`${(0,u.yI)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${(0,u.yI)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${(0,u.IH)(100*this.shipCompareData.resistance.splinter)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${(0,u.yI)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${(0,u.yI)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${(0,u.$1)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${(0,u.yI)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${(0,u.yI)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${(0,u.yI)((i+r+.1*n)*f.XI)} ${e((t+s+.1*a)*f.XI,(i+r+.1*n)*f.XI)}`,d.gunsFront?d.gunsFront+=` ${p.pd(d.limitFront)}`:d.gunsFront="–",d.gunsBack?d.gunsBack+=` ${p.pd(d.limitBack)}`:d.gunsBack="–",I(`${this.select}`).find("div").append(p.getText(d))}}s(6801),s(7424),s(300);var k=s(274),A=s(6301),P=s(7484),B=s.n(P),T=s(285),M=s.n(T),R=s(178),W=s.n(R),N=s(2855),H=s(4738),L=s(2619),V=s(3609);function Z(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function j(e,t){var s=t.get(e);if(!s)throw new TypeError("attempted to get private field on non-instance");return s.get?s.get.call(e):s.value}function F(e,t,s){var a=t.get(e);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(e,s);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=s}return s}B().extend(M()),B().extend(W());var X=new WeakMap,U=new WeakMap;class z{constructor(e="ship-compare"){Z(this,"colorScale",void 0),Z(this,"colourScaleSpeedDiff",void 0),Z(this,"columnsCompare",void 0),Z(this,"innerRadius",void 0),Z(this,"outerRadius",void 0),Z(this,"radiusSpeedScale",void 0),Z(this,"selectedShips",void 0),Z(this,"singleShipData",void 0),Z(this,"shipMassScale",void 0),Z(this,"svgHeight",void 0),Z(this,"svgWidth",void 0),Z(this,"windProfileRotate",0),Z(this,"woodCompare",void 0),X.set(this,{writable:!0,value:void 0}),U.set(this,{writable:!0,value:void 0}),Z(this,"_maxSpeed",void 0),Z(this,"_minSpeed",void 0),Z(this,"_modal$",{}),Z(this,"_modifierAmount",new Map),Z(this,"_moduleAndWoodCaps",void 0),Z(this,"_moduleAndWoodChanges",void 0),Z(this,"_moduleDataDefault",void 0),Z(this,"_moduleProperties",void 0),Z(this,"_moduleTypes",void 0),Z(this,"_selectedUpgradeIdsList",{}),Z(this,"_selectedUpgradeIdsPerType",{}),Z(this,"_selectModule$",{}),Z(this,"_selectShip$",{}),Z(this,"_selectWood$",{}),Z(this,"_shipData",void 0),Z(this,"_shipIds",{}),Z(this,"_shipSelectData",void 0),Z(this,"_baseId",void 0),Z(this,"_baseName",void 0),Z(this,"_buttonId",void 0),Z(this,"_columns",void 0),Z(this,"_copyButtonId",void 0),Z(this,"_cloneLeftButtonId",void 0),Z(this,"_cloneRightButtonId",void 0),Z(this,"_imageButtonId",void 0),Z(this,"_modalId",void 0),Z(this,"_moduleId",void 0),Z(this,"_woodId",void 0),this._baseId=e,this._baseName="Compare ships",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._moduleId=`${this._baseId}-module`,this._copyButtonId=`button-copy-${this._baseId}`,this._cloneLeftButtonId=`button-clone-left-${this._baseId}`,this._cloneRightButtonId=`button-clone-right-${this._baseId}`,this._imageButtonId=`button-image-${this._baseId}`,this.colourScaleSpeedDiff=(0,h.Z)().range([o.gc,o.L$,o.fy]).interpolate(A.Z),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(e){return e<=3?"L":e<=5?"M":"S"}static _adjustAbsolute(e,t){return e?e+t:t}static _adjustPercentage(e,t,s){return s?e?e*(1+t):t:e?e+t:t}static _getModifierFromModule(e){return`<p class="mb-0">${e.map((e=>{let t;return t=e.isPercentage?(0,u.xp)(e.amount/100):e.amount<1&&e.amount>0?(0,u.nM)(e.amount,1):(0,u.LQ)(e.amount,2),`${e.modifier} ${t}`})).join("<br>")}</p>`}static _setSelect(e,t){let s;s=Array.isArray(t)?t.map((e=>String(e))):String(t),s&&e.val(s),e.selectpicker("render")}static _saveCanvasAsImage(e){const t=`na-map ship compare ${B().utc().format("YYYY-MM-DD HH-mm-ss")}.png`,s=document.createElement("a");s.href=e,s.download=t,document.body.append(s),s.click(),s.remove()}_getShipId(e){return this._shipIds[e]}_setShip(e,t){this._shipIds[e]=t,z._setSelect(this._selectShip$[e],t),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects()}_cloneShipData(e,t){const s=this._getShipId(e);return s&&this._setShip(t,s),void 0!==s}_getWoodId(e,t){return Number(this._selectWood$[e][t].val())}_setWood(e,t,s){z._setSelect(this._selectWood$[e][t],s),this.woodCompare._woodSelected(e,t,this._selectWood$[e][t])}_cloneWoodData(e,t){if(this.woodCompare.enableSelects(t),""!==this._selectWood$[e].frame.val())for(const s of m.Kf){const a=this._getWoodId(e,s);this._setWood(t,s,a)}}_getModuleIds(e,t){return this._selectedUpgradeIdsPerType[e][t]}_setModules(e,t,s){this._selectedUpgradeIdsPerType[e]||(this._selectedUpgradeIdsPerType[e]={}),this._selectedUpgradeIdsList[e]||(this._selectedUpgradeIdsList[e]=[]),this._selectedUpgradeIdsPerType[e][t]=s.map((e=>Number(e))),z._setSelect(this._selectModule$[e][t],this._selectedUpgradeIdsPerType[e][t]),this._selectedUpgradeIdsList[e].push(...this._selectedUpgradeIdsPerType[e][t])}_cloneModuleData(e,t){if(this._setupModulesSelect(t),this._selectedUpgradeIdsPerType[e])for(const s of[...this._moduleTypes]){const a=this._getModuleIds(e,s);this._setModules(t,s,a)}}_cloneShipToLeft(e){const t=this._columns.findIndex((t=>t===e)),s=this._columns[t-1];this._cloneShipData(e,s)&&(this._cloneWoodData(e,s),this._cloneModuleData(e,s),this._refreshShips(s))}_cloneShipToRight(e){const t=this._columns.findIndex((t=>t===e)),s=this._columns[t+1];this._cloneShipData(e,s)&&(this._cloneWoodData(e,s),this._cloneModuleData(e,s),this._refreshShips(s))}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(e){await this._loadAndSetupData();const t=f.PD.decode(e.get("cmp")??"");t.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(t),this._setModuleSelects(e))}_setupArrow(){const e=document.querySelector("#journey-arrow");if(e){const t=e.cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");const s=document.querySelector("#na-map svg defs");s&&s.append(t)}}_setupData(){this._moduleAndWoodChanges=new Map([["Cannon horizontal dispersion",{properties:["gunnery.dispersionHorizontal"],isBaseValueAbsolute:!0}],["Cannon vertical dispersion",{properties:["gunnery.dispersionVertical"],isBaseValueAbsolute:!0}],["Cannon reload time",{properties:["gunnery.reload"],isBaseValueAbsolute:!0}],["Cannon ball penetration",{properties:["gunnery.penetration"],isBaseValueAbsolute:!0}],["Cannon side traverse",{properties:["gunnery.traverseSide"],isBaseValueAbsolute:!0}],["Cannon up/down traverse",{properties:["gunnery.traverseUpDown"],isBaseValueAbsolute:!0}],["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Turn speed",{properties:["ship.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),F(this,X,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:1,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:18,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const e=1.2*((0,S.Z)(this._shipData,(e=>e.speed.min))??0),t=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=e,this._maxSpeed=t,this.colorScale=(0,h.Z)().domain([this._minSpeed,0,this._maxSpeed]).range([o.gc,o.L$,o.fy]).interpolate(A.Z);const s=(0,S.Z)(this._shipData,(e=>e.shipMass))??0,a=(0,w.Z)(this._shipData,(e=>e.shipMass))??0;this.shipMassScale=(0,h.Z)().domain([s,a]).range([100,150])}async _loadAndSetupData(){this._moduleDataDefault=(await s.e(303).then(s.t.bind(s,7728,19))).default,this._shipData=(await s.e(228).then(s.t.bind(s,4237,19))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new L.Z(this._woodId),await this.woodCompare.woodInit())}_setupListener(){let e=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,N.KS)("Tools",this._baseName),this._shipCompareSelected()}))}_setGraphicsParameters(){this.svgWidth=V(`#${this._modalId} .column-base`).width()??0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=(0,h.Z)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(e){return this._shipData.find((t=>t.id===e))?.name??""}_getSelectedData(e){const t={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[e]){t.ship=this._getShipName(this._shipIds[e]);for(const s of m.Kf)t.wood.push(this.woodCompare.getWoodName(s,Number(this._selectWood$[e][s].val())));if(this._selectedUpgradeIdsPerType[e])for(const s of[...this._moduleTypes]){const a=[];for(const t of this._selectedUpgradeIdsPerType[e][s])a.push(this._moduleProperties.get(t)?.name.replace(" Bonus","")??"");t.moduleData.set(s,a.join(", "))}}return t}_printSelectedData(e,t,s){const i=e.querySelectorAll(`#${this._baseId}-${s.toLowerCase()} label`),r=i[0].parentNode,o=i[0].offsetHeight;for(const e of i)e.remove();const n=(0,a.Z)(r).insert("div",":first-child").style("height",5*o+"px");t.ship&&n.append("div").style("margin-bottom","5px").style("line-height","1.1").text(t.ship),""!==t.wood[0]&&n.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(t.wood.join(" | "));for(const[e,s]of t.moduleData)""!==s&&n.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${e}</em>: ${s}`)}_replaceSelectsWithText(e){for(const t of this._columns){const s=this._getSelectedData(t);this._printSelectedData(e,s,t)}}_setMakeImageSpinner(){j(this,U).select("i").remove(),j(this,U).attr("class","btn btn-primary").property("disabled",!0),j(this,U).append("span").attr("class","spinner-border spinner-border-sm").attr("role","status").attr("aria-hidden","true"),j(this,U).append("span").attr("class","sr-only").text("Loading...")}_unsetMakeImageSpinner(){j(this,U).selectAll("span").remove(),j(this,U).attr("class","btn btn-outline-secondary icon-outline-button").property("disabled",!1),j(this,U).append("i").attr("class","icon icon-image")}async _makeImage(e){e.preventDefault(),this._setMakeImageSpinner();const t=await s.e(5).then(s.t.bind(s,1120,23)),a=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(a){const e=await t.default(a,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:e=>e.classList.contains("central")||e.classList.contains("overlay")||e.classList.contains("navbar"),logging:!0,onclone:e=>{this._replaceSelectsWithText(e)},x:0,y:0});z._saveCanvasAsImage(e.toDataURL())}this._unsetMakeImageSpinner()}_shipCompareSelected(){(0,m.xb)(this._modal$)&&(this._initModal(),this._modal$=V(`#${this._modalId}`),document.querySelector(`#${this._modalId}`)?.addEventListener("keydown",(e=>{"KeyC"===e.key&&e.ctrlKey&&this._copyDataClicked(e)})),document.querySelector(`#${this._copyButtonId}`)?.addEventListener("click",(e=>{this._copyDataClicked(e)})),document.querySelector(`#${this._imageButtonId}`)?.addEventListener("click",(async e=>{(0,N.KS)("Menu","Ship compare image"),await this._makeImage(e)}))),this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];for(const t of this._columns){const s=this._getShipId(t);if(s){e.push(s);for(const s of m.Kf){const a=this._getWoodId(t,s);e.push(a)}}}return e}_copyDataClicked(e){(0,N.KS)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length>0){const e=new URL(window.location.href);e.searchParams.set("v",encodeURIComponent(o.f4)),e.searchParams.set("cmp",f.PD.encode(t));for(const t of this._columns){const s=this._columns.indexOf(t);if(this._selectedUpgradeIdsPerType[t])for(const a of[...this._moduleTypes]){const i=this._getModuleIds(t,a),r=[...this._moduleTypes].indexOf(a);if(i?.length){const t=`${s}${r}`;e.searchParams.set(t,f.PD.encode(i))}}}(0,g.vQ)(e.href,this._modal$)}}_setupShipData(){this._shipSelectData=[...(0,k.ZP)(this._shipData,(e=>e.class))].map((([e,t])=>({key:e,values:t.map((e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns.total}))).sort((0,H.MR)(["name"]))}))).sort((0,H.MR)(["key"]))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap((e=>e[1].filter((e=>e.properties.some((e=>this._moduleAndWoodChanges.has(e.modifier))))).map((e=>[e.id,e]))))),this._moduleTypes=new Set([...this._moduleProperties].map((e=>e[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,""))))}_injectModal(){(0,o.Eu)({id:this._modalId,title:this._baseName});const e=(0,a.Z)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const t of this._columns){const s=e.append("div").attr("id",`${this._baseId}-${t.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),a=this._getShipSelectId(t),i=s.append("div").attr("class","input-group justify-content-between mb-1");t!==this._columns[0]&&i.append("div").attr("class","input-group-prepend").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneLeftButtonId}-${t}`).attr("title","Clone ship to left").attr("type","button").append("i").attr("class","icon icon-clone-left"),i.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker"),t!==this.columnsCompare[this.columnsCompare.length-1]&&i.append("div").attr("class","input-group-append").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneRightButtonId}-${t}`).attr("title","Clone ship to right").attr("type","button").append("i").attr("class","icon icon-clone-right");const r=s.append("div").attr("class","input-group justify-content-between mb-1");for(const e of m.Kf){const s=this._getWoodSelectId(e,t);r.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}const o=s.append("div").attr("class","input-group justify-content-between");for(const e of this._moduleTypes){const s=this._getModuleSelectId(e,t);o.append("label").attr("class","mb-1").append("select").attr("name",s).attr("id",s).property("multiple",!0).attr("class","selectpicker")}s.append("div").attr("id",`${this._baseId}-${t}`).attr("class",("Base"===t?"ship-base":"ship-compare")+" compress")}const t=(0,a.Z)(`#${this._modalId} .modal-footer`);t.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").attr("class","icon icon-copy"),F(this,U,t.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._imageButtonId).attr("title","Make image").attr("type","button")),j(this,U).append("i").attr("class","icon icon-image")}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const t of m.Kf)this._selectWood$[e][t]=V(`#${this._getWoodSelectId(t,e)}`),this.woodCompare._setupWoodSelects(e,t,this._selectWood$[e][t])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initCloneListeners(){for(const e of this._columns)e!==this._columns[0]&&document.querySelector(`#${this._cloneLeftButtonId}-${e}`)?.addEventListener("click",(()=>{this._cloneShipToLeft(e)})),e!==this.columnsCompare[this.columnsCompare.length-1]&&document.querySelector(`#${this._cloneRightButtonId}-${e}`)?.addEventListener("click",(()=>{this._cloneShipToRight(e)}))}_initModal(){this._initData(),this._injectModal(),this._initSelects(),this._initCloneListeners()}_getShipOptions(){return this._shipSelectData.map((e=>`<optgroup label="${(0,_.hi)(Number(e.key),!1)} rate">${e.values.map((e=>`<option data-subtext="${e.battleRating} ${(0,f.WP)(e.name)?"Imported":""}" value="${e.id}">${(0,f.td)(e.name)} (${e.guns})`)).join("</option>")}`)).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=V(`#${this._getShipSelectId(e)}`);const t=this._getShipOptions();this._selectShip$[e].append(t),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(e,t){const s=[...this._moduleProperties].filter((s=>s[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===e&&("U"===s[1].moduleLevel||s[1].moduleLevel===z._getModuleLevel(t)))),a=[...(0,k.ZP)(s,(e=>e[1].type.replace(/[\sA-Za-z]+\s–\s/,"")))].map((([e,t])=>({key:e,values:t.sort(((e,t)=>e[1].name.localeCompare(t[1].name)))}))).sort((0,H.MR)(["key"]));let i;const r=new Set(["Permanent","Ship trim"]);return i=a.length>1?a.map((t=>`<optgroup label="${t.key}" data-max-options="${r.has(e.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${t.values.map((e=>`<option value="${e[0]}">${e[1].name}`)).join("</option>")}`)).join("</optgroup>"):a.map((e=>`${e.values.map((e=>`<option value="${e[0]}">${e[1].name}`)).join("</option>")}`)).join(""),i}_fillModuleSelect(e,t){const s=this._getUpgradesOptions(t,(()=>this._shipData.find((t=>t.id===this._shipIds[e])).class)());this._selectModule$[e][t].find("option").remove(),this._selectModule$[e][t].append(s)}_resetModuleSelects(e){for(const t of this._moduleTypes)this._fillModuleSelect(e,t),this._selectModule$[e][t].selectpicker("refresh")}_getModuleFromName(e){let t={};return this._moduleDataDefault.some((s=>(t=s[1].find((t=>t.name===e)),Boolean(t)))),t}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const t of this._moduleTypes){const s=new Map;this._selectModule$[e][t]=V(`#${this._getModuleSelectId(t,e)}`),this._selectModule$[e][t].on("changed.bs.select",(()=>{this._modulesSelected(e),this._refreshShips(e)})).on("show.bs.select",(e=>{const t=V(e.currentTarget);t.parent().find("button.bs-select-all").remove();for(const e of t.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const t=this._getModuleFromName(e.textContent);V(e).attr("data-original-title",z._getModifierFromModule(t.properties)).tooltip({boundary:"viewport",html:!0}).on("show.bs.tooltip",(()=>{s.set(t.id,V(e))})).on("hide.bs.tooltip",(()=>{s.set(t.id,null)}))}})).selectpicker({actionsBox:!0,countSelectedText:e=>`${e} ${t.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:t.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:`${t}`,width:"150px"}).on("hide.bs.select",(()=>{for(const[,e]of s)e&&e.tooltip("hide");s.clear()}))}}this._resetModuleSelects(e)}_getShipData(e){const t=this._shipData.find((t=>t.id===this._shipIds[e]));t.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:t.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:t.boarding.prepInitial,prepPerRound:t.boarding.prepPerRound};let s=t;return s.repairAmount={armour:f.ZT,armourPerk:0,sails:f.i6,sailsPerk:0},s.repairTime={sides:f.OI,default:f.OI},s.resistance={leaks:0,splinter:0},s.gunnery={dispersionHorizontal:0,dispersionVertical:0,penetration:0,reload:0,traverseUpDown:0,traverseSide:0},s=this._addModulesAndWoodData(t,s,e),s}_roundPropertyValue(e,t,s=!1){return Number.isInteger(e)&&!s?Math.round(t):Math.trunc(100*t)/100}_adjustValue(e,t,s){let a=e;if(0!==this._modifierAmount.get(t)?.percentage){const e=this._modifierAmount.get(t).percentage/100;a=z._adjustPercentage(a,e,s)}if(0!==this._modifierAmount.get(t)?.absolute){const{absolute:e}=this._modifierAmount.get(t);a=z._adjustAbsolute(a,e)}const i=j(this,X).has(t)||s||0===e;return this._roundPropertyValue(e,a,i)}_setModifier(e){let t=e.isPercentage?0:e.amount,s=e.isPercentage?e.amount:0;this._modifierAmount.has(e.modifier)&&(t+=this._modifierAmount.get(e.modifier)?.absolute??0,s+=this._modifierAmount.get(e.modifier)?.percentage??0),this._modifierAmount.set(e.modifier,{absolute:t,percentage:s})}_showCappingAdvice(e,t){const s=`${this._baseId}-${e}-capping`;let a=document.querySelector(`#${s}`);if(!a){a=document.createElement("p"),a.id=s,a.className="alert alert-warning";document.querySelector(`#${this._baseId}-${e}`)?.firstChild?.after(a)}a.innerHTML=`${[...t].join(", ")} capped`}_removeCappingAdvice(e){const t=`${this._baseId}-${e}-capping`,s=document.querySelector(`#${t}`);s&&s.remove()}_addModulesAndWoodData(e,t,s){const a=JSON.parse(JSON.stringify(t)),i=()=>{a.speedDegrees=a.speedDegrees.map((e=>{const t=1+this._modifierAmount.get("Max speed").percentage/100,s=e>0?e*t:e/t;return Math.max(Math.min(s,this._maxSpeed),this._minSpeed)}))};return this._modifierAmount=new Map,(()=>{for(const e of this._selectedUpgradeIdsList[s]){const t=this._moduleProperties.get(e);for(const e of t.properties)this._moduleAndWoodChanges.has(e.modifier)&&this._setModifier(e)}if(this.woodCompare.instances[s]){let e="_woodData";"Base"!==s&&(e="_compareData");for(const t of m.Kf)for(const a of this.woodCompare.instances[s][e][t].properties)this._moduleAndWoodChanges.has(a.modifier)&&this._setModifier(a)}})(),(()=>{for(const[e]of this._modifierAmount.entries())if(this._moduleAndWoodChanges.get(e)?.properties){const{properties:t,isBaseValueAbsolute:s}=this._moduleAndWoodChanges.get(e);for(const i of t){const t=i.split(".");t.length>1?a[t[0]][t[1]]=this._adjustValue(a[t[0]][t[1]],e,s):a[t[0]]=this._adjustValue(a[t[0]],e,s)}}})(),(()=>{const t={isCapped:!1,modifiers:new Set},i=(e,s,a,{amount:i,isPercentage:r})=>{const o=Math.min(s,r?this._roundPropertyValue(a,a*(1+i)):i);return s>o&&(t.isCapped=!0,t.modifiers.add(e)),o};for(const[t]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(t)){const{cap:s}=this._moduleAndWoodCaps.get(t);for(const r of this._moduleAndWoodCaps.get(t).properties){const o=r.split(".");o.length>1?a[o[0]][o[1]]&&(a[o[0]][o[1]]=i(t,a[o[0]][o[1]],e[o[0]][o[1]],s)):a[o[0]]&&(a[o[0]]=i(t,a[o[0]],e[o[0]],s))}}t.isCapped?this._showCappingAdvice(s,t.modifiers):this._removeCappingAdvice(s)})(),this._modifierAmount.has("Max speed")&&i(),a}_updateDifferenceProfileNeeded(e){"Base"===e||(0,m.xb)(this.selectedShips[e])||this.selectedShips[e].updateDifferenceProfile()}_updateSailingProfile(e){this._updateDifferenceProfileNeeded(e);for(const t of this.columnsCompare)t!==e&&this._updateDifferenceProfileNeeded(t)}_refreshShips(e){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find((t=>t.id===this._shipIds[e]));else{this._modulesSelected(e);const t=this._getShipData(e);if("Base"===e){this._setSelectedShip(e,new C(e,t,this));for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),(0,m.xb)(this.selectedShips[e])||this._setSelectedShip(e,new x(e,t,this.selectedShips[e].shipCompareData,this))}else this._setSelectedShip(e,new x(e,this.selectedShips.Base.shipData,t,this));this._updateSailingProfile(e)}}_enableCompareSelects(){for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={};for(const t of this._moduleTypes)this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map((e=>Number(e))):this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t]?[Number(this._selectedUpgradeIdsPerType[e][t])]:[],this._selectedUpgradeIdsPerType[e][t].length>0&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))}_setupSelectListener(e){if(this._selectShip$[e].selectpicker({title:"Ship"}).on("changed.bs.select",(()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(e),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(e)})),"ship-journey"!==this._baseId)for(const t of m.Kf)this._selectWood$[e][t].on("changed.bs.select",(()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)})).selectpicker({title:`Wood ${t}`,width:"150px"})}_setShipAndWoodsSelects(e){let t=0;this._columns.some((s=>{if(!this._shipData.find((s=>s.id===e[t])))return!1;if(this._setShip(s,e[t]),t+=1,this.woodCompare.enableSelects(s),this._setupModulesSelect(s),e[t])for(const a of m.Kf)this._setWood(s,a,e[t]),t+=1;else t+=2;return this._refreshShips(s),t>=e.length}))}_setModuleSelects(e){for(const t of this._columns){const s=this._columns.indexOf(t);let a=!1;for(const i of[...this._moduleTypes]){const r=[...this._moduleTypes].indexOf(i);if(e.has(`${s}${r}`)){const o=f.PD.decode(e.get(`${s}${r}`));this._setModules(t,i,o),a=!0}}a&&this._refreshShips(t)}}_getShipSelectId(e){return`${this._baseId}-${e}-select`}_getWoodSelectId(e,t){return`${this._woodId}-${e}-${t}-select`}_getModuleSelectId(e,t){return`${this._moduleId}-${e.replace(/\s/,"")}-${t}-select`}_setSelectedShip(e,t){this.selectedShips[e]=t}}},2619:(e,t,s)=>{s.d(t,{Z:()=>g});s(6801),s(7424),s(300);var a=s(7622),i=s(8823),r=s(4017),o=s(2855),n=s(2157),p=s(9022),d=s(7015),h=s(4738),l=s(3609);function c(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class m{constructor(e,t){c(this,"select",void 0),c(this,"_woodCompare",void 0),c(this,"_id",void 0),c(this,"_g",void 0),this._id=e,this._woodCompare=t,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=(0,r.Z)(this.select).select("g")}_setupMainDiv(){(0,r.Z)(`${this.select} div`).remove(),(0,r.Z)(this.select).append("div")}}class u extends m{constructor(e,t,s){super(e,s),c(this,"_woodData",{}),this._woodData=t,this._printText()}_getProperty(e,t){const s=this._woodData[t].properties.find((t=>t.modifier===e));let a=0,i=!1;return s?.amount&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),s=this._getProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';t+="<tr>",t+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[s,a]of e.properties){if(t+=`<tr><td>${s}</td><td>${a.isPercentage?(0,d.T3)(a.amount/100):(0,d.$1)(a.amount)}`,t+='<span class="rate">',a.amount>0){t+='<span class="bar neutral" style="width:50%;"></span>',t+=`<span class="bar pos diff" style="width:${a.amount/(this._woodCompare.minMaxProperty.get(s)?.max??1)*50}%;"></span>`}else if(a.amount<0){const e=a.amount/(this._woodCompare.minMaxProperty.get(s)?.min??1)*50;t+=`<span class="bar neutral" style="width:${50-e}%;"></span>`,t+=`<span class="bar neg diff" style="width:${e}%;"></span>`}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}return t+="</tbody></table>",t}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const s=this._getPropertySum(t);e.properties.set(t,{amount:s.amount,isPercentage:s.isPercentage})}l(`${this.select}`).find("div").append(this._getText(e))}}class _ extends m{constructor(e,t,s,a){super(e,a),c(this,"_baseData",void 0),c(this,"_compareData",void 0),this._baseData=t,this._compareData=s,this._printTextComparison()}static _getDiff(e,t,s,a=1){const i=Number.parseFloat((e-t).toFixed(a));return`${s?(0,d.T3)(e/100,a):(0,d.$1)(e)} <span class="badge badge-white">${(0,d.LQ)(i)}</span>`}_getBaseProperty(e,t){const s=this._baseData[t].properties.find((t=>t.modifier===e));let a=0,i=!1;return s?.amount&&({amount:a,isPercentage:i}=s),{amount:a,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),s=this._getBaseProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(e,t){const s=this._compareData[t].properties.find((t=>t.modifier===e));let a=0,i=!1;return s?.amount&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),s=this._getCompareProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:t.isPercentage&&s.isPercentage}}_getText(e){const t=50;let s=0,a=0,i=0,r="",o='<table class="table table-sm table-striped small wood mt-4"><thead>';o+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[n,p]of e.properties)o+=`<tr><td>${n}</td><td>${_._getDiff(p.compare,p.base,p.isPercentage)}`,o+='<span class="rate">',p.compare>=0?(p.base>=0?p.compare>p.base?(s=p.base,a=p.compare-p.base,r="pos"):(s=p.compare,a=p.base-p.compare,r="neg"):(s=0,a=p.compare,r="pos"),o+='<span class="bar neutral" style="width:50%;"></span>',o+=`<span class="bar pos diff" style="width:${s/(this._woodCompare.minMaxProperty.get(n)?.max??1)*t}%;"></span>`,o+=`<span class="bar ${r}" style="width:${a/(this._woodCompare.minMaxProperty.get(n)?.max??1)*t}%;"></span>`):p.compare<0?(p.base<0?p.compare>=p.base?(s=p.compare,a=p.base-p.compare,i=-p.base,r="pos"):(s=p.base,a=p.compare-p.base,i=-p.compare,r="neg"):(s=0,a=p.compare,i=-p.compare,r="neg"),o+=`<span class="bar neutral" style="width:${t+i/(this._woodCompare.minMaxProperty.get(n)?.min??1)*t}%;"></span>`,o+=`<span class="bar ${r}" style="width:${a/(this._woodCompare.minMaxProperty.get(n)?.min??1)*t}%;"></span>`,o+=`<span class="bar neg diff" style="width:${s/(this._woodCompare.minMaxProperty.get(n)?.min??1)*t}%;"></span>`):o+='<span class="bar neutral"></span>',o+="</span></td></tr>";return o+="</tbody></table>",o}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const s=this._getBasePropertySum(t),a=this._getComparePropertySum(t);e.properties.set(t,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}l(`${this.select}`).find("div").append(this._getText(e))}}class g{constructor(e){c(this,"baseFunction",void 0),c(this,"instances",{}),c(this,"minMaxProperty",new Map),c(this,"propertyNames",void 0),c(this,"_baseName",void 0),c(this,"_baseId",void 0),c(this,"_buttonId",void 0),c(this,"_modalId",void 0),c(this,"_woodData",void 0),c(this,"_columnsCompare",void 0),c(this,"_defaultWoodId",{}),c(this,"_columns",void 0),c(this,"_frameSelectData",void 0),c(this,"_trimSelectData",void 0),c(this,"_options",{}),c(this,"_woodIdsSelected",{}),this.baseFunction=e,this._baseName="Compare woods",this._baseId=`${this.baseFunction}-compare`,this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(e,t){return this._woodData[e].find((e=>e.id===t))?.name??""}_findWoodId(e,t){return this._woodData[e].find((e=>e.name===t))?.id??0}_setupData(){this.propertyNames=new Set([...this._woodData.frame.flatMap((e=>e.properties.map((e=>e.modifier)))),...this._woodData.trim.flatMap((e=>e.properties.map((e=>e.modifier))))].sort(h.I4)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){this._woodData=(await s.e(799).then(s.t.bind(s,7384,19))).default,this._setupData()}_setupListener(){let e=!0;document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(async()=>{e&&(e=!1,await this._loadAndSetupData()),(0,o.KS)("Tools",this._baseName),this._woodCompareSelected()}))}_woodCompareSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),l(`#${this._modalId}`).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort((0,h.MR)(["name"])),this._trimSelectData=this._woodData.trim.sort((0,h.MR)(["name"])),this._setOption(this._frameSelectData.map((e=>`<option value="${e.id}">${e.name}</option>`)).toString(),this._trimSelectData.map((e=>`<option value="${e.id}">${e.name}</option>`)).toString());for(const e of this.propertyNames){const t=[...this._woodData.frame.map((t=>t.properties.find((t=>t.modifier===e))?.amount??0))],s=[...this._woodData.trim.map((t=>t.properties.find((t=>t.modifier===e))?.amount??0))],r=(0,a.Z)(t)??0,o=(0,i.Z)(t)??0,n=(0,a.Z)(s)??0,p=(0,i.Z)(s)??0;this._addMinMaxProperty(e,{min:r+n>=0?0:r+n,max:o+p})}}_injectModal(){(0,p.Eu)({id:this._modalId,title:this._baseName});const e=(0,r.Z)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const t of this._columns){const s=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));for(const e of n.Kf){const a=`${this.baseFunction}-${e}-${t}-select`;s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}s.append("div").attr("id",`${this.baseFunction}-${t}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const t of n.Kf){const s=l(`#${this.baseFunction}-${t}-${e}-select`);this._setupWoodSelects(e,t,s),this._setupSelectListener(e,t,s)}}_setWoodsSelected(e,t,s){this._woodIdsSelected[e]||(this._woodIdsSelected[e]={}),this._woodIdsSelected[e][t]=s}_setupWoodSelects(e,t,s){this._setWoodsSelected(e,t,this._defaultWoodId[t]),s.append(this._options[t]),("wood"!==this.baseFunction||"Base"!==e&&"wood"===this.baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(e,t){const s="frame"===t?"trim":"frame";this._woodIdsSelected[e][s]===this._defaultWoodId[s]&&l(`#${this.baseFunction}-${s}-${e}-select`).val(this._defaultWoodId[s]).selectpicker("refresh")}enableSelects(e){for(const t of n.Kf)l(`#${this.baseFunction}-${t}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(e,t,s){const a=Number(s.val());if(this._setWoodsSelected(e,t,a),this._setOtherSelect(e,t),"Base"===e){this._addInstance(e,new u("Base",this._getWoodData("Base"),this));for(const e of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(e),this.instances[e]&&this._addInstance(e,new _(e,this._getWoodData("Base"),this._getWoodData(e),this))}else this._addInstance(e,new _(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,s){s.on("change",(()=>{this._woodSelected(e,t,s)})).selectpicker({title:`Select ${t}`})}_getWoodData(e){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[e].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[e].trim)}}_addMinMaxProperty(e,t){this.minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this.instances[e]=t}getWoodTypeData(e,t){return this._woodData[e].find((e=>e.id===t))??{}}}},1198:(e,t,s)=>{s.d(t,{nD:()=>n,Iy:()=>p,tj:()=>d,Fq:()=>h,xp:()=>l,$G:()=>c,ec:()=>m,Mo:()=>u,vQ:()=>_,A1:()=>g,GZ:()=>f,yb:()=>b,wo:()=>D});var a=s(1138),i=s(9022),r=s(393),o=s(3609);const n=(e,t=!1)=>{let s;return s=Number.isNaN(Number(e))?e:(0,r.tT)(Number(e)),`<${t?"tspan":"span"} class="caps">${s}</${t?"tspan":"span"}>`},p=(e,t=!1)=>{let s,a;return Number.isNaN(Number(e))?(s=e,a=(0,r.Ri)(s)%r.QF):(a=Number(e),s=(0,r.tT)(a)),`<${t?"tspan":"span"} class="caps">${s}</${t?"tspan":"span"}> (${a}°)`},d=e=>{const t=(0,r.tT)(o(`#${e}`).roundSlider("getValue"));let s;return s=Number.isNaN(Number(t))?(0,r.Ri)(t):Number(t),s},h=(e,t)=>{let s=Math.atan2(t.y-e.y,t.x-e.x);s-=Math.PI/2;let a=(0,r.vi)(s);return a<0&&(a+=r.QF),a},l=(e,t,s=!0)=>{if(t<2)return[e];const a=e.length,i=[];let r,o=0;if(a%t==0)for(r=Math.floor(a/t);o<a;)i.push(e.slice(o,o+=r));else if(s)for(;o<a;)r=Math.ceil((a-o)/t--),i.push(e.slice(o,o+=r));else{for(t-=1,r=Math.floor(a/t),a%r==0&&(r-=1);o<r*t;)i.push(e.slice(o,o+=r));i.push(e.slice(r*t))}return i},c=({element:e,radius:t})=>{const s=i.f7,o=r.QF/s,n=Math.round(.8*t),p=[...new Array(s)].map(((e,t)=>(0,r.tT)(t*o))),d=(0,a.Z)().range([0-o/2,r.QF-o/2]).domain(p).align(0);e.append("circle").attr("r",n).style("stroke-width","3px");const h=e.append("text"),l=e.selectAll("g").data(p).join((e=>e.append("g").attr("transform",(e=>`rotate(${Math.round((d(e)??0)+d.bandwidth()/2-r.bT)})translate(${n},0)`))));l.filter(((e,t)=>t%3!=0)).append("line").attr("x2",9),l.filter(((e,t)=>t%3==0)).append("text").attr("transform",(e=>{let t,s=Math.round((d(e)??0)+d.bandwidth()/2);h.text(e);const a=h.node()?.getBBox().height??0,i=h.node()?.getBBox().width??0;return s>=0&&s<=45||315===s?(s=90,t="0,-"+a/2):90===s?(s=0,t=i/2+3+",0"):270===s?(s=180,t=`-${i/2+3},0`):(s=-90,t="0,"+(a/2+3+2)),`rotate(${s})translate(${t})`})).text((e=>e)),h.remove()},m=({element:e,radius:t})=>{const s=i.f7,o=r.QF/s,n=Math.round(.8*t),p=[...new Array(s)].map(((e,t)=>(0,r.tT)(t*o))),d=(0,a.Z)().range([0-o/2,r.QF-o/2]).domain(p).align(0);e.append("circle").attr("r",n).style("stroke-width","1.5px");e.selectAll("line").data(p).join((e=>e.append("line").attr("x2",((e,t)=>t%3==0?t%6==0?6:4:2)).attr("transform",(e=>`rotate(${Math.round((d(e)??0)+d.bandwidth()/2)})translate(${n},0)`))))},u=e=>`<span class="caps">${e}</span>`,_=(e,t)=>{navigator.clipboard||((e,t)=>{if(!document.queryCommandSupported?.("copy"))return console.error(`Insufficient rights to copy ${e} to clipboard`),!1;{const s=document.createElement("input");s.type="text",s.value=e,s.style.position="absolute",s.style.left="-1000px",s.style.top="-1000px",t.append(s),s.select();try{document.execCommand("copy")}catch(e){return console.error("Copy to clipboard failed.",e),!1}finally{s.remove()}}})(e,t),(async e=>{navigator.clipboard.writeText(e).then((()=>!0)).catch((t=>(console.error(`Cannot copy ${e} to clipboard`,t),!1)))})(e)},g=(e,t,s)=>{if(Number.isFinite(e)&&Number.isFinite(t)){const a=new URL(window.location.href);a.searchParams.set("x",String(e)),a.searchParams.set("z",String(t)),_(a.href,s)}},f=(e,t,s)=>`M${e-s},${t}a${s},${s} 0 10${2*s},0a${s},${s} 0 10${2*-s},0`,b=(e,t,s)=>`M${e-s/2},${t-s/2}h${s}v${s}h${-s}z`,D=(e,t,s)=>`M${e},${t}v${s}`},7015:(e,t,s)=>{s.d(t,{$1:()=>d,LQ:()=>h,QM:()=>l,Hu:()=>c,yI:()=>m,IH:()=>u,nM:()=>_,Dw:()=>b,RK:()=>D,Pj:()=>$,T3:()=>y,me:()=>C,xp:()=>S});var a=s(3363),i=s(5619),r=s(6400);const o=i.Z.bind(r.h),n=(0,a.Z)({decimal:".",thousands:" ",grouping:[3],currency:[""," reales"],percent:" %",minus:"− "}),p=n.formatPrefix(",.0",1e3),d=(e,t=2)=>n.format(`,.${t}~r`)(e),h=(e,t=2)=>n.format(`+,.${t}~r`)(e).replace("+","+ "),l=(e,t=2)=>n.format(`.${t}f`)(e).replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),c=e=>p(-1*e).replace("k"," k"),m=e=>n.format(",d")(e),u=e=>n.format("+,d")(e).replace("+","+ "),_=(e,t=0)=>n.format(`,.${t}%`)(e).replace("%","pp"),g='<span class="caps">m</span>',f='<tspan class="caps">m</tspan>',b=(e,t=!1)=>n.format(",.2s")(e).replace(".0","").replace("k"," k").replace("m"," m").replace("M",` ${t?f:g}`),D=e=>{const t=b(e);return t.endsWith(g)?o`${t.replace(g,"")}<span class="caps">m</span>`:o`${t}`},$=(e,t=!1)=>n.format("$,.2s")(e).replace(".0","").replace("M",` ${t?f:g}`).replace("k"," k"),y=(e,t=1)=>n.format(`.${t}%`)(e).replace(".0",""),C=(e,t=1)=>n.format(`.${t}p`)(e),S=e=>n.format("+.1%")(e).replace(".0","").replace("+","＋ ")},5923:(e,t,s)=>{s.d(t,{ZT:()=>h,q4:()=>l,OI:()=>c,i6:()=>m,l9:()=>u,C4:()=>f,XI:()=>b,PD:()=>D,WP:()=>y,td:()=>C,Y8:()=>S,eb:()=>w,PK:()=>I,IF:()=>v,HL:()=>x});var a=s(6372),i=s(4470),r=s(5619),o=s(6400),n=s(9022),p=s(7015);const d=r.Z.bind(o.h),h=Number(.2),l=Number(300),c=Number(90),m=Number(.25),u=Number(300),_=Number(.25),g=Number(1),f=Number(_)/Number(g),b=5,D=new i.ZP("My salt: Yet another Naval Action map"),$=" (i)",y=e=>e.includes($),C=e=>e.replace($,""),S=e=>C(e)+(y(e)?' <span class="caps small">imported</span>':""),w=({id:e,title:t,size:s="modal-xl",body:a,footer:i})=>d`
        <div id="${e}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${e}" aria-hidden="true">
            <div class="modal-dialog ${s}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${e}" class="modal-title">${t}</h5>
                    </div>
                    <div class="modal-body">${a()}</div>
                    <div class="modal-footer">${i()}</div>
                </div>
            </div>
        </div>
    `,I=e=>`${(0,p.yI)(Number(e))} real${Number(e)>1?"es":""}`,v=e=>{const{r:t,g:s,b:i}=(0,a.B8)(e);return(299*t+587*s+114*i)/1e3>=128?(0,a.ZP)(n.L$)?.darker(5).toString()??"#111":n.L$},x=e=>d`<span class="caps">${e}</span>`},4738:(e,t,s)=>{s.d(t,{I4:()=>a,MR:()=>i});const a=(e,t)=>e&&t?e.localeCompare(t):0,i=e=>(t,s)=>{let a=0;return e.some((e=>{let i=1;return String(e).startsWith("-")&&(i=-1,e=String(e).slice(1)),a=Number.isNaN(Number(t[e]))&&Number.isNaN(Number(s[e]))?String(t[e]).localeCompare(String(s[e]))*i:(Number(t[e])-Number(s[e]))*i,0!==a})),a}},4332:(e,t,s)=>{s.d(t,{t:()=>a,y:()=>i});const a=["loot","chests","items"],i=["crew","gunnery","hull","mast","sailing"]},3129:e=>{e.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3e%3cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3e%3c/svg%3e"}}]);