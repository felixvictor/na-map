/*! For license information please see map-tools.000a22b433d7556cc24c.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[674],{8800:function(t,i,e){e.r(i),e.d(i,{init:function(){return y}});e(6801),e(7424);var r=e(4017),s=e(5049),n=(e(3223),e(2855)),o=e(9022),a=e(393),d=e(1198),h=e(7484),l=e.n(h),u=e(285),p=e.n(u),c=e(178),_=e.n(c),m=e(3609);function v(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}l().extend(p()),l().extend(_()),l().locale("en-gb");class g{constructor(){v(this,"_height",void 0),v(this,"_width",void 0),v(this,"_windArrowWidth",void 0),v(this,"_baseName",void 0),v(this,"_baseId",void 0),v(this,"_buttonId",void 0),v(this,"_modalId",void 0),v(this,"_formId",void 0),v(this,"_sliderId",void 0),v(this,"_timeGroupId",void 0),v(this,"_timeInputId",void 0),v(this,"_svg",void 0),this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._timeGroupId=`input-group-${this._baseId}`,this._timeInputId=`input-${this._baseId}`,this._setupSvg(),this._setupArrow(),this._setupListener()}_setupSvg(){this._svg=(0,r.Z)("#wind svg")}_setupArrow(){const t=this._windArrowWidth,i=2*this._windArrowWidth;(0,r.Z)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox",`0 -${t} ${i} ${i}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d",`M0,-${t}L${i},0L0,${t}`).attr("class","wind-predict-arrow-head")}_navbarClick(){(0,n.KS)("Menu",this._baseName),this._windSelected()}_setupListener(){var t;null===(t=document.querySelector(`#${this._buttonId}`))||void 0===t||t.addEventListener("click",(()=>this._navbarClick()))}_setupWindInput(){const t=m.fn.roundSlider.prototype._getTooltipPos;m.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||m("body").append(this.tooltip);const i=t.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>`${(0,d.nD)(t.value)}<br>${String(t.value)}°`,m(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/a.Tm.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){(0,o.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,r.Z)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId),i=t.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);i.append("label").attr("for",this._sliderId).text("Current in-game wind"),i.append("div").attr("id",this._sliderId).attr("class","rslider");const e=t.append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");e.append("label").attr("for",this._timeInputId).text("Predict time (server time)");e.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest").append("input").attr("class","form-control").attr("type","time").attr("id",this._timeInputId).attr("value",l().utc().format("HH:mm")).attr("data-target",`#${this._timeGroupId}`).attr("aria-label",this._timeGroupId).attr("required","")}_initModal(){this._injectModal(),this._setupWindInput()}_windSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),m(`#${this._modalId}`).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}_useUserInput(){const t=(0,d.tj)(this._sliderId),i=m(`#${this._timeInputId}`).val().trim();this._predictWind(t,i)}_predictWind(t,i){const e="H.mm";let r;const s=/(\d+)[\s.:](\d+)/.exec(i),n=Number.parseInt(s[1],10),d=Number.parseInt(s[2],10);r=Number.isNaN(Number(t))?(0,a.Ri)(String(t)):Number(t);const h=l()().utc().second(0).millisecond(0),u=l()(h).hour(n).minute(d);u.isBefore(h)&&u.add(1,"day");const p=u.diff(h,"second"),c=360+(r-o.er*p)%360;this._printPredictedWind(c,u.format(e),(0,a.tT)(t),h.format(e))}_printCompass(t){const i=(0,s.Z)(),e=Math.min(this._height/1.4,this._width/1.4)/2,r=this._width/2,n=this._height/2.8,o=(0,a.Ht)(t),h=.6*e,l=h*Math.cos(o),u=h*Math.sin(o),p=[[Math.round(r+l),Math.round(n+u)],[Math.round(r-l),Math.round(n-u)]];this._svg.attr("height",this._height).attr("width",this._width);const c=this._svg.append("svg").attr("class","compass").attr("x",r).attr("y",n);(0,d.$G)({element:c,radius:e}),this._svg.append("path").datum(p).attr("d",i).attr("marker-end","url(#wind-arrow)")}_printText(t,i,e,r){var s,n;const o=(0,a.tT)(t),h=Number.parseInt(window.getComputedStyle(document.querySelector("#wind")).getPropertyValue("line-height"),10),l=this._svg.append("svg"),u=l.append("text").attr("x","50%").attr("y","33%").html(`From ${(0,d.Iy)(o,!0)} at ${i}`),p=l.append("text").attr("x","50%").attr("y","66%").attr("class","text-light-separation").html(`Currently at ${r} from ${(0,d.Iy)(e,!0)}`),c=null===(s=u.node())||void 0===s?void 0:s.getBoundingClientRect(),_=null===(n=p.node())||void 0===n?void 0:n.getBoundingClientRect(),m=2*Math.max(Number(null==c?void 0:c.height),Number(null==_?void 0:_.height))+h,v=Math.max(Number(null==c?void 0:c.width),Number(null==_?void 0:_.width))+h;l.attr("x",(this._width-v)/2).attr("y","72%").attr("height",m).attr("width",v)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,i,e,r){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,i,e,r),this._addBackground()}setPosition(t,i){this._svg.style("margin-left",`${i}px`).style("margin-top",`${t}px`)}clearMap(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)}}e(3824);var b=e(3389),w=e(3609);function f(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}l().extend(p()),l().extend(_());class I{constructor(){f(this,"_line",void 0),f(this,"_windPath",void 0),f(this,"_windArrowWidth",void 0),f(this,"_intervalSeconds",void 0),f(this,"_baseName",void 0),f(this,"_baseId",void 0),f(this,"_buttonId",void 0),f(this,"_modalId",void 0),f(this,"_formId",void 0),f(this,"_sliderId",void 0),f(this,"_cookieExpire",void 0),f(this,"_cookieWindDegrees",void 0),f(this,"_cookieTime",void 0),f(this,"_currentWindDegrees",void 0),f(this,"_height",void 0),f(this,"_yCompass",void 0),f(this,"_width",void 0),f(this,"_xCompass",void 0),f(this,"_compassRadius",void 0),f(this,"_length",void 0),f(this,"_intervalId",void 0),f(this,"_svg",void 0),f(this,"_div",void 0),this._line=(0,s.Z)().x((t=>t[0])).y((t=>t[1])),this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new b.Z({id:`${this._baseId}-degrees`,expire:this._cookieExpire}),this._cookieTime=new b.Z({id:`${this._baseId}-time`}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:i,top:e}=t.getBoundingClientRect();return i-e-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))}return 0}_getCurrentWindCookie(){const t=Number(this._cookieWindDegrees.get());if(t){const i=Number(this._cookieTime.get()),e=Math.round((Date.now()-i)/1e3);this._currentWindDegrees=360+Math.floor(t-o.er*e)%360}return t}_getExpire(){const t=l().utc();let i=l()().utc().hour(10).minute(0).second(0);return t.hour()>=i.hour()&&(i=i.add(1,"day")),i.local().toDate()}_storeCurrentWindCookie(){this._cookieWindDegrees.set(String(this._currentWindDegrees)),this._cookieTime.set(String(Date.now()))}_setupSvg(){const t=(0,r.Z)("#port-summary");t.classed("port-summary-no-wind",!1).classed("port-summary-wind",!0),this._div=t.insert("div",":first-child").attr("id",this._baseId).attr("class","block p-0"),this._svg=this._div.append("svg").attr("class","ingame-wind small")}_navbarClick(){(0,n.KS)("Menu",this._baseName),this._windRoseSelected()}_setupListener(){var t;null===(t=document.querySelector(`#${this._buttonId}`))||void 0===t||t.addEventListener("click",(()=>this._navbarClick()))}_setupWindInput(){const t=w.fn.roundSlider.prototype._getTooltipPos;w.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||w("body").append(this.tooltip);const i=t.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>`${(0,d.nD)(t.value)}<br>${String(t.value)}°`,w(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/a.Tm.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){(0,o.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,r.Z)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")}_initModal(){this._injectModal(),this._setupWindInput()}_windRoseSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),w(`#${this._modalId}`).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}_windChange(){this._currentWindDegrees=360+(this._currentWindDegrees-o.er*this._intervalSeconds)%360,this._updateWindDirection()}_useUserInput(){this._currentWindDegrees=(0,d.tj)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval((()=>{this._windChange()}),1e3*this._intervalSeconds)}_updateWindDirection(){const t=(0,a.Ht)(this._currentWindDegrees),i=this._length*Math.cos(t),e=this._length*Math.sin(t),r=[[Math.round(this._xCompass+i),Math.round(this._yCompass+e)],[Math.round(this._xCompass-i),Math.round(this._yCompass-e)]];this._windPath&&(this._windPath.datum(r).attr("d",this._line),this._storeCurrentWindCookie())}_initPrintCompassRose(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);const t=this._svg.append("svg").attr("class","compass").attr("x",this._xCompass).attr("y",this._yCompass);(0,d.ec)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").attr("marker-end","url(#wind-arrow)")}clearMap(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=void 0,this._cookieWindDegrees.remove()}}const y=()=>{new g,new I}},1198:function(t,i,e){e.d(i,{nD:function(){return h},Iy:function(){return l},tj:function(){return u},Fq:function(){return p},xp:function(){return c},$G:function(){return _},ec:function(){return m},Mo:function(){return v},vQ:function(){return g},A1:function(){return b},GZ:function(){return w},yb:function(){return f},PN:function(){return I}});var r=e(1138),s=e(9022),n=e(393),o=e(3609);function a(t){return function(t){if(Array.isArray(t))return d(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,i){if(!t)return;if("string"==typeof t)return d(t,i);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return d(t,i)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(t,i){(null==i||i>t.length)&&(i=t.length);for(var e=0,r=new Array(i);e<i;e++)r[e]=t[e];return r}const h=(t,i=!1)=>{let e;return e=Number.isNaN(Number(t))?t:(0,n.tT)(Number(t)),`<${i?"tspan":"span"} class="caps">${e}</${i?"tspan":"span"}>`},l=(t,i=!1)=>{let e,r;return Number.isNaN(Number(t))?(e=t,r=(0,n.Ri)(e)%n.QF):(r=Number(t),e=(0,n.tT)(r)),`<${i?"tspan":"span"} class="caps">${e}</${i?"tspan":"span"}> (${r}°)`},u=t=>{const i=(0,n.tT)(o(`#${t}`).roundSlider("getValue"));let e;return e=Number.isNaN(Number(i))?(0,n.Ri)(i):Number(i),e},p=(t,i)=>{let e=Math.atan2(i.y-t.y,i.x-t.x);e-=Math.PI/2;let r=(0,n.vi)(e);return r<0&&(r+=n.QF),r},c=(t,i,e=!0)=>{if(i<2)return[t];const r=t.length,s=[];let n,o=0;if(r%i==0)for(n=Math.floor(r/i);o<r;)s.push(t.slice(o,o+=n));else if(e)for(;o<r;)n=Math.ceil((r-o)/i--),s.push(t.slice(o,o+=n));else{for(i-=1,n=Math.floor(r/i),r%n==0&&(n-=1);o<n*i;)s.push(t.slice(o,o+=n));s.push(t.slice(n*i))}return s},_=({element:t,radius:i})=>{const e=s.f7,o=n.QF/e,d=Math.round(.8*i),h=a(new Array(e)).map(((t,i)=>(0,n.tT)(i*o))),l=(0,r.Z)().range([0-o/2,n.QF-o/2]).domain(h).align(0);t.append("circle").attr("r",d).style("stroke-width","3px");const u=t.append("text"),p=t.selectAll("g").data(h).join((t=>t.append("g").attr("transform",(t=>{var i;return`rotate(${Math.round((null!==(i=l(t))&&void 0!==i?i:0)+l.bandwidth()/2-n.bT)})translate(${d},0)`}))));p.filter(((t,i)=>i%3!=0)).append("line").attr("x2",9),p.filter(((t,i)=>i%3==0)).append("text").attr("transform",(t=>{var i,e,r,s,n;let o,a=Math.round((null!==(i=l(t))&&void 0!==i?i:0)+l.bandwidth()/2);u.text(t);const d=null!==(e=null===(r=u.node())||void 0===r?void 0:r.getBBox().height)&&void 0!==e?e:0,h=null!==(s=null===(n=u.node())||void 0===n?void 0:n.getBBox().width)&&void 0!==s?s:0;return a>=0&&a<=45||315===a?(a=90,o="0,-"+d/2):90===a?(a=0,o=h/2+3+",0"):270===a?(a=180,o=`-${h/2+3},0`):(a=-90,o="0,"+(d/2+3+2)),`rotate(${a})translate(${o})`})).text((t=>t)),u.remove()},m=({element:t,radius:i})=>{const e=s.f7,o=n.QF/e,d=Math.round(.8*i),h=a(new Array(e)).map(((t,i)=>(0,n.tT)(i*o))),l=(0,r.Z)().range([0-o/2,n.QF-o/2]).domain(h).align(0);t.append("circle").attr("r",d).style("stroke-width","1.5px");t.selectAll("line").data(h).join((t=>t.append("line").attr("x2",((t,i)=>i%3==0?i%6==0?6:4:2)).attr("transform",(t=>{var i;return`rotate(${Math.round((null!==(i=l(t))&&void 0!==i?i:0)+l.bandwidth()/2)})translate(${d},0)`}))))},v=t=>`<span class="caps">${t}</span>`,g=(t,i)=>{navigator.clipboard||((t,i)=>{var e,r;if(null===(e=(r=document).queryCommandSupported)||void 0===e||!e.call(r,"copy"))return console.error(`Insufficient rights to copy ${t} to clipboard`),!1;{const e=document.createElement("input");e.type="text",e.value=t,e.style.position="absolute",e.style.left="-1000px",e.style.top="-1000px",i.append(e),e.select();try{document.execCommand("copy")}catch(t){return console.error("Copy to clipboard failed.",t),!1}finally{e.remove()}}})(t,i),(async t=>{navigator.clipboard.writeText(t).then((()=>!0)).catch((i=>(console.error(`Cannot copy ${t} to clipboard`,i),!1)))})(t)},b=(t,i,e)=>{if(Number.isFinite(t)&&Number.isFinite(i)){const r=new URL(window.location.href);r.searchParams.set("x",String(t)),r.searchParams.set("z",String(i)),g(r.href,e)}},w=(t,i,e)=>`M${t-e},${i}a${e},${e} 0 10${2*e},0a${e},${e} 0 10${2*-e},0`,f=(t,i,e)=>`M${t-e/2},${i-e/2}h${e}v${e}h${-e}z`,I=(t,i,e)=>`M${t},${i}v${e}`}}]);