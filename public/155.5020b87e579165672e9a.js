/*! For license information please see 155.5020b87e579165672e9a.js.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[155],{27:function(e,t,a){a.d(t,{qn:function(){return K}});var s=a(4017),i=a(7228),r=a(233),o=a(9022);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class p{constructor(e,t){n(this,"ticksSpeed",void 0),n(this,"ticksSpeedLabels",void 0),n(this,"_shipCompare",void 0),n(this,"select",void 0),n(this,"_mainG",void 0),n(this,"_id",void 0),n(this,"_svg",void 0),this._id=e,this._shipCompare=t,this.ticksSpeed=[12,8,4,0],this.ticksSpeedLabels=this.ticksSpeed.map((e=>`${e} knots`)),this.select=`#ship-compare-${this._id}`,this._setupSvg(),this._setCompass()}static pd(e){let t=`<span class="badge badge-white">${e.maxCannonLb} / `;return e.maxCarroLb?t+=`${e.maxCarroLb}`:t+="–",t+=" lb</span>",t}static getCannonsPerDeck(e){let t=`${e.gunsPerDeck[0].amount} ${p.pd(e.gunsPerDeck[0])}`,a="";for(let s=1;s<4;s+=1)e.gunsPerDeck[s].amount?t=`${e.gunsPerDeck[s].amount} ${p.pd(e.gunsPerDeck[s])} <br>${t}`:a=`${a}<br>`;return[t,a]}static displaySecondBlock(){return'<div class="col-9"><div class="row">'}static getText(e){let t=0;function a(e){return t+=1,`<div class="row row-small ${t%2?"row-light":""}"><div class="col-compress col-3">${e}</div>`}function s(t,a,s=6){let i,r="";return"cannonsPerDeck"===t?([i,r]=e[t],r=`<br>${r}`):i=""===t?"":String(e[t]),`<div class="col-compress col-${s}">${i}<br><span class="des">${a}</span>${r}</div>`}let i="";return i+=a(e.shipRating),i+=p.displaySecondBlock(),i+=s("battleRating","Battle rating"),i+=s("guns","Cannons"),i+=s("upgradeXP","Knowledge XP"),i+=s("rollAngle","Roll angle"),i+="</div></div></div>",i+=a(e.decks),i+=p.displaySecondBlock(),i+=s("cannonsPerDeck","Gun decks"),i+=s("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=a("Broadside (lb)"),i+=p.displaySecondBlock(),i+=s("cannonBroadside","Cannons"),i+=s("carroBroadside","Carronades"),i+="</div></div></div>",i+=a("Chasers"),i+=p.displaySecondBlock(),i+=s("gunsFront","Bow"),i+=s("gunsBack","Stern"),i+="</div></div></div>",i+=a("Speed"),i+=p.displaySecondBlock(),i+=s("maxSpeed","Maximum"),i+=s("halfturnTime","Rudder half time"),i+=s("acceleration","Acceleration"),i+=s("deceleration","Deceleration"),i+=s("turnSpeed","Turn speed"),i+=s("turnAcceleration","Turn acceleration"),i+="</div></div></div>",i+=a('Hit points <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=s("sideArmor","Sides"),i+=s("structure","Hull"),i+=s("frontArmor","Bow"),i+=s("backArmor","Stern"),i+="</div></div></div>",i+=a('Masts <span class="badge badge-white">Thickness</span>'),i+=p.displaySecondBlock(),i+=s("sails","Sails"),i+=s("mastBottomArmor","Bottom"),i+=s("mastMiddleArmor","Middle"),i+=s("mastTopArmor","Top"),i+="</div></div></div>",i+=a("Crew"),i+=p.displaySecondBlock(),i+=s("minCrew","Minimum",4),i+=s("sailingCrew","Sailing",4),i+=s("maxCrew","Maximum",4),i+=s("cannonCrew","Cannon",4),i+=s("carroCrew","Carronades",4),i+="</div></div></div>",i+=a("Gunnery"),i+=p.displaySecondBlock(),i+=s("reload","Reload %",4),i+=s("dispersionHorizontal","Horizontal dispersion %",4),i+=s("dispersionVertical","Vertical dispersion %",4),i+=s("penetration","Ball penetration %",4),i+=s("traverseUpDown","Up/down traverse %",4),i+=s("traverseSide","Side traverse %",4),i+="</div></div></div>",i+=a("Boarding"),i+=p.displaySecondBlock(),i+=s("morale","Morale",4),i+=s("attack","Attack",4),i+=s("defense","Defense",4),i+=s("musketsCrew","Crew with muskets",4),i+=s("musketsAccuracy","Musket accuracy %",4),i+=s("cannonsAccuracy","Cannon accuracy %",4),i+=s("prepPerRound","Preparation per round",4),i+=s("prepInitial","Initial preparation",4),i+=s("disengageTime","Rounds to disengage",4),i+="</div></div></div>",i+=a("Resistance"),i+=p.displaySecondBlock(),i+=s("leakResistance","Leak %"),i+=s("splinterResistance","Splinter %"),i+="</div></div></div>",i+=a('Repairs needed <span class="badge badge-white">Set of 5</span>'),i+=p.displaySecondBlock(),i+=s("hullRepairsNeeded","Hull",4),i+=s("rigRepairsNeeded","Rig",4),i+=s("rumRepairsNeeded","Rum",4),i+="</div></div></div>",i+=a("Repair"),i+=p.displaySecondBlock(),i+=s("hullRepairAmount","Hull %",4),i+=s("rigRepairAmount","Rig %",4),i+=s("repairTime","Time (sec)",4),i+="</div></div></div>",i+=a("Hold"),i+=p.displaySecondBlock(),i+=s("holdSize","Cargo slots"),i+=s("maxWeight","Tons"),i+="</div></div></div>",i+=a("Weight"),i+=p.displaySecondBlock(),i+=s("cannonWeight","Cannons",4),i+=s("carroWeight","Carronades",4),i+=s("repairWeight","Repair Set",4),i+="</div></div></div>",i+="</div>",i}_setupSvg(){const e=(0,s.Z)(this.select);(0,s.Z)(`${this.select} svg`).remove(),this._svg=e.append("svg").attr("width",this._shipCompare.svgWidth).attr("height",this._shipCompare.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none"),this._mainG=this._svg.append("g").attr("transform",`translate(${this._shipCompare.svgWidth/2},${this._shipCompare.svgHeight/2})`),(0,s.Z)(`${this.select} div`).remove(),e.append("div")}_setCompass(){var e;const t=new Array(o.f7/2);t.fill(1,0);const a=(0,i.Z)().sort(null).value(1)(t),s=(0,r.Z)().outerRadius(null!==(e=this._shipCompare.radiusSpeedScale(12))&&void 0!==e?e:0).innerRadius(this._shipCompare.innerRadius);this._mainG.append("g").attr("class","compass-arc").selectAll("path").data(a).join((e=>e.append("path").attr("d",s))),this._mainG.append("g").attr("class","speed-circle").selectAll("circle").data(this.ticksSpeed).join((e=>e.append("circle").attr("r",(e=>{var t;return null!==(t=this._shipCompare.radiusSpeedScale(e))&&void 0!==t?t:0}))))}}var d=a(2601),h=a(289),l=a(4127),c=a(9930),u=a(2157),m=a(7015),g=a(393),_=a(1198),f=a(5923),b=a(3129),D=a.n(b),v=a(3609);function y(e){return function(e){if(Array.isArray(e))return $(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return $(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return $(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class C extends p{constructor(e,t,a){super(e,a),S(this,"shipData",void 0),S(this,"_speedScale",void 0),S(this,"_shipRotate",void 0),S(this,"_speedText",void 0),S(this,"_drag",void 0),this.shipData=t,this._setBackground(),this._setupDrag(),this._drawWindProfile(),this._setupShipOutline(),this._printText()}_setBackground(){const e=(0,r.Z)().outerRadius((e=>{var t;return(null!==(t=this._shipCompare.radiusSpeedScale(e))&&void 0!==t?t:0)+2})).innerRadius((e=>{var t;return(null!==(t=this._shipCompare.radiusSpeedScale(e))&&void 0!==t?t:0)+1})).startAngle(-Math.PI/2).endAngle(Math.PI/2);this._mainG.append("g").attr("data-ui-component","speed-textpath").selectAll("path").data(this.ticksSpeed).join((t=>t.append("path").attr("d",e).attr("id",((e,t)=>`tick${t}`)))),this._mainG.append("g").attr("class","speed-text").selectAll("text").data(this.ticksSpeed).join((e=>e.append("text").append("textPath").attr("href",((e,t)=>`#tick${t}`)).text(((e,t)=>this.ticksSpeedLabels[t])).attr("startOffset","10%")))}_getHeadingInDegrees(e,t){let a=e-t-180;return a<0&&(a+=360),a}_getSpeed(e){var t;return(0,m.$1)(null!==(t=this._speedScale(Math.abs(e)))&&void 0!==t?t:0)}_getHeadingInCompass(e){return(0,g.tT)(e)}_updateCompareWindProfiles(){for(const e of this._shipCompare.columnsCompare)(0,u.xb)(this._shipCompare.selectedShips[e])||this._shipCompare.selectedShips[e].updateWindProfileRotation()}_setupDrag(){const e=this.shipData.speedDegrees.length,t=360/e,a=y(new Array(e+1)).map(((e,a)=>a*t));this._speedScale=(0,h.Z)().domain(a).range([].concat(y(this.shipData.speedDegrees),[this.shipData.speedDegrees[0]])).clamp(!0);const s=(e,t)=>{const{x:a,y:s}=e;t.rotate=this._getHeadingInDegrees((0,_.Fq)({x:t.initX,y:t.initY},{x:a,y:s}),t.correctionValueDegrees),(()=>{t.this.attr("transform",(e=>`rotate(${e.rotate})`)),t.compassText.attr("transform",(e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.rotate))),"ship"===t.type?this._shipRotate=t.rotate:"windProfile"===t.type&&(this._shipCompare.windProfileRotate=t.rotate),this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))})(),"windProfile"===t.type&&this._updateCompareWindProfiles()};this._drag=(0,d.Z)().on("drag",((e,t)=>s(e,t))).container((()=>this._mainG.node()))}_setupShipOutline(){var e;this._shipRotate=0;const{shipMass:t}=this.shipData,a=null!==(e=this._shipCompare.shipMassScale(t))&&void 0!==e?e:0,s=a,i=this._shipCompare.svgHeight/2-40,r={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:i,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(r).attr("class","ship-outline");o.append("line").attr("x1",(e=>e.initX)).attr("y1",i-20).attr("x2",(e=>e.initX)).attr("y2",(e=>e.initY)),o.append("image").attr("height",a).attr("width",s).attr("x",-a/2).attr("y",-s/2).attr("xlink:href",D()),o.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20).call(this._drag);const n=o.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));this._speedText=o.append("text").attr("x",(e=>e.speedTextX)).attr("y",(e=>e.speedTextY)).attr("transform",(e=>`rotate(${-e.initRotate})`)).text((e=>this._getSpeed(e.initRotate))),r.this=o,r.compassText=n,o.datum(r).attr("transform",(e=>`rotate(${e.initRotate-90})`)),o.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_drawWindProfile(){const e=(0,i.Z)().sort(null).value(1)(this.shipData.speedDegrees),t=l.Z,a=(0,c.Z)().angle(((e,t)=>t*o.P)).radius((e=>{var t;return null!==(t=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==t?t:0})).curve(t);this._shipCompare.windProfileRotate=0;const s=this._shipCompare.svgHeight/2-20,r={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-s,type:"windProfile"},n=this._mainG.append("g").datum(r).attr("class","wind-profile");n.append("path").attr("d",(e=>String((0,_.GZ)(e.compassTextX,e.compassTextY,20))+(0,_.PN)(e.compassTextX,e.compassTextY,-e.compassTextY/2))).attr("class","wind-profile-arrow").attr("marker-end","url(#wind-profile-arrow-head)").call(this._drag),n.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20);const p=n.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));n.append("path").attr("class","base-profile").attr("d",a(e)),n.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(e).join((e=>e.append("circle").attr("r",5).attr("cy",((e,t)=>{var a;return Math.cos(t*o.P)*-(null!==(a=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==a?a:0)})).attr("cx",((e,t)=>{var a;return Math.sin(t*o.P)*(null!==(a=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==a?a:0)})).attr("fill",(e=>{var t;return null!==(t=this._shipCompare.colorScale(e.data))&&void 0!==t?t:0})).attr("fill",(e=>{var t;return null!==(t=this._shipCompare.colorScale(e.data))&&void 0!==t?t:0})).append("title").text((e=>Math.round(10*e.data)/10+" knots")))),r.this=n,r.compassText=p,n.datum(r).attr("transform",(e=>`rotate(${e.initRotate+90})`)),n.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_printText(){var e;const t=p.getCannonsPerDeck(this.shipData.guns),a=Math.round(this.shipData.sides.armour*this.shipData.repairAmount.armour/f.q4),s=Math.round(this.shipData.sails.armour*this.shipData.repairAmount.sails/f.l9),i=Math.round(this.shipData.crew.max*f.C4),r={attack:(0,m.LQ)(this.shipData.boarding.attack,2),cannonsAccuracy:(0,m.IH)(100*this.shipData.boarding.cannonsAccuracy),defense:(0,m.LQ)(this.shipData.boarding.defense,2),disengageTime:(0,m.yI)(this.shipData.boarding.disengageTime),morale:(0,m.yI)(this.shipData.boarding.morale),musketsAccuracy:(0,m.IH)(100*this.shipData.boarding.musketsAccuracy),musketsCrew:(0,m.yI)(this.shipData.boarding.musketsCrew/100*this.shipData.crew.max),prepPerRound:(0,m.yI)(this.shipData.boarding.prepPerRound),prepInitial:(0,m.yI)(this.shipData.boarding.prepInitial),reload:(0,m.IH)(100*this.shipData.gunnery.reload),penetration:(0,m.IH)(100*this.shipData.gunnery.penetration),dispersionHorizontal:(0,m.IH)(100*this.shipData.gunnery.dispersionHorizontal),dispersionVertical:(0,m.IH)(100*this.shipData.gunnery.dispersionVertical),traverseUpDown:(0,m.IH)(100*this.shipData.gunnery.traverseUpDown),traverseSide:(0,m.IH)(100*this.shipData.gunnery.traverseSide),acceleration:(0,m.$1)(this.shipData.ship.acceleration),additionalRow:""+(this.shipData.guns.decks<4?"<br> ":""),backArmor:`${(0,m.yI)(this.shipData.stern.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.stern.thickness)}</span>`,battleRating:String(this.shipData.battleRating),bowRepair:`${(0,m.yI)(this.shipData.repairTime.bow)}`,cannonBroadside:(0,m.yI)(this.shipData.guns.broadside.cannons),cannonsPerDeck:t,carroBroadside:(0,m.yI)(this.shipData.guns.broadside.carronades),deceleration:(0,m.$1)(this.shipData.ship.deceleration),decks:(0,o.gY)(this.shipData.guns.decks,"deck"),firezoneHorizontalWidth:String(this.shipData.ship.firezoneHorizontalWidth),frontArmor:`${(0,m.yI)(this.shipData.bow.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.bow.thickness)}</span>`,guns:String(this.shipData.guns.total),gunsBack:this.shipData.guns.gunsPerDeck[5].amount,gunsFront:this.shipData.guns.gunsPerDeck[4].amount,halfturnTime:(0,m.$1)(this.shipData.rudder.halfturnTime,4),holdSize:(0,m.yI)(this.shipData.holdSize),hullRepairAmount:`${(0,m.yI)(100*(this.shipData.repairAmount.armour+this.shipData.repairAmount.armourPerk))}`,hullRepairsNeeded:`${(0,m.yI)(a)} <span class="badge badge-white">${(0,m.yI)(a*f.XI)}</span>`,leakResistance:(0,m.IH)(100*this.shipData.resistance.leaks),limitBack:this.shipData.guns.gunsPerDeck[5],limitFront:this.shipData.guns.gunsPerDeck[4],mastBottomArmor:`${(0,m.yI)(this.shipData.mast.bottomArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.mast.bottomThickness)}</span>`,mastMiddleArmor:`${(0,m.yI)(this.shipData.mast.middleArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.mast.middleThickness)}</span>`,mastTopArmor:`${(0,m.yI)(this.shipData.mast.topArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.mast.topThickness)}</span>`,maxCrew:(0,m.yI)(this.shipData.crew.max),maxSpeed:(0,m.$1)(this.shipData.speed.max,3),maxWeight:(0,m.yI)(this.shipData.maxWeight),minCrew:(0,m.yI)(this.shipData.crew.min),cannonCrew:(0,m.yI)(this.shipData.crew.cannons),carroCrew:(0,m.yI)(this.shipData.crew.carronades),pump:(0,m.yI)(this.shipData.pump.armour),repairTime:`${(0,m.yI)(this.shipData.repairTime.sides)}`,rigRepairAmount:`${(0,m.yI)(100*(this.shipData.repairAmount.sails+this.shipData.repairAmount.sailsPerk))}`,rigRepairsNeeded:`${(0,m.yI)(s)} <span class="badge badge-white">${(0,m.yI)(s*f.XI)}</span>`,rollAngle:(0,m.yI)(this.shipData.ship.rollAngle),rudder:`${(0,m.yI)(this.shipData.rudder.armour)} <span class="badge badge-white">${(0,m.yI)(this.shipData.rudder.thickness)}</span>`,rumRepairsNeeded:`${(0,m.yI)(i)} <span class="badge badge-white">${(0,m.yI)(i*f.XI)}</span>`,sailingCrew:(0,m.yI)(null!==(e=this.shipData.crew.sailing)&&void 0!==e?e:0),sails:(0,m.yI)(this.shipData.sails.armour),shipRating:`${(0,g.hi)(this.shipData.class)} rate`,sideArmor:`${(0,m.yI)(this.shipData.sides.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipData.sides.thickness)}</span>`,splinterResistance:(0,m.IH)(100*this.shipData.resistance.splinter),sternRepair:`${(0,m.yI)(this.shipData.repairTime.stern)}`,structure:(0,m.yI)(this.shipData.structure.armour),turnAcceleration:(0,m.$1)(this.shipData.ship.turnAcceleration,4),turnSpeed:(0,m.$1)(this.shipData.ship.turnSpeed,3),upgradeXP:(0,m.yI)(this.shipData.upgradeXP),waterlineHeight:(0,m.$1)(this.shipData.ship.waterlineHeight),cannonWeight:(0,m.yI)(this.shipData.guns.weight.cannons),carroWeight:(0,m.yI)(this.shipData.guns.weight.carronades)};r.repairWeight=(0,m.yI)((a+s+.1*i)*f.XI),r.gunsFront?r.gunsFront+=` ${p.pd(r.limitFront)}`:r.gunsFront="–",r.gunsBack?r.gunsBack+=` ${p.pd(r.limitBack)}`:r.gunsBack="–",v(`${this.select}`).find("div").append(p.getText(r))}}var w=a(7622),I=a(8823),A=a(3609);function P(e){return function(e){if(Array.isArray(e))return k(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return k(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}function x(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class B extends p{constructor(e,t,a,s){super(e,s),x(this,"shipCompareData",void 0),x(this,"_shipBaseData",void 0),x(this,"_speedScale",void 0),x(this,"_speedDiff",void 0),x(this,"_minSpeedDiff",void 0),x(this,"_maxSpeedDiff",void 0),x(this,"_shipRotate",void 0),x(this,"_speedText",void 0),x(this,"_drag",void 0),x(this,"_windProfile",void 0),x(this,"_gWindProfile",void 0),x(this,"_arcsComp",void 0),this._shipBaseData=t,this.shipCompareData=a,this._setupDrag(),this._drawDifferenceProfile(),this._setupShipOutline(),this._injectTextComparison()}_setColourScale(e,t){const a=Math.min(e,this._shipCompare.colourScaleSpeedDiff.domain()[0]),s=Math.max(t,this._shipCompare.colourScaleSpeedDiff.domain()[this._shipCompare.colourScaleSpeedDiff.domain().length-1]);this._shipCompare.colourScaleSpeedDiff.domain([a,0,s])}_getHeadingInDegrees(e,t){let a=e-t-180;return a<0&&(a+=360),a}_getSpeed(e){var t;return(0,m.$1)(null!==(t=this._speedScale(Math.abs(e)))&&void 0!==t?t:0)}_getHeadingInCompass(e){return(0,g.tT)(e)}_updateSpeedText(){this._speedText.attr("transform",`rotate(${-this._shipRotate})`).text(this._getSpeed(this._shipCompare.windProfileRotate-this._shipRotate))}_setupDrag(){const e=this.shipCompareData.speedDegrees.length,t=360/e,a=P(new Array(e+1)).map(((e,a)=>a*t));this._speedScale=(0,h.Z)().domain(a).range([].concat(P(this.shipCompareData.speedDegrees),[this.shipCompareData.speedDegrees[0]])).clamp(!0);const s=(e,t)=>{const{x:a,y:s}=e;t.rotate=this._getHeadingInDegrees((0,_.Fq)({x:t.initX,y:t.initY},{x:a,y:s}),t.correctionValueDegrees),(()=>{t.this.attr("transform",(e=>`rotate(${e.rotate})`)),t.compassText.attr("transform",(e=>`rotate(${-e.rotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.rotate))),this._shipRotate=t.rotate,this._updateSpeedText()})()};this._drag=(0,d.Z)().on("drag",((e,t)=>s(e,t))).container((()=>this._mainG.node()))}_setupShipOutline(){var e;this._shipRotate=0;const{shipMass:t}=this.shipCompareData,a=null!==(e=this._shipCompare.shipMassScale(t))&&void 0!==e?e:0,s=a,i=this._shipCompare.svgHeight/2-40,r={initX:0,initY:0,initRotate:this._shipRotate,correctionValueDegrees:180,compassTextX:0,compassTextY:i,speedTextX:0,speedTextY:0,type:"ship"},o=this._mainG.append("g").datum(r).attr("class","ship-outline");o.append("line").attr("x1",(e=>e.initX)).attr("y1",i-20).attr("x2",(e=>e.initX)).attr("y2",(e=>e.initY)),o.append("image").attr("height",a).attr("width",s).attr("x",-a/2).attr("y",-s/2).attr("xlink:href",D()),o.append("circle").attr("cx",(e=>e.compassTextX)).attr("cy",(e=>e.compassTextY)).attr("r",20).call(this._drag);const n=o.append("text").attr("x",(e=>e.compassTextX)).attr("y",(e=>e.compassTextY)).attr("transform",(e=>`rotate(${-e.initRotate},${e.compassTextX},${e.compassTextY})`)).text((e=>this._getHeadingInCompass(e.initRotate)));this._speedText=o.append("text").attr("x",(e=>e.speedTextX)).attr("y",(e=>e.speedTextY)).attr("transform",(e=>`rotate(${-e.initRotate})`)).text((e=>this._getSpeed(this._shipCompare.windProfileRotate-e.initRotate))),r.this=o,r.compassText=n,o.datum(r).attr("transform",(e=>`rotate(${e.initRotate-90})`)),o.transition().duration(1e3).delay(500).attr("transform",(e=>`rotate(${e.initRotate})`))}_drawDifferenceProfile(){var e,t;const a=(0,i.Z)().sort(null).value(1),s=a(this._shipBaseData.speedDegrees);this._arcsComp=a(this.shipCompareData.speedDegrees),this._speedDiff=this.shipCompareData.speedDegrees.map(((e,t)=>(0,g.qY)(e-this._shipBaseData.speedDegrees[t]))),this._minSpeedDiff=null!==(e=(0,w.Z)(this._speedDiff))&&void 0!==e?e:0,this._maxSpeedDiff=null!==(t=(0,I.Z)(this._speedDiff))&&void 0!==t?t:0;const r=l.Z,n=(0,c.Z)().angle(((e,t)=>t*o.P)).radius((e=>{var t;return null!==(t=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==t?t:0})).curve(r),p=this._shipCompare.svgHeight/2-20;this._windProfile={initX:0,initY:0,initRotate:this._shipCompare.windProfileRotate,correctionValueDegrees:0,compassTextX:0,compassTextY:-p,type:"windProfile"},this._gWindProfile=this._mainG.append("g").attr("class","wind-profile").attr("transform",`rotate(${this._windProfile.initRotate})`),this._gWindProfile.append("path").attr("class","base-profile").attr("d",n(s)),this._gWindProfile.append("path").attr("class","comp-profile").attr("d",n(this._arcsComp))}updateWindProfileRotation(){this._gWindProfile.attr("transform",`rotate(${this._shipCompare.windProfileRotate})`),this._updateSpeedText()}updateDifferenceProfile(){this._setColourScale(this._minSpeedDiff,this._maxSpeedDiff),this._gWindProfile.append("g").attr("data-ui-component","speed-markers").selectAll("circle").data(this._arcsComp).join((e=>e.append("circle").attr("r",5).attr("cy",((e,t)=>{var a;return Math.cos(t*o.P)*-(null!==(a=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==a?a:0)})).attr("cx",((e,t)=>{var a;return Math.sin(t*o.P)*(null!==(a=this._shipCompare.radiusSpeedScale(e.data))&&void 0!==a?a:0)})).attr("fill",((e,t)=>{var a;return null!==(a=this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t]))&&void 0!==a?a:0})).append("title").text(((e,t)=>`${Math.round(10*e.data)/10} (${(0,m.LQ)(this._speedDiff[t],1)}) knots`)))).select("circle").attr("fill",((e,t)=>{var a;return null!==(a=this._shipCompare.colourScaleSpeedDiff(this._speedDiff[t]))&&void 0!==a?a:o.L$}))}_injectTextComparison(){function e(e,t,a=0,s=!1){if(e===t)return"";let i,r,o="badge-danger";return s?(i=100*Number.parseFloat((t-e).toFixed(a)),r=(0,m.$1)(Math.abs(i))):0===e||0===t?(i=t-e,r=(0,m.$1)(Math.abs(i))):(i=1-e/t,r=(0,m.T3)(Math.abs(i),0)),i<0&&(o="badge-success"),`<span class="badge ${o}">${r}</span>`}const t=Math.round(this._shipBaseData.sides.armour*this._shipBaseData.repairAmount.armour/f.q4),a=Math.round(this._shipBaseData.sails.armour*this._shipBaseData.repairAmount.sails/f.l9),s=Math.round(this._shipBaseData.crew.max*f.C4),i=Math.round(this.shipCompareData.sides.armour*this.shipCompareData.repairAmount.armour/f.q4),r=Math.round(this.shipCompareData.sails.armour*this.shipCompareData.repairAmount.sails/f.l9),n=Math.round(this.shipCompareData.crew.max*f.C4),d={morale:`${(0,m.yI)(this.shipCompareData.boarding.morale)} ${e(this.shipCompareData.boarding.morale,this._shipBaseData.boarding.morale)}`,musketsAccuracy:`${(0,m.IH)(100*this.shipCompareData.boarding.musketsAccuracy)} ${e(100*this.shipCompareData.boarding.musketsAccuracy,100*this._shipBaseData.boarding.musketsAccuracy)}`,prepPerRound:`${(0,m.yI)(this.shipCompareData.boarding.prepPerRound)} ${e(this.shipCompareData.boarding.prepPerRound,this._shipBaseData.boarding.prepPerRound)}`,attack:`${(0,m.LQ)(this.shipCompareData.boarding.attack,2)} ${e(this.shipCompareData.boarding.attack/100,this._shipBaseData.boarding.attack/100,3,!0)}`,defense:`${(0,m.LQ)(this.shipCompareData.boarding.defense,2)} ${e(this.shipCompareData.boarding.defense/100,this._shipBaseData.boarding.defense/100,3,!0)}`,disengageTime:`${(0,m.yI)(this.shipCompareData.boarding.disengageTime)} ${e(this._shipBaseData.boarding.disengageTime,this.shipCompareData.boarding.disengageTime)}`,musketsCrew:`${(0,m.yI)(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max)} ${e(this.shipCompareData.boarding.musketsCrew/100*this.shipCompareData.crew.max,this._shipBaseData.boarding.musketsCrew/100*this._shipBaseData.crew.max)}`,prepInitial:`${(0,m.yI)(this.shipCompareData.boarding.prepInitial)} ${e(this.shipCompareData.boarding.prepInitial,this._shipBaseData.boarding.prepInitial)}`,cannonsAccuracy:`${(0,m.IH)(100*this.shipCompareData.boarding.cannonsAccuracy)} ${e(100*this.shipCompareData.boarding.cannonsAccuracy,100*this._shipBaseData.boarding.cannonsAccuracy)}`,reload:`${(0,m.IH)(100*this.shipCompareData.gunnery.reload)} ${e(this._shipBaseData.gunnery.reload,this.shipCompareData.gunnery.reload,3,!0)}`,penetration:`${(0,m.IH)(100*this.shipCompareData.gunnery.penetration)} ${e(this.shipCompareData.gunnery.penetration,this._shipBaseData.gunnery.penetration,3,!0)}`,dispersionHorizontal:`${(0,m.IH)(100*this.shipCompareData.gunnery.dispersionHorizontal)} ${e(this._shipBaseData.gunnery.dispersionHorizontal,this.shipCompareData.gunnery.dispersionHorizontal,3,!0)}`,dispersionVertical:`${(0,m.IH)(100*this.shipCompareData.gunnery.dispersionVertical)} ${e(this._shipBaseData.gunnery.dispersionVertical,this.shipCompareData.gunnery.dispersionVertical,3,!0)}`,traverseUpDown:`${(0,m.IH)(100*this.shipCompareData.gunnery.traverseUpDown)} ${e(this.shipCompareData.gunnery.traverseUpDown,this._shipBaseData.gunnery.traverseUpDown,3,!0)}`,traverseSide:`${(0,m.IH)(100*this.shipCompareData.gunnery.traverseSide)} ${e(this.shipCompareData.gunnery.traverseSide,this._shipBaseData.gunnery.traverseSide,3,!0)}`,acceleration:`${(0,m.$1)(this.shipCompareData.ship.acceleration)} ${e(this.shipCompareData.ship.acceleration,this._shipBaseData.ship.acceleration,2)}`,additionalRow:""+(this.shipCompareData.guns.decks<4?"<br> ":""),backArmor:`${(0,m.yI)(this.shipCompareData.stern.armour)} ${e(this.shipCompareData.stern.armour,this._shipBaseData.stern.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.stern.thickness)}</span>${e(this.shipCompareData.stern.thickness,this._shipBaseData.stern.thickness)}`,battleRating:`${this.shipCompareData.battleRating} ${e(this.shipCompareData.battleRating,this._shipBaseData.battleRating)}`,cannonBroadside:`${this.shipCompareData.guns.broadside.cannons} ${e(this.shipCompareData.guns.broadside.cannons,this._shipBaseData.guns.broadside.cannons)}`,cannonsPerDeck:p.getCannonsPerDeck(this.shipCompareData.guns),carroBroadside:`${this.shipCompareData.guns.broadside.carronades} ${e(this.shipCompareData.guns.broadside.carronades,this._shipBaseData.guns.broadside.carronades)}`,deceleration:`${(0,m.$1)(this.shipCompareData.ship.deceleration)} ${e(this.shipCompareData.ship.deceleration,this._shipBaseData.ship.deceleration,2)}`,rollAngle:`${(0,m.yI)(this.shipCompareData.ship.rollAngle)} ${e(this._shipBaseData.ship.rollAngle,this.shipCompareData.ship.rollAngle)}`,turnAcceleration:`${(0,m.$1)(this.shipCompareData.ship.turnAcceleration)} ${e(this.shipCompareData.ship.turnAcceleration,this._shipBaseData.ship.turnAcceleration,2)}`,turnSpeed:`${(0,m.$1)(this.shipCompareData.ship.turnSpeed,3)} ${e(this.shipCompareData.ship.turnSpeed,this._shipBaseData.ship.turnSpeed,2)}`,decks:(0,o.gY)(this.shipCompareData.guns.decks,"deck"),firezoneHorizontalWidth:`${this.shipCompareData.ship.firezoneHorizontalWidth} ${e(this.shipCompareData.ship.firezoneHorizontalWidth,this._shipBaseData.ship.firezoneHorizontalWidth)}`,frontArmor:`${(0,m.yI)(this.shipCompareData.bow.armour)} ${e(this.shipCompareData.bow.armour,this._shipBaseData.bow.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.bow.thickness)}</span>${e(this.shipCompareData.bow.thickness,this._shipBaseData.bow.thickness)}`,guns:`${this.shipCompareData.guns.total} ${e(this.shipCompareData.guns.total,this._shipBaseData.guns.total)}`,gunsBack:this.shipCompareData.guns.gunsPerDeck[5].amount,gunsFront:this.shipCompareData.guns.gunsPerDeck[4].amount,halfturnTime:`${(0,m.$1)(this.shipCompareData.rudder.halfturnTime,4)} ${e(this._shipBaseData.rudder.halfturnTime,this.shipCompareData.rudder.halfturnTime,2)}`,holdSize:`${(0,m.yI)(this.shipCompareData.holdSize)} ${e(this.shipCompareData.holdSize,this._shipBaseData.holdSize)}`,hullRepairAmount:`${(0,m.yI)(100*(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk))} ${e(this.shipCompareData.repairAmount.armour+this.shipCompareData.repairAmount.armourPerk,this._shipBaseData.repairAmount.armour+this._shipBaseData.repairAmount.armourPerk,3,!0)}`,hullRepairsNeeded:`${(0,m.yI)(i)} <span class="badge badge-white">${(0,m.yI)(i*f.XI)}</span>`,leakResistance:`${(0,m.IH)(100*this.shipCompareData.resistance.leaks)} ${e(this.shipCompareData.resistance.leaks,this._shipBaseData.resistance.leaks,2,!0)}`,limitBack:this.shipCompareData.guns.gunsPerDeck[5],limitFront:this.shipCompareData.guns.gunsPerDeck[4],mastBottomArmor:`${(0,m.yI)(this.shipCompareData.mast.bottomArmour)} ${e(this.shipCompareData.mast.bottomArmour,this._shipBaseData.mast.bottomArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.mast.bottomThickness)}</span>${e(this.shipCompareData.mast.bottomThickness,this._shipBaseData.mast.bottomThickness)}`,mastMiddleArmor:`${(0,m.yI)(this.shipCompareData.mast.middleArmour)} ${e(this.shipCompareData.mast.middleArmour,this._shipBaseData.mast.middleArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.mast.middleThickness)}</span>${e(this.shipCompareData.mast.middleThickness,this._shipBaseData.mast.middleThickness)}`,mastTopArmor:`${(0,m.yI)(this.shipCompareData.mast.topArmour)} ${e(this.shipCompareData.mast.topArmour,this._shipBaseData.mast.topArmour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.mast.topThickness)}</span>${e(this.shipCompareData.mast.topThickness,this._shipBaseData.mast.topThickness)}`,maxCrew:`${(0,m.yI)(this.shipCompareData.crew.max)} ${e(this.shipCompareData.crew.max,this._shipBaseData.crew.max)}`,maxSpeed:`${(0,m.$1)(this.shipCompareData.speed.max,3)} ${e(this.shipCompareData.speed.max,this._shipBaseData.speed.max,2)}`,maxWeight:`${(0,m.yI)(this.shipCompareData.maxWeight)} ${e(this.shipCompareData.maxWeight,this._shipBaseData.maxWeight)}`,minCrew:(0,m.yI)(this.shipCompareData.crew.min),cannonCrew:`${(0,m.yI)(this.shipCompareData.crew.cannons)} ${e(this._shipBaseData.crew.cannons,this.shipCompareData.crew.cannons)}`,carroCrew:`${(0,m.yI)(this.shipCompareData.crew.carronades)} ${e(this._shipBaseData.crew.carronades,this.shipCompareData.crew.carronades)}`,minSpeed:`${(0,m.$1)(this.shipCompareData.speed.min)} ${e(this.shipCompareData.speed.min,this._shipBaseData.speed.min,2)}`,repairTime:`${(0,m.yI)(this.shipCompareData.repairTime.sides)} ${e(this._shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides)}`,rigRepairAmount:`${(0,m.yI)(100*(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk))} ${e(this.shipCompareData.repairAmount.sails+this.shipCompareData.repairAmount.sailsPerk,this._shipBaseData.repairAmount.sails+this._shipBaseData.repairAmount.sailsPerk,3,!0)}`,rigRepairsNeeded:`${(0,m.yI)(r)} <span class="badge badge-white">${(0,m.yI)(r*f.XI)}</span>`,rumRepairsNeeded:`${(0,m.yI)(n)} <span class="badge badge-white">${(0,m.yI)(n*f.XI)}</span>`,sailingCrew:`${(0,m.yI)(this.shipCompareData.crew.sailing)}`,sails:`${(0,m.yI)(this.shipCompareData.sails.armour)} ${e(this.shipCompareData.sails.armour,this._shipBaseData.sails.armour)}`,shipRating:`${(0,g.hi)(this.shipCompareData.class)} rate`,sideArmor:`${(0,m.yI)(this.shipCompareData.sides.armour)} ${e(this.shipCompareData.sides.armour,this._shipBaseData.sides.armour)}</br><span class="badge badge-white">${(0,m.yI)(this.shipCompareData.sides.thickness)}</span>${e(this.shipCompareData.sides.thickness,this._shipBaseData.sides.thickness)}`,splinterResistance:`${(0,m.IH)(100*this.shipCompareData.resistance.splinter)} ${e(this.shipCompareData.resistance.splinter,this._shipBaseData.resistance.splinter,2,!0)}`,structure:`${(0,m.yI)(this.shipCompareData.structure.armour)} ${e(this.shipCompareData.structure.armour,this._shipBaseData.structure.armour)}`,upgradeXP:`${(0,m.yI)(this.shipCompareData.upgradeXP)} ${e(this._shipBaseData.upgradeXP,this.shipCompareData.upgradeXP)}`,waterlineHeight:`${(0,m.$1)(this.shipCompareData.ship.waterlineHeight)} ${e(this.shipCompareData.ship.waterlineHeight,this._shipBaseData.ship.waterlineHeight,2)}`,cannonWeight:`${(0,m.yI)(this.shipCompareData.guns.weight.cannons)} ${e(this._shipBaseData.guns.weight.cannons,this.shipCompareData.guns.weight.cannons)}`,carroWeight:`${(0,m.yI)(this.shipCompareData.guns.weight.carronades)} ${e(this._shipBaseData.guns.weight.carronades,this.shipCompareData.guns.weight.carronades)}`};d.repairWeight=`${(0,m.yI)((i+r+.1*n)*f.XI)} ${e((t+a+.1*s)*f.XI,(i+r+.1*n)*f.XI)}`,d.gunsFront?d.gunsFront+=` ${p.pd(d.limitFront)}`:d.gunsFront="–",d.gunsBack?d.gunsBack+=` ${p.pd(d.limitBack)}`:d.gunsBack="–",A(`${this.select}`).find("div").append(p.getText(d))}}a(6801),a(7424);var T=a(475),M=a(6301),R=a(7484),W=a.n(R),N=a(285),L=a.n(N),H=a(178),j=a.n(H),V=a(2855),F=a(4738),O=a(2619),U=a(3609);function Z(e){return function(e){if(Array.isArray(e))return X(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return X(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return X(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}function z(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function Y(e,t){var a=t.get(e);if(!a)throw new TypeError("attempted to get private field on non-instance");return a.get?a.get.call(e):a.value}function G(e,t,a){var s=t.get(e);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(e,a);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=a}return a}W().extend(L()),W().extend(j());var q=new WeakMap,E=new WeakMap;class K{constructor(e="ship-compare"){z(this,"colorScale",void 0),z(this,"colourScaleSpeedDiff",void 0),z(this,"columnsCompare",void 0),z(this,"innerRadius",void 0),z(this,"outerRadius",void 0),z(this,"radiusSpeedScale",void 0),z(this,"selectedShips",void 0),z(this,"singleShipData",void 0),z(this,"shipMassScale",void 0),z(this,"svgHeight",void 0),z(this,"svgWidth",void 0),z(this,"windProfileRotate",0),z(this,"woodCompare",void 0),q.set(this,{writable:!0,value:void 0}),E.set(this,{writable:!0,value:void 0}),z(this,"_maxSpeed",void 0),z(this,"_minSpeed",void 0),z(this,"_modal$",{}),z(this,"_modifierAmount",new Map),z(this,"_moduleAndWoodCaps",void 0),z(this,"_moduleAndWoodChanges",void 0),z(this,"_moduleDataDefault",void 0),z(this,"_moduleProperties",void 0),z(this,"_moduleTypes",void 0),z(this,"_selectedUpgradeIdsList",{}),z(this,"_selectedUpgradeIdsPerType",{}),z(this,"_selectModule$",{}),z(this,"_selectShip$",{}),z(this,"_selectWood$",{}),z(this,"_shipData",void 0),z(this,"_shipIds",{}),z(this,"_shipSelectData",void 0),z(this,"_baseId",void 0),z(this,"_baseName",void 0),z(this,"_buttonId",void 0),z(this,"_columns",void 0),z(this,"_copyButtonId",void 0),z(this,"_cloneLeftButtonId",void 0),z(this,"_cloneRightButtonId",void 0),z(this,"_imageButtonId",void 0),z(this,"_modalId",void 0),z(this,"_moduleId",void 0),z(this,"_woodId",void 0),this._baseId=e,this._baseName="Compare ships",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._moduleId=`${this._baseId}-module`,this._copyButtonId=`button-copy-${this._baseId}`,this._cloneLeftButtonId=`button-clone-left-${this._baseId}`,this._cloneRightButtonId=`button-clone-right-${this._baseId}`,this._imageButtonId=`button-image-${this._baseId}`,this.colourScaleSpeedDiff=(0,h.Z)().range([o.gc,o.L$,o.fy]).interpolate(M.Z),"ship-compare"===this._baseId?this.columnsCompare=["C1","C2"]:this.columnsCompare=[],this._columns=this.columnsCompare.slice(),this._columns.unshift("Base"),this.selectedShips={Base:{},C1:{},C2:{}},this._woodId="wood-ship",this._setupArrow(),"ship-journey"!==this._baseId&&this._setupListener()}static _getModuleLevel(e){return e<=3?"L":e<=5?"M":"S"}static _adjustAbsolute(e,t){return e?e+t:t}static _adjustPercentage(e,t,a){return a?e?e*(1+t):t:e?e+t:t}static _getModifierFromModule(e){return`<p class="mb-0">${e.map((e=>{let t;return t=e.isPercentage?(0,m.xp)(e.amount/100):e.amount<1&&e.amount>0?(0,m.nM)(e.amount,1):(0,m.LQ)(e.amount,2),`${e.modifier} ${t}`})).join("<br>")}</p>`}static _setSelect(e,t){let a;a=Array.isArray(t)?t.map((e=>String(e))):String(t),a&&e.val(a),e.selectpicker("render")}static _saveCanvasAsImage(e){const t=`na-map ship compare ${W().utc().format("YYYY-MM-DD HH-mm-ss")}.png`,a=document.createElement("a");a.href=e,a.download=t,document.body.append(a),a.click(),a.remove()}_getShipId(e){return this._shipIds[e]}_setShip(e,t){this._shipIds[e]=t,K._setSelect(this._selectShip$[e],t),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects()}_cloneShipData(e,t){const a=this._getShipId(e);return a&&this._setShip(t,a),void 0!==a}_getWoodId(e,t){return Number(this._selectWood$[e][t].val())}_setWood(e,t,a){K._setSelect(this._selectWood$[e][t],a),this.woodCompare._woodSelected(e,t,this._selectWood$[e][t])}_cloneWoodData(e,t){if(this.woodCompare.enableSelects(t),""!==this._selectWood$[e].frame.val())for(const a of u.Kf){const s=this._getWoodId(e,a);this._setWood(t,a,s)}}_getModuleIds(e,t){return this._selectedUpgradeIdsPerType[e][t]}_setModules(e,t,a){var s;this._selectedUpgradeIdsPerType[e]||(this._selectedUpgradeIdsPerType[e]={}),this._selectedUpgradeIdsList[e]||(this._selectedUpgradeIdsList[e]=[]),this._selectedUpgradeIdsPerType[e][t]=a.map((e=>Number(e))),K._setSelect(this._selectModule$[e][t],this._selectedUpgradeIdsPerType[e][t]),(s=this._selectedUpgradeIdsList[e]).push.apply(s,Z(this._selectedUpgradeIdsPerType[e][t]))}_cloneModuleData(e,t){if(this._setupModulesSelect(t),this._selectedUpgradeIdsPerType[e])for(const a of Z(this._moduleTypes)){const s=this._getModuleIds(e,a);this._setModules(t,a,s)}}_cloneShipToLeft(e){const t=this._columns.findIndex((t=>t===e)),a=this._columns[t-1];this._cloneShipData(e,a)&&(this._cloneWoodData(e,a),this._cloneModuleData(e,a),this._refreshShips(a))}_cloneShipToRight(e){const t=this._columns.findIndex((t=>t===e)),a=this._columns[t+1];this._cloneShipData(e,a)&&(this._cloneWoodData(e,a),this._cloneModuleData(e,a),this._refreshShips(a))}async CompareShipsInit(){await this._loadAndSetupData(),this._initData(),this._initSelects()}async initFromClipboard(e){var t;await this._loadAndSetupData();const a=f.PD.decode(null!==(t=e.get("cmp"))&&void 0!==t?t:"");a.length>0&&(this._shipCompareSelected(),this._setShipAndWoodsSelects(a),this._setModuleSelects(e))}_setupArrow(){const e=document.querySelector("#journey-arrow");if(e){const t=e.cloneNode(!0);if(t.id="wind-profile-arrow-head",t.hasChildNodes())for(const e of t.childNodes)e.classList.replace("journey-arrow-head","wind-profile-arrow-head");const a=document.querySelector("#na-map svg defs");a&&a.append(t)}}_setupData(){var e,t,a;this._moduleAndWoodChanges=new Map([["Cannon horizontal dispersion",{properties:["gunnery.dispersionHorizontal"],isBaseValueAbsolute:!0}],["Cannon vertical dispersion",{properties:["gunnery.dispersionVertical"],isBaseValueAbsolute:!0}],["Cannon reload time",{properties:["gunnery.reload"],isBaseValueAbsolute:!0}],["Cannon ball penetration",{properties:["gunnery.penetration"],isBaseValueAbsolute:!0}],["Cannon side traverse",{properties:["gunnery.traverseSide"],isBaseValueAbsolute:!0}],["Cannon up/down traverse",{properties:["gunnery.traverseUpDown"],isBaseValueAbsolute:!0}],["Morale",{properties:["boarding.morale"],isBaseValueAbsolute:!0}],["Muskets accuracy",{properties:["boarding.musketsAccuracy"],isBaseValueAbsolute:!1}],["Preparation",{properties:["boarding.prepPerRound"],isBaseValueAbsolute:!0}],["Initial preparation",{properties:["boarding.prepInitial"],isBaseValueAbsolute:!0}],["Melee attack",{properties:["boarding.attack"],isBaseValueAbsolute:!1}],["Melee defense",{properties:["boarding.defense"],isBaseValueAbsolute:!1}],["Disengage time",{properties:["boarding.disengageTime"],isBaseValueAbsolute:!0}],["Crew with muskets",{properties:["boarding.musketsCrew"],isBaseValueAbsolute:!0}],["Boarding cannons accuracy",{properties:["boarding.cannonsAccuracy"],isBaseValueAbsolute:!1}],["Acceleration",{properties:["ship.acceleration"],isBaseValueAbsolute:!0}],["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],isBaseValueAbsolute:!0}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],isBaseValueAbsolute:!0}],["Armour repair amount (perk)",{properties:["repairAmount.armourPerk"],isBaseValueAbsolute:!0}],["Back armour thickness",{properties:["stern.thickness"],isBaseValueAbsolute:!0}],["Cannon crew",{properties:["crew.cannons"],isBaseValueAbsolute:!0}],["Carronade crew",{properties:["crew.carronades"],isBaseValueAbsolute:!0}],["Crew",{properties:["crew.max"],isBaseValueAbsolute:!0}],["Deceleration",{properties:["ship.deceleration"],isBaseValueAbsolute:!0}],["Front armour thickness",{properties:["bow.thickness"],isBaseValueAbsolute:!0}],["Hold weight",{properties:["maxWeight"],isBaseValueAbsolute:!0}],["Hull hit points",{properties:["structure.armour"],isBaseValueAbsolute:!0}],["Sail hit points",{properties:["sails.armour"],isBaseValueAbsolute:!0}],["Mast hit points",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Leak resistance",{properties:["resistance.leaks"],isBaseValueAbsolute:!1}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],isBaseValueAbsolute:!0}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],isBaseValueAbsolute:!0}],["Max speed",{properties:["speed.max"],isBaseValueAbsolute:!0}],["Repair amount",{properties:["repairAmount.armour"],isBaseValueAbsolute:!0}],["Repair time",{properties:["repairTime.sides"],isBaseValueAbsolute:!0}],["Roll angle",{properties:["ship.rollAngle"],isBaseValueAbsolute:!0}],["Rudder health",{properties:["rudder.armour"],isBaseValueAbsolute:!0}],["Rudder speed",{properties:["rudder.halfturnTime"],isBaseValueAbsolute:!0}],["Sail repair amount (perk)",{properties:["repairAmount.sailsPerk"],isBaseValueAbsolute:!0}],["Sailing crew",{properties:["crew.sailing"],isBaseValueAbsolute:!0}],["Splinter resistance",{properties:["resistance.splinter"],isBaseValueAbsolute:!1}],["Turn acceleration",{properties:["ship.turnAcceleration"],isBaseValueAbsolute:!0}],["Turn speed",{properties:["ship.turnSpeed"],isBaseValueAbsolute:!0}],["Water pump health",{properties:["pump.armour"],isBaseValueAbsolute:!0}]]),G(this,q,new Set(["Turn acceleration"])),this._moduleAndWoodCaps=new Map([["Armor thickness",{properties:["sides.thickness"],cap:{amount:1,isPercentage:!0}}],["Armour hit points",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:1,isPercentage:!0}}],["Structure hit points",{properties:["structure.armour"],cap:{amount:1,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:1,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:1,isPercentage:!0}}],["Max speed",{properties:["speed.max"],cap:{amount:18,isPercentage:!1}}],["Turn rate",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const s=1.2*(null!==(e=(0,w.Z)(this._shipData,(e=>e.speed.min)))&&void 0!==e?e:0),i=this._moduleAndWoodCaps.get("Max speed").cap.amount;this._minSpeed=s,this._maxSpeed=i,this.colorScale=(0,h.Z)().domain([this._minSpeed,0,this._maxSpeed]).range([o.gc,o.L$,o.fy]).interpolate(M.Z);const r=null!==(t=(0,w.Z)(this._shipData,(e=>e.shipMass)))&&void 0!==t?t:0,n=null!==(a=(0,I.Z)(this._shipData,(e=>e.shipMass)))&&void 0!==a?a:0;this.shipMassScale=(0,h.Z)().domain([r,n]).range([100,150])}async _loadAndSetupData(){this._moduleDataDefault=(await a.e(303).then(a.t.bind(a,7728,19))).default,this._shipData=(await a.e(228).then(a.t.bind(a,4237,19))).default,this._setupData(),"ship-journey"!==this._baseId&&(this.woodCompare=new O.Z(this._woodId),await this.woodCompare.woodInit())}_setupListener(){var e;let t=!0;null===(e=document.querySelector(`#${this._buttonId}`))||void 0===e||e.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,V.KS)("Tools",this._baseName),this._shipCompareSelected()}))}_setGraphicsParameters(){var e;this.svgWidth=null!==(e=U(`#${this._modalId} .column-base`).width())&&void 0!==e?e:0,this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusSpeedScale=(0,h.Z)().domain([this._minSpeed,0,this._maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_getShipName(e){var t,a;return null!==(t=null===(a=this._shipData.find((t=>t.id===e)))||void 0===a?void 0:a.name)&&void 0!==t?t:""}_getSelectedData(e){const t={moduleData:new Map,ship:"",wood:[]};if(this._shipIds[e]){t.ship=this._getShipName(this._shipIds[e]);for(const a of u.Kf)t.wood.push(this.woodCompare.getWoodName(a,Number(this._selectWood$[e][a].val())));if(this._selectedUpgradeIdsPerType[e])for(const i of Z(this._moduleTypes)){const r=[];for(const t of this._selectedUpgradeIdsPerType[e][i]){var a,s;r.push(null!==(a=null===(s=this._moduleProperties.get(t))||void 0===s?void 0:s.name.replace(" Bonus",""))&&void 0!==a?a:"")}t.moduleData.set(i,r.join(", "))}}return t}_printSelectedData(e,t,a){const i=e.querySelectorAll(`#${this._baseId}-${a.toLowerCase()} label`),r=i[0].parentNode,o=i[0].offsetHeight;for(const e of i)e.remove();const n=(0,s.Z)(r).insert("div",":first-child").style("height",5*o+"px");t.ship&&n.append("div").style("margin-bottom","5px").style("line-height","1.1").text(t.ship),""!==t.wood[0]&&n.append("div").style("font-size","smaller").style("margin-bottom","5px").style("line-height","1.1").text(t.wood.join(" | "));for(const[e,a]of t.moduleData)""!==a&&n.append("div").style("font-size","small").style("margin-bottom","5px").style("line-height","1.1").html(`<em>${e}</em>: ${a}`)}_replaceSelectsWithText(e){for(const t of this._columns){const a=this._getSelectedData(t);this._printSelectedData(e,a,t)}}_setMakeImageSpinner(){Y(this,E).select("i").remove(),Y(this,E).attr("class","btn btn-primary").property("disabled",!0),Y(this,E).append("span").attr("class","spinner-border spinner-border-sm").attr("role","status").attr("aria-hidden","true"),Y(this,E).append("span").attr("class","sr-only").text("Loading...")}_unsetMakeImageSpinner(){Y(this,E).selectAll("span").remove(),Y(this,E).attr("class","btn btn-outline-secondary icon-outline-button").property("disabled",!1),Y(this,E).append("i").attr("class","icon icon-image")}async _makeImage(e){e.preventDefault(),this._setMakeImageSpinner();const t=await a.e(5).then(a.t.bind(a,1120,23)),s=document.querySelector(`#${this._modalId} .modal-dialog .modal-content .modal-body`);if(s){const e=await t.default(s,{allowTaint:!0,foreignObjectRendering:!0,ignoreElements:e=>e.classList.contains("central")||e.classList.contains("overlay")||e.classList.contains("navbar"),logging:!0,onclone:e=>{this._replaceSelectsWithText(e)},x:0,y:0});K._saveCanvasAsImage(e.toDataURL())}this._unsetMakeImageSpinner()}_shipCompareSelected(){var e,t,a;(0,u.xb)(this._modal$)&&(this._initModal(),this._modal$=U(`#${this._modalId}`),null===(e=document.querySelector(`#${this._modalId}`))||void 0===e||e.addEventListener("keydown",(e=>{"KeyC"===e.key&&e.ctrlKey&&this._copyDataClicked(e)})),null===(t=document.querySelector(`#${this._copyButtonId}`))||void 0===t||t.addEventListener("click",(e=>{this._copyDataClicked(e)})),null===(a=document.querySelector(`#${this._imageButtonId}`))||void 0===a||a.addEventListener("click",(async e=>{(0,V.KS)("Menu","Ship compare image"),await this._makeImage(e)})));this._modal$.modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];for(const t of this._columns){const a=this._getShipId(t);if(a){e.push(a);for(const a of u.Kf){const s=this._getWoodId(t,a);e.push(s)}}}return e}_copyDataClicked(e){(0,V.KS)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length>0){const e=new URL(window.location.href);e.searchParams.set("v",encodeURIComponent(o.f4)),e.searchParams.set("cmp",f.PD.encode(t));for(const t of this._columns){const a=this._columns.indexOf(t);if(this._selectedUpgradeIdsPerType[t])for(const s of Z(this._moduleTypes)){const i=this._getModuleIds(t,s),r=Z(this._moduleTypes).indexOf(s);if(null!=i&&i.length){const t=`${a}${r}`;e.searchParams.set(t,f.PD.encode(i))}}}(0,_.vQ)(e.href,this._modal$)}}_setupShipData(){this._shipSelectData=Z((0,T.ZP)(this._shipData,(e=>e.class))).map((([e,t])=>({key:e,values:t.map((e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns.total}))).sort((0,F.MR)(["name"]))}))).sort((0,F.MR)(["key"]))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.flatMap((e=>e[1].filter((e=>e.properties.some((e=>this._moduleAndWoodChanges.has(e.modifier))))).map((e=>[e.id,e]))))),this._moduleTypes=new Set(Z(this._moduleProperties).map((e=>e[1].type.replace(/\s\u2013\s[\s/A-Za-z\u25CB]+/,""))))}_injectModal(){(0,o.Eu)({id:this._modalId,title:this._baseName});const e=(0,s.Z)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row");for(const t of this._columns){const a=e.append("div").attr("id",`${this._baseId}-${t.toLowerCase()}`).attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),s=this._getShipSelectId(t),i=a.append("div").attr("class","input-group justify-content-between mb-1");t!==this._columns[0]&&i.append("div").attr("class","input-group-prepend").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneLeftButtonId}-${t}`).attr("title","Clone ship to left").attr("type","button").append("i").attr("class","icon icon-clone-left"),i.append("label").append("select").attr("name",s).attr("id",s).attr("class","selectpicker"),t!==this.columnsCompare[this.columnsCompare.length-1]&&i.append("div").attr("class","input-group-append").append("button").attr("class","btn btn-default icon-outline-button").attr("id",`${this._cloneRightButtonId}-${t}`).attr("title","Clone ship to right").attr("type","button").append("i").attr("class","icon icon-clone-right");const r=a.append("div").attr("class","input-group justify-content-between mb-1");for(const e of u.Kf){const a=this._getWoodSelectId(e,t);r.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}const o=a.append("div").attr("class","input-group justify-content-between");for(const e of this._moduleTypes){const a=this._getModuleSelectId(e,t);o.append("label").attr("class","mb-1").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}a.append("div").attr("id",`${this._baseId}-${t}`).attr("class",("Base"===t?"ship-base":"ship-compare")+" compress")}const t=(0,s.Z)(`#${this._modalId} .modal-footer`);t.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").attr("class","icon icon-copy"),G(this,E,t.insert("button","button").attr("class","btn btn-outline-secondary icon-outline-button").attr("id",this._imageButtonId).attr("title","Make image").attr("type","button")),Y(this,E).append("i").attr("class","icon icon-image")}_initData(){this._setupShipData(),this._setupModuleData()}_initSelectColumns(){for(const e of this._columns){if(this._setupShipSelect(e),"ship-journey"!==this._baseId){this._selectWood$[e]={};for(const t of u.Kf)this._selectWood$[e][t]=U(`#${this._getWoodSelectId(t,e)}`),this.woodCompare._setupWoodSelects(e,t,this._selectWood$[e][t])}this._setupSelectListener(e)}}_initSelects(){this._initSelectColumns()}_initCloneListeners(){for(const a of this._columns){var e,t;if(a!==this._columns[0])null===(e=document.querySelector(`#${this._cloneLeftButtonId}-${a}`))||void 0===e||e.addEventListener("click",(()=>{this._cloneShipToLeft(a)}));if(a!==this.columnsCompare[this.columnsCompare.length-1])null===(t=document.querySelector(`#${this._cloneRightButtonId}-${a}`))||void 0===t||t.addEventListener("click",(()=>{this._cloneShipToRight(a)}))}}_initModal(){this._initData(),this._injectModal(),this._initSelects(),this._initCloneListeners()}_getShipOptions(){return this._shipSelectData.map((e=>`<optgroup label="${(0,g.hi)(Number(e.key),!1)} rate">${e.values.map((e=>`<option data-subtext="${e.battleRating} ${(0,f.WP)(e.name)?"Imported":""}" value="${e.id}">${(0,f.td)(e.name)} (${e.guns})`)).join("</option>")}`)).join("</optgroup>")}_setupShipSelect(e){this._selectShip$[e]=U(`#${this._getShipSelectId(e)}`);const t=this._getShipOptions();this._selectShip$[e].append(t),"Base"!==e&&this._selectShip$[e].attr("disabled","disabled")}_getUpgradesOptions(e,t){const a=Z(this._moduleProperties).filter((a=>a[1].type.replace(/\s–\s[\s/A-Za-z\u25CB]+/,"")===e&&("U"===a[1].moduleLevel||a[1].moduleLevel===K._getModuleLevel(t)))),s=Z((0,T.ZP)(a,(e=>e[1].type.replace(/[\sA-Za-z]+\s–\s/,"")))).map((([e,t])=>({key:e,values:t.sort(((e,t)=>e[1].name.localeCompare(t[1].name)))}))).sort((0,F.MR)(["key"]));let i;const r=new Set(["Permanent","Ship trim"]);return i=s.length>1?s.map((t=>`<optgroup label="${t.key}" data-max-options="${r.has(e.replace(/[\sA-Za-z]+\s–\s/,""))?1:5}">${t.values.map((e=>`<option value="${e[0]}">${e[1].name}`)).join("</option>")}`)).join("</optgroup>"):s.map((e=>`${e.values.map((e=>`<option value="${e[0]}">${e[1].name}`)).join("</option>")}`)).join(""),i}_fillModuleSelect(e,t){const a=this._getUpgradesOptions(t,(()=>this._shipData.find((t=>t.id===this._shipIds[e])).class)());this._selectModule$[e][t].find("option").remove(),this._selectModule$[e][t].append(a)}_resetModuleSelects(e){for(const t of this._moduleTypes)this._fillModuleSelect(e,t),this._selectModule$[e][t].selectpicker("refresh")}_getModuleFromName(e){let t={};return this._moduleDataDefault.some((a=>(t=a[1].find((t=>t.name===e)),Boolean(t)))),t}_setupModulesSelect(e){if(!this._selectModule$[e]){this._selectModule$[e]={};for(const t of this._moduleTypes){const a=new Map;this._selectModule$[e][t]=U(`#${this._getModuleSelectId(t,e)}`),this._selectModule$[e][t].on("changed.bs.select",(()=>{this._modulesSelected(e),this._refreshShips(e)})).on("show.bs.select",(e=>{const t=U(e.currentTarget);t.parent().find("button.bs-select-all").remove();for(const e of t.data("selectpicker").selectpicker.current.elements)if(!e.classList.contains("dropdown-divider")&&!e.classList.contains("dropdown-header")){const t=this._getModuleFromName(e.textContent);U(e).attr("data-original-title",K._getModifierFromModule(t.properties)).tooltip({boundary:"viewport",html:!0}).on("show.bs.tooltip",(()=>{a.set(t.id,U(e))})).on("hide.bs.tooltip",(()=>{a.set(t.id,null)}))}})).selectpicker({actionsBox:!0,countSelectedText:e=>`${e} ${t.toLowerCase()}s selected`,deselectAllText:"Clear",liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",maxOptions:t.startsWith("Ship trim")?6:5,selectedTextFormat:"count > 1",title:`${t}`,width:"150px"}).on("hide.bs.select",(()=>{for(const[,e]of a)e&&e.tooltip("hide");a.clear()}))}}this._resetModuleSelects(e)}_getShipData(e){const t=this._shipData.find((t=>t.id===this._shipIds[e]));t.boarding={attack:0,cannonsAccuracy:0,defense:0,disengageTime:4,morale:t.boarding.morale,musketsAccuracy:0,musketsCrew:30,prepInitial:t.boarding.prepInitial,prepPerRound:t.boarding.prepPerRound};let a=t;return a.repairAmount={armour:f.ZT,armourPerk:0,sails:f.i6,sailsPerk:0},a.repairTime={sides:f.OI,default:f.OI},a.resistance={leaks:0,splinter:0},a.gunnery={dispersionHorizontal:0,dispersionVertical:0,penetration:0,reload:0,traverseUpDown:0,traverseSide:0},a=this._addModulesAndWoodData(t,a,e),a}_roundPropertyValue(e,t,a=!1){return Number.isInteger(e)&&!a?Math.round(t):Math.trunc(100*t)/100}_adjustValue(e,t,a){var s,i;let r=e;if(0!==(null===(s=this._modifierAmount.get(t))||void 0===s?void 0:s.percentage)){const e=this._modifierAmount.get(t).percentage/100;r=K._adjustPercentage(r,e,a)}if(0!==(null===(i=this._modifierAmount.get(t))||void 0===i?void 0:i.absolute)){const{absolute:e}=this._modifierAmount.get(t);r=K._adjustAbsolute(r,e)}const o=Y(this,q).has(t)||a||0===e;return this._roundPropertyValue(e,r,o)}_setModifier(e){let t=e.isPercentage?0:e.amount,a=e.isPercentage?e.amount:0;var s,i,r,o;this._modifierAmount.has(e.modifier)&&(t+=null!==(s=null===(i=this._modifierAmount.get(e.modifier))||void 0===i?void 0:i.absolute)&&void 0!==s?s:0,a+=null!==(r=null===(o=this._modifierAmount.get(e.modifier))||void 0===o?void 0:o.percentage)&&void 0!==r?r:0);this._modifierAmount.set(e.modifier,{absolute:t,percentage:a})}_showCappingAdvice(e,t){const a=`${this._baseId}-${e}-capping`;let s=document.querySelector(`#${a}`);if(!s){var i;s=document.createElement("p"),s.id=a,s.className="alert alert-warning";const t=document.querySelector(`#${this._baseId}-${e}`);null==t||null===(i=t.firstChild)||void 0===i||i.after(s)}s.innerHTML=`${Z(t).join(", ")} capped`}_removeCappingAdvice(e){const t=`${this._baseId}-${e}-capping`,a=document.querySelector(`#${t}`);a&&a.remove()}_addModulesAndWoodData(e,t,a){const s=JSON.parse(JSON.stringify(t)),i=()=>{s.speedDegrees=s.speedDegrees.map((e=>{const t=1+this._modifierAmount.get("Max speed").percentage/100,a=e>0?e*t:e/t;return Math.max(Math.min(a,this._maxSpeed),this._minSpeed)}))};return this._modifierAmount=new Map,(()=>{for(const e of this._selectedUpgradeIdsList[a]){const t=this._moduleProperties.get(e);for(const e of t.properties)this._moduleAndWoodChanges.has(e.modifier)&&this._setModifier(e)}if(this.woodCompare.instances[a]){let e="_woodData";"Base"!==a&&(e="_compareData");for(const t of u.Kf)for(const s of this.woodCompare.instances[a][e][t].properties)this._moduleAndWoodChanges.has(s.modifier)&&this._setModifier(s)}})(),(()=>{for(const[t]of this._modifierAmount.entries()){var e;if(null!==(e=this._moduleAndWoodChanges.get(t))&&void 0!==e&&e.properties){const{properties:e,isBaseValueAbsolute:a}=this._moduleAndWoodChanges.get(t);for(const i of e){const e=i.split(".");e.length>1?s[e[0]][e[1]]=this._adjustValue(s[e[0]][e[1]],t,a):s[e[0]]=this._adjustValue(s[e[0]],t,a)}}}})(),(()=>{const t={isCapped:!1,modifiers:new Set},i=(e,a,s,{amount:i,isPercentage:r})=>{const o=Math.min(a,r?this._roundPropertyValue(s,s*(1+i)):i);return a>o&&(t.isCapped=!0,t.modifiers.add(e)),o};for(const[t]of this._modifierAmount.entries())if(this._moduleAndWoodCaps.has(t)){const{cap:a}=this._moduleAndWoodCaps.get(t);for(const r of this._moduleAndWoodCaps.get(t).properties){const o=r.split(".");o.length>1?s[o[0]][o[1]]&&(s[o[0]][o[1]]=i(t,s[o[0]][o[1]],e[o[0]][o[1]],a)):s[o[0]]&&(s[o[0]]=i(t,s[o[0]],e[o[0]],a))}}t.isCapped?this._showCappingAdvice(a,t.modifiers):this._removeCappingAdvice(a)})(),this._modifierAmount.has("Max speed")&&i(),s}_updateDifferenceProfileNeeded(e){"Base"===e||(0,u.xb)(this.selectedShips[e])||this.selectedShips[e].updateDifferenceProfile()}_updateSailingProfile(e){this._updateDifferenceProfileNeeded(e);for(const t of this.columnsCompare)t!==e&&this._updateDifferenceProfileNeeded(t)}_refreshShips(e){if("ship-journey"===this._baseId)this.singleShipData=this._shipData.find((t=>t.id===this._shipIds[e]));else{this._modulesSelected(e);const t=this._getShipData(e);if("Base"===e){this._setSelectedShip(e,new C(e,t,this));for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),(0,u.xb)(this.selectedShips[e])||this._setSelectedShip(e,new B(e,t,this.selectedShips[e].shipCompareData,this))}else this._setSelectedShip(e,new B(e,this.selectedShips.Base.shipData,t,this));this._updateSailingProfile(e)}}_enableCompareSelects(){for(const e of this.columnsCompare)this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={};for(const t of this._moduleTypes)this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map((e=>Number(e))):this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t]?[Number(this._selectedUpgradeIdsPerType[e][t])]:[],this._selectedUpgradeIdsPerType[e][t].length>0&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))}_setupSelectListener(e){if(this._selectShip$[e].selectpicker({title:"Ship"}).on("changed.bs.select",(()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),"ship-journey"!==this._baseId&&this._setupModulesSelect(e),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),"ship-journey"!==this._baseId&&this.woodCompare.enableSelects(e)})),"ship-journey"!==this._baseId)for(const t of u.Kf)this._selectWood$[e][t].on("changed.bs.select",(()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)})).selectpicker({title:`Wood ${t}`,width:"150px"})}_setShipAndWoodsSelects(e){let t=0;this._columns.some((a=>{if(!this._shipData.find((a=>a.id===e[t])))return!1;if(this._setShip(a,e[t]),t+=1,this.woodCompare.enableSelects(a),this._setupModulesSelect(a),e[t])for(const s of u.Kf)this._setWood(a,s,e[t]),t+=1;else t+=2;return this._refreshShips(a),t>=e.length}))}_setModuleSelects(e){for(const t of this._columns){const a=this._columns.indexOf(t);let s=!1;for(const i of Z(this._moduleTypes)){const r=Z(this._moduleTypes).indexOf(i);if(e.has(`${a}${r}`)){const o=f.PD.decode(e.get(`${a}${r}`));this._setModules(t,i,o),s=!0}}s&&this._refreshShips(t)}}_getShipSelectId(e){return`${this._baseId}-${e}-select`}_getWoodSelectId(e,t){return`${this._woodId}-${e}-${t}-select`}_getModuleSelectId(e,t){return`${this._moduleId}-${e.replace(/\s/,"")}-${t}-select`}_setSelectedShip(e,t){this.selectedShips[e]=t}}},2619:function(e,t,a){a.d(t,{Z:function(){return b}});a(6801),a(7424),a(1936);var s=a(7622),i=a(8823),r=a(4017),o=a(2855),n=a(2157),p=a(9022),d=a(7015),h=a(4738),l=a(3609);function c(e){return function(e){if(Array.isArray(e))return u(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return u(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return u(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}function m(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}class g{constructor(e,t){m(this,"select",void 0),m(this,"_woodCompare",void 0),m(this,"_id",void 0),m(this,"_g",void 0),this._id=e,this._woodCompare=t,this.select=`#${this._woodCompare.baseFunction}-${this._id}`,this._setupMainDiv(),this._g=(0,r.Z)(this.select).select("g")}_setupMainDiv(){(0,r.Z)(`${this.select} div`).remove(),(0,r.Z)(this.select).append("div")}}class _ extends g{constructor(e,t,a){super(e,a),m(this,"_woodData",void 0),this._woodData=t,this._printText()}_getProperty(e,t){const a=this._woodData[t].properties.find((t=>t.modifier===e));let s=0,i=!1;return null!=a&&a.amount&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),a=this._getProperty(e,"trim");return{amount:t.amount+a.amount,isPercentage:a.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';t+="<tr>",t+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[o,n]of e.properties){if(t+=`<tr><td>${o}</td><td>${n.isPercentage?(0,d.T3)(n.amount/100):(0,d.$1)(n.amount)}`,t+='<span class="rate">',n.amount>0){var a,s;t+='<span class="bar neutral" style="width:50%;"></span>',t+=`<span class="bar pos diff" style="width:${n.amount/(null!==(a=null===(s=this._woodCompare.minMaxProperty.get(o))||void 0===s?void 0:s.max)&&void 0!==a?a:1)*50}%;"></span>`}else if(n.amount<0){var i,r;const e=n.amount/(null!==(i=null===(r=this._woodCompare.minMaxProperty.get(o))||void 0===r?void 0:r.min)&&void 0!==i?i:1)*50;t+=`<span class="bar neutral" style="width:${50-e}%;"></span>`,t+=`<span class="bar neg diff" style="width:${e}%;"></span>`}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}return t+="</tbody></table>",t}_printText(){const e={frame:this._woodData.frame.name,trim:this._woodData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getPropertySum(t);e.properties.set(t,{amount:a.amount,isPercentage:a.isPercentage})}l(`${this.select}`).find("div").append(this._getText(e))}}class f extends g{constructor(e,t,a,s){super(e,s),m(this,"_baseData",void 0),m(this,"_compareData",void 0),this._baseData=t,this._compareData=a,this._printTextComparison()}static _getDiff(e,t,a,s=1){const i=Number.parseFloat((e-t).toFixed(s));return`${a?(0,d.T3)(e/100,s):(0,d.$1)(e)} <span class="badge badge-white">${(0,d.LQ)(i)}</span>`}_getBaseProperty(e,t){const a=this._baseData[t].properties.find((t=>t.modifier===e));let s=0,i=!1;return null!=a&&a.amount&&({amount:s,isPercentage:i}=a),{amount:s,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),a=this._getBaseProperty(e,"trim");return{amount:t.amount+a.amount,isPercentage:a.isPercentage}}_getCompareProperty(e,t){const a=this._compareData[t].properties.find((t=>t.modifier===e));let s=0,i=!1;return null!=a&&a.amount&&(s=a.amount,i=a.isPercentage),{amount:s,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),a=this._getCompareProperty(e,"trim");return{amount:t.amount+a.amount,isPercentage:t.isPercentage&&a.isPercentage}}_getText(e){const t=50;let a=0,s=0,i=0,r="",o='<table class="table table-sm table-striped small wood mt-4"><thead>';o+='<tr><th scope="col">Property</th><th scope="col">Change</th></tr></thead><tbody>';for(const[b,D]of e.properties){var n,p,d,h;if(o+=`<tr><td>${b}</td><td>${f._getDiff(D.compare,D.base,D.isPercentage)}`,o+='<span class="rate">',D.compare>=0)D.base>=0?D.compare>D.base?(a=D.base,s=D.compare-D.base,r="pos"):(a=D.compare,s=D.base-D.compare,r="neg"):(a=0,s=D.compare,r="pos"),o+='<span class="bar neutral" style="width:50%;"></span>',o+=`<span class="bar pos diff" style="width:${a/(null!==(n=null===(p=this._woodCompare.minMaxProperty.get(b))||void 0===p?void 0:p.max)&&void 0!==n?n:1)*t}%;"></span>`,o+=`<span class="bar ${r}" style="width:${s/(null!==(d=null===(h=this._woodCompare.minMaxProperty.get(b))||void 0===h?void 0:h.max)&&void 0!==d?d:1)*t}%;"></span>`;else if(D.compare<0){var l,c,u,m,g,_;D.base<0?D.compare>=D.base?(a=D.compare,s=D.base-D.compare,i=-D.base,r="pos"):(a=D.base,s=D.compare-D.base,i=-D.compare,r="neg"):(a=0,s=D.compare,i=-D.compare,r="neg"),o+=`<span class="bar neutral" style="width:${t+i/(null!==(l=null===(c=this._woodCompare.minMaxProperty.get(b))||void 0===c?void 0:c.min)&&void 0!==l?l:1)*t}%;"></span>`,o+=`<span class="bar ${r}" style="width:${s/(null!==(u=null===(m=this._woodCompare.minMaxProperty.get(b))||void 0===m?void 0:m.min)&&void 0!==u?u:1)*t}%;"></span>`,o+=`<span class="bar neg diff" style="width:${a/(null!==(g=null===(_=this._woodCompare.minMaxProperty.get(b))||void 0===_?void 0:_.min)&&void 0!==g?g:1)*t}%;"></span>`}else o+='<span class="bar neutral"></span>';o+="</span></td></tr>"}return o+="</tbody></table>",o}_printTextComparison(){const e={frame:this._compareData.frame.name,trim:this._compareData.trim.name,properties:new Map};for(const t of this._woodCompare.propertyNames){const a=this._getBasePropertySum(t),s=this._getComparePropertySum(t);e.properties.set(t,{base:a.amount,compare:s.amount,isPercentage:a.isPercentage})}l(`${this.select}`).find("div").append(this._getText(e))}}class b{constructor(e){m(this,"baseFunction",void 0),m(this,"instances",{}),m(this,"minMaxProperty",new Map),m(this,"propertyNames",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_woodData",void 0),m(this,"_columnsCompare",void 0),m(this,"_defaultWoodId",{}),m(this,"_columns",void 0),m(this,"_frameSelectData",void 0),m(this,"_trimSelectData",void 0),m(this,"_options",{}),m(this,"_woodIdsSelected",{}),this.baseFunction=e,this._baseName="Compare woods",this._baseId=`${this.baseFunction}-compare`,this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,"wood"===this.baseFunction&&this._setupListener()}async woodInit(){await this._loadAndSetupData(),this._initData()}getWoodName(e,t){var a,s;return null!==(a=null===(s=this._woodData[e].find((e=>e.id===t)))||void 0===s?void 0:s.name)&&void 0!==a?a:""}_findWoodId(e,t){var a,s;return null!==(a=null===(s=this._woodData[e].find((e=>e.name===t)))||void 0===s?void 0:s.id)&&void 0!==a?a:0}_setupData(){this.propertyNames=new Set([].concat(c(this._woodData.frame.flatMap((e=>e.properties.map((e=>e.modifier))))),c(this._woodData.trim.flatMap((e=>e.properties.map((e=>e.modifier)))))).sort(h.I4)),"wood"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Fir"),trim:this._findWoodId("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this.baseFunction?(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=[]):(this._defaultWoodId={frame:this._findWoodId("frame","Oak"),trim:this._findWoodId("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base")}async _loadAndSetupData(){this._woodData=(await a.e(799).then(a.t.bind(a,7384,19))).default,this._setupData()}_setupListener(){var e;let t=!0;null===(e=document.querySelector(`#${this._buttonId}`))||void 0===e||e.addEventListener("click",(async()=>{t&&(t=!1,await this._loadAndSetupData()),(0,o.KS)("Tools",this._baseName),this._woodCompareSelected()}))}_woodCompareSelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),l(`#${this._modalId}`).modal("show")}_initData(){this._frameSelectData=this._woodData.frame.sort((0,h.MR)(["name"])),this._trimSelectData=this._woodData.trim.sort((0,h.MR)(["name"])),this._setOption(this._frameSelectData.map((e=>`<option value="${e.id}">${e.name}</option>`)).toString(),this._trimSelectData.map((e=>`<option value="${e.id}">${e.name}</option>`)).toString());for(const o of this.propertyNames){var e,t,a,r;const n=c(this._woodData.frame.map((e=>{var t,a;return null!==(t=null===(a=e.properties.find((e=>e.modifier===o)))||void 0===a?void 0:a.amount)&&void 0!==t?t:0}))),p=c(this._woodData.trim.map((e=>{var t,a;return null!==(t=null===(a=e.properties.find((e=>e.modifier===o)))||void 0===a?void 0:a.amount)&&void 0!==t?t:0}))),d=null!==(e=(0,s.Z)(n))&&void 0!==e?e:0,h=null!==(t=(0,i.Z)(n))&&void 0!==t?t:0,l=null!==(a=(0,s.Z)(p))&&void 0!==a?a:0,u=null!==(r=(0,i.Z)(p))&&void 0!==r?r:0;this._addMinMaxProperty(o,{min:d+l>=0?0:d+l,max:h+u})}}_injectModal(){(0,p.Eu)({id:this._modalId,title:this._baseName});const e=(0,r.Z)(`#${this._modalId} .modal-body`).append("div").attr("class","container-fluid").append("div").attr("class","row wood");for(const t of this._columns){const a=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));for(const e of n.Kf){const s=`${this.baseFunction}-${e}-${t}-select`;a.append("label").attr("for",s),a.append("select").attr("name",s).attr("id",s).attr("class","selectpicker")}a.append("div").attr("id",`${this.baseFunction}-${t}`)}}_initModal(){this._initData(),this._injectModal();for(const e of this._columns)for(const t of n.Kf){const a=l(`#${this.baseFunction}-${t}-${e}-select`);this._setupWoodSelects(e,t,a),this._setupSelectListener(e,t,a)}}_setWoodsSelected(e,t,a){this._woodIdsSelected[e]||(this._woodIdsSelected[e]={}),this._woodIdsSelected[e][t]=a}_setupWoodSelects(e,t,a){this._setWoodsSelected(e,t,this._defaultWoodId[t]),a.append(this._options[t]),("wood"!==this.baseFunction||"Base"!==e&&"wood"===this.baseFunction)&&a.attr("disabled","disabled")}_setOtherSelect(e,t){const a="frame"===t?"trim":"frame";this._woodIdsSelected[e][a]===this._defaultWoodId[a]&&l(`#${this.baseFunction}-${a}-${e}-select`).val(this._defaultWoodId[a]).selectpicker("refresh")}enableSelects(e){for(const t of n.Kf)l(`#${this.baseFunction}-${t}-${e}-select`).removeAttr("disabled").selectpicker("refresh")}_woodSelected(e,t,a){const s=Number(a.val());if(this._setWoodsSelected(e,t,s),this._setOtherSelect(e,t),"Base"===e){this._addInstance(e,new _("Base",this._getWoodData("Base"),this));for(const e of this._columnsCompare)"wood"===this.baseFunction&&this.enableSelects(e),this.instances[e]&&this._addInstance(e,new f(e,this._getWoodData("Base"),this._getWoodData(e),this))}else this._addInstance(e,new f(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,a){a.on("change",(()=>this._woodSelected(e,t,a))).selectpicker({title:`Select ${t}`})}_getWoodData(e){return{frame:this.getWoodTypeData("frame",this._woodIdsSelected[e].frame),trim:this.getWoodTypeData("trim",this._woodIdsSelected[e].trim)}}_addMinMaxProperty(e,t){this.minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this.instances[e]=t}getWoodTypeData(e,t){var a;return null!==(a=this._woodData[e].find((e=>e.id===t)))&&void 0!==a?a:{}}}},1198:function(e,t,a){a.d(t,{nD:function(){return d},Iy:function(){return h},tj:function(){return l},Fq:function(){return c},xp:function(){return u},$G:function(){return m},ec:function(){return g},Mo:function(){return _},vQ:function(){return f},A1:function(){return b},GZ:function(){return D},yb:function(){return v},PN:function(){return y}});var s=a(1138),i=a(9022),r=a(393),o=a(3609);function n(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}const d=(e,t=!1)=>{let a;return a=Number.isNaN(Number(e))?e:(0,r.tT)(Number(e)),`<${t?"tspan":"span"} class="caps">${a}</${t?"tspan":"span"}>`},h=(e,t=!1)=>{let a,s;return Number.isNaN(Number(e))?(a=e,s=(0,r.Ri)(a)%r.QF):(s=Number(e),a=(0,r.tT)(s)),`<${t?"tspan":"span"} class="caps">${a}</${t?"tspan":"span"}> (${s}°)`},l=e=>{const t=(0,r.tT)(o(`#${e}`).roundSlider("getValue"));let a;return a=Number.isNaN(Number(t))?(0,r.Ri)(t):Number(t),a},c=(e,t)=>{let a=Math.atan2(t.y-e.y,t.x-e.x);a-=Math.PI/2;let s=(0,r.vi)(a);return s<0&&(s+=r.QF),s},u=(e,t,a=!0)=>{if(t<2)return[e];const s=e.length,i=[];let r,o=0;if(s%t==0)for(r=Math.floor(s/t);o<s;)i.push(e.slice(o,o+=r));else if(a)for(;o<s;)r=Math.ceil((s-o)/t--),i.push(e.slice(o,o+=r));else{for(t-=1,r=Math.floor(s/t),s%r==0&&(r-=1);o<r*t;)i.push(e.slice(o,o+=r));i.push(e.slice(r*t))}return i},m=({element:e,radius:t})=>{const a=i.f7,o=r.QF/a,p=Math.round(.8*t),d=n(new Array(a)).map(((e,t)=>(0,r.tT)(t*o))),h=(0,s.Z)().range([0-o/2,r.QF-o/2]).domain(d).align(0);e.append("circle").attr("r",p).style("stroke-width","3px");const l=e.append("text"),c=e.selectAll("g").data(d).join((e=>e.append("g").attr("transform",(e=>{var t;return`rotate(${Math.round((null!==(t=h(e))&&void 0!==t?t:0)+h.bandwidth()/2-r.bT)})translate(${p},0)`}))));c.filter(((e,t)=>t%3!=0)).append("line").attr("x2",9),c.filter(((e,t)=>t%3==0)).append("text").attr("transform",(e=>{var t,a,s,i,r;let o,n=Math.round((null!==(t=h(e))&&void 0!==t?t:0)+h.bandwidth()/2);l.text(e);const p=null!==(a=null===(s=l.node())||void 0===s?void 0:s.getBBox().height)&&void 0!==a?a:0,d=null!==(i=null===(r=l.node())||void 0===r?void 0:r.getBBox().width)&&void 0!==i?i:0;return n>=0&&n<=45||315===n?(n=90,o="0,-"+p/2):90===n?(n=0,o=d/2+3+",0"):270===n?(n=180,o=`-${d/2+3},0`):(n=-90,o="0,"+(p/2+3+2)),`rotate(${n})translate(${o})`})).text((e=>e)),l.remove()},g=({element:e,radius:t})=>{const a=i.f7,o=r.QF/a,p=Math.round(.8*t),d=n(new Array(a)).map(((e,t)=>(0,r.tT)(t*o))),h=(0,s.Z)().range([0-o/2,r.QF-o/2]).domain(d).align(0);e.append("circle").attr("r",p).style("stroke-width","1.5px");e.selectAll("line").data(d).join((e=>e.append("line").attr("x2",((e,t)=>t%3==0?t%6==0?6:4:2)).attr("transform",(e=>{var t;return`rotate(${Math.round((null!==(t=h(e))&&void 0!==t?t:0)+h.bandwidth()/2)})translate(${p},0)`}))))},_=e=>`<span class="caps">${e}</span>`,f=(e,t)=>{navigator.clipboard||((e,t)=>{var a,s;if(null===(a=(s=document).queryCommandSupported)||void 0===a||!a.call(s,"copy"))return console.error(`Insufficient rights to copy ${e} to clipboard`),!1;{const a=document.createElement("input");a.type="text",a.value=e,a.style.position="absolute",a.style.left="-1000px",a.style.top="-1000px",t.append(a),a.select();try{document.execCommand("copy")}catch(e){return console.error("Copy to clipboard failed.",e),!1}finally{a.remove()}}})(e,t),(async e=>{navigator.clipboard.writeText(e).then((()=>!0)).catch((t=>(console.error(`Cannot copy ${e} to clipboard`,t),!1)))})(e)},b=(e,t,a)=>{if(Number.isFinite(e)&&Number.isFinite(t)){const s=new URL(window.location.href);s.searchParams.set("x",String(e)),s.searchParams.set("z",String(t)),f(s.href,a)}},D=(e,t,a)=>`M${e-a},${t}a${a},${a} 0 10${2*a},0a${a},${a} 0 10${2*-a},0`,v=(e,t,a)=>`M${e-a/2},${t-a/2}h${a}v${a}h${-a}z`,y=(e,t,a)=>`M${e},${t}v${a}`},7015:function(e,t,a){a.d(t,{$1:function(){return d},LQ:function(){return h},QM:function(){return l},Hu:function(){return c},yI:function(){return u},IH:function(){return m},nM:function(){return g},Dw:function(){return b},RK:function(){return D},Pj:function(){return v},T3:function(){return y},me:function(){return $},xp:function(){return S}});var s=a(3363),i=a(5619),r=a(6400);const o=i.Z.bind(r.h),n=(0,s.Z)({decimal:".",thousands:" ",grouping:[3],currency:[""," reales"],percent:" %",minus:"− "}),p=n.formatPrefix(",.0",1e3),d=(e,t=2)=>n.format(`,.${t}~r`)(e),h=(e,t=2)=>n.format(`+,.${t}~r`)(e).replace("+","+ "),l=(e,t=2)=>n.format(`.${t}f`)(e).replace(".00",'<span class="hidden">.00</span>').replace(/\.(\d)0/g,'.$1<span class="hidden">0</span>'),c=e=>p(-1*e).replace("k"," k"),u=e=>n.format(",d")(e),m=e=>n.format("+,d")(e).replace("+","+ "),g=(e,t=0)=>n.format(`,.${t}%`)(e).replace("%","pp"),_='<span class="caps">m</span>',f='<tspan class="caps">m</tspan>',b=(e,t=!1)=>n.format(",.2s")(e).replace(".0","").replace("k"," k").replace("m"," m").replace("M",` ${t?f:_}`),D=e=>{const t=b(e);return t.endsWith(_)?o`${t.replace(_,"")}<span class="caps">m</span>`:o`${t}`},v=(e,t=!1)=>n.format("$,.2s")(e).replace(".0","").replace("M",` ${t?f:_}`).replace("k"," k"),y=(e,t=1)=>n.format(`.${t}%`)(e).replace(".0",""),$=(e,t=1)=>n.format(`.${t}p`)(e),S=e=>n.format("+.1%")(e).replace(".0","").replace("+","＋ ")},5923:function(e,t,a){a.d(t,{ZT:function(){return l},q4:function(){return c},OI:function(){return u},i6:function(){return m},l9:function(){return g},C4:function(){return b},XI:function(){return D},PD:function(){return v},WP:function(){return $},td:function(){return S},Y8:function(){return C},eb:function(){return w},PK:function(){return I},IF:function(){return A},HL:function(){return P}});var s=a(6372),i=a(5837),r=a.n(i),o=a(5619),n=a(6400),p=a(9022),d=a(7015);const h=o.Z.bind(n.h),l=Number(.2),c=Number(300),u=Number(90),m=Number(.25),g=Number(300),_=Number(.25),f=Number(1),b=Number(_)/Number(f),D=5,v=new(r())("My salt: Yet another Naval Action map"),y=" (i)",$=e=>e.includes(y),S=e=>e.replace(y,""),C=e=>S(e)+($(e)?' <span class="caps small">imported</span>':""),w=({id:e,title:t,size:a="modal-xl",body:s,footer:i})=>h`
        <div id="${e}" class="modal" tabindex="-1" role="dialog" aria-labelledby="title-${e}" aria-hidden="true">
            <div class="modal-dialog ${a}" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 id="title-${e}" class="modal-title">${t}</h5>
                    </div>
                    <div class="modal-body">${s()}</div>
                    <div class="modal-footer">${i()}</div>
                </div>
            </div>
        </div>
    `,I=e=>`${(0,d.yI)(Number(e))} real${Number(e)>1?"es":""}`,A=e=>{var t,a;const{r:i,g:r,b:o}=(0,s.B8)(e);return(299*i+587*r+114*o)/1e3>=128?null!==(t=null===(a=(0,s.ZP)(p.L$))||void 0===a?void 0:a.darker(5).toString())&&void 0!==t?t:"#111":p.L$},P=e=>h`<span class="caps">${e}</span>`},4738:function(e,t,a){a.d(t,{I4:function(){return s},MR:function(){return i}});const s=(e,t)=>e&&t?e.localeCompare(t):0,i=e=>(t,a)=>{let s=0;return e.some((e=>{let i=1;return String(e).startsWith("-")&&(i=-1,e=String(e).slice(1)),s=Number.isNaN(Number(t[e]))&&Number.isNaN(Number(a[e]))?String(t[e]).localeCompare(String(a[e]))*i:(Number(t[e])-Number(a[e]))*i,0!==s})),s}},2157:function(e,t,a){a.d(t,{pe:function(){return s},Kf:function(){return i},qg:function(){return r},kK:function(){return o},nU:function(){return n},mP:function(){return p},xb:function(){return d},fm:function(){return h},$i:function(){return l}});const s=["regular","seasoned","exceptional"],i=["frame","trim"],r=["medium","long","carronade"],o={medium:["regular","congreve","defense","edinorog"],long:["regular","navy","blomefield"],carronade:["regular","obusiers"]},n=[{id:0,short:"NT",name:"Neutral",sortName:"Neutral"},{id:1,short:"PR",name:"Pirates",sortName:"Pirates"},{id:2,short:"ES",name:"España",sortName:"España"},{id:3,short:"FR",name:"France",sortName:"France"},{id:4,short:"GB",name:"Great Britain",sortName:"Great Britain"},{id:5,short:"VP",name:"Verenigde Provinciën",sortName:"Verenigde Provinciën"},{id:6,short:"DK",name:"Danmark-Norge",sortName:"Danmark-Norge"},{id:7,short:"SE",name:"Sverige",sortName:"Sverige"},{id:8,short:"US",name:"United States",sortName:"United States"},{id:9,short:"FT",name:"Free Town",sortName:"Free Town"},{id:10,short:"RU",name:"Russian Empire",sortName:"Russian Empire"},{id:11,short:"DE",name:"Kingdom of Prussia",sortName:"Prussia"},{id:12,short:"PL",name:"Commonwealth of Poland",sortName:"Poland"},{id:13,short:"CN",name:"China",sortName:"China"}],p=(new Map(n.map((e=>[e.id,e]))),new Map([["Arenas","Cayos del Golfo"],["Ays","Costa del Fuego"],["Baracoa","Baracoa"],["Basse-Terre","Basse-Terre"],["Belize","Belize"],["Black River","North Mosquito"],["Bluefields","South Mosquito"],["Brangman’s Bluff","Royal Mosquito"],["Bridgetown","Windward Isles"],["Calobelo","Portobelo"],["Campeche","Campeche"],["Cap-Français","Cap-Français"],["Caracas","Caracas"],["Cartagena de Indias","Cartagena"],["Castries","Sainte-Lucie"],["Caymans","George Town"],["Charleston","South Carolina"],["Christiansted","Vestindiske Øer"],["Cumaná","Cumaná"],["Fort-Royal","Martinique"],["Gasparilla","Costa de los Calos"],["George Town","Caymans"],["George’s Town","Exuma"],["Gibraltar","Lago de Maracaibo"],["Grand Turk","Turks and Caicos"],["Gustavia","Gustavia"],["Islamorada","Los Martires"],["Kidd’s Harbour","Kidd’s Island"],["Kingston / Port Royal","Surrey"],["La Bahía","Texas"],["La Habana","La Habana"],["Les Cayes","Les Cayes"],["Maracaibo","Golfo de Maracaibo"],["Marsh Harbour","Abaco"],["Matina","Costa Rica"],["Morgan’s Bluff","Andros"],["Mortimer Town","Inagua"],["Nassau","New Providence"],["Nouvelle-Orléans","Louisiane"],["Nuevitas","Nuevitas del Principe"],["Old Providence","Providencia"],["Omoa","Comayaqua"],["Oranjestad","Bovenwinds"],["Pampatar","Margarita"],["Pedro Cay","South Cays"],["Penzacola","Florida Occidental"],["Pinar del Río","Filipina"],["Pitt’s Town","Crooked"],["Pointe-à-Pitre","Grande-Terre"],["Ponce","Ponce"],["Port-au-Prince","Port-au-Prince"],["Portobelo","Portobelo"],["Puerto de España","Trinidad"],["Puerto Plata","La Vega"],["Remedios","Los Llanos"],["Roseau","Dominica"],["Saint George’s Town","Bermuda"],["Saint John’s","Leeward Islands"],["Salamanca","Bacalar"],["San Agustín","Timucua"],["San Juan","San Juan"],["San Marcos","Apalache"],["Santa Fe","Isla de Pinos"],["Santa Marta","Santa Marta"],["Santiago de Cuba","Ciudad de Cuba"],["Santo Domingo","Santo Domingo"],["Santo Tomé de Guayana","Orinoco"],["Savanna la Mar","Cornwall"],["Savannah","Georgia"],["Sisal","Mérida"],["Soto La Marina","Nuevo Santander"],["Spanish Town","Virgin Islands"],["Trinidad","Quatro Villas"],["Vera Cruz","Vera Cruz"],["West End","Grand Bahama"],["Willemstad","Benedenwinds"],["Wilmington","North Carolina"]]),e=>n.some((t=>t.short===e))),d=e=>0===Object.getOwnPropertyNames(e).length&&e.constructor===Object,h=e=>e.charAt(0).toUpperCase()+e.slice(1),l=e=>n.find((t=>t.short===e))},4332:function(e,t,a){a.d(t,{t:function(){return s},y:function(){return i}});const s=["loot","chests","items"],i=["crew","gunnery","hull","mast","sailing"]},3129:function(e){e.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 146.5 386.1'%3e%3cpath fill='%236a7153' d='M73.5 382.8l25 .1 25 .1c19.6-73.9 24.6-165.2 15.9-239.9S108.4 10.4 73.5 3H73C38.1 10.4 15.8 68.5 7.1 143.2S3.4 309.1 23 383l25-.1 25-.1'/%3e%3c/svg%3e"}}]);