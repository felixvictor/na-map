/*! For license information please see map.0ee47f01ec85e34842e3.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{142:function(t,e,i){i.r(e),function(t){i.d(e,"NAMap",(function(){return I}));i(24),i(144),i(147),i(154);var a=i(211),o=i(138),s=i(83),n=i(374),r=i(266),d=i(37),c=i(19),l=i(50),h=i(153),p=i(52),u=i(54),_=i(271),m=i(273),g=i(274),v=i(306),f=i(311),b=i(312),y=i(314),w=i(315),S=i(317),x=i(57);function j(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class I{constructor(t,e){j(this,"coord",void 0),j(this,"f11",void 0),j(this,"gridOverlay",void 0),j(this,"height",0),j(this,"minScale",0),j(this,"rem",void 0),j(this,"serverName",void 0),j(this,"showGrid",void 0),j(this,"showTrades",void 0),j(this,"width",0),j(this,"xGridBackgroundHeight",void 0),j(this,"yGridBackgroundWidth",void 0),j(this,"_currentScale",0),j(this,"_currentTranslate",void 0),j(this,"_doubleClickAction",void 0),j(this,"_gMap",void 0),j(this,"_grid",void 0),j(this,"_journey",void 0),j(this,"_pbZone",void 0),j(this,"_ports",void 0),j(this,"_portSelect",void 0),j(this,"_showGrid",void 0),j(this,"_svg",void 0),j(this,"_windPrediction",void 0),j(this,"_windRose",void 0),j(this,"_zoom",void 0),j(this,"_zoomLevel",void 0),j(this,"_doubleClickActionCookie",void 0),j(this,"_doubleClickActionId",void 0),j(this,"_doubleClickActionRadios",void 0),j(this,"_doubleClickActionValues",void 0),j(this,"_labelZoomThreshold",void 0),j(this,"_maxScale",void 0),j(this,"_PBZoneZoomThreshold",void 0),j(this,"_searchParams",void 0),j(this,"_showGridCookie",void 0),j(this,"_showGridId",void 0),j(this,"_showGridRadios",void 0),j(this,"_showGridValues",void 0),j(this,"_tileSize",void 0),j(this,"_wheelDelta",void 0),this.serverName=t,this._searchParams=e,this.rem=l.i,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:x.b},this._tileSize=256,this._maxScale=8,this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new p.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new u.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new p.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new u.a(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener()}static _initModal(t){Object(c.u)({id:t,title:"".concat(c.c,' <span class="text-primary small">v').concat(c.d,"</span>"),size:"modal-lg"});o.a("#".concat(t," .modal-body")).html("<p>".concat(c.a,' Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan Bastards ').concat(Object(h.d)("(BSTD)"),"</a>.</p>"))}static _stopProperty(){s.c.defaultPrevented&&s.c.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this.f11=new f.a(this,this.coord),this._ports=new g.a(this),await this._ports.init(),this._pbZone=new m.a(this._ports),this._grid=new _.a(this),this._journey=new w.a(this.rem),this._windPrediction=new S.a,this._windRose=new y.a,this._portSelect=new v.a(this._ports,this._pbZone,this),this.showTrades=new b.a(this.serverName,this._portSelect,this.minScale,[this.coord.min,this.coord.min],[this.width,this.height]),await this.showTrades.showOrHide(),this._init()}_setupListener(){var t,e,i,a,o,s,n;this._svg.on("dblclick.zoom",null).on("click",I._stopProperty,!0).on("dblclick",(t,e,i)=>this._doDoubleClickAction(i[e])),null===(t=document.querySelector("#propertyDropdown"))||void 0===t||t.addEventListener("click",()=>{Object(d.b)("Menu","Select port on property")}),null===(e=document.querySelector("#settingsDropdown"))||void 0===e||e.addEventListener("click",()=>{Object(d.b)("Menu","Settings")}),null===(i=document.querySelector("#button-download-pb-calc"))||void 0===i||i.addEventListener("click",()=>{Object(d.b)("Tools","Download pb calculator")}),null===(a=document.querySelector("#reset"))||void 0===a||a.addEventListener("click",()=>{this._clearMap()}),null===(o=document.querySelector("#about"))||void 0===o||o.addEventListener("click",()=>{this._showAbout()}),null===(s=document.querySelector("#double-click-action"))||void 0===s||s.addEventListener("change",()=>this._doubleClickSelected()),null===(n=document.querySelector("#show-grid"))||void 0===n||n.addEventListener("change",()=>this._showGridSelected())}_setupScale(){this.minScale=Object(l.q)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this.minScale}_setupSvg(){this._zoom=r.a().wheelDelta(()=>-this._wheelDelta*Math.sign(s.c.deltaY)).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this.minScale,this.coord.min-this.xGridBackgroundHeight*this.minScale],[this.coord.max,this.coord.max]]).scaleExtent([this.minScale,this._maxScale]).on("zoom",()=>this._naZoomed()),this._svg=o.a("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").classed("map",!0)}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._refreshLayer()}_refreshLayer(){this._grid.update()}_displayMap(t){const{x:e,y:i,k:o}=t,s=Math.log2(this._tileSize),n=Math.log2(this.coord.max)-s,d=this.coord.max*o,c=this.width,h=this.height,p=Math.floor(d<c?c-2*e:d),u=Math.floor(d<h?h-2*i:d),_=Math.log2(o),m=Math.min(n,Math.ceil(Math.log2(Math.max(p,u)))-s),g=Math.round(10*(m-_-n))/10,v=this._wheelDelta**g,f=this._tileSize*v,b=d<c?e:0,y=d<h?i:0,w=a.a(Math.max(0,Math.floor((0-e)/f)),Math.max(0,Math.min(Math.ceil((c-e-b)/f),2**m))),S=a.a(Math.max(0,Math.floor((0-i)/f)),Math.max(0,Math.min(Math.ceil((h-i-y)/f),2**m))),x=[];for(const t of S)for(const e of w)x.push({z:m,row:t,col:e,id:"".concat(m.toString(),"-").concat(t.toString(),"-").concat(e.toString())});const j=r.b.translate(e,i).scale(Object(l.s)(v));this._updateMap(x,j)}_updateMap(t,e){this._gMap.attr("transform",e.toString()).selectAll("image").data(t,t=>t.id).join(t=>t.append("image").attr("xlink:href",t=>"images/map/".concat(t.z,"/").concat(t.row,"/").concat(t.col,".webp")).attr("x",t=>t.col*this._tileSize).attr("y",t=>t.row*this._tileSize).attr("width",this._tileSize+1).attr("height",this._tileSize+1))}_clearMap(){this._windPrediction.clearMap(),this._windRose.clearMap(),this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){const e=t("#".concat("modal-about"));0===e.length&&I._initModal("modal-about"),e.modal("show")}_doDoubleClickAction(t){const e=n.a(t),i=r.c(t),[a,o]=e,{k:s,x:d,y:c}=i,l=(a-d)/s,h=(o-c)/s;"f11"===this._doubleClickAction?this.f11.printCoord(l,h):this._journey.plotCourse(l,h),this.zoomAndPan(l,h,1)}_setZoomLevelAndData(){s.c.transform.k!==this._currentScale&&(this._currentScale=s.c.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)}_getLowerBound(t){return t.invert([this.coord.min,this.coord.min])}_getUpperBound(t){return t.invert([this.width,this.height])}_getZoomTransform(){return this._currentTranslate={x:Math.floor(s.c.transform.x),y:Math.floor(s.c.transform.y)},r.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(l.s)(s.c.transform.k))}_naZoomed(){const t=this._getZoomTransform(),e=this._getLowerBound(t),i=this._getUpperBound(t);this._ports.setBounds(e,i),this._pbZone.setBounds(e,i),this.showTrades.setBounds(e,i),this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._journey.transform(t),this._pbZone.transform(t),this.f11.transform(t),this.showTrades.transform(t),this._setZoomLevelAndData()}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight()}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}resize(){const t=r.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update()}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight()}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){var t;const e=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);null===(t=document.querySelector("#summary-column"))||void 0===t||t.setAttribute("style","height:".concat(e,"px"))}initialZoomAndPan(){this._svg.call(this._zoom.scaleTo,this.minScale)}zoomAndPan(t,e,i){const a=r.b.scale(i).translate(Math.round(-t+this.width/2/i),Math.round(-e+this.height/2/i));this._svg.call(this._zoom.transform,a)}goToPort(){0===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)}}}.call(this,i(49))},271:function(t,e,i){i.d(e,"a",(function(){return h}));i(53),i(24);var a=i(234),o=i(138),s=i(83),n=i(158),r=i(50),d=i(146);function c(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function l(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}class h{constructor(t){p.set(this,{writable:!0,value:void 0}),u.set(this,{writable:!0,value:void 0}),_.set(this,{writable:!0,value:void 0}),m.set(this,{writable:!0,value:void 0}),g.set(this,{writable:!0,value:void 0}),v.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:void 0}),b.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),w.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),l(this,u,t),l(this,p,"on"===c(this,u).showGrid),l(this,_,c(this,u).coord.min),l(this,m,c(this,u).coord.max),l(this,g,c(this,u).height),l(this,v,c(this,u).width),l(this,f,c(this,u).rem),l(this,b,c(this,u).xGridBackgroundHeight),l(this,y,c(this,u).yGridBackgroundWidth),this._setupSvg()}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){l(this,w,Object(n.a)().clamp(!0).domain([Object(r.f)(c(this,_),c(this,_)),Object(r.f)(c(this,m),c(this,m))]).range([c(this,_),c(this,m)])),l(this,S,Object(n.a)().clamp(!0).domain([Object(r.g)(c(this,_),c(this,_)),Object(r.g)(c(this,m),c(this,m))]).range([c(this,_),c(this,m)]))}_setupAxis(){const t=this._getTicks(65);l(this,x,Object(a.a)(c(this,w)).tickFormat(t=>Object(d.a)(t)).tickValues(t).tickSize(c(this,m))),l(this,j,Object(a.c)(c(this,S)).tickFormat(t=>Object(d.a)(t)).tickValues(t).tickSize(c(this,m))),l(this,k,Object(o.a)("#na-svg")),l(this,D,c(this,k).insert("svg","g.pb").attr("class","axis d-none")),l(this,M,c(this,D).append("g")),l(this,C,c(this,k).insert("svg","g.pb").attr("class","axis d-none")),l(this,P,c(this,C).append("g")),this._displayAxis(),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round(Object(r.g)(c(this,_),c(this,_))),i=Math.round(Object(r.g)(c(this,m),c(this,m))),a=(i-e)/(t-1),o=[];for(let t=a;t<i;t+=a)o.push(Math.round(t));o.push(i);const s=o.slice(0).reverse().map(t=>-t);return s.push(0),s.concat(o)}_setupXAxis(){c(this,M).selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),c(this,M).attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){c(this,P).attr("text-anchor","end").attr("fill",null).attr("font-family",null),c(this,P).selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(){const t=s.c?s.c.transform.k:1,e=Object(r.s)(c(this,f)/t),i=Object(r.s)(1/t),a=s.c?s.c.transform.y:0,o=a/t<c(this,v)?a/t:0,n=-c(this,m)-o,d=s.c?s.c.transform.x:0,l=d/t<c(this,g)?d/t:0,h=-c(this,m)-l;c(this,M).attr("font-size",e).attr("stroke-width",i).call(c(this,x).tickPadding(n)),c(this,P).attr("font-size",e).attr("stroke-width",i).call(c(this,j).tickPadding(h))}get show(){return c(this,p)}set show(t){l(this,p,t)}get zoomLevel(){return c(this,I)}set zoomLevel(t){l(this,I,t)}update(){let t=!1;c(this,p)&&"initial"!==this.zoomLevel&&(t=!0),c(this,u).gridOverlay.classList.toggle("overlay-grid",t),c(this,u).gridOverlay.classList.toggle("overlay-no-grid",!t),c(this,D).classed("d-none",!t),c(this,C).classed("d-none",!t)}transform(t){c(this,M).attr("transform",t.toString()),c(this,P).attr("transform",t.toString()),this._displayAxis()}}var p=new WeakMap,u=new WeakMap,_=new WeakMap,m=new WeakMap,g=new WeakMap,v=new WeakMap,f=new WeakMap,b=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,x=new WeakMap,j=new WeakMap,I=new WeakMap,k=new WeakMap,D=new WeakMap,C=new WeakMap,M=new WeakMap,P=new WeakMap},273:function(t,e,i){i.d(e,"a",(function(){return c}));var a=i(138),o=i(38),s=i(153),n=i(52),r=i(54);function d(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class c{constructor(t){d(this,"showPB",void 0),d(this,"_ports",void 0),d(this,"_showId",void 0),d(this,"_showValues",void 0),d(this,"_showCookie",void 0),d(this,"_showRadios",void 0),d(this,"_isDataLoaded",void 0),d(this,"_pbZonesDefault",void 0),d(this,"_lowerBound",void 0),d(this,"_upperBound",void 0),d(this,"_defencesFiltered",void 0),d(this,"_pbZonesFiltered",void 0),d(this,"_g",void 0),this._ports=t,this._showId="show-zones",this._showValues=["pb-all","pb-single","off"],this._showCookie=new n.a({id:this._showId,values:this._showValues}),this._showRadios=new r.a(this._showId,this._showValues),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(a.a)("#na-svg").insert("g","#ports").attr("class","pb")}async _loadData(){try{this._pbZonesDefault=(await i.e(9).then(i.t.bind(null,358,3))).default}catch(t){Object(o.e)(t)}}_setupListener(){var t;null===(t=document.querySelector("#".concat(this._showId)))||void 0===t||t.addEventListener("change",t=>{this._showPBZonesSelected(),t.preventDefault()})}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","pb-zones");return e.append("path").attr("class","pb-join-circle").attr("d",t=>Object(s.g)(t.joinCircle[0],t.joinCircle[1],28).concat(Object(s.g)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","pb-circle").attr("d",t=>t.pbCircles.map(t=>Object(s.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text pb-circle-text").attr("x",t=>t.pbCircles.map(t=>t[0]).join(",")).attr("y",t=>t.pbCircles.map(t=>t[1]).join(",")).text(t=>t.pbCircles.map((t,e)=>String.fromCharCode(65+e)).join("")),e.append("path").attr("class","raid-point").attr("d",t=>t.spawnPoints.map(t=>Object(s.g)(t[0],t[1],3.5)).join("")),e.append("text").attr("class","pb-text raid-point-text").attr("x",t=>t.spawnPoints.map(t=>t[0]).join(",")).attr("y",t=>t.spawnPoints.map(t=>t[1]).join(",")).text(t=>t.spawnPoints.map((t,e)=>String.fromCharCode(88+e)).join("")),e}),this._g.selectAll("g.defence").data(this._defencesFiltered,t=>String(t.id)).join(t=>{const e=t.append("g").attr("class","defence");return e.append("path").attr("class","fort").attr("d",t=>t.forts.map(t=>Object(s.i)(t[0],t[1],3)).join("")),e.append("text").attr("class","pb-text pb-fort-text").attr("x",t=>t.forts.map(t=>t[0]).join(",")).attr("y",t=>t.forts.map(t=>t[1]).join(",")).text(t=>t.forts.map((t,e)=>"".concat(e+1)).join("")),e.append("path").attr("class","tower").attr("d",t=>t.towers.map(t=>Object(s.g)(t[0],t[1],1.5)).join("")),e.append("text").attr("class","pb-text pb-tower-text").attr("x",t=>t.towers.map(t=>t[0]).join(",")).attr("y",t=>t.towers.map(t=>t[1]).join(",")).text(t=>t.towers.map((t,e)=>"".concat(e+1)).join("")),e})}_isPortIn(t){return"pb-all"===this.showPB||"pb-single"===this.showPB&&Number(t.id)===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?this._isDataLoaded?this._filterVisible():this._loadData().then(()=>{this._isDataLoaded=!0,this._filterVisible()}):(this._defencesFiltered=[],this._pbZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter(t=>t.position[0]>=this._lowerBound[0]&&t.position[0]<=this._upperBound[0]&&t.position[1]>=this._lowerBound[1]&&t.position[1]<=this._upperBound[1]).filter(t=>this._isPortIn(t));this._defencesFiltered=t.map(t=>({id:t.id,forts:t.forts,towers:t.towers})),"pb-all"===this.showPB||"pb-single"===this.showPB?this._pbZonesFiltered=t.map(t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints})):this._pbZonesFiltered=[]}setBounds(t,e){this._lowerBound=t,this._upperBound=e}refresh(){this._setData(),this._update()}transform(t){this._g.attr("transform",t.toString())}}},274:function(t,e,i){(function(t){i.d(e,"a",(function(){return lt}));i(51),i(89),i(90),i(91),i(92),i(93),i(94),i(95),i(96),i(97),i(98),i(99),i(100),i(101),i(24),i(144),i(194);var a=i(196),o=i(215),s=i(246),n=i(392),r=i(158),d=i(192),c=i(138),l=i(20),h=i(165),p=i.n(h),u=(i(195),i(170)),_=i.n(u),m=i(275),g=i.n(m),v=i(171),f=i.n(v),b=i(38),y=i(19),w=i(146),S=i(50),x=i(52),j=i(54),I=i(276),k=i(151);function D(){const t=dt([""]);return D=function(){return t},t}function C(){const t=dt([""]);return C=function(){return t},t}function M(){const t=dt(['<p class="mb-2">\n                            <span class="caps">Buy in ',"</span> (net profit) ―\n                            ","\n                        </p>"]);return M=function(){return t},t}function P(){const t=dt([""]);return P=function(){return t},t}function T(){const t=dt(['<p class="mb-2">\n                            <span class="caps">Sell in ',"</span> (net profit) ―\n                            ","\n                        </p>"]);return T=function(){return t},t}function O(){const t=dt(["","\n                  ",""]);return O=function(){return t},t}function N(){const t=dt([""]);return N=function(){return t},t}function z(){const t=dt(['<p class="mb-2">\n                      <span class="caps">Consumes</span>\n                      ― ',"\n                  </p>"]);return z=function(){return t},t}function L(){const t=dt([""]);return L=function(){return t},t}function E(){const t=dt([""]);return E=function(){return t},t}function B(){const t=dt(['<span class="non-trading">',"</span>"]);return B=function(){return t},t}function A(){const t=dt(['<p class="mb-2">\n                      <span class="caps">Drops</span>\n                      ―\n                      ',"\n                      ","\n                  </p> "]);return A=function(){return t},t}function R(){const t=dt([""]);return R=function(){return t},t}function H(){const t=dt(['<p class="mb-2">\n                      <span class="caps">Produces</span>\n                      ―\n                      <span class="non-trading">',"</span>\n                  </p>"]);return H=function(){return t},t}function F(){const t=dt(['\n                          <div class="mr-3">\n                              ','<br />\n                              <span class="des">Battle timer</span>\n                          </div>\n                          <div class="mr-3">\n                              ','<br />\n                              <span class="des">Rating</span>\n                          </div>\n                          <div class="mr-3">\n                              ','<br />\n                              <span class="des">Capturer</span>\n                          </div>\n                          <div class="mr-5">\n                              ','<br />\n                              <span class="des">Capture</span>\n                          </div>\n\n                          <div class="ml-auto mr-3">\n                              '," (",')<br />\n                              <span class="des">Tax income</span>\n                          </div>\n                          <div>\n                              ','<br />\n                              <span class="des">Net income</span>\n                          </div>\n                      ']);return F=function(){return t},t}function W(){const t=dt(["<div>",'<br /><span class="des">Tax rate</span></div>']);return W=function(){return t},t}function G(){const t=dt([""]);return G=function(){return t},t}function q(){const t=dt(['<div class="alert alert-danger mt-2" role="alert">',"</div>"]);return q=function(){return t},t}function V(){const t=dt(['<i class="icon icon-light icon-deep" aria-hidden="true"></i\n                              ><span class="sr-only">Deep</span>']);return V=function(){return t},t}function Z(){const t=dt(['<i class="icon icon-light icon-shallow" aria-hidden="true"></i\n                              ><span class="sr-only">Shallow</span>']);return Z=function(){return t},t}function J(){const t=dt([""]);return J=function(){return t},t}function U(){const t=dt(['<i class="icon icon-light icon-trading mr-1" aria-hidden="true"></i\n                              ><span class="sr-only">Trading company level ',"</span>"]);return U=function(){return t},t}function X(){const t=dt([""]);return X=function(){return t},t}function Y(){const t=dt(['<i class="icon icon-light icon-labour" aria-hidden="true"></i\n                              ><span class="sr-only">Labour hour discount level ',"</span>"]);return Y=function(){return t},t}function $(){const t=dt([""]);return $=function(){return t},t}function Q(){const t=dt(['<i class="icon icon-light icon-open" aria-hidden="true"></i\n                              ><span class="sr-only">Accessible to all</span>']);return Q=function(){return t},t}function K(){const t=dt(['\n            <div class="d-flex align-items-center mb-4">\n                <img\n                    alt="','"\n                    class="flag-icon mr-3 align-self-stretch ','"\n                    src="','"\n                />\n\n                <div class="text-left">\n                    <div class="large">','</div>\n                    <div class="caps">','</div>\n                </div>\n\n                <div class="ml-auto inline-block">\n                    <span class="x-large text-lighter align-top mr-2">',"</span>\n                    ","\n                    ","\n                    ","\n                    ","\n                </div>\n            </div>\n\n            ",'\n\n            <div class="d-flex text-left mb-2">\n                ',"\n            </div>\n\n            ","\n            ","\n            ","\n            ","\n        "]);return K=function(){return t},t}function tt(){const t=dt([""]);return tt=function(){return t},t}function et(){const t=dt([""]);return et=function(){return t},t}function it(){const t=dt(["",""]);return it=function(){return t},t}function at(){const t=dt(["s: "," hostility"]);return at=function(){return t},t}function ot(){const t=dt([""," "," at ","",""]);return ot=function(){return t},t}function st(){const t=dt(["","\n        (",")\n        attack",""]);return st=function(){return t},t}function nt(){const t=dt([""," (",")"]);return nt=function(){return t},t}function rt(){const t=dt(['<span class="caps">',"</span>"]);return rt=function(){return t},t}function dt(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function ct(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}p.a.extend(_.a),p.a.extend(g.a),p.a.extend(f.a);class lt{constructor(t){this.map=t,ct(this,"circleType",""),ct(this,"currentPort",void 0),ct(this,"portData",void 0),ct(this,"portDataDefault",void 0),ct(this,"showCurrentGood",void 0),ct(this,"showRadius",void 0),ct(this,"showTradePortPartners",void 0),ct(this,"tradeItem",void 0),ct(this,"tradePortId",void 0),ct(this,"zoomLevel",void 0),ct(this,"_attackRadius",void 0),ct(this,"_colourScaleCounty",void 0),ct(this,"_colourScaleHostility",void 0),ct(this,"_colourScaleNet",void 0),ct(this,"_colourScalePoints",void 0),ct(this,"_colourScaleTax",void 0),ct(this,"_countyPolygon",void 0),ct(this,"_countyPolygonFiltered",void 0),ct(this,"_divPortSummary",void 0),ct(this,"_gCounty",void 0),ct(this,"_gIcon",void 0),ct(this,"_gPort",void 0),ct(this,"_gPortCircle",void 0),ct(this,"_gRegion",void 0),ct(this,"_gText",void 0),ct(this,"_lowerBound",void 0),ct(this,"_maxNetIncome",void 0),ct(this,"_maxPortPoints",void 0),ct(this,"_maxTaxIncome",void 0),ct(this,"_minNetIncome",void 0),ct(this,"_minPortPoints",void 0),ct(this,"_minTaxIncome",void 0),ct(this,"_nationIcons",void 0),ct(this,"_portDataFiltered",void 0),ct(this,"_portRadius",void 0),ct(this,"_portSummaryNetIncome",void 0),ct(this,"_portSummaryNumPorts",void 0),ct(this,"_portSummaryTaxIncome",void 0),ct(this,"_portSummaryTextNetIncome",void 0),ct(this,"_portSummaryTextNumPorts",void 0),ct(this,"_portSummaryTextTaxIncome",void 0),ct(this,"_regionPolygon",void 0),ct(this,"_regionPolygonFiltered",void 0),ct(this,"_scale",void 0),ct(this,"_upperBound",void 0),ct(this,"_baseId",void 0),ct(this,"_circleSize",void 0),ct(this,"_cookie",void 0),ct(this,"_f11",void 0),ct(this,"_fontSize",void 0),ct(this,"_iconSize",void 0),ct(this,"_maxRadiusFactor",void 0),ct(this,"_minRadiusFactor",void 0),ct(this,"_minScale",void 0),ct(this,"_radioButtonValues",void 0),ct(this,"_radios",void 0),ct(this,"_serverName",void 0),ct(this,"_showPBZones",void 0),ct(this,"_tooltipDuration",void 0),ct(this,"_trilateratePosition",void 0),this._serverName=this.map.serverName,this._minScale=this.map.minScale,this._scale=this._minScale,this._f11=this.map.f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this.currentPort={id:366,coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=S.i,this._circleSize=S.h,this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","county","points","position","tax","net","off"],this._cookie=new x.a({id:this._baseId,values:this._radioButtonValues}),this._radios=new j.a(this._baseId,this._radioButtonValues),this.showRadius=this._getShowRadiusSetting(),this._trilateratePosition=new I.a(this)}static _importAll(t){const e={};return t.keys().forEach(i=>{e[i.replace("./","").replace(".svg","")]=t(i)}),e}static _getInventory(t){let e="";const i=t.inventory.filter(t=>t.buyQuantity>0).map(t=>"".concat(Object(w.d)(t.buyQuantity)," ").concat(t.name," @ ").concat(Object(w.h)(t.buyPrice))).join("<br>"),a=t.inventory.filter(t=>t.sellQuantity>0).map(t=>"".concat(Object(w.d)(t.sellQuantity)," ").concat(t.name," @ ").concat(Object(w.h)(t.sellPrice))).join("<br>");return e+='<h5 class="caps">'.concat(t.name,' <span class="small">').concat(t.nation,"</span></h5>"),i.length>0&&(e+="<h6>Buy</h6>",e+=i),i.length>0&&a.length>0&&(e+="<p></p>"),a.length>0&&(e+="<h6>Sell</h6>",e+=a),e}static _hideDetails(e,i,a){t(Object(c.a)(a[i]).node()).tooltip("dispose")}async init(){await this._loadAndSetupData()}_setupData(t){const e=["dropsTrading","consumesTrading","producesNonTrading","dropsNonTrading"],i=t.ports.map(i=>{const a=t.server.find(t=>t.id===i.id),o=t.pb.find(t=>t.id===i.id),s={...i,...a,...o};for(const t of e)s[t]||delete s[t];return s});this.portDataDefault=i,this.portData=i,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:"".concat(this._serverName,"-ports.json"),name:"server"},{fileName:"".concat(this._serverName,"-pb.json"),name:"pb"}],e={};try{e.ports=(await i.e(10).then(i.t.bind(null,262,3))).default;const a=await(await fetch("".concat("data","/").concat(this.map.serverName,"-items.json"))).json();this.tradeItem=new Map(a.map(t=>[t.id,t])),await(async t=>{for await(const i of t)e[i.name]=await(await fetch("".concat("data","/").concat(i.fileName))).json()})(t)}catch(t){Object(b.e)(t)}return e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){var t,e,i,s,c,l;this._portRadius=Object(r.a)(),this._attackRadius=Object(r.a)().domain([0,1]),this._colourScaleHostility=Object(r.a)().domain([0,1]).range([y.k,y.j]).interpolate(n.a),this._colourScaleCounty=Object(d.a)().range(y.h),this._minTaxIncome=null!==(t=Object(a.a)(this.portData,t=>t.taxIncome))&&void 0!==t?t:0,this._maxTaxIncome=null!==(e=Object(o.a)(this.portData,t=>t.taxIncome))&&void 0!==e?e:0,this._colourScaleTax=Object(r.a)().domain([this._minTaxIncome,this._maxTaxIncome]).range([y.k,y.g]).interpolate(n.a),this._minNetIncome=null!==(i=Object(a.a)(this.portData,t=>t.netIncome))&&void 0!==i?i:0,this._maxNetIncome=null!==(s=Object(o.a)(this.portData,t=>t.netIncome))&&void 0!==s?s:0,this._colourScaleNet=Object(r.a)().domain([this._minNetIncome,0,this._maxNetIncome]).range([y.j,y.k,y.g]).interpolate(n.a),this._minPortPoints=null!==(c=Object(a.a)(this.portData,t=>t.portPoints))&&void 0!==c?c:0,this._maxPortPoints=null!==(l=Object(o.a)(this.portData,t=>t.portPoints))&&void 0!==l?l:0,this._colourScalePoints=Object(r.a)().domain([this._minPortPoints,this._maxPortPoints]).range([y.k,y.g]).interpolate(n.a)}_setupListener(){var t;null===(t=document.querySelector("#show-radius"))||void 0===t||t.addEventListener("change",()=>this._showRadiusSelected())}_getShowRadiusSetting(){let t=this._cookie.get();return"position"===t&&([t]=this._radioButtonValues,this._cookie.set(t)),this._radios.set(t),t}_showRadiusSelected(){this.showRadius=this._radios.get(),this._cookie.set(this.showRadius),this.update()}_setupSvg(){this._gPort=Object(c.a)("#na-svg").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"),this._gRegion=this._gPort.append("g").attr("class","region"),this._gCounty=this._gPort.append("g").attr("class","county"),this._gPortCircle=this._gPort.append("g").attr("data-ui-component","port-circles"),this._gIcon=this._gPort.append("g").attr("class","port"),this._gText=this._gPort.append("g").attr("class","port-names")}_setupCounties(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}];const t={x:this.map.coord.max/2,y:this.map.coord.max/2};this._countyPolygon=this._countyPolygon.sort((e,i)=>{const a={x:e.centroid[0],y:e.centroid[1]},o={x:i.centroid[0],y:i.centroid[1]};return Object(S.n)(t,a)-Object(S.n)(t,o)}),this._colourScaleCounty.domain(this._countyPolygon.map(t=>t.name))}_setupRegions(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]}_setupSummary(){this._divPortSummary=Object(c.a)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind"),this._portSummaryNumPorts=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").attr("class","summary-des").html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").attr("class","summary-des").html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").attr("class","summary-des").html("net<br>income")}_setupFlags(){this._nationIcons=lt._importAll(i(279));const t=Object(c.a)("#na-svg defs");b.d.map(t=>t.short).forEach(e=>{if(t.append("pattern").attr("id",e).attr("width","133%").attr("height","100%").attr("viewBox","6 6 ".concat(this._iconSize," ").concat(.75*this._iconSize)).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e].replace('"',"").replace('"',"")),"FT"!==e){const i=t.append("pattern").attr("id","".concat(e,"c")).attr("width","133%").attr("height","100%").attr("viewBox","6 6 ".concat(this._iconSize," ").concat(.75*this._iconSize));i.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons[e].replace('"',"").replace('"',"")),i.append("circle").attr("cx",this._iconSize/2).attr("cy",this._iconSize/2).attr("r",16)}if("NT"!==e&&"FT"!==e){t.append("pattern").attr("id","".concat(e,"a")).attr("width","133%").attr("height","100%").attr("viewBox","6 6 ".concat(this._iconSize," ").concat(.75*this._iconSize)).append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons["".concat(e,"a")].replace('"',"").replace('"',""));const i=t.append("pattern").attr("id","".concat(e,"ca")).attr("width","133%").attr("height","100%").attr("viewBox","6 6 ".concat(this._iconSize," ").concat(.75*this._iconSize));i.append("image").attr("height",this._iconSize).attr("width",this._iconSize).attr("href",this._nationIcons["".concat(e,"a")].replace('"',"").replace('"',"")),i.append("circle").attr("cx",this._iconSize/2).attr("cy",this._iconSize/2).attr("r",16)}})}_getPortName(t){var e,i;return t&&null!==(e=null===(i=this.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}_getText(t){var e,i,a,o,s,n,r,d,c,h,u,_;const m=t=>Object(l.d)(rt(),t),g=(t,e)=>"".concat(String(t)," ‒ ").concat(String(e)),v=(t,e)=>{const i=Number(p.a.utc().hour(t).local().format("H")),a=Number(p.a.utc().hour(e).local().format("H"));return Object(l.d)(nt(),g(t,e),g(i,a))},f=(t,e)=>e.profit.profit-t.profit.profit,y=p.a.utc(t.portBattle).local(),S=p.a.utc(t.portBattle),x=S===y?"":" (".concat(y.format("H.mm")," local)"),j=t.portBattleStartTime?v((t.portBattleStartTime+10)%24,(t.portBattleStartTime+13)%24):v(11,8),I=S.isAfter(p.a.utc())?"s":"ed",D=Object(l.d)(st(),m(t.attackerClan),t.attackerNation,t.portBattle.length>0?Object(l.d)(ot(),I,S.fromNow(),S.format("H.mm"),x):Object(l.d)(at(),Object(w.g)(t.attackHostility))),C={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:(""===t.county?"":"".concat(t.county," / "))+t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?Object(l.d)(it(),m(t.capturer)):Object(l.d)(et()),captureTime:t.capturer?"".concat(Object(b.b)(p.a.utc(t.lastPortBattle).fromNow())):"",attack:t.attackHostility?D:Object(l.d)(tt()),pbTimeRange:t.capturable?j:"",brLimit:Object(w.d)(t.brLimit),portPoints:Object(w.d)(t.portPoints),taxIncome:Object(w.i)(t.taxIncome),portTax:Object(w.g)(t.portTax),netIncome:Object(w.i)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:null!==(e=null===(i=t.dropsTrading)||void 0===i?void 0:i.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==e?e:"",consumesTrading:null!==(a=null===(o=t.consumesTrading)||void 0===o?void 0:o.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==a?a:"",producesNonTrading:null!==(s=null===(n=t.producesNonTrading)||void 0===n?void 0:n.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==s?s:"",dropsNonTrading:null!==(r=null===(d=t.dropsNonTrading)||void 0===d?void 0:d.map(t=>{var e,i;return null!==(e=null===(i=this.tradeItem.get(t))||void 0===i?void 0:i.name)&&void 0!==e?e:""}).sort(k.a).join(", "))&&void 0!==r?r:"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:null===(c=t.goodsToSellInTradePort)||void 0===c||null===(h=c.sort(f))||void 0===h?void 0:h.map(t=>"".concat(t.name," (").concat(Object(w.i)(t.profit.profit),")")).join(", "),goodsToBuyInTradePort:null===(u=t.goodsToBuyInTradePort)||void 0===u||null===(_=u.sort(f))||void 0===_?void 0:_.map(t=>"".concat(t.name," (").concat(Object(w.i)(t.profit.profit),")")).join(", ")};return C.dropsTrading.length>0&&C.dropsNonTrading.length>0&&(C.dropsNonTrading+=" ― "),C}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return Object(l.d)(K(),t.icon,e,this._nationIcons[t.icon].replace('"',"").replace('"',""),t.name,t.county,t.portPoints,t.availableForAll?Object(l.d)(Q()):Object(l.d)($()),t.laborHoursDiscount?Object(l.d)(Y(),t.laborHoursDiscount):Object(l.d)(X()),t.tradingCompany?Object(l.d)(U(),t.tradingCompany):Object(l.d)(J()),t.shallow?Object(l.d)(Z()):Object(l.d)(V()),t.attack.values.length>0?Object(l.d)(q(),t.attack):Object(l.d)(G()),t.capital?Object(l.d)(W(),t.portTax):Object(l.d)(F(),t.pbTimeRange,t.brLimit,t.capturer,t.captureTime,t.taxIncome,t.portTax,t.netIncome),t.producesNonTrading.length>0?Object(l.d)(H(),t.producesNonTrading):Object(l.d)(R()),t.dropsTrading.length>0||t.dropsNonTrading.length>0?Object(l.d)(A(),t.dropsNonTrading?Object(l.d)(B(),t.dropsNonTrading):Object(l.d)(E()),t.dropsTrading):Object(l.d)(L()),t.consumesTrading.length>0?Object(l.d)(z(),t.consumesTrading):Object(l.d)(N()),"tradePorts"===this.showRadius?Object(l.d)(O(),t.goodsToSellInTradePort.length>0?Object(l.d)(T(),t.tradePort,t.goodsToSellInTradePort):Object(l.d)(P()),t.goodsToBuyInTradePort.length>0?Object(l.d)(M(),t.tradePort,t.goodsToBuyInTradePort):Object(l.d)(C())):Object(l.d)(D()))}_showDetails(e,i,a){const o=t(Object(c.a)(a[i]).node()).tooltip({html:!0,placement:"auto",trigger:"manual",title:"Wait...",sanitize:!1});o.on("inserted.bs.tooltip",()=>{const i=t(document.body).find(".tooltip").find(".tooltip-inner")[0];Object(l.f)(this._tooltipData(this._getText(e)),i),o.tooltip("update")}),o.tooltip("show"),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(lt._getInventory(e)))}_updateIcons(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(S.s)(this._circleSize/t),i=this._portDataFiltered;this._gIcon.selectAll("circle").data(i,t=>String(t.id)).join(t=>t.append("circle").attr("fill",t=>{const e="".concat(t.countyCapital&&t.capturable?"c":"").concat(t.availableForAll&&"NT"!==t.nation?"a":"");return"url(#".concat(t.nation).concat(e,")")}).attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1]).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",lt._hideDetails)).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(S.s)(this._circleSize/t*this._minRadiusFactor),i=Object(S.s)(this._circleSize/t*this._maxRadiusFactor);let a=this._portDataFiltered,o=()=>"",s=()=>0,n=()=>"";"tax"===this.showRadius?(a=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minTaxIncome,this._maxTaxIncome]).range([e,i]),o=()=>"bubble",n=t=>this._colourScaleTax(t.taxIncome),s=t=>this._portRadius(t.taxIncome)):"net"===this.showRadius?(a=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minNetIncome,this._maxNetIncome]).range([e,i]),o=()=>"bubble",n=t=>this._colourScaleNet(t.netIncome),s=t=>this._portRadius(Math.abs(t.netIncome))):"points"===this.showRadius?(a=this._portDataFiltered.filter(t=>t.capturable),this._portRadius.domain([this._minPortPoints,this._maxPortPoints]).range([e,i/2]),o=()=>"bubble",n=t=>this._colourScalePoints(t.portPoints),s=t=>this._portRadius(t.portPoints)):"position"===this.showRadius?(o=()=>"bubble here",s=t=>t.distance):"attack"===this.showRadius?(a=this._portDataFiltered.filter(t=>t.attackHostility),this._attackRadius.range([e,i/1.5]),o=()=>"bubble",n=t=>"Neutral"===t.attackerNation?y.i:this._colourScaleHostility(t.attackHostility),s=t=>this._attackRadius(t.attackHostility)):"currentGood"===this.circleType?(o=t=>"bubble ".concat(t.isSource?"pos":"neg"),s=()=>i/2):"county"===this.showRadius?(o=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",n=t=>t.capturable?this._colourScaleCounty(t.county):"",s=t=>t.capturable?i/2:i/3):"tradePorts"===this.showRadius?(o=t=>"bubble ".concat(this._getTradePortMarker(t)),s=t=>t.id===this.tradePortId?i:i/2):"frontline"===this.showRadius?(o=t=>"bubble ".concat(this._getFrontlineMarker(t)),s=t=>t.ownPort?i/3:i/2,a=a.filter(t=>{var e;return null!==(e=t.enemyPort)&&void 0!==e?e:t.ownPort})):"currentGood"===this.showRadius?(o=t=>"bubble ".concat(t.isSource?"pos":"neg"),s=()=>i/2):"off"===this.showRadius&&(a=[]),this._gPortCircle.selectAll("circle").data(a,t=>String(t.id)).join(t=>t.append("circle").attr("cx",t=>t.coordinates[0]).attr("cy",t=>t.coordinates[1])).attr("class",t=>o(t)).attr("r",t=>s(t)).attr("fill",t=>n(t))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(S.m)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const a=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+a;const o=t.angle>90&&t.angle<270?i:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(S.m)(t.angle)))+o:t.coordinates[1]+a}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.textAnchor:"middle"}updateTexts(){if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{const t=2**Math.log2(Math.abs(this._minScale)+this._scale),e=Object(S.s)(this._circleSize/t),i=2**Math.log2(.9*(Math.abs(this._minScale)+this._scale)),a=Object(S.s)(this._fontSize/i),o=this._portDataFiltered;this._gText.selectAll("text").data(o,t=>String(t.id)).join(t=>t.append("text").text(t=>t.name)).attr("x",t=>this._updateTextsX(t,e)).attr("y",t=>this._updateTextsY(t,e,a)).attr("text-anchor",t=>this._updateTextsAnchor(t)),this._gText.attr("font-size","".concat(a,"px")).classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this.portData).length;let e=0,i=0;t&&(e=Object(s.a)(this.portData,t=>t.taxIncome),i=Object(s.a)(this.portData,t=>t.netIncome)),this._portSummaryTextNumPorts.text("".concat(t)),this._portSummaryTextTaxIncome.text("".concat(Object(w.i)(e))),this._portSummaryTextNetIncome.text("".concat(Object(w.i)(i)))}_updateCounties(){if("portLabel"===this.zoomLevel){const t=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>"translate(".concat(t.centroid[0],",").concat(t.centroid[1],")rotate(").concat(t.angle,")")).text(t=>t.name),t=>t.attr("fill",t=>"county"===this.showRadius?this._colourScaleCounty(t.name):"")),this._gCounty.classed("d-none",!1)}else this._gCounty.classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,t=>t.name).join(t=>t.append("text").attr("transform",t=>"translate(".concat(t.centroid[0],",").concat(t.centroid[1],")rotate(").concat(t.angle,")")).text(t=>t.name)),this._gRegion.classed("d-none",!1)}else this._gRegion.classed("d-none",!0)}update(t){this._scale=null!=t?t:this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()}_filterVisible(){"position"===this.showRadius?this._portDataFiltered=this.portData:this._portDataFiltered=this.portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]),this._countyPolygonFiltered=this._countyPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1]),this._regionPolygonFiltered=this._regionPolygon.filter(t=>t.centroid[0]>=this._lowerBound[0]&&t.centroid[0]<=this._upperBound[0]&&t.centroid[1]>=this._lowerBound[1]&&t.centroid[1]<=this._upperBound[1])}setBounds(t,e){this._lowerBound=t,this._upperBound=e}_showSummary(){this._divPortSummary.classed("hidden",!1)}setShowRadiusSetting(t=this._radioButtonValues[0]){this.showRadius=t,this._radios.set(this.showRadius),this._cookie.set(this.showRadius)}transform(t){this._gPort.attr("transform",t.toString())}clearMap(t){this._showSummary(),this.portData=this.portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)}}}).call(this,i(49))},276:function(t,e,i){(function(t){i.d(e,"a",(function(){return w}));i(89),i(90),i(91),i(92),i(93),i(94),i(95),i(96),i(97),i(98),i(99),i(100),i(101),i(53),i(24),i(144),i(147),i(154);var a=i(138),o=i(37),s=i(153),n=i(277),r=i(50),d=i(19),c=i(151);function l(t){return function(t){if(Array.isArray(t))return h(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return h(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function p(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function u(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}const _=t=>t*t,m=t=>Math.sqrt(_(t.x)+_(t.y)+_(t.z)),g=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,v=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),f=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),b=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),y=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});class w{constructor(t){S.set(this,{writable:!0,value:{}}),x.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:[]}),C.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:[]}),O.set(this,{writable:!0,value:[]}),u(this,x,t),u(this,M,3),u(this,P,l(new Array(p(this,M)).keys())),u(this,I,"Get position"),u(this,j,"get-position"),u(this,k,"button-".concat(p(this,j))),u(this,C,"modal-".concat(p(this,j)));for(const t of p(this,P))p(this,T)[t]="".concat(p(this,j),"-").concat(t,"-select"),p(this,D)[t]="".concat(p(this,j),"-").concat(t,"-input");this._setupListener()}_navbarClick(t){Object(o.b)("Menu","Get position"),this._positionSelected()}_setupListener(){var t;null===(t=document.querySelector("#".concat(p(this,k))))||void 0===t||t.addEventListener("click",t=>this._navbarClick(t))}_injectModal(){Object(d.u)({id:p(this,C),title:p(this,I),size:"modal-sm",buttonText:"Go"});const t=Object(a.a)("#".concat(p(this,C)," .modal-body"));t.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of p(this,P)){const i=e.append("div").attr("class","form-row");i.append("div").attr("class","col-md-6").append("label").append("select").attr("name",p(this,T)[t]).attr("id",p(this,T)[t]).attr("class","selectpicker"),i.append("div").attr("class","col-md-6").append("input").attr("id",p(this,D)[t]).attr("name",p(this,D)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)}}_setupSelects(){const e=p(this,x).portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(c.b)(["name"])),i="".concat(e.map(t=>'<option data-subtext="'.concat(t.nation,'">').concat(t.name,"</option>")).join(""));for(const e of p(this,P))p(this,O)[e]=document.querySelector("#".concat(p(this,T)[e])),p(this,O)[e].insertAdjacentHTML("beforeend",i),t(p(this,O)[e]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0})}_initModal(){this._injectModal(),this._setupSelects()}_showAndGoToPosition(){const t=p(this,x).portData.map(t=>{var e;return{x:t.coordinates[0],y:t.coordinates[1],z:0,r:null!==(e=t.distance)&&void 0!==e?e:0}}),e=((t,e,i,a=!1)=>{const o=b(v(e,t),m(v(e,t))),s=g(o,v(i,t));let n=v(v(i,t),y(o,s));const r=b(n,m(n)),d=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(o,r),c=m(v(e,t)),l=g(r,v(i,t)),h=(_(t.r)-_(e.r)+_(c))/(2*c),p=(_(t.r)-_(i.r)+_(s)+_(l))/(2*l)-s/l*h;let u=_(t.r)-_(h)-_(p);Math.abs(u)<1e-10&&(u=0);const w=Math.sqrt(u);if(Number.isNaN(w))return null;n=f(t,f(y(o,h),y(r,p)));const S=f(n,y(d,w)),x=v(n,y(d,w));return 0===w||a?n:[S,x]})(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),p(this,x).map.f11.printCoord(e.x,e.y),p(this,x).map.zoomAndPan(e.x,e.y,1);const t=Math.round(Object(r.f)(e.x,e.y)/-1e3),i=Math.round(Object(r.g)(e.x,e.y)/-1e3);Object(s.b)(t,i,p(this,S)),new n.a("Get position","Coordinates copied to clipboard.")}else new n.a("Get position","No intersection found.")}_useUserInput(){const t=new Map;for(const e of p(this,P)){const i=p(this,O)[e].selectedIndex?p(this,O)[e].options[p(this,O)[e].selectedIndex].text:"",a=Number(document.querySelector("#".concat(p(this,D)[e])).value);a&&""!==i&&t.set(i,1.04*a*d.f)}t.size===p(this,M)?(p(this,x).setShowRadiusSetting("position"),p(this,x).portData=p(this,x).portDataDefault.filter(e=>t.has(e.name)).map(e=>(e.distance=t.get(e.name),e)),p(this,x).update(),this._showAndGoToPosition()):new n.a("Get position","Not enough data.")}_positionSelected(){document.querySelector("#".concat(p(this,C)))||(this._initModal(),u(this,S,t("#".concat(p(this,C))))),p(this,S).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}}var S=new WeakMap,x=new WeakMap,j=new WeakMap,I=new WeakMap,k=new WeakMap,D=new WeakMap,C=new WeakMap,M=new WeakMap,P=new WeakMap,T=new WeakMap,O=new WeakMap}).call(this,i(49))},277:function(t,e,i){(function(t){i.d(e,"a",(function(){return r}));i(53),i(24),i(144),i(278);var a=i(138),o=i(19);function s(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function n(t,e,i){var a=e.get(t);if(!a)throw new TypeError("attempted to set private field on non-instance");if(a.set)a.set.call(t,i);else{if(!a.writable)throw new TypeError("attempted to set read only private field");a.value=i}return i}class r{constructor(t,e){d.set(this,{writable:!0,value:void 0}),c.set(this,{writable:!0,value:void 0}),l.set(this,{writable:!0,value:void 0}),h.set(this,{writable:!0,value:void 0}),n(this,d,t),n(this,c,e),n(this,h,Object(a.a)("#toast-column")),this._set(),this._show();window.setTimeout(this._remove.bind(this),1e4)}_set(){n(this,l,s(this,h).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=s(this,l).append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",o.r).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(s(this,d)),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),s(this,l).append("div").attr("class","toast-body").html(s(this,c))}_show(){const e=s(this,l).node();if(null!==e){t(e).toast({autohide:!1}).toast("show")}}_remove(){s(this,l).remove()}}var d=new WeakMap,c=new WeakMap,l=new WeakMap,h=new WeakMap}).call(this,i(49))},279:function(t,e,i){var a={"./CN.svg":280,"./CNa.svg":281,"./DE.svg":282,"./DEa.svg":283,"./DK.svg":284,"./DKa.svg":285,"./ES.svg":286,"./ESa.svg":287,"./FR.svg":288,"./FRa.svg":289,"./FT.svg":290,"./GB.svg":291,"./GBa.svg":292,"./NT.svg":293,"./PL.svg":294,"./PLa.svg":295,"./PR.svg":296,"./PRa.svg":297,"./RU.svg":298,"./RUa.svg":299,"./SE.svg":300,"./SEa.svg":301,"./US.svg":302,"./USa.svg":303,"./VP.svg":304,"./VPa.svg":305};function o(t){var e=s(t);return i(e)}function s(t){if(!i.o(a,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return a[t]}o.keys=function(){return Object.keys(a)},o.resolve=s,t.exports=o,o.id=279},280:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fecd21' d='M0 0h640v480H0z'/%3E%3Ccircle cx='30%25' cy='40%25' fill='red' r='100'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},281:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fecd21' d='M0 0h640v480H0z'/%3E%3Ccircle cx='30%25' cy='40%25' fill='red' r='100'/%3E%3Cpath fill='%23fff' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},282:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},283:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},284:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},285:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},286:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},287:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},288:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},289:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},290:function(t,e){t.exports="data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='currentColor' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M8 0a1 1 0 011 1v5.268l4.562-2.634a1 1 0 111 1.732L10 8l4.562 2.634a1 1 0 11-1 1.732L9 9.732V15a1 1 0 11-2 0V9.732l-4.562 2.634a1 1 0 11-1-1.732L6 8 1.438 5.366a1 1 0 011-1.732L7 6.268V1a1 1 0 011-1z' fill-rule='evenodd' fill='%23d2ccc2'/%3E%3C/svg%3E"},291:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},292:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},293:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d2ccc2' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},294:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},295:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},296:function(t,e,i){t.exports=i.p+"images/flags/PR.svg"},297:function(t,e,i){t.exports=i.p+"images/flags/PRa.svg"},298:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},299:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},300:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},301:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},302:function(t,e,i){t.exports=i.p+"images/flags/US.svg"},303:function(t,e,i){t.exports=i.p+"images/flags/USa.svg"},304:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23736b5d' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},305:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c5bcaf' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},306:function(t,e,i){(function(t){i.d(e,"a",(function(){return w}));i(216),i(89),i(90),i(91),i(92),i(93),i(94),i(95),i(96),i(97),i(98),i(99),i(100),i(101),i(172),i(173),i(174),i(175),i(176),i(177),i(178),i(179),i(180),i(181),i(182),i(183),i(184),i(185),i(186),i(187),i(24),i(144),i(308),i(154),i(247),i(248);var a=i(165),o=i.n(a),s=(i(195),i(170)),n=i.n(s),r=i(310),d=i.n(r),c=i(171),l=i.n(c),h=i(37),p=i(38),u=i(19),_=i(146),m=i(50),g=i(151),v=i(57);function f(t){return function(t){if(Array.isArray(t))return b(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return b(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return b(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function y(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}o.a.extend(n.a),o.a.extend(d.a),o.a.extend(l.a),o.a.locale("en-gb");class w{constructor(t,e,i){y(this,"isInventorySelected",void 0),y(this,"_dataLoaded",!1),y(this,"_distances",new Map),y(this,"_frontlinesData",void 0),y(this,"_nation",void 0),y(this,"_ports",void 0),y(this,"_buyGoodsId",void 0),y(this,"_buyGoodsSelector",void 0),y(this,"_dateFormat",void 0),y(this,"_frontlineAttackingNationId",void 0),y(this,"_frontlineAttackingNationSelector",void 0),y(this,"_frontlineDefendingNationId",void 0),y(this,"_frontlineDefendingNationSelector",void 0),y(this,"_inventoryId",void 0),y(this,"_inventorySelector",void 0),y(this,"_map",void 0),y(this,"_numberPorts",void 0),y(this,"_pbZone",void 0),y(this,"_portNamesId",void 0),y(this,"_portNamesSelector",void 0),y(this,"_propClanId",void 0),y(this,"_propClanSelector",void 0),y(this,"_propNationId",void 0),y(this,"_propNationSelector",void 0),y(this,"_sellProfit",new Map),y(this,"_timeFormat",void 0),this._ports=t,this._pbZone=e,this._map=i,this._numberPorts=this._ports.portData.length,this._dateFormat="D MMM",this._timeFormat="HH.00",this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.querySelector("#".concat(this._frontlineAttackingNationId)),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.querySelector("#".concat(this._frontlineDefendingNationId)),this._portNamesId="port-names-select",this._portNamesSelector=document.querySelector("#".concat(this._portNamesId)),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.querySelector("#".concat(this._buyGoodsId)),this._inventoryId="inventory-select",this._inventorySelector=document.querySelector("#".concat(this._inventoryId)),this._propNationId="prop-nation-select",this._propNationSelector=document.querySelector("#".concat(this._propNationId)),this._propClanId="prop-clan-select",this._propClanSelector=document.querySelector("#".concat(this._propClanId)),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupPortSelect(),this._setupGoodSelect(),this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect()}_resetOtherSelects(e){for(const i of[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector])i===e||i===this._propClanSelector&&e===this._propNationSelector||i===this._propNationSelector&&e===this._propClanSelector||t(i).val("default").selectpicker("refresh")}async _loadData(){if(!this._dataLoaded){const t="data";try{this._frontlinesData=await(await fetch("".concat(t,"/").concat(this._map.serverName,"-frontlines.json"))).json();const e=(await i.e(4).then(i.t.bind(null,359,3))).default;this._distances=new Map(e.map(([t,e,i])=>[t*this._numberPorts+e,i])),this._dataLoaded=!0}catch(t){Object(p.e)(t)}}}_setupListener(){var e,i,a,o,s,n,r,d,c,l,p,_,m;t(this._portNamesSelector).one("show.bs.select",()=>{this._injectPortSelect()}),this._portNamesSelector.addEventListener("change",async t=>{Object(h.b)("Menu","Trade relations"),await this._loadData(),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()}),t(this._buyGoodsSelector).one("show.bs.select",async()=>{await this._loadData(),this._injectGoodsSelect()}),this._buyGoodsSelector.addEventListener("change",t=>{Object(h.b)("Menu","Goods’ relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()}),this._inventorySelector.addEventListener("change",t=>{Object(h.b)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()}),this._frontlineAttackingNationSelector.addEventListener("change",async t=>{Object(h.b)("Menu","Frontlines Attack"),await this._loadData(),this._resetOtherSelects(this._frontlineAttackingNationSelector),this._frontlineAttackingNationSelected(),t.preventDefault()}),this._frontlineDefendingNationSelector.addEventListener("change",async t=>{Object(h.b)("Menu","Frontlines Defence"),await this._loadData(),this._resetOtherSelects(this._frontlineDefendingNationSelector),this._frontlineDefendingNationSelected(),t.preventDefault()}),this._propNationSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()}),this._propClanSelector.addEventListener("change",t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()}),null===(e=document.querySelector("#menu-prop-deep"))||void 0===e||e.addEventListener("click",()=>this._depthSelected("deep")),null===(i=document.querySelector("#menu-prop-shallow"))||void 0===i||i.addEventListener("click",()=>this._depthSelected("shallow")),null===(a=document.querySelector("#menu-prop-all"))||void 0===a||a.addEventListener("click",()=>this._allSelected()),null===(o=document.querySelector("#menu-prop-non-capturable"))||void 0===o||o.addEventListener("click",()=>this._nonCapSelected()),null===(s=document.querySelector("#menu-prop-large"))||void 0===s||s.addEventListener("click",()=>this._portSizeSelected("Large")),null===(n=document.querySelector("#menu-prop-medium"))||void 0===n||n.addEventListener("click",()=>this._portSizeSelected("Medium")),null===(r=document.querySelector("#menu-prop-small"))||void 0===r||r.addEventListener("click",()=>this._portSizeSelected("Small")),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"icon icon-clock",date:"icon icon-calendar",up:"icon icon-chevron-top",down:"icon icon-chevron-bottom",previous:"icon icon-chevron-left",next:"icon icon-chevron-right",clear:"icon icon-clear",close:"icon icon-close"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),null===(d=document.querySelector("#prop-pb-range"))||void 0===d||d.addEventListener("submit",t=>{this._capturePBRange(),t.preventDefault()}),null===(c=document.querySelector("#menu-prop-today"))||void 0===c||c.addEventListener("click",()=>this._capturedToday()),null===(l=document.querySelector("#menu-prop-yesterday"))||void 0===l||l.addEventListener("click",()=>this._capturedYesterday()),null===(p=document.querySelector("#menu-prop-this-week"))||void 0===p||p.addEventListener("click",()=>this._capturedThisWeek()),null===(_=document.querySelector("#menu-prop-last-week"))||void 0===_||_.addEventListener("click",()=>this._capturedLastWeek());const g=t("#prop-from"),v=t("#prop-to");g.datetimepicker({format:this._dateFormat}),v.datetimepicker({format:this._dateFormat,useCurrent:!1}),g.on("change.datetimepicker",t=>v.datetimepicker({minDate:t.date})),v.on("change.datetimepicker",t=>g.datetimepicker({maxDate:t.date})),null===(m=document.querySelector("#prop-range"))||void 0===m||m.addEventListener("submit",t=>{this._captureRange(),t.preventDefault()}),Object(u.s)("selectPortNavbar")}_injectPortSelect(){const e=this._ports.portDataDefault.map(t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation})).sort(Object(g.b)(["name"])),i="".concat(e.map(t=>'<option data-subtext="'.concat(t.nation,'" value="').concat(t.coord.toString(),'" data-id="').concat(t.id,'">').concat(t.name,"</option>")).join(""));this._portNamesSelector.insertAdjacentHTML("beforeend",i),t(this._portNamesSelector).selectpicker("refresh")}_setupPortSelect(){this._portNamesSelector.classList.add("selectpicker"),t(this._portNamesSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show trade relations",virtualScroll:!0})}_injectGoodsSelect(){const e=new Map,i=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const t of this._ports.portDataDefault)for(const a of i){const i=t[a];if(i)for(const t of i)e.set(t,this._ports.tradeItem.get(t).name)}const a=f(e).sort((t,e)=>t[1].localeCompare(e[1])),o="".concat(a.map(t=>'<option value="'.concat(t[0],'">').concat(t[1],"</option>")).join(""));this._buyGoodsSelector.insertAdjacentHTML("beforeend",o),t(this._buyGoodsSelector).selectpicker("refresh")}_setupGoodSelect(){this._buyGoodsSelector.classList.add("selectpicker"),t(this._buyGoodsSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show goods’ relations",virtualScroll:!0})}setupInventorySelect(e){if(!this._inventorySelector.classList.contains("selectpicker")){const e=new Set;for(const t of this._ports.portDataDefault)if(t.inventory)for(const i of t.inventory)e.add(i.name);const i="".concat(f(e).sort(g.a).map(t=>"<option>".concat(t,"</option>")).join(""));this._inventorySelector.insertAdjacentHTML("beforeend",i),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))}_getNationOptions(t=!0){return"".concat(p.d.filter(e=>!(!t&&("FT"===e.short||"NT"===e.short))).sort(Object(g.b)(["name"])).map(t=>'<option value="'.concat(t.short,'">').concat(t.name,"</option>")).join(""))}_setupFrontlinesNationSelect(){const e=this._getNationOptions(!1);this._frontlineAttackingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineAttackingNationSelector.classList.add("selectpicker"),t(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),this._frontlineDefendingNationSelector.insertAdjacentHTML("beforeend",e),this._frontlineDefendingNationSelector.classList.add("selectpicker"),t(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupNationSelect(){const e=this._getNationOptions(!0);this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupClanSelect(){const e=new Set;for(const t of this._ports.portData.filter(t=>""!==t.capturer))e.add(t.capturer);this._propClanSelector.innerHTML="";let i="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,i="".concat(f(e).sort(g.a).map(t=>'<option value="'.concat(t,'" class="caps">').concat(t,"</option>")).join(""))),this._propClanSelector.insertAdjacentHTML("beforeend",i),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_getSailingDistance(t,e){var i,a;return t<e?null!==(i=this._distances.get(t*this._numberPorts+e))&&void 0!==i?i:0:null!==(a=this._distances.get(e*this._numberPorts+t))&&void 0!==a?a:0}_setTradePortPartners(){var t;const e=null!==(t=this._ports.portDataDefault.find(t=>t.id===this._ports.tradePortId))&&void 0!==t?t:[];e&&this._setTradeRelations(e)}_setTradeRelations(t){const e=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.price)&&void 0!==e?e:0},i=t=>{var e,i;return null!==(e=null===(i=this._ports.tradeItem.get(t))||void 0===i?void 0:i.distanceFactor)&&void 0!==e?e:0},a=t=>{var e,i;return null!==(e=null===(i=this._ports.portDataDefault.find(e=>e.id===t))||void 0===i?void 0:i.portTax)&&void 0!==e?e:0},o=t=>{var e,i;const a=this._ports.portDataDefault.find(e=>e.id===t);return{x:null!==(e=null==a?void 0:a.coordinates[0])&&void 0!==e?e:0,y:null!==(i=null==a?void 0:a.coordinates[1])&&void 0!==i?i:0}},s=(t,e)=>{const i=o(t),a=o(e);return Object(m.o)(i,a)},n=(t,e)=>{let i=1/0;const a=new Set(this._ports.portDataDefault.filter(t=>{var i,a,o;return null!==(i=null===(a=t.dropsTrading)||void 0===a?void 0:a.includes(e))&&void 0!==i?i:null===(o=t.dropsNonTrading)||void 0===o?void 0:o.includes(e)}).map(t=>t.id));for(const e of a)i=Math.min(i,s(e,t.id));return i},r=(t,o,s)=>{const r=n(o,s),d=this._getSailingDistance(t.id,o.id),c=a(t.id),l=a(o.id);let h=e(s),p=3*h+r*h*i(s)/6/100;h*=1+c,p/=1+l;const u=Math.round(p-h);return{profit:u,profitPerDistance:u/d}},d=(t,e,i)=>{const a=String(e.id).padStart(4,"0")+String(i).padStart(4,"0");return this._sellProfit.has(a)||this._sellProfit.set(a,r(t,e,i)),this._sellProfit.get(a)},c=e=>{var i,a,o,s;const n=null!==(i=new Set(null===(a=t.dropsTrading)||void 0===a?void 0:a.map(t=>t)))&&void 0!==i?i:[];return null!==(o=null===(s=e.consumesTrading)||void 0===s?void 0:s.filter(t=>n.has(t)).map(i=>{var a,o;return{name:null!==(a=null===(o=this._ports.tradeItem.get(i))||void 0===o?void 0:o.name)&&void 0!==a?a:"",profit:d(t,e,i)}}))&&void 0!==o?o:[]},l=e=>{var i,a,o,s;const n=null!==(i=new Set(null===(a=t.consumesTrading)||void 0===a?void 0:a.map(t=>t)))&&void 0!==i?i:[];return null!==(o=null===(s=e.dropsTrading)||void 0===s?void 0:s.filter(t=>n.has(t)).map(i=>{var a,o;return{name:null!==(a=null===(o=this._ports.tradeItem.get(i))||void 0===o?void 0:o.name)&&void 0!==a?a:"",profit:d(e,t,i)}}))&&void 0!==o?o:[]};this._ports.portData=this._ports.portDataDefault.map(e=>(e.sailingDistanceToTradePort=this._getSailingDistance(e.id,t.id),e.goodsToBuyInTradePort=c(e),e.buyInTradePort=Boolean(e.goodsToBuyInTradePort.length),e.goodsToSellInTradePort=l(e),e.sellInTradePort=Boolean(e.goodsToSellInTradePort.length),e)).filter(t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort)}_portSelected(){const t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),i=Number(t.getAttribute("data-id"));this._ports.currentPort={id:i,coord:{x:Number(e[0]),y:Number(e[1])}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone.showPB&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update(),this._map.initialZoomAndPan()}_goodSelected(){const t=Number(this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value),e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>e.dropsTrading&&e.dropsTrading.some(e=>e===t)||e.dropsNonTrading&&e.dropsNonTrading.some(e=>e===t)||e.producesNonTrading&&e.producesNonTrading.some(e=>e===t)))).map(t=>(t.isSource=!0,t)),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(e=>e.consumesTrading&&e.consumesTrading.some(e=>e===t)))).map(t=>(t.isSource=!1,t));this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(i),this._ports.showRadius="currentGood",this._ports.update()}inventorySelected(){this.isInventorySelected=!0;const t=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,e=new Map,i=new Map,a=this._ports.portDataDefault.filter(e=>e.inventory.some(e=>e.name===t)).sort(Object(g.b)(["name"])).map(a=>{const o=a.inventory.find(e=>e.name===t);return o&&(a.sellInTradePort=o.buyQuantity>0,a.sellInTradePort&&e.set(a.name,{name:a.name,nation:a.nation,good:o}),a.buyInTradePort=o.sellQuantity>0,a.buyInTradePort&&i.set(a.name,{name:a.name,nation:a.nation,good:o})),a});this._ports.setShowRadiusSetting("off"),this._ports.portData=a,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{let a="";if(a+="<h5>".concat(t,"</h5>"),e.size){a+="<h6>Buy</h6>";for(const[,t]of e)a+="".concat(t.name,' <span class="caps">').concat(t.nation,"</span>: ").concat(Object(_.d)(t.good.buyQuantity)," @ ").concat(Object(_.h)(t.good.buyPrice),"<br>")}if(e&&i&&(a+="<p></p>"),i.size){a+="<h6>Sell</h6>";for(const[,t]of i)a+="".concat(t.name,' <span class="caps">').concat(t.nation,"</span>: ").concat(Object(_.d)(t.good.sellQuantity)," @ ").concat(Object(_.h)(t.good.sellPrice),"<br>")}return a})()),this._ports.update()}_setFrontlinePorts(t,e){const i=this._frontlinesData[t][e],a=new Set(i.map(t=>Number(t.key))),o=new Set(i.flatMap(t=>t.value.map(t=>t)));this._ports.portData=this._ports.portDataDefault.map(t=>(t.enemyPort=a.has(t.id),t.ownPort=o.has(t.id),t))}_frontlineAttackingNationSelected(){const t=this._frontlineAttackingNationSelector.options[this._frontlineAttackingNationSelector.selectedIndex].value;Object(p.g)(t)&&(this._setFrontlinePorts("attacking",t),this._ports.showRadius="frontline",this._ports.update())}_frontlineDefendingNationSelected(){const t=this._frontlineDefendingNationSelector.options[this._frontlineDefendingNationSelector.selectedIndex].value;Object(p.g)(t)&&(this._setFrontlinePorts("defending",t),this._ports.showRadius="frontline",this._ports.update())}_nationSelected(){this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,Object(p.g)(this._nation)?(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")):this._nation="NT"}_clanSelected(){const t=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;t?this._ports.portData=this._ports.portDataDefault.filter(e=>e.capturer===t):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(t=>t.nation===this._nation)),this._ports.showRadius="",this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter(e=>"shallow"===t?e.shallow:!e.shallow);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter(t=>t.availableForAll);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_nonCapSelected(){const t=this._ports.portDataDefault.filter(t=>!t.capturable);this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_portSizeSelected(t){const e=this._ports.portDataDefault.filter(e=>t===e.portBattleType);this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_capturePBRange(){var t,e;const i=Object(p.f)(v.c-2,v.c),a=24-(i.length+1),s=new Set,n=o()(null===(t=document.querySelector("#prop-pb-from-input"))||void 0===t?void 0:t.value,this._timeFormat).hour();let r=o()(null===(e=document.querySelector("#prop-pb-to-input"))||void 0===e?void 0:e.value,this._timeFormat).hour();if(!(i.includes(n)&&i.includes(r)&&n<=r)){s.add(0),r<n&&(r+=24);for(let t=n-2;t<=r-3;t+=1)s.add((t-10)%a)}const d=this._ports.portDataDefault.filter(t=>t.capturable&&"FT"!==t.nation&&s.has(t.portBattleStartTime));this._ports.portData=d,this._ports.showRadius="",this._ports.update()}_filterCaptured(t,e){const i=this._ports.portDataDefault.filter(i=>o()(i.lastPortBattle,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]"));this._ports.portData=i,this._ports.showRadius="",this._ports.update()}_capturedToday(){const t=o.a.utc();let e=o()().utc().hour(v.c).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,o.a.utc(e).add(1,"day"))}_capturedYesterday(){const t=o.a.utc();let e=o()().utc().hour(v.c).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,o.a.utc(e).add(1,"day"))}_capturedThisWeek(){const t=o()().utc().startOf("week"),e=t.utc().hour(v.c),i=o()(t).utc().add(7,"day").hour(v.c);this._filterCaptured(e,i)}_capturedLastWeek(){const t=o()().utc().startOf("week"),e=o()(t).utc().subtract(7,"day").hour(v.c),i=t.utc().hour(v.c);this._filterCaptured(e,i)}_captureRange(){const e=t("#prop-from").datetimepicker("viewDate"),i=t("#prop-to").datetimepicker("viewDate"),a=e.utc().hour(v.c).minute(0),o=i.utc().add(1,"day").hour(v.c).minute(0);this._filterCaptured(a,o)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")}}}).call(this,i(49))},311:function(t,e,i){(function(t){i.d(e,"a",(function(){return p}));i(144),i(147);var a=i(138),o=i(197),s=i.n(o),n=(i(249),i(37)),r=i(146),d=i(19),c=i(50),l=i(153);function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class p{constructor(t,e){h(this,"_map",void 0),h(this,"_coord",void 0),h(this,"_baseName",void 0),h(this,"_baseId",void 0),h(this,"_buttonId",void 0),h(this,"_modalId",void 0),h(this,"_formId",void 0),h(this,"_xInputId",void 0),h(this,"_zInputId",void 0),h(this,"_copyButtonId",void 0),h(this,"_submitButtonId",void 0),h(this,"_modal$",void 0),h(this,"_g",void 0),h(this,"_formSel",void 0),h(this,"_xInputSel",void 0),h(this,"_zInputSel",void 0),this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),this._formId="form-".concat(this._baseId),this._xInputId="input-x-".concat(this._baseId),this._zInputId="input-z-".concat(this._baseId),this._copyButtonId="copy-coord-".concat(this._baseId),this._submitButtonId="submit-".concat(this._baseId),this._setupSvg(),this._setupListener()}_setupSvg(){this._g=Object(a.a)("#na-svg").append("g").classed("f11",!0)}_navbarClick(t){Object(n.b)("Menu","Go to F11"),this._f11Selected()}_setupListener(){var t;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("click",t=>this._navbarClick(t)),window.addEventListener("keydown",t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick(t)})}_injectModal(){Object(d.u)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(a.a)("#".concat(this._modalId," .modal-body")).append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const o=t.append("div").classed("float-right btn-group",!0).attr("role","group");o.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),o.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to");Object(a.a)("#".concat(this._modalId," .modal-footer")).remove()}_initModal(){this._injectModal()}_f11Selected(){var e,i;this._modal$||(this._initModal(),this._modal$=t("#".concat(this._modalId)),this._xInputSel=document.querySelector("#".concat(this._xInputId)),this._zInputSel=document.querySelector("#".concat(this._zInputId)),this._formSel.addEventListener("submit",t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()}),null===(e=document.querySelector("#".concat(this._modalId)))||void 0===e||e.addEventListener("keydown",t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)}),null===(i=document.querySelector("#".concat(this._copyButtonId)))||void 0===i||i.addEventListener("click",t=>{this._copyCoordClicked(t)}));this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()}_getInputValue(t){const{value:e}=t;return""===e?1/0:Number(e)}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){Object(n.b)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this._getXCoord(),i=this._getZCoord();Object(l.b)(e,i,this._modal$)}_printF11Coord(t,e,i,a){var o,n,d,c;let l=10;const h=this._g.append("g").attr("transform","translate(".concat(t,",").concat(e,")")),p=h.append("rect"),u=h.append("rect");h.append("circle").attr("r",l),l*=1.6;const _=h.append("text").attr("dx","".concat(-l,"px")).attr("dy","".concat(-l/2-2,"px")).attr("class","f11-coord").text(Object(r.a)(i)),m=h.append("text").attr("dx","".concat(-l,"px")).attr("dy","".concat(l/2+2,"px")).attr("class","f11-coord").text(Object(r.a)(a)),g=null===(o=_.node())||void 0===o?void 0:o.getBBox(),v=null===(n=m.node())||void 0===n?void 0:n.getBBox(),f=s()().utc(),b=s()(),y=h.append("text").attr("dx","".concat(l,"px")).attr("dy","".concat(-l/2-2,"px")).attr("class","f11-time").text(f.format("H.mm")),w=h.append("text").attr("dx","".concat(l,"px")).attr("dy","".concat(l/2+2,"px")).attr("class","f11-time").text("(".concat(b.format("H.mm")," local)")),S=null===(d=y.node())||void 0===d?void 0:d.getBBox(),x=null===(c=w.node())||void 0===c?void 0:c.getBBox(),j=g&&v?1.2*Math.round(g.height+v.height):0,I=g&&v?Math.round(Math.max(g.width,v.width)+5):0,k=S&&x?1.2*Math.round(S.height+x.height):0,D=S&&x?Math.round(Math.max(S.width,x.width)+5):0,C=Math.max(j,k);p.attr("x",-I-l).attr("y",-C/2).attr("height",C).attr("width",I+l),u.attr("x",0).attr("y",-C/2).attr("height",C).attr("width",D+l)}_goToF11(t,e){const i=Math.floor(Object(c.d)(t,e)),a=Math.floor(Object(c.e)(t,e));Object(c.a)(i,this._coord.min,this._coord.max,!0)&&Object(c.a)(a,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(i,a,t,e),this._map.zoomAndPan(i,a,1))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&(Object(n.b)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=Object(c.f)(t,e),a=Object(c.g)(t,e);this._printF11Coord(t,e,i,a)}transform(t){this._g.attr("transform",t.toString())}clearMap(){this._g.selectAll("*").remove()}}}).call(this,i(49))},312:function(t,e,i){(function(t){i.d(e,"a",(function(){return m}));i(51),i(89),i(90),i(91),i(92),i(93),i(94),i(95),i(96),i(97),i(98),i(99),i(100),i(101),i(172),i(173),i(174),i(175),i(176),i(177),i(178),i(179),i(180),i(181),i(182),i(183),i(184),i(185),i(186),i(187),i(24),i(144),i(313),i(194),i(154);var a=i(217),o=i(210),s=i(158),n=i(138),r=i(38),d=i(146),c=i(50),l=i(52),h=i(54);function p(t){return function(t){if(Array.isArray(t))return u(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return u(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return u(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function _(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class m{constructor(t,e,i,a,o){_(this,"show",void 0),_(this,"_serverName",void 0),_(this,"_portSelect",void 0),_(this,"_isDataLoaded",void 0),_(this,"_minScale",void 0),_(this,"_scale",void 0),_(this,"_fontSize",void 0),_(this,"_numTrades",void 0),_(this,"_arrowX",void 0),_(this,"_arrowY",void 0),_(this,"_baseId",void 0),_(this,"_nationSelectId",void 0),_(this,"_listType",void 0),_(this,"_showId",void 0),_(this,"_showRadioValues",void 0),_(this,"_showCookie",void 0),_(this,"_showRadios",void 0),_(this,"_profitId",void 0),_(this,"_profitRadioValues",void 0),_(this,"_profitCookie",void 0),_(this,"_profitRadios",void 0),_(this,"_profitValue",void 0),_(this,"_lowerBound",void 0),_(this,"_upperBound",void 0),_(this,"_profitText",void 0),_(this,"_g",void 0),_(this,"_labelG",void 0),_(this,"_tradeDetailsDiv",void 0),_(this,"_tradeDetailsHead",void 0),_(this,"_nationSelector",void 0),_(this,"_list",void 0),_(this,"_linkDataDefault",void 0),_(this,"_linkData",void 0),_(this,"_portData",void 0),_(this,"_nodeData",void 0),_(this,"_linkDataFiltered",void 0),_(this,"_portDataFiltered",void 0),this._serverName=t,this._portSelect=e,this._minScale=i,this._scale=this._minScale,this._fontSize=c.i,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId="".concat(this._baseId,"-nation-select"),this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new l.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new h.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new l.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new h.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(a,o),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}static _getId(t){return"trade-".concat(t.source.id,"-").concat(t.good.replace(/ /g,""),"-").concat(t.target.id)}static _addInfo(t){return"<div><div>".concat(t,"</div>")}static _addDes(t){return'<div class="des">'.concat(t,"</div></div>")}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return'<div class="block-block"><span>'.concat(t,"</span>")}static _endBlock(){return"</div>"}static _hideDetails(e,i,a){t(Object(n.a)(a[i]).node()).tooltip("dispose")}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=Object(n.a)("#na-svg").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(n.a)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d","M0,0L0,".concat(this._arrowY,"L").concat(this._arrowX,",").concat(this._arrowY/2,"z")).attr("class","trade-arrow-head"),this._tradeDetailsDiv=Object(n.a)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const e="".concat(r.d.map(t=>'<option value="'.concat(t.short,'" selected>').concat(t.name,"</option>")).join("")),i="".concat(this._baseId,"-card");this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const a=this._tradeDetailsHead.append("label"),o=a.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=o.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText(t){let e="";return e=t===r.d.length?"All":String(t),"".concat(e," nations selected")},title:"Select nations"}),a.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#".concat(i)).text("Info"),this._tradeDetailsHead.append("div").attr("id",i).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i="".concat(this._profitId,"-").concat(e.replace(/ /g,"")),a=t.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),a.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){var t,e;null===(t=document.querySelector("#".concat(this._showId)))||void 0===t||t.addEventListener("change",async()=>this._showSelected()),null===(e=document.querySelector("#".concat(this._profitId)))||void 0===e||e.addEventListener("change",()=>this._profitValueSelected()),this._nationSelector.addEventListener("change",t=>{this._nationChanged(),t.preventDefault()})}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map(t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}])),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map(t=>{let e=0;switch(this._profitValue){case"weight":e=m._getProfitPerWeight(t);break;case"distance":e=m._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error("Wrong profit value ".concat(this._profitValue))}return t.profit=e,t}).sort((t,e)=>{var i,a;return null!==(i=e.profit)&&void 0!==i?i:0-(null!==(a=t.profit)&&void 0!==a?a:0)})}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){try{const t=(await i.e(10).then(i.t.bind(null,262,3))).default,e=await(await fetch("".concat("data","/").concat(this._serverName,"-pb.json"))).json();this._linkDataDefault=await(await fetch("".concat("data","/").concat(this._serverName,"-trades.json"))).json(),this._portData=t.map(t=>{const i=e.find(e=>e.id===t.id);return{...t,...i}})}catch(t){Object(r.e)(t)}}async _loadAndSetupData(){try{await this._loadData(),this._setupData()}catch(t){Object(r.e)(t)}}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then(()=>{this._isDataLoaded=!0}),m._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(m._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){var e,i;return null===(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.isShallow)||void 0===e||e}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){var e;const i=t.weightPerItem*t.quantity;let a="";return a+=m._addInfo("".concat(Object(d.d)(t.quantity)," ").concat(t.good))+m._addDes("trade"),a+=m._addInfo("".concat(Object(d.h)(null!==(e=t.profit)&&void 0!==e?e:0)))+m._addDes(this._profitText),a+=m._addInfo("".concat(Object(d.i)(i)," ").concat(1===i?"ton":"tons"))+m._addDes("weight"),a+=m._addInfo("".concat(this._nodeData.get(t.source.id).name,' <span class="caps">').concat(this._nodeData.get(t.source.id).nation,"</span>"))+m._addDes("from ".concat(this._getDepth(t.source.id))),a+=m._addInfo("".concat(this._nodeData.get(t.target.id).name,' <span class="caps">').concat(this._nodeData.get(t.target.id).nation,"</span>"))+m._addDes("to ".concat(this._getDepth(t.target.id))),a+=m._addInfo("".concat(Object(d.i)(t.distance)," k"))+m._addDes("distance"),a}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,a=m._getProfitPerDistance(t),o=m._getProfitPerWeight(t);let s="";return s+=m._startBlock("Trade"),s+=m._addInfo("".concat(Object(d.d)(t.quantity)," ").concat(t.good))+m._addDes("good"),s+=m._addInfo("".concat(Object(d.h)(t.source.grossPrice)))+m._addDes("gross buy price"),s+=m._addInfo("".concat(Object(d.h)(t.target.grossPrice)))+m._addDes("gross sell price"),s+=m._addInfo("".concat(Object(d.i)(e)," ").concat(1===e?"ton":"tons"))+m._addDes("weight"),s+=m._endBlock(),s+=m._startBlock("Profit"),s+=m._addInfo("".concat(Object(d.h)(t.profitTotal)))+m._addDes("total"),s+=m._addInfo("".concat(Object(d.h)(i)))+m._addDes("profit/item"),s+=m._addInfo("".concat(Object(d.h)(a)))+m._addDes("profit/distance"),s+=m._addInfo("".concat(Object(d.h)(o)))+m._addDes("profit/weight"),s+=m._endBlock(),s+=m._startBlock("Route"),s+=m._addInfo("".concat(this._nodeData.get(t.source.id).name,' <span class="caps">').concat(this._nodeData.get(t.source.id).nation,"</span>"))+m._addDes("from ".concat(this._getDepth(t.source.id))),s+=m._addInfo("".concat(this._nodeData.get(t.target.id).name,' <span class="caps">').concat(this._nodeData.get(t.target.id).nation,"</span>"))+m._addDes("to ".concat(this._getDepth(t.source.id))),s+=m._addInfo("".concat(Object(d.i)(t.distance)," k"))+m._addDes("distance"),s+=m._endBlock(),s}_showDetails(e,i,a){const o=Object(n.a)(a[i]),s=this._getTradeFullData(e);t(o.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:s,trigger:"manual",sanitize:!1}).tooltip("show")}_getSiblingLinks(t,e){return this._linkDataFiltered.filter(i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t).map(t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0})}_getXCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.x)&&void 0!==e?e:0}_getYCoord(t){var e,i;return null!==(e=null===(i=this._nodeData.get(t))||void 0===i?void 0:i.y)&&void 0!==e?e:0}_updateGraph(){const t=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},a={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},s=t?i.x:a.x,n=t?i.y:a.y,r=t?a.x:i.x,d=t?a.y:i.y;let c=Math.sqrt((r-s)**2+(d-n)**2);const l=t?0:1,h=this._getSiblingLinks(e.source.id,e.target.id);if(h.length>1){var p,u;const t=Object(o.b)().domain(h).range([1,h.length]);c/=1+1/h.length*(null!==(p=t(null!==(u=e.profit)&&void 0!==u?u:0))&&void 0!==p?p:-1)}return c=Math.round(c),"M".concat(s,",").concat(n,"A").concat(c,",").concat(c," ").concat(0,",").concat(0,",").concat(l," ").concat(r,",").concat(d)},e=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,i=Object(a.a)(this._linkDataFiltered,t=>{var e;return null!==(e=t.profit)&&void 0!==e?e:0}),n=Object(s.a)().range([5/this._scale,15/this._scale]).domain(i),r=2**Math.log2(Math.abs(this._minScale)+this._scale),l=Object(c.s)(this._fontSize/r);this._g.selectAll(".trade-link").data(e,t=>m._getId(t)).join(t=>t.append("path").attr("class","trade-link").attr("marker-start",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)").attr("marker-end",t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"").attr("id",t=>m._getId(t)).on("click",(t,e,i)=>this._showDetails(t,e,i)).on("mouseleave",m._hideDetails)).attr("d",e=>t(this._getXCoord(e.source.id)<this._getXCoord(e.target.id),e)).attr("stroke-width",t=>{var e;return"".concat(n(null!==(e=t.profit)&&void 0!==e?e:0),"px")}),this._labelG.attr("font-size","".concat(l,"px")),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,t=>m._getId(t)).join(t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",t=>"#".concat(m._getId(t))).text(t=>"".concat(Object(d.d)(t.quantity)," ").concat(t.good))).attr("dy",t=>{var e;return"-".concat(n(null!==(e=t.profit)&&void 0!==e?e:0)/1.5,"px")})}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],m._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,m._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(null!=t?t:"")}_updatePortList(t){this._list.html(null!=t?t:"")}_updateTradeList(){let t;const e=e=>{t=Object(n.a)("path#".concat(m._getId(e))).classed("highlight",!0),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,t=>m._getId(t)).join(t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i)).html(t=>this._getTradeLimitedData(t))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter(t=>t.coordinates[0]>=this._lowerBound[0]&&t.coordinates[0]<=this._upperBound[0]&&t.coordinates[1]>=this._lowerBound[1]&&t.coordinates[1]<=this._upperBound[1]).map(t=>t.id));this._linkDataFiltered=this._linkData.filter(e=>t.has(e.source.id)||t.has(e.target.id)).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter(t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id)).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set(p(this._nationSelector.selectedOptions).map(t=>t.value));this._portDataFiltered=new Set(this._portData.filter(e=>t.has(e.nation)).map(t=>t.id))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t,e){this._lowerBound=t,this._upperBound=e}transform(t){this._g.attr("transform",t.toString()),this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}}).call(this,i(49))},314:function(t,e,i){(function(t){i.d(e,"a",(function(){return v}));i(144),i(147),i(194);var a=i(138),o=i(250),s=(i(249),i(198),i(37)),n=i(19),r=i(50),d=i(153),c=i(165),l=i.n(c),h=(i(195),i(170)),p=i.n(h),u=i(171),_=i.n(u),m=i(52);function g(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}l.a.extend(p.a),l.a.extend(_.a),l.a.locale("en-gb");class v{constructor(){g(this,"_line",void 0),g(this,"_windPath",void 0),g(this,"_windArrowWidth",void 0),g(this,"_intervalSeconds",void 0),g(this,"_baseName",void 0),g(this,"_baseId",void 0),g(this,"_buttonId",void 0),g(this,"_modalId",void 0),g(this,"_formId",void 0),g(this,"_sliderId",void 0),g(this,"_cookieExpire",void 0),g(this,"_cookieWindDegrees",void 0),g(this,"_cookieTime",void 0),g(this,"_currentWindDegrees",void 0),g(this,"_height",void 0),g(this,"_yCompass",void 0),g(this,"_width",void 0),g(this,"_xCompass",void 0),g(this,"_compassRadius",void 0),g(this,"_length",void 0),g(this,"_intervalId",void 0),g(this,"_svg",void 0),g(this,"_div",void 0),this._line=Object(o.a)().x(t=>t[0]).y(t=>t[1]),this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId="button-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),this._formId="form-".concat(this._baseId),this._sliderId="slider-".concat(this._baseId),this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new m.a({id:"".concat(this._baseId,"-degrees"),expire:this._cookieExpire}),this._cookieTime=new m.a({id:"".concat(this._baseId,"-time")}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}_getHeight(){const t=document.querySelector("#port-summary .block");if(t){const{height:e,top:i}=t.getBoundingClientRect();return e-i-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-Number.parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))}return 0}_getCurrentWindCookie(){const t=Number(this._cookieWindDegrees.get());if(t){const e=Number(this._cookieTime.get()),i=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-n.l*i)%360}return t}_getExpire(){const t=l.a.utc();let e=l()().utc().hour(10).minute(0).second(0);return t.hour()>=e.hour()&&(e=e.add(1,"day")),e.local().toDate()}_storeCurrentWindCookie(){this._cookieWindDegrees.set(String(this._currentWindDegrees)),this._cookieTime.set(String(Date.now()))}_setupSvg(){const t=Object(a.a)("#port-summary");t.classed("port-summary-no-wind",!1).classed("port-summary-wind",!0),this._div=t.insert("div",":first-child").attr("id",this._baseId).attr("class","block p-0"),this._svg=this._div.append("svg").attr("class","ingame-wind small")}_navbarClick(t){Object(s.b)("Menu",this._baseName),this._windRoseSelected()}_setupListener(){var t;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>"".concat(Object(d.e)(t.value),"<br>").concat(String(t.value),"°"),t("#".concat(this._sliderId)).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/r.b.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){Object(n.u)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(a.a)("#".concat(this._modalId," .modal-body")).append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")}_initModal(){this._injectModal(),this._setupWindInput()}_windRoseSelected(){document.querySelector("#".concat(this._modalId))||this._initModal(),t("#".concat(this._modalId)).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_windChange(){this._currentWindDegrees=360+(this._currentWindDegrees-n.l*this._intervalSeconds)%360,this._updateWindDirection()}_useUserInput(){this._currentWindDegrees=Object(d.j)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()}_initShowCurrentWind(){this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval(()=>{this._windChange()},1e3*this._intervalSeconds)}_updateWindDirection(){const t=Object(r.m)(this._currentWindDegrees),e=this._length*Math.cos(t),i=this._length*Math.sin(t),a=[[Math.round(this._xCompass+e),Math.round(this._yCompass+i)],[Math.round(this._xCompass-e),Math.round(this._yCompass-i)]];this._windPath&&(this._windPath.datum(a).attr("d",this._line),this._storeCurrentWindCookie())}_initPrintCompassRose(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);const t=this._svg.append("svg").attr("class","compass").attr("x",this._xCompass).attr("y",this._yCompass);Object(d.l)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").attr("marker-end","url(#wind-arrow)")}clearMap(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=void 0,this._cookieWindDegrees.remove()}}}).call(this,i(49))},315:function(t,e,i){(function(t){i.d(e,"a",(function(){return y}));i(24),i(144),i(147);var a=i(367),o=i(211),s=i(394),n=i(158),r=i(83),d=i(138),c=i(250),l=i(266),h=(i(198),i(37)),p=i(19),u=i(146),_=i(50),m=i(153),g=i(254);function v(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return f(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return f(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=new Array(e);i<e;i++)a[i]=t[i];return a}function b(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class y{constructor(t){b(this,"_fontSize",void 0),b(this,"_compassRadius",void 0),b(this,"_courseArrowWidth",void 0),b(this,"_line",void 0),b(this,"_labelPadding",void 0),b(this,"_degreesPerMinute",void 0),b(this,"_degreesSegment",void 0),b(this,"_minOWSpeed",void 0),b(this,"_owSpeedFactor",void 0),b(this,"_speedScale",void 0),b(this,"_defaultShipName",void 0),b(this,"_defaultShipSpeed",void 0),b(this,"_defaultStartWindDegrees",void 0),b(this,"_baseName",void 0),b(this,"_baseId",void 0),b(this,"_buttonId",void 0),b(this,"_compassId",void 0),b(this,"_deleteLastLegButtonId",void 0),b(this,"_modalId",void 0),b(this,"_sliderId",void 0),b(this,"_shipId",void 0),b(this,"_g",void 0),b(this,"_journey",void 0),b(this,"_shipCompare",void 0),b(this,"_compass",void 0),b(this,"_compassG",void 0),b(this,"_divJourneySummary",void 0),b(this,"_journeySummaryShip",void 0),b(this,"_journeySummaryTextShip",void 0),b(this,"_journeySummaryWind",void 0),b(this,"_journeySummaryTextWind",void 0),b(this,"_gJourneyPath",void 0),b(this,"_drag",void 0),this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(c.a)().x(t=>t[0]).y(t=>t[1]),this._labelPadding=20,this._degreesPerMinute=p.l/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(n.a)().domain(Object(o.a)(0,_.j,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-".concat(this._baseId),this._compassId="compass-".concat(this._baseId),this._deleteLastLegButtonId="button-delete-leg-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),this._sliderId="slider-".concat(this._baseId),this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}static _pluralize(t,e){return"".concat(t," ").concat(e+(1===t?"":"s"))}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let a="in ";if(t<1)a+="less than a minute";else{const t=0===e?"":y._pluralize(e,"hour");a+=t+(""===t?"":" ")+(0===i?"":y._pluralize(i,"minute"))}return a}_setupDrag(){this._drag=s.a().on("start",(t,e,i)=>{r.c.sourceEvent.stopPropagation(),this._removeLabels(),Object(d.a)(i[e]).classed("drag-active",!0)}).on("drag",(t,e,i)=>{const a=r.c,o=t.position[0]+Number(a.dx),s=t.position[1]+Number(a.dy);0===e&&this._compass.attr("x",o).attr("y",s),Object(d.a)(i[e]).attr("cx",a.x).attr("cy",a.y),t.position=[o,s],this._printLines()}).on("end",(t,e,i)=>{Object(d.a)(i[e]).classed("drag-active",!1),this._printJourney()})}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(d.a)("#na-svg").insert("g","g.pb").attr("class","journey"),Object(d.a)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox","0 -".concat(t," ").concat(e," ").concat(e)).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d","M0,-".concat(t,"L").concat(e,",0L0,").concat(t))}_initJourneyData(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(t){Object(h.b)("Menu","MakeJourney"),this._journeySelected()}_setupListener(){var t,e;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("mouseup",t=>this._navbarClick(t)),null===(e=document.querySelector("#".concat(this._deleteLastLegButtonId)))||void 0===e||e.addEventListener("mouseup",()=>this._deleteLastLeg())}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>"".concat(Object(m.e)(t.value),"<br>").concat(String(t.value),"°"),t("#".concat(this._sliderId)).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/_.b.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){Object(p.u)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=Object(d.a)("#".concat(this._modalId," .modal-body")).append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i="".concat(this._shipId,"-Base-select"),a=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new g.a(this._shipId),this._shipCompare.CompareShipsInit()}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.querySelector("#".concat(this._modalId))||this._initModal(),t("#".concat(this._modalId)).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_printCompass(){const t=this._journey.segments[0].position[0],e=this._journey.segments[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e),this._compassG=this._compass.append("g"),Object(m.k)({element:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t),this._minOWSpeed)}_calculateDistanceForSection(t,e){const i=(_.j-t+e)%_.j;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*_.t}_getStartWind(){const e=t("#".concat(this._sliderId)),i=Number(e.roundSlider("getValue"));return e.length>0?i:0}_setShipSpeed(){let t=[];this._journey.shipName===this._defaultShipName?t=v(new Array(24).fill(this._defaultShipSpeed/2)):({speedDegrees:t}=this._shipCompare.singleShipData),this._speedScale.range(t)}_calculateMinutesForSegment(t,e,i){let a=i,o=e,s=0;for(this._setShipSpeed();a>0;){const e=this._calculateDistanceForSection(t,o);a>e?(a-=e,s+=1):(s+=a/e,a=0),o=(_.j+o-this._degreesPerMinute)%_.j}return this._journey.currentWindDegrees=o,s}_setShipName(){this._shipCompare&&this._shipCompare.singleShipData&&this._shipCompare.singleShipData.name?this._journey.shipName="".concat(this._shipCompare.singleShipData.name):this._journey.shipName=this._defaultShipName}_removeLabels(){const t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=Object(d.a)("#na-svg"),e=Object(l.c)(t.node()),i=Math.max(1,e.k),a=this._fontSize/i,o=l.b.translate(20/i,20/i),s=this._labelPadding/i,n=10/i,r=5/i;this._g.selectAll("g.journey g.label").each((t,e,i)=>{const r=Object(d.a)(i[e]),c=r.select("text"),l=t.label.split("|"),h=1.3*a;c.text("").attr("dy",0).attr("transform",o.toString()).style("font-size","".concat(a,"px")),l.forEach((t,e)=>{const i=c.append("tspan").html(t);e>0&&i.attr("x",0).attr("dy",h)});const p=c.node().getBBox(),u=t.label?p.width+2*s:0,_=t.label?p.height+s:0;r.select("rect").attr("width",u).attr("height",_);const m=r.select("circle").attr("r",n).attr("class","");r.append(()=>m.remove().node()),0===e&&m.attr("r",4*n).attr("class","drag-hidden"),e===i.length-1&&m.attr("r",n).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width","".concat(r,"px")),this._compassG&&this._compassG.attr("transform","scale(".concat(1/i,")"))}_printLabels(){const t=Object(a.c)().padding(this._labelPadding).value(t=>{const e=t.label.split("|"),i=e.reduce((t,e,i,a)=>a[t].length>e.length?t:i,0);return e[i]}),e=Object(a.a)(),i=Object(a.b)(e).size((t,e,i)=>{const a=t.label.split("|").length,o=i[e].querySelectorAll("text")[0].getBBox();return[o.width+2*this._labelPadding,o.height*a+2*this._labelPadding]}).position(t=>t.position).component(t);this._g.datum(this._journey.segments.map(t=>t)).call(i)}_setupSummary(){this._divJourneySummary=Object(d.a)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),Object(d.a)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html("From ".concat(Object(m.f)(this._journey.startWindDegrees)))}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segments.length>1?this._journey.segments.map(t=>t.position):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)}_getTextDirection(t,e,i){return"".concat(Object(m.f)(t,!0)," ⁖ F11: ").concat(Object(u.a)(Object(_.f)(i.x,i.y))," / ").concat(Object(u.a)(Object(_.g)(i.x,i.y)))}_getTextDistance(t,e,i){let a="".concat(Math.round(t)," k ").concat(y._getHumanisedDuration(e));return i&&(a+="⁖ total ".concat(Math.round(this._journey.totalDistance)," k ").concat(y._getHumanisedDuration(this._journey.totalMinutes))),a}_setSegmentLabel(t=this._journey.segments.length-1){const e={x:this._journey.segments[t].position[0],y:this._journey.segments[t].position[1]},i={x:this._journey.segments[t-1].position[0],y:this._journey.segments[t-1].position[1]},a=Object(m.m)(e,i),o=Object(_.o)(e,i),s=Object(_.l)(a),n=this._calculateMinutesForSegment(a,this._journey.currentWindDegrees,1e3*o);this._journey.totalDistance+=o,this._journey.totalMinutes+=n;const r=this._getTextDirection(s,a,e),d=this._getTextDistance(o,n,t>1);this._journey.segments[t].label="".concat(r,"|").concat(d)}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData(),this._journey.segments.forEach((t,e)=>{e<this._journey.segments.length-1&&this._setSegmentLabel(e+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segments.pop(),this._journey.segments.length>0?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top","".concat(t,"px")).style("right","".concat(e,"px"))}plotCourse(t,e){this._journey.segments[0].position[0]>0?(this._journey.segments.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segments[0]={position:[t,e],label:""},this._initJourney())}transform(t){this._g.attr("transform",t.toString()),this._correctJourney()}}}).call(this,i(49))},317:function(t,e,i){(function(t){i.d(e,"a",(function(){return g}));i(51),i(144),i(147);var a=i(138),o=i(250),s=(i(198),i(247),i(248),i(37)),n=i(19),r=i(50),d=i(153),c=i(165),l=i.n(c),h=(i(195),i(170)),p=i.n(h),u=i(171),_=i.n(u);function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}l.a.extend(p.a),l.a.extend(_.a),l.a.locale("en-gb");class g{constructor(){m(this,"_height",void 0),m(this,"_width",void 0),m(this,"_windArrowWidth",void 0),m(this,"_baseName",void 0),m(this,"_baseId",void 0),m(this,"_buttonId",void 0),m(this,"_modalId",void 0),m(this,"_formId",void 0),m(this,"_sliderId",void 0),m(this,"_timeGroupId",void 0),m(this,"_timeInputId",void 0),m(this,"_svg",void 0),this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId="button-".concat(this._baseId),this._modalId="modal-".concat(this._baseId),this._formId="form-".concat(this._baseId),this._sliderId="slider-".concat(this._baseId),this._timeGroupId="input-group-".concat(this._baseId),this._timeInputId="input-".concat(this._baseId),this._setupSvg(),this._setupArrow(),this._setupListener()}_setupSvg(){this._svg=Object(a.a)("#wind svg")}_setupArrow(){const t=this._windArrowWidth,e=2*this._windArrowWidth;Object(a.a)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox","0 -".concat(t," ").concat(e," ").concat(e)).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d","M0,-".concat(t,"L").concat(e,",0L0,").concat(t)).attr("class","wind-predict-arrow-head")}_navbarClick(t){Object(s.b)("Menu",this._baseName),this._windSelected()}_setupListener(){var t;null===(t=document.querySelector("#".concat(this._buttonId)))||void 0===t||t.addEventListener("click",t=>this._navbarClick(t))}_setupWindInput(){const e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);const i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=t=>"".concat(Object(d.e)(t.value),"<br>").concat(String(t.value),"°"),t("#".concat(this._sliderId)).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/r.b.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){Object(n.u)({id:this._modalId,title:this._baseName,size:"modal-sm"});const e=Object(a.a)("#".concat(this._modalId," .modal-body")).append("form").attr("id",this._formId),i=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);i.append("label").attr("for",this._sliderId).text("Current in-game wind"),i.append("div").attr("id",this._sliderId).attr("class","rslider");const o=e.append("div").attr("class","form-group").append("div").attr("class","alert alert-primary");o.append("label").attr("for",this._timeInputId).text("Predict time (server time)");const s=o.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest");s.append("input").classed("form-control datetimepicker-input",!0).attr("type","text").attr("id",this._timeInputId).attr("data-target","#".concat(this._timeGroupId)).attr("aria-label",this._timeGroupId).attr("required",""),s.append("div").classed("input-group-append",!0).attr("data-target","#".concat(this._timeGroupId)).attr("data-toggle","datetimepicker").append("span").attr("class","input-group-text").append("i").attr("class","icon icon-clock"),t("#".concat(this._timeGroupId)).datetimepicker({defaultDate:l.a.utc().format().replace("Z",""),format:"H.mm"})}_initModal(){this._injectModal(),this._setupWindInput()}_windSelected(){document.querySelector("#".concat(this._modalId))||this._initModal(),t("#".concat(this._modalId)).modal("show").one("hidden.bs.modal",()=>{this._useUserInput()})}_useUserInput(){const e=Object(d.j)(this._sliderId),i=t("#".concat(this._timeInputId)).val().trim();this._predictWind(e,i)}_predictWind(t,e){let i;const a=/(\d+)[\s.:](\d+)/.exec(e),o=Number.parseInt(a[1],10),s=Number.parseInt(a[2],10);i=Number.isNaN(Number(t))?Object(r.c)(String(t)):Number(t);const d=l()().utc().second(0).millisecond(0),c=l()(d).hour(o).minute(s);c.isBefore(d)&&c.add(1,"day");const h=c.diff(d,"second"),p=360+(i-n.l*h)%360;this._printPredictedWind(p,c.format("H.mm"),Object(r.l)(t),d.format("H.mm"))}_printCompass(t){const e=Object(o.a)(),i=Math.min(this._height/1.4,this._width/1.4)/2,a=this._width/2,s=this._height/2.8,n=Object(r.m)(t),c=.6*i,l=c*Math.cos(n),h=c*Math.sin(n),p=[[Math.round(a+l),Math.round(s+h)],[Math.round(a-l),Math.round(s-h)]];this._svg.attr("height",this._height).attr("width",this._width);const u=this._svg.append("svg").attr("class","compass").attr("x",a).attr("y",s);Object(d.k)({element:u,radius:i}),this._svg.append("path").datum(p).attr("d",e).attr("marker-end","url(#wind-arrow)")}_printText(t,e,i,a){var o,s;const n=Object(r.l)(t),c=Number.parseInt(window.getComputedStyle(document.querySelector("#wind")).getPropertyValue("line-height"),10),l=this._svg.append("svg"),h=l.append("text").attr("x","50%").attr("y","33%").html("From ".concat(Object(d.f)(n,!0)," at ").concat(e)),p=l.append("text").attr("x","50%").attr("y","66%").attr("class","text-light-separation").html("Currently at ".concat(a," from ").concat(Object(d.f)(i,!0))),u=null===(o=h.node())||void 0===o?void 0:o.getBoundingClientRect(),_=null===(s=p.node())||void 0===s?void 0:s.getBoundingClientRect(),m=2*Math.max(Number(null==u?void 0:u.height),Number(null==_?void 0:_.height))+c,g=Math.max(Number(null==u?void 0:u.width),Number(null==_?void 0:_.width))+c;l.attr("x",(this._width-g)/2).attr("y","72%").attr("height",m).attr("width",g)}_addBackground(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)}_printPredictedWind(t,e,i,a){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,i,a),this._addBackground()}setPosition(t,e){this._svg.style("margin-left","".concat(e,"px")).style("margin-top","".concat(t,"px"))}clearMap(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)}}}).call(this,i(49))}}]);