(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{iSiJ:function(e,t,s){"use strict";(function(e){s.d(t,"a",function(){return D});s("Se8w"),s("/YXa"),s("bEJU"),s("ZEAQ"),s("y89P"),s("aZFp"),s("U00V"),s("9DLp");var a=s("/Cyf"),i=s("BfWa"),r=s("yw3p"),o=s("wbYc"),h=s("nUlG"),p=s("aBO9"),d=s("f4w0"),n=s("Av7d"),c=s("0lY5"),m=s("pFgi");const l=24,u=2*Math.PI/l;class _{constructor(e,t){this._id=e,this._shipData=t,this._ticksSpeed=[12,8,4,0],this._ticksSpeedLabels=["12 knots","8 knots","4 knots","0 knots"],this._select="#ship-compare-"+this._id,this._setupSvg(),this._g=Object(h.select)(this._select).select("g"),this._setCompass()}_setupSvg(){const e=Object(h.select)(this.select);Object(h.select)(this.select+" svg").remove(),e.append("svg").attr("width",this.shipData.svgWidth).attr("height",this.shipData.svgHeight).attr("data-ui-component","sailing-profile").attr("fill","none").append("g").attr("transform","translate("+this.shipData.svgWidth/2+", "+this.shipData.svgHeight/2+")"),Object(h.select)(this.select+" div").remove(),e.append("div").attr("class","block-small")}_setCompass(){const e=new Array(l/2);e.fill(1,0);const t=Object(p.f)().sort(null).value(1)(e),s=Object(p.a)().outerRadius(this.shipData.radiusScaleAbsolute(12)).innerRadius(this.shipData.innerRadius);this.g.selectAll(".compass-arc").data(t).join(e=>e.append("path").attr("class","compass-arc").attr("d",s)),this.g.selectAll(".speed-circle").data(this._ticksSpeed).join(e=>e.append("circle").attr("class","speed-circle").attr("r",e=>this.shipData.radiusScaleAbsolute(e))),this.g.append("line").attr("x1",0).attr("y1",-160).attr("x2",0).attr("y2",-79).attr("class","wind-arrow").attr("marker-end","url(#course-arrow)")}static pd(e){let t='<span class="badge badge-white">'+e[0]+" / ";return e[1]?t+=""+e[1]:t+="–",t+=" pd</span>"}static getCannonsPerDeck(e,t){let s=t[0]+" "+_.pd(e[0]),a="";for(let i=1;i<4;i+=1)t[i]?s=t[i]+" "+_.pd(e[i])+" <br>"+s:a+="<br>";return[s,a]}static getText(e){let t=0;function s(e){return'<div class="row row-small '+((t+=1)%2?"row-light":"")+'"><div class="col-3">'+e+"</div>"}function a(t,s,a){void 0===a&&(a=6);let i="",r="";if("cannonsPerDeck"===t){var o=e[t];i=o[0],r="<br>"+(r=o[1])}else i=""===t?"":e[t];return'<div class="col-'+a+'">'+i+'<br><span class="des">'+s+"</span>"+r+"</div>"}let i="";return i+=s(e.shipRating),i+='<div class="col-9"><div class="row no-gutters">',i+=a("battleRating","Battle rating"),i+=a("guns","Cannons"),i+=a("upgradeXP","Knowledge XP"),i+=a("waterlineHeight","Water line"),i+="</div></div></div>",i+=s(e.decks),i+='<div class="col-9"><div class="row no-gutters">',i+=a("cannonsPerDeck","Gun decks"),i+=a("firezoneHorizontalWidth","Firezone horizontal width"),i+="</div></div></div>",i+=s("Broadside (pd)"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("cannonBroadside","Cannons"),i+=a("carroBroadside","Carronades"),i+="</div></div></div>",i+=s("Chasers"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("gunsFront","Bow"),i+=a("gunsBack","Stern"),i+="</div></div></div>",i+=s("Speed"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("maxSpeed","Maximum"),i+=a("",""),i+=a("acceleration","Acceleration"),i+=a("deceleration","Deceleration"),i+=a("maxTurningSpeed","Turn speed"),i+=a("halfturnTime","Rudder half time"),i+="</div></div></div>",i+=s('Armour <span class="badge badge-white">Thickness</span>'),i+='<div class="col-9"><div class="row no-gutters">',i+=a("sideArmor","Sides"),i+=a("structure","Hull"),i+=a("frontArmor","Bow"),i+=a("backArmor","Stern"),i+=a("pump","Pump"),i+=a("rudder","Rudder"),i+="</div></div></div>",i+=s('Masts <span class="badge badge-white">Thickness</span>'),i+='<div class="col-9"><div class="row no-gutters">',i+=a("sails","Sails"),i+=a("mastBottomArmor","Bottom"),i+=a("mastMiddleArmor","Middle"),i+=a("mastTopArmor","Top"),i+="</div></div></div>",i+=s("Crew"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("minCrew","Minimum",4),i+=a("sailingCrew","Sailing",4),i+=a("maxCrew","Maximum",4),i+="</div></div></div>",i+=s("Resistance"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("fireResistance","Fire",3),i+=a("leakResistance","Leaks",3),i+=a("crewProtection","Crew Protection",6),i+="</div></div></div>",i+=s("Repairs needed"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("hullRepair","Hull",4),i+=a("rigRepair","Rig",4),i+=a("rumRepair","Rum",4),i+="</div></div></div>",i+=s("Repair time"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("sidesRepair","Sides",4),i+=a("structureRepair","Hull",4),i+=a("bowRepair","Bow",4),i+=a("sternRepair","Stern",4),i+=a("sailsRepair","Sails",4),i+=a("rudderRepair","Rudder",4),i+="</div></div></div>",i+=s("Hold"),i+='<div class="col-9"><div class="row no-gutters">',i+=a("maxWeight","Tons"),i+=a("holdSize","Cargo slots"),i+="</div></div></div>",i+="</div>"}get id(){return this._id}get shipData(){return this._shipData}get select(){return this._select}get g(){return this._g}}class g extends _{constructor(e,t,s){super(e,s),this._shipData=t,this._shipCompareData=s,this._setBackground(),this._setBackgroundGradient(),this._drawProfile(),this._printText()}_setBackground(){const e=Object(p.a)().outerRadius(e=>this.shipCompareData.radiusScaleAbsolute(e)+2).innerRadius(e=>this.shipCompareData.radiusScaleAbsolute(e)+1).startAngle(-Math.PI/2).endAngle(Math.PI/2);this.g.selectAll(".speed-textpath").data(this._ticksSpeed).join(t=>t.append("path").attr("class","speed-textpath").attr("d",e).attr("id",(e,t)=>"tick"+t)),this.g.selectAll(".speed-text").data(this._ticksSpeed).join(e=>e.append("text").attr("class","speed-text").append("textPath").attr("href",(e,t)=>"#tick"+t).text((e,t)=>this._ticksSpeedLabels[t]).attr("startOffset","10%"))}_setBackgroundGradient(){const e=Object(o.b)().domain([this.shipData.speed.min,this.shipData.speed.max]).range([0,this.shipCompareData.svgWidth]),t=e.domain();t[2]=t[1]-t[0];const s=[];for(let e=0;e<30;e+=1)s.push(e*t[2]/29+t[0]);this.g.append("defs").append("radialGradient").attr("id","gradient").attr("cx",.5).attr("cy",.25).attr("r",.5).selectAll("stop").data(Object(a.g)(30)).join(t=>t.append("stop").attr("offset",(t,a)=>e(s[a])/this.shipCompareData.svgWidth).attr("stop-color",(e,t)=>this.shipCompareData.colorScale(s[t])))}_drawProfile(){const e=Object(p.f)().sort(null).value(1)(this.shipData.speedDegrees),t=p.d,s=Object(p.g)().angle((e,t)=>t*u).radius(e=>this.shipCompareData.radiusScaleAbsolute(e.data)).curve(t);this.g.append("path").attr("class","base-profile").attr("d",s(e)),this.g.selectAll(".speed-markers").data(e).join(e=>e.append("circle").attr("class","speed-markers").attr("r",5).attr("cy",(e,t)=>Math.cos(t*u)*-this.shipCompareData.radiusScaleAbsolute(e.data)).attr("cx",(e,t)=>Math.sin(t*u)*this.shipCompareData.radiusScaleAbsolute(e.data)).attr("fill",e=>this.shipCompareData.colorScale(e.data)).append("title").text(e=>Math.round(10*e.data)/10+" knots"))}_printText(){const t=_.getCannonsPerDeck(this.shipData.deckClassLimit,this.shipData.gunsPerDeck),s={shipRating:Object(c.y)(this.shipData.class)+" rate",battleRating:this.shipData.battleRating,guns:this.shipData.guns,decks:this.shipData.decks+" deck"+(this.shipData.decks>1?"s":""),additionalRow:this.shipData.decks<4?"<br> ":"",cannonsPerDeck:t,cannonBroadside:Object(c.q)(this.shipData.broadside.cannons),carroBroadside:Object(c.q)(this.shipData.broadside.carronades),gunsFront:this.shipData.gunsPerDeck[4],limitFront:this.shipData.deckClassLimit[4],gunsBack:this.shipData.gunsPerDeck[5],limitBack:this.shipData.deckClassLimit[5],firezoneHorizontalWidth:this.shipData.ship.firezoneHorizontalWidth,waterlineHeight:Object(c.o)(this.shipData.ship.waterlineHeight),maxSpeed:Object(c.o)(this.shipData.speed.max,3),acceleration:Object(c.o)(this.shipData.ship.acceleration),deceleration:Object(c.o)(this.shipData.ship.deceleration),maxTurningSpeed:Object(c.o)(this.shipData.rudder.turnSpeed),halfturnTime:Object(c.o)(this.shipData.rudder.halfturnTime),sideArmor:Object(c.q)(this.shipData.sides.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.sides.thickness)+"</span>",frontArmor:Object(c.q)(this.shipData.bow.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.bow.thickness)+"</span>",pump:Object(c.q)(this.shipData.pump.armour),sails:Object(c.q)(this.shipData.sails.armour),structure:Object(c.q)(this.shipData.structure.armour),backArmor:Object(c.q)(this.shipData.stern.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.stern.thickness)+"</span>",rudder:Object(c.q)(this.shipData.rudder.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.rudder.thickness)+"</span>",minCrew:Object(c.q)(this.shipData.crew.min),maxCrew:Object(c.q)(this.shipData.crew.max),sailingCrew:Object(c.q)(this.shipData.crew.sailing),maxWeight:Object(c.q)(this.shipData.maxWeight),holdSize:Object(c.q)(this.shipData.holdSize),upgradeXP:Object(c.q)(this.shipData.upgradeXP),sternRepair:Object(c.q)(this.shipData.repairTime.stern),bowRepair:Object(c.q)(this.shipData.repairTime.bow),sidesRepair:Object(c.q)(this.shipData.repairTime.sides),rudderRepair:Object(c.q)(this.shipData.repairTime.rudder),sailsRepair:Object(c.q)(this.shipData.repairTime.sails),structureRepair:Object(c.q)(this.shipData.repairTime.structure),hullRepair:""+Object(c.q)(this.shipData.sides.armour/n.w),rigRepair:""+Object(c.q)(this.shipData.sails.armour/n.C),rumRepair:""+Object(c.q)(this.shipData.crew.max/n.D),fireResistance:Object(c.q)(this.shipData.resistance.fire),leakResistance:Object(c.q)(this.shipData.resistance.leaks),crewProtection:Object(c.q)(this.shipData.resistance.crew),mastBottomArmor:Object(c.q)(this.shipData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.mast.bottomThickness)+"</span>",mastMiddleArmor:Object(c.q)(this.shipData.mast.middleArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.mast.middleThickness)+"</span>",mastTopArmor:Object(c.q)(this.shipData.mast.topArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipData.mast.topThickness)+"</span>"};s.gunsFront?s.gunsFront+=" "+_.pd(s.limitFront):s.gunsFront="–",s.gunsBack?s.gunsBack+=" "+_.pd(s.limitBack):s.gunsBack="–",e(""+this.select).find("div").append(_.getText(s))}get shipData(){return this._shipData}get shipCompareData(){return this._shipCompareData}}class b extends _{constructor(e,t,s,a){super(e,a),this._shipBaseData=t,this._shipCompareData=s,this._shipCompare=a,this._drawDifferenceProfile(),this._injectTextComparison()}_drawDifferenceProfile(){const e=Object(p.f)().sort(null).value(1),t=e(this.shipCompareData.speedDegrees),s=e(this.shipBaseData.speedDegrees),a=p.d,i=Object(p.g)().angle((e,t)=>t*u).radius(e=>this.shipCompare.radiusScaleAbsolute(e.data)).curve(a),h=this.shipCompareData.speedDegrees.map((e,t)=>Object(c.G)(e-this.shipBaseData.speedDegrees[t])),d=this._shipCompare._minSpeed,m=this._shipCompare._maxSpeed,l=Object(o.b)().domain([d,-1,-.1,0,.1,1,m]).range([n.j,n.i,n.k,"#fff",n.h,n.f,n.g]).interpolate(r.c);this.g.append("path").attr("class","base-profile").attr("d",i(s)),this.g.append("path").attr("class","comp-profile").attr("d",i(t)),this.g.selectAll(".speed-markers").data(t).join(e=>e.append("circle").attr("class","speed-markers").attr("r",5).attr("cy",(e,t)=>Math.cos(t*u)*-this.shipCompare.radiusScaleAbsolute(e.data)).attr("cx",(e,t)=>Math.sin(t*u)*this.shipCompare.radiusScaleAbsolute(e.data)).attr("fill",(e,t)=>l(h[t])).append("title").text(e=>Math.round(10*e.data)/10+" knots"))}_injectTextComparison(){function t(e,t,s){void 0===s&&(s=0);const a=parseFloat((e-t).toFixed(s));return a<0?'<span class="badge badge-danger">'+Object(c.o)(Math.abs(a))+"</span>":a>0?'<span class="badge badge-success">'+Object(c.o)(a)+"</span>":""}const s={shipRating:Object(c.y)(this.shipCompareData.class)+" rate",battleRating:this.shipCompareData.battleRating+" "+t(this.shipCompareData.battleRating,this.shipBaseData.battleRating),guns:this.shipCompareData.guns+" "+t(this.shipCompareData.guns,this.shipBaseData.guns),decks:this.shipCompareData.decks+" deck"+(this.shipCompareData.decks>1?"s":"")+" "+t(this.shipCompareData.decks,this.shipBaseData.decks),additionalRow:this.shipCompareData.decks<4?"<br> ":"",cannonsPerDeck:_.getCannonsPerDeck(this.shipCompareData.deckClassLimit,this.shipCompareData.gunsPerDeck),cannonBroadside:this.shipCompareData.broadside.cannons+" "+t(this.shipCompareData.broadside.cannons,this.shipBaseData.broadside.cannons),carroBroadside:this.shipCompareData.broadside.carronades+" "+t(this.shipCompareData.broadside.carronades,this.shipBaseData.broadside.carronades),gunsFront:this.shipCompareData.gunsPerDeck[4],limitFront:this.shipCompareData.deckClassLimit[4],gunsBack:this.shipCompareData.gunsPerDeck[5],limitBack:this.shipCompareData.deckClassLimit[5],minSpeed:Object(c.o)(this.shipCompareData.speed.min)+" "+t(this.shipCompareData.speed.min,this.shipBaseData.speed.min,2),maxSpeed:Object(c.o)(this.shipCompareData.speed.max,3)+" "+t(this.shipCompareData.speed.max,this.shipBaseData.speed.max,2),maxTurningSpeed:Object(c.o)(this.shipCompareData.rudder.turnSpeed)+" "+t(this.shipCompareData.rudder.turnSpeed,this.shipBaseData.rudder.turnSpeed,2),firezoneHorizontalWidth:this.shipCompareData.ship.firezoneHorizontalWidth+" "+t(this.shipCompareData.ship.firezoneHorizontalWidth,this.shipBaseData.ship.firezoneHorizontalWidth),waterlineHeight:Object(c.o)(this.shipCompareData.ship.waterlineHeight)+" "+t(this.shipCompareData.ship.waterlineHeight,this.shipBaseData.ship.waterlineHeight,2),acceleration:Object(c.o)(this.shipCompareData.ship.acceleration)+" "+t(this.shipCompareData.ship.acceleration,this.shipBaseData.ship.acceleration,2),deceleration:Object(c.o)(this.shipCompareData.ship.deceleration)+" "+t(this.shipCompareData.ship.deceleration,this.shipBaseData.ship.deceleration,2),halfturnTime:Object(c.o)(this.shipCompareData.rudder.halfturnTime)+" "+t(this.shipCompareData.rudder.halfturnTime,this.shipBaseData.rudder.halfturnTime),sideArmor:Object(c.q)(this.shipCompareData.sides.armour)+" "+t(this.shipCompareData.sides.armour,this.shipBaseData.sides.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.sides.thickness)+"</span>"+t(this.shipCompareData.sides.thickness,this.shipBaseData.sides.thickness),frontArmor:Object(c.q)(this.shipCompareData.bow.armour)+" "+t(this.shipCompareData.bow.armour,this.shipBaseData.bow.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.bow.thickness)+"</span>"+t(this.shipCompareData.bow.thickness,this.shipBaseData.bow.thickness),backArmor:Object(c.q)(this.shipCompareData.stern.armour)+" "+t(this.shipCompareData.stern.armour,this.shipBaseData.stern.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.stern.thickness)+"</span>"+t(this.shipCompareData.stern.thickness,this.shipBaseData.stern.thickness),pump:Object(c.q)(this.shipCompareData.pump.armour)+" "+t(this.shipCompareData.pump.armour,this.shipBaseData.pump.armour),sails:Object(c.q)(this.shipCompareData.sails.armour)+" "+t(this.shipCompareData.sails.armour,this.shipBaseData.sails.armour),structure:Object(c.q)(this.shipCompareData.structure.armour)+" "+t(this.shipCompareData.structure.armour,this.shipBaseData.structure.armour),rudder:Object(c.q)(this.shipCompareData.rudder.armour)+" "+t(this.shipCompareData.rudder.armour,this.shipBaseData.rudder.armour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.rudder.thickness)+"</span>"+t(this.shipCompareData.rudder.thickness,this.shipBaseData.rudder.thickness),minCrew:Object(c.q)(this.shipCompareData.crew.min)+" "+t(this.shipCompareData.crew.min,this.shipBaseData.crew.min),maxCrew:Object(c.q)(this.shipCompareData.crew.max)+" "+t(this.shipCompareData.crew.max,this.shipBaseData.crew.max),sailingCrew:Object(c.q)(this.shipCompareData.crew.sailing)+" "+t(this.shipCompareData.crew.sailing,this.shipBaseData.crew.sailing),maxWeight:Object(c.q)(this.shipCompareData.maxWeight)+" "+t(this.shipCompareData.maxWeight,this.shipBaseData.maxWeight),holdSize:Object(c.q)(this.shipCompareData.holdSize)+" "+t(this.shipCompareData.holdSize,this.shipBaseData.holdSize),upgradeXP:Object(c.q)(this.shipCompareData.upgradeXP)+" "+t(this.shipCompareData.upgradeXP,this.shipBaseData.upgradeXP),sternRepair:Object(c.q)(this.shipCompareData.repairTime.stern)+" "+t(this.shipBaseData.repairTime.stern,this.shipCompareData.repairTime.stern),bowRepair:Object(c.q)(this.shipCompareData.repairTime.bow)+" "+t(this.shipBaseData.repairTime.bow,this.shipCompareData.repairTime.bow),sidesRepair:Object(c.q)(this.shipCompareData.repairTime.sides)+" "+t(this.shipBaseData.repairTime.sides,this.shipCompareData.repairTime.sides),rudderRepair:Object(c.q)(this.shipCompareData.repairTime.rudder)+" "+t(this.shipBaseData.repairTime.rudder,this.shipCompareData.repairTime.rudder),sailsRepair:Object(c.q)(this.shipCompareData.repairTime.sails)+" "+t(this.shipBaseData.repairTime.sails,this.shipCompareData.repairTime.sails),structureRepair:Object(c.q)(this.shipCompareData.repairTime.structure)+" "+t(this.shipBaseData.repairTime.structure,this.shipCompareData.repairTime.structure),hullRepair:Object(c.q)(this.shipCompareData.sides.armour/n.w)+" "+t(this.shipBaseData.sides.armour/n.w,this.shipCompareData.sides.armour/n.w),rigRepair:Object(c.q)(this.shipCompareData.sails.armour/n.C)+" "+t(this.shipBaseData.sails.armour/n.C,this.shipCompareData.sails.armour/n.C),rumRepair:Object(c.q)(this.shipCompareData.crew.max/n.D)+" "+t(this.shipBaseData.crew.max/n.D,this.shipCompareData.crew.max/n.D),fireResistance:Object(c.q)(this.shipCompareData.resistance.fire)+" "+t(this.shipCompareData.resistance.fire,this.shipBaseData.resistance.fire),leakResistance:Object(c.q)(this.shipCompareData.resistance.leaks)+" "+t(this.shipCompareData.resistance.leaks,this.shipBaseData.resistance.leaks),crewProtection:Object(c.q)(this.shipCompareData.resistance.crew)+" "+t(this.shipCompareData.resistance.crew,this.shipBaseData.resistance.crew),mastBottomArmor:Object(c.q)(this.shipCompareData.mast.bottomArmour)+" "+t(this.shipCompareData.mast.bottomArmour,this.shipBaseData.mast.bottomArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.mast.bottomThickness)+"</span>"+t(this.shipCompareData.mast.bottomThickness,this.shipBaseData.mast.bottomThickness),mastMiddleArmor:Object(c.q)(this.shipCompareData.mast.middleArmour)+" "+t(this.shipCompareData.mast.middleArmour,this.shipBaseData.mast.middleArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.mast.middleThickness)+"</span>"+t(this.shipCompareData.mast.middleThickness,this.shipBaseData.mast.middleThickness),mastTopArmor:Object(c.q)(this.shipCompareData.mast.topArmour)+" "+t(this.shipCompareData.mast.topArmour,this.shipBaseData.mast.topArmour)+' <span class="badge badge-white">'+Object(c.q)(this.shipCompareData.mast.topThickness)+"</span>"+t(this.shipCompareData.mast.topThickness,this.shipBaseData.mast.topThickness)};s.gunsFront?s.gunsFront+=" "+_.pd(s.limitFront):s.gunsFront="–",s.gunsBack?s.gunsBack+=" "+_.pd(s.limitBack):s.gunsBack="–",e(""+this.select).find("div").append(_.getText(s))}get shipBaseData(){return this._shipBaseData}get shipCompareData(){return this._shipCompareData}get shipCompare(){return this._shipCompare}}class D{constructor(e){let t=e.shipData,s=e.woodData,i=e.moduleData,h=e.id,p=void 0===h?"ship-compare":h;this._shipData=t,this._moduleDataDefault=i,this._baseId=p,this._baseName="Compare ships",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._moduleId=this._baseId+"-module",this._copyButtonId="button-copy-"+this._baseId,this._shipIds=[],this._selectedUpgradeIdsPerType=[],this._selectedUpgradeIdsList=[],this._selectShip$={},this._selectWood$={},this._selectModule$={},this._modal$=null,"ship-compare"===this._baseId?this._columnsCompare=["C1","C2"]:this._columnsCompare=[],this._columns=this._columnsCompare.slice(),this._columns.unshift("Base"),this._selectedShips={Base:{},C1:{},C2:{}},this._woodChanges=new Map([["Acceleration",["ship.acceleration"]],["Armor thickness",["sides.thickness","bow.thickness","stern.thickness"]],["Armour strength",["bow.armour","sides.armour","stern.armour"]],["Crew protection",["resistance.crew"]],["Crew",["crew.max"]],["Fire resistance",["resistance.fire"]],["Hull strength",["structure.armour"]],["Leak resistance",["resistance.leaks"]],["Mast thickness",["mast.bottomThickness","mast.middleThickness","mast.topThickness"]],["Rudder speed",["rudder.halfturnTime"]],["Ship speed",["speed.max"]],["Turn speed",["rudder.turnSpeed"]]]),this._moduleChanges=new Map([["Acceleration",["ship.acceleration"]],["Armor thickness",["sides.thickness","bow.thickness","stern.thickness"]],["Armour strength",["bow.armour","sides.armour","stern.armour"]],["Back armour thickness",["stern.thickness"]],["Crew protection",["resistance.crew"]],["Crew",["crew.max"]],["Fire resistance",["resistance.fire"]],["Front armour thickness",["bow.thickness"]],["Hold weight",["maxWeight"]],["Hull strength",["structure.armour"]],["Leak resistance",["resistance.leaks"]],["Mast health",["mast.bottomArmour","mast.middleArmour","mast.topArmour"]],["Mast thickness",["mast.bottomThickness","mast.middleThickness","mast.topThickness"]],["Rudder health",["rudder.armour"]],["Rudder repair time",["repairTime.rudder"]],["Rudder speed",["rudder.halfturnTime"]],["Sail repair time",["repairTime.sails"]],["Sailing crew",["crew.sailing"]],["Ship speed",["speed.max"]],["Side armour repair time",["repairTime.sides"]],["Speed decrease",["ship.deceleration"]],["Turn speed",["rudder.turnSpeed"]],["Water pump health",["pump.armour"]]]),this._moduleCaps=new Map([["Armor thickness",{properties:["sides.thickness","bow.thickness","stern.thickness"],cap:{amount:.3,isPercentage:!0}}],["Armour strength",{properties:["bow.armour","sides.armour","stern.armour"],cap:{amount:.3,isPercentage:!0}}],["Back armour thickness",{properties:["stern.thickness"],cap:{amount:.3,isPercentage:!0}}],["Front armour thickness",{properties:["bow.thickness"],cap:{amount:.3,isPercentage:!0}}],["Mast health",{properties:["mast.bottomArmour","mast.middleArmour","mast.topArmour"],cap:{amount:.3,isPercentage:!0}}],["Mast thickness",{properties:["mast.bottomThickness","mast.middleThickness","mast.topThickness"],cap:{amount:.3,isPercentage:!0}}],["Ship speed",{properties:["speed.max"],cap:{amount:15.5,isPercentage:!1}}],["Turn speed",{properties:["rudder.turnSpeed"],cap:{amount:.25,isPercentage:!0}}]]);const d=1.2*Object(a.f)(this._shipData,e=>e.speed.min),c=this._moduleCaps.get("Ship speed").cap.amount;this._minSpeed=d,this._maxSpeed=c,this._colorScale=Object(o.b)().domain([this._minSpeed,0,8,12,this._maxSpeed]).range([n.i,"#fff",n.h,n.f,n.g]).interpolate(r.c),"ship-journey"===this._baseId?this._woodId="wood-journey":this._woodId="wood-ship",this._woodCompare=new m.a(s,this._woodId),"ship-journey"===this._baseId?(this._initData(),this._initSelects()):this._setupListener()}_setupListener(){e("#"+this._buttonId).on("click",e=>{Object(d.b)("Tools",this._baseName),e.stopPropagation(),this._shipCompareSelected()})}_setGraphicsParameters(){this.svgWidth=parseInt(e("#"+this._modalId+" .column-base").width(),10),this.svgHeight=this.svgWidth,this.outerRadius=Math.floor(Math.min(this.svgWidth,this.svgHeight)/2),this.innerRadius=Math.floor(.3*this.outerRadius),this.radiusScaleAbsolute=Object(o.b)().domain([this.minSpeed,0,this.maxSpeed]).range([10,this.innerRadius,this.outerRadius])}_shipCompareSelected(){this._modal$||(this._initModal(),this._modal$=e("#"+this._modalId),this._modal$.on("keydown",e=>{"KeyC"===e.code&&e.ctrlKey&&this._copyDataClicked(e)}),document.getElementById(this._copyButtonId).addEventListener("click",e=>{this._copyDataClicked(e)})),e("#"+this._modalId).modal("show"),this._setGraphicsParameters()}_getShipAndWoodIds(){const e=[];return this._columns.forEach(t=>{void 0!==this._shipIds[t]&&(e.push(this._shipIds[t]),["frame","trim"].forEach(s=>{e.push(Number(this._selectWood$[t][s].val()))}))}),e}_copyDataClicked(e){Object(d.b)("Menu","Copy ship compare"),e.preventDefault();const t=this._getShipAndWoodIds();if(t.length){const e=new URL(window.location);e.searchParams.set("v",encodeURIComponent(n.d)),e.searchParams.set("cmp",n.v.encode(t)),this._columns.forEach((t,s)=>{this._selectedUpgradeIdsPerType[t]&&[...this._moduleTypes].forEach((a,i)=>{const r=this._selectedUpgradeIdsPerType[t][a];if(r&&r.length){const t=""+s+i;e.searchParams.set(t,n.v.encode(r))}})}),Object(c.g)(e.href)}}_setupShipData(){this.shipSelectData=Object(i.b)().key(e=>e.class).sortKeys(a.a).entries(this._shipData.map(e=>({id:e.id,name:e.name,class:e.class,battleRating:e.battleRating,guns:e.guns})).sort(Object(c.H)(["name"])))}_setupModuleData(){this._moduleProperties=new Map(this._moduleDataDefault.map(e=>e[1].filter(e=>e.properties.some(e=>this._moduleChanges.has(e.modifier))).map(e=>[e.id,e])).flat()),this._moduleTypes=new Set([...this._moduleProperties].map(e=>e[1].type.replace(/\s–\s[a-zA-Z\/]+/,"")))}_injectModal(){Object(n.z)(this._modalId,this._baseName);const e=Object(h.select)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row");this._columns.forEach(t=>{const s=e.append("div").attr("class","col-md-4 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp")),a=this._getShipSelectId(t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker"),["frame","trim"].forEach(e=>{const a=this._getWoodSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}),this._moduleTypes.forEach(e=>{const a=this._getModuleSelectId(e,t);s.append("label").append("select").attr("name",a).attr("id",a).property("multiple",!0).attr("class","selectpicker")}),s.append("div").attr("id",this._baseId+"-"+t).attr("class","Base"===t?"ship-base":"ship-compare")}),Object(h.select)("#"+this._modalId+" .modal-footer").insert("button","button").classed("btn btn-outline-secondary",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("far fa-copy",!0)}_initData(){this._setupShipData(),this._setupModuleData(),this.woodCompare._setupData()}_initSelects(){this._columns.forEach(t=>{this._selectWood$[t]={},this._setupShipSelect(t),["frame","trim"].forEach(s=>{this._selectWood$[t][s]=e("#"+this._getWoodSelectId(s,t)),this.woodCompare._setupWoodSelects(t,s,this._selectWood$[t][s])}),this._setupSelectListener(t)})}_initModal(){this._initData(),this._injectModal(),this._initSelects()}_getShipOptions(){return this.shipSelectData.map(e=>'<optgroup label="'+Object(c.y)(e.key,!1)+' rate">'+e.values.map(e=>'<option data-subtext="'+e.battleRating+'" value="'+e.id+'">'+e.name+" ("+e.guns+")").join("</option>")).join("</optgroup>")}_setupShipSelect(t){this._selectShip$[t]=e("#"+this._getShipSelectId(t));const s=this._getShipOptions();this._selectShip$[t].append(s),"Base"!==t&&this._selectShip$[t].attr("disabled","disabled")}_getUpgradesOptions(e,t){const s=Object(i.b)().key(e=>e[1].type.replace(/[a-zA-Z\s]+\s–\s/,"")).sortKeys(a.a).entries([...this._moduleProperties].filter(s=>s[1].type.replace(/\s–\s[a-zA-Z\/]+/,"")===e&&("U"===s[1].moduleLevel||s[1].moduleLevel===(e=>e<=3?"L":e<=5?"M":"S")(t))));let r="";return r=s.length>1?s.map(e=>'<optgroup label="'+e.key+'">'+e.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>")).join("</optgroup>"):s.map(e=>""+e.values.map(e=>'<option value="'+e[0]+'">'+e[1].name).join("</option>"))}_setupModulesSelect(t){const s=()=>this._shipData.find(e=>e.id===this._shipIds[t]).class;this._selectModule$[t]={},this._moduleTypes.forEach(a=>{this._selectModule$[t][a]=e("#"+this._getModuleSelectId(a,t));const i=this._getUpgradesOptions(a,s());this._selectModule$[t][a].append(i),this._selectModule$[t][a].on("changed.bs.select",()=>{this._modulesSelected(t),this._refreshShips(t)}).on("show.bs.select",()=>{this._selectModule$[t][a].parent().find("button.bs-select-all").remove()}).selectpicker({actionsBox:!0,countSelectedText:e=>e+" "+a.toLowerCase()+"s selected",deselectAllText:"Clear",maxOptions:"Ship trim"!==a&&i.length>1?5:1,selectedTextFormat:"count > 1",title:""+a,width:"150px"})})}_getShipData(e){const t=this._shipData.find(t=>t.id===this._shipIds[e]);let s=t;return s=this._addWoodData(t,e),s=this._addModulesData(t,s,e)}_addWoodData(e,t){const s=JSON.parse(JSON.stringify(e));if(s.resistance={},s.resistance.fire=0,s.resistance.leaks=0,s.resistance.crew=0,void 0!==this.woodCompare._instances[t]){let e="_woodData";"Base"!==t&&(e="_compareData");const a=new Map;["frame","trim"].forEach(s=>{this.woodCompare._instances[t][e][s].properties.forEach(e=>{if(this._woodChanges.has(e.modifier)){let t=e.isPercentage?0:e.amount,s=e.isPercentage?e.amount:0;a.has(e.modifier)&&(t+=a.get(e.modifier).absolute,s+=a.get(e.modifier).percentage),a.set(e.modifier,{absolute:t,percentage:s})}})}),a.forEach((e,t)=>{this._woodChanges.get(t).forEach(e=>{const i=e.split("."),r=a.get(t).absolute;let o=1;a.get(t).percentage&&(o=1+a.get(t).percentage/100),i.length>1?s[i[0]][i[1]]?(s[i[0]][i[1]]*=o,s[i[0]][i[1]]+=r):s[i[0]][i[1]]=r:s[i[0]]?(s[i[0]]*=o,s[i[0]]+=r):s[i[0]]=r})}),s.speedDegrees=s.speedDegrees.map(e=>{const t=1+a.get("Ship speed").percentage/100;return Math.max(Math.min(e*t,this._maxSpeed),this._minSpeed)})}return s}_addModulesData(e,t,s){const a=JSON.parse(JSON.stringify(t));if(void 0!==this._selectedUpgradeIdsList[s]){const t=new Map;this._selectedUpgradeIdsList[s].forEach(e=>{this._moduleProperties.get(e).properties.forEach(e=>{if(this._moduleChanges.has(e.modifier)){let s=e.isPercentage?0:e.amount,a=e.isPercentage?e.amount:0;t.has(e.modifier)&&(s+=t.get(e.modifier).absolute,a+=t.get(e.modifier).percentage),t.set(e.modifier,{absolute:s,percentage:a})}})}),t.forEach((e,s)=>{this._moduleChanges.get(s).forEach(e=>{const i=e.split(".");let r=1;t.get(s).percentage&&(r=1+t.get(s).percentage/100);const o=t.get(s).absolute;i.length>1?a[i[0]][i[1]]?(a[i[0]][i[1]]*=r,a[i[0]][i[1]]+=o):a[i[0]][i[1]]=o:a[i[0]]?(a[i[0]]*=r,a[i[0]]+=o):a[i[0]]=o})}),t.forEach((t,s)=>{if(this._moduleCaps.has(s)){const t=this._moduleCaps.get(s).cap;this._moduleCaps.get(s).properties.forEach(s=>{const i=s.split(".");i.length>1?a[i[0]][i[1]]&&(a[i[0]][i[1]]=Math.min(a[i[0]][i[1]],t.isPercentage?e[i[0]][i[1]]*(1+t.amount):t.amount)):a[i[0]]&&(a[i[0]]=Math.min(a[i[0]],t.isPercentage?e[i[0]]*(1+t.amount):t.amount))})}}),t.has("Ship speed")&&(a.speedDegrees=a.speedDegrees.map(e=>{const s=1+t.get("Ship speed").percentage/100;return Math.max(Math.min(e*s,this._maxSpeed),this._minSpeed)}))}return a}_refreshShips(e){const t=this._getShipData(e);"ship-journey"===this._baseId?this._singleShipData=t:"Base"===e?(this._setSelectedShip(e,new g(e,t,this)),this._columnsCompare.forEach(e=>{this._selectShip$[e].removeAttr("disabled").selectpicker("refresh"),Object(c.A)(this.selectedShips[e])||this._setSelectedShip(e,new b(e,t,this.selectedShips[e]._shipCompareData,this))})):this._setSelectedShip(e,new b(e,this.selectedShips.Base._shipData,t,this))}_enableCompareSelects(){this._columnsCompare.forEach(e=>{this._selectShip$[e].removeAttr("disabled").selectpicker("refresh")})}_modulesSelected(e){this._selectedUpgradeIdsList[e]=[],this._selectedUpgradeIdsPerType[e]={},this._moduleTypes.forEach(t=>{this._selectedUpgradeIdsPerType[e][t]=this._selectModule$[e][t].val(),Array.isArray(this._selectedUpgradeIdsPerType[e][t])?this._selectedUpgradeIdsPerType[e][t]=this._selectedUpgradeIdsPerType[e][t].map(Number):this._selectedUpgradeIdsPerType[e][t]=""===this._selectedUpgradeIdsPerType[e][t]?[]:[Number(this._selectedUpgradeIdsPerType[e][t])],this._selectedUpgradeIdsPerType[e][t].length&&(this._selectedUpgradeIdsList[e]=this._selectedUpgradeIdsList[e].concat(this._selectedUpgradeIdsPerType[e][t]))})}_setupSelectListener(e){this._selectShip$[e].on("changed.bs.select",()=>{this._shipIds[e]=Number(this._selectShip$[e].val()),this._refreshShips(e),"Base"===e&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(e),this._setupModulesSelect(e)}).selectpicker({title:"Ship"}),["frame","trim"].forEach(t=>{this._selectWood$[e][t].on("changed.bs.select",()=>{this.woodCompare._woodSelected(e,t,this._selectWood$[e][t]),this._refreshShips(e)}).selectpicker({title:"Wood "+t,width:"150px"})})}initFromClipboard(e){const t=(e,t)=>{t&&e.val(t),e.selectpicker("render")},s=e=>{let s=0;this._columns.some(a=>!this._shipData.find(t=>t.id===e[s])&&(this._shipIds[a]=e[s],s+=1,t(this._selectShip$[a],this._shipIds[a]),"Base"===a&&"ship-journey"!==this._baseId&&this._enableCompareSelects(),this.woodCompare.enableSelects(a),this._setupModulesSelect(a),e[s]?["frame","trim"].forEach(i=>{t(this._selectWood$[a][i],e[s]),s+=1,this.woodCompare._woodSelected(a,i,this._selectWood$[a][i])}):s+=2,this._refreshShips(a),s>=e.length))},a=()=>{this._columns.forEach((s,a)=>{let i=!1;[...this._moduleTypes].forEach((r,o)=>{if(e.has(""+a+o)){const h=n.v.decode(e.get(""+a+o));this._selectedUpgradeIdsPerType[s]||(this._selectedUpgradeIdsPerType[s]={}),this._selectedUpgradeIdsList[s]||(this._selectedUpgradeIdsList[s]=[]),this._selectedUpgradeIdsPerType[s][r]=h.map(Number),t(this._selectModule$[s][r],this._selectedUpgradeIdsPerType[s][r]),this._selectedUpgradeIdsList[s]=this._selectedUpgradeIdsList[s].concat(this._selectedUpgradeIdsPerType[s][r]),i=!0}}),i&&this._refreshShips(s)})},i=n.v.decode(e.get("cmp"));i.length&&(this._shipCompareSelected(),i.length>3&&this._enableCompareSelects(),s(i),a())}_getShipSelectId(e){return this._baseId+"-"+e+"-select"}_getWoodSelectId(e,t){return this._woodId+"-"+e+"-"+t+"-select"}_getModuleSelectId(e,t){return this._moduleId+"-"+e.replace(/\s/,"")+"-"+t+"-select"}get woodCompare(){return this._woodCompare}_setSelectedShip(e,t){this._selectedShips[e]=t}get selectedShips(){return this._selectedShips}get minSpeed(){return this._minSpeed}get maxSpeed(){return this._maxSpeed}get colorScale(){return this._colorScale}set svgWidth(e){this._svgWidth=e}get svgWidth(){return this._svgWidth}set svgHeight(e){this._svgHeight=e}get svgHeight(){return this._svgHeight}set outerRadius(e){this._outerRadius=e}get outerRadius(){return this._outerRadius}set innerRadius(e){this._innerRadius=e}get innerRadius(){return this._innerRadius}set radiusScaleAbsolute(e){this._radiusScaleAbsolute=e}get radiusScaleAbsolute(){return this._radiusScaleAbsolute}}}).call(this,s("xeH2"))},pFgi:function(e,t,s){"use strict";(function(e){s.d(t,"a",function(){return c});s("Se8w"),s("/YXa"),s("bEJU"),s("ZEAQ"),s("SgDD"),s("U00V");var a=s("/Cyf"),i=s("nUlG"),r=s("f4w0"),o=s("0lY5"),h=s("Av7d");class p{constructor(e,t){this._id=e,this._woodCompare=t,this._select="#"+this._woodCompare._baseFunction+"-"+this._id,this._setupMainDiv(),this._g=Object(i.select)(this._select).select("g")}_setupMainDiv(){Object(i.select)(this._select+" div").remove(),Object(i.select)(this._select).append("div")}}class d extends p{constructor(e,t,s){super(e,s),this._woodData=t,this._woodCompare=s,this._printText()}_getProperty(e,t){const s=this._woodData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getPropertySum(e){const t=this._getProperty(e,"frame"),s=this._getProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getText(e){let t='<table class="table table-sm table-striped small mt-4"><thead>';return t+="<tr>",t+="<tr><th><em>Property</em></th><th><em>Change</em></th></tr></thead><tbody>",e.properties.forEach((e,s)=>{if(t+="<tr><td>"+s+"</td><td>"+(e.isPercentage?Object(o.r)(e.amount/100):Object(o.o)(e.amount)),t+='<span class="rate">',e.amount>0){const a=e.amount/this._woodCompare._minMaxProperty.get(s).max*50;t+='<span class="bar neutral" style="width:50%;"></span>',t+='<span class="bar pos diff" style="width:'+a+'%;"></span>'}else if(e.amount<0){const a=e.amount/this._woodCompare._minMaxProperty.get(s).min*50;t+='<span class="bar neutral" style="width:'+(50-a)+'%;"></span>',t+='<span class="bar neg diff" style="width:'+a+'%;"></span>'}else t+='<span class="bar neutral"></span>';t+="</span></td></tr>"}),t+="</tbody></table>"}_printText(){const t={frame:this._woodData.frame.id,trim:this._woodData.trim.id};t.properties=new Map,this._woodCompare.propertyNames.forEach(e=>{const s=this._getPropertySum(e);t.properties.set(e,{amount:s.amount,isPercentage:s.isPercentage})}),e(""+this._select).find("div").append(this._getText(t))}}class n extends p{constructor(e,t,s,a){super(e,a),this._baseData=t,this._compareData=s,this._woodCompare=a,this._printTextComparison()}_getBaseProperty(e,t){const s=this._baseData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getBasePropertySum(e){const t=this._getBaseProperty(e,"frame"),s=this._getBaseProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:s.isPercentage}}_getCompareProperty(e,t){const s=this._compareData[t].properties.find(t=>t.modifier===e);let a=0,i=!1;return s&&s.amount&&(a=s.amount,i=s.isPercentage),{amount:a,isPercentage:i}}_getComparePropertySum(e){const t=this._getCompareProperty(e,"frame"),s=this._getCompareProperty(e,"trim");return{amount:t.amount+s.amount,isPercentage:t.isPercentage&&s.isPercentage}}_getText(e){let t=0,s=0,a=0,i="",r='<table class="table table-sm table-striped small wood mt-4"><thead>';return r+="<tr>",r+="<tr><th><em>Property</em></th><th><em>Change</em></th></tr></thead><tbody>",e.properties.forEach((e,h)=>{r+="<tr><td>"+h+"</td><td>"+function(e,t,s,a){void 0===a&&(a=1);const i=parseFloat((e-t).toFixed(a));return(s?Object(o.r)(e/100,a):Object(o.o)(e))+' <span class="badge badge-white">'+Object(o.u)(i)+"</span>"}(e.compare,e.base,e.isPercentage),r+='<span class="rate">',e.compare>=0?(e.base>=0?e.compare>e.base?(t=e.base,s=e.compare-e.base,i="pos"):(t=e.compare,s=e.base-e.compare,i="neg"):(t=0,s=e.compare,i="pos"),r+='<span class="bar neutral" style="width:50%;"></span>',r+='<span class="bar pos diff" style="width:'+t/this._woodCompare._minMaxProperty.get(h).max*50+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/this._woodCompare._minMaxProperty.get(h).max*50+'%;"></span>'):e.compare<0?(e.base<0?e.compare>=e.base?(t=e.compare,s=e.base-e.compare,a=-e.base,i="pos"):(t=e.base,s=e.compare-e.base,a=-e.compare,i="neg"):(t=0,s=e.compare,a=-e.compare,i="neg"),r+='<span class="bar neutral" style="width:'+(50+a/this._woodCompare._minMaxProperty.get(h).min*50)+'%;"></span>',r+='<span class="bar '+i+'" style="width:'+s/this._woodCompare._minMaxProperty.get(h).min*50+'%;"></span>',r+='<span class="bar neg diff" style="width:'+t/this._woodCompare._minMaxProperty.get(h).min*50+'%;"></span>'):r+='<span class="bar neutral"></span>',r+="</span></td></tr>"}),r+="</tbody></table>"}_printTextComparison(){const t={frame:this._compareData.frame.name,trim:this._compareData.trim.name};t.properties=new Map,this._woodCompare.propertyNames.forEach(e=>{const s=this._getBasePropertySum(e),a=this._getComparePropertySum(e);t.properties.set(e,{base:s.amount,compare:a.amount,isPercentage:s.isPercentage})}),e(""+this._select).find("div").append(this._getText(t))}}class c{constructor(e,t){this._woodData=e,this._baseFunction=t,this._baseName="Compare woods",this._baseId=this._baseFunction+"-compare",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId;const s=(e,t)=>this._woodData[e].find(e=>e.name===t).id;"wood"===this._baseFunction?(this._defaultWood={frame:s("frame","Fir"),trim:s("trim","Crew Space")},this._columnsCompare=["C1","C2","C3"]):"wood-journey"===this._baseFunction?(this._defaultWood={frame:s("frame","Oak"),trim:s("trim","Oak")},this._columnsCompare=[]):(this._defaultWood={frame:s("frame","Oak"),trim:s("trim","Oak")},this._columnsCompare=["C1","C2"]),this._columns=this._columnsCompare.slice(),this._columns.unshift("Base"),this._woodsSelected=[],this._instances=[],this.propertyNames=new Set([...this._woodData.frame.map(e=>e.properties.map(e=>e.modifier)).flat(),...this._woodData.trim.map(e=>e.properties.map(e=>e.modifier)).flat()].sort()),this._options={},this._minMaxProperty=new Map,this._setupListener()}_setupListener(){e("#"+this._buttonId).on("click",e=>{Object(r.b)("Tools",this._baseName),e.stopPropagation(),this._woodCompareSelected()})}_woodCompareSelected(){document.getElementById(this._modalId)||this._initModal(),e("#"+this._modalId).modal("show")}_setupData(){this._frameSelectData=this._woodData.frame.sort(Object(o.H)(["name"])),this._trimSelectData=this._woodData.trim.sort(Object(o.H)(["name"])),this._setOption(this._frameSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>"),this._trimSelectData.map(e=>'<option value="'+e.id+'">'+e.name+"</option>")),this.propertyNames.forEach(e=>{const t=[...this._woodData.frame.map(t=>t.properties.filter(t=>t.modifier===e).map(e=>e.amount)[0])],s=[...this._woodData.trim.map(t=>t.properties.filter(t=>t.modifier===e).map(e=>e.amount)[0])],i=Object(a.f)(t)||0,r=Object(a.e)(t)||0,o=Object(a.f)(s)||0,h=Object(a.e)(s)||0;this._addMinMaxProperty(e,{min:i+o>=0?0:i+o,max:r+h})})}_injectModal(){Object(h.z)(this._modalId,this._baseName);const e=Object(i.select)("#"+this._modalId+" .modal-body").append("div").attr("class","container-fluid").append("div").attr("class","row wood");this._columns.forEach(t=>{const s=e.append("div").attr("class","col-md-3 ml-auto pt-2 "+("Base"===t?"column-base":"column-comp"));["frame","trim"].forEach(e=>{const a=this._baseFunction+"-"+e+"-"+t+"-select";s.append("label").attr("for",a),s.append("select").attr("name",a).attr("id",a).attr("class","selectpicker")}),s.append("div").attr("id",this._baseFunction+"-"+t)})}_initModal(){this._setupData(),this._injectModal(),this._columns.forEach(t=>{["frame","trim"].forEach(s=>{const a=e("#"+this._baseFunction+"-"+s+"-"+t+"-select");this._setupWoodSelects(t,s,a),this._setupSelectListener(t,s,a)})})}_setWoodsSelected(e,t,s){this._woodsSelected[e]||(this._woodsSelected[e]={}),this._woodsSelected[e][t]=s}_setupWoodSelects(e,t,s){this._setWoodsSelected(e,t,this._defaultWood[t]),s.append(this._options[t]),("wood"!==this._baseFunction||"Base"!==e&&"wood"===this._baseFunction)&&s.attr("disabled","disabled")}_setOtherSelect(t,s){const a="frame"===s?"trim":"frame";this._woodsSelected[t][a]===this._defaultWood[a]&&e("#"+this._baseFunction+"-"+a+"-"+t+"-select").val(this._defaultWood[a]).selectpicker("refresh")}enableSelects(t){["frame","trim"].forEach(s=>{e("#"+this._baseFunction+"-"+s+"-"+t+"-select").removeAttr("disabled").selectpicker("refresh")})}_woodSelected(e,t,s){const a=Number(s.val());this._setWoodsSelected(e,t,a),this._setOtherSelect(e,t),"Base"===e?(this._addInstance(e,new d("Base",this._getWoodData("Base"),this)),this._columnsCompare.forEach(e=>{"wood"===this._baseFunction&&this.enableSelects(e),this._instances[e]&&this._addInstance(e,new n(e,this._getWoodData("Base"),this._getWoodData(e),this))})):this._addInstance(e,new n(e,this._getWoodData("Base"),this._getWoodData(e),this))}_setupSelectListener(e,t,s){s.on("change",()=>this._woodSelected(e,t,s)).selectpicker({title:"Select "+t})}_getWoodTypeData(e,t){return this._woodData[e].find(e=>e.id===t)}_getWoodData(e){return{frame:this._getWoodTypeData("frame",this._woodsSelected[e].frame),trim:this._getWoodTypeData("trim",this._woodsSelected[e].trim)}}_addMinMaxProperty(e,t){this._minMaxProperty.set(e,t)}_setOption(e,t){this._options.frame=e,this._options.trim=t}_addInstance(e,t){this._instances[e]=t}}}).call(this,s("xeH2"))}}]);