/*! For license information please see map.d9536c8c822c0d7bd88b.mjs.LICENSE.txt */
(self.webpackChunkna_map=self.webpackChunkna_map||[]).push([[842],{2810:(t,e,i)=>{i.r(e),i.d(e,{NAMap:()=>Ts});i(6801),i(7424),i(300);var s=i(4017),a=i(3641),o=i(8507),r=i(2855),n=i(9022),l=i(393),d=i(9949),h=i(1198),p=i(3389),c=i(4194),u=i(604),_=i(289),m=i(7015);function g(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function v(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var w=new WeakMap,f=new WeakMap,b=new WeakMap,y=new WeakMap,S=new WeakMap,k=new WeakMap,x=new WeakMap,D=new WeakMap,M=new WeakMap,I=new WeakMap,$=new WeakMap,T=new WeakMap,P=new WeakMap,C=new WeakMap,L=new WeakMap,N=new WeakMap,W=new WeakMap,j=new WeakMap,A=new WeakMap;class Z{constructor(t){w.set(this,{writable:!0,value:void 0}),f.set(this,{writable:!0,value:!1}),b.set(this,{writable:!0,value:void 0}),y.set(this,{writable:!0,value:void 0}),S.set(this,{writable:!0,value:void 0}),k.set(this,{writable:!0,value:void 0}),x.set(this,{writable:!0,value:void 0}),D.set(this,{writable:!0,value:void 0}),M.set(this,{writable:!0,value:void 0}),I.set(this,{writable:!0,value:void 0}),$.set(this,{writable:!0,value:void 0}),T.set(this,{writable:!0,value:void 0}),P.set(this,{writable:!0,value:void 0}),C.set(this,{writable:!0,value:void 0}),L.set(this,{writable:!0,value:void 0}),N.set(this,{writable:!0,value:void 0}),W.set(this,{writable:!0,value:void 0}),j.set(this,{writable:!0,value:void 0}),A.set(this,{writable:!0,value:void 0}),v(this,b,t),v(this,w,"on"===g(this,b).showGrid),v(this,y,g(this,b).coord.min),v(this,S,g(this,b).coord.max),v(this,k,g(this,b).height),v(this,x,g(this,b).width),v(this,D,g(this,b).rem),v(this,M,g(this,b).xGridBackgroundHeight),v(this,I,g(this,b).yGridBackgroundWidth)}_setupSvg(){this._setupScale(),this._setupAxis()}_setupScale(){v(this,$,(0,_.Z)().clamp(!0).domain([(0,l.IK)(g(this,y),g(this,y)),(0,l.IK)(g(this,S),g(this,S))]).range([g(this,y),g(this,S)])),v(this,T,(0,_.Z)().clamp(!0).domain([(0,l.pw)(g(this,y),g(this,y)),(0,l.pw)(g(this,S),g(this,S))]).range([g(this,y),g(this,S)]))}_setupAxis(){const t=this._getTicks(65);v(this,P,(0,u.LL)(g(this,$)).tickFormat((t=>(0,m.Hu)(t))).tickValues(t).tickSize(g(this,S))),v(this,C,(0,u.Kh)(g(this,T)).tickFormat((t=>(0,m.Hu)(t))).tickValues(t).tickSize(g(this,S)));const e=(0,s.Z)("#map");v(this,N,e.insert("g","g.pb").attr("class","axis d-none")),v(this,j,g(this,N).append("g")),v(this,W,e.insert("g","g.pb").attr("class","axis d-none")),v(this,A,g(this,W).append("g")),this._displayAxis(void 0),this._setupXAxis(),this._setupYAxis()}_getTicks(t){const e=Math.round((0,l.pw)(g(this,y),g(this,y))),i=Math.round((0,l.pw)(g(this,S),g(this,S))),s=(i-e)/(t-1),a=[];for(let t=s;t<i;t+=s)a.push(Math.round(t));a.push(i);const o=a.slice(0).reverse().map((t=>-t));return o.push(0),[...o,...a]}_setupXAxis(){g(this,j).selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),g(this,j).attr("text-anchor","end").attr("fill",null).attr("font-family",null)}_setupYAxis(){g(this,A).attr("text-anchor","end").attr("fill",null).attr("font-family",null),g(this,A).selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")}_displayAxis(t){const e=t?t.k:1,i=(0,l.qY)(g(this,D)/e),s=(0,l.qY)(1/e),a=t?t.y:0,o=a/e<g(this,x)?a/e:0,r=-g(this,S)-o,n=t?t.x:0,d=n/e<g(this,k)?n/e:0,h=-g(this,S)-d;g(this,j).attr("font-size",i).attr("stroke-width",s).call(g(this,P).tickPadding(r)),g(this,A).attr("font-size",i).attr("stroke-width",s).call(g(this,C).tickPadding(h))}get show(){return g(this,w)}set show(t){v(this,w,t)}get zoomLevel(){return g(this,L)}set zoomLevel(t){v(this,L,t)}update(){let t=!1;g(this,w)&&"initial"!==this.zoomLevel&&(t=!0),t&&this.testForInitialisation(),g(this,f)&&this.gridToggle(t)}transform(t){g(this,w)&&(this.testForInitialisation(),this._displayAxis(t))}gridToggle(t){g(this,b).gridOverlay.classList.toggle("overlay-grid",t),g(this,b).gridOverlay.classList.toggle("overlay-no-grid",!t),g(this,N).classed("d-none",!t),g(this,W).classed("d-none",!t)}testForInitialisation(){g(this,f)||(this._setupSvg(),v(this,f,!0))}}var B=i(1460);function z(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function F(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function R(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var E=new WeakMap,G=new WeakMap,q=new WeakMap,H=new WeakMap,V=new WeakMap;class O{constructor(t,e){E.set(this,{writable:!0,value:15}),G.set(this,{writable:!0,value:12}),z(this,"showPB",void 0),q.set(this,{writable:!0,value:void 0}),H.set(this,{writable:!0,value:{}}),V.set(this,{writable:!0,value:{}}),z(this,"_ports",void 0),z(this,"_showId",void 0),z(this,"_showValues",void 0),z(this,"_showCookie",void 0),z(this,"_showRadios",void 0),z(this,"_isDataLoaded",void 0),z(this,"_pbZonesDefault",void 0),z(this,"_defencesFiltered",void 0),z(this,"_pbZonesFiltered",void 0),z(this,"_raidZonesFiltered",void 0),z(this,"_g",void 0),this._ports=t,R(this,q,B.c.find((t=>t.id===e)).type),this._showId="show-zones",this._showValues=[{id:"pb-all",label:"All ports"},{id:"pb-single",label:"Single port"},{id:"raid-all",label:"All raid"},{id:"raid-single",label:"Single raid"},{id:"off",label:"Off"}],this._setupRadios(),this._showCookie=new p.Z({id:this._showId,values:this._showValues.map((t=>t.id))}),this._showRadios=new c.Z(this._showId,this._showValues.map((t=>t.id))),this.showPB=this._getShowPBSetting(),this._isDataLoaded=!1,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=(0,s.Z)("#map").insert("g","#ports").attr("class","pb")}_setupRadios(){const t=(0,s.Z)("#show-zones");for(const e of this._showValues){const i=t.append("div").attr("class","custom-control custom-radio custom-control-inline");i.append("input").attr("type","radio").attr("class","custom-control-input").attr("name","show-zones").attr("id",`show-zones-${e.id}`).attr("value",e.id),i.append("label").attr("type","radio").attr("class","custom-control-label").attr("for",`show-zones-${e.id}`).text(e.label)}}async _loadData(){this._pbZonesDefault=(await i.e(268).then(i.t.bind(i,4303,19))).default}_setupListener(){document.querySelector(`#${this._showId}`)?.addEventListener("change",(t=>{this._showPBZonesSelected(),t.preventDefault()}))}_getShowPBSetting(){const t=this._showCookie.get();return this._showRadios.set(t),t}_refreshPBZones(){this.refresh(),this._ports.updateTexts()}_showPBZonesSelected(){this.showPB=this._showRadios.get(),this._showCookie.set(this.showPB),this._refreshPBZones()}_update(){this._g.selectAll("g.pb-zones").data(this._pbZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","pb-zones");return e.append("path").attr("class","pb-join-circle").attr("d",(t=>(0,h.GZ)(t.joinCircle[0],t.joinCircle[1],28)+(0,h.GZ)(t.joinCircle[0],t.joinCircle[1],14))),e.append("path").attr("class","pb-circle").attr("d",(t=>t.pbCircles.map((t=>(0,h.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","pb-text pb-circle-text").attr("x",(t=>t.pbCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.pbCircles.map((t=>t[1])).join(","))).text((t=>t.pbCircles.map(((t,e)=>String.fromCharCode(65+e))).join(""))),"PVP"===F(this,q)&&(e.append("path").attr("class","raid-point").attr("d",(t=>t.spawnPoints.map((t=>(0,h.GZ)(t[0],t[1],3.5))).join(""))),e.append("text").attr("class","pb-text raid-point-text").attr("x",(t=>t.spawnPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.spawnPoints.map((t=>t[1])).join(","))).text((t=>t.spawnPoints.map(((t,e)=>String.fromCharCode(88+e))).join("")))),e}));this._g.selectAll("g.defence").data(this._defencesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","defence");return e.selectAll("path.tower-range").data((t=>t.towers)).join((t=>t.append("path").attr("class","tower-range").attr("d",(t=>(0,h.GZ)(t[0],t[1],F(this,G)))))),e.selectAll("path.fort-range").data((t=>t.forts)).join((t=>t.append("path").attr("class","fort-range").attr("d",(t=>(0,h.GZ)(t[0],t[1],F(this,E)))))),e.append("path").attr("class","fort").attr("d",(t=>t.forts.map((t=>(0,h.yb)(t[0],t[1],3))).join(""))),e.append("text").attr("class","pb-text pb-fort-text").attr("x",(t=>t.forts.map((t=>t[0])).join(","))).attr("y",(t=>t.forts.map((t=>t[1])).join(","))).text((t=>t.forts.map(((t,e)=>`${e+1}`)).join(""))),e.append("path").attr("class","tower").attr("d",(t=>t.towers.map((t=>(0,h.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","pb-text pb-tower-text").attr("x",(t=>t.towers.map((t=>t[0])).join(","))).attr("y",(t=>t.towers.map((t=>t[1])).join(","))).text((t=>t.towers.map(((t,e)=>`${e+1}`)).join(""))),e})),this._g.selectAll("g.raid-zones").data(this._raidZonesFiltered,(t=>String(t.id))).join((t=>{const e=t.append("g").attr("class","raid-zones");return e.append("path").attr("class","raid-join-circle").attr("d",(t=>(0,h.GZ)(t.joinCircle[0],t.joinCircle[1],35))),e.append("path").attr("class","raid-circle").attr("d",(t=>t.raidCircles.map((t=>(0,h.GZ)(t[0],t[1],4.5))).join(""))),e.append("text").attr("class","pb-text raid-circle-text").attr("x",(t=>t.raidCircles.map((t=>t[0])).join(","))).attr("y",(t=>t.raidCircles.map((t=>t[1])).join(","))).text((t=>t.raidCircles.map(((t,e)=>String.fromCharCode(65+e))).join(""))),e.append("path").attr("class","raid-point").attr("d",(t=>t.raidPoints.map((t=>(0,h.GZ)(t[0],t[1],1.5))).join(""))),e.append("text").attr("class","pb-text raid-point-text").attr("x",(t=>t.raidPoints.map((t=>t[0])).join(","))).attr("y",(t=>t.raidPoints.map((t=>t[1])).join(","))).text((t=>t.raidPoints.map(((t,e)=>String.fromCharCode(49+e))).join(""))),e}))}_isPortIn(t){return"pb-all"===this.showPB||"raid-all"===this.showPB||("pb-single"===this.showPB||"raid-single"===this.showPB)&&Number(t.id)===this._ports.currentPort.id}_setData(){"pbZone"===this._ports.zoomLevel&&"off"!==this.showPB?this._isDataLoaded?this._filterVisible():this._loadData().then((()=>{this._isDataLoaded=!0,this._filterVisible()})):(this._defencesFiltered=[],this._pbZonesFiltered=[],this._raidZonesFiltered=[])}_filterVisible(){const t=this._pbZonesDefault.filter((t=>t.position[0]>=F(this,H)[0]&&t.position[0]<=F(this,V)[0]&&t.position[1]>=F(this,H)[1]&&t.position[1]<=F(this,V)[1])).filter((t=>this._isPortIn(t)));this._defencesFiltered=t.map((t=>({id:t.id,forts:t.forts,towers:t.towers}))),"pb-all"===this.showPB||"pb-single"===this.showPB?(this._pbZonesFiltered=t.map((t=>({id:t.id,pbCircles:t.pbCircles,joinCircle:t.joinCircle,spawnPoints:t.spawnPoints}))),this._raidZonesFiltered=[]):(this._pbZonesFiltered=[],this._raidZonesFiltered=t.map((t=>({id:t.id,joinCircle:t.joinCircle,raidCircles:t.raidCircles,raidPoints:t.raidPoints}))))}setBounds(t){R(this,H,t[0]),R(this,V,t[1])}refresh(){this._setData(),this._update()}}i(3824);var Y=i(7622),J=i(8823),X=i(155),K=i(6301),U=i(7603),Q=i(5619),tt=i(6400),et=i(7484),it=i.n(et),st=(i(9517),i(285)),at=i.n(st),ot=i(4110),rt=i.n(ot),nt=i(178),lt=i.n(nt),dt=i(2157),ht=i(4738),pt=i(5923),ct=i(4332),ut=i(9313),_t=i.n(ut),mt=i(3609);function gt(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function vt(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function wt(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}it().extend(at()),it().extend(rt()),it().extend(lt()),it().locale("en-gb");const ft=Q.Z.bind(tt.h);var bt=new WeakMap,yt=new WeakMap,St=new WeakMap,kt=new WeakMap,xt=new WeakMap,Dt=new WeakMap,Mt=new WeakMap,It=new WeakMap,$t=new WeakMap,Tt=new WeakMap,Pt=new WeakMap,Ct=new WeakMap,Lt=new WeakMap,Nt=new WeakMap,Wt=new WeakMap,jt=new WeakMap,At=new WeakMap,Zt=new WeakMap,Bt=new WeakMap,zt=new WeakMap,Ft=new WeakMap,Rt=new WeakMap,Et=new WeakMap,Gt=new WeakMap,qt=new WeakMap,Ht=new WeakMap,Vt=new WeakMap,Ot=new WeakMap,Yt=new WeakMap,Jt=new WeakMap,Xt=new WeakMap,Kt=new WeakMap,Ut=new WeakMap,Qt=new WeakMap,te=new WeakMap,ee=new WeakMap,ie=new WeakMap,se=new WeakMap,ae=new WeakMap,oe=new WeakMap,re=new WeakMap,ne=new WeakMap,le=new WeakMap,de=new WeakMap,he=new WeakMap,pe=new WeakMap,ce=new WeakMap,ue=new WeakMap,_e=new WeakMap;class me{constructor(t){this.map=t,gt(this,"circleType",""),gt(this,"currentPort",void 0),gt(this,"portData",void 0),gt(this,"portDataDefault",void 0),gt(this,"showCurrentGood",void 0),gt(this,"showRadius",void 0),gt(this,"showTradePortPartners",void 0),gt(this,"tradeItem",void 0),gt(this,"tradePortId",void 0),gt(this,"zoomLevel","initial"),bt.set(this,{writable:!0,value:void 0}),yt.set(this,{writable:!0,value:void 0}),St.set(this,{writable:!0,value:void 0}),kt.set(this,{writable:!0,value:void 0}),xt.set(this,{writable:!0,value:void 0}),Dt.set(this,{writable:!0,value:void 0}),Mt.set(this,{writable:!0,value:void 0}),It.set(this,{writable:!0,value:void 0}),$t.set(this,{writable:!0,value:void 0}),Tt.set(this,{writable:!0,value:void 0}),Pt.set(this,{writable:!0,value:void 0}),Ct.set(this,{writable:!0,value:void 0}),Lt.set(this,{writable:!0,value:void 0}),Nt.set(this,{writable:!0,value:void 0}),Wt.set(this,{writable:!0,value:void 0}),jt.set(this,{writable:!0,value:void 0}),At.set(this,{writable:!0,value:{}}),Zt.set(this,{writable:!0,value:void 0}),Bt.set(this,{writable:!0,value:void 0}),zt.set(this,{writable:!0,value:void 0}),Ft.set(this,{writable:!0,value:void 0}),Rt.set(this,{writable:!0,value:void 0}),Et.set(this,{writable:!0,value:void 0}),Gt.set(this,{writable:!0,value:void 0}),qt.set(this,{writable:!0,value:void 0}),Ht.set(this,{writable:!0,value:void 0}),Vt.set(this,{writable:!0,value:void 0}),Ot.set(this,{writable:!0,value:void 0}),Yt.set(this,{writable:!0,value:void 0}),Jt.set(this,{writable:!0,value:void 0}),Xt.set(this,{writable:!0,value:void 0}),Kt.set(this,{writable:!0,value:void 0}),Ut.set(this,{writable:!0,value:void 0}),Qt.set(this,{writable:!0,value:void 0}),te.set(this,{writable:!0,value:0}),ee.set(this,{writable:!0,value:{}}),ie.set(this,{writable:!0,value:"show-radius"}),se.set(this,{writable:!0,value:l.w7}),ae.set(this,{writable:!0,value:void 0}),oe.set(this,{writable:!0,value:void 0}),re.set(this,{writable:!0,value:l.jo}),ne.set(this,{writable:!0,value:48}),le.set(this,{writable:!0,value:l.L9}),de.set(this,{writable:!0,value:4*l.L9}),he.set(this,{writable:!0,value:void 0}),pe.set(this,{writable:!0,value:void 0}),ce.set(this,{writable:!0,value:void 0}),ue.set(this,{writable:!0,value:void 0}),_e.set(this,{writable:!0,value:"all"}),wt(this,ue,this.map.serverName),wt(this,he,this.map.minMapScale),wt(this,te,vt(this,he)),wt(this,oe,this.map.f11),this.showCurrentGood=!1,this.showTradePortPartners=!1,this.currentPort={id:366,coord:{x:4396,y:2494}},wt(this,pe,["attack","county","points","position","tax","net","off"]),wt(this,ae,new p.Z({id:vt(this,ie),values:vt(this,pe)})),wt(this,ce,new c.Z(vt(this,ie),vt(this,pe))),this.showRadius=this._getShowRadiusSetting()}static _hideDetails(){mt(this).tooltip("dispose")}async init(){await this._loadAndSetupData()}_setupData(t){this.portDataDefault=t.ports.map((e=>{const i=t.server.find((t=>t.id===e.id))??{},s=t.pb.find((t=>t.id===e.id))??{};return{...e,...i,...s}})),this.portData=this.portDataDefault,this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupPatrolZones(),this._setupSummary(),this._setupFlags()}async _loadData(){const t=[{fileName:`${vt(this,ue)}-ports.json`,name:"server"},{fileName:`${vt(this,ue)}-pb.json`,name:"pb"}],e=await(0,n.qP)(`${vt(this,ue)}-items.json`);this.tradeItem=new Map(e.map((t=>[t.id,t])));const s={};return s.ports=(await i.e(462).then(i.t.bind(i,7640,19))).default,await(0,n.EZ)(t,s),s}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}_setupScales(){wt(this,Ht,(0,_.Z)()),wt(this,bt,(0,_.Z)().domain([0,1])),wt(this,St,(0,_.Z)().domain([0,1]).range([n.Q0,n.gc]).interpolate(K.Z)),wt(this,yt,(0,U.Z)().range(n.q4)),wt(this,Et,(0,Y.Z)(this.portData,(t=>t.taxIncome))??0),wt(this,zt,(0,J.Z)(this.portData,(t=>t.taxIncome))??0),wt(this,Dt,(0,_.Z)().domain([vt(this,Et),vt(this,zt)]).range([n.Q0,n.fy]).interpolate(K.Z)),wt(this,Ft,(0,Y.Z)(this.portData,(t=>t.netIncome))??0),wt(this,Zt,(0,J.Z)(this.portData,(t=>t.netIncome))??0),wt(this,kt,(0,_.Z)().domain([vt(this,Ft),0,vt(this,Zt)]).range([n.gc,n.Q0,n.fy]).interpolate(K.Z)),wt(this,Rt,(0,Y.Z)(this.portData,(t=>t.portPoints))??0),wt(this,Bt,(0,J.Z)(this.portData,(t=>t.portPoints))??0),wt(this,xt,(0,_.Z)().domain([vt(this,Rt),vt(this,Bt)]).range([n.Q0,n.fy]).interpolate(K.Z))}_setupListener(){document.querySelector("#show-radius")?.addEventListener("change",(()=>{this._showRadiusSelected()}))}_getShowRadiusSetting(){let t=vt(this,ae).get();return"position"===t&&([t]=vt(this,pe),vt(this,ae).set(t)),vt(this,ce).set(t),t}_showRadiusSelected(){this.showRadius=vt(this,ce).get(),vt(this,ae).set(this.showRadius),this.update()}_setupSvg(){wt(this,Ct,(0,s.Z)("#map").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports")),wt(this,Wt,vt(this,Ct).append("g").attr("class","region")),wt(this,Tt,vt(this,Ct).append("g").attr("class","county")),wt(this,Lt,vt(this,Ct).append("g").attr("data-ui-component","port-circles")),wt(this,Pt,vt(this,Ct).append("g").attr("class","port")),wt(this,jt,vt(this,Ct).append("g").attr("class","port-names")),wt(this,Nt,vt(this,Ct).append("g").attr("class","pz"))}_setupCounties(){wt(this,Mt,[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-Français",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Ciudad de Cuba",centroid:[4500,3495],angle:0},{name:"Cumaná",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kidd’s Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"Mérida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Øer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}]);const t={x:this.map.coord.max/2,y:this.map.coord.max/2};wt(this,Mt,vt(this,Mt).sort(((e,i)=>{const s={x:e.centroid[0],y:e.centroid[1]},a={x:i.centroid[0],y:i.centroid[1]};return(0,l.UI)(t,s)-(0,l.UI)(t,a)}))),vt(this,yt).domain(vt(this,Mt).map((t=>t.name)))}_setupRegions(){wt(this,Ut,[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}])}_setupPatrolZones(){const t=[{name:"Hispaniola",coordinates:[4900,3635],radius:150,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"Tumbado",coordinates:[2400,3050],radius:150,shallow:!1},{name:"Léogane",coordinates:[5130,3770],radius:90,shallow:!1,shipClass:{min:7,max:4}},{name:"Tortuga",coordinates:[5435,3420],radius:100,shallow:!1,shipClass:{min:7,max:5}},{name:"Antilles",coordinates:[7555,4470],radius:140,shallow:!1},{name:"Nassau",coordinates:[4360,2350],radius:108,shallow:!0},{name:"La Mona",coordinates:[6180,4100],radius:170,shallow:!1,shipClass:{min:7,max:4}}],e=it().utc("2021-01-17").hour(10),i=it().utc().diff(e,"day")%t.length,{radius:s,name:a,shallow:o,shipClass:r}=t[i],n=1.6*s,[d,h]=t[i].coordinates,p=Math.round(s/1.2),c=Math.round(vt(this,re)*s/100);vt(this,Nt).append("circle").attr("cx",d).attr("cy",h).attr("r",s).attr("opacity",.7),vt(this,Nt).append("image").attr("height",n).attr("width",n).attr("x",d).attr("y",h).attr("transform",`translate(${Math.floor(-n/2)},${Math.floor(-n/1.6)})`).attr("xlink:href",_t()).attr("alt","Patrol zone"),vt(this,Nt).append("text").text(a).attr("x",d).attr("y",h).attr("dy",p).attr("font-size",Math.round(1.6*c)),vt(this,Nt).append("text").html(o?"Shallow water ships":(r?`${(0,l.hg)(r.min)} to ${(0,l.hg)(r.max)} rate`:"All")+" ships").attr("x",d).attr("y",h).attr("dy",p-1.6*c).attr("font-size",c)}_setupSummary(){wt(this,$t,(0,s.Z)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary port-summary-no-wind")),wt(this,Ot,vt(this,$t).append("div").attr("class","block")),wt(this,Xt,vt(this,Ot).append("div")),vt(this,Ot).append("div").attr("class","summary-des").html("selected<br>ports"),wt(this,Yt,vt(this,$t).append("div").attr("class","block")),wt(this,Kt,vt(this,Yt).append("div")),vt(this,Yt).append("div").attr("class","summary-des").html("tax<br>income"),wt(this,Vt,vt(this,$t).append("div").attr("class","block")),wt(this,Jt,vt(this,Vt).append("div")),vt(this,Vt).append("div").attr("class","summary-des").html("net<br>income")}_setupFlags(){wt(this,Gt,(0,n.wu)());const t=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","pattern");return e.id=t,e.setAttribute("width","133%"),e.setAttribute("height","100%"),e.setAttribute("viewBox",`6 6 ${vt(this,ne)} ${.75*vt(this,ne)}`),e},e=t=>{const e=document.createElementNS("http://www.w3.org/2000/svg","image");return e.setAttribute("width",String(vt(this,ne))),e.setAttribute("height",String(vt(this,ne))),e.setAttribute("href",vt(this,Gt)[t].replace('"',"").replace('"',"")),e},i=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","circle");return t.setAttribute("cx",String(vt(this,ne)/2)),t.setAttribute("cy",String(vt(this,ne)/2)),t.setAttribute("r","16"),t},s=()=>{const t=document.createElementNS("http://www.w3.org/2000/svg","rect");return t.setAttribute("height","480"),t.setAttribute("width","640"),t.setAttribute("fill",n.Om),t.setAttribute("fill-opacity","0.7"),t},a=document.querySelector("#na-svg defs");for(const o of dt.nU.map((t=>t.short))){const r=t(o);r.append(e(o));const n=a.appendChild(r);if("FT"!==o){const t=n.cloneNode(!0);t.id=`${o}c`,t.append(i()),a.append(t)}if("NT"!==o&&"FT"!==o){const t=n.cloneNode(!0);t.id=`${o}a`,t.append(s()),a.append(t);const e=t.cloneNode(!0);e.id=`${o}ca`,e.append(i()),a.append(e)}}}_getPortName(t){return t?this.portDataDefault.find((e=>e.id===t))?.name??"":""}_getText(t){const e=(t,e)=>`${String(t)} ‒ ${String(e)}`,i=(t,i)=>{const s=Number(it().utc().hour(t).local().format("H")),a=Number(it().utc().hour(i).local().format("H"));return ft`${e(t,i)} (${e(s,a)})`},s=(t,e)=>e.profit.profit-t.profit.profit,a=it().utc(t.portBattle),o=it().utc(t.portBattle).local(),r=a===o?"":` (${o.format("H.mm")} local)`,n=it().utc(t.cooldownTime),l=it().utc(t.cooldownTime).local(),d=n===l?"":` (${l.format("H.mm")} local)`,h=t.portBattleStartTime?i((t.portBattleStartTime+10)%24,(t.portBattleStartTime+13)%24):i(11,8),p=a.isAfter(it().utc())?"s":"ed",c=t.portBattle?ft`${(0,pt.HL)(t.attackerClan)} (${t.attackerNation})
              attack${t.portBattle?ft`${p} ${a.fromNow()} at ${a.format("H.mm")}${r}`:ft`s: ${(0,m.T3)(t.attackHostility??0)} hostility`}`:ft``,u={name:t.name,icon:t.nation,availableForAll:t.availableForAll,shallow:t.shallow,county:""===t.county?"":t.county,region:""===t.region?"":t.region,countyCapital:t.countyCapital,capital:!t.capturable&&"FT"!==t.nation,capturer:t.capturer?(0,pt.HL)(t.capturer):ft``,captureTime:t.captured?`${(0,dt.fm)(it().utc(t.captured).fromNow())}`:"",attack:t.attackHostility?c:ft``,isNPCAttacker:"Neutral"===t.attackerNation,pbTimeRange:t.capturable?h:"",brLimit:(0,m.yI)(t.brLimit),portPoints:t.capturable?(0,m.yI)(t.portPoints):"",taxIncome:(0,m.RK)(t.taxIncome),portTax:(0,m.T3)(t.portTax),netIncome:(0,m.RK)(t.netIncome),tradingCompany:t.tradingCompany,laborHoursDiscount:t.laborHoursDiscount,dropsTrading:t.dropsTrading?.map((t=>this.tradeItem.get(t)?.name??"")).sort(ht.I4).join(", ")??"",consumesTrading:t.consumesTrading?.map((t=>this.tradeItem.get(t)?.name??"")).sort(ht.I4).join(", ")??"",producesNonTrading:t.producesNonTrading?.map((t=>this.tradeItem.get(t)?.name??"")).sort(ht.I4).join(", ")??"",dropsNonTrading:t.dropsNonTrading?.map((t=>this.tradeItem.get(t)?.name??"")).sort(ht.I4).join(", ")??"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:ft`${t.goodsToSellInTradePort?.sort(s)?.map(((e,i)=>ft`<span style="white-space: nowrap;">${e.name} (${(0,m.Dw)(e.profit.profit)})</span
                            >${i===t.goodsToSellInTradePort.length-1?ft``:ft`, `}`))}`,goodsToBuyInTradePort:ft`${t.goodsToBuyInTradePort?.sort(s)?.map(((e,i)=>ft`<span style="white-space: nowrap;">${e.name} (${(0,m.Dw)(e.profit.profit)})</span
                            >${i===t.goodsToBuyInTradePort.length-1?ft``:ft`, `}`))}`};return u.dropsTrading.length>0&&u.dropsNonTrading.length>0&&(u.dropsNonTrading+=" ‒ "),t.cooldownTime&&(u.cooldownTime=ft`${n.fromNow()} at <em>approximately</em> ${n.format("H.mm")}${d}`),t.portBonus&&(u.portBonus=t.portBonus),u}_tooltipData(t){const e=t.capital?"flag-icon-border-middle":t.countyCapital?"flag-icon-border-light":"";return ft`
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div class="d-flex align-items-center ">
                    <img
                        alt="${t.icon}"
                        class="flag-icon mr-3 align-self-stretch ${e}"
                        src="${vt(this,Gt)[t.icon].replace('"',"").replace('"',"")}"
                    />

                    <div class="text-left mr-1">
                        <div class="large">${t.name}</div>
                        <div class="caps">${t.county}</div>
                        <div class="caps">${t.region}</div>
                    </div>
                </div>

                ${t.portBonus?ft`<div class="d-flex mr-1">${ft`${ct.y.map((e=>ft`${t?.portBonus?.[e]?ft`<div>
                          <i class="icon icon-light icon-${e} mr-1" aria-hidden="true"></i>
                          <span class="sr-only">${e} bonus </span>
                          <span class="x-large text-lighter align-top mr-1">${t.portBonus[e]}</span>
                      </div>`:ft``}`))}`}</div>`:ft``}

                <div class="d-flex flex-column justify-content-end">
                    <div class="ml-auto">
                        ${t.portPoints?ft`<span class="x-large text-lighter">${t.portPoints}</span>`:ft``}
                    </div>
                    <div class="ml-auto">
                        ${t.laborHoursDiscount?ft`<i class="icon icon-light icon-labour mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Labour hour discount level ${t.laborHoursDiscount}</span>`:ft``}
                        ${t.tradingCompany?ft`<i class="icon icon-light icon-trading mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Trading company level ${t.tradingCompany}</span>`:ft``}
                        ${t.availableForAll?ft`<i class="icon icon-light icon-open mr-1" aria-hidden="true"></i
                                  ><span class="sr-only">Accessible to all</span>`:ft``}
                        ${t.shallow?ft`<i class="icon icon-light icon-shallow" aria-hidden="true"></i
                                  ><span class="sr-only">Shallow</span>`:ft`<i class="icon icon-light icon-deep" aria-hidden="true"></i
                                  ><span class="sr-only">Deep</span>`}
                    </div>
                </div>
            </div>

            ${void 0===t.attack?ft`${t.cooldownTime?ft`<div class="alert alert-success mt-2" role="alert">
                            Port battle cooldown ends ${t.cooldownTime}
                        </div>`:ft``}`:ft`<div class="alert mt-2 ${t.isNPCAttacker?"alert-warning":"alert-danger"}" role="alert">
                      ${t.attack}
                  </div>`}

            <div class="d-flex text-left mb-2">
                ${t.capital||"FT"===t.icon?ft`<div>${t.portTax}<br /><span class="des">Tax rate</span></div>`:ft`
                          <div class="mr-3">
                              ${t.pbTimeRange}<br />
                              <span class="des">Battle timer</span>
                          </div>
                          <div class="mr-3">
                              ${t.brLimit}<br />
                              <span class="des">Rating</span>
                          </div>
                          <div class="mr-3">
                              ${t.capturer}<br />
                              <span class="des">Capturer</span>
                          </div>
                          <div class="mr-5">
                              ${t.captureTime}<br />
                              <span class="des">Capture</span>
                          </div>

                          <div class="ml-auto mr-3">
                              ${t.taxIncome} (${t.portTax})<br />
                              <span class="des">Tax income</span>
                          </div>
                          <div>
                              ${t.netIncome}<br />
                              <span class="des">Net income</span>
                          </div>
                      `}
            </div>

            ${t.producesNonTrading.length>0?ft`<p class="mb-2">
                      <span class="caps">Produces—</span><span class="non-trading">${t.producesNonTrading}</span>
                  </p>`:ft``}
            ${t.dropsTrading.length>0||t.dropsNonTrading.length>0?ft`<p class="mb-2">
                      <span class="caps">Drops—</span>
                      ${t.dropsNonTrading?ft`<span class="non-trading">${t.dropsNonTrading}</span>`:ft``}
                      ${t.dropsTrading}
                  </p> `:ft``}
            ${t.consumesTrading.length>0?ft`<p class="mb-2"><span class="caps">Consumes—</span>${t.consumesTrading}</p>`:ft``}
            ${"tradePorts"===this.showRadius?ft`${void 0===t.goodsToSellInTradePort?.[0]?ft``:ft`<div class="alert alert-success mt-2 mb-2 text-left" role="alert">
                            <span class="caps">Buy here and sell in ${t.tradePort}</span> (net profit)<br />${t.goodsToSellInTradePort}
                        </div>`}
                  ${void 0===t.goodsToBuyInTradePort?.[0]?ft``:ft`<div class="alert alert-danger mt-2 mb-2 text-left" role="alert">
                            <span class="caps">Buy in ${t.tradePort} and sell here</span> (net profit)<br />${t.goodsToBuyInTradePort}
                        </div>`}`:ft``}
        `}_getInventory(t){const e=t=>this.tradeItem.get(t)?.name??"";let i="";const s=t.inventory.filter((t=>t.buyQuantity>0&&t.buyPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,m.yI)(t.buyQuantity)} ${e(t.id)} @ ${(0,m.Pj)(t.buyPrice)}`)).join("<br>"),a=t.inventory.filter((t=>t.sellQuantity>0&&t.sellPrice>0)).sort(((t,i)=>e(t.id).localeCompare(e(i.id)))).map((t=>`${(0,m.yI)(t.sellQuantity)} ${e(t.id)} @ ${(0,m.Pj)(t.sellPrice)}`)).join("<br>");return i+=`<h5 class="caps">${t.name} <span class="small">${t.nation}</span></h5>`,s.length>0&&(i+="<h6>Buy</h6>",i+=s),s.length>0&&a.length>0&&(i+="<p></p>"),a.length>0&&(i+="<h6>Sell</h6>",i+=a),i}_showDetails(t,e){const i=mt(t.currentTarget).tooltip("dispose").tooltip({html:!0,placement:"auto",trigger:"manual",title:"Wait...",sanitize:!1});i.on("inserted.bs.tooltip",(()=>{const t=mt(document.body).find(".tooltip").find(".tooltip-inner")[0];t.textContent="",(0,tt.sY)(this._tooltipData(this._getText(e)),t),i.tooltip("update")})),i.tooltip("show"),this.map.showTrades.show&&("inventory"!==this.map.showTrades.listType&&(this.map.showTrades.listType="inventory"),this.map.showTrades.update(this._getInventory(e)))}_updateIcons(){const t=vt(this,te)<.5?2*vt(this,te):vt(this,te),e=vt(this,se)/t,i=vt(this,qt);vt(this,Pt).selectAll("circle").data(i,(t=>String(t.id))).join((t=>t.append("circle").attr("fill",(t=>{const e=`${t.countyCapital&&t.capturable?"c":""}${t.availableForAll&&"NT"!==t.nation?"a":""}`;return`url(#${t.nation}${e})`})).attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])).on("click",((t,e)=>{this._showDetails(t,e)})).on("mouseleave",me._hideDetails))).attr("r",e)}_getTradePortMarker(t){let e="";return t.id===this.tradePortId?e="here":t.sellInTradePort&&t.buyInTradePort?e="both":t.sellInTradePort?e="pos":t.buyInTradePort&&(e="neg"),e}_getAttackMarker(t){let e="";return t.cooldownTime?e="cooldown":"Neutral"===t.attackerNation&&(e="raider"),e}_getFrontlineMarker(t){let e="";return t.ownPort?e="pos":t.enemyPort&&(e="neg"),e}_updatePortCircles(){const t=vt(this,te)<.5?2*vt(this,te):vt(this,te),e=vt(this,se)/t,i=(0,l.qY)(e*vt(this,le)),s=(0,l.qY)(e*vt(this,de)),a=1e5;let o=vt(this,qt),r=()=>"",n=()=>0,d=()=>"";"tax"===this.showRadius?(o=vt(this,qt).filter((t=>t.capturable&&t.taxIncome>a)),vt(this,Ht).domain([vt(this,Et),vt(this,zt)]).range([i,s]),r=()=>"bubble",d=t=>vt(this,Dt).call(this,t.taxIncome)??"",n=t=>vt(this,Ht).call(this,t.taxIncome)??0):"net"===this.showRadius?(o=vt(this,qt).filter((t=>t.capturable&&Math.abs(t.netIncome)>a)),vt(this,Ht).domain([vt(this,Ft),vt(this,Zt)]).range([i,s]),r=()=>"bubble",d=t=>vt(this,kt).call(this,t.netIncome)??"",n=t=>vt(this,Ht).call(this,Math.abs(t.netIncome))??0):"points"===this.showRadius?(o=vt(this,qt).filter((t=>t.capturable&&t.portPoints>30)),vt(this,Ht).domain([vt(this,Rt),vt(this,Bt)]).range([i,s/2]),r=()=>"bubble",d=t=>vt(this,xt).call(this,t.portPoints)??"",n=t=>vt(this,Ht).call(this,t.portPoints)??0):"position"===this.showRadius?(r=()=>"bubble here",n=t=>t.distance):"attack"===this.showRadius?(o=vt(this,qt).filter((t=>t.attackHostility||t.cooldownTime)),vt(this,bt).range([i,s/1.5]),r=t=>`bubble ${this._getAttackMarker(t)}`,d=t=>"Neutral"===t.attackerNation?"":vt(this,St).call(this,t.attackHostility??0)??"",n=t=>vt(this,bt).call(this,t.attackHostility??(t.cooldownTime?.2:0))??0):"currentGood"===this.circleType?(r=t=>"bubble "+(t.isSource?"pos":"neg"),n=()=>s/2):"county"===this.showRadius?(r=t=>t.capturable?t.countyCapital?"bubble capital":"bubble non-capital":"bubble not-capturable",d=t=>t.capturable?vt(this,yt).call(this,t.county):"",n=t=>t.capturable?s/2:s/3):"tradePorts"===this.showRadius?(r=t=>`bubble ${this._getTradePortMarker(t)}`,n=t=>t.id===this.tradePortId?s:s/2):"frontline"===this.showRadius?(r=t=>`bubble ${this._getFrontlineMarker(t)}`,n=t=>t.ownPort?s/3:s/2,o=o.filter((t=>t.enemyPort??t.ownPort))):"currentGood"===this.showRadius?(r=t=>"bubble "+(t.isSource?"pos":"neg"),n=()=>s/2):"off"===this.showRadius&&(o=[]),vt(this,Lt).selectAll("circle").data(o,(t=>String(t.id))).join((t=>t.append("circle").attr("cx",(t=>t.coordinates[0])).attr("cy",(t=>t.coordinates[1])))).attr("class",(t=>r(t))).attr("r",(t=>n(t))).attr("fill",(t=>d(t)))}_updateTextsX(t,e){return"pbZone"===this.zoomLevel&&("all"===vt(this,_e)||"single"===vt(this,_e)&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos((0,l.Ht)(t.angle))):t.coordinates[0]}_updateTextsY(t,e,i){const s=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+s;const a=t.angle>90&&t.angle<270?i:0;return"all"===vt(this,_e)||"single"===vt(this,_e)&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin((0,l.Ht)(t.angle)))+a:t.coordinates[1]+s}_updateTextsAnchor(t){return"pbZone"===this.zoomLevel&&("all"===vt(this,_e)||"single"===vt(this,_e)&&t.id===this.currentPort.id)?t.angle>0&&t.angle<l.tz?"start":"end":"middle"}updateTexts(){if("initial"===this.zoomLevel)vt(this,jt).classed("d-none",!0);else{const t=(0,l.qY)(vt(this,se)/vt(this,te)),e=(0,l.qY)(vt(this,re)/vt(this,te)),i=vt(this,qt);vt(this,jt).selectAll("text").data(i,(t=>String(t.id))).join((t=>t.append("text").text((t=>t.name)))).attr("x",(e=>this._updateTextsX(e,t))).attr("y",(i=>this._updateTextsY(i,t,e))).attr("text-anchor",(t=>this._updateTextsAnchor(t))),vt(this,jt).attr("font-size",`${e}px`).classed("d-none",!1)}}_updateSummary(){const t=Object.keys(this.portData).length;let e=0,i=0;t&&(e=(0,X.Z)(this.portData,(t=>t.taxIncome)),i=(0,X.Z)(this.portData,(t=>t.netIncome))),vt(this,Xt).text(`${t}`),vt(this,Kt).html(`${(0,m.Dw)(e)}`),vt(this,Jt).html(`${(0,m.Dw)(i)}`)}_updateCounties(){if("portLabel"===this.zoomLevel){const t=vt(this,It);vt(this,Tt).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name))),(t=>t.attr("fill",(t=>"county"===this.showRadius?vt(this,yt).call(this,t.name):"")))),vt(this,Tt).classed("d-none",!1)}else vt(this,Tt).classed("d-none",!0)}_updateRegions(){if("initial"===this.zoomLevel){const t=vt(this,Qt);vt(this,Wt).selectAll("text").data(t,(t=>t.name)).join((t=>t.append("text").attr("transform",(t=>`translate(${t.centroid[0]},${t.centroid[1]})rotate(${t.angle})`)).text((t=>t.name)))),vt(this,Wt).classed("d-none",!1)}else vt(this,Wt).classed("d-none",!0)}_updatePZ(){"pbZone"===this.zoomLevel?vt(this,Nt).classed("d-none",!0):vt(this,Nt).classed("d-none",!1)}update(t){wt(this,te,t??vt(this,te)),this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions(),this._updatePZ()}_filterVisible(){"position"===this.showRadius?wt(this,qt,this.portData):wt(this,qt,this.portData.filter((t=>t.coordinates[0]>=vt(this,At)[0]&&t.coordinates[0]<=vt(this,ee)[0]&&t.coordinates[1]>=vt(this,At)[1]&&t.coordinates[1]<=vt(this,ee)[1]))),wt(this,It,vt(this,Mt).filter((t=>t.centroid[0]>=vt(this,At)[0]&&t.centroid[0]<=vt(this,ee)[0]&&t.centroid[1]>=vt(this,At)[1]&&t.centroid[1]<=vt(this,ee)[1]))),wt(this,Qt,vt(this,Ut).filter((t=>t.centroid[0]>=vt(this,At)[0]&&t.centroid[0]<=vt(this,ee)[0]&&t.centroid[1]>=vt(this,At)[1]&&t.centroid[1]<=vt(this,ee)[1])))}setBounds(t){wt(this,At,t[0]),wt(this,ee,t[1])}_showSummary(){vt(this,$t).classed("hidden",!1)}setShowRadiusSetting(t=vt(this,pe)[0]){this.showRadius=t,vt(this,ce).set(this.showRadius),vt(this,ae).set(this.showRadius)}clearMap(t){this._showSummary(),this.portData=this.portDataDefault,this.circleType="",this.setShowRadiusSetting(),this.update(t)}}i(9872);var ge=i(6607),ve=i.n(ge),we=i(3609);function fe(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}it().extend(at()),it().extend(ve()),it().extend(lt()),it().locale("en-gb");class be{constructor(t,e,i){fe(this,"isInventorySelected",void 0),fe(this,"_dataLoaded",!1),fe(this,"_distances",new Map),fe(this,"_frontlinesData",void 0),fe(this,"_nation",void 0),fe(this,"_ports",void 0),fe(this,"_buyGoodsId",void 0),fe(this,"_buyGoodsSelector",void 0),fe(this,"_frontlineAttackingNationId",void 0),fe(this,"_frontlineAttackingNationSelector",void 0),fe(this,"_frontlineDefendingNationId",void 0),fe(this,"_frontlineDefendingNationSelector",void 0),fe(this,"_inventoryId",void 0),fe(this,"_inventorySelector",void 0),fe(this,"_map",void 0),fe(this,"_numberPorts",void 0),fe(this,"_pbZone",void 0),fe(this,"_portNamesId",void 0),fe(this,"_portNamesSelector",void 0),fe(this,"_propClanId",void 0),fe(this,"_propClanSelector",void 0),fe(this,"_propNationId",void 0),fe(this,"_propNationSelector",void 0),fe(this,"_sellProfit",new dt.y0),this._ports=t,this._pbZone=e,this._map=i,this._numberPorts=this._ports.portData.length,this._frontlineAttackingNationId="frontlines-attacking-nation-select",this._frontlineAttackingNationSelector=document.querySelector(`#${this._frontlineAttackingNationId}`),this._frontlineDefendingNationId="frontlines-defending-nation-select",this._frontlineDefendingNationSelector=document.querySelector(`#${this._frontlineDefendingNationId}`),this._portNamesId="port-names-select",this._portNamesSelector=document.querySelector(`#${this._portNamesId}`),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.querySelector(`#${this._buyGoodsId}`),this._inventoryId="inventory-select",this._inventorySelector=document.querySelector(`#${this._inventoryId}`),this._propNationId="prop-nation-select",this._propNationSelector=document.querySelector(`#${this._propNationId}`),this._propClanId="prop-clan-select",this._propClanSelector=document.querySelector(`#${this._propClanId}`),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}_setupSelects(){this._setupFrontlinesNationSelect(),this._setupNationSelect(),this._setupClanSelect()}_resetOtherSelects(t){for(const e of[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._frontlineAttackingNationSelector,this._frontlineDefendingNationSelector,this._propNationSelector,this._propClanSelector])!e||e===t||e===this._propClanSelector&&t===this._propNationSelector||e===this._propNationSelector&&t===this._propClanSelector||we(e).val("default").selectpicker("refresh")}async _loadData(){if(!this._dataLoaded){this._frontlinesData=await(0,n.qP)(`${this._map.serverName}-frontlines.json`);const t=(await i.e(971).then(i.t.bind(i,7284,19))).default;this._distances=new Map(t.map((([t,e,i])=>[t*this._numberPorts+e,i]))),this._dataLoaded=!0}}_setupListener(){we(this._portNamesSelector).one("show.bs.select",(()=>{this._injectPortSelect()})),this._portNamesSelector?.addEventListener("change",(async t=>{(0,r.KS)("Menu","Trade relations"),await this._loadData(),this._resetOtherSelects(this._portNamesSelector),this._portSelected(),t.preventDefault()})),we(this._buyGoodsSelector).one("show.bs.select",(async()=>{await this._loadData(),this._injectGoodsSelect()})),this._buyGoodsSelector?.addEventListener("change",(t=>{(0,r.KS)("Menu","Goods’ relations"),this._resetOtherSelects(this._buyGoodsSelector),this._goodSelected(),t.preventDefault()})),this._inventorySelector?.addEventListener("change",(t=>{(0,r.KS)("Menu","Inventory"),this._resetOtherSelects(this._inventorySelector),this.inventorySelected(),t.preventDefault()})),this._frontlineAttackingNationSelector?.addEventListener("change",(async t=>{(0,r.KS)("Menu","Frontlines Attack"),await this._loadData(),this._resetOtherSelects(this._frontlineAttackingNationSelector),this._frontlineAttackingNationSelected(),t.preventDefault()})),this._frontlineDefendingNationSelector?.addEventListener("change",(async t=>{(0,r.KS)("Menu","Frontlines Defence"),await this._loadData(),this._resetOtherSelects(this._frontlineDefendingNationSelector),this._frontlineDefendingNationSelected(),t.preventDefault()})),this._propNationSelector?.addEventListener("change",(t=>{this._resetOtherSelects(this._propNationSelector),this._nationSelected(),t.preventDefault()})),this._propClanSelector?.addEventListener("change",(t=>{this._resetOtherSelects(this._propClanSelector),this._clanSelected(),t.preventDefault()})),document.querySelector("#menu-prop-deep")?.addEventListener("click",(()=>{this._depthSelected("deep")})),document.querySelector("#menu-prop-shallow")?.addEventListener("click",(()=>{this._depthSelected("shallow")})),document.querySelector("#menu-prop-all")?.addEventListener("click",(()=>{this._allSelected()})),document.querySelector("#menu-prop-non-capturable")?.addEventListener("click",(()=>{this._nonCapSelected()})),document.querySelector("#menu-prop-today")?.addEventListener("click",(()=>{this._capturedToday()})),document.querySelector("#menu-prop-yesterday")?.addEventListener("click",(()=>{this._capturedYesterday()})),document.querySelector("#menu-prop-this-week")?.addEventListener("click",(()=>{this._capturedThisWeek()})),document.querySelector("#menu-prop-last-week")?.addEventListener("click",(()=>{this._capturedLastWeek()})),(0,n.ye)("selectPortNavbar")}_injectPortSelect(){const t=`${this._ports.portDataDefault.map((t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}))).sort((0,ht.MR)(["name"])).map((t=>`<option data-subtext="${t.nation}" value="${t.coord.toString()}" data-id="${t.id}">${t.name}</option>`)).join("")}`;this._portNamesSelector?.insertAdjacentHTML("beforeend",t),we(this._portNamesSelector).selectpicker("refresh")}_injectGoodsSelect(){const t=new Map,e=["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"];for(const i of this._ports.portDataDefault)for(const s of e){const e=i[s];if(e)for(const i of e)t.set(i,this._ports.tradeItem.get(i)?.name??"")}const i=`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`;this._buyGoodsSelector?.insertAdjacentHTML("beforeend",i),we(this._buyGoodsSelector).selectpicker("refresh")}setupInventorySelect(t){if(!this._inventorySelector?.classList.contains("selectpicker")){const t=new Map;for(const e of this._ports.portDataDefault)if(e.inventory)for(const i of e.inventory)t.set(i.id,this._ports.tradeItem.get(i.id)?.name??"");const e=`${[...t].sort(((t,e)=>t[1].localeCompare(e[1]))).map((t=>`<option value="${t[0]}">${t[1]}</option>`)).join("")}`;this._inventorySelector?.insertAdjacentHTML("beforeend",e),this._inventorySelector?.classList.add("selectpicker"),we(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}t?(this._inventorySelector?.classList.remove("d-none"),this._inventorySelector?.parentNode.classList.remove("d-none")):(this._inventorySelector?.classList.add("d-none"),this._inventorySelector?.parentNode.classList.add("d-none"))}_getNationOptions(t=!0){return`${dt.nU.filter((e=>!(!t&&("FT"===e.short||"NT"===e.short)))).sort((0,ht.MR)(["name"])).map((t=>`<option value="${t.short}">${t.name}</option>`)).join("")}`}_setupFrontlinesNationSelect(){const t=this._getNationOptions(!1);this._frontlineAttackingNationSelector?.insertAdjacentHTML("beforeend",t),this._frontlineAttackingNationSelector?.classList.add("selectpicker"),we(this._frontlineAttackingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0}),this._frontlineDefendingNationSelector?.insertAdjacentHTML("beforeend",t),this._frontlineDefendingNationSelector?.classList.add("selectpicker"),we(this._frontlineDefendingNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupNationSelect(){const t=this._getNationOptions(!0);this._propNationSelector?.insertAdjacentHTML("beforeend",t),this._propNationSelector?.classList.add("selectpicker"),we(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}_setupClanSelect(){const t=new Set;for(const e of this._ports.portData.filter((t=>""!==t?.capturer)))t.add(e.capturer);if(this._propClanSelector){this._propClanSelector.innerHTML="";let e="";0===t.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,e=`${[...t].sort(ht.I4).map((t=>`<option value="${t}" class="caps">${t}</option>`)).join("")}`),this._propClanSelector.insertAdjacentHTML("beforeend",e),this._propClanSelector.classList.add("selectpicker"),we(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})}}_getSailingDistance(t,e){return t<e?this._distances.get(t*this._numberPorts+e)??0:this._distances.get(e*this._numberPorts+t)??0}_setTradePortPartners(){const t=this._ports.portDataDefault.find((t=>t.id===this._ports.tradePortId))??[];t&&this._setTradeRelations(t)}_setTradeRelations(t){const e=t=>this._ports.tradeItem.get(t)?.price??0,i=t=>this._ports.tradeItem.get(t)?.distanceFactor??0,s=t=>this._ports.portDataDefault.find((e=>e.id===t))?.portTax??0,a=t=>{const e=this._ports.portDataDefault.find((e=>e.id===t));return{x:e?.coordinates[0]??0,y:e?.coordinates[1]??0}},o=(t,e)=>{const i=a(t),s=a(e);return(0,l.Sp)(i,s)},r=(t,e)=>{let i=Number.POSITIVE_INFINITY;const s=new Set(this._ports.portDataDefault.filter((t=>t.dropsTrading?.includes(e)??t.dropsNonTrading?.includes(e))).map((t=>t.id)));for(const e of s)i=Math.min(i,o(e,t.id));return i},n=(t,a,o)=>{const n=r(a,o),l=this._getSailingDistance(t.id,a.id),d=s(t.id),h=s(a.id);let p=e(o),c=3*p+n*p*i(o)/6/100;p*=1+d,c/=1+h;const u=Math.round(c-p);return{profit:u,profitPerDistance:u/l}},d=(t,e,i)=>{const s=[e.id,i];return this._sellProfit.has(s)||this._sellProfit.set(s,n(t,e,i)),this._sellProfit.get(s)},h=e=>{const i=new Set(t.dropsTrading?.map((t=>t)))??[];return e.consumesTrading?.filter((t=>i.has(t))).map((i=>({name:this._ports.tradeItem.get(i)?.name??"",profit:d(t,e,i)})))??[]},p=e=>{const i=new Set(t.consumesTrading?.map((t=>t)))??[];return e.dropsTrading?.filter((t=>i.has(t))).map((i=>({name:this._ports.tradeItem.get(i)?.name??"",profit:d(e,t,i)})))??[]};this._ports.portData=this._ports.portDataDefault.map((e=>(e.sailingDistanceToTradePort=this._getSailingDistance(e.id,t.id),e.goodsToBuyInTradePort=h(e),e.buyInTradePort=e.goodsToBuyInTradePort.length>0,e.goodsToSellInTradePort=p(e),e.sellInTradePort=e.goodsToSellInTradePort.length>0,e))).filter((t=>t.id===this._ports.tradePortId||t.sellInTradePort||t.buyInTradePort))}_portSelected(){const t=this._portNamesSelector?.options[this._portNamesSelector.selectedIndex],e=t?.value.split(","),i=Number(t?.getAttribute("data-id"));this._ports.currentPort={id:i,coord:{x:Number(e?.[0]),y:Number(e?.[1])}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone.showPB&&this._pbZone.refresh(),this._ports.showRadius="tradePorts",this._ports.update()}_goodSelected(){const t=Number(this._buyGoodsSelector?.options[this._buyGoodsSelector.selectedIndex].value),e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter((e=>e.dropsTrading?.includes(t)||e.dropsNonTrading?.includes(t)||e.producesNonTrading?.includes(t))))).map((t=>(t.isSource=!0,t))),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter((e=>e.consumesTrading?.includes(t))))).map((t=>(t.isSource=!1,t)));this._ports.setShowRadiusSetting("off"),this._ports.portData=[...e,...i],this._ports.showRadius="currentGood",this._ports.update()}inventorySelected(){this.isInventorySelected=!0;const t=Number(this._inventorySelector?.options[this._inventorySelector.selectedIndex].value),e=new Map,i=new Map;console.log(t);const s=this._ports.portDataDefault.filter((e=>e.inventory.some((e=>e.id===t)))).sort((0,ht.MR)(["name"])).map((s=>{const a=s.inventory.find((e=>e.id===t));return a&&(s.sellInTradePort=a.buyQuantity>0,s.sellInTradePort&&e.set(s.name,{name:s.name,nation:s.nation,good:a}),s.buyInTradePort=a.sellQuantity>0,s.buyInTradePort&&i.set(s.name,{name:s.name,nation:s.nation,good:a})),s}));this._ports.setShowRadiusSetting("off"),this._ports.portData=s,this._ports.showRadius="tradePorts","portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((()=>{let s="";if(s+=`<h5>${this._ports.tradeItem.get(t)?.name??""}</h5>`,e.size){s+="<h6>Buy</h6>";for(const[,t]of e)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,m.yI)(t.good.buyQuantity)} @ ${(0,m.Pj)(t.good.buyPrice)}<br>`}if(e&&i&&(s+="<p></p>"),i.size){s+="<h6>Sell</h6>";for(const[,t]of i)s+=`${t.name} <span class="caps">${t.nation}</span>: ${(0,m.yI)(t.good.sellQuantity)} @ ${(0,m.Pj)(t.good.sellPrice)}<br>`}return s})()),this._ports.update()}_setFrontlinePorts(t,e){const i=this._frontlinesData[t][e],s=new Set(i.map((t=>Number(t.key)))),a=new Set(i.flatMap((t=>t.value.map((t=>t)))));this._ports.portData=this._ports.portDataDefault.map((t=>(t.enemyPort=s.has(t.id),t.ownPort=a.has(t.id),t)))}_frontlineAttackingNationSelected(){const t=this._frontlineAttackingNationSelector?.options[this._frontlineAttackingNationSelector.selectedIndex].value??"";(0,dt.mP)(t)&&(this._setFrontlinePorts("attacking",t),this._ports.showRadius="frontline",this._ports.update())}_frontlineDefendingNationSelected(){const t=this._frontlineDefendingNationSelector?.options[this._frontlineDefendingNationSelector.selectedIndex].value??"";(0,dt.mP)(t)&&(this._setFrontlinePorts("defending",t),this._ports.showRadius="frontline",this._ports.update())}_nationSelected(){this._nation=this._propNationSelector?.options[this._propNationSelector.selectedIndex].value??"",(0,dt.mP)(this._nation)?(this._ports.portData=this._ports.portDataDefault.filter((t=>t.nation===this._nation)),this._ports.showRadius="",this._ports.update(),this._setupClanSelect(),we(this._propClanSelector).selectpicker("refresh")):this._nation="NT"}_clanSelected(){const t=this._propClanSelector?.options[this._propClanSelector.selectedIndex].value;t?this._ports.portData=this._ports.portDataDefault.filter((e=>e.capturer===t)):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter((t=>t.nation===this._nation))),this._ports.showRadius="",this._ports.update()}_depthSelected(t){const e=this._ports.portDataDefault.filter((e=>"shallow"===t?e.shallow:!e.shallow));this._ports.portData=e,this._ports.showRadius="",this._ports.update()}_allSelected(){const t=this._ports.portDataDefault.filter((t=>t.availableForAll));this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_nonCapSelected(){const t=this._ports.portDataDefault.filter((t=>!t.capturable));this._ports.portData=t,this._ports.showRadius="",this._ports.update()}_filterCaptured(t,e){const i=this._ports.portDataDefault.filter((i=>it()(i.captured,"YYYY-MM-DD HH:mm").isBetween(t,e,"hour","(]")));this._ports.portData=i,this._ports.showRadius="",this._ports.update()}_capturedToday(){const t=it().utc();let e=it()().utc().hour(d.WF).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,it().utc(e).add(1,"day"))}_capturedYesterday(){const t=it().utc();let e=it()().utc().hour(d.WF).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,it().utc(e).add(1,"day"))}_capturedThisWeek(){const t=it()().utc().startOf("week"),e=t.utc().hour(d.WF),i=it()(t).utc().add(7,"day").hour(d.WF);this._filterCaptured(e,i)}_capturedLastWeek(){const t=it()().utc().startOf("week"),e=it()(t).utc().subtract(7,"day").hour(d.WF),i=t.utc().hour(d.WF);this._filterCaptured(e,i)}clearMap(){this.isInventorySelected=!1,this._setupClanSelect(),we(this._propClanSelector).selectpicker("refresh")}}var ye=i(3609);function Se(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}it().extend(at()),it().extend(lt());class ke{constructor(t,e){Se(this,"_map",void 0),Se(this,"_coord",void 0),Se(this,"_baseName",void 0),Se(this,"_baseId",void 0),Se(this,"_buttonId",void 0),Se(this,"_modalId",void 0),Se(this,"_formId",void 0),Se(this,"_xInputId",void 0),Se(this,"_zInputId",void 0),Se(this,"_copyButtonId",void 0),Se(this,"_submitButtonId",void 0),Se(this,"_modal$",void 0),Se(this,"_g",void 0),Se(this,"_formSel",void 0),Se(this,"_xInputSel",void 0),Se(this,"_zInputSel",void 0),this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId=`button-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._formId=`form-${this._baseId}`,this._xInputId=`input-x-${this._baseId}`,this._zInputId=`input-z-${this._baseId}`,this._copyButtonId=`copy-coord-${this._baseId}`,this._submitButtonId=`submit-${this._baseId}`,this._setupSvg(),this._setupListener()}_setupSvg(){this._g=(0,s.Z)("#map").append("g").attr("class","f11")}_navbarClick(){(0,r.KS)("Menu","Go to F11"),this._f11Selected()}_setupListener(){document.querySelector(`#${this._buttonId}`)?.addEventListener("click",(()=>{this._navbarClick()})),window.addEventListener("keydown",(t=>{"F11"===t.code&&t.shiftKey&&this._navbarClick()}))}_injectModal(){(0,n.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,s.Z)(`#${this._modalId} .modal-body`).append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");const e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");const i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");const a=t.append("div").classed("float-right btn-group",!0).attr("role","group");a.append("button").classed("btn btn-outline-secondary icon-outline-button",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("icon icon-copy",!0),a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to");(0,s.Z)(`#${this._modalId} .modal-footer`).remove()}_initModal(){this._injectModal()}_f11Selected(){this._modal$||(this._initModal(),this._modal$=ye(`#${this._modalId}`),this._xInputSel=document.querySelector(`#${this._xInputId}`),this._zInputSel=document.querySelector(`#${this._zInputId}`),this._formSel.addEventListener("submit",(t=>{this._modal$.modal("hide"),t.preventDefault(),this._useUserInput()})),document.querySelector(`#${this._modalId}`)?.addEventListener("keydown",(t=>{"KeyC"===t.key&&t.ctrlKey&&this._copyCoordClicked(t)})),document.querySelector(`#${this._copyButtonId}`)?.addEventListener("click",(t=>{this._copyCoordClicked(t)}))),this._modal$.modal("show"),this._xInputSel?.focus(),this._xInputSel?.select()}_getInputValue(t){const{value:e}=t;return""===e?Number.POSITIVE_INFINITY:Number(e)}_getXCoord(){return this._getInputValue(this._xInputSel)}_getZCoord(){return this._getInputValue(this._zInputSel)}_useUserInput(){const t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)}_copyCoordClicked(t){(0,r.KS)("Menu","Copy F11 coordinates"),t.preventDefault();const e=this._getXCoord(),i=this._getZCoord();(0,h.A1)(e,i,this._modal$)}_printF11Coord(t,e,i,s){let a=10;const o=this._g.append("g").attr("transform",`translate(${t},${e})`),r=o.append("rect"),n=o.append("rect");o.append("circle").attr("r",a),a*=1.6;const l=o.append("text").attr("dx",-a+"px").attr("dy",-a/2-2+"px").attr("class","f11-coord").text((0,m.Hu)(i)),d=o.append("text").attr("dx",-a+"px").attr("dy",a/2+2+"px").attr("class","f11-coord").text((0,m.Hu)(s)),h=l.node()?.getBBox()??{},p=d.node()?.getBBox()??{},c=it()().utc(),u=it()(),_=o.append("text").attr("dx",`${a}px`).attr("dy",-a/2-2+"px").attr("class","f11-time").text(c.format("H.mm")),g=o.append("text").attr("dx",`${a}px`).attr("dy",a/2+2+"px").attr("class","f11-time").text(`(${u.format("H.mm")} local)`),v=_.node().getBBox()??{},w=g.node().getBBox()??{},f=h&&p?1.2*Math.round(h.height+p.height):0,b=h&&p?Math.round(Math.max(h.width,p.width)+5):0,y=1.2*Math.round(v.height+w.height),S=v&&w?Math.round(Math.max(v.width,w.width)+5):0,k=Math.max(f,y);r.attr("x",-b-a).attr("y",-k/2).attr("height",k).attr("width",b+a),n.attr("x",0).attr("y",-k/2).attr("height",k).attr("width",S+a)}_goToF11(t,e){const i=Math.floor((0,l._i)(t,e)),s=Math.floor((0,l.UY)(t,e));(0,l.vX)(i,this._coord.min,this._coord.max,!0)&&(0,l.vX)(s,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(i,s,t,e),this._map.zoomAndPan(i,s))}goToF11FromParam(t){const e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&((0,r.KS)("Menu","Paste F11 coordinates"),this._goToF11(e,i))}printCoord(t,e){const i=(0,l.IK)(t,e),s=(0,l.pw)(t,e);this._printF11Coord(t,e,i,s)}clearMap(){this._g.selectAll("*").remove()}}i(3863);var xe=i(3865),De=i(1138),Me=i(3609);function Ie(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function $e(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}function Te(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}var Pe=new WeakMap,Ce=new WeakMap;class Le{constructor(t,e,i,s){Ie(this,"show",void 0),Pe.set(this,{writable:!0,value:{}}),Ce.set(this,{writable:!0,value:{}}),Ie(this,"_serverName",void 0),Ie(this,"_portSelect",void 0),Ie(this,"_isDataLoaded",void 0),Ie(this,"_minScale",void 0),Ie(this,"_scale",void 0),Ie(this,"_fontSize",void 0),Ie(this,"_numTrades",void 0),Ie(this,"_arrowX",void 0),Ie(this,"_arrowY",void 0),Ie(this,"_baseId",void 0),Ie(this,"_nationSelectId",void 0),Ie(this,"_listType",void 0),Ie(this,"_showId",void 0),Ie(this,"_showRadioValues",void 0),Ie(this,"_showCookie",void 0),Ie(this,"_showRadios",void 0),Ie(this,"_profitId",void 0),Ie(this,"_profitRadioValues",void 0),Ie(this,"_profitCookie",void 0),Ie(this,"_profitRadios",void 0),Ie(this,"_profitValue",void 0),Ie(this,"_profitText",void 0),Ie(this,"_g",void 0),Ie(this,"_labelG",void 0),Ie(this,"_tradeDetailsDiv",void 0),Ie(this,"_tradeDetailsHead",void 0),Ie(this,"_nationSelector",void 0),Ie(this,"_list",void 0),Ie(this,"_linkDataDefault",void 0),Ie(this,"_linkData",void 0),Ie(this,"_portData",void 0),Ie(this,"_nodeData",void 0),Ie(this,"_linkDataFiltered",void 0),Ie(this,"_portDataFiltered",void 0),Ie(this,"_tradeItem",void 0),this._serverName=t,this._portSelect=e,this._minScale=i,this._scale=this._minScale,this._fontSize=l.jo,this._isDataLoaded=!1,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=`${this._baseId}-nation-select`,this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new p.Z({id:this._showId,values:this._showRadioValues}),this._showRadios=new c.Z(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new p.Z({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new c.Z(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this.setBounds(s),this.show&&this._portSelect.setupInventorySelect(this.show),this._profitValue=this._getProfitValue()}static _getId(t){return`trade-${t.source.id}-${t.good}-${t.target.id}`}static _addInfo(t){return`<div><div>${t}</div>`}static _addDes(t){return`<div class="des">${t}</div></div>`}static _getProfitPerWeight(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))}static _getProfitPerDistance(t){return t.profitTotal/t.distance}static _startBlock(t){return`<div class="block-block"><span>${t}</span>`}static _endBlock(){return"</div>"}static _showElem(t){t.classed("d-none",!1)}static _hideElem(t){t.classed("d-none",!0)}_setupSvg(){this._g=(0,s.Z)("#map").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),(0,s.Z)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d",`M0,0L0,${this._arrowY}L${this._arrowX},${this._arrowY/2}z`).attr("class","trade-arrow-head"),this._tradeDetailsDiv=(0,s.Z)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")}_setupSelects(){const t=`${dt.nU.map((t=>`<option value="${t.short}" selected>${t.name}</option>`)).join("")}`,e=`${this._baseId}-card`;this._tradeDetailsHead=this._tradeDetailsDiv.append("div");const i=this._tradeDetailsHead.append("label"),s=i.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=s.node(),this._nationSelector.insertAdjacentHTML("beforeend",t),Me(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:t=>`${t===dt.nU.length?"All":String(t)} nations selected`,title:"Select nations"}),i.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target",`#${e}`).text("Info"),this._tradeDetailsHead.append("div").attr("id",e).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")}_setupProfitRadios(){const t=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");t.append("legend").attr("class","col-form-label").text("Sort net profit by");for(const e of this._profitRadioValues){const i=`${this._profitId}-${e.replace(/ /g,"")}`,s=t.append("div").attr("class","custom-control custom-radio custom-control-inline");s.append("input").attr("id",i).attr("name",this._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",e),s.append("label").attr("for",i).attr("class","custom-control-label").text(e)}}_setupListener(){document.querySelector(`#${this._showId}`)?.addEventListener("change",(async()=>this._showSelected())),document.querySelector(`#${this._profitId}`)?.addEventListener("change",(()=>{this._profitValueSelected()})),this._nationSelector.addEventListener("change",(t=>{this._nationChanged(),t.preventDefault()}))}_setupList(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}_setupData(){this._linkData=this._linkDataDefault,this._nodeData=new Map(this._portData.map((t=>[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]))),this._filterPortsBySelectedNations(),this._sortLinkData()}_sortLinkData(){this._linkData=this._linkData.map((t=>{let e=0;switch(this._profitValue){case"weight":e=Le._getProfitPerWeight(t);break;case"distance":e=Le._getProfitPerDistance(t);break;case"total":e=t.profitTotal;break;default:throw new Error(`Wrong profit value ${this._profitValue}`)}return t.profit=e,t})).sort(((t,e)=>e.profit??0-(t.profit??0)))}async _showSelected(){const t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),await this.showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()}async _loadData(){const t=await(0,n.qP)(`${this._serverName}-pb.json`),e=(await i.e(462).then(i.t.bind(i,7640,19))).default;this._portData=e.map((e=>{const i=t.find((t=>t.id===e.id));return{...e,...i}})),this._linkDataDefault=await(0,n.qP)(`${this._serverName}-trades.json`);const s=await(0,n.qP)(`${this._serverName}-items.json`);this._tradeItem=new Map(s.map((t=>[t.id,t.name])))}async _loadAndSetupData(){await this._loadData(),this._setupData()}async showOrHide(){this.show?(this._isDataLoaded||await this._loadAndSetupData().then((()=>{this._isDataLoaded=!0})),Le._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(Le._hideElem(this._tradeDetailsDiv),this._linkData=[])}_profitValueSelected(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()}_nationChanged(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()}_portIsShallow(t){return this._nodeData.get(t)?.isShallow??!0}_getDepth(t){return this._portIsShallow(t)?"(shallow)":"(deep)"}_getTradeLimitedData(t){const e=t.weightPerItem*t.quantity;let i="";return i+=Le._addInfo(`${(0,m.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Le._addDes("trade"),i+=Le._addInfo(`${(0,m.Pj)(t.profit??0)}`)+Le._addDes(this._profitText),i+=Le._addInfo(`${(0,m.Dw)(e)} ${1===e?"ton":"tons"}`)+Le._addDes("weight"),i+=Le._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Le._addDes(`from ${this._getDepth(t.source.id)}`),i+=Le._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Le._addDes(`to ${this._getDepth(t.target.id)}`),i+=Le._addInfo(`${(0,m.Dw)(t.distance)}`)+Le._addDes("sail distance"),i}_getTradeFullData(t){const e=t.weightPerItem*t.quantity,i=t.target.grossPrice-t.source.grossPrice,s=Le._getProfitPerDistance(t),a=Le._getProfitPerWeight(t);let o="";return o+=Le._startBlock("Trade"),o+=Le._addInfo(`${(0,m.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)+Le._addDes("good"),o+=Le._addInfo(`${(0,m.Pj)(t.source.grossPrice)}`)+Le._addDes("gross buy price"),o+=Le._addInfo(`${(0,m.Pj)(t.target.grossPrice)}`)+Le._addDes("gross sell price"),o+=Le._addInfo(`${(0,m.Dw)(e)} ${1===e?"ton":"tons"}`)+Le._addDes("weight"),o+=Le._endBlock(),o+=Le._startBlock("Profit"),o+=Le._addInfo(`${(0,m.Pj)(t.profitTotal)}`)+Le._addDes("total"),o+=Le._addInfo(`${(0,m.Pj)(i)}`)+Le._addDes("profit/item"),o+=Le._addInfo(`${(0,m.Pj)(s)}`)+Le._addDes("profit/distance"),o+=Le._addInfo(`${(0,m.Pj)(a)}`)+Le._addDes("profit/weight"),o+=Le._endBlock(),o+=Le._startBlock("Route"),o+=Le._addInfo(`${this._nodeData.get(t.source.id).name} <span class="caps">${this._nodeData.get(t.source.id).nation}</span>`)+Le._addDes(`from ${this._getDepth(t.source.id)}`),o+=Le._addInfo(`${this._nodeData.get(t.target.id).name} <span class="caps">${this._nodeData.get(t.target.id).nation}</span>`)+Le._addDes(`to ${this._getDepth(t.source.id)}`),o+=Le._addInfo(`${(0,m.Dw)(t.distance)}`)+Le._addDes("sail distance"),o+=Le._endBlock(),o}_getSiblingLinks(t,e){return this._linkDataFiltered.filter((i=>i.source.id===t&&i.target.id===e||i.source.id===e&&i.target.id===t)).map((t=>t.profit??0))}_getXCoord(t){return this._nodeData.get(t)?.x??0}_getYCoord(t){return this._nodeData.get(t)?.y??0}_updateGraph(){const t=(t,e,i)=>{const a=(0,s.Z)(t),o=this._getTradeFullData(i);Me(a.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-inner-small"></div></div>',title:o,trigger:"manual",sanitize:!1}).tooltip("show")},e=(t,e)=>{const i={x:this._getXCoord(e.source.id),y:this._getYCoord(e.source.id)},s={x:this._getXCoord(e.target.id),y:this._getYCoord(e.target.id)},a=t?i.x:s.x,o=t?i.y:s.y,r=t?s.x:i.x,n=t?s.y:i.y;let l=Math.sqrt((r-a)**2+(n-o)**2);const d=t?0:1,h=this._getSiblingLinks(e.source.id,e.target.id);if(h.length>1){const t=(0,De.x)().domain(h).range([1,h.length]);l/=1+1/h.length*(t(e.profit??0)??-1)}return l=Math.round(l),`M${a},${o}A${l},${l} 0,0,${d} ${r},${n}`},i=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,a=(0,xe.Z)(this._linkDataFiltered,(t=>t.profit??0)),o=(0,_.Z)().range([5/this._scale,15/this._scale]).domain(a),r=2**Math.log2(Math.abs(this._minScale)+this._scale),n=(0,l.qY)(this._fontSize/r);this._g.selectAll(".trade-link").data(i,(t=>Le._getId(t))).join((e=>e.append("path").attr("class","trade-link").attr("marker-start",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"":"url(#trade-arrow)")).attr("marker-end",(t=>this._getXCoord(t.source.id)<this._getXCoord(t.target.id)?"url(#trade-arrow)":"")).attr("id",(t=>Le._getId(t))).on("click",(function(e,i){t(this,0,i)})).on("mouseleave",(function(){(t=>{Me((0,s.Z)(t).node()).tooltip("dispose")})(this)})))).attr("d",(t=>e(this._getXCoord(t.source.id)<this._getXCoord(t.target.id),t))).attr("stroke-width",(t=>`${o(t.profit??0)??0}px`)),this._labelG.attr("font-size",`${n}px`),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,(t=>Le._getId(t))).join((t=>t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",(t=>`#${Le._getId(t)}`)).text((t=>`${(0,m.yI)(t.quantity)} ${this._tradeItem.get(t.good)}`)))).attr("dy",(t=>`-${o(t.profit??0)/1.8}px`))}get listType(){return this._listType}set listType(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],Le._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,Le._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}}_updateList(t){switch(this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}}_updateInventory(t){this._list.html(t??"")}_updatePortList(t){this._list.html(t??"")}_updateTradeList(){let t;const e=(e,i)=>{t=(0,s.Z)(`path#${Le._getId(i)}`).attr("class","highlight"),t.dispatch("click")},i=()=>{t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,(t=>Le._getId(t))).join((t=>t.append("div").attr("class","block").on("mouseenter",e).on("mouseleave",i))).html((t=>this._getTradeLimitedData(t)))}_filterTradesByVisiblePorts(){const t=new Set(this._portData.filter((t=>t.coordinates[0]>=Te(this,Pe)[0]&&t.coordinates[0]<=Te(this,Ce)[0]&&t.coordinates[1]>=Te(this,Pe)[1]&&t.coordinates[1]<=Te(this,Ce)[1])).map((t=>t.id)));this._linkDataFiltered=this._linkData.filter((e=>t.has(e.source.id)||t.has(e.target.id))).slice(0,this._numTrades)}_filterTradesBySelectedNations(){this._linkData=this._linkData.filter((t=>this._portDataFiltered.has(t.source.id)&&this._portDataFiltered.has(t.target.id))).slice(0,this._numTrades)}_filterPortsBySelectedNations(){const t=new Set([...this._nationSelector.selectedOptions].map((t=>t.value)));this._portDataFiltered=new Set(this._portData.filter((e=>t.has(e.nation))).map((t=>t.id)))}_getShowValue(){const t=this._showCookie.get();return this._showRadios.set(t),"on"===t}_getProfitValue(){const t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t}update(t){this.show?(this._filterTradesByVisiblePorts(),this._updateList(t)):this._linkDataFiltered=[],this._updateGraph()}setBounds(t){$e(this,Pe,t[0]),$e(this,Ce,t[1])}transform(t){this._scale=t.k,this.update()}clearMap(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()}}var Ne=i(8250),We=i(7),je=i(3126),Ae=i(4893),Ze=i(2601),Be=i(5049),ze=(i(3223),i(27)),Fe=i(3609);function Re(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class Ee{constructor(t){Re(this,"_fontSize",void 0),Re(this,"_compassRadius",void 0),Re(this,"_courseArrowWidth",void 0),Re(this,"_line",void 0),Re(this,"_labelPadding",void 0),Re(this,"_degreesPerMinute",void 0),Re(this,"_degreesSegment",void 0),Re(this,"_minOWSpeed",void 0),Re(this,"_owSpeedFactor",void 0),Re(this,"_speedScale",void 0),Re(this,"_defaultShipName",void 0),Re(this,"_defaultShipSpeed",void 0),Re(this,"_defaultStartWindDegrees",void 0),Re(this,"_baseName",void 0),Re(this,"_baseId",void 0),Re(this,"_buttonId",void 0),Re(this,"_compassId",void 0),Re(this,"_deleteLastLegButtonId",void 0),Re(this,"_modalId",void 0),Re(this,"_sliderId",void 0),Re(this,"_shipId",void 0),Re(this,"_g",void 0),Re(this,"_journey",void 0),Re(this,"_shipCompare",void 0),Re(this,"_compass",void 0),Re(this,"_compassG",void 0),Re(this,"_divJourneySummary",void 0),Re(this,"_journeySummaryShip",void 0),Re(this,"_journeySummaryTextShip",void 0),Re(this,"_journeySummaryWind",void 0),Re(this,"_journeySummaryTextWind",void 0),Re(this,"_gJourneyPath",void 0),Re(this,"_drag",void 0),this._fontSize=t,this._compassRadius=90,this._courseArrowWidth=5,this._line=(0,Be.Z)().x((t=>t[0])).y((t=>t[1])),this._labelPadding=20,this._degreesPerMinute=n.er/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=(0,_.Z)().domain((0,Ae.Z)(0,l.QF,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId=`button-${this._baseId}`,this._compassId=`compass-${this._baseId}`,this._deleteLastLegButtonId=`button-delete-leg-${this._baseId}`,this._modalId=`modal-${this._baseId}`,this._sliderId=`slider-${this._baseId}`,this._shipId="ship-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}static _getHumanisedDuration(t){const e=Math.floor(t/60),i=Math.round(t%60);let s="in ";if(t<1)s+="less than a minute";else{const t=0===e?"":(0,n.gY)(e,"hour");s+=t+(""===t?"":" ")+(0===i?"":(0,n.gY)(i,"minute"))}return s}_setupDrag(){const t=t=>{this._removeLabels(),(0,s.Z)(t).classed("drag-active",!0)},e=(t,e,i)=>{const a=i.position[0]+Number(e.dx),o=i.position[1]+Number(e.dy);0===i.index&&this._compass.attr("x",a).attr("y",o),(0,s.Z)(t).attr("cx",e.x).attr("cy",e.y),i.position=[a,o],this._printLines()},i=t=>{(0,s.Z)(t).classed("drag-active",!1),this._printJourney()};this._drag=(0,Ze.Z)().on("start",(function(){t(this)})).on("drag",(function(t,i){e(this,t,i)})).on("end",(function(){i(this)}))}_setupSvg(){const t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=(0,s.Z)("#ports").append("g").attr("class","journey"),(0,s.Z)("#na-svg defs").append("marker").attr("id","journey-arrow").attr("viewBox",`0 -${t} ${e} ${e}`).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("class","journey-arrow-head").attr("d",`M0,-${t}L${e},0L0,${t}`)}_initJourneyData(){this._journey={shipName:this._defaultShipName,startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segments:[{position:[0,0],label:""}]}}_resetJourneyData(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0}_navbarClick(){(0,r.KS)("Menu","MakeJourney"),this._journeySelected()}_setupListener(){document.querySelector(`#${this._buttonId}`)?.addEventListener("mouseup",(()=>{this._navbarClick()})),document.querySelector(`#${this._deleteLastLegButtonId}`)?.addEventListener("mouseup",(()=>{this._deleteLastLeg()}))}_setupWindInput(){const t=Fe.fn.roundSlider.prototype._getTooltipPos;Fe.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||Fe("body").append(this.tooltip);const e=t.call(this);return this.container.append(this.tooltip),e},window.tooltip=t=>`${(0,h.nD)(t.value)}<br>${String(t.value)}°`,Fe(`#${this._sliderId}`).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/l.Tm.length,editableTooltip:!1,tooltipFormat:"tooltip",create(){this.control.css("display","block")}})}_injectModal(){(0,n.Eu)({id:this._modalId,title:this._baseName,size:"modal-sm"});const t=(0,s.Z)(`#${this._modalId} .modal-body`).append("form").append("div").attr("class","form-group"),e=t.append("div").attr("class","alert alert-primary").attr("role","alert");e.append("label").attr("for",this._sliderId).text("Current in-game wind"),e.append("div").attr("id",this._sliderId).attr("class","rslider");const i=`${this._shipId}-Base-select`,a=t.append("div").attr("class","alert alert-primary").attr("role","alert").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",i).text("Ship (optional)"),a.append("select").attr("name",i).attr("id",i)}_initModal(){this._injectModal(),this._setupWindInput(),this._shipCompare=new ze.qn(this._shipId),this._shipCompare.CompareShipsInit()}_useUserInput(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()}_journeySelected(){document.querySelector(`#${this._modalId}`)||this._initModal(),Fe(`#${this._modalId}`).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}_printCompass(){const t=this._journey.segments[0].position[0],e=this._journey.segments[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e),this._compassG=this._compass.append("g"),(0,h.$G)({element:this._compassG,radius:this._compassRadius})}_removeCompass(){this._compass.remove()}_getSpeedAtDegrees(t){return Math.max(this._speedScale(t)??0,this._minOWSpeed)}_calculateDistanceForSection(t,e){const i=(l.QF-t+e)%l.QF;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*l.nX}_getStartWind(){const t=Fe(`#${this._sliderId}`),e=Number(t.roundSlider("getValue"));return t.length>0?e:0}_setShipSpeed(){let t;this._journey.shipName===this._defaultShipName?t=Array.from({length:24},(()=>this._defaultShipSpeed/2)):({speedDegrees:t}=this._shipCompare.singleShipData),this._speedScale.range(t)}_calculateMinutesForSegment(t,e,i){let s=i,a=e,o=0;for(this._setShipSpeed();s>0;){const e=this._calculateDistanceForSection(t,a);s>e?(s-=e,o+=1):(o+=s/e,s=0),a=(l.QF+a-this._degreesPerMinute)%l.QF}return this._journey.currentWindDegrees=a,o}_setShipName(){this._shipCompare?.singleShipData?.name?this._journey.shipName=`${this._shipCompare.singleShipData.name}`:this._journey.shipName=this._defaultShipName}_removeLabels(){const t=this._g.selectAll("g.journey g.label");t.select("text").remove(),t.select("rect").remove()}_correctJourney(){const t=this._fontSize,e=o.CR.translate(20,20),i=this._labelPadding,a=(a,o,r)=>{const n=(0,s.Z)(a),l=n.select("text"),d=o.label.split("|"),h=1.3*t;l.text("").attr("dy",0).attr("transform",e.toString()).style("font-size",`${t}px`);for(const[t,e]of d.entries()){const i=l.append("tspan").html(e);t>0&&i.attr("x",0).attr("dy",h)}const p=l.node().getBBox(),c=o.label?p.width+2*i:0,u=o.label?p.height+i:0;n.select("rect").attr("width",c).attr("height",u);const _=n.select("circle").attr("r",10).attr("class","");n.append((()=>_.remove().node())),0===r&&_.attr("r",40).attr("class","drag-hidden"),r===this._journey.segments.length-1&&_.attr("r",10).attr("class","drag-hidden")};this._g.selectAll("g.journey g.label").each((function(t,e){a(this,t,e)})),this._gJourneyPath&&this._gJourneyPath.style("stroke-width","5px")}_printLabels(){const t=(0,Ne.Z)().padding(this._labelPadding).value((t=>{const e=t.label.split("|"),i=e.reduce(((t,e,i,s)=>s[t].length>e.length?t:i),0);return e[i]})),e=(0,We.Z)(),i=(0,je.Z)(e).size(((t,e,i)=>{const s=t.label.split("|").length,a=i[e].querySelectorAll("text")[0].getBBox();return[a.width+2*this._labelPadding,a.height*s+2*this._labelPadding]})).position((t=>t.position)).component(t);this._g.datum(this._journey.segments.map((t=>t))).call(i)}_setupSummary(){this._divJourneySummary=(0,s.Z)("main #summary-column").append("div").attr("id","journey-summary").attr("class","journey-summary d-none"),this._journeySummaryShip=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").attr("class","summary-des").text("ship"),this._journeySummaryWind=this._divJourneySummary.append("div").attr("class","block small"),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").attr("class","summary-des").text("wind"),this._divJourneySummary.append("div").attr("class","block").append("button").attr("id",this._deleteLastLegButtonId).attr("class","btn btn-outline-primary btn-sm").attr("role","button").text("Clear last leg")}_displaySummary(t){this._divJourneySummary.classed("d-none",!t),(0,s.Z)("#port-summary").classed("d-none",t)}_showSummary(){this._displaySummary(!0)}_hideSummary(){this._displaySummary(!1)}_printSummaryShip(){this._journeySummaryTextShip.text(this._journey.shipName)}_printSummaryWind(){this._journeySummaryTextWind.html(`From ${(0,h.Iy)(this._journey.startWindDegrees)}`)}_printSummary(){this._printSummaryWind(),this._printSummaryShip()}_printLines(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segments.length>1?this._journey.segments.map((t=>t.position)):[[0,0]]).attr("marker-end","url(#journey-arrow)").attr("d",this._line)}_getTextDirection(t,e,i){return`${(0,h.Iy)(t,!0)} ⁖ F11: ${(0,m.Hu)((0,l.IK)(i.x,i.y))} / ${(0,m.Hu)((0,l.pw)(i.x,i.y))}`}_getTextDistance(t,e,i){let s=`${Math.round(t)} k ${Ee._getHumanisedDuration(e)}`;return i&&(s+=`⁖ total ${Math.round(this._journey.totalDistance)} k ${Ee._getHumanisedDuration(this._journey.totalMinutes)}`),s}_setSegmentLabel(t=this._journey.segments.length-1){const e={x:this._journey.segments[t].position[0],y:this._journey.segments[t].position[1]},i={x:this._journey.segments[t-1].position[0],y:this._journey.segments[t-1].position[1]},s=(0,h.Fq)(e,i),a=(0,l.Sp)(e,i),o=(0,l.tT)(s),r=this._calculateMinutesForSegment(s,this._journey.currentWindDegrees,1e3*a);this._journey.totalDistance+=a,this._journey.totalMinutes+=r;const n=this._getTextDirection(o,s,e),d=this._getTextDistance(a,r,t>1);this._journey.segments[t].label=`${n}|${d}`}_printSegment(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_printJourney(){this._printLines(),this._resetJourneyData();for(const[t]of this._journey.segments.entries())t<this._journey.segments.length-1&&this._setSegmentLabel(t+1);this._printLabels(),this._correctJourney(),this._g.selectAll("g.journey g.label circle").call(this._drag)}_deleteLastLeg(){this._journey.segments.pop(),this._journey.segments.length>0?this._printJourney():(this._g.selectAll("g.journey g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())}_initJourney(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")}setSummaryPosition(t,e){this._divJourneySummary.style("top",`${t}px`).style("right",`${e}px`)}plotCourse(t,e){this._journey.segments[0].position[0]>0?(this._journey.segments.push({position:[t,e],label:"",index:this._journey.segments.length}),this._printSegment()):(this._journey.segments[0]={position:[t,e],label:"",index:0},this._initJourney())}}const Ge=t=>t*t,qe=t=>Math.sqrt(Ge(t.x)+Ge(t.y)+Ge(t.z)),He=(t,e)=>t.x*e.x+t.y*e.y+t.z*e.z,Ve=(t,e)=>({x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}),Oe=(t,e)=>({x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}),Ye=(t,e)=>({x:t.x/e,y:t.y/e,z:t.z/e}),Je=(t,e)=>({x:t.x*e,y:t.y*e,z:t.z*e});i(2776);var Xe=i(3609);function Ke(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function Ue(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var Qe=new WeakMap,ti=new WeakMap,ei=new WeakMap,ii=new WeakMap;class si{constructor(t,e){Qe.set(this,{writable:!0,value:void 0}),ti.set(this,{writable:!0,value:void 0}),ei.set(this,{writable:!0,value:void 0}),ii.set(this,{writable:!0,value:void 0}),Ue(this,Qe,t),Ue(this,ti,e),Ue(this,ii,(0,s.Z)("#toast-column")),this._set(),this._show();window.setTimeout(this._remove.bind(this),1e4)}_set(){Ue(this,ei,Ke(this,ii).append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true"));const t=Ke(this,ei).append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",n.vU).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(Ke(this,Qe)),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),Ke(this,ei).append("div").attr("class","toast-body").html(Ke(this,ti))}_show(){const t=Ke(this,ei).node();if(null!==t){Xe(t).toast({autohide:!1}).toast("show")}}_remove(){Ke(this,ei).remove()}}var ai=i(3609);function oi(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function ri(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}var ni=new WeakMap,li=new WeakMap,di=new WeakMap,hi=new WeakMap,pi=new WeakMap,ci=new WeakMap,ui=new WeakMap,_i=new WeakMap,mi=new WeakMap,gi=new WeakMap,vi=new WeakMap;class wi{constructor(t){ni.set(this,{writable:!0,value:{}}),li.set(this,{writable:!0,value:void 0}),di.set(this,{writable:!0,value:void 0}),hi.set(this,{writable:!0,value:void 0}),pi.set(this,{writable:!0,value:void 0}),ci.set(this,{writable:!0,value:[]}),ui.set(this,{writable:!0,value:void 0}),_i.set(this,{writable:!0,value:void 0}),mi.set(this,{writable:!0,value:void 0}),gi.set(this,{writable:!0,value:[]}),vi.set(this,{writable:!0,value:[]}),ri(this,li,t),ri(this,_i,3),ri(this,mi,Array.from({length:oi(this,_i)},((t,e)=>e))),ri(this,hi,"Get position"),ri(this,di,"get-position"),ri(this,pi,`button-${oi(this,di)}`),ri(this,ui,`modal-${oi(this,di)}`);for(const t of oi(this,mi))oi(this,gi)[t]=`${oi(this,di)}-${t}-select`,oi(this,ci)[t]=`${oi(this,di)}-${t}-input`;this._setupListener()}_navbarClick(){(0,r.KS)("Menu","Get position"),this._positionSelected()}_setupListener(){document.querySelector(`#${oi(this,pi)}`)?.addEventListener("click",(()=>{this._navbarClick()}))}_injectModal(){(0,n.Eu)({id:oi(this,ui),title:oi(this,hi),size:"modal-md",buttonText:"Go"});const t=(0,s.Z)(`#${oi(this,ui)} .modal-body`);t.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");const e=t.append("form"),i=e.append("datalist").attr("id","defaultDistances");for(const t of[5,10,15,20,30,50,100,200])i.append("option").attr("value",t);for(const t of oi(this,mi)){const i=e.append("div").attr("class","form-row");i.append("div").attr("class","col-md-6").append("label").append("select").attr("name",oi(this,gi)[t]).attr("id",oi(this,gi)[t]).attr("class","selectpicker"),i.append("div").attr("class","col-md-6").append("input").attr("id",oi(this,ci)[t]).attr("name",oi(this,ci)[t]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)}}_setupSelects(){const t=`${oi(this,li).portDataDefault.map((t=>({id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}))).sort((0,ht.MR)(["name"])).map((t=>`<option data-subtext="${t.nation}">${t.name}</option>`)).join("")}`;for(const e of oi(this,mi))oi(this,vi)[e]=document.querySelector(`#${oi(this,gi)[e]}`),oi(this,vi)[e]&&(oi(this,vi)[e].insertAdjacentHTML("beforeend",t),ai(oi(this,vi)[e]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0}))}_initModal(){this._injectModal(),this._setupSelects()}_showAndGoToPosition(){const t=oi(this,li).portData.map((t=>({x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance??0}))),e=((t,e,i,s=!1)=>{const a=Ye(Ve(e,t),qe(Ve(e,t))),o=He(a,Ve(i,t));let r=Ve(Ve(i,t),Je(a,o));const n=Ye(r,qe(r)),l=((t,e)=>({x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}))(a,n),d=qe(Ve(e,t)),h=He(n,Ve(i,t)),p=(Ge(t.r)-Ge(e.r)+Ge(d))/(2*d),c=(Ge(t.r)-Ge(i.r)+Ge(o)+Ge(h))/(2*h)-o/h*p;let u=Ge(t.r)-Ge(p)-Ge(c);Math.abs(u)<1e-10&&(u=0);const _=Math.sqrt(u);if(Number.isNaN(_))return;r=Oe(t,Oe(Je(a,p),Je(n,c)));const m=Oe(r,Je(l,_)),g=Ve(r,Je(l,_));return 0===_||s?r:[m,g]})(t[0],t[1],t[2],!0);if(e){e.x=Math.round(e.x),e.y=Math.round(e.y),oi(this,li).map.f11.printCoord(e.x,e.y),oi(this,li).map.zoomAndPan(e.x,e.y);const t=Math.round((0,l.IK)(e.x,e.y)/-1e3),i=Math.round((0,l.pw)(e.x,e.y)/-1e3);(0,h.A1)(t,i,oi(this,ni)),new si("Get position","Coordinates copied to clipboard.")}else new si("Get position","No intersection found.")}_useUserInput(){const t=new Map;for(const e of oi(this,mi))if(oi(this,vi)[e]){const i=oi(this,vi)[e].selectedIndex?oi(this,vi)[e].options[oi(this,vi)[e].selectedIndex].text:"",s=Number(document.querySelector(`#${oi(this,ci)[e]}`).value);s&&""!==i&&t.set(i,1.04*s*n.ZE)}t.size===oi(this,_i)?(oi(this,li).setShowRadiusSetting("position"),oi(this,li).portData=oi(this,li).portDataDefault.filter((e=>t.has(e.name))).map((e=>(e.distance=t.get(e.name),e))),oi(this,li).update(),this._showAndGoToPosition()):new si("Get position","Not enough data.")}_positionSelected(){document.querySelector(`#${oi(this,ui)}`)||(this._initModal(),ri(this,ni,ai(`#${oi(this,ui)}`))),oi(this,ni).modal("show").one("hidden.bs.modal",(()=>{this._useUserInput()}))}}var fi=i(274),bi=i(7461),yi=i(5374),Si=i(1498),ki=i(995);function xi(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}function Di(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}it().extend(at());var Mi=new WeakMap,Ii=new WeakMap,$i=new WeakMap,Ti=new WeakMap,Pi=new WeakMap,Ci=new WeakMap,Li=new WeakMap,Ni=new WeakMap,Wi=new WeakMap,ji=new WeakMap,Ai=new WeakMap,Zi=new WeakMap,Bi=new WeakMap,zi=new WeakMap,Fi=new WeakMap,Ri=new WeakMap,Ei=new WeakMap,Gi=new WeakMap,qi=new WeakMap,Hi=new WeakMap,Vi=new WeakMap,Oi=new WeakMap,Yi=new WeakMap,Ji=new WeakMap,Xi=new WeakMap,Ki=new WeakMap,Ui=new WeakMap,Qi=new WeakMap,ts=new WeakMap,es=new WeakMap,is=new WeakMap,ss=new WeakMap,as=new WeakMap;class os extends ki.I{constructor(t,e,i){super(e,"Ownership map"),this.map=t,this.serverId=e,this.coord=i,Mi.set(this,{writable:!0,value:0}),Ii.set(this,{writable:!0,value:{}}),$i.set(this,{writable:!0,value:{}}),Ti.set(this,{writable:!0,value:0}),Pi.set(this,{writable:!0,value:-1}),Ci.set(this,{writable:!0,value:0}),Li.set(this,{writable:!0,value:0}),Ni.set(this,{writable:!0,value:{}}),Wi.set(this,{writable:!0,value:0}),ji.set(this,{writable:!0,value:{}}),Ai.set(this,{writable:!0,value:{}}),Zi.set(this,{writable:!0,value:{}}),Bi.set(this,{writable:!0,value:0}),zi.set(this,{writable:!0,value:0}),Fi.set(this,{writable:!0,value:{}}),Ri.set(this,{writable:!0,value:{}}),Ei.set(this,{writable:!0,value:0}),Gi.set(this,{writable:!0,value:new Map}),qi.set(this,{writable:!0,value:[]}),Hi.set(this,{writable:!0,value:{}}),Vi.set(this,{writable:!0,value:{}}),Oi.set(this,{writable:!0,value:{}}),Yi.set(this,{writable:!0,value:{}}),Ji.set(this,{writable:!0,value:0}),Xi.set(this,{writable:!0,value:!1}),Ki.set(this,{writable:!0,value:{}}),Ui.set(this,{writable:!0,value:void 0}),Qi.set(this,{writable:!0,value:"power-map"}),ts.set(this,{writable:!0,value:void 0}),es.set(this,{writable:!0,value:void 0}),is.set(this,{writable:!0,value:200}),ss.set(this,{writable:!0,value:200}),as.set(this,{writable:!0,value:2}),Di(this,Ui,t),Di(this,es,i),Di(this,ts,(0,U.Z)().domain((0,dt.w6)(0,dt.nU.length-1)).range(n.Oz)),this._setupListener()}_setupData(t){Di(this,Oi,t.power),Di(this,Ti,xi(this,Oi).length-1),Di(this,Ri,(0,s.Z)("g#map"))}async _loadData(){const t=[{fileName:`${this.serverId}-power.json`,name:"power"}],e={};return Di(this,Vi,(await i.e(462).then(i.t.bind(i,7640,19))).default),await(0,n.EZ)(t,e),e}async _loadAndSetupData(){const t=await this._loadData();this._setupData(t)}async _setupListener(){let t=!0;await this._loadAndSetupData(),document.querySelector(`#${this.buttonId}`).addEventListener("click",(async()=>{t?(t=!1,await this._loadAndSetupData()):Di(this,Pi,0),(0,r.KS)("Tools",this.baseName),this._menuItemSelected()}))}_showMapElements(t){xi(this,Ri).classed("d-none",!t),(0,s.Z)("main div.overlay").classed("d-none",!t)}_mapElementsOff(){this._showMapElements(!1)}_mapElementsOn(){this._showMapElements(!0)}_drawEnd(){(0,n.V4)(),this._mapElementsOn()}async _setPattern(){const t=Object.values((0,n.wu)());try{const e=await(0,Si.Z)(t);for(const[t,i]of e.entries())xi(this,qi)[t]=xi(this,Ii).createPattern(i,"repeat")}catch(t){console.error("One or more images have failed to load :("),console.error(t.errored),console.info("But these loaded fine:"),console.info(t.loaded)}}_drawDate(t){const e=it()(t).format("D MMMM YYYY");xi(this,$i).text(e)}_drawMap(t,e,i){for(const[t,e]of i.entries())xi(this,Ii).beginPath(),xi(this,Ki).renderCell(t,xi(this,Ii)),xi(this,Ii).fillStyle=xi(this,qi)[e]??"#000",xi(this,Ii).fill();this._drawDate(e)}async _drawLoop(){let t,e;for(;!xi(this,Xi)&&xi(this,Pi)<xi(this,Ti);){Di(this,Pi,xi(this,Pi)+1),this._setRangeValue(),t=xi(this,Oi)[xi(this,Pi)][0],e=xi(this,Oi)[xi(this,Pi)][1];const i=(0,yi.HT)((s=>{this._drawMap(xi(this,Pi),t,e),(s>xi(this,ss)||xi(this,Xi))&&i.stop()}));this._drawNationLegend(e),await(0,dt._v)(1.1*xi(this,ss))}this._drawEnd()}_drawPowerMap(){this._drawLoop()}_initVoronoi(){const t=new Set([96,112,150,179,214,231,286,343,366]),e=xi(this,Vi).filter((e=>!t.has(e.id))).map((t=>t.coordinates)),i=bi.Z.from(e);Di(this,Ei,(0,J.Z)(e,(t=>t[1]))??xi(this,es).max);const s=[xi(this,es).min,xi(this,es).min,xi(this,es).max,xi(this,Ei)];Di(this,Ki,i.voronoi(s))}_initLegend(t){Di(this,Ni,(0,s.Z)("#na-map div").append("div").style("position","relative").style("width",`${t.width}px`).style("top",`-${t.top}px`).style("left",`${t.left}px`).attr("class","d-flex flex-column")),this._initController(),this._initNationLegend(t)}_initNationLegend(t){Di(this,Bi,Math.floor(40*l.L9)),Di(this,zi,Math.floor(l.L9)),Di(this,Ci,Math.floor(5*l.L9));const{width:e}=t,i=75+2*xi(this,Ci),s=dt.nU.length*i-2*xi(this,Ci);Di(this,Ji,Math.ceil(s/e)),Di(this,Mi,Math.ceil(dt.nU.length/xi(this,Ji))),Di(this,Li,Math.ceil(e/xi(this,Mi)-2*xi(this,Ci)));const a=xi(this,Ni).append("div");Di(this,Zi,a.append("div")),Di(this,Ai,a.append("div"))}_getTopPosition(t){let e=-1===t?-xi(this,Bi):Math.floor(t/xi(this,Mi))*(10*xi(this,zi)+xi(this,Bi));return e+=16+xi(this,Wi),`${e}px`}_getLeftPosition(t){return`${-1===t?-xi(this,Li):Math.floor(t%xi(this,Mi)*(xi(this,Ci)+xi(this,Li)))}px`}_resetOldIndex(){Di(this,Gi,new Map)}_drawNationLegend(t){const e=(0,fi.Q3)(t,(t=>t.length),(t=>t)).sort(((t,e)=>e[1]-t[1]||t[0]-e[0])),i=t.length;xi(this,Zi).selectAll("svg.svg-text").data(e,((t,e)=>String(e).padStart(2,"0")+String(t[0]).padStart(2,"0"))).join((t=>{const e=t.append("svg").attr("class","svg-text").attr("width",xi(this,Li)).attr("height",xi(this,Bi)+xi(this,zi)).style("position","absolute").style("top",(t=>this._getTopPosition(xi(this,Gi).get(t[0])??-1))).style("left",(t=>this._getLeftPosition(xi(this,Gi).get(t[0])??-1))).transition().duration(xi(this,ss)).style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e))).selection();return e.append("rect").attr("class","nation-header").attr("width",xi(this,Li)).attr("height",Math.floor(xi(this,Bi)/2)).style("fill",(t=>xi(this,ts).call(this,t[0]))),e.append("text").attr("class","nation-name").attr("x",Math.floor(xi(this,Ci)/2)).attr("y","25%").html((t=>`${(0,dt.dx)(t[0]).sortName}`)).style("fill",(t=>(0,pt.IF)(xi(this,ts).call(this,t[0])))),e.append("rect").attr("class","rect-background").attr("y",Math.floor(xi(this,Bi)/2+xi(this,zi))).attr("width","100%").attr("height",Math.floor(xi(this,Bi)/2)).style("fill",(t=>xi(this,ts).call(this,t[0]))),e.append("rect").attr("class","value").attr("y",Math.floor(xi(this,Bi)/2+xi(this,zi))).attr("height",Math.floor(xi(this,Bi)/2)).attr("width",(t=>xi(this,Li)*(t[1]/i))).style("fill",(t=>xi(this,ts).call(this,t[0]))),e.append("text").attr("class","value").attr("x",xi(this,Li)-xi(this,Ci)).attr("y","75%").style("text-anchor","end").html((t=>(0,m.Dw)(t[1],!0))),e}),(t=>(t.select("rect.value").attr("width",(t=>xi(this,Li)*(t[1]/i))).style("fill",(t=>xi(this,ts).call(this,t[0]))),t.select("text.value").html((t=>(0,m.Dw)(t[1],!0))),t))),xi(this,Ai).selectAll("svg.index").data(e,((t,e)=>e)).join((t=>{const e=t.append("svg").attr("class","index").attr("width",xi(this,Li)).attr("height",xi(this,Bi)+xi(this,zi)).style("position","absolute").style("top",((t,e)=>this._getTopPosition(e))).style("left",((t,e)=>this._getLeftPosition(e)));return e.append("text").attr("x",xi(this,Li)/2).attr("y",(xi(this,Bi)+xi(this,zi))/2).attr("fill",n.L$).attr("opacity",0).attr("text-anchor","middle").attr("dominant-baseline","mathematical").attr("font-variant","normal").attr("font-size",`${xi(this,Bi)}px`).text(((t,e)=>e+1)).transition().duration(xi(this,ss)).attr("opacity",.3).selection(),e}),(t=>t),(t=>t.attr("opacity",.3).transition().duration(xi(this,ss)).attr("opacity",0).remove().selection())),this._resetOldIndex();for(const[t,i]of e.entries())xi(this,Gi).set(i[0],t)}_getRangeValue(){return xi(this,Yi).property("value")}_setRangeValue(){xi(this,Yi).property("value",xi(this,Pi))}_updateRangeValue(t=!1){Di(this,Pi,Number.parseFloat(this._getRangeValue())),this._updateController(t)}_initRange(t){const e=`range-${xi(this,Qi)}`,i=t.append("div").attr("class","form-group col-md-7 form-row mb-0");Di(this,Yi,i.append("div").attr("class","col-md-5").append("input").attr("id",e).attr("type","range").attr("class","form-control-range custom-range px-md-2").attr("style","height:100%").attr("min","0").attr("max",String(xi(this,Ti)))),i.append("div").attr("class","col-md-1"),Di(this,$i,i.append("label").attr("for",e).attr("class","col-md-6 col-form-label").attr("style","font-size:120%").attr("title","Date").text("Start"));let s=!1;xi(this,Yi).on("change",(()=>{this._updateRangeValue()})).on("mousedown",(()=>{s=!0,Di(this,Xi,!0),this._togglePlayButton()})).on("mousemove",(()=>{s&&this._updateRangeValue(!0)})).on("mouseup",(()=>{s=!1}))}_getYear(t){return it()(xi(this,Oi)[t][0]).year()}_togglePlayButton(){xi(this,Hi).classed("icon-pause",!xi(this,Xi)).classed("icon-play",xi(this,Xi))}_initialMapZoom(){xi(this,Ui).zoomAndPan(xi(this,es).max/2,xi(this,es).max/2,!0)}_updateController(t=!1){const e=xi(this,Oi)[xi(this,Pi)][0],i=xi(this,Oi)[xi(this,Pi)][1];this._setRangeValue(),this._drawDate(e),this._adjustControllerHeight(),Di(this,Xi,!0),this._togglePlayButton(),t||(this._resetOldIndex(),this._drawMap(xi(this,Pi),e,i),this._drawNationLegend(i))}_initButtons(t){const e=`button-${xi(this,Qi)}`,i=(t,i)=>a.append("button").attr("type","button").attr("id",`${e}-${t}`).attr("class","btn btn-default icon-button p-0").attr("title",i).append("i").attr("class",`icon icon-large icon-${t}`),s=t.append("div").attr("class","btn-toolbar col-md-4").attr("role","toolbar");let a=s.append("div").attr("class","btn-group").attr("role","group");const o=i("start","Start"),r=i("back","Year back");a=s.append("div").attr("class","btn-group").attr("role","group"),Di(this,Hi,i("pause","Pause")),a=s.append("div").attr("class","btn-group mr-3").attr("role","group");const n=i("forward","Year forward"),l=i("end","End");o.on("click",(()=>{Di(this,Pi,0),this._updateController()})),r.on("click",(()=>{let t=xi(this,Pi);const e=this._getYear(t);let i=e;for(;t>0&&i===e;t--)i=this._getYear(t);Di(this,Pi,t+1),this._updateController()})),xi(this,Hi).on("click",(()=>{Di(this,Xi,!xi(this,Xi)),this._togglePlayButton(),xi(this,Xi)||this._drawLoop()})),n.on("click",(()=>{let t=xi(this,Pi);const e=this._getYear(t);let i=e;for(;t<xi(this,Ti)&&i===e;t++)i=this._getYear(t);Di(this,Pi,t-1),this._updateController()})),l.on("click",(()=>{Di(this,Pi,xi(this,Ti)),this._updateController()})),a=s.append("div").attr("class","btn-group").attr("role","group");const d=i("slower","Slower"),h=i("normal","Normal speed"),p=i("faster","Faster");d.on("click",(()=>{Di(this,ss,xi(this,ss)*xi(this,as))})),h.on("click",(()=>{Di(this,ss,xi(this,is))})),p.on("click",(()=>{Di(this,ss,Math.max(10,xi(this,ss)/xi(this,as)))})),a=t.append("div").attr("class","btn-group col-md-1").attr("role","group");i("close","Close").on("click",(()=>{this._drawEnd(),xi(this,Fi).remove(),this._initialMapZoom()}))}_adjustControllerHeight(){Di(this,Wi,(0,n.Uy)(xi(this,ji))),xi(this,Ni).selectAll("svg.svg-text").style("top",((t,e)=>this._getTopPosition(e))),xi(this,Ni).selectAll("svg.index").style("top",((t,e)=>this._getTopPosition(e)))}_initController(){const t=xi(this,Ni).append("div").style("background-color",n.L$).attr("class","p-2");Di(this,ji,t.node());const e=t.append("form").append("div").attr("class","form-row align-items-center"),i=new ResizeObserver((()=>{this._adjustControllerHeight()}));this._initRange(e),this._initButtons(e),Di(this,Wi,(0,n.Uy)(xi(this,ji))),i.observe(xi(this,ji))}_getTopAlignedTransform(t){const{a:e,e:i}=t.transform.baseVal.consolidate().matrix;return o.CR.scale(e).translate(i/e,0)}async _initCanvas(){const t=(0,s.Z)("#na-map svg g.map-tiles"),e=this._getTopAlignedTransform(xi(this,Ri).node()),i=this._getTopAlignedTransform(t.node());xi(this,Ri).attr("transform",e.toString()),t.attr("transform",i.toString());const a=(0,s.Z)("#na-map svg"),o=a.style("height"),r=a.style("width");Di(this,Fi,(0,s.Z)("#na-map").append("div").style("position","relative").style("top",`-${o}`).style("height","100%").style("opacity",.7));const l=xi(this,Fi).append("canvas").node();l.style.height=o,l.style.width=r,l.height=Math.floor(2*Number.parseFloat(o)),l.width=Math.floor(2*Number.parseFloat(r)),Di(this,Ii,(0,n.kU)(l)),xi(this,Ii).translate(2*e.x,2*e.y),xi(this,Ii).scale(2*e.k,2*e.k);const d=(0,n.mx)(t.node()),h={top:Math.floor(this.map.height-xi(this,Ei)*e.k+e.y),left:e.x,width:d};this._initLegend(h),await this._setPattern()}_menuItemSelected(){(0,n.dM)(),this._mapElementsOff(),this._initialMapZoom(),this._initVoronoi(),this._initCanvas(),this._drawPowerMap()}}var rs=i(3609);function ns(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function ls(t,e,i){var s=e.get(t);if(!s)throw new TypeError("attempted to set private field on non-instance");if(s.set)s.set.call(t,i);else{if(!s.writable)throw new TypeError("attempted to set read only private field");s.value=i}return i}function ds(t,e){var i=e.get(t);if(!i)throw new TypeError("attempted to get private field on non-instance");return i.get?i.get.call(t):i.value}var hs=new WeakMap,ps=new WeakMap,cs=new WeakMap,us=new WeakMap,_s=new WeakMap,ms=new WeakMap,gs=new WeakMap,vs=new WeakMap,ws=new WeakMap,fs=new WeakMap,bs=new WeakMap,ys=new WeakMap,Ss=new WeakMap,ks=new WeakMap,xs=new WeakMap,Ds=new WeakMap,Ms=new WeakMap,Is=new WeakMap,$s=new WeakMap;class Ts{constructor(t,e){ns(this,"coord",void 0),ns(this,"f11",void 0),ns(this,"gridOverlay",void 0),ns(this,"height",0),hs.set(this,{writable:!0,value:5}),ns(this,"minMapScale",1),ps.set(this,{writable:!0,value:256}),cs.set(this,{writable:!0,value:this.minMapScale}),us.set(this,{writable:!0,value:this.minMapScale}),_s.set(this,{writable:!0,value:!1}),ms.set(this,{writable:!0,value:256}),gs.set(this,{writable:!0,value:1}),vs.set(this,{writable:!0,value:.25}),ws.set(this,{writable:!0,value:2}),fs.set(this,{writable:!0,value:{}}),bs.set(this,{writable:!0,value:[0,0]}),ys.set(this,{writable:!0,value:{}}),Ss.set(this,{writable:!0,value:{}}),ks.set(this,{writable:!0,value:0}),xs.set(this,{writable:!0,value:0}),Ds.set(this,{writable:!0,value:0}),Ms.set(this,{writable:!0,value:0}),Is.set(this,{writable:!0,value:{}}),$s.set(this,{writable:!0,value:{}}),ns(this,"rem",l.jo),ns(this,"serverName",void 0),ns(this,"showGrid",void 0),ns(this,"showTrades",void 0),ns(this,"width",0),ns(this,"xGridBackgroundHeight",void 0),ns(this,"yGridBackgroundWidth",void 0),ns(this,"_doubleClickAction",void 0),ns(this,"_grid",void 0),ns(this,"_journey",void 0),ns(this,"_pbZone",void 0),ns(this,"_ports",void 0),ns(this,"_portSelect",void 0),ns(this,"_showGrid",void 0),ns(this,"_svg",void 0),ns(this,"_zoomLevel",void 0),ns(this,"_doubleClickActionCookie",void 0),ns(this,"_doubleClickActionId",void 0),ns(this,"_doubleClickActionRadios",void 0),ns(this,"_doubleClickActionValues",void 0),ns(this,"_searchParams",void 0),ns(this,"_showGridCookie",void 0),ns(this,"_showGridId",void 0),ns(this,"_showGridRadios",void 0),ns(this,"_showGridValues",void 0),this.serverName=t,this._searchParams=e,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:d.zb},this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new p.Z({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new c.Z(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new p.Z({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new c.Z(this._showGridId,this._showGridValues),this.showGrid=this._getShowGridValue(),this.gridOverlay=document.querySelectorAll(".overlay")[0],this._setHeightWidth(),this._setupSvg(),this._setSvgSize(),this._setupTiler(),this._setupListener()}static _initModal(t){(0,n.Eu)({id:t,title:`${n.xw} <span class="text-primary small">v${n.f4}</span>`,size:"modal-lg"});(0,s.Z)(`#${t} .modal-body`).html(`<p>${n.FB} Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/">Game-Labs forum post</a> for further details. Feedback is very welcome.</p>\n                    <p>Designed by iB aka Felix Victor, <em>Bastards</em> clan ${(0,h.Mo)("(BSTD)")}</a>.</p>\n                    <div class="alert alert-secondary" role="alert"><h5 class="alert-heading">Did you know?</h5><p class="mb-0">My clan mate, Aquillas, wrote a most comprehensive <a href="https://drive.google.com/file/d/1K6xCXtCUd68PPzvNjBxD5ffgE_69VEoc/view">user guide</a>.</p></div>`)}static _stopProperty(t){t.defaultPrevented&&t.stopPropagation()}async MapInit(){await this._setupData()}_getDoubleClickAction(){const t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t}_getShowGridValue(){const t=this._showGridCookie.get();return this._showGridRadios.set(t),t}async _setupData(){this.f11=new ke(this,this.coord),this._ports=new me(this),await this._ports.init(),this._pbZone=new O(this._ports,this.serverName),this._grid=new Z(this),this._portSelect=new be(this._ports,this._pbZone,this),this.showTrades=new Le(this.serverName,this._portSelect,this.minMapScale,ds(this,fs)),await this.showTrades.showOrHide(),this._init(),this._journey=new Ee(this.rem),new wi(this._ports),new os(this,this.serverName,this.coord)}_setupListener(){this._svg.on("dblclick.zoom",null).on("click",(t=>{Ts._stopProperty(t)}),!0).on("dblclick",(t=>{this._doDoubleClickAction(t)})),document.querySelector("#propertyDropdown")?.addEventListener("click",(()=>{(0,r.KS)("Menu","Select port on property")})),document.querySelector("#settingsDropdown")?.addEventListener("click",(()=>{(0,r.KS)("Menu","Settings")})),document.querySelector("#button-download-pb-calc")?.addEventListener("click",(()=>{(0,r.KS)("Tools","Download pb calculator")})),document.querySelector("#reset")?.addEventListener("click",(()=>{this._clearMap()})),document.querySelector("#about")?.addEventListener("click",(()=>{this._showAbout()})),document.querySelector("#double-click-action")?.addEventListener("change",(()=>{this._doubleClickSelected()})),document.querySelector("#show-grid")?.addEventListener("change",(()=>{this._showGridSelected()}))}_setupSvg(){ls(this,Ss,(0,o.sP)().scaleExtent([this.minMapScale,ds(this,ps)]).wheelDelta((t=>-ds(this,gs)*Math.sign(t.deltaY))).on("zoom",(t=>{this._naZoomed(t)}))),this._svg=(0,s.Z)("#na-map").append("svg").attr("id","na-svg").call(ds(this,Ss)),this._svg.append("defs"),ls(this,Is,this._svg.append("g").attr("class","map-tiles")),ls(this,$s,this._svg.append("g").attr("id","map"))}_setupTiler(){ls(this,ks,ds(this,fs)[0][0]),ls(this,xs,ds(this,fs)[1][0]),ls(this,Ds,ds(this,fs)[0][1]),ls(this,Ms,ds(this,fs)[1][1])}_doubleClickSelected(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()}_showGridSelected(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._grid.update()}_drawMap(t){const e=Math.log2(t.k)<=ds(this,hs)?0:ds(this,hs)-Math.log2(t.k),i=ds(this,ms)*t.k,s={tiles:[]},a=Math.log2(i/ds(this,ms)),o=Math.round(Math.max(a+e,0)),r=2**(a-o)*ds(this,ms),n=t.x-i/2,l=t.y-i/2,d=Math.max(0,Math.floor((ds(this,ks)-n)/r)),h=Math.min(1<<o,Math.ceil((ds(this,xs)-n)/r)),p=Math.max(0,Math.floor((ds(this,Ds)-l)/r)),c=Math.min(1<<o,Math.ceil((ds(this,Ms)-l)/r));for(let t=p;t<c;++t)for(let e=d;e<h;++e)s.tiles.push([e,t,o]);if(s.translate=[n/r,l/r],s.scale=r,s.tiles.length>0){const t=2**(o+Math.abs(e)),i=this.coord.max/t*2**Math.abs(e);ls(this,ys,[[d*i,p*i],[h*i,c*i]]),ls(this,bs,[s.translate[0]*s.scale,s.translate[1]*s.scale]),this._updateMap(s)}}_updateMap(t){const{translate:[e,i],scale:s,tiles:a}=t;ds(this,Is).attr("transform",`translate(${e*s},${i*s}) scale(${s})`).selectAll("image").data(a,(t=>t)).join((t=>t.append("image").attr("xlink:href",(([t,e,i])=>`images/map/${i}/${e}/${t}.webp`)).attr("x",(([t])=>t)).attr("y",(([,t])=>t)).attr("width",1).attr("height",1)))}_clearMap(){this.f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),rs(".selectpicker").val("default").selectpicker("refresh")}_showAbout(){const t="modal-about";document.querySelector(`#${t}`)||Ts._initModal(t),rs(`#${t}`).modal("show")}_doDoubleClickAction(t){const[e,i]=(0,a.Z)(t,ds(this,$s).node());"f11"===this._doubleClickAction?this.f11.printCoord(e,i):this._journey.plotCourse(e,i),this.zoomAndPan(e,i)}_setZoomLevelAndData(t){const e=this._getMapScale(t.k);e!==ds(this,cs)&&(ls(this,cs,e),ds(this,cs)>ds(this,ws)?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):ds(this,cs)>ds(this,vs)?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(ds(this,cs))}_getMapScale(t){return 2**(Math.log2(t)-ds(this,hs))}_getMapTransform(t){const e=this._getMapScale(t.k);return o.CR.scale(e).translate(ds(this,bs)[0]/e,ds(this,bs)[1]/e)}_naZoomed(t){const{transform:e}=t;this._drawMap(e),this._ports.setBounds(ds(this,ys)),this._pbZone.setBounds(ds(this,ys)),this.showTrades.setBounds(ds(this,ys));const i=this._getMapTransform(e);this._grid.transform(i),this.showTrades.transform(i),ds(this,$s).attr("transform",i.toString()),this._setZoomLevelAndData(e)}_checkF11Coord(){this._searchParams.has("x")&&this._searchParams.has("z")&&this.f11.goToF11FromParam(this._searchParams)}_init(){this.zoomLevel="initial",ls(this,us,this._getInitialMapScale()),this._initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight(),document.querySelector("#navbar-left")?.classList.remove("d-none")}get zoomLevel(){return this._zoomLevel}set zoomLevel(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t}getDimensions(){return document.querySelectorAll(".overlay")[0].getBoundingClientRect()}_getWidth(){const{width:t}=this.getDimensions();return Math.floor(t)}_getHeight(){const{top:t}=this.getDimensions(),e=document.documentElement.clientHeight-this.rem;return Math.floor(e-t)}_setHeightWidth(){this.width=this._getWidth(),this.height=this._getHeight(),ls(this,fs,[[0,0],[this.width,this.height]])}_setSvgSize(){this._svg.attr("width",this.width).attr("height",this.height)}_setFlexOverlayHeight(){const t=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);document.querySelector("#summary-column")?.setAttribute("style",`height:${t}px`)}_getInitialMapScale(){let t=(0,l.XH)(Math.min(this.height,this.width)/ds(this,ms));const e=this.height*this.width;return e-(ds(this,ms)*t)**2>(ds(this,ms)*t*2)**2-e&&(t*=2,ls(this,_s,!0)),t}_setTranslateExtent(t){let e=t;if(ds(this,_s)){const i=2,s=t.k/i,a=t.x/i,r=t.y/i;e=o.CR.scale(s).translate(a,r)}ds(this,Ss).translateExtent([e.invert(ds(this,fs)[0]),e.invert(ds(this,fs)[1])])}_initialZoomAndPan(){const t=this.zoomAndPan(this.coord.max/2,this.coord.max/2,!0);this._setTranslateExtent(t)}zoomAndPan(t,e,i=!1){const s=i?ds(this,us):32,a=o.CR.scale(s).translate(Math.floor((-t+this.coord.max/2+this.width/2)/s),Math.floor(-e+this.coord.max/2+this.height/2)/s);return this._svg.call(ds(this,Ss).transform,a),a}goToPort(){0===this._ports.currentPort.id?this._initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y)}}},9313:t=>{t.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' height='300' width='300' viewBox='0 0 512 512'%3e%3cpath fill='%2356430c' fill-opacity='.7' d='M438 411.3l-37.6-37.6c.1-.2.1-.2.1-.4 9.7-20.8 6.2-46.3-11-63.5L363 336.3l-80.5-80.5 96.6-96.6c24-24 37.5-56.6 37.5-90.5L256 229.3 95.4 68.7c0 34 13.5 66.5 37.5 90.5l96.6 96.6-80.5 80.5-26.5-26.5c-17.2 17.2-20.7 42.7-11 63.5.1.2.1.2.1.4L74 411.3c-7.3 7.3-7.3 19.2 0 26.5 7.3 7.3 19.2 7.3 26.5 0l37.6-37.6c.2.1.2.1.4.1 20.8 9.7 46.3 6.2 63.5-11l-26.5-26.5 80.5-80.5 80.5 80.5-26.5 26.6c17.2 17.2 42.7 20.7 63.5 11 .1-.1.2-.1.4-.1l37.6 37.6c7.3 7.3 19.2 7.3 26.5 0 7.3-7.4 7.3-19.3 0-26.6z'/%3e%3c/svg%3e"}}]);