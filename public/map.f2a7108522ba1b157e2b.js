(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"+42d":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"/foq":function(t,e,i){t.exports=i.p+"icons/PRa.svg"},"0siz":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath d='M0 0h640v480H0V0z' fill='%23aa151b'/%3E%3Cpath d='M0 120h640v240H0V120z' fill='%23f1bf00'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"1qWw":function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return c});i("iPZ8"),i("kypl"),i("pCzD"),i("lYjL"),i("4owi"),i("/YXa"),i("8cZI"),i("lmye"),i("aOEW"),i("D/wG"),i("1Qwx"),i("fp7Y"),i("JBxO"),i("9UJh"),i("WoWj"),i("3dw1"),i("U00V");var n=i("nUlG"),a=i("f4w0"),r=i("Av7d"),o=i("0lY5"),s=i("4PeS");function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){function e(t){var e=this;this._ports=t,this._NumberOfInputs=3,this._baseName="Get position",this._baseId="get-position",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._modal$=null,this._select=[],this._input=[],this._selector=[],d(new Array(this._NumberOfInputs).keys()).forEach(function(t){e._select[t]=e._baseId+"-"+t+"-select",e._input[t]=e._baseId+"-"+t+"-input"}),this._setupListener()}var i=e.prototype;return i._navbarClick=function(t){Object(a.b)("Menu","Get position"),t.stopPropagation(),this._positionSelected()},i._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",function(e){return t._navbarClick(e)})},i._injectModal=function(){var t=this;Object(r.D)(this._modalId,this._baseName,"","Go");var e=Object(n.f)("#"+this._modalId+" .modal-body");e.append("div").attr("class","alert alert-primary").attr("role","alert").text("Use in-game trader tool.");var i=e.append("form"),a=i.append("datalist").attr("id","defaultDistances");[5,10,15,20,30,50,100,200].forEach(function(t){a.append("option").attr("value",t)}),d(new Array(this._NumberOfInputs).keys()).forEach(function(e){var n=i.append("div").attr("class","form-row");n.append("div").attr("class","col-md-6").append("label").append("select").attr("name",t._select[e]).attr("id",t._select[e]).attr("class","selectpicker"),n.append("div").attr("class","col-md-6").append("input").attr("id",t._input[e]).attr("name",t._input[e]).attr("type","number").attr("class","form-control").attr("placeholder","Distance in k").attr("step",1).attr("list","defaultDistances").attr("min",0).attr("max",1e3)})},i._setupSelects=function(){var e=this,i=""+this._ports.portDataDefault.map(function(t){return{id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}}).sort(Object(o.K)(["name"])).map(function(t){return'<option data-subtext="'+t.nation+'">'+t.name+"</option>"}).join("");d(new Array(this._NumberOfInputs).keys()).forEach(function(n){e._selector[n]=document.getElementById(e._select[n]),e._selector[n].insertAdjacentHTML("beforeend",i),t(e._selector[n]).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Select port",virtualScroll:!0})})},i._initModal=function(){this._injectModal(),this._setupSelects()},i._useUserInput=function(){var t=this,e=new Map;d(new Array(this._NumberOfInputs).keys()).forEach(function(i){var n=t._selector[i].selectedIndex?t._selector[i].options[t._selector[i].selectedIndex].text:"",a=Number(document.getElementById(t._input[i]).value);a&&""!==n&&e.set(n,1.04*a*r.e)}),e.size===this._NumberOfInputs?(this._ports.setShowRadiusSetting("position"),this._ports.portData=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(function(t){return e.has(t.name)}).map(function(t){return t.distance=e.get(t.name),t}))),this._ports.update(),function(){var e=t._ports.portData.map(function(t){return{x:t.coordinates[0],y:t.coordinates[1],z:0,r:t.distance}}),i=function(t,e,i,n){void 0===n&&(n=!1);var a=function(t){return t*t},r=function(t){return Math.sqrt(a(t.x)+a(t.y)+a(t.z))},o=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},s=function(t,e){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},d=function(t,e){return{x:t.x+e.x,y:t.y+e.y,z:t.z+e.z}},c=function(t,e){return{x:t.x/e,y:t.y/e,z:t.z/e}},l=function(t,e){return{x:t.x*e,y:t.y*e,z:t.z*e}},h=c(s(e,t),r(s(e,t))),u=o(h,s(i,t)),p=s(s(i,t),l(h,u)),_=c(p,r(p)),m=function(t,e){return{x:t.y*e.z-t.z*e.y,y:t.z*e.x-t.x*e.z,z:t.x*e.y-t.y*e.x}}(h,_),f=r(s(e,t)),g=o(_,s(i,t)),v=(a(t.r)-a(e.r)+a(f))/(2*f),b=(a(t.r)-a(i.r)+a(u)+a(g))/(2*g)-u/g*v,y=a(t.r)-a(v)-a(b);Math.abs(y)<1e-10&&(y=0);var w=Math.sqrt(y);if(isNaN(w))return null;p=d(t,d(l(h,v),l(_,b)));var S=d(p,l(m,w)),x=s(p,l(m,w));return 0===w||n?p:[S,x]}(e[0],e[1],e[2],!0);if(i){i.x=Math.round(i.x),i.y=Math.round(i.y),t._ports._map._f11.printCoord(i.x,i.y),t._ports._map.zoomAndPan(i.x,i.y,1);var n=Math.round(Object(r.p)(i.x,i.y)/-1e3),a=Math.round(Object(r.q)(i.x,i.y)/-1e3);Object(o.g)(n,a),new s.a("Get position","Coordinates copied to clipboard.")}else new s.a("Get position","No intersection found.")}()):new s.a("Get position","Not enough data.")},i._positionSelected=function(){var e=this;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId)),this._modal$.modal("show").one("hidden.bs.modal",function(){e._useUserInput()})},e}()}).call(this,i("xeH2"))},"28Wg":function(t,e,i){t.exports=i.p+"icons/USa.svg"},"4PeS":function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return r});var n=i("nUlG"),a=(i("3XUK"),i("9q+R"),i("Av7d")),r=function(){function e(e,i){this._title=e,this._text=i,this._setupDiv(),this._set(e,i),t(this._toast.node()).toast({autohide:!1}).toast("show"),window.setTimeout(this._remove.bind(this),1e4)}var i=e.prototype;return i._setupDiv=function(){this._mainDiv=Object(n.f)("#toast-section")},i._set=function(){this._toast=this._mainDiv.append("div").attr("class","toast").attr("role","alert").attr("aria-live","assertive").attr("aria-atomic","true");var t=this._toast.append("div").attr("class","toast-header");t.append("img").attr("class","rounded mr-2").attr("src",a.A).attr("alt","logo"),t.append("em").attr("class","mr-auto").html(this._title),t.append("button").attr("type","button").attr("class","ml-2 mb-1 close").attr("data-dismiss","toast").attr("aria-label","Close").append("span").attr("aria-hidden","true").html("&times;"),this._toast.append("div").attr("class","toast-body").html(this._text)},i._remove=function(){this._toast.remove()},e}()}).call(this,i("xeH2"))},"62GW":function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return l});i("fp7Y"),i("SQIU"),i("SgDD");var n=i("nUlG"),a=i("aBO9"),r=i("TiKg"),o=i.n(r),s=(i("YmdP"),i("W/Hz"),i("8sDi"),i("cRa1"),i("+NlM"),i("kCRU"),i("0lY5")),d=i("f4w0"),c=i("Av7d"),l=function(){function e(){this._height=300,this._width=260,this._windArrowWidth=3,this._baseName="Predict wind",this._baseId="predict-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._timeGroupId="input-group-"+this._baseId,this._timeInputId="input-"+this._baseId,this._setupSvg(),this._setupArrow(),this._setupListener()}var i=e.prototype;return i._setupSvg=function(){this._svg=Object(n.f)("#wind svg")},i._setupArrow=function(){var t=this._windArrowWidth,e=2*this._windArrowWidth;Object(n.f)("#na-svg defs").append("marker").attr("id","wind-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d","M0,-"+t+"L"+e+",0L0,"+t).classed("wind-head",!0)},i._navbarClick=function(t){Object(d.b)("Menu",this._baseName),t.stopPropagation(),this._windSelected()},i._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",function(e){return t._navbarClick(e)})},i._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=function(t){return Object(s.l)(t.value)+"<br>"+t.value+"Â°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/s.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},i._injectModal=function(){o.a.locale("en-gb"),Object(c.D)(this._modalId,this._baseName,"sm");var e=Object(n.f)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId),i=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);i.append("label").attr("for",this._sliderId).text("Current in-game wind"),i.append("div").attr("id",this._sliderId).attr("class","rslider");var a=e.append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);a.append("label").attr("for",this._timeInputId).text("Predict time (server time)");var r=a.append("div").classed("input-group date",!0).attr("id",this._timeGroupId).attr("data-target-input","nearest");r.append("input").classed("form-control datetimepicker-input",!0).attr("type","text").attr("id",this._timeInputId).attr("data-target","#"+this._timeGroupId).attr("aria-label",this._timeGroupId).attr("required",""),r.append("div").classed("input-group-append",!0).attr("data-target","#"+this._timeGroupId).attr("data-toggle","datetimepicker").append("span").classed("input-group-text",!0).append("i").classed("far fa-clock",!0),t("#"+this._timeGroupId).datetimepicker({defaultDate:o.a.utc(),format:"LT"})},i._initModal=function(){this._injectModal(),this._setupWindInput()},i._windSelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",function(){e._useUserInput()})},i._useUserInput=function(){var e=Object(s.C)(this._sliderId),i=t("#"+this._timeInputId).val().trim();this._predictWind(e,i)},i._predictWind=function(t,e){o.a.locale("en-gb");var i,n=/(\d+)[\s:.](\d+)/.exec(e),a=parseInt(n[1],10),r=parseInt(n[2],10);i=Number.isNaN(Number(t))?Object(s.f)(t):Number(t);var d=o()().utc().seconds(0).milliseconds(0),l=o()(d).hour(a).minutes(r);l.isBefore(d)&&l.add(1,"day");var h=l.diff(d,"seconds"),u=360+(i-c.t*h)%360;this._printPredictedWind(u,l.format("H.mm"),Object(s.i)(t),d.format("H.mm"))},i._printCompass=function(t){var e=Object(a.e)(),i=Math.min(this._height/1.4,this._width/1.4)/2,n=this._width/2,r=this._height/2.8,o=Object(s.j)(t),d=.6*i,c=d*Math.cos(o),l=d*Math.sin(o),h=[[Math.round(n+c),Math.round(r+l)],[Math.round(n-c),Math.round(r-l)]];this._svg.attr("height",this._height).attr("width",this._width);var u=this._svg.append("svg").attr("class","compass").classed("compass",!0).attr("x",n).attr("y",r);Object(s.F)({element:u,radius:i}),this._svg.append("path").datum(h).attr("d",e).classed("wind",!0).attr("marker-end","url(#wind-arrow)")},i._printText=function(t,e,i,n){var a=Object(s.i)(t),r=parseInt(window.getComputedStyle(document.getElementById("wind")).getPropertyValue("line-height"),10),o=this._svg.append("svg"),d=o.append("text").attr("x","50%").attr("y","33%").attr("class","wind-text").html("From "+Object(s.m)(a,!0)+" at "+e),c=o.append("text").attr("x","50%").attr("y","66%").attr("class","wind-text-current").html("Currently at "+n+" from "+Object(s.m)(i,!0)),l=d.node().getBoundingClientRect(),h=c.node().getBoundingClientRect(),u=2*Math.max(l.height,h.height)+r,p=Math.max(l.width,h.width)+r;o.attr("x",(this._width-p)/2).attr("y","72%").attr("height",u).attr("width",p)},i._addBackground=function(){this._svg.insert("rect",":first-child").attr("x",0).attr("y",0).attr("height",this._height).attr("width",this._width)},i._printPredictedWind=function(t,e,i,n){this.clearMap(),this._svg.classed("d-none",!1),this._printCompass(t),this._printText(t,e,i,n),this._addBackground()},i.setPosition=function(t,e){this._svg.style("margin-left",e+"px").style("margin-top",t+"px")},i.clearMap=function(){this._svg.selectAll("*").remove(),this._svg.classed("d-none",!0)},e}()}).call(this,i("xeH2"))},"7chY":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},"8gAj":function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return v});i("iPZ8"),i("kypl"),i("pCzD"),i("C4nn"),i("4owi"),i("/YXa"),i("lmye"),i("D/wG"),i("fp7Y"),i("JBxO"),i("9UJh"),i("WoWj"),i("aZFp"),i("SgDD"),i("3dw1"),i("U00V");var n=i("NsF1"),a=i("/Cyf"),r=i("IVJf"),o=i("wbYc"),s=i("nUlG"),d=i("aBO9"),c=i("NRFW"),l=i("TiKg"),h=i.n(l),u=(i("YmdP"),i("W/Hz"),i("8sDi"),i("f4w0")),p=i("Av7d"),_=i("0lY5"),m=i("iSiJ"),f=i("pFgi");function g(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var v=function(){function e(t,e,i,n){this._shipData=t,this._woodData=e,this._moduleData=i,this._fontSize=n,this._compassRadius=90,this._courseArrowWidth=5,this._line=Object(d.e)().x(function(t){return t[0]}).y(function(t){return t[1]}),this._labelPadding=20,this._degreesPerMinute=p.t/60,this._degreesSegment=15,this._minOWSpeed=2,this._owSpeedFactor=2,this._speedScale=Object(o.b)().domain(Object(a.e)(0,p.u,this._degreesSegment)),this._defaultShipName="None",this._defaultShipSpeed=19,this._defaultStartWindDegrees=0,this._baseName="Make journey",this._baseId="make-journey",this._buttonId="button-"+this._baseId,this._compassId="compass-"+this._baseId,this._deleteLastLegButtonId="button-delete-leg-"+this._baseId,this._modalId="modal-"+this._baseId,this._sliderId="slider-"+this._baseId,this._shipId="ship-journey",this._woodId="wood-journey",this._setupSummary(),this._setupDrag(),this._setupSvg(),this._initJourneyData(),this._setupListener()}var i=e.prototype;return i._setupDrag=function(){var t=this;this._drag=Object(r.a)().on("start",function(e,i,n){t._removeLabels(),Object(s.f)(n[i]).classed("drag-active",!0)}).on("drag",function(e,i,n){0===i&&t._compass.attr("x",e.position[0]+s.b.dx).attr("y",e.position[1]+s.b.dy),Object(s.f)(n[i]).attr("cx",s.b.x).attr("cy",s.b.y),e.position=[e.position[0]+s.b.dx,e.position[1]+s.b.dy],t._printLines()}).on("end",function(e,i,n){Object(s.f)(n[i]).classed("drag-active",!1),t._printJourney()})},i._setupSvg=function(){var t=this._courseArrowWidth,e=2*this._courseArrowWidth;this._g=Object(s.f)("#na-svg").insert("g","g.pb").classed("coord",!0),Object(s.f)("#na-svg defs").append("marker").attr("id","course-arrow").attr("viewBox","0 -"+t+" "+e+" "+e).attr("refX",t).attr("refY",0).attr("markerWidth",t).attr("markerHeight",t).attr("orient","auto").append("path").attr("d","M0,-"+t+"L"+e+",0L0,"+t).classed("course-head",!0)},i._initJourneyData=function(){this._journey={shipName:this._defaultShipName,woodNames:"",startWindDegrees:this._defaultStartWindDegrees,currentWindDegrees:this._defaultStartWindDegrees,totalDistance:0,totalMinutes:0,segment:[{position:[null,null],label:""}]}},i._resetJourneyData=function(){this._journey.startWindDegrees=this._getStartWind(),this._journey.currentWindDegrees=this._journey.startWindDegrees,this._journey.totalDistance=0,this._journey.totalMinutes=0},i._navbarClick=function(t){Object(u.b)("Menu","Journey"),t.stopPropagation(),this._journeySelected()},i._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("mouseup",function(e){return t._navbarClick(e)}),document.getElementById(this._deleteLastLegButtonId).addEventListener("mouseup",function(){return t._deleteLastLeg()})},i._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=function(t){return Object(_.l)(t.value)+"<br>"+t.value+"Â°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/_.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},i._injectModal=function(){var t=this;Object(p.D)(this._modalId,this._baseName,"sm");var e=Object(s.f)("#"+this._modalId+" .modal-body").append("form").append("div").attr("class","form-group"),i=e.append("div").classed("alert alert-primary",!0).attr("role","alert");i.append("label").attr("for",this._sliderId).text("Current in-game wind"),i.append("div").attr("id",this._sliderId).attr("class","rslider");var n=this._shipId+"-Base-select",a=e.append("div").classed("alert alert-primary",!0).attr("role","alert").append("div").attr("class","d-flex flex-column");a.append("label").attr("for",n).text("Ship and woods (optional)"),a.append("select").attr("name",n).attr("id",n),["frame","trim"].forEach(function(e){var i=t._woodId+"-"+e+"-Base-select";a.append("label").attr("for",i),a.append("select").attr("name",i).attr("id",i)})},i._initModal=function(){this._injectModal(),this._setupWindInput(),this._shipCompare=new m.a({shipData:this._shipData,woodData:this._woodData,moduleData:this._moduleData,id:this._shipId}),this._woodCompare=new f.a(this._woodData,this._woodId)},i._useUserInput=function(){this._resetJourneyData(),this._journey.startWindDegrees=this._getStartWind(),this._setShipName(),this._printSummary(),this._printJourney()},i._journeySelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",function(){e._useUserInput()})},i._printCompass=function(){var t=this._journey.segment[0].position[0],e=this._journey.segment[0].position[1];this._compass=this._g.append("svg").attr("id",this._compassId).attr("class","compass").attr("x",t).attr("y",e).call(this._drag),this._compassG=this._compass.append("g"),Object(_.F)({element:this._compassG,radius:this._compassRadius})},i._removeCompass=function(){this._compass.remove()},i._getSpeedAtDegrees=function(t){return Math.max(this._speedScale(t),this._minOWSpeed)},i._calculateDistanceForSection=function(t,e){var i=(p.u-t+e)%p.u;return this._getSpeedAtDegrees(i)*this._owSpeedFactor*p.L},i._getStartWind=function(){var e=t("#"+this._sliderId),i=Number(e.roundSlider("getValue"));return e.length?i:0},i._setShipSpeed=function(){var t=[];t=this._journey.shipName===this._defaultShipName?g(new Array(24).fill(this._defaultShipSpeed/2)):this._shipCompare._singleShipData.speedDegrees,this._speedScale.range(t)},i._calculateMinutesForSegment=function(t,e,i){var n=i,a=e,r=0;for(this._setShipSpeed();n>0;){var o=this._calculateDistanceForSection(t,a);n>o?(n-=o,r+=1):(r+=n/o,n=0),a=(p.u+a-this._degreesPerMinute)%p.u}return this._journey.currentWindDegrees=a,r},i._setShipName=function(){if(this._shipCompare&&this._shipCompare._singleShipData&&this._shipCompare._singleShipData.name){var t=this._shipCompare._woodCompare.getWoodTypeData("frame",this._shipCompare._woodCompare._woodsSelected.Base.frame).name,e=this._shipCompare._woodCompare.getWoodTypeData("trim",this._shipCompare._woodCompare._woodsSelected.Base.trim).name;this._journey.shipName=""+this._shipCompare._singleShipData.name,this._journey.woodNames=t+"/"+e}else this._journey.shipName=this._defaultShipName,this._journey.woodNames=""},i._removeLabels=function(){var t=this._g.selectAll("g.coord g.label");t.select("text").remove(),t.select("rect").remove()},i._correctJourney=function(){var t=Object(c.c)(Object(s.f)("#na-svg").node()),e=Math.max(1,t.k),i=this._fontSize/e,n=c.b.translate(20/e,20/e),a=this._labelPadding/e,r=10/e,o=5/e;this._g.selectAll("g.coord g.label").each(function(t,e,o){var d=Object(s.f)(o[e]),c=d.select("text"),l=t.label.split("|"),h=1.3*i;c.text("").attr("dy",0).attr("transform",n).style("font-size",i+"px"),l.forEach(function(t,e){var i=c.append("tspan").html(t);e>0&&i.attr("x",0).attr("dy",h)});var u=c.node().getBBox(),p=t.label?u.width+2*a:0,_=t.label?u.height+a:0;d.select("rect").attr("width",p).attr("height",_);var m=d.select("circle").attr("r",r).attr("class","");d.append(function(){return m.remove().node()}),0===e&&m.attr("r",4*r).attr("class","drag-hidden"),e===o.length-1&&m.attr("r",r).attr("class","drag-hidden")}),this._gJourneyPath&&this._gJourneyPath.style("stroke-width",o+"px"),this._compassG&&this._compassG.attr("transform","scale("+1/e+")")},i._printLabels=function(){var t=this,e=Object(n.c)().padding(this._labelPadding).value(function(t){var e=t.label.split("|"),i=e.reduce(function(t,e,i,n){return n[t].length>e.length?t:i},0);return e[i]}),i=Object(n.a)(),a=Object(n.b)(i).size(function(e,i,n){var a=e.label.split("|").length,r=n[i].getElementsByTagName("text")[0].getBBox();return[r.width+2*t._labelPadding,r.height*a+2*t._labelPadding]}).position(function(t){return t.position}).component(e);this._g.datum(this._journey.segment.map(function(t){return t})).call(a)},i._setupSummary=function(){this._divJourneySummary=Object(s.f)("main #summary-column").append("div").attr("id","journey-summary").classed("journey-summary d-none",!0),this._journeySummaryShip=this._divJourneySummary.append("div").classed("block",!0),this._journeySummaryTextWoods=this._journeySummaryShip.append("div"),this._journeySummaryTextShip=this._journeySummaryShip.append("div"),this._journeySummaryShip.append("div").classed("des",!0).text("selected ship"),this._journeySummaryWind=this._divJourneySummary.append("div").classed("block",!0),this._journeySummaryTextWind=this._journeySummaryWind.append("div"),this._journeySummaryWind.append("div").classed("des",!0).text("wind direction"),this._divJourneySummary.append("div").classed("block",!0).append("button").attr("id",this._deleteLastLegButtonId).classed("btn btn-primary btn-sm",!0).attr("role","button").text("Delete last leg")},i._displaySummary=function(t){this._divJourneySummary.classed("d-none",!t),Object(s.f)("#port-summary").classed("d-none",t)},i._showSummary=function(){this._displaySummary(!0)},i._hideSummary=function(){this._displaySummary(!1)},i._printSummaryShip=function(){this._journeySummaryTextWoods.text(this._journey.woodNames),this._journeySummaryTextShip.text(this._journey.shipName)},i._printSummaryWind=function(){this._journeySummaryTextWind.html("From "+Object(_.m)(this._journey.startWindDegrees))},i._printSummary=function(){this._printSummaryWind(),this._printSummaryShip()},i._printLines=function(){this._gJourneyPath&&this._gJourneyPath.datum(this._journey.segment.length>1?this._journey.segment.map(function(t){return t.position}):[[null,null]]).attr("marker-end","url(#course-arrow)").attr("d",this._line)},i._getTextDirection=function(t,e,i){return Object(_.m)(t,!0)+" â F11: "+Object(_.o)(Object(p.p)(i.x,i.y))+"â¯/â¯"+Object(_.o)(Object(p.q)(i.x,i.y))},i._getTextDistance=function(t,e,i){function n(t){function e(t,e){return t+" "+e+(1===t?"":"s")}h.a.locale("en-gb");var i=Math.floor(t/60),n=Math.round(t%60),a="in ";if(t<1)a+="less than a minute";else{var r=0===i?"":e(i,"hour");a+=r+(""===r?"":" ")+(0===n?"":e(n,"minute"))}return a}var a=Math.round(t)+"âk "+n(e);return i&&(a+=" â total "+Math.round(this._journey.totalDistance)+"âk "+n(this._journey.totalMinutes)),a},i._setSegmentLabel=function(t){void 0===t&&(t=this._journey.segment.length-1);var e={x:this._journey.segment[t].position[0],y:this._journey.segment[t].position[1]},i={x:this._journey.segment[t-1].position[0],y:this._journey.segment[t-1].position[1]},n=Object(_.I)(e,i),a=Object(p.w)(e,i),r=Object(_.i)(n),o=this._calculateMinutesForSegment(n,this._journey.currentWindDegrees,1e3*a);this._journey.totalDistance+=a,this._journey.totalMinutes+=o;var s=this._getTextDirection(r,n,e),d=this._getTextDistance(a,o,t>1);this._journey.segment[t].label=s+"|"+d},i._printSegment=function(){this._printLines(),this._setSegmentLabel(),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)},i._printJourney=function(){var t=this;this._printLines(),this._resetJourneyData(),this._journey.segment.forEach(function(e,i){i<t._journey.segment.length-1&&t._setSegmentLabel(i+1)}),this._printLabels(),this._correctJourney(),this._g.selectAll("g.coord g.label circle").call(this._drag)},i._deleteLastLeg=function(){this._journey.segment.pop(),this._journey.segment.length?this._printJourney():(this._g.selectAll("g.coord g.label").remove(),this._gJourneyPath.remove(),this._removeCompass(),this._hideSummary(),this._initJourneyData())},i._initJourney=function(){this._showSummary(),this._printSummary(),this._printCompass(),this._gJourneyPath=this._g.append("path")},i.setSummaryPosition=function(t,e){this._divJourneySummary.style("top",t+"px").style("right",e+"px")},i.plotCourse=function(t,e){this._journey.segment[0].position[0]?(this._journey.segment.push({position:[t,e],label:""}),this._printSegment()):(this._journey.segment[0]={position:[t,e],label:""},this._initJourney())},i.transform=function(t){this._g.attr("transform",t),this._correctJourney()},e}()}).call(this,i("xeH2"))},"9c4Y":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},BI2v:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},FmV8:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return m});i("lYjL"),i("IlJM"),i("/YXa"),i("8cZI"),i("lmye"),i("aOEW"),i("D/wG"),i("eUWX"),i("SUr3"),i("JBxO"),i("y89P"),i("3dw1"),i("U00V");var n=i("/Cyf"),a=i("yw3p"),r=i("wbYc"),o=i("nUlG"),s=(i("3XUK"),i("/1Gu"),i("TiKg")),d=i.n(s),c=(i("YmdP"),i("Av7d")),l=i("0lY5"),h=i("NO11"),u=i("iJ1D"),p=i("1qWw");function _(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var m=function(){function e(t,e){this._portDataDefault=t,this._portData=t,this._map=e,this._serverName=this._map._serverName,this._minScale=this._map._minScale,this._scale=this._minScale,this.f11=this._map._f11,this.showCurrentGood=!1,this.showTradePortPartners=!1,this._currentPort={id:"366",coord:{x:4396,y:2494}},this.zoomLevel="initial",this._showPBZones="all",this._tooltipDuration=200,this._iconSize=48,this._fontSize=c.s,this._circleSize=c.r,this._minRadiusFactor=1,this._maxRadiusFactor=6,this._baseId="show-radius",this._radioButtonValues=["attack","county","points","position","tax","net","off"],this._cookie=new h.a({id:this._baseId,values:this._radioButtonValues}),this._radios=new u.a(this._baseId,this._radioButtonValues),this._showRadius=this._getShowRadiusSetting(),this._setupScales(),this._setupListener(),this._setupSvg(),this._setupCounties(),this._setupRegions(),this._setupSummary(),this._setupFlags(),this._trilateratePosition=new p.a(this)}var s,m,f,g=e.prototype;return g._setupScales=function(){this._portRadius=Object(r.b)(),this._attackRadius=Object(r.b)().domain([0,1]),this._colourScaleHostility=Object(r.b)().domain([0,.5,1]).range([c.m,c.l,c.k]).interpolate(a.c),this._colourScaleCounty=Object(r.c)().range(c.i),this._minTaxIncome=Object(n.d)(this._portData,function(t){return t.taxIncome}),this._maxTaxIncome=Object(n.c)(this._portData,function(t){return t.taxIncome}),this._colourScaleTax=Object(r.b)().domain([this._minTaxIncome,this._maxTaxIncome/10,this._maxTaxIncome]).range([c.m,c.h,c.g]).interpolate(a.c),this._minNetIncome=Object(n.d)(this._portData,function(t){return t.netIncome}),this._maxNetIncome=Object(n.c)(this._portData,function(t){return t.netIncome}),this._colourScaleNet=Object(r.b)().domain([this._minNetIncome,this._minNetIncome/100,0,this._maxNetIncome/100,this._maxNetIncome]).range([c.k,c.l,c.m,c.h,c.g]).interpolate(a.d),this._minPortPoints=Object(n.d)(this._portData,function(t){return t.portPoints}),this._maxPortPoints=Object(n.c)(this._portData,function(t){return t.portPoints}),this._colourScalePoints=Object(r.b)().domain([this._minPortPoints,this._maxPortPoints]).range([c.m,c.g]).interpolate(a.c)},g._setupListener=function(){var t=this;document.getElementById("show-radius").addEventListener("change",function(){return t._showRadiusSelected()})},g._getShowRadiusSetting=function(){var t=this._cookie.get();"position"===t&&(t=this._radioButtonValues[0],this._cookie.set(t));return this._radios.set(t),t},g._showRadiusSelected=function(){this._showRadius=this._radios.get(),this._cookie.set(this._showRadius),this.update()},g._setupSvg=function(){this._gPort=Object(o.f)("#na-svg").insert("g","g.f11").attr("data-ui-component","ports").attr("id","ports"),this._gRegion=this._gPort.append("g").attr("class","region"),this._gCounty=this._gPort.append("g").attr("class","county"),this._gPortCircle=this._gPort.append("g").attr("data-ui-component","port-circles"),this._gIcon=this._gPort.append("g").attr("class","port"),this._gText=this._gPort.append("g").attr("class","port-names")},g._setupCounties=function(){this._countyPolygon=[{name:"Abaco",centroid:[4500,1953],angle:0},{name:"Andros",centroid:[3870,2350],angle:0},{name:"Apalache",centroid:[2800,1330],angle:0},{name:"Bacalar",centroid:[2050,3646],angle:0},{name:"Baracoa",centroid:[4750,3320],angle:25},{name:"Basse-Terre",centroid:[7540,4450],angle:0},{name:"Belize",centroid:[1900,4300],angle:0},{name:"Benedenwinds",centroid:[6187,5340],angle:0},{name:"Bermuda",centroid:[7550,210],angle:0},{name:"Bovenwinds",centroid:[7280,4180],angle:350},{name:"Campeche",centroid:[980,3791],angle:0},{name:"Cap-FranÃ§ais",centroid:[5270,3480],angle:0},{name:"Caracas",centroid:[6430,5750],angle:0},{name:"Cartagena",centroid:[4450,6024],angle:0},{name:"Caymans",centroid:[3116,3811],angle:0},{name:"Cayos del Golfo",centroid:[1240,3120],angle:0},{name:"Comayaqua",centroid:[1920,4500],angle:0},{name:"Cornwall",centroid:[4100,3845],angle:0},{name:"Costa de los Calos",centroid:[2850,1928],angle:0},{name:"Costa del Fuego",centroid:[3700,1670],angle:70},{name:"Costa Rica",centroid:[3140,5920],angle:0},{name:"Crooked",centroid:[4925,2950],angle:0},{name:"Cuidad de Cuba",centroid:[4500,3495],angle:0},{name:"CumanÃ¡",centroid:[7280,5770],angle:0},{name:"Dominica",centroid:[7640,4602],angle:0},{name:"Exuma",centroid:[4700,2560],angle:0},{name:"Filipina",centroid:[2850,3100],angle:340},{name:"Florida Occidental",centroid:[2172,1200],angle:0},{name:"Georgia",centroid:[3670,747],angle:0},{name:"Golfo de Maracaibo",centroid:[5635,5601],angle:0},{name:"Grand Bahama",centroid:[3950,1850],angle:320},{name:"Grande-Terre",centroid:[8e3,4400],angle:35},{name:"Gustavia",centroid:[7720,3990],angle:0},{name:"Inagua",centroid:[4970,3220],angle:0},{name:"Isla de Pinos",centroid:[3150,3300],angle:0},{name:"Kiddâs Island",centroid:[5950,1120],angle:0},{name:"La Habana",centroid:[2850,2800],angle:340},{name:"La Vega",centroid:[5830,3530],angle:20},{name:"Lago de Maracaibo",centroid:[5550,6040],angle:0},{name:"Leeward Islands",centroid:[7850,4150],angle:0},{name:"Les Cayes",centroid:[5145,4050],angle:0},{name:"Los Llanos",centroid:[3640,2770],angle:30},{name:"Los Martires",centroid:[3300,2360],angle:0},{name:"Louisiane",centroid:[1420,1480],angle:0},{name:"Margarita",centroid:[7150,5584],angle:0},{name:"Martinique",centroid:[7700,4783],angle:0},{name:"MÃ©rida",centroid:[1858,3140],angle:0},{name:"New Providence",centroid:[4500,2330],angle:0},{name:"North Carolina",centroid:[4580,150],angle:0},{name:"North Mosquito",centroid:[2420,4480],angle:0},{name:"Nuevitas del Principe",centroid:[4350,3050],angle:35},{name:"Nuevo Santander",centroid:[450,2594],angle:0},{name:"Orinoco",centroid:[7620,6e3],angle:0},{name:"Ponce",centroid:[6720,4040],angle:0},{name:"Port-au-Prince",centroid:[5e3,3800],angle:0},{name:"Portobelo",centroid:[3825,5990],angle:0},{name:"Providencia",centroid:[3436,5033],angle:0},{name:"Quatro Villas",centroid:[3780,3100],angle:35},{name:"Royal Mosquito",centroid:[3130,4840],angle:0},{name:"Sainte-Lucie",centroid:[7720,4959],angle:0},{name:"San Juan",centroid:[6760,3800],angle:0},{name:"Santa Marta",centroid:[5150,5500],angle:340},{name:"Santo Domingo",centroid:[5880,4e3],angle:350},{name:"South Carolina",centroid:[4200,416],angle:0},{name:"South Cays",centroid:[4170,4361],angle:0},{name:"South Mosquito",centroid:[3080,5540],angle:0},{name:"Surrey",centroid:[4350,4100],angle:0},{name:"Texas",centroid:[750,1454],angle:0},{name:"Timucua",centroid:[3620,1220],angle:0},{name:"Trinidad",centroid:[7880,5660],angle:350},{name:"Turks and Caicos",centroid:[5515,3145],angle:0},{name:"Vera Cruz",centroid:[520,3779],angle:0},{name:"Vestindiske Ãer",centroid:[7090,4030],angle:350},{name:"Virgin Islands",centroid:[7220,3840],angle:350},{name:"Windward Isles",centroid:[7800,5244],angle:0}];var t={x:this._map.coord.max/2,y:this._map.coord.max/2};this._countyPolygon=this._countyPolygon.sort(function(e,i){var n={x:e.centroid[0],y:e.centroid[1]},a={x:i.centroid[0],y:i.centroid[1]};return Object(l.n)(t,n)-Object(l.n)(t,a)}),this._colourScaleCounty.domain(this._countyPolygon.map(function(t){return t.name}))},g._setupRegions=function(){this._regionPolygon=[{name:"Atlantic Coast",centroid:[4200,970],angle:0},{name:"Atlantic",centroid:[6401,684],angle:0},{name:"Bahamas",centroid:[5100,2400],angle:0},{name:"Central America",centroid:[3e3,5100],angle:0},{name:"Central Antilles",centroid:[6900,4500],angle:0},{name:"East Cuba",centroid:[4454,3400],angle:20},{name:"Gulf",centroid:[1602,2328],angle:0},{name:"Hispaniola",centroid:[5477,4200],angle:0},{name:"Jamaica",centroid:[3500,3985],angle:0},{name:"Lower Antilles",centroid:[7100,5173],angle:0},{name:"Puerto Rico",centroid:[6900,3750],angle:0},{name:"South America",centroid:[6400,6100],angle:0},{name:"Upper Antilles",centroid:[6850,4250],angle:0},{name:"West Cuba",centroid:[3700,3e3],angle:20},{name:"Yucatan",centroid:[1462,3550],angle:0}]},g._setupSummary=function(){this._divPortSummary=Object(o.f)("main #summary-column").append("div").attr("id","port-summary").attr("class","port-summary"),this._portSummaryNumPorts=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNumPorts=this._portSummaryNumPorts.append("div"),this._portSummaryNumPorts.append("div").attr("class","summary-des").html("selected<br>ports"),this._portSummaryTaxIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextTaxIncome=this._portSummaryTaxIncome.append("div"),this._portSummaryTaxIncome.append("div").attr("class","summary-des").html("tax<br>income"),this._portSummaryNetIncome=this._divPortSummary.append("div").attr("class","block"),this._portSummaryTextNetIncome=this._portSummaryNetIncome.append("div"),this._portSummaryNetIncome.append("div").attr("class","summary-des").html("net<br>income")},g._setupFlags=function(){var t,e,n=this;this._nationIcons=(t=i("vq93"),e={},t.keys().forEach(function(i){e[i.replace("./","").replace(".svg","")]=t(i)}),e);var a=Object(o.f)("#na-svg defs");c.F.map(function(t){return t.short}).forEach(function(t){if(a.append("pattern").attr("id",t).attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+n._iconSize+" "+.75*n._iconSize).append("image").attr("height",n._iconSize).attr("width",n._iconSize).attr("href",n._nationIcons[t].replace('"',"").replace('"',"")),"FT"!==t){var e=a.append("pattern").attr("id",t+"c").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+n._iconSize+" "+.75*n._iconSize);e.append("image").attr("height",n._iconSize).attr("width",n._iconSize).attr("href",n._nationIcons[""+t].replace('"',"").replace('"',"")),e.append("circle").attr("cx",n._iconSize/2).attr("cy",n._iconSize/2).attr("r",16)}if("NT"!==t&&"FT"!==t){a.append("pattern").attr("id",t+"a").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+n._iconSize+" "+.75*n._iconSize).append("image").attr("height",n._iconSize).attr("width",n._iconSize).attr("href",n._nationIcons[t+"a"].replace('"',"").replace('"',""));var i=a.append("pattern").attr("id",t+"ca").attr("width","133%").attr("height","100%").attr("viewBox","6 6 "+n._iconSize+" "+.75*n._iconSize);i.append("image").attr("height",n._iconSize).attr("width",n._iconSize).attr("href",n._nationIcons[t+"a"].replace('"',"").replace('"',"")),i.append("circle").attr("cx",n._iconSize/2).attr("cy",n._iconSize/2).attr("r",16)}})},g._getPortName=function(t){return t?this._portDataDefault.find(function(e){return e.id===t}).name:""},g._getText=function(t,e){d.a.locale("en-gb");var i=d.a.utc(e.portBattle).local(),n=d.a.utc(e.portBattle),a=n===i?"":" ("+i.format("H.mm")+" local)",r=e.portBattleStartTime?(e.portBattleStartTime+10)%24+".00â¯ââ¯"+(e.portBattleStartTime+13)%24+".00":"11.00â¯ââ¯8.00",o=n.isAfter(d.a.utc())?"s":"ed",s=Object(l.k)(e.attackerClan)+" ("+e.attackerNation+") attack"+(e.portBattle.length?o+" "+n.fromNow()+" at "+n.format("H.mm")+a:"s: "+Object(l.u)(e.attackHostility)+" hostility"),c={name:e.name,icon:e.nation,availableForAll:e.availableForAll?"(accessible to all nations)":"",depth:e.shallow?"Shallow":"Deep",county:(""===e.county?"":e.county+"â/â")+e.region,countyCapital:e.countyCapital?" (county capital)":"",nonCapturable:e.nonCapturable,captured:e.capturer?" captured by "+Object(l.k)(e.capturer)+" "+d.a.utc(e.lastPortBattle).fromNow():"",lastPortBattle:e.lastPortBattle,attack:e.attackHostility?s:"",pbTimeRange:e.nonCapturable?"":r,brLimit:Object(l.s)(e.brLimit),portPoints:Object(l.s)(e.portPoints),conquestMarksPension:e.conquestMarksPension,taxIncome:Object(l.w)(e.taxIncome),portTax:Object(l.u)(e.portTax),netIncome:Object(l.w)(e.netIncome),tradingCompany:e.tradingCompany?", trading company levelâ¯"+e.tradingCompany:"",laborHoursDiscount:e.laborHoursDiscount?", labor hours discount levelâ¯"+e.laborHoursDiscount:"",dropsTrading:e.dropsTrading?e.dropsTrading.join(", "):"",consumesTrading:e.consumesTrading?e.consumesTrading.join(", "):"",producesNonTrading:e.producesNonTrading?e.producesNonTrading.join(", "):"",dropsNonTrading:e.dropsNonTrading?e.dropsNonTrading.join(", "):"",tradePort:this._getPortName(this.tradePortId),goodsToSellInTradePort:e.goodsToSellInTradePort?e.goodsToSellInTradePort.join(", "):"",goodsToBuyInTradePort:e.goodsToBuyInTradePort?e.goodsToBuyInTradePort.join(", "):""};switch(e.portBattleType){case"Large":c.pbType=Object(l.B)(1);break;case"Medium":c.pbType=Object(l.B)(4);break;default:c.pbType=Object(l.B)(6)}return c},g._showDetails=function(e,i,n){var a,r,s=this;t(Object(o.f)(n[i]).node()).tooltip({html:!0,placement:"auto",title:(a=this._getText(e.id,e),r='<div class="d-flex align-items-baseline mb-1">',r+='<img alt="'+a.icon+'" class="flag-icon align-self-stretch" src="'+s._nationIcons[a.icon].replace('"',"").replace('"',"")+'"/>',r+='<div class="port-name">'+a.name+"</div>",r+="<div>â"+a.county+" "+a.availableForAll+"</div>",r+="</div>",a.attack.length&&(r+='<div class="alert alert-danger mt-2" role="alert">'+a.attack+"</div>"),r+="<p>"+a.depth+" water port "+a.countyCapital+a.captured+"<br>",a.nonCapturable?(r+="Not capturable",r+="<br>"+a.portTax+" tax"):(r+="Port battle "+a.pbTimeRange+", "+a.brLimit+' <span class="caps">BR</span>, ',r+=a.pbType+'â¯rate <span class="caps">AI</span>, ',r+=a.conquestMarksPension+"â¯conquest point",r+=a.conquestMarksPension>1?"s":"",r+=", "+a.portPoints+"â¯port points",r+="<br>Tax income "+a.taxIncome+" ("+a.portTax+"), net income "+a.netIncome,r+=a.tradingCompany,r+=a.laborHoursDiscount),r+="</p>",r+="<table class='table table-sm'>",a.producesNonTrading.length&&(r+="<tr><td class='pl-0'>ProducesÂ </td><td>",r+='<span class="non-trading">'+a.producesNonTrading+"</span>",r+="</td></tr>"),(a.dropsTrading.length||a.dropsNonTrading.length)&&(r+="<tr><td class='pl-0'>DropsÂ "+(a.dropsNonTrading.length?"Â ":"")+"</td><td>",a.dropsNonTrading.length&&(r+='<span class="non-trading">'+a.dropsNonTrading+"</span>",a.dropsTrading.length&&(r+="<br>")),a.dropsTrading.length&&(r+=""+a.dropsTrading),r+="</td></tr>"),a.consumesTrading.length&&(r+="<tr><td class='pl-0'>ConsumesÂ </td><td>",r+=a.consumesTrading,r+="</td></tr>"),s.showTradePortPartners&&(a.goodsToSellInTradePort.length&&(r+="<tr><td class='pl-0'>Sell in "+a.tradePort+"Â </td><td>"+a.goodsToSellInTradePort+"</td></tr>"),a.goodsToBuyInTradePort.length&&(r+="<tr><td class='pl-0'>Buy in "+a.tradePort+"Â </td><td>"+a.goodsToBuyInTradePort+"</td></tr>")),r+="</table>"),trigger:"manual",sanitize:!1}).tooltip("show"),this._map.showTrades.show&&("inventory"!==this._map.showTrades.listType&&(this._map.showTrades.listType="inventory"),this._map.showTrades.update(function(t){var e="",i=t.inventory.filter(function(t){return t.buyQuantity>0}).map(function(t){return Object(l.s)(t.buyQuantity)+" "+t.name+" @ "+Object(l.v)(t.buyPrice)}).join("<br>"),n=t.inventory.filter(function(t){return t.sellQuantity>0}).map(function(t){return Object(l.s)(t.sellQuantity)+" "+t.name+" @ "+Object(l.v)(t.sellPrice)}).join("<br>");return e+='<h5 class="caps">'+t.name+' <span class="small">'+t.nation+"</span></h5>",i.length&&(e+="<h6>Buy</h6>",e+=i),i.length&&n.length&&(e+="<p></p>"),n.length&&(e+="<h6>Sell</h6>",e+=n),e}(e)))},g._updateIcons=function(){var e=this,i=function(e,i,n){t(Object(o.f)(n[i]).node()).tooltip("dispose")},n=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),a=Object(l.J)(this._circleSize/n),r=this._portDataFiltered;this._gIcon.selectAll("circle").data(r,function(t){return t.id}).join(function(t){return t.append("circle").attr("fill",function(t){var e=(t.countyCapital&&!t.nonCapturable?"c":"")+(t.availableForAll&&"NT"!==t.nation?"a":"");return"url(#"+t.nation+e+")"}).attr("cx",function(t){return t.coordinates[0]}).attr("cy",function(t){return t.coordinates[1]}).on("click",function(t,i,n){return e._showDetails(t,i,n)}).on("mouseleave",i)}).attr("r",a)},g._updatePortCircles=function(){var t=this,e=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),i=Object(l.J)(this._circleSize/e*this._minRadiusFactor),n=Object(l.J)(this._circleSize/e*this._maxRadiusFactor),a=this._portDataFiltered,r=function(){},o=function(){},s=function(){};"tax"===this._showRadius?(a=this._portDataFiltered.filter(function(t){return!t.nonCapturable}),this._portRadius.domain([this._minTaxIncome,this._maxTaxIncome]).range([i,n]),r=function(){return"bubble"},s=function(e){return t._colourScaleTax(e.taxIncome)},o=function(e){return t._portRadius(e.taxIncome)}):"net"===this._showRadius?(a=this._portDataFiltered.filter(function(t){return!t.nonCapturable}),this._portRadius.domain([this._minNetIncome,this._maxNetIncome]).range([i,n]),r=function(){return"bubble"},s=function(e){return t._colourScaleNet(e.netIncome)},o=function(e){return t._portRadius(Math.abs(e.netIncome))}):this.showTradePortPartners?(r=function(e){return"bubble "+(n="",(i=e).id===t.tradePortId?n="here":i.sellInTradePort&&i.buyInTradePort?n="both":i.sellInTradePort?n="pos":i.buyInTradePort&&(n="neg"),n);var i,n},o=function(e){return e.id===t.tradePortId?n:n/2}):"points"===this._showRadius?(a=this._portDataFiltered.filter(function(t){return!t.nonCapturable}),this._portRadius.domain([this._minPortPoints,this._maxPortPoints]).range([i,n/2]),r=function(){return"bubble"},s=function(e){return t._colourScalePoints(e.portPoints)},o=function(e){return t._portRadius(e.portPoints)}):"position"===this._showRadius?(r=function(){return"bubble here"},o=function(t){return t.distance}):"attack"===this._showRadius?(a=this._portDataFiltered.filter(function(t){return t.attackHostility}),this._attackRadius.range([i,n]),r=function(){return"bubble"},s=function(e){return t._colourScaleHostility(e.attackHostility)},o=function(e){return t._attackRadius(e.attackHostility)}):this.showCurrentGood?(r=function(t){return"bubble "+(t.isSource?"pos":"neg")},o=function(){return n/2}):"county"===this._showRadius?(r=function(t){return t.nonCapturable?"bubble non-capturable":t.countyCapital?"bubble capital":"bubble non-capital"},s=function(e){return e.nonCapturable?"":t._colourScaleCounty(e.county)},o=function(t){return t.nonCapturable?n/3:n/2}):"off"===this._showRadius&&(a={}),this._gPortCircle.selectAll("circle").data(a,function(t){return t.id}).join(function(t){return t.append("circle").attr("cx",function(t){return t.coordinates[0]}).attr("cy",function(t){return t.coordinates[1]})}).attr("class",function(t){return r(t)}).attr("r",function(t){return o(t)}).attr("fill",function(t){return s(t)})},g._updateTextsX=function(t,e){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.coordinates[0]+Math.round(1.2*e*Math.cos(Object(l.j)(t.angle))):t.coordinates[0]},g._updateTextsY=function(t,e,i){var n=e+1.2*i;if("pbZone"!==this.zoomLevel)return t.coordinates[1]+n;var a=t.angle>90&&t.angle<270?i:0;return"all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id?t.coordinates[1]+Math.round(1.2*e*Math.sin(Object(l.j)(t.angle)))+a:t.coordinates[1]+n},g._updateTextsAnchor=function(t){return"pbZone"===this.zoomLevel&&("all"===this._showPBZones||"single"===this._showPBZones&&t.id===this.currentPort.id)?t.textAnchor:"middle"},g.updateTexts=function(){var t=this;if("initial"===this.zoomLevel)this._gText.classed("d-none",!0);else{var e=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),i=Object(l.J)(this._circleSize/e),n=Math.pow(2,Math.log2(.9*(Math.abs(this._minScale)+this._scale))),a=Object(l.J)(this._fontSize/n);this._gText.selectAll("text").data(this._portDataFiltered,function(t){return t.id}).join(function(t){return t.append("text").text(function(t){return t.name})}).attr("x",function(e){return t._updateTextsX(e,i)}).attr("y",function(e){return t._updateTextsY(e,i,a)}).attr("text-anchor",function(e){return t._updateTextsAnchor(e)}),this._gText.attr("font-size",a+"px").classed("d-none",!1)}},g._updateSummary=function(){var t=Object.keys(this._portData).length,e=0,i=0;t&&(e=this._portData.map(function(t){return t.taxIncome}).reduce(function(t,e){return t+e}),i=this._portData.map(function(t){return t.netIncome}).reduce(function(t,e){return t+e})),this._portSummaryTextNumPorts.text(""+t),this._portSummaryTextTaxIncome.text(""+Object(l.w)(e)),this._portSummaryTextNetIncome.text(""+Object(l.w)(i))},g._updateCounties=function(){var t=this;if("portLabel"===this.zoomLevel){var e=this._countyPolygonFiltered;this._gCounty.selectAll("text").data(e,function(t){return t.name}).join(function(t){return t.append("text").attr("transform",function(t){return"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")"}).text(function(t){return t.name})},function(e){return e.attr("fill",function(e){return"county"===t._showRadius?t._colourScaleCounty(e.name):""})}),this._gCounty.classed("d-none",!1)}else this._gCounty.classed("d-none",!0)},g._updateRegions=function(){if("initial"===this.zoomLevel){var t=this._regionPolygonFiltered;this._gRegion.selectAll("text").data(t,function(t){return t.name}).join(function(t){return t.append("text").attr("transform",function(t){return"translate("+t.centroid[0]+","+t.centroid[1]+")rotate("+t.angle+")"}).text(function(t){return t.name})}),this._gRegion.classed("d-none",!1)}else this._gRegion.classed("d-none",!0)},g.update=function(t){void 0===t&&(t=null),this._scale=t||this._scale,this._filterVisible(),this._updateIcons(),this._updatePortCircles(),this.updateTexts(),this._updateSummary(),this._updateCounties(),this._updateRegions()},g._filterVisible=function(){var t=this;"position"===this._showRadius?this._portDataFiltered=this._portData:this._portDataFiltered=this._portData.filter(function(e){return e.coordinates[0]>=t._lowerBound[0]&&e.coordinates[0]<=t._upperBound[0]&&e.coordinates[1]>=t._lowerBound[1]&&e.coordinates[1]<=t._upperBound[1]}),this._countyPolygonFiltered=this._countyPolygon.filter(function(e){return e.centroid[0]>=t._lowerBound[0]&&e.centroid[0]<=t._upperBound[0]&&e.centroid[1]>=t._lowerBound[1]&&e.centroid[1]<=t._upperBound[1]}),this._regionPolygonFiltered=this._regionPolygon.filter(function(e){return e.centroid[0]>=t._lowerBound[0]&&e.centroid[0]<=t._upperBound[0]&&e.centroid[1]>=t._lowerBound[1]&&e.centroid[1]<=t._upperBound[1]})},g.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},g._showSummary=function(){this._divPortSummary.classed("hidden",!1)},g.setShowRadiusSetting=function(t){void 0===t&&(t=this._radioButtonValues[0]),this._showRadius=t,this._radios.set(this._showRadius),this._cookie.set(this._showRadius)},g.transform=function(t){this._gPort.attr("transform",t)},g.clearMap=function(t){this._showSummary(),this._portData=this._portDataDefault,this.showCurrentGood=!1,this.showTradePortPartners=!1,this.setShowRadiusSetting(),this.update(t)},s=e,(m=[{key:"portDataDefault",set:function(t){this._portDataDefault=t},get:function(){return this._portDataDefault}},{key:"portData",set:function(t){this._portData=t},get:function(){return this._portData}},{key:"currentPort",set:function(t){this._currentPort=t},get:function(){return this._currentPort}},{key:"zoomLevel",set:function(t){this._zoomLevel=t},get:function(){return this._zoomLevel}}])&&_(s.prototype,m),f&&_(s,f),e}()}).call(this,i("xeH2"))},JNxp:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return u});i("iPZ8"),i("kypl"),i("pCzD"),i("lYjL"),i("4owi"),i("/YXa"),i("8cZI"),i("lmye"),i("WB5j"),i("aOEW"),i("D/wG"),i("1Qwx"),i("eUWX"),i("JBxO"),i("9UJh"),i("RsMT"),i("WoWj"),i("y89P"),i("3dw1"),i("U00V");var n=i("/Cyf"),a=i("wbYc"),r=i("nUlG"),o=i("Av7d"),s=i("0lY5"),d=i("NO11"),c=i("iJ1D");function l(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var u=function(){function e(t,e,i,n,a,r){this._portSelect=t,this._portData=e,this._linkDataDefault=i,this._minScale=n,this._scale=this._minScale,this._fontSize=o.s,this._numTrades=30,this._arrowX=18,this._arrowY=18,this._baseId="show-trades",this._nationSelectId=this._baseId+"-nation-select",this._listType="tradeList",this._showId="show-trades-show",this._showRadioValues=["off","on"],this._showCookie=new d.a({id:this._showId,values:this._showRadioValues}),this._showRadios=new c.a(this._showId,this._showRadioValues),this._profitId="show-trades-profit",this._profitRadioValues=["weight","distance","total"],this._profitCookie=new d.a({id:this._profitId,values:this._profitRadioValues}),this._profitRadios=new c.a(this._profitId,this._profitRadioValues),this.show=this._getShowValue(),this._setupSvg(),this._setupSelects(),this._setupProfitRadios(),this._setupListener(),this._setupList(),this._setupData(),this.setBounds(a,r),this.show&&this._portSelect.setupInventorySelect(this.show),this._showOrHide(),this._profitValue=this._getProfitValue(),this._filterPortsBySelectedNations(),this._sortLinkData()}var i,u,p,_=e.prototype;return _._setupSvg=function(){this._g=Object(r.f)("#na-svg").insert("g","g.pb").attr("class","trades"),this._labelG=this._g.append("g"),Object(r.f)("#na-svg defs").append("marker").attr("id","trade-arrow").attr("refX",this._arrowX).attr("refY",this._arrowY/2).attr("markerWidth",20).attr("markerHeight",20).attr("markerUnits","userSpaceOnUse").attr("orient","auto-start-reverse").append("path").attr("d","M0,0L0,"+this._arrowY+"L"+this._arrowX+","+this._arrowY/2+"z").attr("class","trade-head"),this._tradeDetailsDiv=Object(r.f)("main #summary-column").append("div").attr("id","trade-details").attr("class","trade-details")},_._setupSelects=function(){var e=""+o.F.map(function(t){return'<option value="'+t.short+'" selected>'+t.name+"</option>"}).join(""),i=this._baseId+"-card";this._tradeDetailsHead=this._tradeDetailsDiv.append("div");var n=this._tradeDetailsHead.append("label"),a=n.append("select").attr("name",this._nationSelectId).attr("id",this._nationSelectId).property("multiple",!0).attr("class","selectpicker");this._nationSelector=a.node(),this._nationSelector.insertAdjacentHTML("beforeend",e),t(this._nationSelector).selectpicker({actionsBox:!0,selectedTextFormat:"count > 1",countSelectedText:function(t){return(t===o.F.length?"All":t)+" nations selected"},title:"Select nations"}),n.append("button").attr("class","btn btn-small btn-outline-primary").attr("data-toggle","collapse").attr("data-target","#"+i).text("Info"),this._tradeDetailsHead.append("div").attr("id",i).attr("class","collapse").append("div").attr("class","card card-body small").text("Trade data is static (snapshot taken during maintenance). Therefore, price and/or quantity may not be available anymore. Data is limited as buy and sell prices at a certain port are only known when this port has this good in its inventory or a buy/sell contract. Better sell ports may be found using the in-game trader tool.")},_._setupProfitRadios=function(){var t=this,e=this._tradeDetailsHead.append("div").attr("id",this._profitId).attr("class","align-self-center radio-group pl-2");e.append("legend").attr("class","col-form-label").text("Sort net profit by"),this._profitRadioValues.forEach(function(i){var n=t._profitId+"-"+i.replace(/ /g,""),a=e.append("div").attr("class","custom-control custom-radio custom-control-inline");a.append("input").attr("id",n).attr("name",t._profitId).attr("type","radio").attr("class","custom-control-input").attr("value",i),a.append("label").attr("for",n).attr("class","custom-control-label").text(i)})},_._setupListener=function(){var t=this;document.getElementById(this._showId).addEventListener("change",function(){return t._showSelected()}),document.getElementById(this._profitId).addEventListener("change",function(){return t._profitValueSelected()}),this._nationSelector.addEventListener("change",function(e){t._nationChanged(),e.preventDefault()})},_._setupList=function(){this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")},_._setupData=function(){this._nodeData=new Map(this._portData.map(function(t){return[t.id,{name:t.name,nation:t.nation,isShallow:t.shallow,x:t.coordinates[0],y:t.coordinates[1]}]}))},_._sortLinkData=function(){var t=this;this._linkData=this._linkData.map(function(i){var n=0;switch(t._profitValue){case"weight":n=e._getProfitPerWeight(i);break;case"distance":n=e._getProfitPerDistance(i);break;case"total":n=i.profitTotal;break;default:throw new Error("Wrong profit value "+t._profitValue)}return i.profit=n,i}).sort(function(t,e){return e.profit-t.profit})},_._showSelected=function(){var t=this._showRadios.get();this.show="on"===t,this._showCookie.set(t),this._showOrHide(),this._portSelect.setupInventorySelect(this.show),this._filterTradesBySelectedNations(),this._sortLinkData(),this.update()},_._showOrHide=function(){this.show?(e._showElem(this._tradeDetailsDiv),this._linkData=this._linkDataDefault):(e._hideElem(this._tradeDetailsDiv),this._linkData=[])},_._profitValueSelected=function(){this._profitValue=this._profitRadios.get(),this._profitCookie.set(this._profitValue),this._sortLinkData(),this.update()},_._nationChanged=function(){this._linkData=this._linkDataDefault,this._filterPortsBySelectedNations(),this._filterTradesBySelectedNations(),this.update()},e._getId=function(t){return"trade-"+t.source.id+"-"+t.good.replace(/ /g,"")+"-"+t.target.id},_._getTradeLimitedData=function(t){var e=function(t){return"<div><div>"+t+"</div>"},i=function(t){return'<div class="des">'+t+"</div></div>"},n=function(t){return t?"(shallow)":"(deep)"},a=t.weightPerItem*t.quantity,r="";return r+=e(Object(s.s)(t.quantity)+" "+t.good)+i("trade"),r+=e(""+Object(s.v)(t.profit))+i(this._profitText),r+=e(Object(s.w)(a)+" "+(1===a?"ton":"tons"))+i("weight"),r+=e(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+i("from "+n(this._nodeData.get(t.source.id).isShallow)),r+=e(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+i("to "+n(this._nodeData.get(t.target.id).isShallow)),r+=e(Object(s.w)(t.distance)+"âk")+i("distance")},e._getProfitPerWeight=function(t){return 0===t.weightPerItem?t.profitTotal:Math.round(t.profitTotal/(t.weightPerItem*t.quantity))},e._getProfitPerDistance=function(t){return t.profitTotal/t.distance},_._getTradeFullData=function(t){var i=function(t){return"<div>"+t+"</div>"},n=function(t){return'<div class="des">'+t+"</div>"},a=function(t){return'<div class="block-block"><span>'+t+"</span>"},r=function(t){return t?"(shallow)":"(deep)"},o=t.weightPerItem*t.quantity,d=t.target.grossPrice-t.source.grossPrice,c=e._getProfitPerDistance(t),l=e._getProfitPerWeight(t),h="";return h+=a("Trade"),h+=i(Object(s.s)(t.quantity)+" "+t.good)+n("good"),h+=i(""+Object(s.v)(t.source.grossPrice))+n("gross buy price"),h+=i(""+Object(s.v)(t.target.grossPrice))+n("gross sell price"),h+=i(Object(s.w)(o)+" "+(1===o?"ton":"tons"))+n("weight"),h+="</div>",h+=a("Profit"),h+=i(""+Object(s.v)(t.profitTotal))+n("total"),h+=i(""+Object(s.v)(d))+n("profit/item"),h+=i(""+Object(s.v)(c))+n("profit/distance"),h+=i(""+Object(s.v)(l))+n("profit/weight"),h+="</div>",h+=a("Route"),h+=i(this._nodeData.get(t.source.id).name+' <span class="caps">'+this._nodeData.get(t.source.id).nation+"</span>")+n("from "+r(this._nodeData.get(t.source.id).isShallow)),h+=i(this._nodeData.get(t.target.id).name+' <span class="caps">'+this._nodeData.get(t.target.id).nation+"</span>")+n("to "+r(this._nodeData.get(t.source.id).isShallow)),h+=i(Object(s.w)(t.distance)+"âk")+n("distance"),h+="</div>"},_._updateGraph=function(){var i=this,o=function(e,n,a){var o=Object(r.f)(a[n]),s=i._getTradeFullData(e);t(o.node()).tooltip({html:!0,placement:"auto",template:'<div class="tooltip" role="tooltip"><div class="tooltip-block tooltip-inner tooltip-small"></div></div>',title:s,trigger:"manual",sanitize:!1}).tooltip("show")},d=function(e,i,n){t(Object(r.f)(n[i]).node()).tooltip("dispose")},c=this._portSelect.isInventorySelected?[]:this._linkDataFiltered,l=Object(a.b)().range([5/this._scale,15/this._scale]).domain(Object(n.b)(this._linkDataFiltered,function(t){return t.profit})),h=Math.pow(2,Math.log2(Math.abs(this._minScale)+this._scale)),u=Object(s.J)(this._fontSize/h),p=this._g.transition().duration(500);this._g.selectAll(".trade-link").data(c,function(t){return e._getId(t)}).join(function(t){return t.append("path").attr("class","trade-link").attr("marker-start",function(t){return i._nodeData.get(t.source.id).x<i._nodeData.get(t.target.id).x?"":"url(#trade-arrow)"}).attr("marker-end",function(t){return i._nodeData.get(t.source.id).x<i._nodeData.get(t.target.id).x?"url(#trade-arrow)":""}).attr("id",function(t){return e._getId(t)}).attr("opacity",0).on("click",o).on("mouseleave",d).call(function(t){return t.transition(p).attr("opacity",1)})},function(t){return t.attr("opacity",1)},function(t){return t.call(function(t){return t.transition(p).attr("opacity",0).remove()})}).attr("d",function(t){return function(t,e){var n,r,o={x:i._nodeData.get(e.source.id).x,y:i._nodeData.get(e.source.id).y},s={x:i._nodeData.get(e.target.id).x,y:i._nodeData.get(e.target.id).y},d=t?o.x:s.x,c=t?o.y:s.y,l=t?s.x:o.x,h=t?s.y:o.y,u=Math.sqrt(Math.pow(l-d,2)+Math.pow(h-c,2)),p=t?0:1,_=(n=e.source.id,r=e.target.id,i._linkDataFiltered.filter(function(t){return t.source.id===n&&t.target.id===r||t.source.id===r&&t.target.id===n}).map(function(t){return t.profit}));if(_.length>1){var m=Object(a.d)().domain(_).range([1,_.length]);u/=1+1/_.length*(m(e.profit)-1)}return"M"+d+","+c+"A"+(u=Math.round(u))+","+u+" 0,0,"+p+" "+l+","+h}(i._nodeData.get(t.source.id).x<i._nodeData.get(t.target.id).x,t)}).attr("stroke-width",function(t){return l(t.profit)+"px"}),this._labelG.attr("font-size",u+"px"),this._labelG.selectAll(".trade-label").data(this._linkDataFiltered,function(t){return e._getId(t)}).join(function(t){return t.append("text").attr("class","trade-label").append("textPath").attr("startOffset","15%").attr("xlink:href",function(t){return"#"+e._getId(t)}).text(function(t){return Object(s.s)(t.quantity)+" "+t.good}).attr("opacity",0).call(function(t){return t.transition(p).attr("opacity",1)})},function(t){return t.attr("opacity",1)},function(t){return t.call(function(t){return t.transition(p).attr("opacity",0).remove()})}).attr("dy",function(t){return"-"+l(t.profit)/1.5+"px"})},_._updateList=function(t){switch(void 0===t&&(t=null),this._listType){case"inventory":this._updateInventory(t);break;case"portList":this._updatePortList(t);break;default:this._updateTradeList()}},_._updateInventory=function(t){this._list.html(t)},_._updatePortList=function(t){this._list.html(t)},_._updateTradeList=function(){var t,i=this,n=function(i){(t=Object(r.f)("path#"+e._getId(i)).classed("highlight",!0)).dispatch("click")},a=function(){t.classed("highlight",!1),t.dispatch("mouseleave")};this._list.selectAll("div.block").data(this._linkDataFiltered,function(t){return e._getId(t)}).join(function(t){return t.append("div").attr("class","block").on("mouseenter",n).on("mouseleave",a)}).html(function(t){return i._getTradeLimitedData(t)})},_._filterTradesByVisiblePorts=function(){var t=this,e=new Set(this._portData.filter(function(e){return e.coordinates[0]>=t._lowerBound[0]&&e.coordinates[0]<=t._upperBound[0]&&e.coordinates[1]>=t._lowerBound[1]&&e.coordinates[1]<=t._upperBound[1]}).map(function(t){return t.id}));this._linkDataFiltered=this._linkData.filter(function(t){return e.has(t.source.id)||e.has(t.target.id)}).slice(0,this._numTrades)},_._filterTradesBySelectedNations=function(){var t=this;this._linkData=this._linkData.filter(function(e){return t._portDataFiltered.has(e.source.id)&&t._portDataFiltered.has(e.target.id)}).slice(0,this._numTrades)},_._filterPortsBySelectedNations=function(){var t=new Set(l(this._nationSelector.selectedOptions).map(function(t){return t.value}));this._portDataFiltered=new Set(this._portData.filter(function(e){return t.has(e.nation)}).map(function(t){return t.id}))},_._getShowValue=function(){var t=this._showCookie.get();return this._showRadios.set(t),"on"===t},_._getProfitValue=function(){var t=this._profitCookie.get();switch(this._profitRadios.set(t),t){case"weight":this._profitText="profit/weight";break;case"distance":this._profitText="profit/distance";break;case"total":this._profitText="total";break;default:throw new Error("Wrong profit value")}return t},e._showElem=function(t){t.classed("d-none",!1)},e._hideElem=function(t){t.classed("d-none",!0)},_.update=function(t){void 0===t&&(t=null),this._filterTradesByVisiblePorts(),this._updateGraph(),this._updateList(t)},_.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},_.transform=function(t){this._g.attr("transform",t),this._scale=t.k,this.update()},_.clearMap=function(){this.listType="tradeList",this.show?this._linkData=this._linkDataDefault:this._linkData=[],this.update()},i=e,(u=[{key:"listType",set:function(t){switch(this._listType=t,this._listType){case"inventory":case"portList":this._linkData=[],e._hideElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","small p-2");break;default:this._linkData=this._linkDataDefault,e._showElem(this._tradeDetailsHead),this._list.remove(),this._list=this._tradeDetailsDiv.append("div").attr("class","trade-list small")}},get:function(){return this._listType}}])&&h(i.prototype,u),p&&h(i,p),e}()}).call(this,i("xeH2"))},K2vO:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},Q9mY:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23d4cec4' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},R5TC:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath d='M0 0v210h290V0z' fill='%2300247d'/%3E%3Cpath d='M0 0l290 210m0-210L0 210' stroke='%23fff' stroke-width='28'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23fff' stroke-width='68'/%3E%3Cpath d='M145 0v210M0 105h290' stroke='%23cf142b' stroke-width='40'/%3E%3Cpath d='M0 240h640M320 0v480' stroke='%23cf142b' stroke-width='60'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},Rhp1:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},T2LJ:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},VPfe:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23eb001a' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%23eb001a' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},YBSV:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},YOhT:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 486.86 480'%3E%3Cpath d='M410.06 46.63L279.78 218.06v2.74l207.08-27.43v93.26l-207.08-24.68v2.74l131.65 164.57-86.4 49.37-82.29-192H240L150.86 480l-78.17-49.37 130.29-167.32v-2.74l-203 26.06v-93.26l201.6 26.06v-2.74L72.69 49.37l83.66-48 85 190.63h2.75L327.77 0z' fill='%23d4cec4'/%3E%3C/svg%3E"},cAXh:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return c});i("iPZ8"),i("kypl"),i("pCzD"),i("hi3g"),i("lYjL"),i("IlJM"),i("4owi"),i("IvQZ"),i("/YXa"),i("8cZI"),i("lmye"),i("aOEW"),i("D/wG"),i("1Qwx"),i("fp7Y"),i("JBxO"),i("9UJh"),i("RsMT"),i("4NM0"),i("WoWj"),i("aZFp"),i("3dw1"),i("U00V"),i("btHz");var n=i("TiKg"),a=i.n(n),r=(i("+NlM"),i("kCRU"),i("f4w0")),o=i("Av7d"),s=i("0lY5");function d(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var c=function(){function e(t,e,i){this._ports=t,this._pbZone=e,this._map=i,this._dateFormat="D MMM",this._timeFormat="HH.00",this._portNamesId="port-names-select",this._portNamesSelector=document.getElementById(this._portNamesId),this._buyGoodsId="buy-goods-select",this._buyGoodsSelector=document.getElementById(this._buyGoodsId),this._inventoryId="inventory-select",this._inventorySelector=document.getElementById(this._inventoryId),this._propNationId="prop-nation-select",this._propNationSelector=document.getElementById(this._propNationId),this._propClanId="prop-clan-select",this._propClanSelector=document.getElementById(this._propClanId),this._propCMId="prop-cm-select",this._propCMSelector=document.getElementById(this._propCMId),this.isInventorySelected=!1,this._setupSelects(),this._setupListener()}var i=e.prototype;return i._setupSelects=function(){this._setupPortSelect(),this._setupGoodSelect(),this._setupNationSelect(),this._setupClanSelect(),this._setupCMSelect()},i._resetOtherSelects=function(e){var i=this;[this._portNamesSelector,this._buyGoodsSelector,this._inventorySelector,this._propNationSelector,this._propClanSelector,this._propCMSelector].forEach(function(n){n===e||n===i._propClanSelector&&e===i._propNationSelector||n===i._propNationSelector&&e===i._propClanSelector||t(n).val("default").selectpicker("refresh")})},i._setupListener=function(){var e=this;this._portNamesSelector.addEventListener("change",function(t){Object(r.b)("Menu","Port relations"),e._resetOtherSelects(e._portNamesSelector),e._portSelected(),t.preventDefault()}),this._buyGoodsSelector.addEventListener("change",function(t){Object(r.b)("Menu","Goodsâ relations"),e._resetOtherSelects(e._buyGoodsSelector),e._goodSelected(),t.preventDefault()}),this._inventorySelector.addEventListener("change",function(t){Object(r.b)("Menu","Inventory"),e._resetOtherSelects(e._inventorySelector),e.inventorySelected(),t.preventDefault()}),this._propNationSelector.addEventListener("change",function(t){e._resetOtherSelects(e._propNationSelector),e._nationSelected(),t.preventDefault()}),this._propClanSelector.addEventListener("change",function(t){e._resetOtherSelects(e._propClanSelector),e._clanSelected(),t.preventDefault()}),this._propCMSelector.addEventListener("change",function(t){e._resetOtherSelects(e._propCMSelector),e._CMSelected(),t.preventDefault()}),document.getElementById("menu-prop-deep").addEventListener("click",function(){return e._depthSelected("deep")}),document.getElementById("menu-prop-shallow").addEventListener("click",function(){return e._depthSelected("shallow")}),document.getElementById("menu-prop-all").addEventListener("click",function(){return e._allSelected()}),document.getElementById("menu-prop-non-capturable").addEventListener("click",function(){return e._nonCapSelected()}),document.getElementById("menu-prop-large").addEventListener("click",function(){return e._portSizeSelected("Large")}),document.getElementById("menu-prop-medium").addEventListener("click",function(){return e._portSizeSelected("Medium")}),document.getElementById("menu-prop-small").addEventListener("click",function(){return e._portSizeSelected("Small")}),t.fn.datetimepicker.Constructor.Default=t.extend({},t.fn.datetimepicker.Constructor.Default,{icons:{time:"far fa-clock",date:"far fa-calendar",up:"fas fa-arrow-up",down:"fas fa-arrow-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"far fa-calendar-check",clear:"fas fa-trash",close:"fas fa-times"},timeZone:"UTC"}),t("#prop-pb-from").datetimepicker({format:this._timeFormat}),t("#prop-pb-to").datetimepicker({format:this._timeFormat}),t("#prop-pb-range").submit(function(t){e._capturePBRange(),e._toggleMenuDropdown(),t.preventDefault()}),document.getElementById("menu-prop-today").addEventListener("click",function(){return e._capturedToday()}),document.getElementById("menu-prop-yesterday").addEventListener("click",function(){return e._capturedYesterday()}),document.getElementById("menu-prop-this-week").addEventListener("click",function(){return e._capturedThisWeek()}),document.getElementById("menu-prop-last-week").addEventListener("click",function(){return e._capturedLastWeek()});var i=t("#prop-from"),n=t("#prop-to");i.datetimepicker({format:this._dateFormat}),n.datetimepicker({format:this._dateFormat,useCurrent:!1}),i.on("change.datetimepicker",function(t){return n.datetimepicker("minDate",t.date)}),n.on("change.datetimepicker",function(t){return i.datetimepicker("maxDate",t.date)}),t("#prop-range").submit(function(t){e._captureRange(),e._toggleMenuDropdown(),t.preventDefault()}),Object(o.B)("selectPortNavbar")},i._setupPortSelect=function(){var e=""+this._ports.portDataDefault.map(function(t){return{id:t.id,coord:[t.coordinates[0],t.coordinates[1]],name:t.name,nation:t.nation}}).sort(Object(s.K)(["name"])).map(function(t){return'<option data-subtext="'+t.nation+'" value="'+t.coord+'" data-id="'+t.id+'">'+t.name+"</option>"}).join("");this._portNamesSelector.insertAdjacentHTML("beforeend",e),this._portNamesSelector.classList.add("selectpicker"),t(this._portNamesSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show port relations",virtualScroll:!0}),this._portNamesSelector.classList.remove("d-none"),this._portNamesSelector.parentNode.classList.remove("d-none")},i._setupGoodSelect=function(){var e=new Set;this._ports.portDataDefault.forEach(function(t){["consumesTrading","dropsTrading","dropsNonTrading","producesNonTrading"].forEach(function(i){t[i]&&t[i].forEach(function(t){return e.add(t)})})});var i=""+d(e).sort().map(function(t){return"<option>"+t+"</option>"}).join("");this._buyGoodsSelector.insertAdjacentHTML("beforeend",i),this._buyGoodsSelector.classList.add("selectpicker"),t(this._buyGoodsSelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show goodsâ relations",virtualScroll:!0}),this._buyGoodsSelector.classList.remove("d-none"),this._buyGoodsSelector.parentNode.classList.remove("d-none")},i.setupInventorySelect=function(e){if(!this._inventorySelector.classList.contains("selectpicker")){var i=new Set;this._ports.portDataDefault.forEach(function(t){t.inventory&&t.inventory.forEach(function(t){return i.add(t.name)})});var n=""+d(i).sort().map(function(t){return"<option>"+t+"</option>"}).join("");this._inventorySelector.insertAdjacentHTML("beforeend",n),this._inventorySelector.classList.add("selectpicker"),t(this._inventorySelector).selectpicker({dropupAuto:!1,liveSearch:!0,liveSearchNormalize:!0,liveSearchPlaceholder:"Search ...",title:"Show good availability",virtualScroll:!0})}e?(this._inventorySelector.classList.remove("d-none"),this._inventorySelector.parentNode.classList.remove("d-none")):(this._inventorySelector.classList.add("d-none"),this._inventorySelector.parentNode.classList.add("d-none"))},i._setupNationSelect=function(){var e=""+o.F.sort(Object(s.K)(["name"])).map(function(t){return'<option value="'+t.short+'">'+t.name+"</option>"}).join("");this._propNationSelector.insertAdjacentHTML("beforeend",e),this._propNationSelector.classList.add("selectpicker"),t(this._propNationSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})},i._setupClanSelect=function(){var e=new Set;this._ports.portData.filter(function(t){return t.capturer}).forEach(function(t){return e.add(t.capturer)}),this._propClanSelector.innerHTML="";var i="";0===e.size?this._propClanSelector.disabled=!0:(this._propClanSelector.disabled=!1,i=""+d(e).sort().map(function(t){return'<option value="'+t+'" class="caps">'+t+"</option>"}).join("")),this._propClanSelector.insertAdjacentHTML("beforeend",i),this._propClanSelector.classList.add("selectpicker"),t(this._propClanSelector).selectpicker({dropupAuto:!1,liveSearch:!1,virtualScroll:!0})},i._setupCMSelect=function(){var e=new Set;this._ports.portData.forEach(function(t){return e.add(t.conquestMarksPension)});var i=""+d(e).sort().map(function(t){return'<option value="'+t+'">'+t+"</option>"}).join("");this._propCMSelector.insertAdjacentHTML("beforeend",i),this._propCMSelector.classList.add("selectpicker"),t(this._propCMSelector).selectpicker()},i._setTradePortPartners=function(){var t=this,e=[],i=[],n=this._ports.portDataDefault.find(function(e){return e.id===t._ports.tradePortId});n.consumesTrading&&(e=n.consumesTrading.map(function(t){return t})),n.dropsTrading&&(i=n.dropsTrading.map(function(t){return t})),this._ports.portData=JSON.parse(JSON.stringify(this._ports.portDataDefault)).map(function(t){return t.goodsToSellInTradePort=[],t.sellInTradePort=!1,t.goodsToBuyInTradePort=[],t.buyInTradePort=!1,t.consumesTrading&&t.consumesTrading.forEach(function(e){i.includes(e)&&(t.goodsToBuyInTradePort.push(e),t.buyInTradePort=!0)}),t.dropsTrading&&t.dropsTrading.forEach(function(i){e.includes(i)&&(t.goodsToSellInTradePort.push(i),t.sellInTradePort=!0)}),t}).filter(function(e){return e.id===t._ports.tradePortId||e.sellInTradePort||e.buyInTradePort})},i._toggleMenuDropdown=function(){t("#propertyDropdown").dropdown("toggle")},i._portSelected=function(){var t=this._portNamesSelector.options[this._portNamesSelector.selectedIndex],e=t.value.split(","),i=Number(t.getAttribute("data-id"));this._ports.currentPort={id:i,coord:{x:Number(e[0]),y:Number(e[1])}},this._ports.tradePortId=i,this._setTradePortPartners(),this._pbZone._showPBZones&&this._pbZone.refresh(),this._ports.showTradePortPartners=!0,this._ports.showCurrentGood=!1,this._ports.update(),this._ports._map.initialZoomAndPan()},i._goodSelected=function(){var t=this._buyGoodsSelector.options[this._buyGoodsSelector.selectedIndex].value,e=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(function(e){return e.dropsTrading&&e.dropsTrading.some(function(e){return e===t})||e.dropsNonTrading&&e.dropsNonTrading.some(function(e){return e===t})||e.producesNonTrading&&e.producesNonTrading.some(function(e){return e===t})}))).map(function(t){return t.isSource=!0,t}),i=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(function(e){return e.consumesTrading&&e.consumesTrading.some(function(e){return e===t})}))).map(function(t){return t.isSource=!1,t});this._ports.setShowRadiusSetting("off"),this._ports.portData=e.concat(i),this._ports.showCurrentGood=!0,this._ports.showTradePortPartners=!1,this._ports.update()},i.inventorySelected=function(){this.isInventorySelected=!0;var t,e=this._inventorySelector.options[this._inventorySelector.selectedIndex].value,i=new Map,n=new Map,a=JSON.parse(JSON.stringify(this._ports.portDataDefault.filter(function(t){return t.inventory&&t.inventory.some(function(t){return t.name===e})}))).sort(Object(s.K)(["name"])).map(function(t){var a=t.inventory.find(function(t){return t.name===e});return a.buyQuantity>0&&(t.sellInTradePort=a.buyQuantity>0,i.set(t.name,{name:t.name,nation:t.nation,good:a})),a.sellQuantity>0&&(t.buyInTradePort=a.sellQuantity>0,n.set(t.name,{name:t.name,nation:t.nation,good:a})),t});this._ports.setShowRadiusSetting("off"),this._ports.portData=a,this._ports.showTradePortPartners=!0,this._ports.showCurrentGood=!1,"portList"!==this._map.showTrades.listType&&(this._map.showTrades.listType="portList"),this._map.showTrades.update((t="",t+="<h5>"+e+"</h5>",i.size&&(t+="<h6>Buy</h6>",i.forEach(function(e){t+=e.name+' <span class="caps">'+e.nation+"</span>: "+Object(s.s)(e.good.buyQuantity)+" @ "+Object(s.v)(e.good.buyPrice)+"<br>"})),i&&n&&(t+="<p></p>"),n.size&&(t+="<h6>Sell</h6>",n.forEach(function(e){t+=e.name+' <span class="caps">'+e.nation+"</span>: "+Object(s.s)(e.good.sellQuantity)+" @ "+Object(s.v)(e.good.sellPrice)+"<br>"})),t)),this._ports.update()},i._nationSelected=function(){var e=this;this._nation=this._propNationSelector.options[this._propNationSelector.selectedIndex].value,this._toggleMenuDropdown(),this._ports.portData=this._ports.portDataDefault.filter(function(t){return t.nation===e._nation}),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update(),this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")},i._clanSelected=function(){var t=this,e=this._propClanSelector.options[this._propClanSelector.selectedIndex].value;this._toggleMenuDropdown(),0!==e?this._ports.portData=this._ports.portDataDefault.filter(function(t){return t.capturer===e}):this._nation&&(this._ports.portData=this._ports.portDataDefault.filter(function(e){return e.nation===t._nation})),this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._depthSelected=function(t){var e=this._ports.portDataDefault.filter(function(e){return"shallow"===t?e.shallow:!e.shallow});this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._allSelected=function(){var t=this._ports.portDataDefault.filter(function(t){return t.availableForAll});this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._nonCapSelected=function(){var t=this._ports.portDataDefault.filter(function(t){return t.nonCapturable});this._ports.portData=t,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._portSizeSelected=function(t){var e=this._ports.portDataDefault.filter(function(e){return t===e.portBattleType});this._ports.portData=e,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._CMSelected=function(){var t,e=Number(this._propCMSelector.options[this._propCMSelector.selectedIndex].value);t=0===e?this._ports.portDataDefault:this._ports.portDataDefault.filter(function(t){return e===t.conquestMarksPension}),this._toggleMenuDropdown(),this._ports.portData=t,this._ports.showTradePortPartners=!1,this._ports.update()},i._capturePBRange=function(){var t=[8,9,10],e=24-(t.length+1),i=new Set,n=a()(document.getElementById("prop-pb-from-input").value,this._timeFormat).hour(),r=a()(document.getElementById("prop-pb-to-input").value,this._timeFormat).hour();if(!(t.includes(n)&&t.includes(r)&&n<=r)){i.add(0),r<n&&(r+=24);for(var o=n-2;o<=r-3;o+=1)i.add((o-10)%e)}var s=this._ports.portDataDefault.filter(function(t){return!t.nonCapturable&&"FT"!==t.nation&&i.has(t.portBattleStartTime)});this._ports.portData=s,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._filterCaptured=function(t,e){var i=this._ports.portDataDefault.filter(function(i){return a()(i.lastPortBattle).isBetween(t,e,null,"(]")});this._ports.portData=i,this._ports.showCurrentGood=!1,this._ports.showTradePortPartners=!1,this._ports.update()},i._capturedToday=function(){var t=a.a.utc(),e=a()().utc().hour(11).minute(0);t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))},i._capturedYesterday=function(){var t=a.a.utc(),e=a()().utc().hour(11).minute(0).subtract(1,"day");t.hour()<e.hour()&&(e=e.subtract(1,"day")),this._filterCaptured(e,a.a.utc(e).add(1,"day"))},i._capturedThisWeek=function(){var t=a()().utc().startOf("week"),e=t.hour(11),i=a()(t).add(7,"day").hour(11);this._filterCaptured(e,i)},i._capturedLastWeek=function(){var t=a()().utc().startOf("week"),e=a()(t).subtract(7,"day").hour(11),i=t.hour(11);this._filterCaptured(e,i)},i._captureRange=function(){var t=document.getElementById("prop-from-input").value,e=document.getElementById("prop-to-input").value,i=a()(t,this._dateFormat).hour(11),n=a()(e,this._dateFormat).add(1,"day").hour(11);this._filterCaptured(i,n)},i.clearMap=function(){this.isInventorySelected=!1,this._setupClanSelect(),t(this._propClanSelector).selectpicker("refresh")},e}()}).call(this,i("xeH2"))},cBlp:function(t,e,i){t.exports=i.p+"icons/PR.svg"},cCJq:function(t,e,i){"use strict";i.d(e,"a",function(){return c});i("hi3g"),i("lmye"),i("WB5j");var n=i("ntgT"),a=i("nUlG"),r=i("wbYc"),o=i("0lY5"),s=i("Av7d");function d(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var c=function(){function t(t){this._map=t,this._isShown="on"===this._map._showGrid,this._minCoord=this._map.coord.min,this._maxCoord=this._map.coord.max,this._height=this._map.height,this._width=this._map.width,this._defaultFontSize=this._map.rem,this._xBackgroundHeight=this._map.xGridBackgroundHeight,this._yBackgroundWidth=this._map.yGridBackgroundWidth,this._setupSvg()}var e,i,c,l=t.prototype;return l._setupSvg=function(){this._setupScale(),this._setupAxis()},l._setupScale=function(){this._xScale=Object(r.b)().clamp(!0).domain([Object(s.p)(this._minCoord,this._minCoord),Object(s.p)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord]),this._yScale=Object(r.b)().clamp(!0).domain([Object(s.q)(this._minCoord,this._minCoord),Object(s.q)(this._maxCoord,this._maxCoord)]).range([this._minCoord,this._maxCoord])},l._setupAxis=function(){var t=this._getTicks(65);this._xAxis=Object(n.a)(this._xScale).tickFormat(o.o).tickValues(t).tickSize(this._maxCoord),this._yAxis=Object(n.c)(this._yScale).tickFormat(o.o).tickValues(t).tickSize(this._maxCoord),this._svgMap=Object(a.f)("#na-svg"),this._divXAxisRect=Object(a.f)("#axis-rect-x");var e=this._yBackgroundWidth+this._defaultFontSize;this._svgXAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none").attr("left",e+"px").attr("height",this._height+"px").attr("width",this._width+"px"),this._svgXAxisRect=this._divXAxisRect.append("svg").attr("class","axis").attr("height",this._xBackgroundHeight+"px").attr("width",this._width+"px").append("rect").attr("height",this._xBackgroundHeight+"px").attr("width",this._width+"px"),this._gXAxis=this._svgXAxis.append("g");var i=this._xBackgroundHeight+this._map.getDimensions().top,r=this._height-this._xBackgroundHeight;this._svgYAxis=Object(a.f)("#axis-y"),this._divYAxisRect=Object(a.f)("#axis-rect-y"),this._svgYAxis=this._svgMap.insert("svg","g.pb").attr("class","axis d-none").attr("top",i+"px").attr("height",r+"px").attr("width",this._width+"px"),this._svgYAxisRect=this._divYAxisRect.append("svg").attr("class","axis").attr("height",r+"px").attr("width",this._yBackgroundWidth+"px").append("rect").attr("height",r+"px").attr("width",this._yBackgroundWidth+"px"),this._gYAxis=this._svgYAxis.append("g"),this._displayAxis(),this._setupXAxis(),this._setupYAxis()},l._getTicks=function(t){for(var e=Math.round(Object(s.q)(this._minCoord,this._minCoord)),i=Math.round(Object(s.q)(this._maxCoord,this._maxCoord)),n=(i-e)/(t-1),a=[],r=n;r<i;r+=n)a.push(Math.round(r));a.push(i);var o=a.slice(0).reverse().map(function(t){return-t});return o.push(0),o.concat(a)},l._setupXAxis=function(){this._gXAxis.selectAll(".tick text").attr("dx","-0.3em").attr("dy","2em"),this._gXAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null)},l._setupYAxis=function(){this._gYAxis.attr("text-anchor","end").attr("fill",null).attr("font-family",null),this._gYAxis.selectAll(".tick text").attr("dx","3.5em").attr("dy","-.3em")},l._displayAxis=function(){this._displayXAxis(),this._displayYAxis()},l._displayXAxis=function(){var t=a.b?a.b.transform.k:1,e=a.b?a.b.transform.y:0,i=e/t<this._width?e/t:0,n=-this._maxCoord-i,r=Object(o.J)(this._defaultFontSize/t),s=Object(o.J)(1/t);this._gXAxis.attr("font-size",r).attr("stroke-width",s).call(this._xAxis.tickPadding(n))},l._displayYAxis=function(){var t=a.b?a.b.transform.k:1,e=a.b?a.b.transform.x:0,i=e/t<this._height?e/t:0,n=-this._maxCoord-i,r=Object(o.J)(this._defaultFontSize/t),s=Object(o.J)(1/t);this._gYAxis.attr("font-size",r).attr("stroke-width",s).call(this._yAxis.tickPadding(n))},l.update=function(t){void 0===t&&(t=!1);var e=!1;if(this._isShown&&"initial"!==this.zoomLevel&&(e=!0),t){this._height=this._map.height,this._width=this._map.width,this._svgXAxis.attr("width",this._width),this._svgXAxisRect.attr("width",this._width);var i=this._height-this._xBackgroundHeight;this._svgYAxis.attr("height",i),this._svgYAxisRect.attr("height",i)}this._svgXAxis.classed("d-none",!e),this._divXAxisRect.classed("d-none",!e),this._svgYAxis.classed("d-none",!e),this._divYAxisRect.classed("d-none",!e)},l.transform=function(t){this._gXAxis.attr("transform",t),this._gYAxis.attr("transform",t),this._displayAxis()},e=t,(i=[{key:"show",set:function(t){this._isShown=t},get:function(){return this._isShown}},{key:"zoomLevel",set:function(t){this._zoomLevel=t},get:function(){return this._zoomLevel}}])&&d(e.prototype,i),c&&d(e,c),t}()},cRa1:function(t,e,i){},"e7/b":function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ae1c28' d='M0 0h640v160H0z'/%3E%3Cpath fill='%23fff' d='M0 160h640v160H0z'/%3E%3Cpath fill='%2321468b' d='M0 320h640v160H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},eqiN:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return o});i("hi3g"),i("lYjL"),i("8cZI"),i("lmye");var n=i("nUlG"),a=(i("aBO9"),i("NO11")),r=i("iJ1D"),o=function(){function e(t,e){this._ports=e,this._pbZonesDefault=t,this._showId="show-pb",this._showValues=["all","single","off"],this._showCookie=new a.a({id:this._showId,values:this._showValues}),this._showRadios=new r.a(this._showId,this._showValues),this._showPB=this._getShowPBSetting(),this._setupSvg(),this._setupListener()}var i=e.prototype;return i._setupSvg=function(){this._g=Object(n.f)("#na-svg").insert("g","#ports").attr("class","pb")},i._setupListener=function(){var e=this;t("#show-pb").change(function(){return e._showPBZonesSelected()})},i._getShowPBSetting=function(){var t=this._showCookie.get();return this._showRadios.set(t),t},i._refreshPBZones=function(){this.refresh(),this._ports.updateTexts()},i._showPBZonesSelected=function(){this._showPB=this._showRadios.get(),this._showCookie.set(this._showPB),this._refreshPBZones()},i._update=function(){var t=function(t,e,i){return"M"+t+","+e+" m"+-i+",0 a"+i+","+i+" 0,1,0 "+2*i+",0 a"+i+","+i+" 0,1,0 "+2*-i+",0z"};this._g.selectAll("g").data(this._pbZonesFiltered,function(t){return t.id}).join(function(e){var i=e.append("g");i.append("path").attr("class","join-circle").attr("d",function(e){return t(e.joinCircles[0],e.joinCircles[1],28).concat(t(e.joinCircles[0],e.joinCircles[1],14))}),i.append("path").attr("class","fort").attr("d",function(t){return t.forts.map(function(t){return e=t[0],i=t[1],"M"+(e-(n=3)/2)+","+(i-n/2)+"h"+n+"v"+n+"h"+-n+"z";var e,i,n}).join("")}),i.append("text").attr("class","pb-text pb-fort-text").attr("x",function(t){return t.forts.map(function(t){return t[0]})}).attr("y",function(t){return t.forts.map(function(t){return t[1]})}).text(function(t){return t.forts.map(function(t,e){return""+(e+1)}).join("")}),i.append("path").attr("class","tower").attr("d",function(e){return e.towers.map(function(e){return t(e[0],e[1],1.5)}).join("")}),i.append("text").attr("class","pb-text pb-tower-text").attr("x",function(t){return t.towers.map(function(t){return t[0]})}).attr("y",function(t){return t.towers.map(function(t){return t[1]})}).text(function(t){return t.towers.map(function(t,e){return""+(e+1)}).join("")}),i.append("path").attr("class","pb-circle").attr("d",function(e){return e.pbCircles.map(function(e){return t(e[0],e[1],3.5)}).join("")}),i.append("text").attr("class","pb-text pb-circle-text").attr("x",function(t){return t.pbCircles.map(function(t){return t[0]})}).attr("y",function(t){return t.pbCircles.map(function(t){return t[1]})}).text(function(t){return t.pbCircles.map(function(t,e){return String.fromCharCode(65+e)}).join("")})})},i._isPortIn=function(t){return"all"===this._showPB||"single"===this._showPB&&t.id===this._ports.currentPort.id},i._setData=function(){var t=this;"pbZone"===this._ports.zoomLevel&&"noShow"!==this._showPB?(this._filterVisible(),this._pbZonesFiltered=this._pbZonesFiltered.filter(function(e){return t._isPortIn(e)})):this._pbZonesFiltered={}},i._filterVisible=function(){var t=this;this._pbZonesFiltered=this._pbZonesDefault.filter(function(e){return e.position[0]>=t._lowerBound[0]&&e.position[0]<=t._upperBound[0]&&e.position[1]>=t._lowerBound[1]&&e.position[1]<=t._upperBound[1]})},i.setBounds=function(t,e){this._lowerBound=t,this._upperBound=e},i.refresh=function(){this._setData(),this._update()},i.transform=function(t){this._g.attr("transform",t)},e}()}).call(this,i("xeH2"))},hVUp:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 240h640v240H0z'/%3E%3Cpath d='M0 0h640v240H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},i7nG:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23c3baac' fill-opacity='.7' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},j9j5:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return h});var n=i("nUlG"),a=i("aBO9"),r=i("TiKg"),o=i.n(r),s=(i("YmdP"),i("W/Hz"),i("8sDi"),i("cRa1"),i("f4w0")),d=i("Av7d"),c=i("NO11"),l=i("0lY5"),h=function(){function e(){this._line=Object(a.e)(),this._windPath=null,this._windArrowWidth=4,this._intervalSeconds=40,this._baseName="In-game wind",this._baseId="ingame-wind",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._sliderId="slider-"+this._baseId,this._cookieExpire=this._getExpire(),this._cookieWindDegrees=new c.a({id:this._baseId+"-degrees",expire:this._cookieExpire}),this._cookieTime=new c.a({id:this._baseId+"-time"}),this._currentWindDegrees=this._getCurrentWindCookie(),this._setupListener(),this._currentWindDegrees&&this._initShowCurrentWind()}var i=e.prototype;return i._getHeight=function(){var t=document.querySelector("#port-summary .block"),e=t.getBoundingClientRect();return e.height-e.top-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-top"))-parseFloat(window.getComputedStyle(t).getPropertyValue("padding-bottom"))},i._getCurrentWindCookie=function(){var t=this._cookieWindDegrees.get();if(t){var e=this._cookieTime.get(),i=Math.round((Date.now()-e)/1e3);this._currentWindDegrees=360+Math.floor(t-d.t*i)%360}return t},i._getExpire=function(){var t=o.a.utc(),e=o()().utc().hour(10).minute(0).second(0);return t.hour()>=e.hour()&&(e=e.add(1,"day")),e.local().toDate()},i._storeCurrentWindCookie=function(){this._cookieWindDegrees.set(this._currentWindDegrees),this._cookieTime.set(Date.now())},i._setupSvg=function(){this._div=Object(n.f)("#port-summary").insert("div",":first-child").attr("id",this._baseId).classed("block",!0),this._svg=this._div.append("svg").classed("coord small",!0)},i._navbarClick=function(t){Object(s.b)("Menu",this._baseName),t.stopPropagation(),this._windRoseSelected()},i._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",function(e){return t._navbarClick(e)})},i._setupWindInput=function(){var e=t.fn.roundSlider.prototype._getTooltipPos;t.fn.roundSlider.prototype._getTooltipPos=function(){this.tooltip.is(":visible")||t("body").append(this.tooltip);var i=e.call(this);return this.container.append(this.tooltip),i},window.tooltip=function(t){return Object(l.l)(t.value)+"<br>"+t.value+"Â°"},t("#"+this._sliderId).roundSlider({sliderType:"default",handleSize:"+1",startAngle:90,width:20,radius:110,min:0,max:359,step:360/l.e.length,editableTooltip:!1,tooltipFormat:"tooltip",create:function(){this.control.css("display","block")},change:function(){this._currentWind=t("#"+this._sliderId).roundSlider("getValue")}})},i._injectModal=function(){o.a.locale("en-gb"),Object(d.D)(this._modalId,this._baseName,"sm");var t=Object(n.f)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).append("div").attr("class","form-group").append("div").classed("alert alert-primary",!0);t.append("label").attr("for",this._sliderId).text("Current in-game wind"),t.append("div").attr("id",this._sliderId).attr("class","rslider")},i._initModal=function(){this._injectModal(),this._setupWindInput()},i._windRoseSelected=function(){var e=this;document.getElementById(this._modalId)||this._initModal(),t("#"+this._modalId).modal("show").one("hidden.bs.modal",function(){e._useUserInput()})},i._windChange=function(){this._currentWindDegrees=360+(this._currentWindDegrees-d.t*this._intervalSeconds)%360,this._updateWindDirection()},i._useUserInput=function(){this._currentWindDegrees=Object(l.C)(this._sliderId),this._windPath?this._updateWindDirection():this._initShowCurrentWind()},i._initShowCurrentWind=function(){var t=this;this._setupSvg(),this._initPrintCompassRose(),this._updateWindDirection(),this._intervalId=window.setInterval(function(){t._windChange()},1e3*this._intervalSeconds)},i._updateWindDirection=function(){var t=Object(l.j)(this._currentWindDegrees),e=this._length*Math.cos(t),i=this._length*Math.sin(t),n=[[Math.round(this._xCompass+e),Math.round(this._yCompass+i)],[Math.round(this._xCompass-e),Math.round(this._yCompass-i)]];this._windPath.datum(n).attr("d",this._line),this._storeCurrentWindCookie()},i._initPrintCompassRose=function(){this._height=this._getHeight(),this._yCompass=this._height/2,this._width=this._height,this._xCompass=this._width/2,this._compassRadius=Math.min(this._height,this._width)/2,this._length=.6*this._compassRadius,this._svg.attr("height",this._height).attr("width",this._width);var t=this._svg.append("svg").classed("compass",!0).attr("x",this._xCompass).attr("y",this._yCompass);Object(l.G)({element:t,radius:this._compassRadius}),this._windPath=this._svg.append("path").classed("wind",!0).attr("marker-end","url(#wind-arrow)")},i.clearMap=function(){window.clearInterval(this._intervalId),this._div&&this._div.remove(),this._windPath=null,this._cookieWindDegrees.remove()},e}()}).call(this,i("xeH2"))},jtsq:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23ac0234' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fff' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fff' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},ncpf:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath stroke='%230039a6' stroke-miterlimit='10' stroke-width='60' d='M0 0l640 480M0 480L640 0'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},q1r0:function(t,e,i){"use strict";(function(t){i.d(e,"a",function(){return c});i("fp7Y"),i("Pgdl");var n=i("nUlG"),a=i("TiKg"),r=i.n(a),o=(i("YmdP"),i("0lY5")),s=i("Av7d"),d=i("f4w0"),c=function(){function e(t,e){this._map=t,this._coord=e,this._baseName="Go to F11",this._baseId="go-to-f11",this._buttonId="button-"+this._baseId,this._modalId="modal-"+this._baseId,this._formId="form-"+this._baseId,this._xInputId="input-x-"+this._baseId,this._zInputId="input-z-"+this._baseId,this._copyButtonId="copy-coord-"+this._baseId,this._submitButtonId="submit-"+this._baseId,this._modal$=null,this._setupSvg(),this._setupListener()}var i=e.prototype;return i._setupSvg=function(){this._g=Object(n.f)("#na-svg").append("g").classed("f11",!0)},i._navbarClick=function(t){Object(d.b)("Menu","Go to F11"),t.stopPropagation(),this._f11Selected()},i._setupListener=function(){var t=this;document.getElementById(""+this._buttonId).addEventListener("click",function(e){return t._navbarClick(e)}),window.addEventListener("keydown",function(e){"F11"===e.code&&e.shiftKey&&t._navbarClick(e)})},i._injectModal=function(){Object(s.D)(this._modalId,this._baseName,"sm");var t=Object(n.f)("#"+this._modalId+" .modal-body").append("form").attr("id",this._formId).attr("role","form");this._formSel=t.node(),t.append("div").classed("alert alert-primary",!0).text("Use F11 in open world.");var e=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);e.append("label").attr("for",this._xInputId),e.append("input").classed("form-control",!0).attr("id",this._xInputId).attr("type","number").attr("required","").attr("placeholder","X coordinate").attr("min","-819").attr("max","819").attr("step","1").attr("tabindex","1"),e.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k");var i=t.append("div").classed("form-group",!0).append("div").classed("input-group",!0);i.append("label").attr("for",this._zInputId),i.append("input").classed("form-control",!0).attr("id",this._zInputId).attr("type","number").attr("required","").attr("placeholder","Z coordinate").attr("step","1").attr("min","-819").attr("max","819").attr("tabindex","2"),i.append("div").classed("input-group-append",!0).append("span").classed("input-group-text",!0).text("k"),t.append("div").classed("alert alert-primary",!0).append("small").html("In k units (divide by 1,000).<br>Example: <em>43</em> for value of <em>43,162.5</em>.");var a=t.append("div").classed("float-right btn-group",!0).attr("role","group");a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._copyButtonId).attr("title","Copy to clipboard (ctrl-c)").attr("type","button").append("i").classed("far fa-copy",!0),a.append("button").classed("btn btn-outline-secondary",!0).attr("id",this._submitButtonId).attr("title","Go to").attr("type","submit").text("Go to"),Object(n.f)("#"+this._modalId+" .modal-footer").remove()},i._initModal=function(){this._injectModal()},i._f11Selected=function(){var e=this;this._modal$||(this._initModal(),this._modal$=t("#"+this._modalId),this._xInputSel=document.getElementById(this._xInputId),this._zInputSel=document.getElementById(this._zInputId),this._formSel.addEventListener("submit",function(t){e._modal$.modal("hide"),t.preventDefault(),e._useUserInput()}),this._modal$.on("keydown",function(t){"KeyC"===t.code&&t.ctrlKey&&e._copyCoordClicked(t)}),document.getElementById(this._copyButtonId).addEventListener("click",function(t){e._copyCoordClicked(t)})),this._modal$.modal("show"),this._xInputSel.focus(),this._xInputSel.select()},i._getInputValue=function(t){var e=t.value;return""===e?1/0:Number(e)},i._getXCoord=function(){return this._getInputValue(this._xInputSel)},i._getZCoord=function(){return this._getInputValue(this._zInputSel)},i._useUserInput=function(){var t=-1e3*this._getXCoord(),e=-1e3*this._getZCoord();Number.isFinite(t)&&Number.isFinite(e)&&this._goToF11(t,e)},i._copyCoordClicked=function(t){Object(d.b)("Menu","Copy F11 coordinates"),t.preventDefault();var e=this._getXCoord(),i=this._getZCoord();Object(o.g)(e,i)},i._printF11Coord=function(t,e,i,n){var a=10,s=this._g.append("g").attr("transform","translate("+t+","+e+")"),d=s.append("rect"),c=s.append("rect");s.append("circle").attr("r",a),a*=1.6;var l=s.append("text").attr("dx",-a+"px").attr("dy",-a/2-2+"px").attr("class","f11-coord").text(Object(o.o)(i)),h=s.append("text").attr("dx",-a+"px").attr("dy",a/2+2+"px").attr("class","f11-coord").text(Object(o.o)(n)),u=l.node().getBBox(),p=h.node().getBBox(),_=r()().utc(),m=r()(),f=s.append("text").attr("dx",a+"px").attr("dy",-a/2-2+"px").attr("class","f11-time").text(_.format("H.mm")),g=s.append("text").attr("dx",a+"px").attr("dy",a/2+2+"px").attr("class","f11-time").text("("+m.format("H.mm")+" local)"),v=f.node().getBBox(),b=g.node().getBBox(),y=1.2*Math.round(u.height+p.height),w=Math.round(Math.max(u.width,p.width)+5),S=1.2*Math.round(v.height+b.height),x=Math.round(Math.max(v.width,b.width)+5),C=Math.max(y,S);d.attr("x",-w-a).attr("y",-C/2).attr("height",C).attr("width",w+a),c.attr("x",0).attr("y",-C/2).attr("height",C).attr("width",x+a)},i._goToF11=function(t,e){var i=Number(t),n=Number(e),a=Math.floor(Object(s.n)(i,n)),r=Math.floor(Object(s.o)(i,n));Object(o.a)(a,this._coord.min,this._coord.max,!0)&&Object(o.a)(r,this._coord.min,this._coord.max,!0)&&(this._printF11Coord(a,r,i,n),this._map.zoomAndPan(a,r,1))},i.goToF11FromParam=function(t){var e=-1e3*Number(t.get("x")),i=-1e3*Number(t.get("z"));Number.isFinite(e)&&Number.isFinite(i)&&(Object(d.b)("Menu","Paste F11 coordinates"),this._goToF11(e,i))},i.printCoord=function(t,e){var i=Object(s.p)(t,e),n=Object(s.q)(t,e);this._printF11Coord(t,e,i,n)},i.transform=function(t){this._g.attr("transform",t)},i.clearMap=function(){this._g.selectAll("*").remove()},e}()}).call(this,i("xeH2"))},tUdp:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23006aa7' d='M0 0h640v480H0z'/%3E%3Cpath fill='%23fecc00' d='M207.57 0h69.19v480h-69.19z'/%3E%3Cpath fill='%23fecc00' d='M0 207.57h640v68.57H0z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"},vHJc:function(t,e,i){t.exports=i.p+"icons/US.svg"},vi22:function(t,e,i){"use strict";i.r(e),function(t){i.d(e,"Map",function(){return w});i("IlJM"),i("/YXa"),i("8cZI"),i("lmye"),i("D/wG"),i("eUWX"),i("uAsx"),i("JBxO"),i("FdtR"),i("9UJh"),i("WoWj"),i("3dw1"),i("U00V");var n=i("/Cyf"),a=i("nUlG"),r=i("NRFW"),o=(i("3XUK"),i("hSFQ"),i("Peo2"),i("Av7d")),s=i("0lY5"),d=i("f4w0"),c=i("NO11"),l=i("iJ1D"),h=i("eqiN"),u=i("FmV8"),p=i("cAXh"),_=i("q1r0"),m=i("cCJq"),f=i("8gAj"),g=i("62GW"),v=i("j9j5"),b=i("JNxp");function y(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var w=function(){function e(t,e){this._serverName=t,this._searchParams=e,this._dataDirectory="data",this._dataSources=[{fileName:"ports.json",name:"ports"},{fileName:t+"-trades.json",name:"trades"},{fileName:t+".json",name:"server"},{fileName:t+"-pb.json",name:"pb"},{fileName:"pb.json",name:"pbZones"},{fileName:"ships.json",name:"ships"},{fileName:"woods.json",name:"woods"},{fileName:"modules.json",name:"modules"}],this.rem=o.s,this.xGridBackgroundHeight=Math.floor(3*this.rem),this.yGridBackgroundWidth=Math.floor(4*this.rem),this.coord={min:0,max:8192},this._currentTranslate={},this._tileSize=256,this._maxScale=Math.pow(2,3),this._wheelDelta=.5,this._PBZoneZoomThreshold=1.5,this._labelZoomThreshold=.5,this._doubleClickActionId="double-click-action",this._doubleClickActionValues=["compass","f11"],this._doubleClickActionCookie=new c.a({id:this._doubleClickActionId,values:this._doubleClickActionValues}),this._doubleClickActionRadios=new l.a(this._doubleClickActionId,this._doubleClickActionValues),this._doubleClickAction=this._getDoubleClickAction(),this._showGridId="show-grid",this._showGridValues=["off","on"],this._showGridCookie=new c.a({id:this._showGridId,values:this._showGridValues}),this._showGridRadios=new l.a(this._showGridId,this._showGridValues),this._showGrid=this._getShowGridValue();var i=document.getElementsByClassName("flex-overlay");this._flexOverlay=i[0],this._setHeightWidth(),this._setupScale(),this._setupSvg(),this._setSvgSize(),this._setupListener(),this._readData()}var i,w,S,x=e.prototype;return x._getDoubleClickAction=function(){var t=this._doubleClickActionCookie.get();return this._doubleClickActionRadios.set(t),t},x._getShowGridValue=function(){var t=this._showGridCookie.get();return this._showGridRadios.set(t),t},x._setupData=function(t){var e=t.ports.map(function(e){var i=e,n=t.server.find(function(t){return t.id===i.id});i.portBattleStartTime=n.portBattleStartTime,i.portBattleType=n.portBattleType,i.nonCapturable=n.nonCapturable,i.conquestMarksPension=n.conquestMarksPension,i.portTax=n.portTax,i.taxIncome=n.taxIncome,i.netIncome=n.netIncome,i.tradingCompany=n.tradingCompany,i.laborHoursDiscount=n.laborHoursDiscount,i.dropsTrading=n.dropsTrading,i.consumesTrading=n.consumesTrading,i.producesNonTrading=n.producesNonTrading,i.dropsNonTrading=n.dropsNonTrading,i.inventory=n.inventory,["dropsTrading","consumesTrading","producesNonTrading","dropsNonTrading"].forEach(function(t){i[t]||delete i[t]});var a=t.pb.ports.find(function(t){return t.id===i.id});return i.nation=a.nation,i.capturer=a.capturer,i.lastPortBattle=a.lastPortBattle,i.attackHostility=a.attackHostility,i.attackerClan=a.attackerClan,i.attackerNation=a.attackerNation,i.portBattle=a.portBattle,i});this._f11=new _.a(this,this.coord),this._ports=new u.a(e,this),this._pbZone=new h.a(t.pbZones,this._ports),this._grid=new m.a(this),this._woodData=JSON.parse(JSON.stringify(t.woods)),this._shipData=JSON.parse(JSON.stringify(t.ships));var i=JSON.parse(JSON.stringify(t.modules));this._journey=new f.a(this._shipData,this._woodData,i,this.rem),this._portSelect=new p.a(this._ports,this._pbZone,this),this.showTrades=new b.a(this._portSelect,e,t.trades,this._minScale,this.coord.min,this.coord.max),this._init(),this._windPrediction=new g.a,this._windRose=new v.a},x._readData=function(){var t=this,e=[],i={};this._dataSources.forEach(function(i,n){e[n]=fetch(t._dataDirectory+"/"+i.fileName).then(s.c).then(s.A)}),Promise.all(e).then(function(e){e.forEach(function(e,n){i[t._dataSources[n].name]=e}),t._setupData(i)}).catch(s.H)},x._setupListener=function(){var t=this;this._svg.on("dblclick.zoom",null).on("click",function(){a.b.defaultPrevented&&a.b.stopPropagation()},!0).on("dblclick",function(e,i,n){return t._doDoubleClickAction(n[i])}),document.getElementById("propertyDropdown").addEventListener("click",function(){Object(d.b)("Menu","Select port on property")}),document.getElementById("settingsDropdown").addEventListener("click",function(){Object(d.b)("Menu","Settings")}),document.getElementById("button-download-pb-calc").addEventListener("click",function(){Object(d.b)("Tools","Download pb calculator")}),document.getElementById("reset").addEventListener("click",function(){t._clearMap()}),document.getElementById("about").addEventListener("click",function(){t._showAbout()}),document.getElementById("double-click-action").addEventListener("change",function(){return t._doubleClickSelected()}),document.getElementById("show-grid").addEventListener("change",function(){return t._showGridSelected()})},x._setupScale=function(){this._minScale=Object(s.E)(Math.min(this.width/this.coord.max,this.height/this.coord.max)),this._currentScale=this._minScale},x._setupSvg=function(){var t=this;this._zoom=Object(r.a)().wheelDelta(function(){return-t._wheelDelta*Math.sign(a.b.deltaY)}).translateExtent([[this.coord.min-this.yGridBackgroundWidth*this._minScale,this.coord.min-this.xGridBackgroundHeight*this._minScale],[this.coord.max,this.coord.max]]).scaleExtent([this._minScale,this._maxScale]).on("zoom",function(){return t._naZoomed()}),this._svg=Object(a.f)("#na-map").append("svg").attr("id","na-svg").call(this._zoom),this._svg.append("defs"),this._gMap=this._svg.append("g").classed("map",!0)},x._doubleClickSelected=function(){this._doubleClickAction=this._doubleClickActionRadios.get(),this._doubleClickActionCookie.set(this._doubleClickAction),this._clearMap()},x._showGridSelected=function(){this._showGrid=this._showGridRadios.get(),this._grid.show="on"===this._showGrid,this._showGridCookie.set(this._showGrid),this._refreshLayer()},x._refreshLayer=function(){this._grid.update()},x._displayMap=function(t){var e=t.x,i=t.y,a=t.k,o=Math.log2(this._tileSize),d=Math.log2(this.coord.max)-o,c=this.coord.max*a,l=this.width,h=this.height,u=Math.floor(c<l?l-2*e:c),p=Math.floor(c<h?h-2*i:c),_=Math.log2(a),m=Math.min(d,Math.ceil(Math.log2(Math.max(u,p)))-o),f=Math.round(10*(m-_-d))/10,g=Math.pow(this._wheelDelta,f),v=this._tileSize*g,b=c<l?e:0,y=c<h?i:0,w=Object(n.e)(Math.max(0,Math.floor((0-e)/v)),Math.max(0,Math.min(Math.ceil((l-e-b)/v),Math.pow(2,m)))),S=Object(n.e)(Math.max(0,Math.floor((0-i)/v)),Math.max(0,Math.min(Math.ceil((h-i-y)/v),Math.pow(2,m)))),x=[];S.forEach(function(t){w.forEach(function(e){x.push({z:m,row:t,col:e,id:m.toString()+"-"+t.toString()+"-"+e.toString()})})}),x.transform=r.b.translate(e,i).scale(Object(s.J)(g)),this._updateMap(x)},x._updateMap=function(t){var e=this;this._gMap.attr("transform",t.transform).selectAll("image").data(t,function(t){return t.id}).join(function(t){return t.append("image").attr("xlink:href",function(t){return"images/map/"+t.z+"/"+t.row+"/"+t.col+".jpg"}).attr("x",function(t){return t.col*e._tileSize}).attr("y",function(t){return t.row*e._tileSize}).attr("width",e._tileSize+1).attr("height",e._tileSize+1)})},x._clearMap=function(){this._windPrediction.clearMap(),this._windRose.clearMap(),this._f11.clearMap(),this._ports.clearMap(),this._portSelect.clearMap(),this.showTrades.clearMap(),t(".selectpicker").val("default").selectpicker("refresh")},x._showAbout=function(){var e;t("#modal-about").length||(e="modal-about",Object(o.D)(e,o.c+' <span class="text-primary small">v'+o.d+"</span>",""),Object(a.f)("#"+e+" .modal-body").html("<p>"+o.a+' Please check the <a href="https://forum.game-labs.net/topic/23980-yet-another-map-naval-action-map/"> Game-Labs forum post</a> for further details. Feedback is very welcome.</p><p>Designed by iB aka Felix Victor, clan Bastard Sons '+Object(s.k)("(BASTD)")+"</a>.</p>")),t("#modal-about").modal("show")},x._doDoubleClickAction=function(t){var e=Object(a.d)(t),i=Object(r.c)(t),n=e[0],o=e[1],s=i.k,d=(n-i.x)/s,c=(o-i.y)/s;"f11"===this._doubleClickAction?this._f11.printCoord(d,c):this._journey.plotCourse(d,c),this.zoomAndPan(d,c,1)},x._setZoomLevelAndData=function(){a.b.transform.k!==this._currentScale&&(this._currentScale=a.b.transform.k,this._currentScale>this._PBZoneZoomThreshold?"pbZone"!==this.zoomLevel&&(this.zoomLevel="pbZone"):this._currentScale>this._labelZoomThreshold?"portLabel"!==this.zoomLevel&&(this.zoomLevel="portLabel"):"initial"!==this.zoomLevel&&(this.zoomLevel="initial"),this._setFlexOverlayHeight(),this._grid.update()),this._pbZone.refresh(),this._ports.update(this._currentScale)},x._naZoomed=function(){this._currentTranslate.x=Math.floor(a.b.transform.x),this._currentTranslate.y=Math.floor(a.b.transform.y);var t=r.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(Object(s.J)(a.b.transform.k)),e=t.invert([this.coord.min,this.coord.min]),i=t.invert([this.width,this.height]);this._ports.setBounds(e,i),this._pbZone.setBounds(e,i),this.showTrades.setBounds(e,i),this._displayMap(t),this._grid.transform(t),this._ports.transform(t),this._journey.transform(t),this._pbZone.transform(t),this._f11.transform(t),this.showTrades.transform(t),this._setZoomLevelAndData()},x._checkF11Coord=function(){this._searchParams.has("x")&&this._searchParams.has("z")&&this._f11.goToF11FromParam(this._searchParams)},x._init=function(){this.zoomLevel="initial",this.initialZoomAndPan(),this._checkF11Coord(),this._setFlexOverlayHeight()},x.resize=function(){var t=r.b.translate(this._currentTranslate.x,this._currentTranslate.y).scale(this._currentScale);this._setHeightWidth(),this._setSvgSize(),this._setFlexOverlayHeight(),this._displayMap(t),this._grid.update(!0)},x.getDimensions=function(){return document.getElementsByClassName("flex-overlay")[0].getBoundingClientRect()},x._getWidth=function(){return this.getDimensions().width},x._getHeight=function(){var t=this.getDimensions().top;return document.documentElement.clientHeight-this.rem-t},x._setHeightWidth=function(){this.width=this._getWidth(),this.height=this._getHeight()},x._setSvgSize=function(){this._svg.attr("width",this.width).attr("height",this.height)},x._setFlexOverlayHeight=function(){var t=this.height-(this._grid.show&&"initial"!==this.zoomLevel?this.xGridBackgroundHeight:0);this._flexOverlay.setAttribute("style","height:"+t+"px")},x.initialZoomAndPan=function(){this._svg.call(this._zoom.scaleTo,this._minScale)},x.zoomAndPan=function(t,e,i){var n=r.b.scale(i).translate(Math.round(-t+this.width/2/i),Math.round(-e+this.height/2/i));this._svg.call(this._zoom.transform,n)},x.goToPort=function(){"0"===this._ports.currentPort.id?this.initialZoomAndPan():this.zoomAndPan(this._ports.currentPort.coord.x,this._ports.currentPort.coord.y,2)},i=e,(w=[{key:"zoomLevel",set:function(t){this._zoomLevel=t,this._ports.zoomLevel=t,this._grid.zoomLevel=t},get:function(){return this._zoomLevel}}])&&y(i.prototype,w),S&&y(i,S),e}()}.call(this,i("xeH2"))},vq93:function(t,e,i){var n={"./DE.svg":"YBSV","./DEa.svg":"hVUp","./DK.svg":"jtsq","./DKa.svg":"Rhp1","./ES.svg":"+42d","./ESa.svg":"0siz","./FR.svg":"yQGq","./FRa.svg":"T2LJ","./FT.svg":"YOhT","./GB.svg":"BI2v","./GBa.svg":"R5TC","./NT.svg":"Q9mY","./PL.svg":"VPfe","./PLa.svg":"9c4Y","./PR.svg":"cBlp","./PRa.svg":"/foq","./RU.svg":"ncpf","./RUa.svg":"7chY","./SE.svg":"tUdp","./SEa.svg":"i7nG","./US.svg":"vHJc","./USa.svg":"28Wg","./VP.svg":"K2vO","./VPa.svg":"e7/b"};function a(t){var e=r(t);return i(e)}function r(t){if(!i.o(n,t)){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}return n[t]}a.keys=function(){return Object.keys(n)},a.resolve=r,t.exports=a,a.id="vq93"},yQGq:function(t,e){t.exports="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 480'%3E%3Cpath fill='%23fff' d='M0 0h640v480H0z'/%3E%3Cpath fill='%230039a6' d='M0 0h213.337v480H0z'/%3E%3Cpath fill='%23d52b1e' d='M426.662 0H640v480H426.662z'/%3E%3Cpath fill='%23988b76' fill-opacity='.3' d='M0 0h640v480H0z'/%3E%3C/svg%3E"}}]);